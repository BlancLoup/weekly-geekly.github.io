<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mini-review of libraries for Reflection in C ++</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Due to the modest information on this topic, in this article I will conduct a small review and comparison of the found libraries for Reflection in C +...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mini-review of libraries for Reflection in C ++</h1><div class="post__text post__text-html js-mediator-article">  Due to the modest information on this topic, in this article I will conduct a small review and comparison of the found libraries for Reflection in C ++.  Primarily, this information will be of interest to game developers. <br><br>  Thanks to reflection, you can: <br>  - It is easy to create editors, including interfaces, as there is convenient access to meta-information about all the properties of your objects; <br>  - Add binding for many scripting languages ‚Äã‚Äãat once (Lua, Python, JavaScript, etc.); <br>  - Use meta-information for automatic serialization; <br>  - Use as a factory of objects, creating the necessary instances, having only a string with the name type; <br>  - Use as a more lightweight replacement dynamic_cast; <br>  - And so on and so forth, depending on imagination and needs. <br><a name="habracut"></a><br>  <b>Next comes a review of each library in turn because of my modest possibilities.</b>  <b>For each:</b> <br>  - short description; <br>  - an example of binding and use for this class: <br><br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a + b; } };</code> </pre> <br>  - performance measurement results on i5 3570K, Windows 8, Visual Studio 2013, Release x86 (10,000,000 class method calls were measured separately and 10,000,000 metamethods + calls separately were measured). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Only libraries that did not require additional building steps and tools (like qt moc and gccxml) were considered. <br><br>  Libraries are listed in ascending order of personal interest to them. <br><br><h4>  1) Luabind </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/6b7/a4f/438/6b7a4f43895b404cb7cebe2f2aebd5c6.png" alt="image"><br>  <a href="https://github.com/rpavlik/luabind">github.com/rpavlik/luabind</a> <br><br>  Luabind (rpavlik's fork) is used for binding in Lua now, but you don‚Äôt use much meta information for anything else. <br><br>  <u>Example</u> <br><pre> <code class="cpp hljs">luabind::<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>(state) [ luabind::class_&lt;Test&gt;(<span class="hljs-string"><span class="hljs-string">"Test"</span></span>) .def(<span class="hljs-string"><span class="hljs-string">"func"</span></span>, &amp;Test::func) ];</code> </pre><br><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> obj = Test() obj:func(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre><br><br>  <u>Benchmark</u> <br>  - Invoke - <b>1100ms</b> <br>  - FindMetaMethod + Invoke - <b>1580ms</b> <br><br><h4>  2) Camp </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/bb2/8ed/5d4/bb28ed5d48ecd6c2bbcaa22c487c4d30.jpg" alt="image" width="128"><br>  <a href="https://projects.tegesoft.com/pm/projects/camp">projects.tegesoft.com/pm/projects/camp</a> <br>  <a href="https://github.com/tegesoft/camp">github.com/tegesoft/camp</a> <br><br>  Created by a French company under the inspiration of luabind.  It looks quite cultural and worked out. <br>  The truth has not been noticeably updated for 4 years. <br><br>  <u>Example</u> <br><pre> <code class="cpp hljs">CAMP_TYPE(Test) camp::Class::declare&lt;Test&gt;(<span class="hljs-string"><span class="hljs-string">"Test"</span></span>) .function(<span class="hljs-string"><span class="hljs-string">"func"</span></span>, &amp;Test::func); Test obj; camp::Class t = camp::classByName(<span class="hljs-string"><span class="hljs-string">"Test"</span></span>); camp::Function m = t-&gt;function(<span class="hljs-string"><span class="hljs-string">"func"</span></span>); camp::Value v = m-&gt;call(obj, camp::Args(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = v.to&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;()</code> </pre><br><br>  <u>Benchmark</u> (crash failed, took results from another library site) <br>  - Invoke - <b>6889ms</b> &lt;- very sad <br><br><h4>  3) cpgf </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/829/804/798/829804798b337ad70929a716a43d4da6.jpg" alt="image"><br>  <a href="http://www.cpgf.org/document/index.html">www.cpgf.org/document/index.html</a> <br>  <a href="https://github.com/cpgf/cpgf">github.com/cpgf/cpgf</a> <br><br>  The main author is kind of Chinese.  It looks elaborated, but the interface is rather complicated and the code does not look concisely.  Many prefixes, additions in naming, various interfaces, rules of use (for example, how and when ownership is transferred).  A simple example is not visible, but if you look at the tutorial, it becomes very noticeable - <a href="">github.com/cpgf/cpgf/blob/develop/samples/tutorials/a01_reflect_to_global.cpp</a> <br>  At the same time, everything is reduced to a single interface, which of course pleases. <br><br>  A big plus is good documentation. <br><br>  From additional bells and whistles - serialization, ready-made solutions for binding in Lua / JavaScript / Python, tweening, its own event system. <br><br>  The bug fixes were back in December, that is, the project is not dead. <br><br>  <u>Example</u> <br><pre> <code class="cpp hljs">cpgf::GDefineMetaClass&lt;Test&gt; ::define(<span class="hljs-string"><span class="hljs-string">"Test"</span></span>) ._method(<span class="hljs-string"><span class="hljs-string">"func"</span></span>, &amp;CpgfTest::func); Test obj; cpgf::GMetaClass* t = cpgf::findMetaClass(<span class="hljs-string"><span class="hljs-string">"Test"</span></span>); cpgf::GMetaMethod* m = t-&gt;getMethod(<span class="hljs-string"><span class="hljs-string">"func"</span></span>); cpgf::GVariant v = m-&gt;invoke(&amp;obj, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = cpgf::fromVariant&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(v);</code> </pre><br><br>  <u>Benchmark</u> <br>  - Invoke - <b>1000ms</b> <br>  - FindMetaMethod + Invoke - <b>1135ms</b> &lt;- faster than luabind <br><br><h4>  4) RTTR </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/f3e/c4d/e03/f3ec4de03026059f14c90e8f3eb2feae.jpg" alt="image"><br>  <a href="http://www.axelmenzel.de/projects/coding/rttr">www.axelmenzel.de/projects/coding/rttr</a> <br><br>  The author, like, German.  Cheers - C ++ 11.  A beautiful syntax, modern features are actively developing, they are very happy.  In the near future, a new version should appear with significant refactoring. <br><br>  But so far, judging by the code, there is a lot of reason why the solution is quite straightforward, hence the much worse performance indicators. <br><br>  <u>Example</u> <br><pre> <code class="cpp hljs">RTTR_DECLARE_STANDARD_TYPE_VARIANTS(Test); RTTR_REGISTER { rttr::class_&lt;Test&gt;() .method(<span class="hljs-string"><span class="hljs-string">"func"</span></span>, &amp;Test::func); } Test obj; rttr::type t = type::get(<span class="hljs-string"><span class="hljs-string">"Test"</span></span>); rttr::method m = t.get_method(<span class="hljs-string"><span class="hljs-string">"func"</span></span>); rttr::variant v = m.invoke_variadic(obj, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> result = v.get_value&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;();</code> </pre><br><br>  <u>Benchmark</u> <br>  - Invoke - <b>1780ms</b> <br>  - FindMetaMethod + Invoke - <b>2290ms</b> <br><br><h4>  5) uMOF </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/98d/ae8/04c/98dae804c41e7f3b5dd06505178e15a5.png" alt="image"><br>  <a href="https://bitbucket.org/occash/umof">bitbucket.org/occash/umof</a> <br><br>  Russian-speaking author, actively answers all questions.  It was created, as I understood it, under the great impression of QT.  Hurray again - C ++ 11 (all these constexpr and other joys).  Actively developing.  In the near future, a new version should appear with significant refactoring and acceleration, it was tested. <br><br>  Conditional minus - to create meta-information you need to use macros, but this is due to the implementation features (explained later). <br><br>  <u>Example</u> <br><pre> <code class="cpp hljs">U_DECLARE_API(Test, METHODS); U_DECLARE_METHODS(Test) { U_METHOD(func) }; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Api* api = U_API(Test)::api(); Method m = api-&gt;method(api-&gt;indexOfMethod(<span class="hljs-string"><span class="hljs-string">"func(int,int)"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> result; m.invoke(&amp;obj, result, {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}));</code> </pre><br><br>  <u>Benchmark</u> <br>  - Invoke - <b>115ms</b> &lt;- magic (in the old version 420, which is also a cut above the others) <br>  - FindMetaMethod + Invoke - <b>1780ms</b> &lt;- not so good, but most likely and it will be optimized <br><br>  Invoke is almost 9 times faster than the best result from other libraries. <br><br>  The author himself wrote about this, comparing his decision with others.  Article with graphs and pictures for the still old version here - <a href="http://www.gamedev.net/page/resources/_/technical/general-programming/implementing-a-meta-system-in-c-r3905">www.gamedev.net/page/resources/_/technical/general-programming/implementing-a-meta-system-in-c-r3905</a> <br>  There is also a comparison of how which libraries affect the compile time and linking time of the project and how heavy the binaries are. <br><br><table border="1"><caption>  Overall result </caption><tbody><tr><td></td><td>  Luabind </td><td>  Camp </td><td>  cpgf </td><td>  RTTR </td><td>  uMOF </td></tr><tr><td>  Invoke </td><td>  1100 </td><td>  6889 </td><td>  1000 </td><td>  1780 </td><td>  115 </td></tr><tr><td>  FindMetaMethod + Invoke </td><td>  1580 </td><td>  x </td><td>  1135 </td><td>  2290 </td><td>  1780 </td></tr></tbody></table><br><br><h4>  <b>Conclusion</b> </h4><br>  The most modern, concise and lively libraries - uMOF, RTTR. <br>  The most rich in functionality - cpgf. <br>  Outstanding in performance: <br>  - uMOF (due to implementation features, an incredibly fast invoke and minimal overhead compilation and size of the binary); <br>  - cpgf (at the moment the fastest result for FindMetaMethod + Invoke, which is the most common use case). <br><br><h4>  Suggestions for discussion </h4><br>  1) What game developers should choose a library? <br>  cpgf solidly worked out and shows good results, but is this overhead important for invoke?  May prefer, for example, more modern RTTR, because  2290ms per 10,000,000 calls is 4366812 calls per second.  72780 calls per frame at 60 FPS.  That is, if about 700 calls are made on each frame, then at 60 FPS this will be less than 1% of the frame time. <br>  At the same time, uMOF shows outstanding results, which would allow it to be used with maximum intensity (as planned).  But it is not finished yet, there is a lack of some functionality. <br>  2) Maybe some library is missing?  You could add it to the review. <br>  3) What do you know from your experience about any of these libraries?  Here the review was superficial, maybe your experience speaks of some significant features in favor of or against some library. <br><br>  Thanks in advance for your comments. <br><br>  - UPDATE1: Comparing the performance of libraries with luabind is not entirely correct.  Since  calling a method in luabind means not only finding a meta-method, but also working with the lua virtual machine.  I will try to update the article as soon as there is more useful information on this topic. </div><p>Source: <a href="https://habr.com/ru/post/257071/">https://habr.com/ru/post/257071/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257057/index.html">Implementing the ws2812b protocol on ATmega</a></li>
<li><a href="../257063/index.html">How Aviasales Material Design Switched</a></li>
<li><a href="../257065/index.html">How we launched the weather probe in the Urals. Part 1</a></li>
<li><a href="../257067/index.html">Chips with subliminal operating supply voltages - a revolutionary approach to reducing current consumption</a></li>
<li><a href="../257069/index.html">Open accounting in the Ministry of Education and Science of Ukraine</a></li>
<li><a href="../257073/index.html">Mini API on Lumen</a></li>
<li><a href="../257077/index.html">Contests HackQuest and Hash Runner: warm up the brains before PHDays</a></li>
<li><a href="../257079/index.html">Checking FreeCAD source code and its ‚Äúbad‚Äù dependencies</a></li>
<li><a href="../257083/index.html">BUILD 2015 news: Visual Studio Code, Visual Studio 2015 RC, Team Foundation Server 2015 RC, Visual Studio 2013 Update 5</a></li>
<li><a href="../257087/index.html">Search, find and do not blow off</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>