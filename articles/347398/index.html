<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Application Security with Citrix NetScaler</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! It's no secret that a large number of threats have recently increased. Great attention has been paid to the topics of security and protection o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Application Security with Citrix NetScaler</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/hh/3k/ov/hh3kovek08tao2q3f5tm6q0v4q8.png"><br><br>  Hello!  It's no secret that a large number of threats have recently increased.  Great attention has been paid to the topics of security and protection of access to the resources used.  In this article we will analyze the product Citrix NetScaler VPX and its integrated platform Unified Gateway, and at the same time we will talk about what authentication methods are used today, what is multifactor authentication and much more.  Anyone interested please read. <br><a name="habracut"></a><br>  Let's start with what the lab environment consists of.  The figure shows the router, the segments of the private network, the external network and the hypervisor, on which the virtual machines are located and are enclosed in a rectangle.  In fact, all laboratory work will be focused on virtual machines.  And this scheme is presented in order to abstractly show how a laboratory stand is organized.  As you can see, the stand consists of 8 different virtual machines with different roles and configurations.  We will not consider how to install these operating systems and their configuration, since the article will instantly turn into a book, as well as materials on how to configure Apache or Exchange fully.  The focus will be on the configuration of NetScaler Unified Gateway, but as I write this article, I will comment on the key points of other virtual machines.  And the first thing that comes to mind is where to get the NetScaler Gateway virtual machine.  You can download it for free on the <a href="https://www.citrix.ru/downloads/netscaler-gateway/">official website of Citrix</a> . <br><br>  The only thing required is to register. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Immediately write out all the IP-addresses of virtual machines in the table: <br><br><img src="https://habrastorage.org/webt/do/-1/w5/do-1w5dcf0dtii0l_ahlzhiddq0.png"><br><br>  Since the domain controller is responsible for the training.lab zone, all further virtuals will be tied to it. <br><br>  The first thing to start with is setting up NetScaler Unified Gateway.  It is a kind of unified platform that provides specific content for a specific user.  That is, a user who is authenticated to Citrix Unified Gateway (hereinafter briefly UG) will be able to access only those resources that are assigned to him.  This greatly increases safety.  This platform works within the Citrix NetScaler product and comes with version 11 and higher.  We proceed to configure it.  Open the web browser and go to the address NetScaller VPX (or NS_VPX_1).  This is the address 192.168.10.50. <br><br><img src="https://habrastorage.org/webt/t3/7l/fy/t37lfy5bznkd38ty5ngnwfpmlf4.png"><br><br>  A window opens to enter a login and password, where we enter the data.  By default, the login and password is nsroot. <br><br>  After that the main page of NetScaler opens. <br><br><img src="https://habrastorage.org/webt/mp/0z/gy/mp0zgy7nfjjztwdbsyq4ez2ok34.png"><br><br>  There are several tabs here.  I note that you can manage NetScaler, both through the WEB-interface, and using the console interface.  We are interested in the <b>Configuration</b> tab, namely the bottom left window of available products. <br><br><img src="https://habrastorage.org/webt/zw/oi/on/zwoioni5fftnrnchcmoitfk3nbo.png"><br><br>  Select <b>Unified Gateway</b> .  After clicking, the settings wizard opens. <br><br><img src="https://habrastorage.org/webt/mb/nw/gb/mbnwgb20zaz9ig61v3qatyr4ayw.png"><br><br>  He warns that before you begin, you need to have a public IP address for the UG.  We will not let it out, so there will be enough private IP-address.  In addition, you need to have a root certificate, authentication accounts and applications that these users will log into.  All this is available and will be further configured.  Click <b>Get Started</b> . <br><br><img src="https://habrastorage.org/webt/0w/v-/wn/0wv-wn7xa7isrgv9kr0t4v_uze8.png"><br><br>  Another window appears, illustrating the functionality of the UG.  Click <b>Continue</b> . <br><br>  Further, the configuration will consist of 5 configuration steps: Virtual Server, Server Certificate, Authentication, Portal Theme and Applications. <br><br>  The first thing that is proposed to configure is Virtual Server.  A small digression - here a virtual server is simply a set of information describing a certain service with which Citrix NetScaler will interact.  Most often it is the ‚Äúname‚Äù, IP address and port number. <br><br><img src="https://habrastorage.org/webt/mk/ku/2z/mkku2zenmq9uxrpkqgjh5awn3qy.png"><br><br>  We call it <b>ug1</b> and <b>enter the</b> IP address: 192.168.10.90.  If the network uses IPv6 addresses, then you can put a daw next to it and register it.  Port 443 is registered by default.  Click <b>Continue</b> . <br><br><img src="https://habrastorage.org/webt/bf/l6/yk/bfl6ykzxv_b6gzox7be2i9l62xo.png"><br><br>  Select an existing certificate server and click <b>Continue</b> . <br><br><img src="https://habrastorage.org/webt/hk/zg/xo/hkzgxok3rg9kwdrsb1epggr2e0w.png"><br><br>  The authentication settings window opens.  We select the main authentication method through <b>Active Directory / LDAP</b> and the existing server <b>training.lab_pol</b> .  Click <b>Continue</b> . <br><br><img src="https://habrastorage.org/webt/l9/ml/6s/l9ml6scqgkayuoak_j-z87txj8y.png"><br><br>  Select the theme that will be applied to the UG.  Here the choice can be any.  I chose X1.  Click <b>Continue</b> . <br><br><img src="https://habrastorage.org/webt/1h/6w/j2/1h6wj2h8klrqewum4mwzxkjjjec.png"><br><br>  And the last window opens to customize the application.  So far, we will not configure applications and click on <b>Done</b> . <br><br>  Now UG is raised and you can go to it. <br><br>  Open the private window of the web browser so that it does not cache the page. <br><br><img src="https://habrastorage.org/webt/fe/gj/i8/fegji8umbnu1eoihjcu-uuo0xu0.png"><br><br>  And we type the address 192.168.10.90. <br><br><img src="https://habrastorage.org/webt/qh/su/mi/qhsumiqwwccl7jzgv3w3jqnanvw.png"><br><br>  The Unified Gateway logon window opens.  I use user1 account with password Citrix123. <br><br><img src="https://habrastorage.org/webt/s4/88/gi/s488gii92zudmg_cw37-g6uriiq.png"><br><br>  Choose <b>Clientless Access</b> . <br><br><img src="https://habrastorage.org/webt/p1/xv/do/p1xvdoqftyuhdq8mkt8696bvqv8.png"><br><br>  We fall on the personal page of this user, where his sites, applications are displayed.  It is currently empty.  Let us turn to the addition of WEB-applications. <br><br>  Today it is difficult to imagine a company that does not have its own services and resources.  For example, mail, general access to a platform and so on.  And it happens that access to these resources needs to be organized not only within the company, but also abroad.  At the moment, to organize remote access to the resources of the company is not difficult.  However, it is very often used such an approach that, if necessary, remote access to any service, access is granted to the whole machine (virtual or physical).  The disadvantages of this method are many.  Starting from the load and ending with security.  And why does the user need access to the whole machine when he needs to check his mail or quickly reply to an email.  In addition to this, it is necessary to go through several stages of authentication in the form of establishing a connection, logging into the required computer, opening the necessary resource and entering a login with a password there.  This significantly increases the time spent and complicates the access process. <br><br>  To simplify authentication, the SSO mechanism was developed (from the Single Sign ‚Äì On).  This technology allows the user to use the applications available to him and navigate between them without requiring re-authentication.  That is, he will not need to enter the same login with a password on each opened resource.  SSO works with various authentication methods, but in this article we will consider only a few: Form ‚Äì Based, NTLM, LDAP and RADIUS. <br><br>  Let's start with the most popular.  This is form-based authentication.  Briefly about her work: <br><br><ol><li>  The user requests a page from the web server. </li><li>  The web server sees that it is an unknown user who failed to authenticate and returns him a web page with login and password input forms. </li><li>  Having received this page, the user fills out the required forms and sends back to the web server. </li><li>  Having received this data, the web server checks for the presence of such a user and, if the account is authenticated, sends the page that was originally requested to it. </li></ol><br>  Virtually every modern web server supports this type of authentication. <br>  On the pre-created virtual machine named Apache 1, the SugarCRM system is running.  It has great functionality and capabilities, such as a task scheduler, a list of employees, a list of contacts, information on various transactions and much more.  For those who are interested in exploring this product in more detail, they can follow this <a href="https://ru.wikipedia.org/wiki/SugarCRM">link</a> .  Our task is to integrate this service into the Unified Gateway and configure SSO. <br><br><img src="https://habrastorage.org/webt/th/ay/k_/thayk_kkblt6bccjuuprjfyk4wu.png"><br><br>  Open NetScaler and go to Unified Gateway. <br><br><img src="https://habrastorage.org/webt/wx/ry/mg/wxrymgjwqgj7gxjkg4bp9xauins.png"><br><br>  The UG panel opens, with various graphs and charts showing real-time performance.  Click on ug1 and get into its settings. <br><br><img src="https://habrastorage.org/webt/n7/q4/ks/n7q4ksnxvm0lvyehyvvzkcrotm8.png"><br><br>  Here are the very 5 settings options that we previously configured.  Select <b>Applications</b> . <br><br><img src="https://habrastorage.org/webt/_e/lo/us/_elouszjug8s7rlpxptzb0xtilg.png"><br><br><img src="https://habrastorage.org/webt/w7/iq/ij/w7iqijtxe2_bcjqgdkr0tzgmzeu.png"><br><br>  We select <b>Web Application</b> . <br><br><img src="https://habrastorage.org/webt/jw/jy/kn/jwjykn0rnxabcw-u7q2m2wb85oq.png"><br><br>  We get to the WEB-application configuration page.  In the name field, we write <b>SugarCRM</b> , in the Application Type field, select Intranet Application from the drop-down list and put a check mark on the checkbox that says ‚Äú <b>Make this application accessible through the Unified Gateway URL?</b>  ".  That is, make this application available via the Unified Gateway URL. <br><br><img src="https://habrastorage.org/webt/dt/sj/la/dtsjlagn6ie3arnjmugrkbpro1g.png"><br><br>  After the checkbox is set, a field for entering URL parameters for SugarCRM will open.  In the first field we write the address /sugarcrm/index.php.  That is the address of its main page.  The parameter of the second field will be filled automatically.  Next you need to select the server on which this service is running.  Click on the button with "+". <br><br><img src="https://habrastorage.org/webt/cm/7o/dx/cm7odxhmjrezjuzlvlnara9kax8.png"><br><br>  Before us opens a new configuration window.  In the Name field we write <b>apache.training.lab</b> .  From the drop-down list, select the <b>HTTP protocol</b> .  In the next field we indicate our <b>ug1.training.lab</b> .  Register the IP address of the server running SugarCRM (i.e. Apache 1) and click ‚Äú+‚Äù to add the address to the bottom field.  Click <b>OK</b> . <br><br><img src="https://habrastorage.org/webt/7s/t2/vh/7st2vh940xgbe7jyilzb0mnjpds.png"><br><br>  A summary window opens where you can check the configured settings.  That's right, click <b>Done</b> . <br><br><img src="https://habrastorage.org/webt/oc/fv/h2/ocfvh2b5siovkfckvido4groqa0.png"><br><br>  We return to the WEB application setup window and see that the virtual server has been added.  Click <b>Continue</b> . <br><br><img src="https://habrastorage.org/webt/x2/8l/f3/x28lf3xcvkvgrk7kutaaql9thl0.png"><br><br>  A summary window appears with the configured WEB application. <br><br><img src="https://habrastorage.org/webt/ai/yi/lf/aiyilfo-bacf8awjpact_qsx1wq.png"><br><br>  Make sure the application appears in the Unified Gateway list. <br><br><img src="https://habrastorage.org/webt/x4/8b/vz/x48bvznrmvtebc4uh9k58vm9n5g.png"><img src="https://habrastorage.org/webt/bt/fv/ge/btfvgeepmbyye5rdcrapenpbkbu.png"><br><br>  Click <b>Continue</b> and <b>Done</b> .  Application created.  Check its availability by going to the UG address. <br><br>  Go to the address 192.168.10.90. <br><br><img src="https://habrastorage.org/webt/qh/su/mi/qhsumiqwwccl7jzgv3w3jqnanvw.png"><br><br>  Enter the same credentials (user1 / Citrix123). <br><br><img src="https://habrastorage.org/webt/s4/88/gi/s488gii92zudmg_cw37-g6uriiq.png"><br><br>  Choose <b>Clientless Access</b> . <br><br><img src="https://habrastorage.org/webt/jf/ay/mo/jfaymogcn7exxamr-_pby2ild6g.png"><br><br>  And in the Enterprise WEB Sites window we see the appeared SugarCRM.  In the current configuration, if you click on it, a page with a login and password request will open, since we have not yet configured SSO. <br><br>  In order to understand how Form-Based authentication works, we delve a little into the mechanism of its operation. <br><br><img src="https://habrastorage.org/webt/0b/vz/uj/0bvzuj04spa6-sugrqnbcd74e8e.png"><br><br>  Open a new tab and go to the SugarCRM page located on the Apache 1 web server (not the Unified Gateway address).  To understand how the client communicates with the server, you need to look at its source code.  You can switch to the Page Source view using the keyboard shortcut <b>Ctrl + U</b> (the same for Firefox, Chrome and IE). <br><br><img src="https://habrastorage.org/webt/_r/vn/rq/_rvnrq9kkzbus4spmxcxxrezdo8.png"><br><br>  A page with a lot of text opens.  We need to find the form that is responsible for the user login.  Press the key combination <b>Ctrl + F</b> to open the search panel and enter <b>"User Name"</b> . <br><br><img src="https://habrastorage.org/webt/ro/mq/oi/romqoieoohd_ex859tdq76hkwtk.png"><br><br><img src="https://habrastorage.org/webt/ja/3s/xi/ja3sxiz3tdkxqziscqnbxyh3r-0.png"><br><br>  And we see that he really found such a line and highlighted it in green.  Below you can see the line <b>"Password"</b> .  These are the forms that are responsible for the login and password.  In fact, these forms may be called differently in different applications. <br><br>  In SugarCRM, they are called <b>‚Äúuser_name‚Äù</b> and <b>‚Äúuser_password‚Äù</b> . <br><br><img src="https://habrastorage.org/webt/ue/po/tn/uepotndd_uwzviwojwb711fqleo.png"><br><br>  Let us remember this information and return to it a little later. <br><br><img src="https://habrastorage.org/webt/ad/qn/4j/adqn4js2otnmgw9izinl-vw8fnc.png"><br><br>  We return to the login page with a password and before entering something, open the ‚ÄúLive HTTP headers‚Äù utility. <br><br>  After that, you can enter a login with a password (user1 / Citrix123).  Click <b>Log In</b> and go back to ‚ÄúLive HTTP headers‚Äù. <br><br><img src="https://habrastorage.org/webt/oo/eo/m_/ooeom_b_hodml6xiknydzmz-br0.png"><br><br>  We see that the application sends many different parameters in a POST message to the POST address /sugarcrm/index.php using HTTP protocol version 1.1.  This information is very useful when we create a Form-based SSO profile. <br><br><img src="https://habrastorage.org/webt/rm/jt/fm/rmjtfmxeteianmuzo-ay9x6o2qe.png"><br><br>  Copy this line and save in notepad. <br><br>  Next, you need to see what is returned to the application after the request is sent. <br><br><img src="https://habrastorage.org/webt/qz/7l/pf/qz7lpf5za4fxcoypv0urkihgda0.png"><br><br>  We scroll to the line with the response code 302. <br><br>  We are interested in the Location header with its parameter.  This line indicates that the client is successfully authenticated and will be redirected to the main page.  This line is also copied. <br>  Now configure NetScaler. <br><br><img src="https://habrastorage.org/webt/wg/5m/te/wg5mtenqasf68otkhdesnfdruau.png"><br><br>  Being on the main page, go to <b>Security -&gt; AAA - Application Traffic -&gt; Policies -&gt; Traffic</b> .  Go to the tab <b>Form SSO Profiles</b> and click the <b>Add</b> button. <br><br><img src="https://habrastorage.org/webt/x8/7x/l8/x87xl8lpox2sk1q47hnzssix0c4.png"><br><br>  The SSO profile settings window opens: <br><br>  1) We write the name of the profile - sugarcrm_SSO. <br>  2) Register the URL for which this profile is created. <br>  3) The name of the form containing the login is registered. <br>  4) Register the name of the form containing the password. <br>  5) Register an expression or operation for this profile.  This is what was copied. <br>  6) Response Size set 16192. This is the size of the return. <br>  7) Extraction choose Dynamic from the drop-down list. <br>  8) Submit Method choose POST.  That is, send a POST message. <br><br>  Click <b>Create</b> . <br><br><img src="https://habrastorage.org/webt/kw/lw/aj/kwlwajqm1yfzqibcz65gux-vw3w.png"><br><br>  Next, open the <b>Traffic Profiles</b> tab and click the <b>Add</b> button. <br><br><img src="https://habrastorage.org/webt/x6/lk/na/x6lkna5hy92hyctbngozzumhbcc.png"><br><br>  1) Set the name of the profile. <br>  2) Configure the timeout (in this case, 1 minute). <br>  3) Enable SSO for this profile. <br>  4) Select the previously created SSO profile. <br>  And click the <b>Create</b> button. <br><br>  Go to the <b>Traffic Policies</b> tab and click the <b>Add</b> button. <br><br><img src="https://habrastorage.org/webt/y6/jf/zu/y6jfzu8mvnlk7uu2oytlrnd1l6m.png"><br><br>  Here we create the conditions under which form-based SSO will be performed. <br><br>  1) Give the name sugarcrm_SSO_pol. <br>  2) Select the profile created earlier from the drop-down list. <br>  3) Choose an expression for which, this policy will work out.  HTTP.REQ.URL.PATH_AND_QUERY.EQ (" <b><i>/sugarcrm/index.php</i></b> ? Action = Login &amp; module = Users").  In this expression, we add the address that was copied from the Live HTTP header. <br><br>  Click <b>Create</b> .  Politicians are created and now they need to be applied. <br><br><img src="https://habrastorage.org/webt/7e/zt/rm/7eztrmyflagwkll8ffc_ditdpfk.png"><br><br>  Go to the <b>Traffic Management -&gt; Load Balancing -&gt; Virtual Servers</b> tab, select the running <b>apache.training.lab</b> and click the <b>Edit</b> button. <br><br>  The usual virtual server configuration window will open.  We need the right column <b>Advanced Settings</b> . <br><br><img src="https://habrastorage.org/webt/fv/49/wu/fv49wu78ybpxlczphc2rtvp6f5a.png"><br><br>  Select <b>Policies</b> . <br><br><img src="https://habrastorage.org/webt/kw/i3/uv/kwi3uvqfurw3fhqeazyyfidjtek.png"><br><br>  In the window that opens, press the "+" button. <br><br><img src="https://habrastorage.org/webt/p1/lk/sy/p1lksy68egco0crbkzhre0611om.png"><br><br>  We select the <b>Traffic</b> policy and the traffic type <b>Request</b> .  Click <b>Continue</b> . <br><br><img src="https://habrastorage.org/webt/qt/h7/ft/qth7ftnjrbsvpls3fgn0g8rzjhm.png"><br><br>  The Policy Binding window opens, where you need to select a policy.  Open the <b>Select Policy</b> . <br><br><img src="https://habrastorage.org/webt/i-/mn/jy/i-mnjyhw_krbx9mvkgzvw-rkt4y.png"><br><br>  Select the created sugarcrm_SSO_pol and press the <b>Select</b> button. <br><br><img src="https://habrastorage.org/webt/r5/4b/gx/r54bgxolbn_bxo94zdqoabxqmvw.png"><img src="https://habrastorage.org/webt/4w/3m/cx/4w3mcxml6rud1z0lejclw8js_0a.png"><br><br>  Make sure the policy is selected.  Press the <b>Bind</b> and <b>Done</b> buttons. <br>  The policy is applied, which means the SSO mechanism should work.  Check it out. <br><br><img src="https://habrastorage.org/webt/bi/q1/xk/biq1xkqkuvadu5blwb5nxfgkfri.png"><br><br>  Open 192.168.10.90 (I made a tab). <br><br><img src="https://habrastorage.org/webt/qh/su/mi/qhsumiqwwccl7jzgv3w3jqnanvw.png"><br><br>  A familiar window opens.  We enter there all the same account. <br><br><img src="https://habrastorage.org/webt/s4/88/gi/s488gii92zudmg_cw37-g6uriiq.png"><br><br>  Choose <b>Clientless Access</b> . <br><br><img src="https://habrastorage.org/webt/jf/ay/mo/jfaymogcn7exxamr-_pby2ild6g.png"><br><br>  Click on the SugarCRM label. <br><br><img src="https://habrastorage.org/webt/zc/5o/k_/zc5ok_74hn46v0y9xd9nkmyacly.png"><br><br>  And we automatically get into the SugarCRM system, bypassing the additional entry of the login with a password.  As you can see, this is much more convenient than typing the same logins with a password for each opened application. <br><br>  The following authentication method that we will consider is NTLM (NT Lan Manger).  A protocol developed by Microsoft for its operating systems.  The latest version is called NTLMv2 and is used up to Windows 10. The authentication method is slightly different from Form-Based, but also quite simple. <br><br>  1) The client sends a request to the server, where it reports which versions of NTLM it supports. <br>  2) The server, upon receiving a request, selects the most secure protocol and sends a response to the client. <br>  3) The client, having received the answer, understands which dialect (or protocol version) to communicate with the server and sends the request <b>NEGOTIATE_MESSAGE</b> .  That is the establishment of a neighborhood. <br>  4) The server, upon receiving this message, sends it to <b>CHALLENGE_MESSAGE</b> .  This is a random 8-byte sequence. <br>  5) The client receives this sequence and, with the help of its password, encrypts it and then sends the <b>AUTHENTICATE_MESSAGE</b> response to the <b>server</b> . <br>  6) The server, having received the answer, performs the same operation of encrypting the sequence, and then compares the results.  Based on these results, it allows or denies access. <br><br>  One of the famous web applications used by the NTLM protocol is Microsoft Sharepoint.  This virtual machine has already been created.  You just need to add it to NetScaler. <br><br><img src="https://habrastorage.org/webt/h7/gp/hw/h7gphwlakccbc0nxees0agrgytk.png"><br><br>  On the NetScaler main page, go to <b>Traffic Management -&gt; Load Balancing -&gt; Servers</b> and click the <b>Add</b> button. <br><br><img src="https://habrastorage.org/webt/bi/ib/nl/biibnl294h52c9qu_abc_giq1_0.png"><br><br>  We write the server name srv_sharepoint and the IP address: 192.168.10.25 (virtual machine address).  Click <b>Create</b> . <br><br><img src="https://habrastorage.org/webt/rl/bg/2l/rlbg2lizd11ydqraz8gfk4beio0.png"><br><br>  Next, go to the <b>Services</b> tab and click the <b>Add</b> button. <br><br><img src="https://habrastorage.org/webt/0h/-u/pb/0h-upb5nwgmikyp3edglvbygexm.png"><br><br>  The service settings window opens.  We write the name svc_sharepoint.  Select <b>Existing Server</b> (that is, an existing one) and select the previously added srv_sharepoint.  That is, we choose the HTTP service running on port 80 of the server located at 192.168.10.25.  Click <b>OK</b> . <br><br><img src="https://habrastorage.org/webt/e9/gi/rr/e9girrwfmkk9_iakxvm7k1h8jxg.png"><br><br>  The next step is to create a load-balancing virtual server for Sharepoint.  Go to the <b>Virtual Servers</b> tab and click the <b>Add</b> button. <br><br><img src="https://habrastorage.org/webt/dh/wf/s2/dhwfs2qsquzu3jqnfwffgorhg08.png"><br><br>  The settings window opens.  In the name field we write sharepoint.training.lab, HTTP protocol and IP address: 192.168.10.110.  After that click <b>OK</b> . <br><br><img src="https://habrastorage.org/webt/6t/6u/he/6t6uhefvjecpxel0hrm5zwpluhg.png"><br><br>  In the next window, a message appears indicating that balancing is not configured.  Click on the first line and get into the service settings. <br><br><img src="https://habrastorage.org/webt/ni/pw/zo/nipwzoav_2f4wgcx4l0jgt-rjns.png"><br><br>  Click on the service selection window. <br><br><img src="https://habrastorage.org/webt/da/sj/nz/dasjnziyppukhdm8g9j0nlq1uqm.png"><br><br>  A window opens with a list of available services.  Select svc_sharepoint and press the <b>Select</b> button. <br><br><img src="https://habrastorage.org/webt/yt/ux/0g/ytux0gxzhrs50htedxdowwfrb9s.png"><br><br>  After that, go back to the previous window and press the <b>Bind</b> button. <br><br><img src="https://habrastorage.org/webt/zq/mz/vb/zqmzvbvjgaqrz9gdo5vcbxtdoze.png"><br><br>  After this, a notification window will appear indicating that there is 1 virtual server of balancing. <br><br>  The service is set up and try to enter it. <br><br><img src="https://habrastorage.org/webt/wu/qj/xs/wuqjxsodzwsrkizluafpdicvjtu.png"><br><br>  Open the browser and go to the domain name. <br><br><img src="https://habrastorage.org/webt/0s/zn/cd/0szncdnal6pnp4tztca4twmjoou.png"><br><br>  It will immediately display an authentication window.  And if you enter a password, we get to the main page.  Note that now we go directly to him.  However, we need to enter it through Unified Gateway. <br><br>  Up to now we have configured it on NetScaler.  Add it to the Unified Gateway. <br><br><img src="https://habrastorage.org/webt/cz/b2/kk/czb2kkwtvxg3t61vgcbdrqp4jia.png"><br><br>  Open UG. <br><br><img src="https://habrastorage.org/webt/uh/ux/5x/uhux5xun2velitqqi-u-p-rxuva.png"><br><br>  Choose a customized ug1. <br><br><img src="https://habrastorage.org/webt/he/su/d_/hesud_2f0drm2izvxuzlepttvus.png"><br><br>  And in the application window, click on the button with a pencil (which means edit). <br><br><img src="https://habrastorage.org/webt/cy/oe/vw/cyoevwq3vnvgfwcfpxyqefvjlbo.png"><br><br>  After that, the pencil is replaced by "+" click on it. <br><br><img src="https://habrastorage.org/webt/x5/tf/qi/x5tfqiszgifpo3u67ojmhdfkfcc.png"><br><br>  We select WEB Application. <br><br><img src="https://habrastorage.org/webt/kd/fa/po/kdfapombf5jkkghu-_isr9xzjjk.png"><br><br>  Give the name to the application and define the type as Clientless Access. <br><br><img src="https://habrastorage.org/webt/o7/xk/vq/o7xkvqxyixklijbddg38jydocse.png"><br><br>  Register the URL to this service and click <b>Continue</b> . <br><br><img src="https://habrastorage.org/webt/xj/qu/yw/xjquyw643xrnuzpe4cpm3u5nlcg.png"><br><br>  A summary window appears.  Click <b>Done</b> . <br><br><img src="https://habrastorage.org/webt/_k/pq/yw/_kpqywlemhfncnfoqkgvj1ssdri.png"><img src="https://habrastorage.org/webt/w5/2k/da/w52kdafpi3obeii7ybnlnxgv55k.png"><br><br>  After that, we see the SharePoint application in the list next to the previously created SugarCRM.  Check its availability by logging in under the user account. <br><br><img src="https://habrastorage.org/webt/bi/q1/xk/biq1xkqkuvadu5blwb5nxfgkfri.png"><br><br>  Open UG. <br><br><img src="https://habrastorage.org/webt/qh/su/mi/qhsumiqwwccl7jzgv3w3jqnanvw.png"><br><br>  Enter your credentials. <br><br><img src="https://habrastorage.org/webt/s4/88/gi/s488gii92zudmg_cw37-g6uriiq.png"><br><br>  Choose <b>Clientless Access</b> . <br><br><img src="https://habrastorage.org/webt/_o/c8/ws/_oc8ws5ejp6f4lycocbuj2kb4xo.png"><br><br>  We see that the application really appeared.  If you click on it, it will immediately display the authentication window. <br><br><img src="https://habrastorage.org/webt/kf/qu/4z/kfqu4zuxlp93bahf21m4k2csnfi.png"><br><br>  This does not suit us, and we return to the SSO settings for the NTLMv2 protocol. <br><br><img src="https://habrastorage.org/webt/2q/5b/jd/2q5bjdoopeadvrbnhegbsnqhi0c.png"><br><br>  Go back to NetScaler.  Go to <b>NetScaler Gateway -&gt; Policies -&gt; Session</b> .  Next to the <b>Session Profiles</b> tab and click the <b>Add</b> button. <br><br><img src="https://habrastorage.org/webt/9u/lj/9f/9ulj9fp3aouxxuxs69jjquhb--s.png"><br><br>  Create a new profile named SSO_NTLM_Sharepoint. <br><br><img src="https://habrastorage.org/webt/qh/dp/jo/qhdpjoichrfwjbayrj5nvhyuxiq.png"><br><br>  Select the <b>Client Experience</b> tab <b>.</b>  From the drop-down list of <b>Clientless Access,</b> select <b>Allow</b> , put a check on SSO for web applications. <br><br><img src="https://habrastorage.org/webt/fv/d_/vb/fvd_vbh_jp95wf2bi2xeivk5gek.png"><br><br>  Go to the Security tab and select the standard action for authorization, as Allow (that is, allow).  At the end click the button <b>Create</b> . <br><br>  Now you need to create a policy for the session. <br><br><img src="https://habrastorage.org/webt/da/ke/gi/dakegirfmj2bb918jl_uwtmz3-u.png"><br><br>  To do this, go to the <b>Session Policies</b> tab and click the <b>Add</b> button. <br><br><img src="https://habrastorage.org/webt/ix/k4/aj/ixk4ajqsy3gwarsdqieho75k_ge.png"><br><br>  Give the policy name SSO_NTLM_sharepoint.  From the drop-down list, select the profile created earlier.  And write the expression ns_true. <br><br>  Now you need to bind the created policy to Unified Gateway. <br><br><img src="https://habrastorage.org/webt/up/s_/n7/ups_n7jhii7hrptnr2nvlyxsncy.png"><br><br>  Go to <b>NetScaler Gateway -&gt; Virtual Servers</b> and edit the existing UG_VPN_ug1. <br><br><img src="https://habrastorage.org/webt/vr/cf/kx/vrcfkxmq_vawcaodva8mfjczgsu.png"><br><br>  Click on the "+". <br><br><img src="https://habrastorage.org/webt/nw/hv/oa/nwhvoa0nrlwqy0akpk7i_czke0i.png"><br><br>  We define a new policy as Session and the Request type (i.e. requests). <br><br><img src="https://habrastorage.org/webt/o4/vx/jw/o4vxjw0_jbpakmb0qiqijbfcv18.png"><br><br>  Click the <b>Add Binding</b> button to bind the <b>Session Policy</b> . <br><br><img src="https://habrastorage.org/webt/1l/mu/1v/1lmu1vvj_wrzyrgmbxwdzh04vqy.png"><br><br>  The <b>Policy Binding</b> window opens.  Click on the drop-down list. <br><br><img src="https://habrastorage.org/webt/9n/cq/ay/9ncqayacwoir6sceygja20yuc0a.png"><br><br>  And select the previously created SSO_NTLM_sharepoint. <br><br><img src="https://habrastorage.org/webt/mn/cb/-i/mncb-i2i1sl5umhxv_qt3ypask4.png"><img src="https://habrastorage.org/webt/4y/wk/_l/4ywk_lbpnle5erarz1m9twhtbdg.png"><br><br>  After that, we bind them by clicking the Bind button and close the window. <br><br><img src="https://habrastorage.org/webt/l0/kj/c2/l0kjc2fph7vpaffvvplovzirgbw.png"><br><br>  After that we see that now there are two Session Policies. <br><br>  Now let's try to log in as user. <br><br><img src="https://habrastorage.org/webt/bi/q1/xk/biq1xkqkuvadu5blwb5nxfgkfri.png"><br><br><img src="https://habrastorage.org/webt/qh/su/mi/qhsumiqwwccl7jzgv3w3jqnanvw.png"><br><br><img src="https://habrastorage.org/webt/s4/88/gi/s488gii92zudmg_cw37-g6uriiq.png"><br><br><img src="https://habrastorage.org/webt/u_/gk/xk/u_gkxkaedvcmo3y1lsa6idfqqbc.png"><br><br>  Click on the SharePoint shortcut. <br><br><img src="https://habrastorage.org/webt/eg/jp/w4/egjpw47dfhmqderuwn0nc7ravyc.png"><br><br>  And automatically get to the page with SharePoint.  Note that the address bar is registered ug1.training.lab.  Thus, Unified Gateway prokinul to the application, without requesting to re-login with a password.  for authentication.  Thus, we configured SSO to work with the NTLMv2 protocol. <br><br>  The next service we configure is Outlook Web Access or OWA.  One of the most popular corporate web clients to access the mail server.  Therefore, be sure to add it.  It is configured a little longer than the previous ones, but also quite simple. <br>  To begin, let's add a virtual server with Exchange to which the OWA application will link. <br><br><img src="https://habrastorage.org/webt/hu/rm/d_/hurmd_pv1xuyq5-mkvaa_cbrp_q.png"><br><br>  Go to <b>Traffic Management -&gt; Load Balancing -&gt; Servers</b> and click the <b>Add</b> button. <br><br><img src="https://habrastorage.org/webt/ol/mw/ix/olmwixchtagmy4dcz6xnips4giw.png"><br><br>  The server setup window opens.  In the Name field we write srv_exchange and below we set the server‚Äôs IP address: 192.168.10.20 and click <b>Create</b> . <br><br>  Next, you need to add a service that will respond to the state of the Exchange server.  It is necessary for the work of the OWA-application. <br><br><img src="https://habrastorage.org/webt/7z/de/7w/7zde7w5bmnf3mpp5e8bsg2zzqhu.png"><br><br>  Go to <b>Traffic Management -&gt; Load Balancing -&gt; Monitors</b> and click the <b>Add</b> button. <br><br><img src="https://habrastorage.org/webt/y3/e_/4w/y3e_4w_xpjclahdkdvkyyadrank.png"><br><br>  We get into the settings window, where we set the name and select HTTP protocol from the drop-down list. <br><br>  Next, scroll down <br><br><img src="https://habrastorage.org/webt/e8/6n/zf/e86nzflazggrphz65ophalwqj1e.png"><br><br>  We put a check near <b>Secure</b> , but <u>do not click</u> <b>Create</b> ! <br><br><img src="https://habrastorage.org/webt/s_/th/lp/s_thlpi1lsmgbwi0s-pbcw30g8k.png"><br><br>  Go back up and go to the <b>Special Parameters</b> tab.  Here we write the HTTP request ‚ÄúGET /owa/healthcheck.htm‚Äù.  And below we leave the code 200. That is, when requesting this page, the answer should come with code 200 (that is, OK).  Click <b>Create</b> . <br>  Next you need to create a load-balancing service for the Exchange server. <br><br><img src="https://habrastorage.org/webt/vv/ik/od/vvikodgpqry9gdeltdmi72gan6i.png"><br><br>  Go to <b>Traffic Management -&gt; Load Balancing -&gt; Services</b> and click the <b>Add</b> button. <br><br><img src="https://habrastorage.org/webt/1k/r9/r5/1kr9r5mzeuebqkn2eu9wtyfxdq0.png"><br><br>  Register the name of the service.  Select an existing server ( <b>Existing Server</b> ) and from the drop-down lists, select the previously added server and SSL protocol.  Click <b>OK</b> . <br><br><img src="https://habrastorage.org/webt/wq/m4/bu/wqm4bu_wi06yk47-y82ao15ruey.png"><br><br>  On the Monitors tab, we see that one service is already running.  Click on it. <br><br><img src="https://habrastorage.org/webt/ql/zc/ml/qlzcmlyk76bytaxjkqrjcvabxr4.png"><br><br>  We see that the tcp-default service is already running.  Add another by clicking the <b>Add Binding</b> button. <br><br><img src="https://habrastorage.org/webt/fv/4p/fn/fv4pfnk9ue9nfmzkvhc2gjxw36a.png"><br><br>  The settings window opens.  Click the <b>Select Monitor</b> tab. <br><br><img src="https://habrastorage.org/webt/aw/lw/uv/awlwuvcubjgy4hlfeb7o31xqjg0.png"><br><br>  Select the owa_mon created earlier and click the <b>Select</b> button. <br><br><img src="https://habrastorage.org/webt/tx/9v/b9/tx9vb9pbaaqpa9wzyo8cnm3fc74.png"><br><br>  <b>Bind</b> button <b>Bind</b> . <br><br><img src="https://habrastorage.org/webt/vh/nk/7l/vhnk7lydkgfcgyeodxcpvlixyn0.png"><br><br>  Make sure the service is tied and click <b>Close</b> . <br><br>  Now you need to create a virtual balancing server for the Exchange server. <br><br><img src="https://habrastorage.org/webt/xa/o7/_7/xao7_7onvcgpsedbio0zfebcw_y.png"><br><br>  Go to <b>Traffic Management -&gt; Load Balancing -&gt; Virtual Servers</b> and click the <b>Add</b> button. <br><br><img src="https://habrastorage.org/webt/lx/kv/jn/lxkvjneggzwlqfpnn6tjd08tqbc.png"><br><br>  We fall into the settings window.  Register the server name, select the SSL protocol and IP address from the drop-down list: 192.168.10.140.  Click <b>OK</b> . <br><br><img src="https://habrastorage.org/webt/w-/0m/ne/w-0mne9ip21mlfazwmyq-eb_ids.png"><br><br>  On the <b>Services and Service Groups</b> tab, we see that there is no binding to any service.  Click on this line. <br><br><img src="https://habrastorage.org/webt/6l/nr/pe/6lnrpenza2l6ten2mvelhwkjw-s.png"><br><br>  The service binding window opens.  Click on <b>Select Service</b> . <br><br><img src="https://habrastorage.org/webt/yq/wh/as/yqwhastppflugj0tn_uvs-rhsia.png"><br><br>  Choose svc_exchange. <br><br><img src="https://habrastorage.org/webt/ko/m8/ig/kom8iggw1sjk2k2yl1vytvffbiy.png"><br><br>  Click <b>Bind</b> . <br><br><img src="https://habrastorage.org/webt/q8/qk/2w/q8qk2w6oalnutbv758rj3p0wgtk.png"><br><br>  And <b>Continue</b> . <br><br>  Now you need to add an SSL certificate to the virtual server. <br><br><img src="https://habrastorage.org/webt/r5/rz/_i/r5rz_i1aw8_lr2i6jo0qa0opnik.png"><br><br>  Go to the <b>Certificates</b> tab and click on the line " <b>No Server Certificate</b> ". <br><br><img src="https://habrastorage.org/webt/ap/4f/__/ap4f__srcnsulq96bq0u6vga7gc.png"><br><br>  Click on <b>Select Server Certificate</b> . <br><br><img src="https://habrastorage.org/webt/py/ct/9a/pyct9a2qzgygfoiwa_unafo2xkm.png"><br><br>  Choose a previously existing wildcard.training.lab. <br><br><img src="https://habrastorage.org/webt/gu/j1/h_/guj1h_vevdo8os2coutpnoaj0m0.png"><br><br>  Make sure the certificate is selected and click the <b>Bind</b> button. <br><br><img src="https://habrastorage.org/webt/ht/s9/ry/hts9rynxvjyzjkm9kdcju7qccnw.png"><br><br>  A window appears indicating that the certificate server has been added.  Click <b>Continue</b> . <br><br>  The next thing to do is to configure the virtual server policies. <br><br><img src="https://habrastorage.org/webt/y-/x1/u_/y-x1u_fal75igicwqcf-booqrjo.png"><br><br>  On the <b>Advanced Settings</b> tab, select <b>Policies</b> . <br><br><img src="https://habrastorage.org/webt/6d/3e/oi/6d3eoioisbxyptasb82a1ajtewq.png"><br><br>  An empty window opens.  Click the "+". <br><br><img src="https://habrastorage.org/webt/ew/rj/im/ewrjimocbd84hq-dw7mpbebsv_i.png"><br><br>  From the drop-down list, select Responder (that is, the answer) and click <b>Continue</b> . <br><br><img src="https://habrastorage.org/webt/hx/fc/9s/hxfc9sgumdywnmjso1wvakeup1u.png"><br><br>  Now we tie this policy.  Click the "+" button to create an action for this policy. <br><br><img src="https://habrastorage.org/webt/c_/fy/su/c_fysu9vfgl-dte6mh-s-p7m2aw.png"><br><br>  We set the name and the expression for it "HTTP.REQ.URL.STARTSWITH (‚Äú / owa ‚Äù). NOT‚Äù.  That is, for a request that does not start from the ‚Äú/ owa‚Äù page. Click the ‚Äú+‚Äù button to add the following action. <br><br><img src="https://habrastorage.org/webt/f_/vh/ac/f_vhacchhxhaljoggt7-qbrywmq.png"><br><br>  We write the same name and select it from the Redirect drop-down list (that is, redirect).  And below the expression "/ owa".  That is, this policy will redirect requests to this page.  Click <b>Create</b> . <br><br><img src="https://habrastorage.org/webt/qz/zg/xd/qzzgxdh0leiy96fx7rrdz4vvxz4.png"><br><br>  As a result, a window showing all policy settings is displayed.  That is, for all requests that do not begin with ‚Äú/ owa‚Äù, redirect to this page.  Click <b>Create</b> . <br><br><img src="https://habrastorage.org/webt/yw/0y/de/yw0ydeol9pxyostvnfkaenohnas.png"><br><br>  And bind this policy with the <b>Bind</b> button. <br><br><img src="https://habrastorage.org/webt/s8/cs/vy/s8csvy0-70bckxli8s2fbz-vye0.png"><br><br>  Now you need to add the AAA virtual server (Authentication, Authorization, Accounting) to configure SSO. <br><br>  Go to <b>Security -&gt; AAA - Application Traffic -&gt; Virtual Servers</b> and click the <b>Add</b> button. <br><br><img src="https://habrastorage.org/webt/ly/pm/h5/lypmh5mtvwsi8lxdp7n59eihisc.png"><br><br>  Register the name, IP-address and domain of authentication (that is, all who belong to the TRAINING domain).  Click <b>OK</b> . <br><br>  This is followed by a similar certificate configuration. <br><br><img src="https://habrastorage.org/webt/53/pr/fk/53prfkmbwcclz7lggzj2pf4qr4g.png"><br><br><img src="https://habrastorage.org/webt/qw/sj/ud/qwsjudiiuowm5dxdtxy-0iqoamc.png"><br><br><img src="https://habrastorage.org/webt/jh/7z/nn/jh7znnql-2zpbakygqpax2bjk9c.png"><br><br><img src="https://habrastorage.org/webt/u2/cp/ko/u2cpkoz6pndmxmqjqwyb7j7hna0.png"><br><br><img src="https://habrastorage.org/webt/kb/4v/bw/kb4vbwtz4_q6tfxqphuq2sa6bg8.png"><br><br><img src="https://habrastorage.org/webt/tr/pc/bh/trpcbhmwrld526mb_cc6gdij2rk.png"><br><br>  We will not use advanced policies and click <b>Continue</b> . <br><br><img src="https://habrastorage.org/webt/ru/qw/4p/ruqw4pgswurkcsko82utqjhhhu8.png"><br><br>  Set up a basic authentication policy. <br><br><img src="https://habrastorage.org/webt/9a/jr/-j/9ajr-jx2wrqphxfc1uvvsqwgegk.png"><br><br>  Select the LDAP protocol and click <b>Continue</b> . <br><br><img src="https://habrastorage.org/webt/kl/lo/ow/klloowuazspvu0dc93sc7wex354.png"><br><br>  Now you need to bind the policy.  Click the <b>Select Policy</b> . <br><br><img src="https://habrastorage.org/webt/lo/jc/wj/lojcwjd24z11zsrtduqd2xuw2am.png"><br><br>  And select the previously created training.lab_pool. <br><br><img src="https://habrastorage.org/webt/dt/dx/jg/dtdxjgp5-dwhqt2dhmvqqnkbtp0.png"><br><br>  Click <b>Bind</b> . <br><br><img src="https://habrastorage.org/webt/ga/xz/sb/gaxzsbr_xj1bde1pxsj-z3jjg0m.png"><br><br>  On the right side of the menu, we find the Advanced Settings window and select <b>Policies</b> from there. <br><br><img src="https://habrastorage.org/webt/8k/lh/o_/8klho_lszmbvx_snoonq0n0dcca.png"><br><br>  A blank window opens in which you can add a new policy.  Click the "+". <br><br><img src="https://habrastorage.org/webt/sr/yu/ss/sryuss5llrqngdtnf0tvjzv6cm0.png"><br><br>  Choose a policy for Session. <br><br><img src="https://habrastorage.org/webt/uk/ey/zz/ukeyzzedsmu4lrba9ipsnirbape.png"><br><br>  We create the necessary policy. <br><br><img src="https://habrastorage.org/webt/oi/mw/cj/oimwcj8eod6xvyqtzhbpcgktmvq.png"><br><br>  We set a name and we write down expression "ns true".  After clicking ‚Äú+‚Äù to add an action to this policy. <br><br><img src="https://habrastorage.org/webt/9s/ko/78/9sko78vajsvlclcxkvgksxu_qqm.png"><br><br>  In authorization rules we define as ALLOW (that is, allow).  We enable SSO, define the domain, Cookie and set the validity.  Do not forget to put checkboxes opposite custom fields to define these parameters globally and create them with the <b>Create</b> button. <br><br><img src="https://habrastorage.org/webt/kt/oa/cw/ktoacwzhayqdjcwvyhbecmm6lvs.png"><br><br>  A summary window appears, where we also click <b>Create</b> . <br><br><img src="https://habrastorage.org/webt/od/oe/vp/odoevpzh2we1hbjhnalw9q0ubrw.png"><br><br>  We return to the initial window and make sure that the previously created policy is attached.  Combine the resulting <b>Bind</b> button. <br><br><img src="https://habrastorage.org/webt/qm/p3/rl/qmp3rlfp66zjdbtmxv1hgt_fl_c.png"><br><br>  Do not forget to save the configuration on NetScaler. <br><br>  Now we will configure authentication on webmail.training.lab. <br><br><img src="https://habrastorage.org/webt/d9/rd/ky/d9rdkyn7a8-lugow3pu4dh6sous.png"><br><br>  Go to <b>Traffic Management -&gt; Load Balancing -&gt; Virtual Servers</b> , select the server and edit it by clicking the <b>Edit</b> button. <br><br><img src="https://habrastorage.org/webt/tt/4a/xt/tt4axtf-vaqzisctexee1_q8fp8.png"><br><br>  We select <b>Authentication</b> . <br><br><img src="https://habrastorage.org/webt/ca/e5/ft/cae5ftpzpaub05mporiyhocq8fw.png"><br><br>  Select <b>Form Based Authentication</b> , give it a name, type of virtual server and select the one added earlier from the drop-down list. <br><br><img src="https://habrastorage.org/webt/cy/ss/rg/cyssrgzg5bbta0nk6vej6wgkqt0.png"><br><br>  We already have one policy.  But we still need to add policies for logging in and logging out of the system.  Click the "+". <br><br><img src="https://habrastorage.org/webt/68/da/5p/68da5pwxtxtvmyorybcm9f8-zkm.png"><br><br>  In the window that opens, select <b>Traffic</b> . <br><br><img src="https://habrastorage.org/webt/sn/lg/6q/snlg6qqoxo14povgvjjzhkxhgok.png"><br><br>  Now you need to create a policy and bind it. <br><br><img src="https://habrastorage.org/webt/vc/bn/q2/vcbnq2mqpa4edlokx4jens26dry.png"><br><br>  Give the name of the policy and set the expression "HTTP.REQ.URL.CONTAINS (" / owa / auth / logon.aspx ")".  After click "+" to create a profile. <br><br><img src="https://habrastorage.org/webt/yf/8z/4v/yf8z4vftbgj1xfd7yiqn8rqyzu4.png"><br><br>  Set the name, define the timeout in minutes and enable SSO.  Next you need to determine the form for which SSO will work.  Click "+" opposite <b>Form SSO Profile</b> . <br><br><img src="https://habrastorage.org/webt/il/lg/7t/illg7tiecsc2ysqdlrtvfcvcgeg.png"><br><br>  The SSO form configuration window opens.  We set the name, action URL, login form with password, expression and other attributes.  In fact, there is no point in going into details, since these are standard authentication parameters and they are the same for configuring OWA applications.  Click <b>Create</b> . <br><br><img src="https://habrastorage.org/webt/nw/wb/as/nwwbast11at3le2lenurrpfkb5a.png"><br><br>  Go back to the previous traffic policy window and click <b>Create</b> . <br><br><img src="https://habrastorage.org/webt/9t/cy/sl/9tcysl0kkfntzljohyftb3ul3cs.png"><br><br>  We get into the policy binding window and make sure that in the <b>Select Policy</b> field, it is really selected.  After we <b>press Bind</b> . <br>  Now we have created and attached a policy to log in or log on.  It remains to create to exit or log off. <br><br><img src="https://habrastorage.org/webt/zb/es/yl/zbesylzbu5ilfn3ibjc1fvddyle.png"><br><br>  Create another policy by clicking the button with "+". <br><br><img src="https://habrastorage.org/webt/_t/eq/5k/_teq5kacxwxmai-ja9g97g2qyse.png"><br><br>  Choose a policy for traffic and click <b>Continue</b> . <br><br><img src="https://habrastorage.org/webt/sc/sx/nt/scsxntn-b_u7deuions4kyuo3bg.png"><br><br>  Add a new binding. <br><br><img src="https://habrastorage.org/webt/wz/is/ch/wzischlutvpj2giiibvginu6cfa.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We add a new policy, prioritizing it with a priority of 90 (the priority of the previous one was 100) and click "+". </font></font><br><br><img src="https://habrastorage.org/webt/v5/gp/t_/v5gpt_fxr3ihw4bmdqx-ws7izti.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The traffic policy creation window opens. We set the name and write the expression ‚ÄúHTTP.REQ.URL.CONTAINS (‚Äú / owa / logoff.owa ‚Äù)‚Äù. Now we will create a profile by pressing the button with ‚Äú+‚Äù. </font></font><br><br><img src="https://habrastorage.org/webt/zj/y_/td/zjy_tdqc34grcqzpjasbk7zgugq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We give the name of the policy, specify the timeout in minutes, enable SSO and set a checkbox in front of the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initiate Logout</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (that is, initiate the exit). Click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/webt/h2/fe/op/h2feop4dhsveeyata6bqm6ev8vu.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We return to the previous window. Make sure the profile is selected and click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/webt/zo/5a/ip/zo5aipwuhk8aieubha1k7d-qgw8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the policy binding window, we see that the correct policy has been selected and we connect it with the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bind</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> button </font><font style="vertical-align: inherit;">. </font></font><br><br><img src="https://habrastorage.org/webt/l0/2h/el/l02hel1okvlxhssae5wv5ekuqmc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A window opens with a list of policies. Click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Close</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><img src="https://habrastorage.org/webt/jv/pe/ip/jvpeipajgsrvtlyoz96g2_jakbc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Done</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Save the configuration to NetScaler. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now that all the required settings and policies are configured, let's add the application itself to the Unified Gateway. </font></font><br><br><img src="https://habrastorage.org/webt/nv/al/5e/nval5ejtjneydbykmcvpvikoxn8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go to Unified Gateway. </font></font><br><br><img src="https://habrastorage.org/webt/lo/v0/et/lov0et9-hzlvjpofimoq6onqrcw.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Choose ug1. </font></font><br><br><img src="https://habrastorage.org/webt/6x/lg/0n/6xlg0n8mwcbvv6zwpezslpp1-yi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Go to edit mode by clicking the button with a pencil. </font></font><br><br><img src="https://habrastorage.org/webt/vo/np/z_/vonpz_ezn6ziqlhu-mo0srcbgpg.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And add a new application. </font></font><br><br><img src="https://habrastorage.org/webt/m4/fj/li/m4fjliztdzy7n0abyiszq2-o4ii.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We select WEB Application.</font></font><br><br><img src="https://habrastorage.org/webt/ph/pz/u7/phpzu7nx-w8w-ystgqiq_1xckpq.png"><br><br>  Set the name.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But in the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Application Type</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> window we </font><font style="vertical-align: inherit;">select not ‚ÄúClientless Access‚Äù, but ‚ÄúPreconfigured application on this NetScaler‚Äù. Next, write the URL of the service. And choose a virtual server. </font></font><br><br><img src="https://habrastorage.org/webt/da/12/u8/da12u8wv_xc0ipgp6jsthesjpoi.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We select it and in the subsequent windows we press </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Continue</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Done</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/webt/xk/da/wi/xkdawieznjdgztgmoxtuexylrle.png"><img src="https://habrastorage.org/webt/mu/n-/y2/mun-y2rl2qdrgaiwmricavjddb4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Application added. Now we‚Äôll check by logging in to the UG under the user account. </font></font><br><br><img src="https://habrastorage.org/webt/qh/su/mi/qhsumiqwwccl7jzgv3w3jqnanvw.png"><br><br><img src="https://habrastorage.org/webt/s4/88/gi/s488gii92zudmg_cw37-g6uriiq.png"><br><br><img src="https://habrastorage.org/webt/9b/rc/x1/9brcx1wvbw_tkyn3abvm-hpuiyg.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We see the appearing application and click on it. </font></font><br><br><img src="https://habrastorage.org/webt/sw/zy/t-/swzyt-vmtop5skse8r9zdmquo6c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And without additional authorization windows, we get into the mail or Outlook Web App. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thus, we set up access to corporate mail through Unified Gateway using the SSO mechanism. That is, entering a login with a password once.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, some may argue that it is not safe and, having obtained a login with a password, you can gain access to the user's resources. For such cases, multifactor authorization is provided. When logging in, not one but several passwords are requested. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the following example, we analyze how to configure two-factor authentication (or dual-factor). As the second method, choose authentication via a RADIUS server. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RADIUS is a protocol belonging to the AAA group. It allows you to authenticate the user (check the authenticity of the account), authorize (check the rights to certain objects) and keep records of the actions performed (that is, the audit of user actions). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We are more interested in authentication:</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) The client sends a request that contains the data to be sent (username and password). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2) The server, having received this data, verifies them and sends the answer. </font><font style="vertical-align: inherit;">Answer options can be 3:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accept-Accept. </font><font style="vertical-align: inherit;">This means that the user is successfully authenticated and can be allowed to the desired resource.</font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accept-Reject. </font><font style="vertical-align: inherit;">Indicates that the request is not valid. </font><font style="vertical-align: inherit;">This answer can be returned to the client for a variety of reasons (incorrect request, incorrect username and / or password, etc.). </font><font style="vertical-align: inherit;">Therefore, on the server, you can configure to send a text message with this type of response, indicating what was transmitted incorrectly (but this is not necessary).</font></font></li><li> Access-Challenge.      ,        (     ).   ,       .      ,     ,    . </li><li>    Unified Gateway    RADIUS-,     . </li></ul><br><img src="https://habrastorage.org/webt/nv/al/5e/nval5ejtjneydbykmcvpvikoxn8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the NetScaler menu, select Unified Gateway. </font></font><br><br><img src="https://habrastorage.org/webt/lo/v0/et/lov0et9-hzlvjpofimoq6onqrcw.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Choose ug1. </font></font><br><br><img src="https://habrastorage.org/webt/wg/m6/e5/wgm6e5jh0md94-5aiqtwx62wd_0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the authentication panel click on the button with a pencil. </font></font><br><br><img src="https://habrastorage.org/webt/xw/lw/xk/xwlwxkxfpouddab8qnsrhyqd_zs.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A previously configured window is opened, where from the drop-down list of the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secondary authentication method we</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> select RADIUS. </font></font><br><br><img src="https://habrastorage.org/webt/zh/8t/3s/zh8t3sg_4vzyfkdd0yddsxfifq0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And enter the parameters of the RADIUS server. Its IP address, port, timeout in seconds (usually 3 seconds is enough, with a properly working channel) and the secret key to be entered when entering the UG. As part of the lab, we‚Äôll select the Citrix456 key. In a real environment, choose the key more difficult. After clicking </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Continue</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Done</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The second authentication method is added and now we check its operation. </font></font><br><br><img src="https://habrastorage.org/webt/bi/q1/xk/biq1xkqkuvadu5blwb5nxfgkfri.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Open the Unified Gateway.</font></font><br><br><img src="https://habrastorage.org/webt/s6/ax/68/s6ax68xqvmichy29xv1zroqscpq.png"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And we see that the second field for entering the password has appeared. Enter the credentials there (user1 / Citrix123 / Citrix456) and click </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Log On</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><img src="https://habrastorage.org/webt/xd/_v/qu/xd_vqujml_hs5sbbbdv6xwf63yq.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We see the usual window, which means that the setting was completed successfully. Thus, we set up multifactor authentication on our Unified Gateway, thereby increasing security. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The last thing we‚Äôll touch on in this article is nFactor authentication. This type of authentication was coined by Citrix and integrated into their platforms. This is a very flexible and reliable method. Therefore, I cannot bypass it.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since NS_VPX_1, located at 192.168.10.50 (NetScaler, on which the Unified Gateway is raised) is already configured and configured, we will use the other. </font><font style="vertical-align: inherit;">On top of that, the nFactor authentication setting will not be performed in a graphical environment, but using the console. </font></font><br><br><img src="https://habrastorage.org/webt/h0/to/pf/h0topfmphweh1paiv1hqxc-owlw.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Open the Putty program (you can also use another terminal). </font><font style="vertical-align: inherit;">I have it already in bookmarks under the name NS_VPX_2 (located at 192.168.10.55). </font><font style="vertical-align: inherit;">I open it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Initially, he will ask for a username and password. </font><font style="vertical-align: inherit;">Enter the standard nsroot / nsroot. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We fall into the console NetScaler. </font><font style="vertical-align: inherit;">Now you need to create an AAA server, configure it and bind a domain certificate to it.</font></font> Enter the command: <br><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">authentication</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vserver</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">security</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.training</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lab</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SSL</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.125</span></span> 443 ‚Äì<span class="hljs-selector-tag"><span class="hljs-selector-tag">AuthenticationDomain</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">training</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lab</span></span></code> </pre> <br>  That is, add an authenticating <b>security.training.lab</b> virtual server using SSL protocol located at 192.168.10.125, port 443 and the authentication domain <b>training.lab</b> . <br><br>  Now you need to bind the certificate to this server.  Enter: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">bind</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ssl</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vserver</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">security</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.training</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lab</span></span> ‚Äì<span class="hljs-selector-tag"><span class="hljs-selector-tag">certKeyName</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">wildcard</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.training</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lab</span></span></code> </pre> <br>  Link to the <b>security.training.lab</b> virtual server certificate <b>wildcard.training.lab</b> . <br><br>  And add the authentication policy with the command: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">add</span></span> authentication <span class="hljs-keyword"><span class="hljs-keyword">Policy</span></span> training.lab_ldap ‚Äì<span class="hljs-keyword"><span class="hljs-keyword">rule</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> -action ad.training.lab</code> </pre> <br>  Add an authentication policy named <b>training.lab_ldap</b> and an action to authenticate through the domain controller <b>ad.training.lab</b> . <br><br>  The next thing you need to do is create an authentication scheme and a policy to bind.  Enter the following: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">add</span></span> authentication loginSchema nfactor1 ‚ÄìauthenticationSchema nfactorauth.xml ‚ÄìuserCredentialIndex <span class="hljs-number"><span class="hljs-number">1</span></span> ‚ÄìpasswordCredentialIndex <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre> <br>  Add a schema, specify the XML file in which it will be recorded and specify the recording parameters (login and password forms). <br><br>  Now we associate the policy with the created schema: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">add</span></span> authentication loginSchemaPolicy nfactor1 ‚Äì<span class="hljs-keyword"><span class="hljs-keyword">rule</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ‚Äìaction nfactor1</code> </pre> <br>  We also create a scheme for skipping: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">add</span></span> authentication loginSchema nfactor2 ‚ÄìauthenticationSchema noschema <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> authentication policyLabel nfactor_label ‚ÄìloginSchema nfactor2</code> </pre> <br>  Next, you need to create policies and authentication for the LDAP and RADIUS server for multifactor authentication.  Add authentication via RADIUS server: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">authentication</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">radiusAction</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">radius_act</span></span> ‚Äì<span class="hljs-selector-tag"><span class="hljs-selector-tag">serverIP</span></span> 192<span class="hljs-selector-class"><span class="hljs-selector-class">.168</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.13</span></span> ‚Äì<span class="hljs-selector-tag"><span class="hljs-selector-tag">radKey</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Citrix456</span></span></code> </pre> <br>  We define the authentication method through RADIUS, set the IP address and key (or password). <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">add</span></span> authentication <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> radius ‚Äì<span class="hljs-keyword"><span class="hljs-keyword">rule</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ‚Äìaction radius_act</code> </pre> <br>  Add a policy and bind to the method created above. <br><br>  Now you need to bind the schema to the authenticating virtual server.  We write the following command: <br><br><pre> <code class="hljs pgsql">bind authentication vserver <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>.training.lab ‚Äì<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> nfactor1 ‚Äìpriority <span class="hljs-number"><span class="hljs-number">1</span></span> ‚ÄìgotoPriorityExpression <span class="hljs-keyword"><span class="hljs-keyword">END</span></span></code> </pre> <br>  That is, bind the <b>nfactor1</b> policy to the <b>security.training.lab</b> virtual server and set the priority. <br><br>  And we bind both created authentication policies to a virtual AAA server: <br><br><pre> <code class="hljs pgsql">bind authentication vserver <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>.training.lab ‚Äì<span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> training.lab_ldap ‚Äìpriority <span class="hljs-number"><span class="hljs-number">1</span></span> ‚ÄìnextFactor nfactor_label ‚ÄìgotoPriorityExpression next bind authentication policyLabel nfactor_label ‚ÄìpolicyName radius ‚Äìpriority <span class="hljs-number"><span class="hljs-number">2</span></span> ‚ÄìgotoPriorityExpression <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  That is, with priority 1, the authentication policy through the LDAP server is executed, and further, with priority 2, the authentication policy through the RADIUS server is executed.  The <b>end</b> parameter at the end indicates that the action ends.  That is, these 2 politicians must work together. <br><br>  Finally, we activate the authentication for the virtual server: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">set</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vserver</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">nfactor</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.training</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lab</span></span> ‚Äì<span class="hljs-selector-tag"><span class="hljs-selector-tag">authenticationHost</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">security</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.training</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.lab</span></span> ‚Äì<span class="hljs-selector-tag"><span class="hljs-selector-tag">Authentication</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ON</span></span></code> </pre> <br>  For the <b>nfactor.training.lab</b> virtual server, <b>we</b> specify the authentication host <b>security.training.lab</b> and enable authentication. <br><br>  After saving the configuration: <br><br><pre> <code class="hljs lua">save <span class="hljs-built_in"><span class="hljs-built_in">config</span></span></code> </pre> <br>  At this setting is over.  Check the work. <br><br><img src="https://habrastorage.org/webt/pg/hy/bs/pghybsuh9gapgfsnestk5vkqunk.png"><br><br>  Open the specified server. <br><br><img src="https://habrastorage.org/webt/zf/1h/ck/zf1hckmm0uiniq_sscu0eky7ayu.png"><br><br>  And we are transferred to a virtual AAA server, with content from an XML schema.  That is, with a login form and two forms for entering a password. <br><br><img src="https://habrastorage.org/webt/24/xz/ul/24xzulyadsxtsv1vvh6arfmili8.png"><br><br>  And after correctly entered data, the following message comes out. <br><br>  So we deployed nFactor using the LDAP and RADIUS protocols.  And then they tested how a virtual AAA server authenticates users. <br><br>  Let's sum up.  In this article, we have disassembled the Citrix NetScaler product, configured it using the WEB interface and the console interface.  We learned how to raise the Unified Gateway platform, add applications to it, create policies, configure them and link them to a service.  Plus, they figured out the authentication methods, the difference between multifactor authentication and the usual one. <br><br>  I tried to describe everything as clearly and clearly as possible, because of which the article slightly increased in volume.  I hope that it turned out to be useful and useful, with further settings.  If you have questions, feel free to ask in the comments.  Thanks for reading and waiting for the next issues! </div><p>Source: <a href="https://habr.com/ru/post/347398/">https://habr.com/ru/post/347398/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347386/index.html">The whole truth about VPS (KVM) E5-2650 v4 (6 Cores) 10GB DDR4 240GB SSD 1Gbps from $ 20 or how to share the server?</a></li>
<li><a href="../347388/index.html">Social Architecture: The Importance of Contracts and Unlimited Property</a></li>
<li><a href="../347390/index.html">How to build a REST-like API in a large project</a></li>
<li><a href="../347392/index.html">VIPER and UITableView / UICollectionView with simple cells</a></li>
<li><a href="../347394/index.html">Code alignment instructions</a></li>
<li><a href="../347400/index.html">Security Week 1: Witnesses do not steal, old deep exploits, Google Play against swinishness</a></li>
<li><a href="../347402/index.html">How can a beginner contribute to an open source project with 20K stars?</a></li>
<li><a href="../347404/index.html">Scrum implementation by techie: real experience, pitfalls, tips & tricks</a></li>
<li><a href="../347406/index.html">Python for teaching science informatics: Simulating Queuing Systems</a></li>
<li><a href="../347408/index.html">As we ivi rewrote etl: Flink + Kafka + ClickHouse</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>