<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Acquaintance and start of development on iCE40 FPGAs from Lattice Semiconductor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! Today we will get acquainted with the new family of cheap and low-power FPGAs from Lattice Semiconductor iCE40LP / HX / LM families, learn how ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Acquaintance and start of development on iCE40 FPGAs from Lattice Semiconductor</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/17d/bb6/6f2/17dbb66f2d5442e9a06451e233ed3ada.jpg" align="left">  Hello!  Today we will get acquainted with the new family of cheap and low-power FPGAs from Lattice Semiconductor iCE40LP / HX / LM families, learn how to work with the proprietary compiler iCEcube2 and the Sublime Text 3 code editor, and also program the chip on the Lattice iCEstick debug board using firmware written in SystemVerilog. <br><br>  Everything will be accompanied by detailed instructions and screenshots. <br><a name="habracut"></a><br>  It happens that microcontrollers are not suitable for some tasks in the development of iron, especially those associated with high parallelism of data processing, speed of processing or with other specifics of the task, and something powerful from Cortex-A is seen as a sparrow cannon.  Then, as a rule, the developer draws attention to the FPGAs, providing for a relatively inexpensive price to him full freedom of action at the lowest level of digital systems - individual logic elements and triggers.  This allows you to make "your own chip" inside the FPGA, using its findings and the periphery already embedded inside.  For example, if you suddenly need 50 timers with PWM, or ultra-fast data processing, or, say, SPI with 3 MISO lines and 2 MOSI, transfer 5 Gbps with 2 diff.  lines - all this is quite realizable on the FPGA.  The engineer here is limited only by the number of universal logical cells and their switching time. <br><br>  Among the FPGA manufacturers, two have already gained popularity among developers - Altera and Xilinx, which produce both the simplest FPGAs (MAX II, MAX 10, Spartan II, Spartan III), on which you can build logic of almost any complexity, as well as ultrafast (Stratix 10, Arria 10, Spartan 7, Artix 7), capable of transmitting data at speeds up to 56 Gbps, so that you have fast internet.  However, such dreadful speeds of work are not always needed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Some features of the FPGA of the iCE40 family (data from the manufacturer‚Äôs website): <br><br>  ‚Ä¢ Series HX - high-performance FPGAs, LP - low-power and LM - low-power with integrated peripherals; <br>  ‚Ä¢ From 384 to 7680 LUT cells; <br>  ‚Ä¢ Low power consumption, starting at 25 ¬µW for some chips; <br>  ‚Ä¢ Interfaces integrated into the SPI and I2C hardware, which facilitate the configuration of the chip; <br>  ‚Ä¢ Ability to implement interfaces: Parallel RGB, 7: 1 LVDS, MIPI DPI / DBI, HiSPi, subLVDS, LVDS, Parallel LVCMOS; <br>  ‚Ä¢ Up to 128 kbps of internal RAM; <br>  ‚Ä¢ There is no internal flash memory, so you will need to connect external memory to the built-in automatic SPI interface (suitable models can be found in the Diamond Programmer firmware); <br>  ‚Ä¢ BGA cases with 0.35-0.4 mm pitch, with minimum dimensions of 1.40x1.48x0.45 mm with 0.35 mm pitch, there is also a TQFP-144 package with a 0.4 mm pitch. <br><br>  If Altera and Xilinx have comfortable development environments with a large number of lessons on them, then Lattice software is a compiler with a shell over Synopsys Synplify, and writing code there seemed to be inconvenient for me, so I decided to just load ready-made source files there.  Software for other series - Lattice Diamond is not suitable for the iCE40 series, so for editing the code I put the well-known Sublime Text 3 editor and installed a plugin on it to support the SystemVerilog language.  You can write in other languages, iCEcube2 automatically recognizes the language by file extension. <br><br>  Well, if you have an iCEstick debug board with USB (clickable images from manufacturer sites): <br> <a href="http://www.digikey.com/product-detail/en/lattice-semiconductor-corporation/ICE40HX1K-STICK-EVN/220-2656-ND/4289604"><img src="https://habrastorage.org/getpro/habr/post_images/fa8/373/e0e/fa8373e0ebecebe795d3b46560d66e00.png" alt="image"></a> <br>  Instead, you can buy this one (pinout and firmware settings will be different!): <br><br> <a href="http://www.digikey.com/product-detail/en/lattice-semiconductor-corporation/ICE40HX1K-BLINK-EVN/220-1581-ND/3198285"><img src="https://habrastorage.org/getpro/habr/post_images/4c6/c55/b98/4c6c55b986407a0fae8788f15f9d773c.png" alt="image"></a> <br><br>  So, the detailed steps for installing the software, creating and configuring the project and the firmware, test code, firmware and monitoring the results: <br><br>  <b>1.</b> Register on the Lattice Semiconductor website and <a href="http://www.latticesemi.com/en/Products/DesignSoftwareAndIP/FPGAandLDS/iCEcube2.aspx">download iCEcube2</a> . <br><br>  <b>2.</b> Click ‚ÄúClick here to request your license‚Äù on the same page.  After that, you will need to enter your MAC address in the field. <br><br>  <b>3.</b> You will receive an email with a license file. <br><br>  <b>4.</b> Install iCEcube2, copy the license file to its folder, and point the path to it by running iCEcube2. <br><br>  <b>5.</b> Install the firmware for the FPGA firmware - <a href="http://www.latticesemi.com/programmer">Lattice Diamond Programmer</a> . <br><br>  <b>6.</b> Install Sublime Text 3 and <a href="https://packagecontrol.io/installation">the package manager for it</a> . <br><br>  <b>7.</b> In Sublime Text 3, click Preferences ‚Üí Package Control, in the list that opens, click ‚ÄúPackage Control: Install Package‚Äù. <br><br>  <b>8.</b> Enter "SystemVerilog".  Click on the first (and only) item in the list, wait until the plugin is installed (see the line at the bottom of the editor). <br><br>  <b>9.</b> Create an empty file and save it as top.sv where the sources of your FPGA firmware project will be. <br><br>  <b>10.</b> In iCEcube2, click the New project (or the yellow sheet at the top), a window will open where you need to fill in the parameters as in the screenshot, indicating the project path: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1c5/d81/5a7/1c5d815a74c94e318f624d55a9e9688f.png"></div><br>  <b>11.</b> Click Next, a window will appear to add source files to the project, look for our file top.sv, double click on it and click Finish. <br><br>  <b>12.</b> The project is created, on the left is its tree and the steps of synthesis, placement and tracing of connections between cells.  Item Design Files is disclosed, there are all included in the project files.  Now there is only top.sv: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/1f3/129/758/1f312975837a475984e87dbe94e7d92f.png"></div><br>  <b>13.</b> Let's write a standard code for flashing the LED (well, if you have an iCEStick board): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/8d7/60f/623/8d760f6233fd48189c8e323cb01a977d.png"></div><br>  <b>14.</b> Save the changes in the file and go to iCEcube2.  Click there on this file twice, and on the question of whether to update the file, answer "Yes". <br><br>  <b>15.</b> In iCEcube2, click Tools&gt; Run All and wait for the project to complete. <br><br>  <b>16.</b> Click on the button with 16 green circles, Package View: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/55d/881/164/55d881164c6941f9b18f75a93e200113.png"></div><br>  <b>17.</b> The pin editor opens in which you can correlate the inputs and outputs of your module to SystemVerilog and the FPGA body pins.  The body layout can be scaled (Ctrl + rotate the mouse wheel) and moved (by dragging the cursor): <br><br><img src="https://habrastorage.org/files/2bd/508/c16/2bd508c167774f71a5a7324585e87cd5.png"><br><br>  <b>18.</b> If you download the datasheet for debugging the iCEstick, you can find out that the clock generator is connected to 21 pins, and 5 LEDs to 95 (green), 96, 97, 98 and 99 (red) pins.  In the panel on the left of the Port, you need to open the led [4: 0] bus, which we have brought instead of one output so that we will not blink iron 0 on those diodes, otherwise they will shine dimly.  Now, with the mouse, drag all items led [0] .. led [4] to the leads to which the LEDs are connected, and clk to the leads to 21 leads. <br><br>  <b>19.</b> If done correctly, these findings on the diagram will turn green.  After that, you need to click on each of them with the right button and click Lock in the drop-down menu, after which locks will appear on them.  This will save you from resetting pinouts when recompiling code.  Now save the pinout by pressing Ctrl-S.  In the following windows, click OK and Yes: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/805/be7/84b/805be784b3614c699395373e2790b697.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/638/fd0/23c/638fd023c3de4cf6a41b47b5cc6ca6ef.png"></div><br>  <b>20.</b> Again, click on the 16 circles (Package view).  The resulting picture looks like this: <br><br><img src="https://habrastorage.org/files/488/c69/94a/488c6994a0a747dead9abe1e90da22fd.png"><br><br>  <b>21.</b> Click Tools ‚Üí Run All and wait for the full compilation of the project. <br><br>  <b>22.</b> Insert the iCEstick debugging into the USB port of the PC and run the Diamond Programmer, click File&gt; New File there.  A window will open in which you can click Detect Cable, or you can manually select these parameters: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/47a/091/73e/47a09173e3a24190bc734c377716edd9.png"></div><br>  <b>23.</b> Click OK and wait for the scan: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/5dc/b30/ebd/5dcb30ebd65c4002a934d2a03e12f28e.png"></div><br>  <b>24.</b> If all is well, the line will appear: <br><br><img src="https://habrastorage.org/files/282/62f/c1a/28262fc1a4044267a76456f66c6ac076.png"><br><br>  If everything is bad, try another USB port. <br><br>  <b>25.</b> Fill in the parameters: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/640/b0b/f6e/640b0bf6effd4ef9bed692548247098a.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a04/f7e/b84/a04f7eb84fe34310a9ba1b6c18566ae6.png"></div><br>  <b>26.</b> In the Operation column, click on the Fast programming sign, a window opens: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/fbc/586/6c6/fbc5866c6cde4ee08ddbd2d46261aedc.png"></div><br>  In which you need to select the SPI Flash Programming item in the Access Mode drop-down list, after which the window will increase, and now you need to fill in the remaining fields as in the screenshot: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/616/e16/9c1/616e169c1ce8400ea536d125418a416e.png"></div><br>  <b>27.</b> Click OK, or Enter, as you prefer, and then save the firmware configuration by pressing Ctrl-S. <br><br>  <b>28.</b> Click Program and wait a minute until the FPGA is erased and again programmed: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/54c/4d3/975/54c4d397514b419cb5d68f2d1f678439.png"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/263/2b4/461/2632b4461b3c458db96db13720d7f438.png"></div><br>  <b>29.</b> Observe the result: the red LED flashes with a noticeable frequency: <br><br><img src="https://habrastorage.org/files/a37/f8c/8c1/a37f8c8c162c45428d2730b0902f508d.png"><br><img src="https://habrastorage.org/files/def/fe1/48d/deffe148d02948e6a1d17ace62af188c.png"><br><br><h3>  Conclusion </h3><br>  We learned how to set up and build a project with code in iCEcube2 software, set up the firmware and load the firmware into the FPGA chip.  We wrote a test code for the flashing LED on the board and confirmed its operability. <br><br>  In order to apply the FPGA of the iCE40 family in your projects you need to study the datasheets for the selected chip and its debug boards.  The cheapest chip in the family, the ICE40UL640-SWG16ITR50, costs Digi-Key $ 1.53 / pc, has 640 cells, 55 kb of RAM, and a WLCSP-16 package with a size of 1.4x1.48 mm.  The most expensive chip in the series - ICE40HX8K-CT256 costs 12.78 $ / pc in Digi-Key, has 7680 cells, 128 kb of RAM, and a BGA-256 package measuring 14x14 mm. <br><br>  In further articles, a review will be conducted of similar manufacturers of FPGAs from other manufacturers and compared with iCE40 for price, speed, number of cells, variety of cases, availability in Russia, ease of use of the development environment, etc. </div><p>Source: <a href="https://habr.com/ru/post/315588/">https://habr.com/ru/post/315588/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../315578/index.html">Security in IoT: Comprehensive Security Strategy</a></li>
<li><a href="../315580/index.html">Scrum: Game Rules</a></li>
<li><a href="../315582/index.html">Optimize Caffe Neural Network Platform for Intel Architecture</a></li>
<li><a href="../315584/index.html">We invite you on December 3 to a master class on employment in the gaming industry</a></li>
<li><a href="../315586/index.html">To the issue of trends</a></li>
<li><a href="../315590/index.html">I invite you to a virtual reality party ‚ÄúNew Year's VR-Today‚Äù, December 10</a></li>
<li><a href="../315592/index.html">5 tips to improve game animations</a></li>
<li><a href="../315594/index.html">Linux subsystem files cannot be created, modified, or deleted using Windows tools.</a></li>
<li><a href="../315596/index.html">Webinar: Asterisk and Databases</a></li>
<li><a href="../315598/index.html">Deep Learning Program</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>