<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Thymeleaf Tutorial: Chapter 2. A Thymes Good Virtual Grocery Store</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Table of contents 

 2 Good virtual grocery store by Thymes 
 The source code for the examples shown in this and future chapters can be found in the G...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Thymeleaf Tutorial: Chapter 2. A Thymes Good Virtual Grocery Store</h1><div class="post__text post__text-html js-mediator-article">  <a href="https://habrahabr.ru/post/350862/">Table of contents</a> <br><br><h2>  2 Good virtual grocery store by Thymes </h2><br>  The source code for the examples shown in this and future chapters can be found in the Good Thymes Virtual Grocery GitHub repository at <a href="https://github.com/thymeleaf/thymeleafexamples-gtvg">https://github.com/thymeleaf/thymeleafexamples-gtvg</a> . <br><br><h3>  2.1 Grocery Store Website </h3><br>  To better explain the concepts involved in processing templates with Thymeleaf, this tutorial will use a demo application that you can download from the project website. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This app is an imaginary virtual grocery web site and will provide us with many scripts to demonstrate the many features of Thymeleaf. <br><a name="habracut"></a><br>  First, we need a simple set of model objects for our application: Products that are sold to Customers through Orders.  We will also manage comments about products: <br><br><img src="https://habrastorage.org/webt/ny/qx/ml/nyqxml9rksjtluw7q3bjunn61co.png" alt="Sample Application Models"><br><br>  Our application will also have a very simple service level, consisting of Service objects containing methods such as: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductService</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Product&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ProductRepository.getInstance().findAll(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ProductRepository.getInstance().findById(id); } }</code> </pre> <br>  At the web level, our application will have a filter that delegates the execution of commands with Thymeleaf support depending on the request URL: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> ServletException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">// This prevents triggering engine executions for resource URLs if (request.getRequestURI().startsWith("/css") || request.getRequestURI().startsWith("/images") || request.getRequestURI().startsWith("/favicon")) { return false; } /* * Query controller/URL mapping and obtain the controller * that will process the request. If no controller is available, * return false and let other filters/servlets process the request. */ IGTVGController controller = this.application.resolveControllerForRequest(request); if (controller == null) { return false; } /* * Obtain the TemplateEngine instance. */ ITemplateEngine templateEngine = this.application.getTemplateEngine(); /* * Write the response headers */ response.setContentType("text/html;charset=UTF-8"); response.setHeader("Pragma", "no-cache"); response.setHeader("Cache-Control", "no-cache"); response.setDateHeader("Expires", 0); /* * Execute the controller and process view template, * writing the results to the response writer. */ controller.process( request, response, this.servletContext, templateEngine); return true; } catch (Exception e) { try { response.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR); } catch (final IOException ignored) { // Just ignore this } throw new ServletException(e); } }</span></span></code> </pre> <br>  The interface of our controller IGTVGController: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IGTVGController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( HttpServletRequest request, HttpServletResponse response, ServletContext servletContext, ITemplateEngine templateEngine)</span></span></span></span>; }</code> </pre> <br>  All that remains to be done is to implement the IGTVGController interface, requesting data from services and processing templates using the ITemplateEngine object. <br><br>  In the end it will look like this: <br><br><img src="https://habrastorage.org/webt/cq/ka/ln/cqkalnuyszmmox8ejj21xgttxrq.png" alt="Sample application home page"><br><br><h3>  2.2 Creating and Configuring the Template Engine </h3><br>  The process (...) method in our filter contains this line: <br><br><pre> <code class="java hljs">ITemplateEngine templateEngine = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.application.getTemplateEngine();</code> </pre> <br>  This means that the GTVGApplication class is responsible for creating and configuring one of the most important objects in the Thymeleaf application: the TemplateEngine instance (implementation of the ITemplateEngine interface). <br><br>  Our org.thymeleaf.TemplateEngine object is initialized: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GTVGApplication</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> TemplateEngine templateEngine; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GTVGApplication</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ServletContext servletContext)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); ServletContextTemplateResolver templateResolver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServletContextTemplateResolver(servletContext); <span class="hljs-comment"><span class="hljs-comment">// HTML is the default mode, but we set it anyway for better understanding of code templateResolver.setTemplateMode(TemplateMode.HTML); // This will convert "home" to "/WEB-INF/templates/home.html" templateResolver.setPrefix("/WEB-INF/templates/"); templateResolver.setSuffix(".html"); // Template cache TTL=1h. If not set, entries would be cached until expelled by LRU templateResolver.setCacheTTLMs(Long.valueOf(3600000L)); // Cache is set to true by default. Set to false if you want templates to // be automatically updated when modified. templateResolver.setCacheable(true); this.templateEngine = new TemplateEngine(); this.templateEngine.setTemplateResolver(templateResolver); ... } }</span></span></code> </pre> <br>  There are many ways to customize a TemplateEngine object, but at the moment these few lines of code will inform us in sufficient detail about the necessary steps. <br><br>  <strong>The template resolver</strong> <br><br>  Let's start with Template Resolver: <br><br><pre> <code class="java hljs">ServletContextTemplateResolver templateResolver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServletContextTemplateResolver(servletContext);</code> </pre> <br>  Template Resolvers are objects that implement an interface from the Thymeleaf API, called org.thymeleaf.templateresolver.ITemplateResolver: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ITemplateResolver</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">/* * Templates are resolved by their name (or content) and also (optionally) their * owner template in case we are trying to resolve a fragment for another template. * Will return null if template cannot be handled by this template resolver. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TemplateResolution </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolveTemplate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IEngineConfiguration configuration, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String ownerTemplate, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String template, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Map&lt;String, Object&gt; templateResolutionAttributes)</span></span></span></span>; }</code> </pre> <br>  These objects are responsible for determining how templates will be available, and in this GTVG application, org.thymeleaf.templateresolver.ServletContextTemplateResolver means that we are going to retrieve the template files as resources from the servlet context: at the javax.servlet.ServletContext application level that exists in every Java web application, and which resolves resources from the root of the web application. <br><br>  But this is not all that we can say about the pattern recognizer, because we can set some configuration parameters on it.  First, the template mode: <br><br><pre> <code class="java hljs">templateResolver.setTemplateMode(TemplateMode.HTML);</code> </pre> <br>  <b>HTML</b> is the default template mode for the ServletContextTemplateResolver, but it is a good practice to install it anyway so that our code documents clearly state what is happening. <br><br><pre> <code class="java hljs">templateResolver.setPrefix(<span class="hljs-string"><span class="hljs-string">"/WEB-INF/templates/"</span></span>); templateResolver.setSuffix(<span class="hljs-string"><span class="hljs-string">".html"</span></span>);</code> </pre> <br>  The prefix and suffix change the names of the templates that we pass to the engine to get the names of the actual resources to be used. <br><br>  Using this configuration, the template name ‚Äúproduct / list‚Äù will match: <br><br><pre> <code class="java hljs">servletContext.getResourceAsStream(<span class="hljs-string"><span class="hljs-string">"/WEB-INF/templates/product/list.html"</span></span>);</code> </pre> <br>  Optional, but the amount of time that the analyzed template can live in the cache is configured in the Template Resolver using the cacheTTLMs property: <br><br><pre> <code class="java hljs">templateResolver.setCacheTTLMs(<span class="hljs-number"><span class="hljs-number">3600000L</span></span>);</code> </pre> <br>  The template can still disappear from the cache before reaching the TTL, if the maximum cache size is reached, and this is the oldest entry. <br><br>  The behavior and cache sizes can be defined by the user by implementing the ICacheManager interface or by modifying the StandardCacheManager object to manage the default cache. <br><br>  There are many more words to say about template resolvers, but let's go back to creating our Template Engine object. <br><br>  <strong>Template engine</strong> <br><br>  Template Engine objects are an implementation of the org.thymeleaf.ITemplateEngine interface.  One of these implementations is offered by the Thymeleaf core: org.thymeleaf.TemplateEngine, and we create an instance of it: <br><br><pre> <code class="java hljs">templateEngine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TemplateEngine(); templateEngine.setTemplateResolver(templateResolver);</code> </pre> <br>  Simple, isn't it?  All we need is to create an instance and set up a template resolvers for it. <br><br>  Template resolvers is the only required parameter required by TemplateEngine, although there are many others that will be discussed later (message resolvers, cache sizes, etc.).  So far this is all we need. <br><br>  Our template module is now ready, and we can start creating pages with Thymeleaf. <br><br>  <a href="https://habrahabr.ru/post/350868/">Continued.</a>  <a href="https://habrahabr.ru/post/350868/">Chapter 3. Using Text</a> </div><p>Source: <a href="https://habr.com/ru/post/350866/">https://habr.com/ru/post/350866/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350856/index.html">Interface Composition in Go</a></li>
<li><a href="../350858/index.html">Writing Telegram-bot for Habrahabr</a></li>
<li><a href="../350860/index.html">How big data will change the automotive industry</a></li>
<li><a href="../350862/index.html">Tutorial: Using Thymeleaf</a></li>
<li><a href="../350864/index.html">Thymeleaf Tutorial: Chapter 1. Introduction</a></li>
<li><a href="../350868/index.html">Thymeleaf Tutorial: Chapter 3. Using Text</a></li>
<li><a href="../350870/index.html">Thymeleaf Tutorial: Chapter 4. Standard Expression Syntax</a></li>
<li><a href="../350872/index.html">Web components. Part 2: Shadow DOM</a></li>
<li><a href="../350874/index.html">When business grows: virtual numbers in DEF format</a></li>
<li><a href="../350878/index.html">Everything about IP addresses and how to work with them</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>