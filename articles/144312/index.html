<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Localization in Cach√© DBMS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suppose you wrote a program that displays ‚ÄúHello, World!‚Äù, For example: 
 write "Hello, World!" 
 
 The application works, everything is fine. 
 But t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Localization in Cach√© DBMS</h1><div class="post__text post__text-html js-mediator-article"> Suppose you wrote a program that displays ‚ÄúHello, World!‚Äù, For example: <br> <code><font color="#0000ff">write</font> <font color="#008000">"Hello, World!"</font></code> <br> <br>  The application works, everything is fine. <br>  But time passes, your application develops, it becomes popular, and now, you need to output this line in a different language, and the number and composition of the required languages ‚Äã‚Äãis not known in advance. <br>  Under the cut, you will learn how the localization problem is solved in Cach√©. <br><br><a name="habracut"></a><br><h4>  Short review </h4><br>  Cach√© provides a ready-made mechanism that simplifies the localization of strings in console programs, the interface in web applications, strings in JavaScipt files, error messages, etc. <br><blockquote>  Note: This topic was considered in passing in a previous <a href="http://habrahabr.ru/company/intersystems/blog/144304/">article</a> . </blockquote><br>  Suppose there is a project with many classes, programs, web pages, js scripts, etc. <br>  The localization mechanism works as follows: <br><ol><li>  even at the <b><u>compilation</u></b> stage of <b><u>the</u></b> project, all lines that are to be localized are ‚Äúfished out‚Äù and stored inside the database in a certain format. </li><li>  in the <b>compiled</b> code itself, instead of the lines themselves, a certain code is substituted, which, already at the <b><u>execution</u></b> stage <b><u>,</u></b> depending on the current session language, will output one or another value from the storage. </li></ol><br>  The entire localization process is completely transparent to the programmer. <br>  The developer eliminates the need to manually fill in some kind of row storage (tables in the database or resource file), as well as writing code to manage all of this infrastructure, such as changing the language at runtime, exporting / importing data into various formats for the translator, etc. d. <br><br>  As a result, we have: <br><ol><li>  readable - uncluttered; - source code; </li><li>  automatically filled storage of localized strings; <blockquote>  Note: When deleting lines from code from the repository, they are not deleted.  To clean up the repository from such phantoms, it is easier to clean it up and recompile the project. </blockquote></li><li>  change the current language on the fly.  This applies to both web applications and regular programs; </li><li>  the ability to get a string in a given language, from a given domain (about the domains below); </li><li>  ready-made methods for exporting / importing a repository to XML. </li></ol><br>  So let's take a closer look at how this works, as well as all sorts of examples on localization. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Introduction </h4><br>  Create a MAC program as follows: <br><br> <code><font color="#0000ff">#Include</font> <font color="#000000">%occMessages <br></font> <font color="#ff0000">test</font> <font color="#000000">()</font> <font color="#800080">{ <br> <br></font> <font color="#0000ff">write</font> <font color="#008000">"$$$DefaultLanguage="</font> <font color="#000000">,</font> <font color="#0000ff">$$$DefaultLanguage</font> <font color="#000000">,! <br></font> <font color="#0000ff">write</font> <font color="#008000">"$$$SessionLanguage="</font> <font color="#000000">,</font> <font color="#0000ff">$$$SessionLanguage</font> <font color="#000000">,! <br> <br></font> <font color="#0000ff">set</font> <font color="#000000">msg1=</font> <font color="#0000ff">$$$Text</font> <font color="#000000">(</font> <font color="#008000">", !"</font> <font color="#000000">,</font> <font color="#008000">"asd"</font> <font color="#000000">) <br></font> <font color="#0000ff">set</font> <font color="#000000">msg2=</font> <font color="#0000ff">$$$Text</font> <font color="#000000">(</font> <font color="#008000">"@my@, !"</font> <font color="#000000">,</font> <font color="#008000">"asd"</font> <font color="#000000">) <br></font> <font color="#0000ff">write</font> <font color="#000000">msg1,!,msg2,! <br> <br></font> <font color="#800080">}</font></code> <br> <br>  Result: <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">USER</span></span>&gt;d ^test $$<span class="ruby"><span class="ruby">$DefaultLanguage=ru $$</span></span>$SessionLanguage=ru , ! , !</code> </pre> <br>  What did we get? <br><br>  First, the global appeared in the database. <br><pre> <code class="hljs objectivec">^CacheMsg(<span class="hljs-string"><span class="hljs-string">"asd"</span></span>) = <span class="hljs-string"><span class="hljs-string">"ru"</span></span> ^CacheMsg(<span class="hljs-string"><span class="hljs-string">"asd"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,<span class="hljs-number"><span class="hljs-number">2915927081</span></span>) = <span class="hljs-string"><span class="hljs-string">", !"</span></span> ^CacheMsg(<span class="hljs-string"><span class="hljs-string">"asd"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,<span class="hljs-string"><span class="hljs-string">"my"</span></span>) = <span class="hljs-string"><span class="hljs-string">", !"</span></span></code> </pre> <br>  Secondly, if you hover the cursor on the <a href="">$$$ Text</a> macro, you can see the code in which it is deployed. <br>  For the example above, the intermediate (expanded) program code (INT code) will be as follows: <br><br> <code><font color="#ff0000">test</font> <font color="#000000">()</font> <font color="#800080">{ <br></font> <font color="#0000ff">write</font> <font color="#008000">"$$$DefaultLanguage="</font> <font color="#000000">,</font> <font color="#0000ff">$get</font> <font color="#000000">(^%SYS(</font> <font color="#008000">"LANGUAGE"</font> <font color="#000000">,</font> <font color="#008000">"CURRENT"</font> <font color="#000000">),</font> <font color="#008000">"en"</font> <font color="#000000">),! <br></font> <font color="#0000ff">write</font> <font color="#008000">"$$$SessionLanguage="</font> <font color="#000000">,</font> <font color="#0000ff">$get</font> <font color="#000000">(^||%Language,</font> <font color="#008000">"en"</font> <font color="#000000">),! <br></font> <font color="#0000ff">set</font> <font color="#000000">msg1=</font> <font color="#0000ff">$get</font> <font color="#000000">(^CacheMsg(</font> <font color="#008000">"asd"</font> <font color="#000000">,</font> <font color="#0000ff">$get</font> <font color="#000000">(^||%Language,</font> <font color="#008000">"en"</font> <font color="#000000">),</font> <font color="#008000">"2915927081"</font> <font color="#000000">),</font> <font color="#008000">", !"</font> <font color="#000000">) <br></font> <font color="#0000ff">set</font> <font color="#000000">msg2=</font> <font color="#0000ff">$get</font> <font color="#000000">(^CacheMsg(</font> <font color="#008000">"asd"</font> <font color="#000000">,</font> <font color="#0000ff">$get</font> <font color="#000000">(^||%Language,</font> <font color="#008000">"en"</font> <font color="#000000">),</font> <font color="#008000">"my"</font> <font color="#000000">),</font> <font color="#008000">", !"</font> <font color="#000000">) <br></font> <font color="#0000ff">write</font> <font color="#000000">msg1,!,msg2,! <br></font> <font color="#800080">}</font></code> <br> <br>  <u>As for the example above</u> , you should pay attention to the following things: <br><ol><li>  lines in the program should be written initially in the language that is registered by default in the Cach√© DBMS in the current locale (configured in the Management Portal); <blockquote>  Note: When using string identifiers instead of their hash, this is not so important. </blockquote></li><li>  for each row, the macro calculates its CRC32, and all data ‚Äî CRC32 or row identifier, domain, current system language ‚Äî are saved in the global <b>^ CacheMsg</b> ; </li><li>  instead of the line itself, a code is inserted that takes into account the value in the private global <b>^ ||% Language</b> ; </li><li>  if the user requests a string in a language for which there is no translation (there is no data in the repository), then the original string will be returned; </li><li>  the domain mechanism allows you to logically separate localized strings, for example, different translations for the same strings, etc. </li></ol><br>  If for some reason you are not satisfied with the current algorithm of the <b>$$$ Text</b> macro, for example, you want to set the default language differently or store data in a different place or ..., you can create your own analog. <br>  And the <a href="">## Expression</a> and / or <a href="">## Function</a> macros will help you with this. <br><br>  Let's continue our example. <br>  Let's add a new language.  To do this, you need to unload the repository of strings into a file and give it to the translators, then download the translation back, but in a different language. <br>  Data can be uploaded in various ways and in different formats. <br>  We will use the standard methods of the class <a href="">% MessageDictionary</a> : <b>Import</b> (), <b>ImportDir</b> (), <b>Export</b> (), <b>ExportDomainList</b> (): <br> <code><font color="#0000ff">do</font> <font color="#000080">##class</font> <font color="#000000">(</font> <font color="#008080">%MessageDictionary</font> <font color="#000000">).</font> <font color="#0000ff">Export</font> <font color="#000000">(</font> <font color="#008000">"messages.xml"</font> <font color="#000000">,</font> <font color="#008000">"ru"</font> <font color="#000000">)</font></code> <br> <br>  In the catalog of our database, we get the file " <i>messages_ru.xml</i> ".  Rename it to " <i>messages_en.xml</i> ", change its language to " <b>en</b> " and translate the contents. <br>  Next, import it back to our repository: <br> <code><font color="#0000ff">do</font> <font color="#000080">##class</font> <font color="#000000">(</font> <font color="#008080">%MessageDictionary</font> <font color="#000000">).</font> <font color="#0000ff">Import</font> <font color="#000000">(</font> <font color="#008000">"messages_en.xml"</font> <font color="#000000">)</font></code> <br> <br>  Global will take the following form: <br><pre> <code class="hljs objectivec">^CacheMsg(<span class="hljs-string"><span class="hljs-string">"asd"</span></span>) = <span class="hljs-string"><span class="hljs-string">"ru"</span></span> ^CacheMsg(<span class="hljs-string"><span class="hljs-string">"asd"</span></span>,<span class="hljs-string"><span class="hljs-string">"en"</span></span>,<span class="hljs-number"><span class="hljs-number">2915927081</span></span>) = <span class="hljs-string"><span class="hljs-string">"Hello, World!"</span></span> ^CacheMsg(<span class="hljs-string"><span class="hljs-string">"asd"</span></span>,<span class="hljs-string"><span class="hljs-string">"en"</span></span>,<span class="hljs-string"><span class="hljs-string">"my"</span></span>) = <span class="hljs-string"><span class="hljs-string">"Hello, World!"</span></span> ^CacheMsg(<span class="hljs-string"><span class="hljs-string">"asd"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,<span class="hljs-number"><span class="hljs-number">2915927081</span></span>) = <span class="hljs-string"><span class="hljs-string">", !"</span></span> ^CacheMsg(<span class="hljs-string"><span class="hljs-string">"asd"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,<span class="hljs-string"><span class="hljs-string">"my"</span></span>) = <span class="hljs-string"><span class="hljs-string">", !"</span></span></code> </pre> <br>  Now we can change the language "on the fly", for example: <br><br> <code><font color="#0000ff">#Include</font> <font color="#000000">%occMessages <br> <br></font> <font color="#ff0000">test</font> <font color="#000000">() <br></font> <font color="#800080">{ <br> <br></font> <font color="#0000ff">set $$$SessionLanguageNode</font> <font color="#000000">=</font> <font color="#008000">"ru" <br> <br></font> <font color="#0000ff">set</font> <font color="#000000">msg1=</font> <font color="#0000ff">$$$Text</font> <font color="#000000">(</font> <font color="#008000">", !"</font> <font color="#000000">,</font> <font color="#008000">"asd"</font> <font color="#000000">) <br></font> <font color="#0000ff">set</font> <font color="#000000">msg2=</font> <font color="#0000ff">$$$Text</font> <font color="#000000">(</font> <font color="#008000">"@my@, !"</font> <font color="#000000">,</font> <font color="#008000">"asd"</font> <font color="#000000">) <br></font> <font color="#0000ff">write</font> <font color="#000000">msg1,!,msg2,! <br> <br></font> <font color="#0000ff">set $$$SessionLanguageNode</font> <font color="#000000">=</font> <font color="#008000">"en" <br> <br></font> <font color="#0000ff">set</font> <font color="#000000">msg1=</font> <font color="#0000ff">$$$Text</font> <font color="#000000">(</font> <font color="#008000">", !"</font> <font color="#000000">,</font> <font color="#008000">"asd"</font> <font color="#000000">) <br></font> <font color="#0000ff">set</font> <font color="#000000">msg2=</font> <font color="#0000ff">$$$Text</font> <font color="#000000">(</font> <font color="#008000">"@my@, !"</font> <font color="#000000">,</font> <font color="#008000">"asd"</font> <font color="#000000">) <br></font> <font color="#0000ff">write</font> <font color="#000000">msg1,!,msg2,! <br> <br></font> <font color="#0000ff">set $$$SessionLanguageNode</font> <font color="#000000">=</font> <font color="#008000">"pt-br" <br> <br></font> <font color="#0000ff">set</font> <font color="#000000">msg1=</font> <font color="#0000ff">$$$Text</font> <font color="#000000">(</font> <font color="#008000">", !"</font> <font color="#000000">,</font> <font color="#008000">"asd"</font> <font color="#000000">) <br></font> <font color="#0000ff">set</font> <font color="#000000">msg2=</font> <font color="#0000ff">$$$Text</font> <font color="#000000">(</font> <font color="#008000">"@my@, !"</font> <font color="#000000">,</font> <font color="#008000">"asd"</font> <font color="#000000">) <br></font> <font color="#0000ff">write</font> <font color="#000000">msg1,!,msg2,! <br> <br></font> <font color="#800080">}</font></code> <br> <br>  Result: <br><pre> <code class="hljs erlang-repl">USER&gt;d ^test , ! , ! Hello, World! Hello, World! , ! , !</code> </pre> <br>  Pay attention to the last option. <br><br><h4>  Example of <u>non-</u> web application localization (normal class) </h4><br>  Localization of class methods: <br><br> <code><font color="#000080">Include</font> <font color="#ff0000">%occErrors <br> <br></font> <font color="#000080">Class demo.test Extends %Persistent <br></font> <font color="#000000">{ <br> <br></font> <font color="#000080">Parameter</font> <font color="#000000">DOMAIN =</font> <font color="#800080">"asd"</font> <font color="#000000">; <br> <br></font> <font color="#000080">ClassMethod</font> <font color="#000000">Test() <br> { <br></font> <font color="#0000ff">do</font> <font color="#000080">##class</font> <font color="#000000">(</font> <font color="#008080">%MessageDictionary</font> <font color="#000000">).</font> <font color="#0000ff">SetSessionLanguage</font> <font color="#000000">(</font> <font color="#008000">"ru"</font> <font color="#000000">) <br> <br></font> <font color="#0000ff">write $$$Text</font> <font color="#000000">(</font> <font color="#008000">", !"</font> <font color="#000000">),! <br> <br></font> <font color="#0000ff">do</font> <font color="#000080">##class</font> <font color="#000000">(</font> <font color="#008080">%MessageDictionary</font> <font color="#000000">).</font> <font color="#0000ff">SetSessionLanguage</font> <font color="#000000">(</font> <font color="#008000">"en"</font> <font color="#000000">) <br> <br></font> <font color="#0000ff">write $$$Text</font> <font color="#000000">(</font> <font color="#008000">", !"</font> <font color="#000000">),! <br> <br></font> <font color="#0000ff">do</font> <font color="#000080">##class</font> <font color="#000000">(</font> <font color="#008080">%MessageDictionary</font> <font color="#000000">).</font> <font color="#0000ff">SetSessionLanguage</font> <font color="#000000">(</font> <font color="#008000">"pt-br"</font> <font color="#000000">) <br> <br></font> <font color="#0000ff">write $$$Text</font> <font color="#000000">(</font> <font color="#008000">", !"</font> <font color="#000000">),! <br> <br></font> <font color="#0000ff">#dim</font> <font color="#000000">ex</font> <font color="#0000ff">as</font> <font color="#008080">%Exception.AbstractException <br> <br></font> <font color="#0000ff">try <br></font> <font color="#800080">{ <br> <br></font> <font color="#0000ff">$$$ThrowStatus</font> <font color="#000000">(</font> <font color="#0000ff">$$$ERR</font> <font color="#000000">(</font> <font color="#0000ff">$$$AccessDenied</font> <font color="#000000">)) <br> <br></font> <font color="#800080">}</font> <font color="#0000ff">catch</font> <font color="#000000">(ex) <br></font> <font color="#800080">{ <br></font> <font color="#0000ff">write $system</font> <font color="#008080">.Status</font> <font color="#000000">.</font> <font color="#0000ff">GetErrorText</font> <font color="#000000">(ex.</font> <font color="#0000ff">AsStatus</font> <font color="#000000">(),</font> <font color="#008000">"ru"</font> <font color="#000000">),! <br></font> <font color="#0000ff">write $system</font> <font color="#008080">.Status</font> <font color="#000000">.</font> <font color="#0000ff">GetErrorText</font> <font color="#000000">(ex.</font> <font color="#0000ff">AsStatus</font> <font color="#000000">(),</font> <font color="#008000">"en"</font> <font color="#000000">),! <br></font> <font color="#0000ff">write $system</font> <font color="#008080">.Status</font> <font color="#000000">.</font> <font color="#0000ff">GetErrorText</font> <font color="#000000">(ex.</font> <font color="#0000ff">AsStatus</font> <font color="#000000">(),</font> <font color="#008000">"pt-br"</font> <font color="#000000">),! <br></font> <font color="#800080">} <br></font> <font color="#000000">} <br> <br> }</font></code> <blockquote>  Note: you can, of course, use the macros described above. </blockquote>  Result: <br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">USER</span></span>&gt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">d</span></span> #<span class="hljs-selector-id"><span class="hljs-selector-id">#class</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">demo</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.test</span></span>)<span class="hljs-selector-class"><span class="hljs-selector-class">.Test</span></span>() , ! <span class="hljs-selector-tag"><span class="hljs-selector-tag">Hello</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">World</span></span>! , !  <span class="hljs-selector-id"><span class="hljs-selector-id">#822</span></span>:    <span class="hljs-selector-tag"><span class="hljs-selector-tag">ERROR</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#822</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Access</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Denied</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ERRO</span></span> <span class="hljs-selector-id"><span class="hljs-selector-id">#822</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">Acesso</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Negado</span></span></code> </pre> <br>  Pay attention to the following points: <br><ul><li>  messages for exceptions have already been translated into several languages.  Since these are system messages, the data for them is stored in the system global <b>% qCacheMsg</b> ; </li><li>  we set the domain name once, because the default $$$$ macro is designed for use in classes; </li><li>  Although the <b>$$$ Text</b> macro is intended for use in web applications, it is nevertheless quite suitable for offline environments. </li></ul><br><h4>  Web application localization example </h4><br>  Consider the following example: <br><br> <code><a href="http://www.intersystems.com/zen%2522"></a> <a href="http://www.intersystems.com/zen%2522"></a> <font color="#000080">/// Created using the page template: Default <br> Class demo.test Extends %ZEN.Component.page <br></font> <font color="#000000">{ <br> <br></font> <font color="#000080">///  ,    . <br> Parameter</font> <font color="#000000">APPLICATION; <br> <br></font> <font color="#000080">///     . <br> Parameter</font> <font color="#000000">PAGENAME; <br> <br></font> <font color="#000080">/// ,   . <br> Parameter</font> <font color="#000000">DOMAIN =</font> <font color="#800080">"asd"</font> <font color="#000000">; <br> <br></font> <font color="#000080">///   Style   CSS  . <br> XData</font> <font color="#000000">Style <br> { <br> &lt;</font> <font color="#000080">style</font> <font color="#800000">type</font> <font color="#000000">=</font> <font color="#008000">"text/css"</font> <font color="#000000">&gt; <br> &lt;/</font> <font color="#000080">style</font> <font color="#000000">&gt; <br> } <br> <br></font> <font color="#000080">///  XML     . <br> XData</font> <font color="#000000">Contents [</font> <font color="#000080">XMLNamespace</font> <font color="#000000">=</font> <font color="#800080">"www.intersystems.com/zen"</font> <font color="#000000">] <br> { <br> &lt;</font> <font color="#000080">page</font> <font color="#800000">xmlns</font> <font color="#000000">=</font> <font color="#008000">"www.intersystems.com/zen"</font> <font color="#800000">title</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#000000">&gt; <br> &lt;</font> <font color="#000080">checkbox</font> <font color="#800000">onchange</font> <font color="#000000">=</font> <font color="#008000">"zenPage.ChangeLanguage();"</font> <font color="#000000">/&gt; <br> &lt;</font> <font color="#000080">button</font> <font color="#800000">caption</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#800000">onclick</font> <font color="#000000">=</font> <font color="#008000">"zenPage.clientTest(2,3);"</font> <font color="#000000">/&gt; <br> &lt;</font> <font color="#000080">button</font> <font color="#800000">caption</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#800000">onclick</font> <font color="#000000">=</font> <font color="#008000">"zenAlert(zenPage.ServerTest(1,2));"</font> <font color="#000000">/&gt; <br> &lt;/</font> <font color="#000080">page</font> <font color="#000000">&gt; <br> } <br> <br></font> <font color="#000080">ClientMethod</font> <font color="#000000">clientTest( <br></font> <font color="#ff00ff">a</font> <font color="#000000">, <br></font> <font color="#ff00ff">b</font> <font color="#000000">) [</font> <font color="#000080">Language</font> <font color="#000000">= javascript ] <br> { <br> zenAlert( <br> $$$FormatText($$$Text(</font> <font color="#800000">"(1)^ %$# @*&amp;' %1=%2"</font> <font color="#000000">),</font> <font color="#800000">'"'</font> <font color="#000000">,a</font> <font color="#000080">+</font> <font color="#000000">b),</font> <font color="#800000">'\n'</font> <font color="#000000">, <br> zenText(</font> <font color="#800000">'msg3'</font> <font color="#000000">,a</font> <font color="#000080">+</font> <font color="#000000">b),</font> <font color="#800000">'\n'</font> <font color="#000000">, <br> $$$Text(</font> <font color="#800000">"  !"</font> <font color="#000000">) <br> ); <br> } <br> <br></font> <font color="#000080">ClassMethod</font> <font color="#000000">ServerTest( <br></font> <font color="#ff00ff">A</font> <font color="#000000">, <br></font> <font color="#ff00ff">B</font> <font color="#000000">)</font> <font color="#000080">As %String</font> <font color="#000000">[</font> <font color="#000080">ZenMethod</font> <font color="#000000">] <br> { <br></font> <font color="#800080">&amp;js&lt;</font> <font color="#000000">zenAlert(</font> <font color="#800000">#(</font> <font color="#000000">..</font> <font color="#0000ff">QuoteJS</font> <font color="#000000">(</font> <font color="#0000ff">$$$FormatText</font> <font color="#000000">(</font> <font color="#0000ff">$$$Text</font> <font color="#000000">(</font> <font color="#008000">"(2)^ %$# @*&amp;' ""=%1"</font> <font color="#000000">),A+B))</font> <font color="#800000">)#</font> <font color="#000000">);</font> <font color="#800080">&gt; <br></font> <font color="#0000ff">quit $$$TextJS</font> <font color="#000000">(</font> <font color="#008000">"  Cach√©!"</font> <font color="#000000">) <br> } <br> <br></font> <font color="#000080">Method</font> <font color="#000000">ChangeLanguage() [</font> <font color="#000080">ZenMethod</font> <font color="#000000">] <br> { <br></font> <font color="#0000ff">#dim</font> <font color="#000000">%session</font> <font color="#0000ff">as</font> <font color="#008080">%CSP.Session <br></font> <font color="#0000ff">set</font> <font color="#000000">%session.</font> <font color="#0000ff">Language</font> <font color="#000000">=</font> <font color="#0000ff">$select</font> <font color="#000000">(%session.</font> <font color="#0000ff">Language</font> <font color="#000000">=</font> <font color="#008000">"en"</font> <font color="#000000">:</font> <font color="#008000">"ru"</font> <font color="#000000">,1:</font> <font color="#008000">"en"</font> <font color="#000000">) <br></font> <font color="#800080">&amp;js&lt;</font> <font color="#000000">zenPage.gotoPage(</font> <font color="#800000">#(</font> <font color="#000000">..</font> <font color="#0000ff">QuoteJS</font> <font color="#000000">(..</font> <font color="#0000ff">Link</font> <font color="#000000">(</font> <font color="#0000ff">$classname</font> <font color="#000000">()_</font> <font color="#008000">".cls"</font> <font color="#000000">))</font> <font color="#800000">)#</font> <font color="#000000">);</font> <font color="#800080">&gt; <br></font> <font color="#000000">} <br> <br></font> <font color="#000080">Method</font> <font color="#000000">%OnGetJSResources(</font> <font color="#000080">ByRef</font> <font color="#ff00ff">pResources</font> <font color="#000080">As %String</font> <font color="#000000">)</font> <font color="#000080">As %Status</font> <font color="#000000">[</font> <font color="#000080">Private</font> <font color="#000000">] <br> { <br></font> <font color="#0000ff">Set</font> <font color="#000000">pResources(</font> <font color="#008000">"msg3"</font> <font color="#000000">) =</font> <font color="#0000ff">$$$Text</font> <font color="#000000">(</font> <font color="#008000">"(3)^ %$# @*&amp;' ""=%1"</font> <font color="#000000">) <br></font> <font color="#0000ff">Quit $$$OK <br></font> <font color="#000000">} <br> <br> }</font></code> <br> <br>  Of the innovations, the following should be noted: <br><ol><li>  There are two options for localizing messages on the client: <br><ul><li>  using the <i>$$$ Text</i> method, which is defined in the " <i>zenutils.js</i> " file; </li><li>  using the client-side <b>zenText ()</b> combination and the <b>% OnGetJSResources ()</b> server method </li></ul><br>  Details can be found in the documentation: <a href="">Localization for Client Side Text</a> </li><li>  Some attributes of the ZEN component already initially support localization, for example: all sorts of headers, hints, etc. <br>  If you need to create your own object-oriented components ‚Äî based on, for example, <u>jQuery</u> or <u>extJS</u> or from scratch ‚Äî you can use <br>  <b>% ZEN.Datatype.caption</b> special data type: <a href="">Localization for Zen Components</a> </li><li>  To change the language, you can use the <b>Language</b> property of the <b>% session</b> and / or <b>% response</b> : <a href="">Zen Special Variables</a> objects. </li></ol><br>  Initially, the language specified in the browser is used for the session: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bf4/d16/f7d/bf4d16f7d61a8740ab52d95354c4890a.png" alt="image"><br>  <a href=""><sup>to increase</sup></a> <br><br><h4>  Creating your own error message directory </h4><br>  The means discussed above are enough to do this. <br>  However, there is a built-in method that helps automate this process a bit. <br><br>  So let's get started. <br><br>  Create a file " <i>messages_ru.xml</i> " with error messages, as follows: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MsgFile</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Language</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ru"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MsgDomain</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"asd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Message</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ErrorName1"</span></span></span><span class="hljs-tag">&gt;</span></span>    1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Message</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Message</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-2"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ErrorName2"</span></span></span><span class="hljs-tag">&gt;</span></span>    2 %1 %2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Message</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MsgDomain</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MsgFile</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Import it into the database: <br> <code><font color="#0000ff">do</font> <font color="#000080">##class</font> <font color="#000000">(</font> <font color="#008080">%MessageDictionary</font> <font color="#000000">).</font> <font color="#0000ff">Import</font> <font color="#000000">(</font> <font color="#008000">"messages_ru.xml"</font> <font color="#000000">)</font></code> <br> <br>  Two globals were created in the base: <br><ul><li>  ^ CacheMsg <br><pre> <code class="hljs perl">USER&gt;zw ^CacheMsg ^CacheMsg(<span class="hljs-string"><span class="hljs-string">"asd"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,-<span class="hljs-number"><span class="hljs-number">2</span></span>)=<span class="hljs-string"><span class="hljs-string">"    2 %1 %2"</span></span> ^CacheMsg(<span class="hljs-string"><span class="hljs-string">"asd"</span></span>,<span class="hljs-string"><span class="hljs-string">"ru"</span></span>,-<span class="hljs-number"><span class="hljs-number">1</span></span>)=<span class="hljs-string"><span class="hljs-string">"    1"</span></span></code> </pre> <br></li><li>  ^ CacheMsgNames <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">USER</span></span>&gt;zw ^CacheMsgNames ^CacheMsgNames("asd",<span class="hljs-number"><span class="hljs-number">-2</span></span>)="ErrorName2" ^CacheMsgNames("asd",<span class="hljs-number"><span class="hljs-number">-1</span></span>)="ErrorName1"</code> </pre> </li></ul><br>  Generate an Include file with the name ‚ÄúCustomErrors‚Äù: <br><pre> <code class="hljs vbscript">USER&gt;<span class="hljs-keyword"><span class="hljs-keyword">Do</span></span> ##<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(%MessageDictionary).GenerateInclude(<span class="hljs-string"><span class="hljs-string">"CustomErrors"</span></span>,,<span class="hljs-string"><span class="hljs-string">"asd"</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) Generating CustomErrors.INC ...</code> </pre> <blockquote>  Note: For details, see the documentation for the <a href="">GenerateInclude ()</a> method. </blockquote><br>  File " <i>CustomErrors.inc</i> ": <br><br> <code><font color="#0000ff">#define</font> <font color="#000000">asdErrorName2</font> <font color="#008000">"&lt;asd&gt;-2" <br></font> <font color="#0000ff">#define</font> <font color="#000000">asdErrorName1</font> <font color="#008000">"&lt;asd&gt;-1"</font></code> <br> <br>  Now you can use error codes and / or abbreviated names of errors in the program, for example: <br><br> <code><font color="#000080">Include</font> <font color="#ff0000">CustomErrors <br> <br></font> <font color="#000080">Class demo.test</font> <font color="#000000">[</font> <font color="#000080">Abstract</font> <font color="#000000">] <br> { <br> <br></font> <font color="#000080">ClassMethod</font> <font color="#000000">test(</font> <font color="#ff00ff">A</font> <font color="#000080">As %Integer</font> <font color="#000000">)</font> <font color="#000080">As %Status <br></font> <font color="#000000">{ <br></font> <font color="#0000ff">if</font> <font color="#000000">A=1</font> <font color="#0000ff">Quit $$$ERROR</font> <font color="#000000">(</font> <font color="#0000ff">$$$asdErrorName1</font> <font color="#000000">) <br></font> <font color="#0000ff">if</font> <font color="#000000">A=2</font> <font color="#0000ff">Quit $$$ERROR</font> <font color="#000000">(</font> <font color="#0000ff">$$$asdErrorName2</font> <font color="#000000">,</font> <font color="#008000">"f"</font> <font color="#000000">,</font> <font color="#008000">"6"</font> <font color="#000000">) <br></font> <font color="#0000ff">Quit $$$OK <br></font> <font color="#000000">} <br> <br> }</font></code> <br> <br>  Results: <br><pre> <code class="hljs kotlin">USER&gt;d $system.OBJ.DisplayError(##<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>(demo.test).test(<span class="hljs-number"><span class="hljs-number">1</span></span>))  &lt;asd&gt;-<span class="hljs-number"><span class="hljs-number">1</span></span>:     <span class="hljs-number"><span class="hljs-number">1</span></span> USER&gt;d $system.OBJ.DisplayError(##<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>(demo.test).test(<span class="hljs-number"><span class="hljs-number">2</span></span>))  &lt;asd&gt;-<span class="hljs-number"><span class="hljs-number">2</span></span>:     <span class="hljs-number"><span class="hljs-number">2</span></span> f <span class="hljs-number"><span class="hljs-number">6</span></span> USER&gt;w $system.Status.GetErrorText(##<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>(demo.test).test(<span class="hljs-number"><span class="hljs-number">1</span></span>),<span class="hljs-string"><span class="hljs-string">"en"</span></span>) ERROR &lt;asd&gt;-<span class="hljs-number"><span class="hljs-number">1</span></span>: bla-bla-bla <span class="hljs-number"><span class="hljs-number">1</span></span> USER&gt;w $system.Status.GetErrorText(##<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>(demo.test).test(<span class="hljs-number"><span class="hljs-number">2</span></span>),<span class="hljs-string"><span class="hljs-string">"en"</span></span>) ERROR &lt;asd&gt;-<span class="hljs-number"><span class="hljs-number">2</span></span>: bla-bla-bla <span class="hljs-number"><span class="hljs-number">2</span></span> f <span class="hljs-number"><span class="hljs-number">6</span></span></code> </pre> <blockquote>  Note: Messages for the English language were created by analogy. </blockquote></div><p>Source: <a href="https://habr.com/ru/post/144312/">https://habr.com/ru/post/144312/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144307/index.html">So.cl: Microsoft's social search based social network.</a></li>
<li><a href="../144308/index.html">From idea to release. Manifest</a></li>
<li><a href="../144309/index.html">SASS vs. LESS</a></li>
<li><a href="../144310/index.html">Work with SSL / TLS in Cach√© DBMS</a></li>
<li><a href="../144311/index.html">Work with sockets in Cach√© DBMS. An example of the implementation of the server side of the protocol WebSocket</a></li>
<li><a href="../144313/index.html">Mdday # MoCO - conference for mobile developers</a></li>
<li><a href="../144314/index.html">DARPA peaceful competitions for military use</a></li>
<li><a href="../144317/index.html">Epigraph to perl 5.16.0</a></li>
<li><a href="../144318/index.html">ICANN finally solved the technical problems of the new domain zone application system</a></li>
<li><a href="../144319/index.html">Service for determining the direction of a satellite dish to a satellite or Dishpointer in Russian</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>