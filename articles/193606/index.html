<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Achtung!", Or Monitor the status of the project assembly</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To build a project, run tests and check the quality of the code, we (in the Mail.ru Calendar project) use Jenkins CI. Starting the assembly takes plac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Achtung!", Or Monitor the status of the project assembly</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/storage3/510/fb8/1a5/510fb81a527823c528848bacadcd2edb.jpg"></div><br>  To build a project, run tests and check the quality of the code, we (in the <a href="https://calendar.mail.ru/">Mail.ru Calendar</a> project) use Jenkins CI.  Starting the assembly takes place immediately after pushing to the git repository (according to the hook) and, of course, I want to receive timely information about the failed builds.  On the one hand, notifications by email seem to be enough, on the other hand, I want something more visible and fun. <br><a name="habracut"></a><br>  About three or four years ago, when I was working on another project, for similar purposes a flashing light was bought working from a 220-volt network, and the MP709 module (USB-relay) of the notorious MasterKit company was purchased to control it.  The decision was unsuccessful: firstly, this module did not have Linux support at that time (it was necessary to reverse the data exchange protocol and write its own ‚Äúdriver‚Äù under Linux), secondly, the location of the flasher limited the wires extending from the computer and from the socket.  Anyway, the design was thrown into the far box and waited in the wings. <br>  Recently, my hands once again itched, I wanted to do something interesting, but useless, and I remembered the flasher.  Having rummaged in a heap of rubbish, I fished out from there: Arduino Nano - two pieces, the relay module - one piece, the MX-05V receiver - one piece and the MX-FS-03V transmitter - one piece.  Thrusting the rest of the trash into the far corner of the balcony, waiting for my next hour, I proceeded to assemble the device. <br>  <i>Lyrical forgetting</i> : Once, long ago, when I was young and I had a lot of time, I would take a couple of AVR microcontrollers, erase the board, solder the device, program it in assembly language ... And get the same at the exit.  The pleasure from the process is greater, the result is the same. <br><br><h3>  Hardware </h3><br>  The scheme turned out to be extremely simple, since in our time a huge number of various electronic modules, constructors and units make it possible to assemble an electronic device to anyone who has never taken a soldering iron in his hands and has not studied circuit design and programming. Transmitter (Arduino Nano + MX-FS-03V) <br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/e66/3d3/371/e663d3371d5b5268d2cce07006f7f10c.jpg"></div><br>  Receiver (MX-05V + Arduino Nano + Relay Module): <br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/6d0/091/851/6d009185139b456506e8336802098d09.jpg"></div><br>  The principle of operation is even simpler: the Arduino connects to the computer‚Äôs USB port and listens to commands via a serial interface.  If the command is valid, it will be transmitted via a radio transmitter.  In the second block, the other Arduino listens to the receiver and when a command arrives, it either turns the relay on or off.  Everything.  No feedback, no checks (checksums), no logic. <br>  The transmitter program is as follows: <br><blockquote>  <font color="#339900">#include &lt;VirtualWire.h&gt;</font> <br><br>  <font color="#0000ff">int</font> ledPin <font color="#000080">=</font> <font color="#0000dd">13</font> <font color="#008080">;</font>  <font color="#666666">// pin with led on it</font> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <font color="#0000ff">char</font> incoming_byte <font color="#008080">;</font>  <font color="#666666">// a buffer to store the incoming messages</font> <br>  <font color="#0000ff">char</font> input_data <font color="#008000">[</font> <font color="#0000dd">12</font> <font color="#008000">]</font> <font color="#008080">;</font>  <font color="#666666">// the size of the message</font> <br>  <font color="#0000ff">int</font> input_size <font color="#000080">=</font> <font color="#0000dd">0</font> <font color="#008080">;</font>  <font color="#666666">// counter, just counter</font> <br><br>  <font color="#0000ff">void</font> setup <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">{</font> <br>  <font color="#666666">// setup led pin</font> <br>  pinMode <font color="#008000">(</font> ledPin, OUTPUT <font color="#008000">)</font> <font color="#008080">;</font> <br>  digitalWrite <font color="#008000">(</font> ledPin, LOW <font color="#008000">)</font> <font color="#008080">;</font> <br><br>  <font color="#666666">// initialize serial (9600 bps)</font> <br>  Serial.  <font color="#007788">begin</font> <font color="#008000">(</font> <font color="#0000dd">9600</font> <font color="#008000">)</font> <font color="#008080">;</font> <br>  Serial.  <font color="#007788">println</font> <font color="#008000">(</font> <font color="#FF0000">"Ready for achtung"</font> <font color="#008000">)</font> <font color="#008080">;</font> <br><br>  <font color="#666666">// initialize the IO and ISR</font> <br>  vw_set_ptt_inverted <font color="#008000">(</font> <font color="#0000ff">true</font> <font color="#008000">)</font> <font color="#008080">;</font>  <font color="#666666">// required for DR3100</font> <br>  vw_setup <font color="#008000">(</font> <font color="#0000dd">1200</font> <font color="#008000">)</font> <font color="#008080">;</font>  <font color="#666666">// bits per sec</font> <br>  <font color="#008000">}</font> <br><br>  <font color="#0000ff">void</font> loop <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">{</font> <br>  <font color="#0000ff">while</font> <font color="#008000">(</font> Serial. <font color="#007788">available</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#000080">&gt;</font> <font color="#0000dd">0</font> <font color="#008000">)</font> <font color="#008000">{</font> <br>  incoming_byte <font color="#000080">=</font> Serial.  <font color="#007788">read</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font>  <font color="#666666">// read the incoming byte</font> <br><br>  <font color="#0000ff">if</font> <font color="#008000">(</font> incoming_byte <font color="#000080">==</font> <font color="#FF0000">'n'</font> <font color="#008000">)</font> <font color="#008000">{</font> <br>  input_data <font color="#008000">[</font> input_size <font color="#000040">++</font> <font color="#008000">]</font> <font color="#000080">=</font> <font color="#0000dd">0</font> <font color="#008080">;</font> <br>  <font color="#0000ff">if</font> <font color="#008000">(</font> <font color="#0000dd">strncmp</font> <font color="#008000">(</font> input_data, <font color="#FF0000">"Achtung ON"</font> , <font color="#0000dd">10</font> <font color="#008000">)</font> <font color="#000080">==</font> <font color="#0000dd">0</font> <font color="#000040">||</font> <font color="#0000dd">strncmp</font> <font color="#008000">(</font> input_data, <font color="#FF0000">"Achtung OFF"</font> , <font color="#0000dd">11</font> <font color="#008000">)</font> <font color="#000080">==</font> <font color="#0000dd">0</font> <font color="#008000">)</font> <font color="#008000">{</font> <br>  digitalWrite <font color="#008000">(</font> ledPin, HIGH <font color="#008000">)</font> <font color="#008080">;</font> <br>  vw_send <font color="#008000">(</font> <font color="#008000">(</font> uint8_t <font color="#000040">*</font> <font color="#008000">)</font> input_data, input_size <font color="#008000">)</font> <font color="#008080">;</font> <br>  vw_wait_tx <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font>  <font color="#666666">// wait until the whole message is gone</font> <br>  digitalWrite <font color="#008000">(</font> ledPin, LOW <font color="#008000">)</font> <font color="#008080">;</font> <br><br>  Serial.  <font color="#007788">println</font> <font color="#008000">(</font> <font color="#FF0000">"OK"</font> <font color="#008000">)</font> <font color="#008080">;</font> <br>  <font color="#008000">}</font> <font color="#0000ff">else</font> <font color="#008000">{</font> <br>  Serial.  <font color="#007788">println</font> <font color="#008000">(</font> <font color="#FF0000">"FAIL"</font> <font color="#008000">)</font> <font color="#008080">;</font> <br>  <font color="#008000">}</font> <br>  <font color="#0000ff">while</font> <font color="#008000">(</font> input_size <font color="#000040">-</font> <font color="#000080">&gt; =</font> <font color="#0000dd">0</font> <font color="#008000">)</font> <font color="#008000">{</font> <br>  input_data <font color="#008000">[</font> input_size <font color="#008000">]</font> <font color="#000080">=</font> <font color="#0000dd">0</font> <font color="#008080">;</font> <br>  <font color="#008000">}</font> <br>  input_size <font color="#000080">=</font> <font color="#0000dd">0</font> <font color="#008080">;</font>  <font color="#666666">// reset counter</font> <br>  <font color="#008000">}</font> <font color="#0000ff">else</font> <font color="#008000">{</font> <br>  <font color="#0000ff">if</font> <font color="#008000">(</font> input_size <font color="#000080">&lt;=</font> <font color="#0000dd">11</font> <font color="#008000">)</font> <font color="#008000">{</font> <br>  input_data <font color="#008000">[</font> input_size <font color="#008000">]</font> <font color="#000080">=</font> incoming_byte <font color="#008080">;</font> <br>  <font color="#008000">}</font> <br>  input_size <font color="#000040">++</font> <font color="#008080">;</font> <br>  <font color="#008000">}</font> <br>  <font color="#008000">}</font> <br>  <font color="#008000">}</font> </blockquote><br>  Receiver program: <br><blockquote>  <font color="#339900">#include &lt;VirtualWire.h&gt;</font> <br><br>  <font color="#0000ff">int</font> ledPin <font color="#000080">=</font> <font color="#0000dd">13</font> <font color="#008080">;</font>  <font color="#666666">// pin with led on it</font> <br>  <font color="#0000ff">int</font> relayPin <font color="#000080">=</font> <font color="#0000dd">3</font> <font color="#008080">;</font>  <font color="#666666">// pin with relay on it</font> <br><br>  byte input_data <font color="#008000">[</font> VW_MAX_MESSAGE_LEN <font color="#008000">]</font> <font color="#008080">;</font>  <font color="#666666">// a buffer to store the incoming messages</font> <br>  byte input_size <font color="#000080">=</font> VW_MAX_MESSAGE_LEN <font color="#008080">;</font>  <font color="#666666">// the size of the message</font> <br><br>  <font color="#0000ff">void</font> setup <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">{</font> <br>  <font color="#666666">// setup led pin</font> <br>  pinMode <font color="#008000">(</font> ledPin, OUTPUT <font color="#008000">)</font> <font color="#008080">;</font> <br>  digitalWrite <font color="#008000">(</font> ledPin, LOW <font color="#008000">)</font> <font color="#008080">;</font> <br><br>  <font color="#666666">// setup relay pin</font> <br>  pinMode <font color="#008000">(</font> relayPin, OUTPUT <font color="#008000">)</font> <font color="#008080">;</font> <br>  digitalWrite <font color="#008000">(</font> relayPin, HIGH <font color="#008000">)</font> <font color="#008080">;</font> <br><br>  <font color="#666666">// initialize the IO and ISR</font> <br>  vw_set_ptt_inverted <font color="#008000">(</font> <font color="#0000ff">true</font> <font color="#008000">)</font> <font color="#008080">;</font>  <font color="#666666">// required for DR3100</font> <br>  vw_setup <font color="#008000">(</font> <font color="#0000dd">1200</font> <font color="#008000">)</font> <font color="#008080">;</font>  <font color="#666666">// bits per sec</font> <br>  vw_rx_start <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font>  <font color="#666666">// start the receiver</font> <br>  <font color="#008000">}</font> <br><br>  <font color="#0000ff">void</font> loop <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008000">{</font> <br>  <font color="#666666">// check if we have some data to process</font> <br>  <font color="#0000ff">if</font> <font color="#008000">(</font> vw_get_message <font color="#008000">(</font> input_data, <font color="#000040">&amp;</font> input_size <font color="#008000">)</font> <font color="#008000">)</font> <font color="#008000">{</font> <br>  digitalWrite <font color="#008000">(</font> ledPin, HIGH <font color="#008000">)</font> <font color="#008080">;</font> <br>  <font color="#0000ff">if</font> <font color="#008000">(</font> <font color="#0000dd">strncmp</font> <font color="#008000">(</font> <font color="#008000">(</font> <font color="#0000ff">char</font> <font color="#000040">*</font> <font color="#008000">)</font> input_data, <font color="#FF0000">"Achtung ON"</font> , <font color="#0000dd">10</font> <font color="#008000">)</font> <font color="#000080">==</font> <font color="#0000dd">0</font> <font color="#008000">)</font> <font color="#008000">{</font> <br>  digitalWrite <font color="#008000">(</font> relayPin, LOW <font color="#008000">)</font> <font color="#008080">;</font>  <font color="#666666">// achtung!</font>  <font color="#666666">turn relay on</font> <br>  <font color="#008000">}</font> <font color="#0000ff">else</font> <font color="#0000ff">if</font> <font color="#008000">(</font> <font color="#0000dd">strncmp</font> <font color="#008000">(</font> <font color="#008000">(</font> <font color="#0000ff">char</font> <font color="#000040">*</font> <font color="#008000">)</font> input_data, <font color="#FF0000">"Achtung OFF"</font> , <font color="#0000dd">11</font> <font color="#008000">)</font> <font color="#000080">==</font> <font color="#0000dd">0</font> <font color="#008000">)</font> <font color="#008000">{</font> <br>  digitalWrite <font color="#008000">(</font> relayPin, HIGH <font color="#008000">)</font> <font color="#008080">;</font>  <font color="#666666">// turn relay off</font> <br>  <font color="#008000">}</font> <font color="#0000ff">else</font> <font color="#008000">{</font> <br>  delay <font color="#008000">(</font> <font color="#0000dd">1000</font> <font color="#008000">)</font> <font color="#008080">;</font> <br>  <font color="#008000">}</font> <br>  digitalWrite <font color="#008000">(</font> ledPin, LOW <font color="#008000">)</font> <font color="#008080">;</font> <br>  <font color="#008000">}</font> <br>  <font color="#008000">}</font> </blockquote><br>  As you can see, everything is extremely simple.  We connect the microcontrollers, flash, respectively, the receiver and the transmitter using the built-in program in the Arduino bootloader, run the ‚ÄúSerial Monitor‚Äù connected to the transmitter, and send the on / off relay commands, as well as invalid commands (for testing): <br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/04e/dab/ce3/04edabce337c4dc32eeb21e59069c135.png"></div><br>  The relay turns on and off, everything works, everything is fine. <br>  It's time to disassemble the flasher and see where we place the receiver and the relay: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/bf4/955/d89/bf4955d89becae57efcb879235505fd7.jpg"></div><br>  We see that inside a lot of space.  We proceed to the assembly of the device, but first it is necessary to understand the power supply of the receiver. <br>  I did it simply: I took an old, unnecessary, power supply from a Nokia cell phone, took it apart and got a small fee that could power our receiver from 220 volts.  I have to note that the process of removing the board from the case turned out to be an incredibly difficult task.  The body is made of high quality plastic.  Nevertheless, I managed it: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/fe8/1a9/9fb/fe81a99fb74bc40a9f70c3734fc3e04e.jpg"></div><br>  We collect flasher with our receiver and power supply: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/242/db9/91b/242db991b12c45d81c0d80b8c58be2f8.jpg"></div><br>  We make sure that everything works: we turn on the device in the network and send the command ‚ÄúAchtung ON‚Äù via the ‚ÄúSerial Monitor‚Äù to the transmitter.  The relay is clicked, the light bulb is on fire, the engine is spinning, hurray!  We send the command ‚ÄúAchtung OFF‚Äù - everything stopped.  The flasher is working.  It remains only to attach the boards with screws and Chinese hot melt and assemble the entire structure in its original form. <br>  With the transmitter, I decided not to stand on ceremony and just soldered everything together: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage3/6d2/a37/cc1/6d2a37cc17088bf3365d784966f87daa.jpg"></div><br>  In the future I plan to pack it all in a beautiful case. <br><h3>  Software </h3><br>  In order to send commands from the computer to the transmitter, we write a simple script: <br><blockquote>  <font color="#808080">#! / usr / bin / env python</font> <br>  <font color="#483d8b">"" "</font> <font color="#483d8b"><br></font>  <font color="#483d8b">Send 'ON' or 'OFF' command to achtung transmitter.</font> <font color="#483d8b"><br></font>  <font color="#483d8b">"" "</font> <br>  <font color="#ff7700">from</font> <font color="#dc143c">__future__</font> <font color="#ff7700">import</font> print_function <br>  <font color="#ff7700">import</font> <font color="#dc143c">os</font> <br>  <font color="#ff7700">import</font> <font color="#dc143c">sys</font> <br>  <font color="#ff7700">import</font> serial <br><br><br>  <font color="#ff7700">if</font> __name__ == <font color="#483d8b">'__main__'</font> : <br>  <font color="#ff7700">if</font> <font color="#008000">len</font> <font>(</font> <font color="#dc143c">sys</font> . <font>argv</font> <font>)</font> <font color="#66cc66">!</font>  = <font color="#ff4500">3</font> : <br>  <font color="#ff7700">print</font> <font>(</font> <font color="#483d8b">"Usage: achtung / dev / ttyXX &lt;ON | OFF&gt;"</font> <font>)</font> <br>  <font color="#dc143c">sys</font> .  <font>exit</font> <font>(</font> <font color="#ff4500">1</font> <font>)</font> <br><br>  <font color="#dc143c">tty</font> = <font color="#dc143c">sys</font> .  <font>argv</font> <font>[</font> <font color="#ff4500">1</font> <font>]</font> <br>  <font color="#ff7700">if</font> <font color="#ff7700">not</font> <font color="#dc143c">os</font> .  <font>path</font> .  <font>exists</font> <font>(</font> <font color="#dc143c">tty</font> <font>)</font> : <br>  <font color="#ff7700">print</font> <font>(</font> <font color="#483d8b">"ERROR: device '% s' is not exists"</font> <font color="#66cc66">%</font> <font color="#dc143c">tty</font> <font>)</font> <br>  <font color="#dc143c">sys</font> .  <font>exit</font> <font>(</font> <font color="#ff4500">1</font> <font>)</font> <br><br>  command = <font color="#dc143c">sys</font> .  <font>argv</font> <font>[</font> <font color="#ff4500">2</font> <font>]</font> <br>  <font color="#ff7700">if</font> command <font color="#ff7700">not</font> <font color="#ff7700">in</font> <font>(</font> <font color="#483d8b">'ON'</font> , <font color="#483d8b">'OFF'</font> <font>)</font> : <br>  <font color="#ff7700">print</font> <font>(</font> <font color="#483d8b">"ERROR: unknown command '% s'"</font> <font color="#66cc66">%</font> command <font>)</font> <br>  <font color="#dc143c">sys</font> .  <font>exit</font> <font>(</font> <font color="#ff4500">1</font> <font>)</font> <br><br>  transmitter = serial.  <font>Serial</font> <font>(</font> <font color="#dc143c">tty</font> , <font color="#ff4500">9600</font> <font>)</font> <br><br>  <font color="#ff7700">if</font> transmitter.  <font color="#dc143c">readline</font> <font>(</font> <font>)</font> .  <font>strip</font> <font>(</font> <font>)</font> <font color="#66cc66">!</font>  = <font color="#483d8b">'Ready for achtung'</font> : <br>  <font color="#ff7700">print</font> <font>(</font> <font color="#483d8b">"ERROR: device is not initialized"</font> <font>)</font> <br>  <font color="#dc143c">sys</font> .  <font>exit</font> <font>(</font> <font color="#ff4500">1</font> <font>)</font> <br><br>  transmitter.  <font>write</font> <font>(</font> <font color="#483d8b">"Achtung% sn"</font> <font color="#66cc66">%</font> command <font>)</font> <br><br>  result = transmitter.  <font color="#dc143c">readline</font> <font>(</font> <font>)</font> .  <font>strip</font> <font>(</font> <font>)</font> <br>  <font color="#ff7700">if</font> result <font color="#66cc66">!</font>  = <font color="#483d8b">'OK'</font> : <br>  <font color="#ff7700">print</font> <font>(</font> <font color="#483d8b">"ERROR: device response is not OK"</font> <font>)</font> <br>  <font color="#dc143c">sys</font> .  <font>exit</font> <font>(</font> <font color="#ff4500">1</font> <font>)</font> </blockquote><br>  For the script to work, you must install the dependency - the <a href="http://pyserial.sourceforge.net/">pyserial</a> module: <pre>  pip install pyserial </pre>  We start, we enjoy the switched on / off flasher: <pre>  python achtung.py /dev/tty.usbserial-A900FYDU ON
     python achtung.py /dev/tty.usbserial-A900FYDU OFF </pre><br>  To obtain the status of assemblies in Jenkins CI, it is best to use the <a href="https://github.com/salimfadhley/jenkinsapi">jenkinsapi</a> module, in which case the script will turn out to be elementary.  Install dependencies: <pre>  pip install jenkinsapi </pre>  The script itself: <br><blockquote>  <font color="#808080">#! / usr / bin / env python</font> <br>  <font color="#483d8b">"" "</font> <font color="#483d8b"><br></font>  <font color="#483d8b">Check for Jenkins jobs status and run alarm if job is not OK.</font> <font color="#483d8b"><br></font>  <font color="#483d8b">"" "</font> <br>  <font color="#ff7700">import</font> <font color="#dc143c">os</font> <br>  <font color="#ff7700">import</font> <font color="#dc143c">sys</font> <br>  <font color="#ff7700">import</font> <font color="#dc143c">time</font> <br><br>  <font color="#ff7700">import</font> serial <br>  <font color="#ff7700">from</font> jenkinsapi.  <font>jenkins</font> <font color="#ff7700">import</font> Jenkins <br>  <font color="#ff7700">from</font> jenkinsapi.  <font color="#dc143c">exceptions</font> <font color="#ff7700">import</font> JenkinsAPIException <br><br><br>  URL = <font color="#483d8b">'http://jenkins.example.ru/'</font> <br>  USERNAME = <font color="#483d8b">'jenkins'</font> <br>  PASSWORD = <font color="#483d8b">'secret'</font> <br>  JOBS = <font>[</font> <font color="#483d8b">'build'</font> , <font color="#483d8b">'test'</font> , <font color="#483d8b">'lint'</font> <font>]</font> <br>  TTY = <font color="#483d8b">'/dev/tty.usbserial-A900FYDU'</font> <br><br><br>  <font color="#ff7700">def</font> job_failed <font>(</font> connect, job_name <font>)</font> : <br>  <font color="#483d8b">"" "</font> <font color="#483d8b"><br></font>  <font color="#483d8b">Returns boolean job status (True - success, False - fail).</font> <font color="#483d8b"><br></font>  <font color="#483d8b">"" "</font> <br>  <font color="#ff7700">if</font> job_name <font color="#ff7700">not</font> <font color="#ff7700">in</font> connect: <br>  <font color="#ff7700">return</font> <font color="#008000">true</font> <br><br>  last_build = connect <font>[</font> job_name <font>]</font> .  <font>get_last_build</font> <font>(</font> <font>)</font> <br><br>  <font color="#ff7700">if</font> last_build.  <font>is_running</font> <font>(</font> <font>)</font> : <br>  <font color="#ff7700">return</font> <font color="#008000">false</font> <br><br>  build_status = last_build.  <font>get_status</font> <font>(</font> <font>)</font> <br><br>  <font color="#ff7700">if</font> build_status <font color="#ff7700">in</font> <font>(</font> <font color="#483d8b">'FAIL'</font> , <font color="#483d8b">'FAILED'</font> , <font color="#483d8b">'FAILURE'</font> , <font color="#483d8b">'ERROR'</font> , <font color="#483d8b">'REGRESSION'</font> <font>)</font> : <br>  <font color="#ff7700">return</font> <font color="#008000">true</font> <br><br>  <font color="#ff7700">return</font> <font color="#008000">false</font> <br><br><br>  <font color="#ff7700">def</font> send_to_transmitter <font>(</font> device, command <font>)</font> : <br>  <font color="#483d8b">"" "</font> <font color="#483d8b"><br></font>  <font color="#483d8b">Send command to device and die on error.</font> <font color="#483d8b"><br></font>  <font color="#483d8b">"" "</font> <br>  device.  <font>write</font> <font>(</font> <font color="#483d8b">"Achtung% sn"</font> <font color="#66cc66">%</font> command <font>)</font> <br><br>  result = device.  <font color="#dc143c">readline</font> <font>(</font> <font>)</font> .  <font>strip</font> <font>(</font> <font>)</font> <br>  <font color="#ff7700">if</font> result <font color="#66cc66">!</font>  = <font color="#483d8b">'OK'</font> : <br>  <font color="#ff7700">print</font> <font>(</font> <font color="#483d8b">"ERROR: device response is not OK"</font> <font>)</font> <br>  <font color="#dc143c">sys</font> .  <font>exit</font> <font>(</font> <font color="#ff4500">1</font> <font>)</font> <br><br><br>  <font color="#ff7700">if</font> __name__ == <font color="#483d8b">'__main__'</font> : <br>  <font color="#ff7700">if</font> <font color="#ff7700">not</font> <font color="#dc143c">os</font> .  <font>path</font> .  <font>exists</font> <font>(</font> tty <font>)</font> : <br>  <font color="#ff7700">print</font> <font>(</font> <font color="#483d8b">"ERROR: device '% s' is not exists"</font> <font color="#66cc66">%</font> TTY <font>)</font> <br>  <font color="#dc143c">sys</font> .  <font>exit</font> <font>(</font> <font color="#ff4500">1</font> <font>)</font> <br><br>  <font color="#ff7700">try</font> : <br>  connect = Jenkins <font>(</font> URL, USERNAME, PASSWORD <font>)</font> <br><br>  <font color="#ff7700">if</font> <font color="#008000">any</font> <font>(</font> job_failed <font>(</font> connect, job_name <font>)</font> <font color="#ff7700">for</font> job_name <font color="#ff7700">in</font> JOBS <font>)</font> : <br>  transmitter = serial.  <font>Serial</font> <font>(</font> TTY, <font color="#ff4500">9600</font> <font>)</font> <br><br>  <font color="#ff7700">if</font> transmitter.  <font color="#dc143c">readline</font> <font>(</font> <font>)</font> .  <font>strip</font> <font>(</font> <font>)</font> <font color="#66cc66">!</font>  = <font color="#483d8b">'Ready for achtung'</font> : <br>  <font color="#ff7700">print</font> <font>(</font> <font color="#483d8b">"ERROR: device is not initialized"</font> <font>)</font> <br>  <font color="#dc143c">sys</font> .  <font>exit</font> <font>(</font> <font color="#ff4500">1</font> <font>)</font> <br><br>  send_to_transmitter <font>(</font> transmitter, <font color="#483d8b">'ON'</font> <font>)</font> <br>  <font color="#dc143c">time</font> .  <font>sleep</font> <font>(</font> <font color="#ff4500">5</font> <font>)</font> <br>  send_to_transmitter <font>(</font> transmitter, <font color="#483d8b">'OFF'</font> <font>)</font> <br><br>  <font color="#ff7700">except</font> JenkinsAPIException: <br>  <font color="#dc143c">sys</font> .  <font>exit</font> <font>(</font> <font color="#ff4500">1</font> <font>)</font> </blockquote><br>  The launched script connects to Jenkins, gets the status of these tasks and, if one of them fails, turns on the flasher for five seconds (this is done so that the blinking does not irritate, but made it clear that the build failed).  The script runs in the crown every minute from 11:00 to 20:00 on weekdays (the working time of our employees) - it makes no sense to turn on the flasher in the night or on the weekend. <br>  Of course, it was possible not to pour the results of the assemblies, but to configure Jenkins so that if an unsuccessful assembly he initiated the inclusion of the flashing lights, but the security requirements in our company exclude this possibility: any connections from the network to the servers to the office network are strictly prohibited. <br><h3>  Profit! </h3><br>  Everything is set up, it works, and it pleases all developers (except the one that sfailil build) with cheerful blinking at the most opportune moment. <br>  Sources: <a href="https://github.com/dreadatour/jenkins-achtung">https://github.com/dreadatour/jenkins-achtung</a> . <br><br>  <b>Update</b> : video of the device: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/sfUy-B4XUYQ&amp;xid=17259,15700019,15700186,15700190,15700253,15700255&amp;usg=ALkJrhgIDBbVk6Bs_GW9mqxPTWGRU3UCeg" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/193606/">https://habr.com/ru/post/193606/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../193588/index.html">Protect the Internet, or Hands off, cursed NSA, from the brainchild of the military-industrial complex!</a></li>
<li><a href="../193592/index.html">What is silent Gantt chart or why projects are always late</a></li>
<li><a href="../193594/index.html">Report from the hacker tournament and security conference with Mitnick</a></li>
<li><a href="../193598/index.html">Once again about Deferred / Promise</a></li>
<li><a href="../193600/index.html">What kids think about programmers and programming</a></li>
<li><a href="../193608/index.html">Congratulations on the Day of the programmer!</a></li>
<li><a href="../193610/index.html">Board game teaching children programming</a></li>
<li><a href="../193612/index.html">Happy programmer!</a></li>
<li><a href="../193616/index.html">‚ÄúA failed experiment on the set‚Äù, or a new format of commercials</a></li>
<li><a href="../193618/index.html">Hacker-friendly software-defined radio</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>