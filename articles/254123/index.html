<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Why bash script or carriage return did not work</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I wrote my configuration file for Conky. I wanted to make a withdrawal of the dollar and the euro against the ruble and calculate the dynamics of the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Why bash script or carriage return did not work</h1><div class="post__text post__text-html js-mediator-article">  I wrote my configuration file for Conky.  I wanted to make a withdrawal of the dollar and the euro against the ruble and calculate the dynamics of the courses.  The task is not complicated, so I quickly wrote a bash script.  Exchange rates decided to take from the site of the <a href="http://www.cbr.ru/">CBRF</a> . <br><br>  The script turned out like this: <br><a name="habracut"></a><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash now=`date +%d/%m/%Y` onedayago=`date --date="1 day ago" +%d/%m/%Y` twodayago=`date --date="2 day ago" +%d/%m/%Y` wget -O now.tmp -q "http://www.cbr.ru/scripts/XML_daily.asp?date_req=$now" wget -O onedayago.tmp -q "http://www.cbr.ru/scripts/XML_daily.asp?date_req=$onedayago" wget -O twodayago.tmp -q "http://www.cbr.ru/scripts/XML_daily.asp?date_req=$twodayago" nowk=`cat now.tmp | grep "USD" -A3 | sed -n -e 4p | tr -d "A-Za-z&lt;&gt;/\t'" | sed -es/\,/\./` onedayagok=`cat onedayago.tmp | grep "USD" -A3 | sed -n -e 4p | tr -d "A-Za-z&lt;&gt;/\t" | sed -es/\,/\./` twodayagok=`cat twodayago.tmp | grep "USD" -A3 |sed -n -e 4p | tr -d "A-Za-z&lt;&gt;/\t" ` dinamika=`echo $onedayagok-$nowk | bc` echo $dinamika</span></span></code> </pre> <br><br>  However, when I ran the script, I received the error message: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>(standard_in) 1: illegal character: ^ M</b> <b><br></b>  <b>(standard_in) 1: illegal character: ^ M</b> <br><br><img src="https://habrastorage.org/files/b00/d02/e9f/b00d02e9fd744b5781cae19d017e9ca0.png"><br><br>  What's the matter?  I decided to look at the variables separately.  Added two lines: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$nowk</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$onedayagok</span></span></code> </pre><br>  The output of the variables was correct: <br><br><img src="https://habrastorage.org/files/dfa/220/fbd/dfa220fbd65a46e8bacb7153a9d6d73c.png"><br><br>  Maybe a string error <pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$onedayagok</span></span>-<span class="hljs-variable"><span class="hljs-variable">$nowk</span></span></code> </pre>  ?  Add the output of this line with the command <pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$onedayagok</span></span>-<span class="hljs-variable"><span class="hljs-variable">$nowk</span></span></code> </pre> <br><br><img src="https://habrastorage.org/files/10b/ee4/e9a/10bee4e9a45247f88fea22bbc05b3388.png"><br><br>  Only -58.7710 was output.  What happened to 59.4452?  This is where the difficulties arose.  I decided to record the output of the operation result in the file, added&gt; 1.txt and&gt; 2.txt after processing the data, that is, it turned out like this: <br><br><pre> <code class="bash hljs">nowk=`cat now.tmp | grep <span class="hljs-string"><span class="hljs-string">"USD"</span></span> -A3 | sed -n -e 4p | tr -d <span class="hljs-string"><span class="hljs-string">"A-Za-z&lt;&gt;/\t"</span></span> | sed -es/\,/\./ &gt;1.txt` onedayagok=`cat onedayago.tmp | grep <span class="hljs-string"><span class="hljs-string">"USD"</span></span> -A3 | sed -n -e 4p | tr -d <span class="hljs-string"><span class="hljs-string">"A-Za-z&lt;&gt;/\t"</span></span> | sed -es/\,/\./ &gt;2.txt`</code> </pre><br>  It looked fine, the numbers were successfully entered into the file. <br><br><img src="https://habrastorage.org/files/4ab/912/3b5/4ab9123b57f648fd8458f12e8293b985.png"><br><br>  Began to study a rather strange and unexpected problem further.  I decided to create a file myself with the same content.  Using the text editor nano, create a 3.txt file and enter 59.4452 into it.  In the file 4.txt enter 58.7710.  In the script, add the reading from the file, that is: <br><br><pre> <code class="bash hljs">nowk=`cat 3.txt` onedayagok=`cat 4.txt`</code> </pre><br>  Everything worked.  It has become obvious that the problem is in the data obtained.  You just had to analyze the files 2.txt and 3.txt.  Next, open both files with a hex editor and find the very difference: <br><br><img src="https://habrastorage.org/files/950/8ba/a4e/9508baa4e3214952856ae1c2fec57a10.png"><br><br>  The files are almost identical, but 0D is present in the 2.txt file.  With the help of a search engine we find that OD is ‚Äúcarriage transfer‚Äù.  That is, with the echo $ onedayagok- $ nowk command, the value of the onedayagok variable was first displayed, then from the beginning of the line in the same line, the variable nowk was displayed, that is, it overlapped the previous variable.  Using the same search engine, we learn that in order to remove the "map" we add '\ r' to the tr utility, that is, like this: <br><br><pre> <code class="bash hljs">nowk=`cat now.tmp | grep <span class="hljs-string"><span class="hljs-string">"USD"</span></span> -A3 | sed -n -e 4p | tr -d <span class="hljs-string"><span class="hljs-string">"A-Za-z&lt;&gt;/\t'\r'"</span></span> | sed -es/\,/\./` onedayagok=`cat onedayago.tmp | grep <span class="hljs-string"><span class="hljs-string">"USD"</span></span> -A3 | sed -n -e 4p | tr -d <span class="hljs-string"><span class="hljs-string">"A-Za-z&lt;&gt;/\t'\r"</span></span> | sed -es/\,/\./` twodayagok=`cat twodayago.tmp | grep <span class="hljs-string"><span class="hljs-string">"USD"</span></span> -A3 |sed -n -e 4p | tr -d <span class="hljs-string"><span class="hljs-string">"A-Za-z&lt;&gt;/\t'\r'"</span></span> ``</code> </pre><br><img src="https://habrastorage.org/files/0e6/9e3/507/0e69e350741d4896b978b91c5feec117.png"><br><br>  We are convinced that the script now works.  The CBR returns this with a ‚Äúcarriage return.‚Äù  That was the problem.  Unfortunately, such nuances are not told in textbooks and articles on bash, so such difficulties may arise. </div><p>Source: <a href="https://habr.com/ru/post/254123/">https://habr.com/ru/post/254123/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254113/index.html">How to create and earn SaaS | Part 16 | Own mobile network WI-FI</a></li>
<li><a href="../254115/index.html">Binding and xaml markup extensions using localization as an example</a></li>
<li><a href="../254117/index.html">Servers for business: energy efficiency matters</a></li>
<li><a href="../254119/index.html">The warden for the freelancer: choose the system of accounting of working time</a></li>
<li><a href="../254121/index.html">Great review testing of programming languages</a></li>
<li><a href="../254127/index.html">The Legend of Temptation: How to use Python to automate iOS</a></li>
<li><a href="../254129/index.html">I will calculate you over the networks: use the API of the largest social networks for my own selfish purposes</a></li>
<li><a href="../254131/index.html">Dedovskoye UX design: coder - pest</a></li>
<li><a href="../254133/index.html">Prologue - a declarative language capable of solving any rebuses and proving theorems</a></li>
<li><a href="../254137/index.html">How is the IT reception in Mail.Ru Group</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>