<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interpolation of data: we connect points so that it was beautiful</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How to build a graph for n points? The simplest thing is to mark them with markers on the coordinate grid. However, for clarity, they want to connect ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interpolation of data: we connect points so that it was beautiful</h1><div class="post__text post__text-html js-mediator-article">  How to build a graph for <i>n</i> points?  The simplest thing is to mark them with markers on the coordinate grid.  However, for clarity, they want to connect to get an easily readable line.  The easiest way to connect the points is by straight lines.  But the graph-line is quite difficult to read: the look clings to the corners, and does not slide along the line.  Yes, and look kinks are not very beautiful.  It turns out that in addition to broken lines, you need to be able to build curves.  However, you need to be careful not to get this: <br><img src="https://habrastorage.org/files/d38/3c5/571/d383c5571fa545e9a011c4971a971d72.png"><br><a name="habracut"></a><br><br><h4>  Little materiel </h4><br>  Recovery of intermediate values ‚Äã‚Äãof a function, which in this case is given in tabular form as points <i>P</i> <sub>1</sub> ... <i>P <sub>n</sub></i> , is called interpolation.  There are many interpolation methods, but all of them can be reduced to finding the <i>n</i> - 1 function to calculate intermediate points on the corresponding segments.  In this case, the given points must be computable through the corresponding functions.  Based on this, a graph can be built: <br><img src="https://habrastorage.org/files/210/caa/54e/210caa54e912429ea6d55b14dd7f6d85.png" width="320" height="143"><br><br>  The functions <i>f <sub>i</sub></i> can be very different, but most often they use polynomials of some degree.  In this case, the final interpolating function (piecewise defined on the intervals bounded by points <i>P <sub>i</sub></i> ) is called a <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BF%25D0%25BB%25D0%25B0%25D0%25B9%25D0%25BD">spline</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In different graphing tools ‚Äî editors and libraries ‚Äî the problem of ‚Äúbeautiful interpolation‚Äù is solved differently.  At the end of the article there will be a small overview of the existing options.  Why at the end?  So that after a number of the above calculations and reflections it was possible to guess which of the "serious guys" use what methods. <br><br><h4>  Set up experiments </h4><br>  The simplest example is linear interpolation, in which polynomials of the first degree are used, and as a result we get a polyline connecting the given points. <br>  Let's add some specifics.  Here is a set of points (taken <i>almost</i> from the ceiling): <br><pre><code class="hljs">0 0 20 0 45 -47 53 335 57 26 62 387 74 104 89 0 95 100 100 0</code> </pre> <br>  The result of linear interpolation of these points is as follows: <br><img src="https://habrastorage.org/files/4ef/c5a/f05/4efc5af05f4444608e0de75386b91252.png"><br><br>  However, as noted above, sometimes you want to end up with a smooth curve. <br><br>  What is smoothness?  Household answer: no sharp corners.  Mathematical: continuity of derivatives.  Moreover, in mathematics, smoothness has an order equal to the number of the last continuous derivative, and the area on which this continuity is preserved.  That is, if the function has a smoothness of order 1 on the segment [ <i>a</i> ;  <i>b</i> ], this means that on [ <i>a</i> ;  <i>b</i> ] it has a continuous first derivative, but the second derivative already suffers a gap at some points. <br>  A spline in the context of smoothness is the concept of a defect.  A spline defect is the difference between its degree and its smoothness.  The degree of the spline is the maximum degree of the polynomials used in it. <br>  It is important to note that the ‚Äúdangerous‚Äù points of the spline (at which smoothness can be broken) are just <i>P <sub>i</sub></i> , that is, the junction points of the segments at which the transition from one polynomial to another occurs.  All other points are ‚Äúsafe‚Äù, because a polynom on the domain of its definition has no problems with the continuity of derivatives. <br>  In order to achieve smooth interpolation, it is necessary to increase the degree of polynomials and choose their coefficients so that the continuity of the derivatives is preserved at the boundary points. <br><br>  Traditionally, to solve this problem, polynomials of the third degree are used and the continuity of the first and second derivatives is achieved.  What turns out is called the <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D1%2583%25D0%25B1%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D1%2581%25D0%25BF%25D0%25BB%25D0%25B0%25D0%25B9%25D0%25BD">cubic spline of defect 1</a> .  Here is how it looks for our data: <br><img src="https://habrastorage.org/files/788/1e8/66e/7881e866e21c4b4b886c824afb093cec.png"><br><br>  The curve is really smooth.  But if we assume that this is a schedule of some process or phenomenon that needs to be shown to an interested person, then this method is most likely not suitable.  The problem is in false extremes.  They appeared due to too much curvature, which was intended to ensure the smoothness of the interpolation function.  But this behavior is not at all useful to the viewer, because he is deceived about the peak values ‚Äã‚Äãof the function.  And for the sake of visual visualization of these values, in fact, everything was started. <br>  So you need to look for other solutions. <br><br>  Another traditional solution, except for cubic splines of defect 1, is Lagrange polynomials.  These are polynomials of degree <i>n</i> - 1 that take given values ‚Äã‚Äãat given points.  That is, division into segments does not occur here; the entire sequence is described by one polynomial. <br>  But what happens is: <br><img src="https://habrastorage.org/files/886/7eb/f75/8867ebf759df439cbe653b60eac98d2c.png"><br><br>  Smoothness, of course, is present, but visibility has suffered so much that ... perhaps I should look for other methods.  On some data sets, the result is normal, but in general, the error with respect to linear interpolation (and, accordingly, false extremes) may be too large - due to the fact that there is only one polynomial for all segments. <br><br>  In computer graphics, <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D1%2580%25D0%25B8%25D0%25B2%25D0%25B0%25D1%258F_%25D0%2591%25D0%25B5%25D0%25B7%25D1%258C%25D0%25B5">Bezier curves</a> , represented by <i>kth-</i> degree polynomials, are very widely used. <br>  They are not interpolating, because of the <i>k</i> + 1 points involved in the construction, the final curve passes only through the first and the last.  The remaining <i>k</i> - 1 points play the role of a kind of "gravitational centers" that attract the curve to itself. <br>  Here is an example of a cubic Bezier curve: <br><img src="https://habrastorage.org/files/690/00e/c33/69000ec334ae4a769cb9ed1c68180185.gif"><br><br>  How can this be used for interpolation?  On the basis of these curves, it is also possible to construct a spline.  That is, each segment of the spline will have its <i>k</i> -th Bezier curve (by the way, <i>k</i> = 1 gives linear interpolation).  And the only question is what <i>k</i> to take and how to find <i>k</i> - 1 intermediate point. <br>  There are infinitely many options (since <i>k</i> is not limited by anything), but we will consider the classic: <i>k</i> = 3. <br>  In order for the final curve to be smooth, you need to achieve defect 1 for the spline being made, that is, to preserve the continuity of the first and second derivatives at the junction points of the segments ( <i>P <sub>i</sub></i> ), as is done in the classical version of the cubic spline. <br>  The solution to this problem in detail (with source code) is discussed <a href="https://www.particleincell.com/2012/bezier-splines/">here</a> . <br>  This is what happens on our test suite: <br><img src="https://habrastorage.org/files/be3/ae2/5da/be3ae25da40c4a7bbaf498de7c5dce72.png"><br><br>  It has become better: there are still false extremes, but at least they are not so different from the real ones. <br><br><h4>  We think and experiment </h4><br>  You can try to weaken the smoothness condition: require defect 2, not 1, that is, to maintain the continuity of the first derivative alone. <br>  A sufficient condition for attaining defect 2 is that the intermediate control points of the cubic Bezier curve adjacent to a given point of the interpolated sequence lie with this point on one straight line and at the same distance: <br><img src="https://habrastorage.org/files/0d7/124/e2a/0d7124e2a77744bb94ae8a92a7ed1162.png" width="320" height="232"><br><br>  As straight lines on which the points <i>C</i> <sub><i>i</i> - 1</sub> <sup>(2)</sup> , <i>P <sub>i</sub> and C</i> <sub><i>i</i></sub> <sup>(1)</sup> lie, it is advisable to take the tangents to the graph of the interpolated function at the points <i>P <sub>i</sub></i> .  This guarantees the absence of false extremes, since the Bezier curve turns out to be a bounded broken line built on its control points (if this broken line has no self-intersections). <br><br>  The trial and error method of heuristics for calculating the distance from the point of the interpolated sequence to the intermediate control one turned out to be as follows: <br><div class="spoiler">  <b class="spoiler_title">Heuristics 1</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/282/0b9/00e/2820b900e4314142ec37fa341a6544f4.png" alt="image"><br></div></div><br>  The first and last intermediate control points are equal to the first and last points of the graph, respectively (points <i>C</i> <sub>1</sub> <sup>(1)</sup> and <i>C</i> <sub><i>n</i> - 1</sub> <sup>(2)</sup> coincide with points <i>P</i> <sub>1</sub> and <i>P <sub>n,</sub></i> respectively). <br>  In this case, the result is such a curve: <br><img src="https://habrastorage.org/files/022/472/cec/022472cec60c412187ec74ab72bf51ec.png"><br><br>  As you can see, there are no false extremes anymore.  However, when compared with linear interpolation, in some places the error is very large.  You can make it even less, but even more clever heuristics will be used in the course. <br><br>  We have come to the current version, reducing the smoothness by one order of magnitude.  You can do it again: let the spline have a defect of 3. In fact, the function will not formally be smooth at all: even the first derivative can tolerate discontinuities.  But if you tear it gently, visually nothing terrible will happen. <br>  We refuse the requirement of equality of distances from point <i>P <sub>i</sub></i> to points <i>C</i> <sub><i>i</i> - 1</sub> <sup>(2)</sup> and C <sub><i>i</i></sub> <sup>(1)</sup> , but at the same time we keep them all lying on one straight line: <br><img src="https://habrastorage.org/files/237/911/fe5/237911fe5e624468864c869ffb964f9b.png" width="320" height="232"><br><br>  The heuristics for calculating distances will be: <br><div class="spoiler">  <b class="spoiler_title">Heuristics 2</b> <div class="spoiler_text">  The calculation of <i>l</i> <sub>1</sub> and <i>l</i> <sub>2</sub> is the same as in ‚Äúheuristics 1‚Äù. <br>  At the same time, however, it is worth checking whether the points <i>P <sub>i</sub></i> and <i>P</i> <sub><i>i</i> + 1</sub> did not coincide on the ordinate, and, if they did, assume <i>l</i> <sub>1</sub> = <i>l</i> <sub>2</sub> = 0. This will protect the chart from ‚Äúswelling‚Äù on flat segments (which also It is important from the point of view of truthful data display). <br></div></div><br>  The result is: <br><img src="https://habrastorage.org/files/f2b/978/aea/f2b978aea25d43f7bf063f2db523f031.png"><br><br>  As a result, in the sixth segment, the error decreased, and in the seventh segment it increased: Bezier‚Äôs curvature turned out to be greater than desired.  The situation can be rectified by forcibly reducing the curvature and thereby ‚Äúpressing‚Äù Bezier closer to the line segment that connects the boundary points of the segment.  To do this, use the following heuristics: <br><div class="spoiler">  <b class="spoiler_title">Heuristics 3</b> <div class="spoiler_text">  If the abscissa of the point of intersection of the tangents at the points <i>P <sub>i</sub></i> ( <i>x <sub>i</sub></i> , <i>y <sub>i</sub></i> ) and <i>P</i> <sub><i>i</i> + 1</sub> ( <i>x</i> <sub><i>i</i> + 1</sub> , <i>y</i> <sub><i>i</i> + 1</sub> ) lies in the segment [ <i>x <sub>i</sub></i> ;  <i>x</i> <sub><i>i</i> + 1</sub> ], then <i>l</i> <sub>1</sub> or <i>l</i> <sub>2 is set</sub> equal to zero.  In that case, if the tangent at point <i>P <sub>i is</sub></i> directed upwards, we assume zero as the maximum of <i>l</i> <sub>1</sub> and <i>l</i> <sub>2</sub> , if down is the minimum. <br></div></div><br>  The result is as follows: <br><img src="https://habrastorage.org/files/1f2/a4d/4ff/1f2a4d4ff966468ea2e51f84107d1cd5.png"><br><br>  At this decision was made to recognize the goal achieved. <br>  Maybe someone handy <a href="https://gist.github.com/anonymous/06f4104d93f6cef6f341">code</a> . <br><br><h4>  And how do people do something? </h4><br>  Promised review.  Of course, before the solution of the problem, we looked at who could boast something, and only then began to figure out how to do it ourselves and, if possible, better.  But as soon as they did, it was not without pleasure that we once again walked through the available instruments and compared their results with the results of our experiments.  So let's go. <br><br><h5>  MS Excel </h5><br><img src="https://habrastorage.org/files/a35/39a/5e3/a3539a5e3c0a492fb4b5643dfaa58c80.png"><br><br>  This is very similar to the spline 1 defect discussed above, based on Bezier curves.  True, unlike him in its pure form, there are only two false extremes - the first and second segments (we had four).  Apparently, <i>some</i> heuristics are added here to the classical search for intermediate control points.  But they didn‚Äôt save them from all the false extremes. <br><br><h5>  LibreOffice Calc </h5><br><img src="https://habrastorage.org/files/03e/118/a6b/03e118a6b5094f7daafa9c35a715dec0.png"><br><br>  In the settings, this is called a cubic spline.  Obviously, it is also based on Bezier, and here is an exact copy of our result: all four false extrema are in place. <br><br>  There is another type of interpolation that we did not consider here: B-spline.  But for our task, it is clearly not suitable, since it gives this result :) <br><img src="https://habrastorage.org/files/b3c/e40/f39/b3ce40f39edc464ab622f1bf6f31295b.png"><br><br><h5>  <a href="http://www.highcharts.com/">Highcharts</a> , one of the most popular JS-libraries for charting </h5><br><img src="https://habrastorage.org/files/394/a19/84e/394a1984e7444230860fd03fbe505992.png"><br><br>  Here there is a ‚Äútangent method‚Äù in the variant of equality of distances from the point of the interpolated sequence to the intermediate control ones.  There are no false extremums, but there is a relatively large error regarding linear interpolation (the seventh segment). <br><br><h5>  <a href="http://www.amcharts.com/">amCharts</a> , another popular JS library </h5><br><br><img src="https://habrastorage.org/files/b03/816/fc1/b03816fc13164935941a617d530711e2.png"><br><br>  The picture is very similar to Excel, the same two false extremes in the same places. <br><br><h5>  <a href="https://github.com/core-plot/core-plot">Coreplot</a> , the most popular graphing library for iOS and OS X </h5><br><img src="https://habrastorage.org/files/6db/c7c/6e9/6dbc7c6e9b5c4bd7bb7bb1789389fd86.png"><br><br>  There are false extremes and it is clear that the spline of defect 1 based on Bezier is used. <br>  The library is open, so you can look into the code and see this. <br><br><h5>  <a href="http://www.achartengine.org/">aChartEngine</a> , such as the most popular charting library for Android </h5><br><img src="https://habrastorage.org/files/eb9/ef4/3ac/eb9ef43acc9544299d520c9426ab2ee9.png"><br><br>  Most similar to the Bezier curve of degree <i>n</i> - 1, although in the library itself the graph is called ‚Äúcubic line‚Äù.  Strange!  Be that as it may, not only are there false extremes, but in principle the interpolation conditions are not fulfilled. <br><br><h4>  Instead of conclusion </h4><br>  Ultimately, it turns out that Highcharts solved the problem best of the ‚Äúbig guys‚Äù.  But the method described in this article provides an even smaller error regarding linear interpolation. <br>  In general, we had to do this at the request of buyers, who reported to us "sharp corners" as a bug in our <a href="http://nchart3d.com/">chart engine</a> .  We will be glad if the described experience is useful to someone. </div><p>Source: <a href="https://habr.com/ru/post/264191/">https://habr.com/ru/post/264191/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264175/index.html">Real-time stateful React components update for Browserify</a></li>
<li><a href="../264179/index.html">Writing a bot for Tox messenger</a></li>
<li><a href="../264181/index.html">RPC, Messaging, REST: Terminology</a></li>
<li><a href="../264185/index.html">Modern Adaptec RAID controllers from A to Z. Part 2</a></li>
<li><a href="../264189/index.html">Implementation of the wave algorithm for finding the shortest path to dynamically moving objects in unity3d on C # in a 2d game</a></li>
<li><a href="../264193/index.html">How to find out the year of release of the song on the set of audio characteristics?</a></li>
<li><a href="../264195/index.html">Hybrid Conf - the first conference on programmatic-advertising in Russia</a></li>
<li><a href="../264197/index.html">HDD sled - cost effective grain</a></li>
<li><a href="../264199/index.html">Triggers and Background Jobs in Windows Store Applications</a></li>
<li><a href="../264201/index.html">Intervals in C ++, part 1: Intervals with limiters</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>