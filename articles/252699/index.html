<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Protection against cheating in online games</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is an article about how we made the HTML5 browser protection system for games against hacking and falsifying results, what difficulties we encoun...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Protection against cheating in online games</h1><div class="post__text post__text-html js-mediator-article">  This is an article about how we made the HTML5 browser protection system for games against hacking and falsifying results, what difficulties we encountered while doing this, how we solved them and what we got in the end.  The main and all familiar problem of such games is the possibility of writing a bot that this game will automatically pass.  The development of such a bot is facilitated by the fact that the game code is in the public domain.  The situation was complicated by the fact that real prizes were announced, including the iPad, concert tickets, USB flash drives, etc. <br><br><img src="https://habrastorage.org/files/ad5/98e/8d5/ad598e8d53ee4cd6bb267c26ba637a0a.png"><br><br>  The article will be useful mainly to those who make HTML5 / Flash games and care about their safety;  those who pay to develop these games;  and some to those who are called upon to fight bots.  And, of course, those who wrote this article.  Because we hope that it will be the beginning of a productive discussion about how browser game developers can resist cyber-fraudsters. <br><a name="habracut"></a><br><h4>  What game is this? </h4><br>  <strong>A little about the game itself.</strong> <br>  Unfortunately, the game itself, we can not show at the request of the customer.  Despite all the techniques described below, unfortunately, ‚Äúignorance‚Äù is a key element of protection.  That is, the disclosure of methods in relation to a particular game will significantly reduce their effectiveness. <br><ul><li>  Game type: Collect &amp; Run. </li><li>  Examples: a familiar Mario Bros.  and his clones </li><li>  Duration of the game: about 1-2 minutes. </li><li>  Purpose of the game: to score the most points. </li><li>  The main elements of the game: <br><ul><li>  Character. <br>  The main character is always moving.  Can bounce and duck to collect bonuses and avoid obstacles. </li><li>  Bonuses <br>  Can increase points or speed of movement of the character.  In order to collect them, the character must jump. </li><li>  Obstacles. <br>  Barriers or moving towards the character objects.  In order to avoid them, the character must duck or jump.  When confronted with an obstacle, the character loses speed. </li></ul></li><li>  Characteristics of the game used in calculating the result of the game: <br><ul><li>  Points scored.  Increase when collecting bonuses. </li><li>  Character speed  Decreases with time.  Decreases when confronted with an obstacle.  Increases when collecting bonuses. </li><li>  Time spent on the game. </li></ul></li><li>  Used technologies: <br><ul><li>  Client: HTML5.  Reason: the game was required to run on all devices.  JS-framework: Pixi.js ( <a href="http://www.pixijs.com/">http://www.pixijs.com</a> ) </li><li>  Server: PHP, Framework: Zend </li></ul></li><li>  The goal of the customer: advertising your brand through the game.  Gameplay was associated with the company's services;  logos, brand colors and all that stuff in stock. </li><li>  The game was launched for a certain period, after which the players with the best results were awarded valuable prizes. </li><li>  Based on the above, the customer immediately emphasized that the game should be protected from falsifying results.  The customer values ‚Äã‚Äãthe reputation.  He didn‚Äôt want the news to appear in the media that their branded game had been hacked. </li></ul><br><h4>  What kind of team? </h4><br>  We are web developers, but we haven't been involved in game development before.  At the very beginning we gave birth to many funny solutions.  For example, we made an important architectural error - we decided to generate a level on the client in the browser;  and as a defense relied on obfuscation of JS code.  True, comrades from neighboring departments said that for quality protection they would have to ‚Äúplay‚Äù the game on the server and compare it with the client.  But we laughed then, that this is very difficult. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I repeat that the main requirement was to provide anti-cheat protection.  But our team decided to first make the game work in principle.  And the development of protection was postponed later.  It seemed logical: first we do something, and only then we defend this ‚Äúsomething‚Äù. <br><br><h4>  The problem </h4><br>  As soon as we started to engage in protection, we immediately faced the basic problem of all browser games arising from the client-server architecture.  Namely: the player sees the entire client code of the game and cannot blindly trust the data that came to the server.  If we are able to manage the second part of the problem, then the possibility of analyzing and changing the source code by any user really puzzled us. <br><br>  We started with a simple solution - obfuscation of JS code and data encryption sent by the client to the server.  But the customer had a killer security team, which in 15 minutes was able to record an unreal game score, having a fully obfuscated code.  Encrypting data during transmission is also not an option - the keys lie with the client, and you can easily substitute them in the right place.  So, in fact, both of these decisions proved effective only for very lazy hackers. <br><br>  Moreover, Flash games are also subject to such reverse engineering, and those developers are also looking for a protection solution. <br><br>  The situation was complicated by the fact that our game has real prizes.  In this case, its hacking has passed from the category ‚Äúhack for fun‚Äù to the category ‚Äúhack for money‚Äù.  This game is more than attractive to specialists of a higher class than the ‚Äúnovice hacker‚Äù. <br><br><h4>  Tips from the Internet </h4><br>  Despite the fact that a lot of online games have already been developed, very little information has been found on how to deal with their hacking.  Here are some recommendations we have learned from the Internet: <br><ul><li>  Hide, protect and encrypt game data: <br><ul><li>  The variables responsible for the game account should not be made in the global scope.  They are recommended to declare private and put in closures (closure). </li><li>  Do not send invoice values ‚Äã‚Äãin clear text, but be sure to encrypt. </li><li>  Encrypt addresses (uri) to which the account is transmitted. </li><li>  Obfucirovat part of the code that is responsible for calculating and sending invoices. </li><li>  Send license keys along with the game results and check them on the server. </li><li>  Pros: relative ease of implementation </li><li>  Cons: as it was written above - hacked in 15 minutes </li></ul></li><li>  Fool hackers: <br><ul><li>  When a cheat account is detected, the result is still shown to the hacker in the list of records.  Let him think that the deed is done.  But other users should not see this. </li><li>  When a game is defined as hacked, then postpone the punishment for a random period (for example, from 1 to 3 days).  The hacker will use several methods and periodically he will see what he does.  But what exactly turns out to understand him will be difficult, and what exactly he was caught in the end - too. </li></ul></li><li>  Check the realism of game data: <br><ul><li>  Check on the server the theoretical possibility of sending values.  For example, the energy can not be negative, the score can not decrease, the position of the player always increases, etc. </li><li>  Send game data to the server and compare data with the same data from other users.  For example, if a player made 200 shots and reached a score of 200,000, while the remaining players, after making 200 shots, reach a score of 5000, this is a reason to doubt the integrity of the game. </li><li>  Delete games that lasted less (more) than a certain time. </li><li>  Pros: relative ease of implementation </li><li>  Cons: does not give full protection, adds an extra 5-10 minutes to organize hacking </li></ul></li><li>  Organizational impact on accounts: <br><ul><li>  Add importance account, so it was a pity to lose it.  For example, to play this game with real prizes, you must first achieve something in other games without prizes. </li><li>  Make account registration paid. </li><li>  Ban on IP hackers at the very first attempt of hacking.  Do not give them the opportunity to understand. </li></ul></li><li>  Emulate the game on the server: <br><ul><li>  Make 'instant replay' on the server.  After passing the level to send data, which are restored events in the game and re-calculates its result.  Then this is all compared with what the player sent, and if the difference is big, then this is a hack. </li><li>  Pros: gives a greater degree of protection </li><li>  Cons: Events sent at the end of the game can also be tampered with. </li></ul></li></ul><br>  We brainstormed and also developed a lot of ideas.  Were successful, and were not very.  For example, the output of CAPTCHA ‚Äúbefore‚Äù, ‚Äúduring‚Äù and ‚Äúafter‚Äù the game can be classified as not the most successful.  Or, say, receiving screenshots during the game and sending them to the server for verification.  The following describes the most interesting of the implemented methods. <br><br><h4>  Emulator games </h4><br>  After much deliberation and resistance to a complex decision, we came to the conclusion that playing (emulating) the games on the server is clearly a necessary thing.  If not to say - inevitable. <br><br>  To do this, we began to generate a game (the location of bonuses and obstacles) on the server and <br>  send to the server not the final result of the game, but only the events that occurred in it: collisions with obstacles, bonuses and keystrokes.  For each event, we knew the time, coordinates, keystrokes or bonuses / obstacles that the player encountered. <br><br>  There was an option to send only keystrokes, and on the server to calculate the result at the end of the game.  But we are faced with the problem of different game speeds on different devices and in different browsers.  The probability of a strong discrepancy in the game process on the client and on the server is high, since this method is very sensitive to inconsistencies.  For example, if suddenly the client does not send just one collision with an obstacle, then the emulated game will go completely differently from now on.  Indeed, in collisions, energy and speed are lost. <br><br>  Another option: handle events on the server and immediately send the results of the event to the client.  But at the same time there is a very large traffic between the server and the client, the response time of the game increases and the server load dramatically increases.  This is how MMO games work, for example.  But for a small Collect &amp; Run game, we considered this impractical. <br><br>  I would particularly like to note the fact that the devices on which the game was launched had different performance.  On fast devices, the game went smoothly, on slow ones - in spurts.  Because of this difference, we had to abandon the time reference during emulation.  Instead, we viewed the events of the game as something that happens in some coordinates.  For example, at first we considered the jump for the bonus as ‚Äúpushing the button up at the 10th second, clashing with the bonus at the 12th second‚Äù.  But we are more approached by the following: ‚Äúpressing the button upwards with the X-coordinate of the player equal to 1000, collision with the bonus with the X-coordinate of the player equal to 1100 and the Y-coordinate of the player equal to 300‚Äù.  In this case, both the fast and the slow devices were emulated more or less equally. <br><br>  As a result, after the game we decided to emulate on the server each event sent by the client, and additionally calculate the probability of its occurrence.  One of the tasks that we solved was the creation of identical collision calculation algorithms on the server and on the client.  It was necessary to achieve the same accuracy, including rounding. <br><br>  As a result of the work of the emulator, we receive on the server a sequence of game events in the same form as in the actual game.  After emulating the events, we turn to an analysis of what we did. <br><br><h4>  Game analyzer </h4><br>  This is the most interesting block.  Here are collected the most successful methods of detecting cheaters.  All of them are different, run in sequence, you can add more if necessary. <br><img src="https://habrastorage.org/files/41a/779/728/41a779728864456cbb3ce2972ef686bf.png" align="right"><br><ol><li>  <strong>Collision coordinates.</strong> <br>  A collision with an obstacle or a bonus occurred in the browser on the client at the point where this item was generated on the server. </li><li>  <strong>Increase character position.</strong> <br>  The position of the character in the game should increase with time.  It cannot decrease or remain the same. </li><li>  <strong>The character has reached the end of the level.</strong> <br>  The maximum character position does not exceed the length of the level generated on the server. </li><li>  <strong>Duration of the game.</strong> <br>  The level is physically impossible to pass in less than one minute.  Therefore, games that have passed in 30 seconds or 2 minutes are considered hacked. </li><li>  <strong>Control of speed and energy indicators.</strong> <br>  The values ‚Äã‚Äãof the indicators in the browser on the client should be related to game events (collection of bonuses, collisions with obstacles).  When taking some bonuses, the character's speed increases, when confronted with obstacles, it decreases.  Also, the collection of some bonuses increases the number of points gained by the player.  Knowing what items a player has collected, you can calculate on the server what values ‚Äã‚Äãhe should have: speeds and total points. </li><li>  <strong>Jump before taking the bonus.</strong> <br>  Bonuses hang high to make them a character must jump.  Here it is checked whether there was a jump before taking. </li><li>  <strong>Jump before the obstacle.</strong> <br>  In order to avoid a collision with an obstacle lying on the ground, the character must jump.  For each obstacle, we check whether the player jumped up to the obstacle (pressing the jump button) and blocked his jump trajectory. </li><li>  <strong>The correct keys.</strong> <br>  Check the pressing of certain keys: ‚Äúup‚Äù and ‚Äúdown‚Äù.  If something else was pressed, it is suspicious. </li><li>  <strong>Bonuses and obstacles are collected once.</strong> <br>  The user can collect one bonus (or obstacle) no more than once. </li><li>  <strong>Clashes on the client.</strong> <br>  Comparison of collisions that occurred in the browser on the client and received on the emulator. </li><li>  <strong>Clashes on the emulator.</strong> <br>  Comparison of collisions that occurred on the emulator, but did not occur in the game.  This method is introduced in order to have different weights of this and previous methods.  We thought that if there is a collision on the emulator, but not in a real game, then it is less suspicious than when there is a collision in a real game, but not on the emulator. </li><li>  <strong>Taking false items.</strong> <br>  When generating the game, we added a few bonuses, which are impossible to take in the game.  For example, they are slightly higher than the character can jump;  or there are two bonuses that are nearby, but physically you can only collect one of them.  And we check if the hacker got hooked and took these bonuses. </li><li>  <strong>Fingerprint analysis.</strong> <br>  Before the start of the game during registration and player login, we collect information about the client (browser plugins, http headers, ip, installed fonts, screen size and color).  This does not help us to understand whether the game was hacked.  But in the case when administrators mark a player as a hacker, the analyzer scans all players in the system and finds similar ‚Äúfingerprints‚Äù.  Thus, it is possible with a certain probability to detect hackers who try to break the game under one account, and play ‚Äúpurely‚Äù under another. </li></ol><br>  Each method has its own weight in the calculation, the value of which is adjusted.  By the way, it makes sense to put into the settings the maximum possible number of parameters.  For it is not clear in advance how sensitive or rough this or that algorithm will turn out in reality. <br><br>  During operation, the analyzer sets each method with values ‚Äã‚Äãfrom 0 to 1 (0 - the game is beyond suspicion, 1 - the test is completely failed) and at the end it calculates the ‚ÄúSuspiciousness Index of the game‚Äù (also from 0 to 1). <br>  This index is used to automatically tag the game.  If it is greater than the threshold, then the game is considered hacked.  The specific threshold value is selected empirically, we got it 0.4. <br><br><h4>  Administration of evidence </h4><br>  But that is not all.  We must do something with all these calculations.  It is one thing to program the algorithms described above, and another to submit the results of the work to the game administrators in a readable form.  Blocked for hacking a player can apply for support with complaints, and they must have proof of the decision.  Therefore, it is recommended that administrators be given the maximum amount of information so that they understand and justify why a particular game was identified as hacked. <br><br>  To do this, we made 4 pages in the admin panel. <br><ol><li>  <strong>Game Information - Emulator</strong> <br>  Table with real and emulated events of the selected game.  The columns are as follows: <br><ul><li>  element type (bonus, barrier) </li><li>  Element X and Y Coordinates </li><li>  client time </li><li>  X- and Y- coordinates of the character (on the client) </li><li>  fact of collision of character and element (yes, no) </li><li>  X- and Y-coordinates of the character (emulated) </li><li>  probability of collision at a specified time on the client </li></ul></li><li>  <strong>Game Information - Analyzer</strong> <br>  The overall index of suspicion of the game and the table with the results of the analyzer for each method. </li><li>  <strong>Analyzer</strong> <br>  Shows a table of all suspicious games in general, based on the threshold of suspicion (0 - no suspicions, 1 - just hacked).  By experience, we have a value of 0.4. </li><li>  <strong>Player Page</strong> <br>  They added a player suspicion index to the player profile.  It is calculated on the basis of the suspicious indices of all his games. </li></ol><br>  By the time the game was launched, we did not have time to automatically block suspicious users.  This would greatly simplify the work of the game administrators, since the person is not able to view thousands of suspicious games in a day. <br><br><h4>  How did everything go </h4><br><img src="https://habrastorage.org/files/645/6e5/8c5/6456e58c5e6748fe8d1771f765f8f225.png" align="left"><br>  Analyzing the top players a few days after the launch of the game was very entertaining.  One hacker followed a simple path and collected all the elements, but he never jumped.  He also collected all the ‚Äúfalse‚Äù elements.  Another ‚Äúchampion‚Äù has evolved consistently.  At first he had about ten fair games, then - a lot of ‚Äúempty‚Äù ones.  And in the most recent games, the suspicion index was overwhelming.  Some ‚Äúwinners‚Äù went through the game in less than 10 seconds.  Some people played the game only once and immediately hit the top.  This, by the way, can be used as an analyzer method - very few people are able to make the maximum from the first time.  There were ‚Äúchampions‚Äù in one second, gaining an unrealistic number of points.  And so on.  All of them were blocked and were not allowed to real prizes.  No complaints from them. <br><br>  After reviewing dozens of real games, we updated some of the threshold parameters upwards.  For example, the maximum index value of a game‚Äôs suspicion, when a game is considered hacked, can be increased.  In other words, the initial settings were very suspicious. <br><br>  In reality, we received a positive result of this system.  Strongly helped to understand the display of results in the admin panel.  In general, it can be said that the system proved to be quite viable, the customer was satisfied. <br><br><h4>  Conclusion </h4><br>  When defending against the account we used the data of only one game and tried to catch it on internal discrepancies.  We proceeded from the fact that the game is completely vulnerable: all source codes are available to the player, and the incoming data is unreliable.  But the game has a part that is inaccessible to hackers - this is the data of all games.  There is an assumption that correctly using a database played by thousands of players, you can improve the accuracy of determining hacking.  Now we believe that the database of game results is the main advantage of developers over hackers. <br><br>  What do you think, habrovchane?  Share your thoughts and approaches to the protection of online games. </div><p>Source: <a href="https://habr.com/ru/post/252699/">https://habr.com/ru/post/252699/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../252673/index.html">Open-source instant messenger for autistic children</a></li>
<li><a href="../252675/index.html">Administering through the eyes of a C ++ programmer</a></li>
<li><a href="../252677/index.html">Oberon Interpreter on Go</a></li>
<li><a href="../252683/index.html">"- Hello, tech support. Have you tried to turn it off and on?"</a></li>
<li><a href="../252697/index.html">Risk Protection Machine Learning System Architecture</a></li>
<li><a href="../252703/index.html">Recognition of the RF Passport on a mobile phone. (UPD: 03/28/2015 + posted the program on the App Store)</a></li>
<li><a href="../252705/index.html">NoScript is now for Android</a></li>
<li><a href="../252707/index.html">Weekly build Vivaldi 1.0.124.2</a></li>
<li><a href="../252711/index.html">Microsoft incorrectly fixed the vulnerability that the Stuxnet worm used</a></li>
<li><a href="../252713/index.html">Entertaining math in Hearthstone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>