<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Raspberry Pi: measure humidity and temperature with DHT11 / DHT22</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√© already published an article about connecting the temperature sensor DS18B20 to the Raspberry Pi. In our new project, which is built on the R...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Raspberry Pi: measure humidity and temperature with DHT11 / DHT22</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/621/132/2d1/6211322d14e28f3852d27d665dd3aa92.png" align="left">  On Habr√© already published <a href="http://habrahabr.ru/post/163575/">an article</a> about connecting the temperature sensor DS18B20 to the Raspberry Pi.  In our new project, which is built on the Raspberry Pi, it was necessary to measure not only the temperature, but also the humidity.  I'll tell you how to connect inexpensive Chinese humidity sensors to the Raspberry Pi.  After reviewing several options for various sensors, he focused on the two most popular sensors on the market.  This DHT11, which attracted its price of $ 3 (with delivery) and the sensor DHT22 (about $ 10 with delivery). <br><a name="habracut"></a><br>  The main difference between them is in the range of temperatures and measurement accuracy: <br><br><h6>  DHT11 </h6><br><ul><li>  Humidity 20-80% + - 5% </li><li>  Temperature 0-50 ¬∞  + - 2% </li><li>  Data is read in whole units. </li></ul><br><h6>  DHT22 </h6><br><ul><li>  Humidity 0-100% + - 5% </li><li>  Temperature -40-125 ¬∞  + - 0.5% </li><li>  Data is read to tenths. </li></ul><br><br><img src="https://habrastorage.org/storage2/be6/255/fa0/be6255fa0046a758e1c630d26c2fb590.jpg"><br><h5>  Connection </h5><br>  Connecting to the Raspberry Pi is not particularly difficult: we connect + from the sensor to + 5V on the Raspberry Pi, "-" - to the ground, and a signal to one of the <a href="http://elinux.org/RPi_Low-level_peripherals">GPIO pins</a> . <br><img src="https://habrastorage.org/storage2/a84/bd3/77a/a84bd377a9ad2d3bbe7376a0b89418d0.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Install the software </h5><br>  Both sensors use their own protocol instead of the standardized 1 wire, so the software for taking sensor readings will also differ. <br><br>  First install the C library to work with GPIO <a href="http://www.open.com.au/mikem/bcm2835/index.html">www.open.com.au/mikem/bcm2835/index.html</a> <br><pre><code class="bash hljs">wget http://www.open.com.au/mikem/bcm2835/bcm2835-1.15.tar.gz tar xzf bcm2835-1.15.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> bcm2835-1.15/ ./configure make make install</code> </pre> <br><br>  For reading the data from the sensor, the file on <a href="">Adafruit_DHT_Driver</a> C was taken as the <a href="">basis</a> .  Without making some changes to work with DHT22, this code refused, I had to change a little. <br><div class="spoiler">  <b class="spoiler_title">Therefore, I present a modified version.</b> <div class="spoiler_text">  ReadDHT.c file <br><pre> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">// How to access GPIO registers from C-code on the Raspberry-Pi // Example program // 15-January-2012 // Dom and Gert // // Access from ARM Running Linux #define BCM2708_PERI_BASE 0x20000000 #define GPIO_BASE (BCM2708_PERI_BASE + 0x200000) /* GPIO controller */ #include &lt;stdio.h&gt; #include &lt;string.h&gt; #include &lt;stdlib.h&gt; #include &lt;dirent.h&gt; #include &lt;fcntl.h&gt; #include &lt;assert.h&gt; #include &lt;unistd.h&gt; #include &lt;sys/mman.h&gt; #include &lt;sys/types.h&gt; #include &lt;sys/stat.h&gt; #include &lt;bcm2835.h&gt; #include &lt;unistd.h&gt; #define MAXTIMINGS 100 #define DHT11 11 #define DHT22 22 #define AM2302 22 int readDHT(int type, int pin); int main(int argc, char **argv) { if (!bcm2835_init()) return 1; if (argc != 3) { printf("usage: %s [11|22|2302] GPIOpin#\n", argv[0]); printf("example: %s 2302 4 - Read from an AM2302 connected to GPIO #4\n", argv[0]); return 2; } int type = 0; if (strcmp(argv[1], "11") == 0) type = DHT11; if (strcmp(argv[1], "22") == 0) type = DHT22; if (strcmp(argv[1], "2302") == 0) type = AM2302; if (type == 0) { printf("Select 11, 22, 2303 as type!\n"); return 3; } int dhtpin = atoi(argv[2]); if (dhtpin &lt;= 0) { printf("Please select a valid GPIO pin #\n"); return 3; } printf("Using pin #%d\n", dhtpin); readDHT(type, dhtpin); return 0; } // main int bits[250], data[100]; int bitidx = 0; int readDHT(int type, int pin) { int counter = 0; int laststate = HIGH; int j=0; int i=0; // Set GPIO pin to output bcm2835_gpio_fsel(pin, BCM2835_GPIO_FSEL_OUTP); bcm2835_gpio_write(pin, HIGH); usleep(100); bcm2835_gpio_write(pin, LOW); usleep(20000); bcm2835_gpio_fsel(pin, BCM2835_GPIO_FSEL_INPT); data[0] = data[1] = data[2] = data[3] = data[4] = 0; // read data! for (i=0; i&lt; MAXTIMINGS; i++) { counter = 0; while ( bcm2835_gpio_lev(pin) == laststate) { counter++; nanosleep(1); // overclocking might change this? if (counter == 100) break; } laststate = bcm2835_gpio_lev(pin); if (counter == 100) break; bits[bitidx++] = counter; if ((i&gt;3) &amp;&amp; (i%2 == 0)) { // shove each bit into the storage bytes data[j/8] &lt;&lt;= 1; if (counter &gt; 16) data[j/8] |= 1; j++; } } #ifdef DEBUG for (int i=3; i&lt;bitidx; i+=2) { printf("bit %d: %d\n", i-3, bits[i]); printf("bit %d: %d (%d)\n", i-2, bits[i+1], bits[i+1] &gt; 15); } #endif printf("Data (%d): 0x%x 0x%x 0x%x 0x%x 0x%x\n", j, data[0], data[1], data[2], data[3], data[4]); if ((j &gt;= 39) &amp;&amp; (data[4] == ((data[0] + data[1] + data[2] + data[3]) &amp; 0xFF)) ) { // yay! if (type == DHT11) printf("Temp = %d *C, Hum = %d \%\n", data[2], data[0]); if (type == DHT22) { float f, h; h = data[0] * 256 + data[1]; printf ("%s\n",h); h /= 10; f = (data[2] &amp; 0x7F)* 256 + data[3]; f /= 10.0; if (data[2] &amp; 0x80) f *= -1; printf("Temp = %.1f *C, Hum = %.1f \%\n", f, h); } return 1; } return 0; }</span></span></code> </pre><br></div></div><br>  Compile <br><pre> <code class="bash hljs">gcc readDHT.c -lbcm2835 -lrt -o readDHT</code> </pre><br>  We try to read data <br><pre> <code class="bash hljs">./readDHT {  11  22} { GPIO  Raspberry PI}</code> </pre><br>  For example DHT11 is connected to GPIO4 <br><pre> <code class="bash hljs">root@raspberrypi /var/www/application/scripts/DHT <span class="hljs-comment"><span class="hljs-comment"># ./readDHT 11 4 Using pin #4 Data (40): 0x23 0x0 0x17 0x0 0x3a Temp = 23 *C, Hum = 35 %</span></span></code> </pre><br>  or DHT22 is connected to GPIO17 <br><pre> <code class="bash hljs">root@raspberrypi /var/www/application/scripts/DHT <span class="hljs-comment"><span class="hljs-comment"># ./readDHT 22 17 Using pin #17 Data (40): 0x1 0x75 0x0 0xea 0x60 Temp = 23.4 *C, Hum = 37.3 %</span></span></code> </pre><br><br>  When implementing the readDHT call, you need to take into account that if the access speed is high (more than once per second) you will receive a CRC Error instead of data. <br><br><h5>  Saving data from sensors </h5><br><br>  The data you need to save somewhere, give an example of how you can save data to Google.docs.  Since  PHP is closer to me, saving is done in PHP using Zend_Gdata_Spreadsheets. <br><br> <a href=""><img src="http://lookvisor.com/wp-content/uploads/2012/11/%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D1%8B-%D0%B2-google-docs-300x196.jpg" alt="image" align="left"></a>  Prepare google docs.  Create a new table and give it a name.  We give the names of the columns of the first datetime, the second temperature, the third humidity.  From the address bar, copy the id of our table, it will be accessed to the table. <br><br>  Install php: <br><pre> <code class="bash hljs">pi@raspberrypi ~ $ sudo apt-get php5 php5-curl unzip</code> </pre><br>  Create a folder for our project: <br><pre> <code class="bash hljs">pi@raspberrypi ~ $ mkdir /home/pi/dht</code> </pre><br>  Download and unzip the Zend Framework: <br><pre> <code class="bash hljs">pi@raspberrypi ~ $ mkdir /home/pi/dht/library pi@raspberrypi ~ $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /home/pi/dht/library pi@raspberrypi ~ $ wget http://packages.zendframework.com/releases/ZendFramework-1.12.0/ZendFramework-1.12.0-minimal.zip pi@raspberrypi ~ $ unzip ZendFramework-1.12.0-minimal.zip pi@raspberrypi ~ $ ln -s ZendFramework-1.12.0-minimal/library/Zend Zend</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">DHTtoGoogleDocs.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> ini_set(<span class="hljs-string"><span class="hljs-string">"include_path"</span></span>,get_include_path().<span class="hljs-string"><span class="hljs-string">':/home/pi/dht/library'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'Zend/Loader.php'</span></span>; Zend_Loader::loadClass(<span class="hljs-string"><span class="hljs-string">'Zend_Gdata_Spreadsheets'</span></span>); Zend_Loader::loadClass(<span class="hljs-string"><span class="hljs-string">'Zend_Gdata_ClientLogin'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'GDATA_USER'</span></span>,<span class="hljs-string"><span class="hljs-string">'googleusername'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'GDATA_PASSWORD'</span></span>,<span class="hljs-string"><span class="hljs-string">'google user password'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'GDATA_SPREADSHEET_KEY'</span></span>,<span class="hljs-string"><span class="hljs-string">'spreadsheetkey from url'</span></span>); define(<span class="hljs-string"><span class="hljs-string">'GDATA_WORKSHEET_ID'</span></span>,<span class="hljs-string"><span class="hljs-string">'od6'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $t = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Temperature_DHT(); <span class="hljs-comment"><span class="hljs-comment">// get data from sensor $data = $t-&gt;getData(11,4); $service = Zend_Gdata_Spreadsheets::AUTH_SERVICE_NAME; $client = Zend_Gdata_ClientLogin::getHttpClient(GDATA_USER, GDATA_PASSWORD, $service); $service = new Zend_Gdata_Spreadsheets($client); // add row to spreadsheet $row = array( 'datetime'=&gt;date("Ymd H:i:s"), 'temperature'=&gt;$data[0], 'humidity'=&gt;$data[1], ); $service-&gt;insertRow($row, GDATA_SPREADSHEET_KEY, GDATA_WORKSHEET_ID); } catch (Exception $e) { die( $e-&gt;getMessage() ); } class Temperature_DHT { private $_maxFailCount=5; public function getData($type, $pin) { $count = 0; while ($count&lt;=$this-&gt;_maxFailCount) { $count++; $filename = '/home/pi/dht/readDHT'; $out = exec ("$filename $type $pin"); if(preg_match("'^Temp = ([0-9\.]+) \*C, Hum = ([0-9\.]+) %'", $out,$result)) { return array($result[1],$result[2]); } } } }</span></span></code> </pre></div></div><br><br>  Check file operation, run: <br><pre> <code class="bash hljs">pi@raspberrypi ~ $ php DHTtoGoogleDocs.php</code> </pre><br>  It remains only to put the call "php DHTtoGoogleDocs.php" in cron. <br><br>  As an experiment, data were collected for almost a month with an interval of 10 minutes in the same room and stored in google docs, the sensors were located nearby.  Who is interested can look at the <a href="https://docs.google.com/spreadsheet/ccc%3Fkey%3D0At-_s3pF-Sl-dHVLVUYzX09rdzBncHo0YUsyUU82Y0E">range of values</a> . <br>  From the data collected by both sensors, it can be said that if you just need to understand whether the humidity is changing, then the DHT11 sensor is enough.  But, if you want the displayed value to be close to the value of a household weather station, then it is better to use DHT22. </div><p>Source: <a href="https://habr.com/ru/post/167459/">https://habr.com/ru/post/167459/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../167449/index.html">Say a good word about high salary</a></li>
<li><a href="../167451/index.html">Top 5 annoying moments in the work of the programmer</a></li>
<li><a href="../167453/index.html">Google allocates millions of dollars to new Chrome hacking contest</a></li>
<li><a href="../167455/index.html">Unbound Jailbreak for iOS 6.1 coming out on Sunday</a></li>
<li><a href="../167457/index.html">Ruby, SmallTalk and class variables</a></li>
<li><a href="../167461/index.html">Report on the seventh Kiev habrebe</a></li>
<li><a href="../167465/index.html">Review of Assistant AE-601 reader</a></li>
<li><a href="../167467/index.html">Zopo launches Sailfish OS smartphone for the Indian market</a></li>
<li><a href="../167469/index.html">SXB: MySQL incremental backup</a></li>
<li><a href="../167471/index.html">Why free business software is bad. Based on disabling free Google Apps subscriptions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>