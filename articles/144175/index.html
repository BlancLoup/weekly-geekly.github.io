<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Geospatial types in SQL Server Reporting Services reports</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Geometry and Geography types have been available in SQL Server since version 2008. The Map control that uses them based on the Dundas control of t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Geospatial types in SQL Server Reporting Services reports</h1><div class="post__text post__text-html js-mediator-article"> The Geometry and Geography types have been available in SQL Server since version 2008. The Map control that uses them based on the Dundas control of the same name appeared in SQL Server Reporting Services 2008R2.  Other innovations in reporting services 2008R2 described in posts <br>  <a href="http://blogs.technet.com/b/isv_team/archive/2010/03/27/3321575.aspx">blogs.technet.com/b/isv_team/archive/2010/03/27/3321575.aspx</a> , <br>  <a href="http://blogs.technet.com/b/isv_team/archive/2010/03/28/3321598.aspx">blogs.technet.com/b/isv_team/archive/2010/03/28/3321598.aspx</a> , <br>  <a href="http://blogs.technet.com/b/isv_team/archive/2010/03/29/3321661.aspx">blogs.technet.com/b/isv_team/archive/2010/03/29/3321661.aspx</a> , <br>  <a href="http://blogs.technet.com/b/isv_team/archive/2010/04/04/3322989.aspx">blogs.technet.com/b/isv_team/archive/2010/04/04/3322989.aspx</a> , <br>  <a href="http://blogs.technet.com/b/isv_team/archive/2010/04/06/3323367.aspx">blogs.technet.com/b/isv_team/archive/2010/04/06/3323367.aspx</a> , <br>  <a href="http://blogs.technet.com/b/isv_team/archive/2010/04/15/3325155.aspx">blogs.technet.com/b/isv_team/archive/2010/04/15/3325155.aspx</a> . <br><br>  Open in <a href="http://blogs.technet.com/b/isv_team/archive/2012/02/24/3482925.aspx">SQL Server Data Tools (SSDT) ‚Äã‚Äãa</a> project of type Report Server Project: <br><a name="habracut"></a><br><br><img src="https://habrastorage.org/storage2/db1/e6d/b51/db1e6db51db4056c1c9324f77dbbe924.png"><br>  Pic.1 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Just in case, let me remind you that reporting services are part of the <a href="http://www.microsoft.com/en-us/download/details.aspx%3Fid%3D29062">free version of SQL Server Express</a> (you need to take the Express with Advanced Services option).  About the limitations of free reporting is written <a href="http://msdn.microsoft.com/ru-ru/library/ms365166.aspx">here</a> .  SSDT, by definition, are free, taken <a href="http://msdn.microsoft.com/en-us/data/hh297027">here</a> .  Instead of Report Server Project in SSDT, anyone can use <a href="http://www.microsoft.com/en-us/download/details.aspx%3Fid%3D29072">Report Builder</a> - it is also free. <br><br>  In the table created in the <a href="http://habrahabr.ru/company/microsoft/blog/144006/">previous post</a> with the maps of the subjects of the Russian Federation, I will add columns that will contain the population according to the <a href="http://worldgeo.ru/russia/lists/%3Fid%3D23">last census</a> , as well as the percentage of the male population.  Please do not discern in this gender chauvinism, just why keep at the same time a percentage of both sexes?  Ok, let's get female.  As a result, the table takes the following form: <br><br><img src="https://habrastorage.org/storage2/916/8de/e72/9168dee728c475b2eb9ae749dba9f9c6.png"><br>  Pic2 <br><br>  Add a new data source to the reporting project in SSDT <br><br><img src="https://habrastorage.org/storage2/f54/096/0b2/f540960b2be15cc575afe49ce9b601e9.png"><br>  Pic.3 <br><br>  in which we set the connection string to SQL Server.  In the folder below, we will create a new dataset based on this source, which will contain the results of the query <code>SELECT ID, region, geom.Reduce(1000) as geom, Population, Female FROM regions2010</code> .  Move down to the Reports folder below and create an empty report Add -&gt; New Item -&gt; Report in the project.  In the Report Data panel, which is traditionally located on the left, right-click on the Data Sources folder and add a link to the newly created shared data source DataSource1.  Similarly we will add the link to the general DataSet1.  Increase the working surface of the report by sliding it out at the bottom right corner.  Click on it with the right button and select Insert -&gt; Map: <br><br><img src="https://habrastorage.org/storage2/506/ba1/fa3/506ba1fa3f1073c9ea0e9c2e6dd47899.png"><br>  Pic.4 <br><br>  You will be prompted to select the source for the map.  Map Gallery are maps that come with Reporting Services.  They refer to the USA and to us in this case without interest.  The second source can be a shapefile, but we have already tightened it in the past post it into the SQL Server table.  Select the third type of source - SQL Server spatial query and specify DataSet1 for it.  Further it will be offered to select in it a field of type Geometry / Geography.  In this case, there is one such field in the dataset, and it is already automatically entered in the combo box.  I plan to color the polygons depending on the values ‚Äã‚Äãof another field from the dataset, therefore, I choose Color Analytical Map as the map visualization method: <br><br><img src="https://habrastorage.org/storage2/205/dac/91d/205dac91d8a536c4f08dbce41d57ab22.png"><br>  Pic.5 <br><br>  If the field, on the basis of which the coloring will be made, was in another dataset, here it would be possible to link it with the first one, but in our case everything is simple, therefore Choose an existing dataset.  The next screen prompts you to choose a color scheme.  The field on which the coloring will be made is the population size (Population).  I want the color to be thicker than the larger population, so I choose the Light - Dark shading rule. <br><br><img src="https://habrastorage.org/storage2/263/f4a/d37/263f4ad378cb75e38dedb0d7d55e01a3.png"><br>  Pic.6 <br><br>  Go to the Preview tab to see what happened.  It turned out sucks - instead of a card void.  This happens because the map expects the Geography type by default, and in our case the geom column has the Geometry type.  Go back to the Design tab, right-click on the image, select Viewport Properties: <br><br><img src="https://habrastorage.org/storage2/777/422/71a/77742271acde9a42b16c80dc43008001.png"><br>  Pic.7 <br><br>  and fix the wait on Coordinate system = Planar (X, Y): <br><br><img src="https://habrastorage.org/storage2/dbd/9cd/22e/dbd9cd22eaaadd9065fa9739a6fe210a.png"><br>  Fig.8 <br><br>  Now the map will be displayed normally: <br><br><img src="https://habrastorage.org/storage2/909/04f/b75/90904fb75066ae1efa557e8baa8a373f.png"><br>  Fig.9 <br><br>  Return to the Design tab.  You can also correct Viewport properties in the Properties panel by selecting it directly on the working surface of the report or by selecting the Map control as a child: <br><br><img src="https://habrastorage.org/storage2/ecc/e00/694/ecce00694f2bdf22a76bca8d150612ae.png"><br>  Pic.10 <br><br>  Delete the Title rectangle in the upper right to make more space under the map.  Or a rectangle with a scale at the bottom left - without a difference.  Just in case, you can restore the dead from the Map context menu: Add Legend and Show Color Scale respectively. <br><br><img src="https://habrastorage.org/storage2/468/1c9/c73/4681c9c73230b1bef757a8716edec3b5.png"><br>  Figure 11 <br><br>  By default, the size of the legend is set to Auto, which does not allow to change the size of the rectangle, only to carry it over the surface of the map.  This behavior is easy to correct if you set Auto = False in the Size property.  Graphically, resizing, pulling the corner, it will still be impossible, but there is an opportunity in the properties to drive Height and Width with your hands.  Similar behavior came across indicators or some other elements inherited from Dundas.  The overall length of the rectangle is influenced by the size and format of the font labels.  I removed the extra decimal places in the LabelFormat property: <br><br><img src="https://habrastorage.org/storage2/6c6/cd1/564/6c6cd1564dcc304921233c8ef9afbc29.png"><br>  Fig.12 <br><br>  In the Map Layers list, which now consists of one layer, choose Polygon Color Rule in the context menu of this layer: <br><br><img src="https://habrastorage.org/storage2/8a1/6b5/a58/8a16b5a58356cb2df426b34de8aa92dd.png"><br>  Fig.13 <br><br>  In the General section, you can re-select the dataset field, on the basis of which the coloring is made, for example, why do we need the SUM () function, which the wizard of map mapping has slipped in Fig.6?  There is nothing to aggregate in the regions2010 table, there each line has its own subject.  I would also divide the Population field by 1000 to make Labels, and, consequently, the length of the MapColorScale rectangle (see Figure 12) is shorter.  The expression takes the form <code>=Fields!Population.Value / 1000</code> .  You can also adjust the starting and ending colors. <br><br><img src="https://habrastorage.org/storage2/8f3/b28/75f/8f3b2875f62d2a06ecc8d3dc83333bd3.png"><br>  Fig.14 <br><br>  and in paragraph Distribution - the number of levels of graduation: <br><br><img src="https://habrastorage.org/storage2/880/db9/562/880db956265fd5aa51dc8ae6ef85904b.png"><br>  Pic.15 <br><br>  There are 4 options: Equal Interval, when the range from the minimum to the maximum values ‚Äã‚Äãof the Data Field will be divided into Number of subranges of equal segments;  Equal Distribution, when the lengths of the segments are selected so that approximately the same number of records fall into each;  Optimal, when the tool solves itself, and Custom, when we explicitly set the initial and final boundaries of each interval. <br>  As in Fig.10, in the case of the Viewport property, layer properties are accessible from the property panel or through a hierarchy of objects, starting from the upper level Map, which has the Layers collection as a property: <br><br><img src="https://habrastorage.org/storage2/75e/cc7/973/75ecc79736fab6c7d596ddf38e701014.png"><br>  Figure 16 <br><br>  or, if you carefully aim, you can select a layer directly in the map on the working surface of the report: <br><br><img src="https://habrastorage.org/storage2/8e4/e11/918/8e4e1191845db6ecb6e44d40dc7fc2fc.png"><br>  Pic.17 <br><br>  It remains to correct the location of the map and its size.  This is done in Figure 8 in the Center and Zoom section or in the View property of the Viewport object in the Properties pane of Figure 10.  You can move the Viewport inside the map with the mouse or using the blue arrows Map view or simply setting the coordinates of CenterX / CenterY.  Zoom changes the size of the Viewport, not allowing to distort the ratio of width / length despite the fact that inside the Size property are sub-properties of Height and Width.  In the properties panel, they are marked as inaccessible, but in the <a href="http://msdn.microsoft.com/ru-ru/library/microsoft.reportingservices.rdlobjectmodel.mapsize.aspx">documentation</a> about readonly nothing is said, so I changed them directly in rdl.  Zero effect.  Apparently, the spectacle of stretching the image was sacrificed in order to respect the proportions in geometry / geography. <br><br><img src="https://habrastorage.org/storage2/e7f/9b4/8d9/e7f9b48d97d1657f387014ed5a08f3c1.png"><br>  Pic.18 <br><br>  Depending on the distribution chosen (Fig.15-17), the demographic situation in the country may look dim (equal interval scale): <br><br><img src="https://habrastorage.org/storage2/a53/895/410/a5389541004b541762ace63ec9e75d27.png"><br>  Figure 19 <br><br>  or in somewhat brighter tones (equidistributed scale): <br><br><img src="https://habrastorage.org/storage2/70c/af5/84e/70caf584e5a56015a68e0d8ba7b6e2ef.png"><br>  Pic.20 <br><br>  Homework.  Build a similar report by mapping the population density = population in the subject / area of ‚Äã‚Äãthe subject.  The area is counted as a geom.  <a href="http://msdn.microsoft.com/ru-ru/library/bb933923.aspx">STArea ()</a> . <br><br>  I will add a bit of interactivity to the report, so that depending on the chosen value of the parameter (Male, Female, Common), the map shows the male population, female or together - what we see now.  In the Report Data panel (on the left - see Figure 4), right-click on the Parameters folder and say Add Parameter.  In the General item, the name and type of the parameter are specified.  The Allow blank value option differs from Allow null value in that it is available only when Allow multiple values ‚Äã‚Äãis marked and means that the list may be empty.  The hidden parameter is not shown in the user interface, but you can access it when you call the report via a URL or a subscription.  Internal parameter is not lit out in any way. <br><br><img src="https://habrastorage.org/storage2/88f/0bf/9e9/88f0bf9e933e281391111d2a46466ed7.png"><br>  Pic.21 <br><br>  The Available Values ‚Äã‚Äãitem indicates whether the user will enter the parameter value manually or select from the list of available values.  The list can be specified as an explicit enumeration or dataset that needs to be created in the same way as we created it to draw a map.  In this case, the available values ‚Äã‚Äãwill be only 3 known in advance - they are easy to list explicitly.  Click the Add button three times, enter Label and Value.  The user is shown the Label column, but the corresponding value from the Value column falls into the parameter value.  The order in the case of an explicit task can be changed using the blue arrows buttons located in the Add / Delete buttons row. <br><br><img src="https://habrastorage.org/storage2/d1c/ac5/a31/d1cac5a31cce808dcd932382e845a539.png"><br>  Fig.22 <br><br>  In the Default Values ‚Äã‚Äãclause, the parameter value is set by default.  In our case, it will be 0, i.e.  the male and female population in the aggregate, as was in Figure 20.  As a default, you can also specify a dataset column - its first entry will be considered. <br><br><img src="https://habrastorage.org/storage2/385/931/b9c/385931b9cdad8e558f86a97d5d676973.png"><br>  Fig.23 <br><br>  Now we return to Fig.14 and adjust the analytical field, on the basis of which the map is colored.  Click the button with the function icon to the right of the input field and set the following expression: <code>=Fields!Population.Value * iif(Parameters!ReportParameter1.Value = 0, 1, <br> iif(Parameters!ReportParameter1.Value = 1, 1 - Fields!Female.Value / 100, <br> Fields!Female.Value / 100 <br> ) <br> )</code> <code>=Fields!Population.Value * iif(Parameters!ReportParameter1.Value = 0, 1, <br> iif(Parameters!ReportParameter1.Value = 1, 1 - Fields!Female.Value / 100, <br> Fields!Female.Value / 100 <br> ) <br> )</code> <br>  Double clicking on the value in the Values ‚Äã‚Äãlist inserts it at the cursor position in the upper text box where the expression is being edited. <br><br><img src="https://habrastorage.org/storage2/6ff/da0/a07/6ffda0a070f2d6b7c05e68f20680f8c8.png"><br>  Pic.24 <br><br>  The expression means that if a parameter with a value of 0 is passed, you need to paint over the map based on the population size of the subject from the Population column.  If 1 (me) - multiply the population by the percentage of the male population = Population * (1 - female), if 2 (jo) - multiply the population by the percentage of the female population.  Run the report.  Initially, he does not ask anything, because  executed with the default parameter value (0).  You can then select a gender from the parameter value list and click the View Report button.  The map is redrawn based on the population of the indicated sex.  There will be no major changes in the painting of the regions, because  men and women everywhere about equally, but the meaning is clear. <br><br><img src="https://habrastorage.org/storage2/4f2/a49/768/4f2a49768bf7963f15a4a3bb1554898f.png"><br>  Fig.25 <br></div><p>Source: <a href="https://habr.com/ru/post/144175/">https://habr.com/ru/post/144175/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144166/index.html">Google received the latest approval for the Motorola deal</a></li>
<li><a href="../144167/index.html">Detected sources of garbage P2P traffic.</a></li>
<li><a href="../144168/index.html">Inline tests for PHP</a></li>
<li><a href="../144171/index.html">Do not leave problems for self-determination</a></li>
<li><a href="../144173/index.html">Another copter: part one, description and selection of parts</a></li>
<li><a href="../144176/index.html">Object tuples in Java and their collections</a></li>
<li><a href="../144178/index.html">[Translation] We simplify the work with the server using selective synchronization in Dropbox</a></li>
<li><a href="../144179/index.html">Study of power consumption and features of the computer in various power saving modes</a></li>
<li><a href="../144180/index.html">Optical Switch with Sound Effect on Arduino</a></li>
<li><a href="../144182/index.html">Object collections in PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>