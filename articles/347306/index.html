<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>TypeScript real-time applications: chat development using WebSocket, Node and Angular</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I recently created a simple chat using only TypeScript. The main goal of this project was to write an application that demonstrates the use of this la...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>TypeScript real-time applications: chat development using WebSocket, Node and Angular</h1><div class="post__text post__text-html js-mediator-article">  I recently created a simple chat using only TypeScript.  The main goal of this project was to write an application that demonstrates the use of this language both on the client and on the server.  The chat client is based on the latest version of Angular.  The server is based on Node.js.  The interaction between them is organized using the WebSocket protocol. <br><br>  From this material you will learn how to create the chat in question, from scratch.  By the way, how does working with him look like? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/199/7fb/154/1997fb15495301e32ae1ac0bd054f403.gif"></div><br>  <i><font color="#999999">Chat, written in TypeScript</font></i> <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">About real-time applications</font> </h2><br>  In accordance with <a href="https://en.wikipedia.org/wiki/Real-time_web">this</a> definition from Wikipedia, a real-time application allows interested entities to receive information immediately after it was published, without the need to periodically poll the source of information.  Thus, this type of application should give users the feeling that certain actions occur instantaneously, without delays. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  <font color="#3AC1EF">WebSocket protocol</font> </h2><br>  WebSocket is a protocol that allows you to organize a bidirectional data channel.  In our case, this means that the browser and the web server can communicate in real time by sending messages to each other when there is an open connection between them. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/270/378/342/2703783421b609d43f84602015104bc4.png"></div><br>  <i><font color="#999999">Data exchange using the WebSocket protocol</font></i> <br><br><h2>  <font color="#3AC1EF">Application structure</font> </h2><br>  We will place the code related to the client and server parts of the application in separate folders.  The structure of the finished application is shown below.  Details will be discussed below when we talk about the key files of our project. <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">server</span></span>/ |- src/ |- package.json |- tsconfig.json |- gulpfile.js client/ |- src/ |- package.json |- tsconfig.json |- .angular-cli.json</code> </pre> <br><h2>  <font color="#3AC1EF">Choice of implementation of WebSocket</font> </h2><br>  Since the WebSocket protocol is a <a href="https://tools.ietf.org/html/rfc6455">specification</a> , you can find several of its <a href="https://github.com/facundofarias/awesome-websockets">practical implementations</a> .  Here you can use <s>JavaScript</s> , TypeScript, or any other programming language. <br><br>  In this case, we will use the <a href="http://socket.io/">Socket.IO</a> library.  It is one of the fastest and most reliable libraries, realizing the possibility of real-time data exchange. <br><br><h2>  <font color="#3AC1EF">Why use TypeScript on the server?</font> </h2><br>  TypeScript offers the programmer great <a href="https://www.typescriptlang.org/">features</a> , the development team keeps the language up to date.  In addition, the use of typing <a href="http://ttendency.cs.ucl.ac.uk/projects/type_study/documents/type_study.pdf">reduces the number of errors</a> in the code, in comparison with the use of conventional JS.  For me, these reasons are quite enough to use TS on the server. <br><br><h2>  <font color="#3AC1EF">Initialization of the server application</font> </h2><br>  <a href="https://docs.npmjs.com/cli/init">Create</a> a <code>package.json</code> file and install the following dependencies: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">npm</span></span> install --save express socket.io <span class="hljs-variable"><span class="hljs-variable">@types</span></span>/express <span class="hljs-variable"><span class="hljs-variable">@types</span></span>/socket.io</code> </pre> <br>  In addition, you will need to install some development dependencies in order to integrate <code>gulp</code> and <code>typescript</code> into the project, all this will be useful to us during the creation and assembly of the finished project: <br><br><pre> <code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> <span class="hljs-comment"><span class="hljs-comment">--save-dev typescript gulp gulp-typescript</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">TypeScript Compiler Setup</font> </h2><br>  Create a <code>tsconfig.json</code> file and put the following into it: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"files"</span></span>: [   <span class="hljs-string"><span class="hljs-string">"src/*.ts"</span></span>,   <span class="hljs-string"><span class="hljs-string">"src/model/*.ts"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"compilerOptions"</span></span>: {   <span class="hljs-attr"><span class="hljs-attr">"target"</span></span>: <span class="hljs-string"><span class="hljs-string">"es5"</span></span> } }</code> </pre> <br><h2>  <font color="#3AC1EF">Description of the data model</font> </h2><br>  Using the possibilities of static typing, we will create a small data model: <br><br><pre> <code class="hljs scala">export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class"> </span></span>{   constructor(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> name: string) {} } export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span><span class="hljs-class"> </span></span>{   constructor(<span class="hljs-keyword"><span class="hljs-keyword">private</span></span> from: <span class="hljs-type"><span class="hljs-type">User</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> content: string) {} } export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChatMessage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span></span>{   constructor(from: <span class="hljs-type"><span class="hljs-type">User</span></span>, content: string) {       <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(from, content);   } }</code> </pre> <br>  Take a look at the <code>server/src</code> directory structure: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">server</span></span>/ |- src/  |- model/     |- message.model.ts     |- <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.model.ts  |- <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.ts  |- <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>.ts |- package.json |- tsconfig.json |- gulpfile.js</code> </pre> <br><h2>  <font color="#3AC1EF">The implementation of the server side of the chat</font> </h2><br>  The main files in the <code>server</code> directory are <code>index.ts</code> and <code>chat-server.ts</code> .  The first allows you to create and export the <code>ChatServer</code> application, while the second contains the <a href="https://expressjs.com/">express</a> and <a href="https://socket.io/">Socket.IO</a> configurations: <br><br>  Here is the code for the <code>index.js</code> file: <br><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">import</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">ChatServer</span></span> } from <span class="hljs-string"><span class="hljs-string">'./chat-server'</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">let</span></span> app = new ChatServer().getApp(); <span class="hljs-section"><span class="hljs-section">export</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">app</span></span> };</code> </pre> <br>  Here is the <code>chat-server.ts</code> : <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createServer, Server } from <span class="hljs-string"><span class="hljs-string">'http'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> express from <span class="hljs-string"><span class="hljs-string">'express'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> socketIo from <span class="hljs-string"><span class="hljs-string">'socket.io'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Message } from <span class="hljs-string"><span class="hljs-string">'./model'</span></span>; export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChatServer</span></span></span><span class="hljs-class"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> static readonly PORT:number = <span class="hljs-number"><span class="hljs-number">8080</span></span>;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> app: express.Application;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> server: Server;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> io: SocketIO.Server;   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> port: string | number;   <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>() {       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.createApp();       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.config();       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.createServer();       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sockets();       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.listen();   }   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> createApp(): void {       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.app = express();   }   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> createServer(): void {       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.server = createServer(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.app);   }   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> config(): void {       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.port = process.env.PORT || ChatServer.PORT;   }   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> sockets(): void {       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.io = socketIo(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.server);   }   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> listen(): void {       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.server.listen(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.port, () =&gt; {           console.log(<span class="hljs-string"><span class="hljs-string">'Running server on port %s'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.port);       });       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.io.on(<span class="hljs-string"><span class="hljs-string">'connect'</span></span>, (socket: any) =&gt; {           console.log(<span class="hljs-string"><span class="hljs-string">'Connected client on port %s.'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.port);           socket.on(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, (m: Message) =&gt; {               console.log(<span class="hljs-string"><span class="hljs-string">'[server](message): %s'</span></span>, JSON.stringify(m));               <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.io.emit(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, m);           });           socket.on(<span class="hljs-string"><span class="hljs-string">'disconnect'</span></span>, () =&gt; {               console.log(<span class="hljs-string"><span class="hljs-string">'Client disconnected'</span></span>);           });       });   }   <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> getApp(): express.Application {       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.app;   } }</code> </pre> <br><h2>  <font color="#3AC1EF">Server classes</font> </h2><br>  The code above gives the following classes and relationships between them: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9fe/524/769/9fe5247699bb72b464751fa70a7a1aea.png"></div><br>  <i><font color="#999999">Server class diagram</font></i> <br><br><h2>  <font color="#3AC1EF">Build and run the server</font> </h2><br>  In order to get the JavaScript files needed by the V8 engine on which Node.js is based, add the <code>build</code> task to the <code>gulpfile.js</code> file: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gulp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"gulp"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ts = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"gulp-typescript"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tsProject = ts.createProject(<span class="hljs-string"><span class="hljs-string">"tsconfig.json"</span></span>); gulp.task(<span class="hljs-string"><span class="hljs-string">"build"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tsProject.src()       .pipe(tsProject())       .js.pipe(gulp.dest(<span class="hljs-string"><span class="hljs-string">"./dist"</span></span>)); });</code> </pre> <br>  As you can see, the output of the build process (JS files) will be located in the <code>dist</code> directory.  To complete the build, you need the following command: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">gulp</span></span> build</code> </pre> <br>  Now, in order to start the server, you need to use the following command: <br><br><pre> <code class="hljs pgsql">node dist/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.js</code> </pre> <br><h2>  <font color="#3AC1EF">Chat client development</font> </h2><br>  Create a folder for the client using <a href="https://cli.angular.io/">Angular CLI</a> : <br><br><pre> <code class="hljs pgsql">ng <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> typescript-chat-client <span class="hljs-comment"><span class="hljs-comment">--routing --prefix tcc --skip-install</span></span></code> </pre> <br>  Install the project dependencies.  Here you can run the <code>npm install</code> command, but I prefer to use <a href="https://yarnpkg.com/en/">Yarn</a> in this step: <br><br><pre> <code class="hljs sql">cd typescript-chat-client yarn <span class="hljs-keyword"><span class="hljs-keyword">install</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Adding the Angular Material component set to a project</font> </h2><br>  In order to take advantage of the Angular Material component set in a project that was created using the Angular CLI, look at the fresh guide on <a href="https://material.angular.io/guide/getting-started">material.angular.io</a> and proceed in accordance with it. <br><br>  In accordance with the recommendations on the <a href="https://angular.io/guide/styleguide">structure of</a> Angular-projects, we will create the modules <code>shared</code> and <code>material</code> : <br><br><pre> <code class="hljs ruby">client/ <span class="hljs-params"><span class="hljs-params">|- src/  |</span></span>- app/     <span class="hljs-params"><span class="hljs-params">|- chat/     |</span></span>- shared/        <span class="hljs-params"><span class="hljs-params">|- material/           |</span></span>- material.<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.ts        <span class="hljs-params"><span class="hljs-params">|- shared.</span><span class="hljs-keyword"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span><span class="hljs-params">.ts     |</span></span>-app.<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.ts</code> </pre> <br>  This can be done from the command line: <br><br><pre> <code class="hljs java">ng generate <span class="hljs-keyword"><span class="hljs-keyword">module</span></span> shared --<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> app ng generate <span class="hljs-keyword"><span class="hljs-keyword">module</span></span> shared/material --<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> shared</code> </pre> <br>  To evaluate the relationship between these modules, analyze the files <code>app.module.ts</code> and <code>shared.module.ts</code> . <br><br><h2>  <font color="#3AC1EF">Connect express and Socket.IO</font> </h2><br>  Now we need to connect the <code>express</code> and <code>socket.io</code> modules to our client application: <br><br><pre> <code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> express socket.io <span class="hljs-comment"><span class="hljs-comment">--save</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Chat Modules &amp; Components</font> </h2><br>  Before creating components for the chat, create a new module: <br><br><pre> <code class="hljs java">ng generate <span class="hljs-keyword"><span class="hljs-keyword">module</span></span> chat --<span class="hljs-keyword"><span class="hljs-keyword">module</span></span> app</code> </pre> <br>  Now add a component to this module: <br><br><pre> <code class="hljs vhdl">ng <span class="hljs-keyword"><span class="hljs-keyword">generate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">component</span></span> chat <span class="hljs-comment"><span class="hljs-comment">--module chat</span></span></code> </pre> <br>  In order to use web sockets and your own models, create another <code>shared</code> folder.  This time - inside the <code>chat</code> directory: <br><br><pre> <code class="hljs coffeescript">ng generate service chat/shared/services/socket --<span class="hljs-built_in"><span class="hljs-built_in">module</span></span> chat ng generate <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chat</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shared</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">user</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ng</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">generate</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">chat</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">shared</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">message</span></span></span></span></code> </pre> <br>  The result should be the following structure: <br><br><pre> <code class="hljs ruby">client/ <span class="hljs-params"><span class="hljs-params">|- src/  |</span></span>- app/     <span class="hljs-params"><span class="hljs-params">|- chat/        |</span></span>- shared/          <span class="hljs-params"><span class="hljs-params">|- model/             |</span></span>- user.ts             <span class="hljs-params"><span class="hljs-params">|- message.ts          |</span></span>- services/             <span class="hljs-params"><span class="hljs-params">|- socket.service.ts     |</span></span>- shared/     <span class="hljs-params"><span class="hljs-params">|-app.</span><span class="hljs-keyword"><span class="hljs-params"><span class="hljs-keyword">module</span></span></span><span class="hljs-params">.ts</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Observables and Web Sockets</font> </h2><br>  Since our Angular application supports RxJS, you can use observable objects to work with Socket.IO events.  Therefore, the file <code>socket.services.ts</code> will look like this: <br><br><pre> <code class="hljs cs">import { Injectable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; import { Observable } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/Observable'</span></span>; import { Observer } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'rxjs/Observer'</span></span>; import { Message } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../model/message'</span></span>; import { Event } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../model/event'</span></span>; import * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> socketIo <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'socket.io-client'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SERVER_URL = <span class="hljs-string"><span class="hljs-string">'http://localhost:8080'</span></span>; @Injectable() export <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SocketService</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> socket;   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initSocket</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>): </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span></span> {       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socket = socketIo(SERVER_URL);   }   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message: Message</span></span></span><span class="hljs-function">): </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span></span> {       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socket.emit(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, message);   }   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>): Observable&lt;Message&gt;</span></span> {       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Observable&lt;Message&gt;(observer =&gt; {           <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socket.<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, (data: Message) =&gt; observer.next(data));       });   }   <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onEvent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">event</span></span></span></span><span class="hljs-function"><span class="hljs-params">: Event</span></span></span><span class="hljs-function">): Observable&lt;any&gt;</span></span> {       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Observable&lt;Event&gt;(observer =&gt; {           <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socket.<span class="hljs-keyword"><span class="hljs-keyword">on</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>, () =&gt; observer.next());       });   } }</code> </pre> <br>  Now we are ready to respond to messages from the server, so consider the <code>chat.component.ts</code> file (the code for Material and UI events is omitted here): <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Component, OnInit } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Action } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./shared/model/action'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Event } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./shared/model/event'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Message } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./shared/model/message'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { User } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./shared/model/user'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { SocketService } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./shared/services/socket.service'</span></span>; @Component({ <span class="hljs-attr"><span class="hljs-attr">selector</span></span>: <span class="hljs-string"><span class="hljs-string">'tcc-chat'</span></span>, <span class="hljs-attr"><span class="hljs-attr">templateUrl</span></span>: <span class="hljs-string"><span class="hljs-string">'./chat.component.html'</span></span>, <span class="hljs-attr"><span class="hljs-attr">styleUrls</span></span>: [<span class="hljs-string"><span class="hljs-string">'./chat.component.css'</span></span>] }) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChatComponent</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnInit</span></span></span><span class="hljs-class"> </span></span>{ action = Action; user: User; messages: Message[] = []; messageContent: string; ioConnection: any; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(private socketService: SocketService) { } ngOnInit(): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.initIoConnection(); } private initIoConnection(): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socketService.initSocket();   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ioConnection = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socketService.onMessage()     .subscribe(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message: Message</span></span></span><span class="hljs-function">) =&gt;</span></span> {       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.messages.push(message);     });   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socketService.onEvent(Event.CONNECT)     .subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {       <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'connected'</span></span>);     });       <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socketService.onEvent(Event.DISCONNECT)     .subscribe(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {       <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'disconnected'</span></span>);     }); } public sendMessage(message: string): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!message) {     <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;   }   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socketService.send({     <span class="hljs-attr"><span class="hljs-attr">from</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.user,     <span class="hljs-attr"><span class="hljs-attr">content</span></span>: message   });   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.messageContent = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } public sendNotification(params: any, <span class="hljs-attr"><span class="hljs-attr">action</span></span>: Action): <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> message: Message;   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action === Action.JOINED) {     message = {       <span class="hljs-attr"><span class="hljs-attr">from</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.user,       <span class="hljs-attr"><span class="hljs-attr">action</span></span>: action     }   } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action === Action.RENAME) {     message = {       <span class="hljs-attr"><span class="hljs-attr">action</span></span>: action,       <span class="hljs-attr"><span class="hljs-attr">content</span></span>: {         <span class="hljs-attr"><span class="hljs-attr">username</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.user.name,         <span class="hljs-attr"><span class="hljs-attr">previousUsername</span></span>: params.previousUsername       }     };   }   <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.socketService.send(message); } }</code> </pre> <br>  As soon as <code>ChatComponent</code> initialized, the component subscribes to the observed <code>SocketService</code> objects in order to receive connection-related events or incoming messages. <br><br>  The <code>sendMessage</code> and <code>sendNotification</code> will send, respectively, messages and notifications through the same service.  Notifications are used to notify the system that a new user has joined the chat and to rename the chat participants. <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  From this material, you learned how to use TypeScript to write a real-time application - a chat, in which TS is used both on the client and on the server, and in which technologies such as WebSockets, Node.js and Angular are involved.  The source code of the project can be found <a href="https://github.com/luixaviles/socket-io-typescript-chat">here</a> .  And <a href="https://typescript-chat.firebaseapp.com/">here</a> is a working chat (open a couple of tabs in the browser with this page in order to experience it). <br><br>  <b>Dear readers!</b>  Do you use TypeScript to develop server applications? <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div><p>Source: <a href="https://habr.com/ru/post/347306/">https://habr.com/ru/post/347306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347294/index.html">Type system in mathematics</a></li>
<li><a href="../347296/index.html">Backup with Software-defined Storage and Erasure Coding - is the game worth the candle?</a></li>
<li><a href="../347298/index.html">The school of interface developers of Yandex again opens the set</a></li>
<li><a href="../347300/index.html">Netscaler SD-WAN - Shuttle for "Network Factory"</a></li>
<li><a href="../347302/index.html">Getting a personal phone number by analyzing and sorting social resources and accounts</a></li>
<li><a href="../347312/index.html">IT infrastructure of Navalny headquarters and collection of signatures: preparation for collection, site ‚ÄúBulk 20! 8‚Äù</a></li>
<li><a href="../347314/index.html">"Fall" LKML.org: the cause of failure - the old home server</a></li>
<li><a href="../347316/index.html">IT infrastructure of Navalny headquarters and collection of signatures: hardware and networks</a></li>
<li><a href="../347320/index.html">Navalny Headquarters IT infrastructure and collection of signatures: Reaper-2018</a></li>
<li><a href="../347322/index.html">Not a feature, but a bug</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>