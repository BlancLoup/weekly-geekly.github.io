<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lambda and anonymous classes: who eats more</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Based on recent discussions here, I wanted to take a broader look at the question of who eats more - new-fashioned hipster lambdas or old proven anony...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lambda and anonymous classes: who eats more</h1><div class="post__text post__text-html js-mediator-article"><p>  Based on recent discussions <a href="https://habrahabr.ru/post/312894/">here, I</a> wanted to take a broader look at the question of who eats more - new-fashioned hipster lambdas or old proven anonymous classes.  Let's arrange a verbal skirmish between them and see who will win.  As with any good holivar, even if you can not find out the winner, you can learn a lot of new things for yourself. </p><a name="habracut"></a><br><h3>  First round  Space on the screen. </h3><br><p>  <strong>Lambda-kun</strong> : heh.  Hehe hehe.  No, this is not serious.  Well, how can this be compared to poverty: </p><br><pre><code class="java hljs">Runnable r = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ System.out.println(<span class="hljs-string"><span class="hljs-string">"Hello!"</span></span>); } };</code> </pre> <br><p>  With this beauty: </p><br><pre> <code class="java hljs">Runnable r = () -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">"Hello!"</span></span>);</code> </pre> <br><p>  <strong>Anon-san</strong> : well, well, young man, there is no need to say so.  Nowadays, nobody cares about what is actually in the file.  It is enough to take a good IDE and the difference is almost imperceptible. </p><br><p>  Here is the anonymous class: <img src="https://habrastorage.org/files/323/b37/587/323b375872eb4533a764868ba5d23c1a.png" alt="Anonymous class"></p><br><p>  But lambda: <img src="https://habrastorage.org/files/409/d90/7d6/409d907d60c448efb2164cd8803eef1f.png" alt="Lambda"></p><br><p>  <strong>Anon-san</strong> : at the same time, you can turn me around and see what I really am, but what you really are is a big mystery. </p><br><h3>  Round two.  Space on disk. </h3><br><p>  <strong>Lambda-kun</strong> : hh-hm ... No, that, of course, is not fair.  Okay.  But on the disk, I take less.  Take a simple class: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ Runnable r = () -&gt; {}; }</code> </pre> <br><p>  And with you there will be this: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ Runnable r = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }; }</code> </pre> <br><p>  52 bytes to 126!  What is it, huh? </p><br><p>  <strong>Anon-san</strong> : well, I agree with the source bytes, although whom they care about.  And if you compile? </p><br><p>  <strong>Lambda-kun</strong> : Naturally, I will win!  From me one file will turn out, and from you in general two!  In two files, twice as many headers and any meta-information. </p><br><p>  <strong>Anon-san</strong> : do not hurry, young man, let's check.  Run <code>javac Test.java</code> for both versions.  What do we see?  The anonymous class version generates <code>Test.class</code> (308 bytes) and <code>Test$1.class</code> (377 bytes), a total of 685 bytes, and the lambda option only generates <code>Test.class</code> , but it weighs 783 bytes.  Almost a hundred bytes overhead - not expensive for syntactic sugar? </p><br><p>  <strong>Lambda-kun</strong> : uh, how did that come about?  It could not be, I'm lighter!  Well, with debug information, how much will it be?  Still compile with it. </p><br><p>  <strong>Anon-san</strong> : let's try: <code>javac -g Test.java</code> .  Lambda - 838 bytes, an anonymous class - 825 bytes.  So the difference is smaller, but still the vaunted lightness is not visible.  You forget that every lambda call creates a spreading entry in <a href="http://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html">Bootsrtap methods</a> , which anonymous classes do not need. </p><br><p>  <strong>Lambda-kun</strong> : wait, wait.  I got it.  This is not the recording itself spreading, but constants that fall into the pool of constants.  Anything like <code>java/lang/invoke/LambdaMetafactory.metafactory:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodType;Ljava/lang/invoke/MethodHandle;Ljava/lang/invoke/MethodType;)Ljava/lang/invoke/CallSite;</code>  .  Yes, they are long, but reused, if the lambda is more than one.  Well, add the second: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ Runnable r = () -&gt; {}; Runnable r2 = () -&gt; {}; }</code> </pre> <br><p>  <strong>Lambda-kun</strong> : Vooot, I'm already winning!  With debug information 957 bytes, and if you replace with anonymous classes, it will be important to 1351 bytes in three files.  Even without debug information, I win.  But other constants may effectively be reused!  Any fields, methods, classes used inside lambda.  If they are used in several lambdas or in lambda and around it, they will collapse into one constant.  And with anonymous classes in each will be a copy.  That's the same thing! </p><br><h3>  Third round.  Classes in runtime. </h3><br><p>  <strong>Anon-san</strong> : apparently, then I have to give up.  If lambda is a lot, then you are really smaller in compiled form.  However, it is more interesting what happens in runtime, in the memory of the virtual machine.  Suppose you do not have an anonymous class on the disk, but the exact same class, or even a larger one, will be generated at startup and devour all the same resources. </p><br><p>  <strong>Lambda-kun</strong> : but not the same!  I'm lightweight!  There will surely be generated a small compact classic that does not contain any unnecessary nonsense.  And how will you check it?  Well it is all in runtime in memory! </p><br><p>  <strong>Anon-san</strong> : but you are ashamed of not knowing this.  Should you somehow debug the developers.  There is an <a href="">undocumented system property</a> <code>jdk.internal.lambda.dumpProxyClasses</code> , with which you can specify in which directory to throw the generated runtime views lambda.  Run the application with <code>-Djdk.internal.lambda.dumpProxyClasses=.</code>  and see everything. </p><br><p>  <strong>Lambda-kun</strong> : aha, only as long as you never use lambda, the runtime presentation will not be generated at all, and anonymous classes always exist, even if they have never been useful! </p><br><p>  <strong>Anon-san</strong> : there is no difference.  On the contrary, the difference is not in your favor.  An anonymous class always exists on disk, but it will not be loaded into memory until it is used.  Of course, the Rantaim representation of lambda will not be generated, but its body is actually loaded in the form of a private synthetic method along with the class in which it is declared.  Even if the body is never used, it will remove the memory.  However, we will return to this issue later.  Let's see first what happens if lambda is used.  To do this, we need to modify the program a bit: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Runnable r = () -&gt; {}; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br><p>  Compile (well, even with debug information), run <code>java -Djdk.internal.lambda.dumpProxyClasses=. Test</code>  <code>java -Djdk.internal.lambda.dumpProxyClasses=. Test</code> and see: lambda created the class <code>Test$$Lambda$1.class</code> , which weighs 308 bytes.  This is in addition to the main class <code>Test.class</code> , which weighs 1004 bytes.  Replacing lambda with a similar anonymous class, we have 508 + 399 bytes in two classes at once, but nothing is created in runtime.  You still eat a lot, young man, 405 bytes more than me. </p><br><p>  <strong>Lambda-kun</strong> : Well, we agreed that it would be dishonest to measure with one lambda.  Let's add the second one. </p><br><p>  <strong>Anon-san</strong> : yes, at least ten.  We add <code>static Runnable r1 = () -&gt; {};</code>  and so on.  It turns out 11 classes, with lambdas 5174 bytes, and with anonymous - 5059 bytes.  Slowly I‚Äôm catching up with you, of course, but, you see, I don‚Äôt have 10 lambdas in every class.  Somewhere after the 14th anonymous class, only you start to eat less. </p><br><p>  <strong>Lambda-kun</strong> : well, well.  And let's put all these lambdas right into the <code>main()</code> method.  Admit it, they rarely lie in static fields, ne? </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Runnable r = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() {<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{}}; Runnable r1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() {<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{}}; Runnable r2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Runnable() {<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{}}; ... } }</code> </pre> <br><p>  <strong>Anon-san</strong> : hmm, what's the difference? </p><br><p>  <strong>Lambda-kun</strong> : compile and see.  At me just there is no difference, the classes generated in rantayma weigh as much.  And you have every byte 40 fat.  Now I eat less than ten lambdas (5,290 bytes versus 4,995).  Already even at six, I'm ahead of you! </p><br><p>  <strong>Anon-san</strong> : ah, there it is.  For debugging, a line <code>EnclosingMethod: Test.main</code> now been added to each anonymous class, which, of course, eats up additional space.  Eh, in vain I agreed to debug information. </p><br><p>  <strong>Lambda-kun</strong> : this entry is added even with debugging information completely disabled ( <code>javac -g:none</code> ).  This attribute <a href="http://docs.oracle.com/javase/specs/jvms/se8/html/jvms-4.html">must be</a> specified by the specification, regardless of debugging.  And my runtime representation is not formally an anonymous class, and it does not need this attribute.  You're lucky that the name of the <code>main</code> method is so short.  If anonymous classes in a method with a long name, each will eat off additionally in proportion to its length! </p><br><p>  <strong>Anon-san</strong> : in my opinion, our game is already flowing into a dishonest plane.  So here, with your permission, the counterstrike: closure on variables.  I accept your condition and stay inside the method.  But let's capture the variable: </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.IntSupplier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; IntSupplier s = () -&gt; i; IntSupplier s1 = () -&gt; i; IntSupplier s2 = () -&gt; i; ... } }</code> </pre> <br><p>  Well, for anonymous classes, replace with <code>new IntSupplier() {public int getAsInt() {return i;}}</code> .  How much do you think lambdas will take to defeat anonymous classes now? </p><br><p>  <strong>Lambda-kun</strong> : well, there should be no difference.  Your compiler generates a synthetic field and a constructor with one parameter that initializes this field.  At me approximately the same will be created in.  Some sort of such a class is generated for both you and me: </p><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class">$1 </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IntSupplier</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> val$i; Test$<span class="hljs-number"><span class="hljs-number">1</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i) { val$i = i; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAsInt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> val$i; } }</code> </pre> <br><p>  <strong>Anon-san</strong> : so, but not so.  We try.  One lambda: 1493 bytes, one anonymous class: 1006 bytes.  Ten lambda: 6803 bytes, ten anonymous classes: 6039 bytes.  Twenty lambda: 12743 bytes, twenty anonymous classes: 11669 bytes.  The gap is constantly increasing!  There are at least a thousand lambdas, and you will not catch up with me. </p><br><p>  <strong>Lambda-kun</strong> : uh ... So.  Well, we decompile.  What kind of nonsense is this?  Any factory method?  Some kind of nonsense.  In addition to the constructor, I also for some reason add a method of the form <code>static IntSupplier get$Lambda(int i) { return new Test$1(i);}</code> .  What nonsense, why? </p><br><p>  <strong>Anon-san</strong> : not nonsense, but performance.  Sometime in ancient times, <a href="https://habrahabr.ru/users/walrus/" class="user_link">Walrus</a> <a href="https://habrahabr.ru/users/Walrus/">corrected the</a> speed of instantiating lambda in the interpreter ( <a href="https://bugs.openjdk.java.net/browse/JDK-8023984">JDK-8023984</a> ).  The factory method was faster than the constructor.  Notice, young man, there are no such strange problems with me, everything is fast and so. </p><br><p>  <strong>Lambda-kun</strong> : this is nonsense!  There is no to finish their metotekhandly to the mind, they sculpt crutches ... Interestingly, maybe you have finished it since then and this method has not become necessary? .. </p><br><p>  <strong>Anon-san</strong> : how to know, how to know ... </p><br><p>  <strong>Lambda-kun</strong> : but my turn!  I accept your condition and variable capture, but let's not <code>IntSupplier</code> , but <code>Supplier&lt;Integer&gt;</code> : </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.Supplier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; Supplier&lt;Integer&gt; s = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Supplier&lt;Integer&gt;() {<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i;}}; Supplier&lt;Integer&gt; s1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Supplier&lt;Integer&gt;() {<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Integer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i;}}; ... } }</code> </pre> <br><p>  Well, the lambda will remain as before: <code>Supplier&lt;Integer&gt; s = () -&gt; i</code> . </p><br><p>  <strong>Anon-san</strong> : hmm ... I don‚Äôt see where you want to fool me ... And, yes, a <code>Signature: Ljava/lang/Object;Ljava/util/function/Supplier&lt;Ljava/lang/Integer;&gt;;</code> entry will be added <code>Signature: Ljava/lang/Object;Ljava/util/function/Supplier&lt;Ljava/lang/Integer;&gt;;</code>  This is so that every reflection works correctly and <code>s.getClass().getGenericInterfaces()</code> returns the <code>Supplier&lt;Integer&gt;</code> , and not just the <code>Supplier</code> .  Do not you need it? </p><br><p>  <strong>Lambda-kun</strong> : it turns out not.  Lambda is permissible for it not to work for her! </p><br><p>  <strong>Anon-san</strong> : however, although this line will remove the place, I can not believe that it is very much against your factory method. </p><br><p>  <strong>Lambda-kun</strong> : but you do not believe, but check.  Now only three lambdas eat less than three anonymous classes (2963 against 3034 bytes) and with each new line you lose more and more!  Each anonymous class eats 270 bytes more than the corresponding lambda.  And this is in view of the fact that I have an extra factory method! </p><br><p>  <strong>Anon-san</strong> : can not be.  What else is there a compiler?  Aah, how could I forget.  Bridge method  Since we have <code>Integer get() {}</code> in the code, and <code>Object get()</code> in the interface after erasure, we need another bridge, which, when the interface is called, will redirect to <code>Integer get()</code> .  Do you need a bridge? </p><br><p>  <strong>Lambda-kun</strong> : no, and we do not need a bridge.  More precisely, on the contrary, we always need it, <code>Object get()</code> is a bridge, and the actual implementation is in the main class in a synthetic method of the form <code>lambda$main$1</code> .  But the bridge is always the same; in the case of generics, the second bridge is not needed.  But you needed and then it became clear that we are still actually lightweight! </p><br><p>  <strong>Anon-san</strong> : in general, of course, our tests are not very reliable.  It is not known how far the size of the class files and the memory consumption in runtime actually correlate.  But for today the conversation has been delayed, so postpone this question for the next time. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/313350/">https://habr.com/ru/post/313350/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313338/index.html">Programming & Music: Delay, Distortion and Parameter Modulation. Part 4</a></li>
<li><a href="../313340/index.html">Thematic modeling on the way to exploratory information search. Lecture in Yandex</a></li>
<li><a href="../313342/index.html">MikroTik. Correct dst nat when using 2 or more providers</a></li>
<li><a href="../313344/index.html">How to order and promote a mobile application: digest of useful materials</a></li>
<li><a href="../313346/index.html">Diary of a bug: how I repaired pictures in e-mail</a></li>
<li><a href="../313356/index.html">Add disk space for a Linux ‚Äì server in the Azure Pack Infrastructure cloud, and at the same time, we are working with LVM</a></li>
<li><a href="../313364/index.html">Experience in building and operating large file storage</a></li>
<li><a href="../313366/index.html">Sharding - patterns and antipatterns</a></li>
<li><a href="../313370/index.html">Elements of functional programming in C ++: partial application</a></li>
<li><a href="../313372/index.html">Elections 2016. Part 2 is amazing nearby and it is allowed</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>