<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dynamic display of logs in the browser on Node.js & WebSocket</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dynamic display of logs in the browser on Node.js & WebSocket 
 Sometimes there is a need to dynamically track the emergence of new files in certain f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dynamic display of logs in the browser on Node.js & WebSocket</h1><div class="post__text post__text-html js-mediator-article"><h5>  Dynamic display of logs in the browser on Node.js &amp; WebSocket </h5><br>  Sometimes there is a need to dynamically track the emergence of new files in certain folders, as well as output content log files to the browser window.  With this simplified example, I want to show how this can be done. <br><br><h5>  Solution tools and modules </h5><br>  Node.js was selected for the server side.  But a similar example can be similarly implemented using EM ruby.  In this case, the library bribed <a href="http://socket.io/">Socket.IO</a> , as well as several simple modules for working with files. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="https://github.com/mikeal/watch">Utilities for watching file trees in node.js</a> - the meaning of which is to track the appearance, deletion, and changes in the files inside the specified folder. <br><br>  An example of tracking the appearance / deletion of files inside common.NODES_PATH and sending a message about these events. <br><br><pre><code class="javascript hljs">watch.createMonitor(common.NODES_PATH, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">monitor</span></span></span><span class="hljs-function">) </span></span>{ monitor.on(<span class="hljs-string"><span class="hljs-string">"created"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f, stat</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> file_name = common.removeRoot(f); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(file_name + <span class="hljs-string"><span class="hljs-string">' created'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> idx = log_files.indexOf(file_name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idx &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { log_files.push(file_name); io.sockets.emit(<span class="hljs-string"><span class="hljs-string">'log_files_add'</span></span>, [file_name]); watchFile(file_name); } }) monitor.on(<span class="hljs-string"><span class="hljs-string">"removed"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">f, stat</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> file_name = common.removeRoot(f); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(file_name + <span class="hljs-string"><span class="hljs-string">' removed'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> idx = log_files.indexOf(file_name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (idx &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { log_files.splice(idx, <span class="hljs-number"><span class="hljs-number">1</span></span>); io.sockets.emit(<span class="hljs-string"><span class="hljs-string">'log_files_remove'</span></span>, [file_name]); unwatchFile(file_name); } }) })</code> </pre> <br><br>  <a href="https://github.com/nshah/nodejs-walker">A nodejs directory walker</a> - a package that allows you to walk through the insides of the specified folder and receive events to find a particular type of file.  Or, if it's simplistic, just recursively go through all the nested folders and see what lies there.  (example is slightly lower) <br><br>  <a href="http://jade-lang.com/">Jade - Template Engine</a> - to quickly jot down a simplified UI and test the idea. <br><br><h5>  Implementation example </h5><br><ul><li>  Create a web server on the specified port; </li><li>  When we first connect to the server, we go through the folders with the walker and send the initial piece of information about the existing files (plus the filter by extension) and the last 20 lines. <br><br><pre> <code class="javascript hljs">io.sockets.on(<span class="hljs-string"><span class="hljs-string">'connection'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">socket</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> walk = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'walk'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// receive list of log files var walker = walk.walk(common.NODES_PATH, { followLinks: false }); walker.on('file', function(root, stat, next) { if(/log$/.test(stat.name)) { var file_name = common.removeRoot(root + '/' + stat.name); var idx = log_files.indexOf(file_name); if (idx &lt; 0) { log_files.push(file_name); // send initial data portion var tail = spawn('tail', ['-n', 20].concat(common.NODES_PATH + '/' + file_name)); tail.stdout.on('data', function(data) { console.log('emit starting ' + file_name + ':lines' + ' with ' + data.toString('utf-8')); io.sockets.emit(file_name + ':lines', data.toString('utf-8').split('\n')); }); watchFile(file_name); } } next(); }); walker.on('end', function() { socket.emit('log_files_add', log_files); }); })</span></span></code> </pre><br><br></li><li>  With watch, we create a monitor that will monitor the appearance of new files or deletion.  (When deleting a file, the block displaying the specified log is deleted accordingly) <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">watchFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'start watching: '</span></span> + file); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tail = spawn(<span class="hljs-string"><span class="hljs-string">'tail'</span></span>, [<span class="hljs-string"><span class="hljs-string">'-f'</span></span>].concat(common.NODES_PATH + <span class="hljs-string"><span class="hljs-string">'/'</span></span> + file)); watching_processes[file] = tail; tail.stdout.on(<span class="hljs-string"><span class="hljs-string">'data'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'emit '</span></span> + file + <span class="hljs-string"><span class="hljs-string">':lines'</span></span> + <span class="hljs-string"><span class="hljs-string">' with '</span></span> + data.toString(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)); io.sockets.emit(file + <span class="hljs-string"><span class="hljs-string">':lines'</span></span>, data.toString(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>).split(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>)); }) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unwatchFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">file</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'end watching: '</span></span> + file); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> process = watching_processes[file]; process.kill(); watching_processes[file] = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre><br><br></li></ul><br><br><h5>  Launch </h5><br>  In common.js, which folder to monitor <br> <code>var NODES_PATH = pathResolver.resolve(__dirname + '/../nodes');</code> <br> <br>  When * .log appears inside folders and subfolders, they will be displayed in the browser window <br><br>  <code>npm install</code> to install packages <br><br> <code>[~/Projects/autotest_node] git:master $ mkdir nodes <br> [~/Projects/autotest_node] git:master $ mkdir nodes/test1 <br> [~/Projects/autotest_node] git:master $ mkdir nodes/test2 <br> [~/Projects/autotest_node] git:master $ echo "test_message1" &gt;&gt; nodes/test1/first.log <br> [~/Projects/autotest_node] git:master $ echo "test_message1" &gt;&gt; nodes/test2/first.log <br> [~/Projects/autotest_node] git:master $ echo "test_message2" &gt;&gt; nodes/test2/first.log <br> [~/Projects/autotest_node] git:master $ echo "test_message2" &gt;&gt; nodes/test1/first.log</code> <br> <br>  <code>npm start</code> to start the server <br><br><img src="http://www.habrastorage.com/images/logmonitor.jpg" alt="image"><br><br><h5>  Source </h5><br>  <a href="https://github.com/catz/autotest_node">https://github.com/catz/autotest_node</a> <br><h5>  Conclusion </h5><br><br>  This example can be useful, for example, if you want to share the results of automatic test cases and give others the opportunity to follow the results of their execution.  Although there are more advanced tools for such tasks, but if you want to make a simple tail -f in the browser, then a similar example might well be appropriate. </div><p>Source: <a href="https://habr.com/ru/post/144445/">https://habr.com/ru/post/144445/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144439/index.html">Find admin + shell on *******. Alfabank.ru using Google</a></li>
<li><a href="../144441/index.html">Opera Mobile and Opera Mini Updates</a></li>
<li><a href="../144442/index.html">Comparison of approaches to site creation: design, brief and agile</a></li>
<li><a href="../144443/index.html">The second day of the broadcast with DevCon'12! More reports</a></li>
<li><a href="../144444/index.html">Yahoo! released its browser Axis</a></li>
<li><a href="../144446/index.html">Usability-torture in ITMO UX-laboratories</a></li>
<li><a href="../144447/index.html">Audit Active Directory: goals, shortcomings of the staff audit system and ways to overcome them</a></li>
<li><a href="../144450/index.html">We learn SQLite to work with the localized calendar</a></li>
<li><a href="../144451/index.html">IBM banned Siri</a></li>
<li><a href="../144453/index.html">WarCraft III / Dota in brief about creating a cheat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>