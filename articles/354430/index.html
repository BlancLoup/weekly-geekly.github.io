<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a signature on the template in Outlook for the organization, on computers outside the domain</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We have been using MS Exch with AD for a long time in the company, but most of the computers in remote branches are not included in the domain, and ju...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a signature on the template in Outlook for the organization, on computers outside the domain</h1><div class="post__text post__text-html js-mediator-article">  We have been using MS Exch with AD for a long time in the company, but most of the computers in remote branches are not included in the domain, and just as long ago, our DG was annoyed that the people in the signature use anything, just not accepted by the corporate standard template. <br><br>  Thinking a little and having estimated the further nerve expenditure on explaining why it cannot be combed, I decided that it was better to do it. <br><br>  Having rummaged in an Internet did not find examples of implementation of the signature on in advance written template, and it was necessary to sculpt most. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I decided to issue this in the form of a request from the user through the dialog box of his belonging to the desired object.  In order not to produce a bunch of InputBox decided to implement this through a pop-up window IE, from which all the necessary data is later pulled. <br><a name="habracut"></a><br><ul><li>  Request the necessary information from the user </li></ul><br>  Since the company uses 4 main brands with different logos, the user must select his own, relative to the selected brand, his image will be inserted into the logo. <br><br>  To select the position and units from the list are used datalist in which all possible options are previously described.  (I didn‚Äôt think of a better way, if someone tells you how to implement a selection from the list using an external directory file, it will be super.) <br><br>  Also, processing is inserted in the user selection piece of the brand, since the format of departments in one brand is different for us, depending on the brand, the format of the institution is chosen. <br><br><pre><code class="vbscript hljs"><span class="hljs-comment"><span class="hljs-comment">'    Dim objIE Dim Brand Set objIE = CreateObject( "InternetExplorer.Application" ) objIE.Navigate "about:blank" objIE.Document.Title = "  " objIE.ToolBar = False objIE.Resizable = False objIE.StatusBar = False objIE.Width = 600 objIE.Height = 250 Do While objIE.Busy WScript.Sleep 200 Loop objIE.Document.Body.InnerHTML = "&lt;DIV align=""Left""&gt;&lt;P&gt;"&amp;_ "&lt;datalist id=""rw""&gt;&lt;option&gt;&lt;/option&gt;&lt;option&gt;&lt;/option&gt;&lt;/datalist&gt;"&amp;_ "&lt;datalist id=""obj""&gt;&lt;option&gt;1&lt;/option&gt;&lt;option&gt;2&lt;/option&gt;&lt;option&gt;3&lt;/option&gt;&lt;/datalist&gt;"&amp;_ "&lt;input type='radio' name='RadioOption' value='1'&gt;U "&amp;_ "&lt;input type='radio' name='RadioOption' value='2'&gt;M "&amp;_ "&lt;input type='radio' name='RadioOption' value='3'&gt;C&lt;br&gt;"&amp;_ "&lt;input type='radio' name='RadioOption' value='4'&gt;L&lt;br&gt;"&amp;_ "&lt;input List='rw' name='Dol' &gt;&lt;br&gt;"&amp;_ "&lt;input List='obj' name='objt' &gt;&lt;br&gt;"&amp;_ "&lt;input type='text' name='FIO' &gt; &lt;br&gt;"&amp;_ "&lt;input type='tel' name='tel' &gt;    +7(***)***-**-**&lt;br&gt;"&amp;_ "&lt;input id='OK' type='hidden' value='0' name='OK'&gt;"&amp;_ "&lt;input type='submit' value='OK' onClick='VBScript:OK.Value=1'&gt;" objIE.Visible = True Do While objIE.Document.All.OK.Value = 0 WScript.Sleep 200 Loop If objIE.Document.All.RadioOption(0).checked=true then Brand ="U" If objIE.Document.All.RadioOption(1).checked=true then Brand="M" If objIE.Document.All.RadioOption(2).checked=true then Brand="c" If objIE.Document.All.RadioOption(3).checked=true then Brand="L" If objIE.Document.All.RadioOption(0).checked=true then strCompany="U" If objIE.Document.All.RadioOption(1).checked=true then strCompany="M" If objIE.Document.All.RadioOption(2).checked=true then strCompany="C" If objIE.Document.All.RadioOption(3).checked=true then strCompany="L" If objIE.Document.All.RadioOption(3).checked=true then dolj= objIE.Document.All.Dol.Value+" " else dolj= objIE.Document.All.Dol.Value+" " objtj= objIE.Document.All.objt.Value strMobile = objIE.Document.All.tel.Value strName = objIE.Document.All.FIO.Value objIE.Quit</span></span></code> </pre> <br>  On this request from the user information that we can get from him is completed. <br><br><ul><li>  Clarification of the mail address </li></ul><br>  Since we assume that this script will run where there is already mail configured in Outlook, the easiest way to find out the email address is to look at how it is already configured, and not to wait for the user to enter it himself, making a mistake a couple of times in points and letters. <br>  The most simple and logical way in my opinion is to find out the username of the user logged in to the system, look into his daddy with the profile and look at the name of the OST file, which is equivalent to the address of the mailbox connected via MAPI. <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">On</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Error</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Resume</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> strComputer = <span class="hljs-string"><span class="hljs-string">"."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objWMIService = <span class="hljs-built_in"><span class="hljs-built_in">GetObject</span></span>(<span class="hljs-string"><span class="hljs-string">"winmgmts:\\"</span></span> &amp; strComputer &amp; <span class="hljs-string"><span class="hljs-string">"\root\cimv2"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> colItems = objWMIService.ExecQuery(<span class="hljs-string"><span class="hljs-string">"Select * from Win32_ComputerSystem"</span></span>,,<span class="hljs-number"><span class="hljs-number">48</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Each</span></span> objItem <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> colItems login_full =objItem.UserName <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objItem = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> colItems = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objWMIService = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> login_find = <span class="hljs-string"><span class="hljs-string">"\"</span></span> login_pos = <span class="hljs-built_in"><span class="hljs-built_in">InStr</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>,login_full,login_find) login_len = <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(login_full) login = <span class="hljs-built_in"><span class="hljs-built_in">right</span></span>(login_full,login_len-login_pos) folder_find = <span class="hljs-string"><span class="hljs-string">"C:\Users\"</span></span>&amp;login&amp;<span class="hljs-string"><span class="hljs-string">"\AppData\Local\Microsoft\Outlook"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objShellApp = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"Shell.Application"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objFolder = objShellApp.NameSpace(folder_find) <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objFolderItems = objFolder.Items() objFolderItems.<span class="hljs-built_in"><span class="hljs-built_in">Filter</span></span> <span class="hljs-number"><span class="hljs-number">64</span></span>+<span class="hljs-number"><span class="hljs-number">128</span></span>, <span class="hljs-string"><span class="hljs-string">"*.ost"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Each</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> objFolderItems file_name = file <span class="hljs-keyword"><span class="hljs-keyword">Next</span></span> file_len = <span class="hljs-built_in"><span class="hljs-built_in">len</span></span>(file_name) strEmail = <span class="hljs-built_in"><span class="hljs-built_in">left</span></span>(file_name,file_len<span class="hljs-number"><span class="hljs-number">-4</span></span>)</code> </pre><br><ul><li>  Signature generation for Outlook </li></ul><br>  After collecting all the necessary data we proceed to the formation of the signature itself. <br>  The template is formed 2, full for new messages, and short - for answers. <br>  There are several pictures in the template that come from the corpus of the file storage, to which everyone has read access by default.  And all the logos are drawn from there. <br>  Script comments on the text of the code <br><br><pre> <code class="vbscript hljs">strZpov = <span class="hljs-string"><span class="hljs-string">" , "</span></span> strTitle = dolj+<span class="hljs-string"><span class="hljs-string">" "</span></span>+objtj strweb = <span class="hljs-string"><span class="hljs-string">"www.www.ru"</span></span> strLogo1 = <span class="hljs-string"><span class="hljs-string">"\\cabinet\\\"</span></span>&amp;Brand&amp;<span class="hljs-string"><span class="hljs-string">"_logo_wl.jpg"</span></span> <span class="hljs-comment"><span class="hljs-comment">'  strLogo3 = "\\cabinet\\\Ins.jpg" '  instagram strLogo2 = "\\cabinet\\\F.JPG" '  facebook strLogo4 = "\\cabinet\\\line.png" '    strLogo5 = "\\cabinet\\\Save_wood.jpg" '    Set objWord = CreateObject("Word.Application") Set objDoc = objWord.Documents.Add() Set objSelection = objWord.Selection Set objEmailOptions = objWord.EmailOptions Set objSignatureObject = objEmailOptions.EmailSignature Set objSignatureEntries = objSignatureObject.EmailSignatureEntries Set objRange = objDoc.Range() '          . '       3  , 2    2  objDoc.Tables.Add objRange,3,2 Set objTable = objDoc.Tables(1) objTable.Rows(1).select '  1,  objSelection.Cells.Merge '         objTable.Cell(1, 1).select '  1      objTable.Cell(1, 1).Width = 605 objselection.font.name = "Cambria" objSelection.Font.Size = "10" objSelection.Font.Color = RGB(88,89,91) '       ( , , , , ) '         mailto: objSelection.TypeText strZpov &amp; strName &amp; CHR(11) objSelection.TypeText strTitle &amp; CHR(11) objSelection.Font.Bold = true objSelection.TypeText strCompany &amp; CHR(11) objSelection.Font.Bold = false objSelection.TypeText strMobile &amp; CHR(11) hyp.Range.Font.name = "Cambria" hyp.Range.Font.Size = "10" hyp.Range.Font.Name = "Cambria" Set hyp = objSelection.Hyperlinks.Add(objSelection.Range, "mailto: " &amp; strEmail,,, strEmail) hyp.Range.Font.Name = "Cambria" hyp.Range.Font.Size = "10" ' 2,  1,      objTable.Cell(2, 1).select objTable.Cell(2, 1).Width = 150 objTable.Cell(2, 1).Text = objSelection.InlineShapes.AddPicture(strLogo1) '  2  2,         objTable.Cell(2, 2).select objselection.font.name = "Cambria" objSelection.Font.Size = "9,5" objSelection.Font.Color = RGB(88,89,91) objSelection.TypeText "111111, ,  1 10, " &amp; CHR(11) '   ,         '   ,    ,   ,     '     ,       strintPhone if (strPhone &lt;&gt; "") then objSelection.TypeText " ¬´¬ª, " &amp; strPhone else objSelection.TypeText " ¬´¬ª, +7(111)111-11-11" if (strIntPhone &lt;&gt; "") then objSelection.TypeText " . " &amp; strIntPhone &amp; CHR(11) else objSelection.TypeText CHR(11) Set hyp = objSelection.Hyperlinks.Add(objSelection.Range, strWeb,,, strWeb) hyp.Range.Font.Name = "Cambria" hyp.Range.Font.Size = "9,5" objSelection.TypeText CHR(9) set p_f = objSelection.InlineShapes.AddPicture(strLogo2) Set hyp = objSelection.HyperLinks.Add(p_f, "https://www.facebook.com/kremlin/",,,"Image") hyp.Range.Font.Name = "Cambria" hyp.Range.Font.Size = "9,5" objSelection.TypeText " " set p_i = objSelection.InlineShapes.AddPicture(strLogo3) Set hyp = objSelection.HyperLinks.Add(p_i, "https://www.instagram.com/kremlin/",,,"Image") hyp.Range.Font.Name = "Cambria" hyp.Range.Font.Size = "9,5" objselection.font.name = "Cambria" objSelection.Font.Size = "9,5" objSelection.Font.Color = RGB(88,89,91) objSelection.TypeText " @kremlin" objTable.Rows(3).select '  3,        -   objSelection.Cells.Merge objTable.Cell(3, 1).select objTable.Cell(3, 1).Width = 605 objTable.Cell(3, 1).Text = objSelection.InlineShapes.AddPicture(strLogo5) ''' '          outlook    Set objSelection = objDoc.Range() objSignatureEntries.Add "AD Signature", objSelection objSignatureObject.NewMessageSignature = "AD Signature" objDoc.Saved = True objDoc.Close objWord.Quit ''' '             '            '   Set objWord = CreateObject("Word.Application") Set objDoc = objWord.Documents.Add() Set objSelection = objWord.Selection Set objEmailOptions = objWord.EmailOptions Set objSignatureObject = objEmailOptions.EmailSignature Set objSignatureEntries = objSignatureObject.EmailSignatureEntries Set objRange = objDoc.Range() objselection.font.name = "Cambria" objSelection.Font.Size = "10" objSelection.Font.Color = RGB(88,89,91) objSelection.TypeText strZpov &amp; strName &amp; CHR(11) objSelection.TypeText strTitle &amp; CHR(11) if (strMobile &lt;&gt; "") then objSelection.TypeText strMobile &amp; " | " if (strPhone &lt;&gt; "") then objSelection.TypeText strPhone else objSelection.TypeText "+7(111)111-11-11" if (strIntPhone &lt;&gt; "") then objSelection.TypeText " . " &amp; strIntPhone &amp; CHR(11) else objSelection.TypeText CHR(11) ''' Set objSelection = objDoc.Range() objSignatureEntries.Add "Short_Signature", objSelection objSignatureObject.ReplyMessageSignature = "Short_Signature" objDoc.Saved = True objDoc.Close objWord.Quit</span></span></code> </pre><br><br>  Actually, the final form of the signatures is as follows. <br><img src="https://habrastorage.org/webt/cv/3k/of/cv3kofgpxjrwcgpdjam6qqgfngu.png"><br><img src="https://habrastorage.org/webt/fi/vl/ze/fivlzeznfqybrpqt4_x5a9erqjs.png"></div><p>Source: <a href="https://habr.com/ru/post/354430/">https://habr.com/ru/post/354430/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354418/index.html">Being Digital (Nicolas Negroponet's fundamental article on the digital economy for 1995, part 2)</a></li>
<li><a href="../354420/index.html">Formation of JWS and JWK from rsa keys using the example of Let's Encrypt and ISPmanager integration</a></li>
<li><a href="../354422/index.html">Can't login to AdWords? What to do?</a></li>
<li><a href="../354424/index.html">Digest of IT events for May</a></li>
<li><a href="../354426/index.html">Mother's son's style of girlfriend</a></li>
<li><a href="../354432/index.html">These incredibly valuable skills will help you become more successful.</a></li>
<li><a href="../354434/index.html">Pandora's White Box</a></li>
<li><a href="../354438/index.html">How JS Works: Animation with CSS and JavaScript</a></li>
<li><a href="../354440/index.html">Black Friday 2017 through the eyes of IT and developers. As we stood black Friday with a 10 times increase in traffic</a></li>
<li><a href="../354442/index.html">What is hidden inside the online cash registers: the development of a fiscal registrar</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>