<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Everything is relative, or the implementation of one simple task in python and tcl</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For historical reasons, in our office, we use an old PBX Panasonic TDA200. And, as you know, it displays the call log to the serial port, from which o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Everything is relative, or the implementation of one simple task in python and tcl</h1><div class="post__text post__text-html js-mediator-article">  For historical reasons, in our office, we use an old PBX Panasonic TDA200.  And, as you know, it displays the call log to the serial port, from which one programmer was used on the server to read data from.  This software has a number of restrictions, which makes its use inconvenient (the size of the log file, the size of the database) and in order to overcome these shortcomings and due to natural laziness (to avoid constant cleaning of the log and database manually), it was decided to type something different.  And since, for a long time, the word ‚Äúpython‚Äù comes across and the inquisitive mind periodically wakes up, it was decided to implement this task in this language and along the way, well familiar to me, tcl.  Well, I decided to share the results with the society.  Yes, I will immediately note that the problem has been solved and the service has been brought to "industrial" operation.  For data storage is used MariaDB DBMS (it already was), as a CentOS 7 host system. <br><a name="habracut"></a><br>  And one more remark - the python player from me is still the one, so you can kick for the quality of the code but not much.  Code examples will be given in this order: first the python and then the tickle, the description of the procedures and commands will go in the order necessary for understanding the work of the scripts, and not as they are written in the code. <br><br>  <i>Python</i> <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pymysql <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys, os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> re <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime <span class="hljs-comment"><span class="hljs-comment">#     db_host = 'host' db_user = 'dbuser' db_pass = 'dbpass' out_dir = '/var/log/ats'</span></span></code> </pre> <br>  <i>Tcl</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs pgsql">package require mysqltcl #     #<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> db(host) "host" #<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> db(<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>) "user" #<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> db(pass) "password" #<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> db(dbname) "ats_test" #<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> out_dir "~/tmp/ats"</code> </pre> <br>  Here, in general, everything is clear - we import the necessary and not very modules, and initialize the variables.  But in the example on tcl the lines are commented out (these lines need to be moved to another file, see under spoiler), below it will be clear why. <br><br><div class="spoiler">  <b class="spoiler_title">config.tcl</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">#     <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> db(host) "host" <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> db(<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>) "user" <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> db(pass) "password" <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> db(dbname) "ats_test" <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> out_dir "~/tmp/ats"</code> </pre> <br></div></div><br>  The script can process data from a text file and directly from the serial port. To do this, add keys to run, respectively, <i>-port</i> - read from the port, <i>-file</i> - read from the file: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(sys.argv) &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> sys.argv[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'-port'</span></span>: <span class="hljs-comment"><span class="hljs-comment">#action = 'read_port' port_name = sys.argv[2] port_data_read(port_name) if sys.argv[1] == '-file': #action = 'read_file' log_file_name = sys.argv[2] log = open(log_file_name) for line in log: parce_string(line) log.close() else: print ("\n :\n-   \ \n # python data_reader.py -file TDA20013082015_12052016.lg\ \n-      com- \ \n # python data_reader.py -port /dev/ttyUSB0\n") sys.exit(1)</span></span></code> </pre><br>  In the tcl-script, one more option <i>-conf was added</i> , the code was tested on the working server, and there was also a tickle besides the python there, it was already too much.  And according to this, I had to build an "executable" on the principle of "all inclusive" and to ensure the flexibility of the settings, this option was added (and even more so). <br><br><pre> <code class="hljs mel">#     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[llength $argv] &gt;= <span class="hljs-number"><span class="hljs-number">2</span></span>} { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[lindex $argv <span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-string"><span class="hljs-string">"-conf"</span></span>} { <span class="hljs-keyword"><span class="hljs-keyword">source</span></span> [lindex $argv <span class="hljs-number"><span class="hljs-number">1</span></span>] } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { puts <span class="hljs-string"><span class="hljs-string">"   "</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[lindex $argv <span class="hljs-number"><span class="hljs-number">2</span></span>] == <span class="hljs-string"><span class="hljs-string">"-port"</span></span>} { set port_name [lindex $argv <span class="hljs-number"><span class="hljs-number">3</span></span>] PortDataRead $port_name } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[lindex $argv <span class="hljs-number"><span class="hljs-number">2</span></span>] == <span class="hljs-string"><span class="hljs-string">"-file"</span></span>} { set log_file_name [lindex $argv <span class="hljs-number"><span class="hljs-number">3</span></span>] set <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> [open $log_file_name <span class="hljs-string"><span class="hljs-string">"r"</span></span>] #          <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> isdirectory $out_dir] == <span class="hljs-number"><span class="hljs-number">0</span></span>} { <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> mkdir $out_dir } #    <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> {[gets $log line] &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>} { ParceString $line } close $log } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { puts <span class="hljs-string"><span class="hljs-string">"\n :\n-   \ \n # -conf config.tcl \n # tclsh logger.tcl -conf config.tcl -file TDA20013082015_12052016.lg\ \n-      com- \ \n # tclsh logger.tcl -conf config.tcl -port /dev/ttyUSB0\n"</span></span> exit }</code> </pre> <br>  Go ahead.  Serial port functions: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">port_data_read</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(port_name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> out_dir <span class="hljs-string"><span class="hljs-string">"""    """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> serial ser = serial.Serial(port_name) ser.baudrate = <span class="hljs-number"><span class="hljs-number">9600</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-comment"><span class="hljs-comment">#     line = ser.readline() #      line = line.decode() #     line = line.rstrip() #     parce_string(line)</span></span></code> </pre> <br>  In tcl, operations with files or ports are used the same.  Those.  first, a so-called pipe is created by the <i>open</i> command, and then the data is read from this ‚Äúpipe‚Äù or written there, be it a file or a serial port. <br><br><pre> <code class="hljs mel">#     <span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> PortDataRead {portName} { <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> fh #     <span class="hljs-string"><span class="hljs-string">" "</span></span> set fh [open $portName RDONLY] #          fconfigure $fh -blocking <span class="hljs-number"><span class="hljs-number">0</span></span> -buffering line -mode <span class="hljs-number"><span class="hljs-number">9600</span></span>,n,<span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span> -translation crlf -eofchar {} # <span class="hljs-string"><span class="hljs-string">""</span></span>  fileevent $fh readable Read vwait forever } #         <span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> Read {} { <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> fh <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[gets $fh line] &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>} { ParceString $line } }</code> </pre> <br>  Team <br><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">fileevent</span></span> <span class="hljs-variable"><span class="hljs-variable">$fh</span></span> readable Read</code> </pre> <br>  allows you to hang on the channel event, or rather the reaction to the event, in this case, we indicated that when any data appears in the channel, perform the <i>Read</i> procedure. <br><br>  That came to the key point - parsing the line.  The PBX "throws out" the data in the form of a line where the fields are separated by spaces, more precisely, for each field the size is specified in characters and the missing data is achieved with spaces: <br><br><pre> <code class="hljs scala"><span class="hljs-number"><span class="hljs-number">30</span></span>/<span class="hljs-number"><span class="hljs-number">09</span></span>/<span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-number"><span class="hljs-number">44</span></span> <span class="hljs-number"><span class="hljs-number">501</span></span> <span class="hljs-number"><span class="hljs-number">01</span></span> &lt;<span class="hljs-type"><span class="hljs-type">I</span></span>&gt; <span class="hljs-number"><span class="hljs-number">0</span></span><span class="hljs-symbol"><span class="hljs-symbol">'00</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span><span class="hljs-symbol"><span class="hljs-symbol">'13</span></span> <span class="hljs-type"><span class="hljs-type">D0</span></span></code> </pre> <br>  Python function code: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parce_string</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(line)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""             """</span></span> <span class="hljs-comment"><span class="hljs-comment">#       if line[:3] == "---" or line == "" or line[3:7] == "Date": print(line) return print(line) #      ,    now = datetime.datetime.now() out_log_name = os.path.join(out_dir, '{}_{}'.format(now.month, now.year)) out_log = open(out_log_name,"a+") out_log.write(line + '\n') out_log.close() #   #     "//" (        ) call_date = "20{}/{}/{}".format(line[6:8],line[3:5],line[:2]) #       call_time = line[9:14].strip() int_number = line[19:22].strip() ext_co_line = line[23:25].strip() dial_number = line[26:51].strip() ring = line[52:56].strip() call_duration = re.sub("'", ":", line[57:65].strip()) acc_code = line[66:77].strip() call_code = line[77:81].strip() #     if dial_number == "&lt;I&gt;": call_direct = "" dial_number = "" elif dial_number[:3] == "EXT": call_direct = "" dial_number = dial_number[3:] else: call_direct = "" #       insert(call_date=call_date, call_time=call_time, int_number=int_number, ext_co_line=ext_co_line, dial_number=dial_number, ring=ring, call_duration=call_duration, acc_code=acc_code, call_code=call_code, call_direct=call_direct)</span></span></code> </pre> <br>  In the string functions between pit and tickle there are some differences, for example <i>line [9:14]</i> returns the contents of the string starting from 9 to 13 characters inclusive, i.e.  as the right border is indicated next to the significant symbol.  In tcl, for this purpose, the command <i>[string range $ line 9 13] is used</i> . <br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> ParceString {line} { <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> out_dir arrVariables #               <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> range $line <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>] == <span class="hljs-string"><span class="hljs-string">"---"</span></span> || $line == <span class="hljs-string"><span class="hljs-string">""</span></span> || [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> range $line <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>] == <span class="hljs-string"><span class="hljs-string">"Date"</span></span>} { #puts $line <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> } #      ,    #     _     clock set fName [clock <span class="hljs-keyword"><span class="hljs-keyword">format</span></span> [clock scan <span class="hljs-string"><span class="hljs-string">"now"</span></span> -base [clock seconds]] -<span class="hljs-keyword"><span class="hljs-keyword">format</span></span> %m_%Y] set out_log_name [<span class="hljs-keyword"><span class="hljs-keyword">file</span></span> join $out_dir $fName] set out_log [open $out_log_name <span class="hljs-string"><span class="hljs-string">"a+"</span></span>] puts $out_log <span class="hljs-string"><span class="hljs-string">"$line"</span></span> close $out_log #   #        #     <span class="hljs-string"><span class="hljs-string">"//"</span></span> set arrVariables(call_date) <span class="hljs-string"><span class="hljs-string">"20[string range $line 6 7]\/[string range $line 3 4]\/[string range $line 0 1]"</span></span> set arrVariables(call_time) [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> range $line <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>] set arrVariables(int_number) [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> range $line <span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>] set arrVariables(ext_co_line) [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> range $line <span class="hljs-number"><span class="hljs-number">23</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span>] set arrVariables(dial_number) [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> range $line <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span>] set arrVariables(ring) [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> range $line <span class="hljs-number"><span class="hljs-number">52</span></span> <span class="hljs-number"><span class="hljs-number">55</span></span>] set arrVariables(call_duration) [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> range $line <span class="hljs-number"><span class="hljs-number">57</span></span> <span class="hljs-number"><span class="hljs-number">66</span></span>] set arrVariables(acc_code) [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> range $line <span class="hljs-number"><span class="hljs-number">66</span></span> <span class="hljs-number"><span class="hljs-number">76</span></span>] set arrVariables(call_code) [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> range $line <span class="hljs-number"><span class="hljs-number">77</span></span> <span class="hljs-number"><span class="hljs-number">81</span></span>] #     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> {$arrVariables(dial_number) == <span class="hljs-string"><span class="hljs-string">"&lt;I&gt;"</span></span>} { set arrVariables(call_direct) <span class="hljs-string"><span class="hljs-string">"In"</span></span> set arrVariables(dial_number) <span class="hljs-string"><span class="hljs-string">""</span></span> } elseif {[<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> range $arrVariables(dial_number) <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>] == <span class="hljs-string"><span class="hljs-string">"EXT"</span></span>} { set arrVariables(call_direct) <span class="hljs-string"><span class="hljs-string">"Ext"</span></span> set arrVariables(dial_number) [<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> range $arrVariables(dial_number) <span class="hljs-number"><span class="hljs-number">3</span></span> end] } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { set arrVariables(call_direct) <span class="hljs-string"><span class="hljs-string">"Out"</span></span> } InsertData</code> </pre> <br>  There is such a great thing in a <i>ticker</i> as an array of variables, in this case, it is <i>arrVariables ()</i> , in which all data is stored in corresponding variables defined by the key, for example, <i>arrVariables (call_time)</i> is the time of the call.  It was possible to save all this in the form of a list of lists of "key - value", using the example of the previous variable, it would look as follows: <br><br><pre> <code class="hljs vhdl">lappend lstVar [list call_time [<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">range</span></span> $<span class="hljs-literal"><span class="hljs-literal">line</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>]]</code> </pre>  those.  In the <i>lstVar</i> list (more precisely, the variable containing the list), we add a list of two <i>call_time</i> values ‚Äã‚Äãand the contents of the <i>$ line</i> between 9 and 13 characters inclusive. <br><br>  And now we add a line to the database, the structure of which is described below: <br><br><div class="spoiler">  <b class="spoiler_title">Table structure</b> <div class="spoiler_text"> <code>CREATE TABLE `cdr` ( <br> `id` int(11) NOT NULL AUTO_INCREMENT, <br> `call_date` date DEFAULT NULL, <br> `call_time` time DEFAULT NULL, <br> `int_number` varchar(11) DEFAULT NULL, <br> `ext_co_line` char(2) DEFAULT NULL, <br> `dial_number` varchar(30) DEFAULT NULL, <br> `ring` varchar(5) DEFAULT NULL, <br> `call_duration` time DEFAULT NULL, <br> `acc_code` varchar(20) DEFAULT NULL, <br> `call_code` char(2) DEFAULT NULL, <br> `call_direct` varchar(45) DEFAULT NULL, <br> PRIMARY KEY (`id`) <br> ) ENGINE=InnoDB AUTO_INCREMENT=2775655 DEFAULT CHARSET=utf8 COMMENT='Call Data Records';</code> </div> </div><br>  The query to the database is built dynamically based on the parameters passed to the function.  From the code, in principle, everything is clear - we format the strings in accordance with the requirements of the SQL query, in the right places we insert commas or brackets, etc.  And since the request is built dynamically, in some places an extra comma and a space are added that have to be removed with the <i>rstrip (',')</i> command (you can, of course, count the number of fields and add the necessary number of commas, but this does not reduce the overhead and therefore So).  Since the data is not often generated, one transaction is performed for each data row (one request), i.e.  connected, executed the request, disconnected. <br>  And the function code itself: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">insert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(**kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   .       """</span></span> qwery = <span class="hljs-string"><span class="hljs-string">'INSERT INTO `cdr` ('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> kwargs.keys(): qwery = <span class="hljs-string"><span class="hljs-string">"{} `{}`, "</span></span>.format(qwery,key) qwery = qwery.rstrip(<span class="hljs-string"><span class="hljs-string">', '</span></span>) + <span class="hljs-string"><span class="hljs-string">') VALUES('</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> kwargs.keys(): <span class="hljs-comment"><span class="hljs-comment">#qwery = qwery + '"' + kwargs.get(key) +'", ' qwery = "{} \"{}\",".format(qwery,kwargs.get(key))</span></span></code> </pre> <br>  And now the same thing on the tickle: <br><br><pre> <code class="hljs kotlin">proc InsertData {} { global arrVariables db <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> qwery <span class="hljs-string"><span class="hljs-string">"INSERT INTO `cdr` ("</span></span> #          foreach key [array names arrVariables] { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> qwery <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$qwery</span></span></span><span class="hljs-string"> `</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$key</span></span></span><span class="hljs-string">`, "</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> qwery <span class="hljs-string"><span class="hljs-string">"[string trimright </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$qwery</span></span></span><span class="hljs-string"> "</span></span>, <span class="hljs-string"><span class="hljs-string">"]\) VALUES\("</span></span> foreach key [array names arrVariables] { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> qwery <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$qwery</span></span></span><span class="hljs-string"> \"[string trim </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$arrVariables</span></span></span><span class="hljs-string">(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$key</span></span></span><span class="hljs-string">)]\","</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> qwery <span class="hljs-string"><span class="hljs-string">"[string trimright </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$qwery</span></span></span><span class="hljs-string"> "</span></span>, <span class="hljs-string"><span class="hljs-string">"]\);"</span></span> puts $qwery #        <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> conn [mysql::connect -host $db(host) -db $db(dbname) -user $db(user) -password $db(pass) -encoding utf-<span class="hljs-number"><span class="hljs-number">8</span></span>] mysql::exec $conn $qwery mysql::commit $conn mysql::close $conn }</code> </pre> <br>  Here you can complete the story.  In my opinion, there is no advantage, in this particular case, neither of them has a different language (I cunning a little, for me the tickle is more beautiful, but this is by virtue of habit).  Difficulties with python also does not arise.  Sources were tested in Centos and Fedore latest versions and Windows 10. Project Designer (in terms of data collection) is brought to a logical conclusion and put into operation, there is still a simple web snout with a phone directory and reports on the collected data, but this is a topic for another article. <br><br>  Sources are available here: <a href="https://bitbucket.org/svk28/panasonic-log-reader">Git repository</a> </div><p>Source: <a href="https://habr.com/ru/post/335842/">https://habr.com/ru/post/335842/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335830/index.html">On the quality of requirements in IT projects, to be honest (from the standpoint of the development team). Part 1</a></li>
<li><a href="../335834/index.html">DDD in practice. Design a wish list</a></li>
<li><a href="../335836/index.html">How to write normal texts in English, not being a native speaker</a></li>
<li><a href="../335838/index.html">Overview of C ++ deep learning libraries Apache.SINGA, tiny-dnn, OpenNN</a></li>
<li><a href="../335840/index.html">Random RPG damage distribution</a></li>
<li><a href="../335844/index.html">Automate workflow with the new platform. Part 1. Office. Work with "Incoming Documents"</a></li>
<li><a href="../335846/index.html">Logs as part of the product. How GrayLog Impacted Quality</a></li>
<li><a href="../335848/index.html">MIPSfpga - practical experience</a></li>
<li><a href="../335850/index.html">Taxes on IT-business in Russia</a></li>
<li><a href="../335852/index.html">‚ÄúJava-developers do not realize the problem with profilers‚Äù: Andrey Pangin and Nitsan Vakart about Java profiling</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>