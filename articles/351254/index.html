<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using environment variables in Node.js</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The material about environment variables in Node.js, the translation of which we are publishing today, was written by Berk Holland , a web developer w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using environment variables in Node.js</h1><div class="post__text post__text-html js-mediator-article">  The material about environment variables in Node.js, the translation of which we are publishing today, was written by <a href="https://developer.microsoft.com/ru-ru/advocates/burke-holland">Berk Holland</a> , a web developer whose interests include JavaScript, Node.js, and VS Code.  In addition, it is worth noting that he had a difficult relationship with Java.  Here is his story. <br><br>  Environment variables are one of the fundamental constructs of the Node.js environment, but for some reason I never tried to learn how to use them correctly.  Perhaps it happened because of their name - "Environment Variables".  This title gave me something of a post-traumatic syndrome, unpleasant memories of how I tried to add the path to the Java home directory in Windows.  Then I really could not understand whether it is necessary to add this path to the PATH variable, to the JAVA_HOME variable, or both there and there.  It was also unclear whether it was necessary to have a semicolon at the end of this path.  As a matter of fact, then I had a question about why I use Java.  Whatever it was, I finally found the strength in myself and began to get acquainted with the environment variables Node. <br><br> <a href="https://habrahabr.ru/company/ruvds/blog/351254/"><img src="https://habrastorage.org/webt/kb/zj/zi/kbzjzidvxbihcnkyndh0ncdke1i.jpeg"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you are writing for the Node.js platform, and, just like me, it does not matter - for what reasons, you are still not particularly familiar with environment variables - I suggest fixing this. <br><a name="habracut"></a><br><h2>  <font color="#3AC1EF">Environment Variables in Node.js</font> </h2><br>  In Node, environment variables can be global (as in Windows), but they are often used to apply to a particular process in which the developer is interested.  For example, if you have a web application, this means that the following environment variables can be used in it: <br><br><ul><li>  The HTTP port that this application will listen on. </li><li>  The string to connect to the database. </li><li>  The path to JAVA_HOME, oh ‚Äã‚Äãwait, this is past.  Please note that recovery takes time. </li></ul><br>  In this context, environment variables are in fact more like ‚ÄúConfiguration Settings‚Äù - for me, it sounds much better than the ‚ÄúEnvironment Variables‚Äù. <br><br>  If you previously programmed for .NET, you may be familiar with something like a <code>web.config</code> .  The Node environment variables play almost the same role as the settings from the <code>web.config</code> - they are a mechanism for passing information to the application that the developer does not want to set hard in the code. <br><br>  By the way, on the topic ‚Äúhard code‚Äù - tasks in the code of certain values ‚Äã‚Äãinstead of receiving them from external sources, I want to share my own tweet. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/32c/c37/6c0/32cc376c09722db764cf1efa283539f2.png"></div><br>  <i><font color="#999999">I quote myself at the height of insanity</font></i> <br><br>  How to use environment variables in Node.js applications?  I had to work pretty hard to find good material on environment variables in Node, with the indispensable condition that there is enough jokes about Java in this material.  I did not find such material, so I decided to write it myself. <br><br>  Here are some ways to use environment variables in Node.js applications. <br><br><h2>  <font color="#3AC1EF">Specifying environment variables in the terminal</font> </h2><br>  You can specify environment variables in the terminal where you plan to launch Node.  For example, if you have an application that uses Express, and you want to send port information to it, you can do it like this: <br><br><pre> <code class="hljs vhdl"><span class="hljs-keyword"><span class="hljs-keyword">PORT</span></span>=<span class="hljs-number"><span class="hljs-number">65534</span></span> node bin/www</code> </pre> <br>  By the way, an interesting thing.  It turns out that the largest number that a port number can take is 65535. How did I find out?  Of course, I found it on <a href="https://stackoverflow.com/questions/113224/what-is-the-largest-tcp-ip-network-port-number-allowable-for-ipv4">StackOverflow</a> .  How does anyone know anything?  But in Node, the largest port number is 65534. Why?  I have no idea.  I can't know absolutely everything. <br><br>  So, to use the environment variable in the code, you need to use the <code>process.env</code> object.  It looks like this: <br><br><pre> <code class="hljs vhdl">var <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">process</span></span>.env.<span class="hljs-keyword"><span class="hljs-keyword">PORT</span></span>;</code> </pre> <br>  However, the use of the approach described here can end badly.  If you have, for example, a database connection string, you probably will not be particularly pleased with the prospects for its entry into the terminal.  In fact, entering long values ‚Äã‚Äãin the terminal looks like a painful dependency, which is completely useless to us.  See for yourself: <br><br><pre> <code class="hljs perl">PORT=<span class="hljs-number"><span class="hljs-number">65534</span></span> DB_CONN=<span class="hljs-string"><span class="hljs-string">"mongodb://react-cosmos-db:swQOhAsVjfHx3Q9VXh29T9U8xQNVGQ78lEQaL6yMNq3rOSA1WhUXHTOcmDf38Q8rg14NHtQLcUuMA==@react-cosmos-db.documents.azure.com:19373/?ssl=true&amp;replicaSet=globaldb"</span></span> SECRET_KEY=b6264fca-<span class="hljs-number"><span class="hljs-number">8</span></span>adf-<span class="hljs-number"><span class="hljs-number">457</span></span>f-a94f-<span class="hljs-number"><span class="hljs-number">5</span></span>a4b0d1ca2b9  node bin/www</code> </pre> <br>  This approach does not scale, but everyone wants to scale.  According to each architect, next to whom I used to sit at different events, ‚Äúscaling‚Äù is even more important than the fact that the application is working. <br><br>  Therefore, we consider another approach, which is to use <code>.env</code> files. <br><br><h2>  <font color="#3AC1EF">Using .env files</font> </h2><br>  The <code>.env</code> files are for storing environment variables.  To use this technology, it is enough to create a file in the project with the name <code>.env</code> and enter into it the environment variables, starting each with a new line: <br><br><pre> <code class="hljs perl">PORT=<span class="hljs-number"><span class="hljs-number">65534</span></span> DB_CONN=<span class="hljs-string"><span class="hljs-string">"mongodb://react-cosmos-db:swQOhAsVjfHx3Q9VXh29T9U8xQNVGQ78lEQaL6yMNq3rOSA1WhUXHTOcmDf38Q8rg14NHtQLcUuMA==@react-cosmos-db.documents.azure.com:10255/?ssl=true&amp;replicaSet=globaldb"</span></span> SECRET_KEY=<span class="hljs-string"><span class="hljs-string">"b6264fca-8adf-457f-a94f-5a4b0d1ca2b9"</span></span></code> </pre> <br>  You can read these values ‚Äã‚Äãin different ways.  Perhaps the easiest way is to use the <code>npm</code> <code>dotenv</code> <code>npm</code> : <br><br><pre> <code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> dotenv <span class="hljs-comment"><span class="hljs-comment">--save</span></span></code> </pre> <br>  After installing the package, you need to connect it to the project, and then you can use it to work with environment variables.  This package will find the <code>.env</code> file and load the variables described in it into the Node.  Here's what it looks like: <br><br><pre> <code class="hljs lua">//  dotenv      .env  Node <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'dotenv'</span></span>).<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>(); var MongoClient = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mongodb'</span></span>).MongoClient; //     .env,     process.env MongoClient.connect(process.env.DB_CONN, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(err, db)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!err) {   console.<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>(<span class="hljs-string"><span class="hljs-string">"We are connected"</span></span>); } });</code> </pre> <br>  By the way, I want to share important advice.  Do not upload <code>.env</code> files to GitHub.  It contains information that is not intended for prying eyes.  Do not repeat my mistakes. <br><br>  So, everything is fine so far, but what we have said here is not very convenient.  You <code>dotenv</code> to connect <code>dotenv</code> in every file where you need to use environment variables, and <code>dotenv</code> will <code>dotenv</code> to be used in production when, in essence, you don‚Äôt need it.  I do not belong to fans of deploying useless code in production, although, it seems to me, so far I have been doing just that. <br><br>  What to do?  Fortunately, you are using <a href="https://code.visualstudio.com/%3Fwt.mc_id%3Ddotenv-medium-buhollan">VS Code</a> (I am absolutely sure of this), which means that you have a few more options. <br><br><h2>  <font color="#3AC1EF">Working with .env files in VS Code</font> </h2><br>  For starters, you can install the VS Code <a href="https://marketplace.visualstudio.com/items%3FitemName%3Dmikestead.dotenv%26wt.mc_id%3Ddotenv-medium-buhollan">DotENV</a> extension, which will give a nice syntax highlighting for <code>.env</code> files. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/465/9e7/f07/4659e7f07f90cc8b6311189e98973bfd.png"></div><br>  <i><font color="#999999">This is what an .env file looks like without syntax highlighting and with highlighting.</font></i> <br><br>  In addition, the VS Code debugger, if you use it, offers some more convenient options for loading values ‚Äã‚Äãfrom <code>.env</code> files. <br><br><h2>  <font color="#3AC1EF">VS Code Startup Configuration</font> </h2><br>  The Node.js debugger for VS Code (it is installed by default) supports loading of <code>.env</code> files through launch configurations.  Details on launch configurations can be found <a href="https://code.visualstudio.com/docs/nodejs/nodejs-debugging%3FWT.mc_id%3Ddotenv-medium-buhollan">here</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c29/fb8/645/c29fb8645095c095d8891fc77b469379.gif"></div><br>  <i><font color="#999999">Creating a basic launch configuration for Node</font></i> <br><br>  After you create the basic startup configuration for Node (click the gear icon and select Node), you can do one of the following, or do both. <br><br>  The first option is to include variables in the configuration file. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/330/6e3/7b5/3306e37b5954503752c62c6121b5cab8.png"></div><br>  <i><font color="#999999">Variables in the configuration file</font></i> <br><br>  This is an acceptable option, but I am a little worried that each value should be a string.  Still, some values ‚Äã‚Äãare numbers, not strings, and in JavaScript there are only, let's say, three main data types, and I would not want to lose one of them. <br><br>  Passing environment variables to VS Code is possible in a simpler way.  We have already found out that the <code>.env</code> files are our friends, so instead of <code>.env</code> values ‚Äã‚Äãof variables in the configuration file, we simply specify the path to the <code>.env</code> file <code>.env</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9ce/154/042/9ce154042e50917f5296fb657e6fef2b.png"></div><br>  <i><font color="#999999">Path to the .env file in the configuration file</font></i> <br><br>  As long as we start the Node.js process from VS Code, the file with environment variables will be transferred to this process.  At the same time, we will not have to squeeze numbers into quotes, making them strings, and we will not have to deploy unnecessary code in production.  Well, at least you won't have to do this. <br><br><h2>  <font color="#3AC1EF">Running node scripts via NPM</font> </h2><br>  Perhaps you have reached this place and thought that you never start Node projects with commands like <code>node ‚Ä¶</code> , always using npm scripts like <code>npm start</code> .  VS Code launch configurations can also be used in this case.  However, instead of using the standard launch Node, you can configure the Launch Via NPM task. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eee/5f3/786/eee5f37863e8fbcfab9be182d7f9655f.gif"></div><br>  <i><font color="#999999">Task Launch Via NPM</font></i> <br><br>  After that, you can customize the value of the <code>envFile</code> parameter by specifying the path to the <code>.env</code> file, and the <code>runtimeArgs</code> parameter to run the desired script.  Usually, the script is <code>start</code> or <code>debug</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/20a/c3a/435/20ac3a435c96ae1367fe22fffe7b56c7.png"></div><br>  <i><font color="#999999">Setting up a project run using npm</font></i> <br><br>  Note that in <code>package.json</code> you need to add the <code>--inspect</code> flag to the npm script so that VS Code can connect a debugger to the process.  Otherwise, although the task will start, the debugger cannot do anything useful. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d0c/60e/39f/d0c60e39ff7027e8e995b7012b2ec6ba.gif"></div><br>  <i><font color="#999999">--Inspect flag in package.json</font></i> <br><br><h2>  <font color="#3AC1EF">Production variables</font> </h2><br>  So, we figured out how to use environment variables during development.  You, most likely, will not use the <code>.env</code> files in production, and the VS Code launch configuration on the server will not bring any special benefit. <br><br>  In production, the definition of environment variables will depend on the particular platform used.  For example, in the case of Azure, there are three ways to declare and manage such variables. <br><br>  The first way is to use the <a href="https://docs.microsoft.com/en-us/cli/azure/webapp/config/appsettings%3Fview%3Dazure-cli-latest%26wt.mc_id%3Ddotenv-medium-buhollan">Azure CLI</a> . <br><br><pre> <code class="hljs pgsql">az webapp config appsettings <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> -g MyResourceGroup -n MyApp <span class="hljs-comment"><span class="hljs-comment">--settings PORT=65534</span></span></code> </pre> <br>  It works, but it doesn't look very good.  Another way is to use the Azure web portal.  I don‚Äôt often use the web portal, but when it happens, I refer to it to set environment variables. <br><br>  Here, what we call ‚Äúenvironment variables‚Äù is called ‚ÄúApplication Settings‚Äù. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/757/c89/e26/757c89e26e8349e4924b5c2e2cf9fb06.png"></div><br>  <i><font color="#999999">Setting Environment Variables in Azure</font></i> <br><br>  Another option, given that you are using VS Code, is to install the App Service extension and configure the above-described Application Settings directly from the editor. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/369/ef4/ead/369ef4ead2d3ba7782ee958f1fab6c80.gif"></div><br>  <i><font color="#999999">Setting Environment Variables from VS Code</font></i> <br><br>  I like to do absolutely everything in VS Code, and if I could write e-mails there, I would do that.  <a href="https://marketplace.visualstudio.com/items%3FitemName%3Dccccly.markdown-mail%26WT.mc_id%3Ddotenv-medium-buhollan">By the way</a> , it seems my dream has come true. <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  Now you know the same thing that I know (not so much, I will allow to notice), and I feel that I have fulfilled my goal on jokes on the subject of Java.  If suddenly they are not enough here - here is another one whose author is unknown: "Java is a very powerful tool for turning XML into stack-traces." <br><br>  Hopefully, this material made it possible for those who had not used them to fill in the gaps in knowledge about environment variables in Node, and for those who already knew about them, they allowed to learn something new about .env files, about using environment variables on combat servers , and how to make your life easier by developing Node-projects in VS Code.  If the topic of environment variables Node is interesting to you - <a href="https://habrahabr.ru/company/ruvds/blog/345724/">here is</a> one of our previous publications on this topic, dedicated to the features of working with process.env. <br><br>  <b>Dear readers!</b>  How do you solve the problems of using environment variables in the development and production of Node? <br><br><div style="text-align:center;"> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> </div></div><p>Source: <a href="https://habr.com/ru/post/351254/">https://habr.com/ru/post/351254/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351244/index.html">Mobile 3D game on Unity3D in less than 90 hours</a></li>
<li><a href="../351246/index.html">Image Optimization for the web</a></li>
<li><a href="../351248/index.html">Trends of retail at the international exhibition EuroCIS 2018</a></li>
<li><a href="../351250/index.html">Introduction to Postman</a></li>
<li><a href="../351252/index.html">Let's Encrypt began issuing wildcard certificates</a></li>
<li><a href="../351256/index.html">How JS Works: Tracking DOM Changes with MutationObserver</a></li>
<li><a href="../351258/index.html">Fintech-digest. African heat, identification methods and cryptocrolics</a></li>
<li><a href="../351260/index.html">Building a network for storage systems, SMB sector: Part 1. Selection of network equipment</a></li>
<li><a href="../351262/index.html">Malicious software to steal bitcoins spread through Download.com</a></li>
<li><a href="../351264/index.html">How to get to the investor: a short way through retail</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>