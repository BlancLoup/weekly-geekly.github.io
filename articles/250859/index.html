<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VPN everywhere: IPsec without L2TP with strongSwan</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="strong enough swan 

 If you have ever looked for a VPN that will work on desktops, mobile devices and routers without installing additional software ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VPN everywhere: IPsec without L2TP with strongSwan</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/d3d/aaf/6f8/d3daaf6f8aff40b1681f868b619d020c.jpg" alt="image"><br>  <i>strong enough swan</i> <br><br>  If you have ever looked for a VPN that will work on desktops, mobile devices and routers without installing additional software and flashing the router, you probably chose between PPTP and L2TP + IPsec.  PPTP has problems with security and passing through firewalls and NAT, so in 2015 it is not worth using, and using L2TP is unnecessary, because  L2 VPN, in my opinion, is almost never needed for normal remote access. <br><br>  It's amazing that it's not so easy to find information on the Internet to configure something other than L2TP + IPsec in transport mode, given that this is an extensive stack of protocols that can be configured literally as you please, so I will try to eliminate such imperfection of the world. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  A little introduction to the world of IPsec </h3>  Generally speaking, it is not entirely correct to call IPsec VPN.  IPsec is not designed to build "virtual private networks", but was created to encrypt or protect against the substitution of data transmitted over IP.  This is a special layer on top of IP, which, depending on the mode and settings, works differently.  Unlike the usual VPN, which creates a new interface in the system to which you, as it most often happens, assign an IP subnet from a range of private addresses (that is, create a new network segment) and through which traffic is encrypted in the encrypted form IPsec simply encrypts traffic magically between the ‚Äúexternal‚Äù server and client interfaces. <a name="habracut"></a><br><br>  Modern IPsec uses: <br><ul><li>  <b>Authentication Header (AH)</b> is a protocol that provides sender authentication and data integrity.  Signs not only the packet data, but also all headers, except for changeable fields (ToS, TTL, cheksumma). </li><li>  <b>Encapsulating Security Payload (ESP)</b> - protocol that provides authentication, integrity, and confidentiality </li><li>  <b>Security Association (SA)</b> - parameter with channel encryption settings </li><li>  <b>Internet Key Exchange (IKE and IKEv2)</b> - protocol for the exchange of parameters, settings and negotiation SA </li></ul><br>  AH and ESP are transport protocols encapsulated directly into IP, having their own values ‚Äã‚Äãfor the Protocol field in the IP header.  In today's world, where NAT is behind NAT in NAT with NAT, something more familiar should be used, so encapsulation of ESP packets in UDP is now widely used.  AH does not support work through NAT. <br><br>  IPsec itself supports two modes of operation: <br><ul><li>  <b>Transport mode</b>  Signs headers and data (if AH) or signs and encrypts data (if ESP) of the packet.  Do not hide the recipient IP address of the packet if it is routed.  This mode is used for the L2TP + IPsec bundle. </li><li>  <b>Tunnel mode</b>  Signs (if AH) and still encrypts (if ESP) the <b>entire packet</b> . </li></ul><br>  IKE allows client authentication using X.509 certificates, Pre-Shared Key and Extensible Authentication Protocol (EAP).  Two-step authentication is supported. <br><br>  All modern desktop operating systems (Windows Vista / 7/8 / 8.1, OS X, Linux), mobile devices (Android, iOS, Windows Phone, Blackberry) and some routers support VPN using IPsec ESP in tunnel mode and its configuration via the Internet protocol Key Exchange (IKE) version 1 or 2, which means that we will configure IPsec in this way. <br><br>  By the way, write IPsec correctly, but Cisco IP <b>S</b> ec. <br><br><h3>  Linux IPsec </h3>  IPsec itself (AH / ESP, SA) runs in the kernel, so we need an IKE daemon to transfer settings to connecting clients.  There are quite a few of them, but there are only two full-fledged and active ones at the moment: <a href="http://strongswan.org/">strongSwan</a> and <a href="https://libreswan.org/">libreswan</a> .  I didn‚Äôt use the second one, I can‚Äôt say anything about it, but the first one is wonderful and amazing, besides, it is the only demon that has its own userspace-implementation of IPsec, so it can be used in OpenVZ containers with the old dinosaur core 2.6.32 with broken support for IPsec routing. <div class="spoiler">  <b class="spoiler_title">A bit about IPsec in OpenVZ</b> <div class="spoiler_text">  OpenVZ has IPsec support, and it is quite suitable for running L2TP + IPsec, but there is clearly something wrong with routing to non-local interfaces.  This can probably be fixed by adding a couple of rules to the host machine, but this is quite problematic if you do not have access to it, as happens in the vast majority of cases.  Therefore, for OpenVZ, you need to use userspace IPsec, which can be built with the --enable-kernel-libipsec parameter <br><br>  Bug mentions: <br>  <a href="https://lists.strongswan.org/pipermail/users/2014-February/005822.html">lists.strongswan.org/pipermail/users/2014-February/005822.html</a> <br>  <a href="https://bugzilla.redhat.com/show_bug.cgi%3Fid%3D1081804">bugzilla.redhat.com/show_bug.cgi?id=1081804</a> <br>  <a href="http://forum.openvz.org/index.php%3Ft%3Dtree%26goto%3D39937">forum.openvz.org/index.php?t=tree&amp;goto=39937</a> <br>  <a href="http://lowendtalk.com/discussion/33226/need-someone-to-test-ipsec-on-their-boxes">lowendtalk.com/discussion/33226/need-someone-to-test-ipsec-on-their-boxes</a> </div></div><br>  We will need strongSwan version minimum 5.0.0.  I recommend using version not lower than 5.2.0, since  It is in this version that the ‚Äúswanctl‚Äù utility appeared, which is much more convenient than the old ‚Äúipsec‚Äù.  The utility will be required, by and large, only to display some information or statistics, it is not necessary for configuration and only ipsec can be dispensed with, but only it will be used in the article. <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  Life with swanctl: <br><img src="https://habrastorage.org/getpro/habr/post_images/7bf/d3b/492/7bfd3b4926f8fb6e198b08cfebc3a62a.jpg" alt="image"><br><br>  Life without swanctl: <br><img src="https://habrastorage.org/getpro/habr/post_images/f5a/243/106/f5a24310658c268e0334b80d68957503.jpg" alt="image"></div></div><br>  We may need some modules that may not be in the standard package: <br><ul><li>  <b>xauth-noauth</b> - fake authenticator, allows you to enter any username and password.  Needed for iPhone and iPad with key authentication only, since  there is no possibility to disable authentication by login and password. </li><li>  <b>vici</b> - interface for swanctl. </li><li>  <b>libipsec</b> - for userspace IPsec (for OpenVZ and, possibly, other containers). </li></ul><br>  If you are not confused by the need to enter a username and password on the iPhone, you do not need swanctl and you are not going to run it all in an OpenVZ container, then you do not need to recompile anything. <br>  Unfortunately, the strongSwan maintainers in Debian have not packed any of this (as of February 2015), so I made a <a href="http://lists.alioth.debian.org/pipermail/pkg-swan-devel/Week-of-Mon-20141110/000439.html">patch</a> that you can use. <br><br><h3>  Go to setting </h3>  We will configure the connection via IKEv2 (Windows, Linux, Blackberry), IKEv1 + XAUTH (iOS, OS X, Android) and IKEv2 + EAP-TLS (Windows Phone).  Use keys, no PSK! <br>  The developers of strongSwan suggest that we use the ‚Äúipsec pki‚Äù command to generate keys, but it is just as inconvenient as the usual openssl, so I adapted Easy-RSA v3 from OpenVPN to generate both OpenVPN and IPsec-compatible keys.  With it, you can use one keychain for two protocols! <br>  <a href="https://github.com/ValdikSS/easy-rsa-ipsec">github.com/ValdikSS/easy-rsa-ipsec</a> <br>  Easy-RSA is extremely simple, it is a pleasure to maintain a PKI infrastructure with it! <br><br>  So, we initialize PKI and create CA, server and client keys.  <b>It is important that the name of the server key matches the FQDN (domain, in other words) of your server!</b> <br><pre><code class="hljs sql">$ git clone https://github.com/ValdikSS/easy-rsa-ipsec.git
$ cd easy-rsa-ipsec/easyrsa3
$ ./easyrsa init-pki

init-pki complete; you may now <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> a CA <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> requests.

$ ./easyrsa <span class="hljs-keyword"><span class="hljs-keyword">build</span></span>-ca nopass
Generating a <span class="hljs-number"><span class="hljs-number">2048</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bit</span></span> RSA <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>
‚Ä¶
Common <span class="hljs-keyword"><span class="hljs-keyword">Name</span></span> (eg: your <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>, host, <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>) [Easy-RSA CA]:IPsec CA
‚Ä¶

$ ./easyrsa <span class="hljs-keyword"><span class="hljs-keyword">build</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">full</span></span> uk1.pvpn.pw nopass
Generating a <span class="hljs-number"><span class="hljs-number">2048</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bit</span></span> RSA <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>
‚Ä¶
Write <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> entries
<span class="hljs-keyword"><span class="hljs-keyword">Data</span></span> Base <span class="hljs-keyword"><span class="hljs-keyword">Updated</span></span>

$ ./easyrsa <span class="hljs-keyword"><span class="hljs-keyword">build</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">client</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">full</span></span> client1 nopass    
Generating a <span class="hljs-number"><span class="hljs-number">2048</span></span> <span class="hljs-built_in"><span class="hljs-built_in">bit</span></span> RSA <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">key</span></span>
‚Ä¶
Write <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> entries
<span class="hljs-keyword"><span class="hljs-keyword">Data</span></span> Base <span class="hljs-keyword"><span class="hljs-keyword">Updated</span></span>

$ ./easyrsa <span class="hljs-keyword"><span class="hljs-keyword">export</span></span>-p12 client1 nopass
Successful <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> p12 file. Your exported <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">following</span></span>
location‚Ä¶</code></pre><br>
 .    <code>nopass</code>   ,       (      ).<br>
<br>
         <code>/etc/ipsec.d/</code>,  strongSwan  :<br>
<pre><code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># cp pki/ca.crt /etc/ipsec.d/cacerts/</span></span>
<span class="hljs-meta"><span class="hljs-meta"># cp pki/issued/uk1.pvpn.pw.crt /etc/ipsec.d/certs/</span></span>
<span class="hljs-meta"><span class="hljs-meta"># cp pki/private/uk1.pvpn.pw.key /etc/ipsec.d/private/</span></span></code></pre><br>
   strongSwan!<br>
 ,      <code>/etc/ipsec.secrets</code><pre><code class="hljs delphi"># This <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> holds shared secrets <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> RSA <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> keys <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> authentication.

# RSA <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> this host, authenticating it <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> any other host
# which knows the <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> part.

# this <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> managed <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> debconf <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> will contain the automatically created <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> key
include /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/lib/strongswan/ipsec.secrets.inc

: RSA uk1.pvpn.pw.key</code></pre><br>
   <code>/etc/ipsec.conf</code><br>
<pre><code class="hljs pgsql"># ipsec.conf - strongSwan IPsec <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span> file

# basic <span class="hljs-keyword"><span class="hljs-keyword">configuration</span></span>

config setup
	# strictcrlpolicy=yes
	# uniqueids = <span class="hljs-keyword"><span class="hljs-keyword">no</span></span>

<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> /var/lib/strongswan/ipsec.conf.inc

conn %<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>
	dpdaction=clear
	dpddelay=<span class="hljs-number"><span class="hljs-number">35</span></span>s
	dpdtimeout=<span class="hljs-number"><span class="hljs-number">300</span></span>s

	fragmentation=yes
	rekey=<span class="hljs-keyword"><span class="hljs-keyword">no</span></span>

	ike=aes256gcm16-aes256gcm12-aes128gcm16-aes128gcm12-sha256-sha1-modp2048-modp4096-modp1024,aes256-aes128-sha256-sha1-modp2048-modp4096-modp1024,<span class="hljs-number"><span class="hljs-number">3</span></span>des-sha1-modp1024!

	esp=aes128gcm12-aes128gcm16-aes256gcm12-aes256gcm16-modp2048-modp4096-modp1024,aes128-aes256-sha1-sha256-modp2048-modp4096-modp1024,aes128-sha1-modp2048,aes128-sha1-modp1024,<span class="hljs-number"><span class="hljs-number">3</span></span>des-sha1-modp1024,aes128-aes256-sha1-sha256,aes128-sha1,<span class="hljs-number"><span class="hljs-number">3</span></span>des-sha1!

	# left - <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>) side
	left=%<span class="hljs-keyword"><span class="hljs-keyword">any</span></span>
	leftauth=pubkey
	leftcert=uk1.pvpn.pw.crt
	leftsendcert=<span class="hljs-keyword"><span class="hljs-keyword">always</span></span>
	leftsubnet=<span class="hljs-number"><span class="hljs-number">0.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span>,::/<span class="hljs-number"><span class="hljs-number">0</span></span>

	# right - remote (client) side
	right=%<span class="hljs-keyword"><span class="hljs-keyword">any</span></span>
	rightauth=pubkey
	rightsourceip=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.103</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>/<span class="hljs-number"><span class="hljs-number">24</span></span>,<span class="hljs-number"><span class="hljs-number">2002</span></span>:<span class="hljs-number"><span class="hljs-number">25</span></span>f7:<span class="hljs-number"><span class="hljs-number">7489</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span>::/<span class="hljs-number"><span class="hljs-number">112</span></span>
	rightdns=<span class="hljs-number"><span class="hljs-number">8.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span><span class="hljs-number"><span class="hljs-number">.8</span></span>,<span class="hljs-number"><span class="hljs-number">2001</span></span>:<span class="hljs-number"><span class="hljs-number">4860</span></span>:<span class="hljs-number"><span class="hljs-number">4860</span></span>::<span class="hljs-number"><span class="hljs-number">8888</span></span>

conn ikev2-pubkey
	keyexchange=ikev2
	auto=<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>

conn ikev2-pubkey-osx
	<span class="hljs-keyword"><span class="hljs-keyword">also</span></span>="ikev2-pubkey"
	leftid=uk1.pvpn.pw

conn ikev1-fakexauth
	keyexchange=ikev1
	rightauth2=xauth-noauth
	auto=<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>

conn ikev2-eap-tls
	<span class="hljs-keyword"><span class="hljs-keyword">also</span></span>="ikev2-pubkey"
	rightauth=eap-tls
	eap_identity=%<span class="hljs-keyword"><span class="hljs-keyword">identity</span></span></code></pre><br>
 ,      .   <code>config setup</code>   : <code>strictcrlpolicy = yes</code>         ,  <code>uniqueids = no</code>        .<br>
     .    <code>%default</code>    ,      .    :<br>
<ul>
<li><code>dpdaction=clear</code>   Dead Peer Detection (DPD)  ,     ,      </li>
<li><code>dpddelay=35s</code> ‚Äî    DPD</li>
<li><code>dpdtimeout=300s</code> ‚Äî   DPD</li>
<li><code>fragmentation=yes</code> ‚Äî    .   IPsec  ,    IP-  (,  !)</li>
<li><code>rekey=no</code> ‚Äî       . Windows   .</li>
<li><code>ike</code> ‚Äî  ciphersuites    IKE (..         ,        SA)</li>
<li><code>esp</code> ‚Äî  ciphersuites   </li>
<li><code>left</code>  <code>right</code> ‚Äî       </li>
<li><code>leftid</code> ‚Äî   FQDN.    IKEv2  OS X El Capitan</li>
<li><code>leftauth/rightauth=pubkey</code> ‚Äî    </li>
<li><code>leftsubnet</code> ‚Äî ,       ( IPv4  IPv6-).  IPv6,    .</li>
<li><code>rightsourceip</code> ‚Äî  IP-,     .  IPv6,    .</li>
<li><code>rightdns</code> ‚Äî IP- DNS-</li>
</ul><br>
   ciphersuites  ike  esp.        ,     - ,         - , , .      <a href="https://ru.wikipedia.org/wiki/AEAD-%25D1%2580%25D0%25B5%25D0%25B6%25D0%25B8%25D0%25BC_%25D0%25B1%25D0%25BB%25D0%25BE%25D1%2587%25D0%25BD%25D0%25BE%25D0%25B3%25D0%25BE_%25D1%2588%25D0%25B8%25D1%2584%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F">AEAD-</a>, ..  ,       <a href="https://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BC%25D0%25B8%25D1%2582%25D0%25BE%25D0%25B2%25D1%2581%25D1%2582%25D0%25B0%25D0%25B2%25D0%25BA%25D0%25B0"></a>,    -   Perfect Forward Secrecy (PFS).    ,    IPsec.    AEAD-,  ike       .    AES-CBC   -. ,    PFS,    .<br>
<br>
     <code>xauth-noauth</code>   <code>ikev1-fakexauth</code>,        <code>xauth</code>     <code>/etc/ipsec.secrets</code>, ,     client1:<br>
<pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">client1</span></span> : XAUTH <span class="hljs-string"><span class="hljs-string">"client1"</span></span></code></pre><br>
     : <code>ikev2-pubkey</code>  IKEv2, <code>ikev1-fakexauth</code>  IKEv1        <code>ikev2-eap-tls</code> ‚Äî IKEv2+EAP-TLS  Windows Phone.  strongSwan.<br>
<br>
  ,      <b>swanctl -L</b><br>
<pre><code class="hljs delphi">$ swanctl -L
ikev2-pubkey: IKEv2
  <span class="hljs-keyword"><span class="hljs-keyword">local</span></span>:  %any
  remote: %any
  <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> key authentication:
    id: CN=uk1.pvpn.pw
    certs: CN=uk1.pvpn.pw
  remote <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> key authentication:
  ikev2-pubkey: TUNNEL
    <span class="hljs-keyword"><span class="hljs-keyword">local</span></span>:  <span class="hljs-number"><span class="hljs-number">0.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2000</span></span>::/<span class="hljs-number"><span class="hljs-number">3</span></span>
    remote: <span class="hljs-keyword"><span class="hljs-keyword">dynamic</span></span>
ikev1-fakexauth: IKEv1
  <span class="hljs-keyword"><span class="hljs-keyword">local</span></span>:  %any
  remote: %any
  <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> key authentication:
    id: CN=uk1.pvpn.pw
    certs: CN=uk1.pvpn.pw
  remote <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> key authentication:
  remote XAuth authentication:
  ikev1-fakexauth: TUNNEL
    <span class="hljs-keyword"><span class="hljs-keyword">local</span></span>:  <span class="hljs-number"><span class="hljs-number">0.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2000</span></span>::/<span class="hljs-number"><span class="hljs-number">3</span></span>
    remote: <span class="hljs-keyword"><span class="hljs-keyword">dynamic</span></span>
ikev2-eap-tls: IKEv2
  <span class="hljs-keyword"><span class="hljs-keyword">local</span></span>:  %any
  remote: %any
  <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> key authentication:
    id: CN=uk1.pvpn.pw
    certs: CN=uk1.pvpn.pw
  remote EAP authentication:
  ikev2-eap-tls: TUNNEL
    <span class="hljs-keyword"><span class="hljs-keyword">local</span></span>:  <span class="hljs-number"><span class="hljs-number">0.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.0</span></span>/<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2000</span></span>::/<span class="hljs-number"><span class="hljs-number">3</span></span>
    remote: <span class="hljs-keyword"><span class="hljs-keyword">dynamic</span></span></code></pre><br>
<h4> MTU</h4>-       IPsec-, MTU     ,   Android   MTU 1500, -          .    ,    TCP MSS    TCP-   .    1360  IPv4  1340  IPv6,      1400   :<br>
<pre><code class="hljs delphi"># iptables -t mangle -I <span class="hljs-keyword"><span class="hljs-keyword">FORWARD</span></span> -p tcp -m policy --pol ipsec --dir <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> --syn -m tcpmss --mss <span class="hljs-number"><span class="hljs-number">1361</span></span>:<span class="hljs-number"><span class="hljs-number">1536</span></span> -j TCPMSS --<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>-mss <span class="hljs-number"><span class="hljs-number">1360</span></span>
# iptables -t mangle -I <span class="hljs-keyword"><span class="hljs-keyword">FORWARD</span></span> -p tcp -m policy --pol ipsec --dir <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> --syn -m tcpmss --mss <span class="hljs-number"><span class="hljs-number">1361</span></span>:<span class="hljs-number"><span class="hljs-number">1536</span></span> -j TCPMSS --<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>-mss <span class="hljs-number"><span class="hljs-number">1360</span></span>
# ip6tables -t mangle -I <span class="hljs-keyword"><span class="hljs-keyword">FORWARD</span></span> -p tcp -m policy --pol ipsec --dir <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> --syn -m tcpmss --mss <span class="hljs-number"><span class="hljs-number">1341</span></span>:<span class="hljs-number"><span class="hljs-number">1536</span></span> -j TCPMSS --<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>-mss <span class="hljs-number"><span class="hljs-number">1340</span></span>
# ip6tables -t mangle -I <span class="hljs-keyword"><span class="hljs-keyword">FORWARD</span></span> -p tcp -m policy --pol ipsec --dir <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> --syn -m tcpmss --mss <span class="hljs-number"><span class="hljs-number">1341</span></span>:<span class="hljs-number"><span class="hljs-number">1536</span></span> -j TCPMSS --<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>-mss <span class="hljs-number"><span class="hljs-number">1340</span></span></code></pre><br>
    .    NAT,    !<br>
<br>
<h3> </h3>            *.p12,      IPsec PKI, IPsec XAUTH RSA  IKEv2 (   ),      .<br>
<b>!      ,       .        IP-,      ,  !</b><br>
<br>
<h4>Windows</h4>Windows 7, 8, 8.1 (IKEv2)<br>
<a href="https://wiki.strongswan.org/projects/strongswan/wiki/Win7Certs"> </a><br>
<a href="https://wiki.strongswan.org/projects/strongswan/wiki/Win7Config"> </a><br>
<a href="https://wiki.strongswan.org/projects/strongswan/wiki/Win7Connect"></a><br>
<br>
Windows Vista (IKE)<br>
<a href="https://wiki.strongswan.org/projects/strongswan/wiki/WindowsVista">IKE  Windows Vista</a><br>
<br>
<h4>OS X  iOS</h4><a href="https://wiki.strongswan.org/projects/strongswan/wiki/IOS_(Apple)">   iOS  OS X</a><br>
<br>
<h4>Android</h4>    IPsec- Android     IKE,   <a href="https://play.google.com/store/apps/details%3Fid%3Dorg.strongswan.android"> strongSwan</a>   IKEv2.  strongSwan         .<br>
<br>
     ,    ¬´  SD-¬ª   ¬´¬ª.    VPN,      ¬´IPSec Xauth RSA¬ª,   ¬´ ¬ª , ,  ,   ¬´  IPSec¬ª  ¬´  IPSec¬ª   ¬´client1¬ª.   ,        .<br>
<br>
<h3></h3>IPsec,   ,    OpenVPN,    .   VPN-    L2TP+IPsec    , .. strongSwan         (  Radius,  ).   strongSwan                  .<br>
IPsec,    ,      ,        ,    SIM-         IPSECKEY- ,  DNSSEC.<br>
    IPsec -  NSA,    , ,   <a href="https://nohats.ca/wordpress/blog/2014/12/29/dont-stop-using-ipsec-just-yet/">Don‚Äôt stop using IPsec just yet</a>,   .</div><p>Source: <a href="https://habr.com/ru/post/250859/">https://habr.com/ru/post/250859/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250847/index.html">The tools that allowed us to speed up the development of the game</a></li>
<li><a href="../250851/index.html">Why Bittorent via Tor is a Bad Idea</a></li>
<li><a href="../250853/index.html">Simple webdev in java 8</a></li>
<li><a href="../250855/index.html">Applied optimization practice and some history</a></li>
<li><a href="../250857/index.html">MailChimp UX Team: Collaboration [Part 2 of the Book]</a></li>
<li><a href="../250861/index.html">Parsing function calls in PHP</a></li>
<li><a href="../250867/index.html">When the site can be more than 1Mb?</a></li>
<li><a href="../250873/index.html">Unity: Build under Android or "size matters"</a></li>
<li><a href="../250875/index.html">What is Business Intelligence?</a></li>
<li><a href="../250879/index.html">Everything has been stolen before us.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>