<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Determining the dominant colors: Python and the k-means method</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Assorium 

 Habr√© published several articles with algorithms and scripts to select the dominant colors in the image: 1 , 2 , 3 . In the comments to th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Determining the dominant colors: Python and the k-means method</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/d9f/ec4/516/d9fec45165ed968b211b1bce5ad9ed69.jpg"><br>  <sup><a href="http://habrahabr.ru/users/assorium/" class="user_link">Assorium</a></sup> <br><br>  Habr√© published several articles with algorithms and scripts to select the dominant colors in the image: <a href="http://habrahabr.ru/post/136530/">1</a> , <a href="http://habrahabr.ru/post/136530/">2</a> , <a href="http://habrahabr.ru/post/137868/">3</a> .  In the comments to those articles you can find links to a dozen more similar programs and services.  But there is no limit to perfection - and why not consider a method that seems the most optimal?  We are talking about the use of clustering by the method of k-means (k-means). <br><a name="habracut"></a><br>  Like many before him, American web developer Charles Leifer (Charles Leifer) <a href="http://charlesleifer.com/blog/using-python-and-k-means-to-find-the-dominant-colors-in-images/">used the k-means method</a> to cluster the colors in an image.  The idea of ‚Äã‚Äãthe method for clustering any data is to minimize the total quadratic deviation of cluster points from the centers of these clusters.  At the first stage, the starting points (centers of mass) are chosen randomly and the membership of each element to one or another center is calculated.  Then, at each iteration of the execution of the algorithm, the centers of mass are recalculated - until the algorithm converges. <br><br>  The result is something like this.  The points are colored, depending on the color of the cluster, the black dots represent the centers of mass. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/2c5/edd/dae/2c5edddae0d7b5056c5f84d27313b655.gif"><br><br>  As applied to images, each pixel is positioned in the three-dimensional RGB space, where the distance to the centers of mass is calculated.  To optimize images are reduced to 200x200 using the library <a href="http://www.pythonware.com/products/pil/">PIL</a> .  It is also used to extract RGB values. <br><br><h1>  Code </h1><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> collections <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> namedtuple <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> math <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sqrt <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ImportError: <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> PIL <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Image Point = namedtuple(<span class="hljs-string"><span class="hljs-string">'Point'</span></span>, (<span class="hljs-string"><span class="hljs-string">'coords'</span></span>, <span class="hljs-string"><span class="hljs-string">'n'</span></span>, <span class="hljs-string"><span class="hljs-string">'ct'</span></span>)) Cluster = namedtuple(<span class="hljs-string"><span class="hljs-string">'Cluster'</span></span>, (<span class="hljs-string"><span class="hljs-string">'points'</span></span>, <span class="hljs-string"><span class="hljs-string">'center'</span></span>, <span class="hljs-string"><span class="hljs-string">'n'</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_points</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(img)</span></span></span><span class="hljs-function">:</span></span> points = [] w, h = img.size <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> count, color <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> img.getcolors(w * h): points.append(Point(color, <span class="hljs-number"><span class="hljs-number">3</span></span>, count)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> points rtoh = <span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> rgb: <span class="hljs-string"><span class="hljs-string">'#%s'</span></span> % <span class="hljs-string"><span class="hljs-string">''</span></span>.join((<span class="hljs-string"><span class="hljs-string">'%02x'</span></span> % p <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rgb)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">colorz</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename, n=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">3</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> img = Image.open(filename) img.thumbnail((<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>)) w, h = img.size points = get_points(img) clusters = kmeans(points, n, <span class="hljs-number"><span class="hljs-number">1</span></span>) rgbs = [map(int, c.center.coords) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> clusters] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> map(rtoh, rgbs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">euclidean</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(p1, p2)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sqrt(sum([ (p1.coords[i] - p2.coords[i]) ** <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(p1.n) ])) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calculate_center</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(points, n)</span></span></span><span class="hljs-function">:</span></span> vals = [<span class="hljs-number"><span class="hljs-number">0.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(n)] plen = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> points: plen += p.ct <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(n): vals[i] += (p.coords[i] * p.ct) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Point([(v / plen) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> v <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vals], n, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">kmeans</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(points, k, min_diff)</span></span></span><span class="hljs-function">:</span></span> clusters = [Cluster([p], p, pn) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> random.sample(points, k)] <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: plists = [[] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(k)] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> p <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> points: smallest_distance = float(<span class="hljs-string"><span class="hljs-string">'Inf'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(k): distance = euclidean(p, clusters[i].center) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> distance &lt; smallest_distance: smallest_distance = distance idx = i plists[idx].append(p) diff = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(k): old = clusters[i] center = calculate_center(plists[i], old.n) new = Cluster(plists[i], center, old.n) clusters[i] = new diff = max(diff, euclidean(old.center, new.center)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> diff &lt; min_diff: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> clusters</code> </pre> <br><h1>  Examples </h1><img src="http://habrastorage.org/storage2/e77/00c/09c/e7700c09ce0fee4cdc75db9f5c253fe2.jpg"><br><img src="http://habrastorage.org/storage2/95d/4e8/c6d/95d4e8c6dfa99d97674b0cda911dd281.png"><br><br><img src="http://habrastorage.org/storage2/c6c/c87/fd0/c6cc87fd0179dd95cbd52ee7740ffb13.jpg"><br><img src="http://habrastorage.org/storage2/9cb/d87/412/9cbd8741273bd20b94f42e96952f86c5.png"><br><br><img src="http://habrastorage.org/storage2/b2c/76d/67e/b2c76d67e44865c0a83ea011772e3b93.jpg"><br><img src="http://habrastorage.org/storage2/3f4/5d1/382/3f45d13821ac77e291179e584c334ca7.png"><br><br><img src="http://habrastorage.org/storage2/c3c/ad6/5aa/c3cad65aa2fcc55f70bab3d46f3af542.jpg"><br><img src="http://habrastorage.org/storage2/eff/72c/5a6/eff72c5a63dfe878f1b68bc2ba2634e5.png"><br><br>  Determining the dominant colors is a rather useful thing that will always be used.  This is the choice of a palette for a website or some elements of the UI.  For example, the Chrome browser <a href="http://www.quora.com/Google-Chrome/How-does-Chrome-pick-the-color-for-the-stripes-on-the-Most-visited-page-thumbnails">uses</a> the k-means method to select the dominant color from the favicon. <br><br><img src="http://habrastorage.org/storage2/316/67a/2e0/31667a2e0b82aec1ae96a3d59e76e1c5.png"></div><p>Source: <a href="https://habr.com/ru/post/156045/">https://habr.com/ru/post/156045/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../156029/index.html">Domain pearls or the most stupid domains</a></li>
<li><a href="../156033/index.html">CDN for 70,000 sites with one button</a></li>
<li><a href="../156035/index.html">.Net-detective: about interfaces and reflection</a></li>
<li><a href="../156037/index.html">A bit about the interfaces in .Net (based on one interview)</a></li>
<li><a href="../156039/index.html">Battle City on unity in 1 day?</a></li>
<li><a href="../156047/index.html">The data center is the engine of energy efficiency in the world. But in Russia?</a></li>
<li><a href="../156049/index.html">Microelectronics for space and military</a></li>
<li><a href="../156051/index.html">Circuit Switch FallBack: First Step on the Road to Voice in LTE</a></li>
<li><a href="../156053/index.html">VDI for SMB on Windows Server 2012 by HP</a></li>
<li><a href="../156057/index.html">Single-factor two-factor authentication</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>