<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Working with different units of measurement of the same type and converting them</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. Faced an interesting task in a large project, where many calculations of different distances. Given that data is collected from different so...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Working with different units of measurement of the same type and converting them</h1><div class="post__text post__text-html js-mediator-article">  Good day.  Faced an interesting task in a large project, where many calculations of different distances.  Given that data is collected from different sources, they can be in different units - there are meters, there are millimeters.  Keeping track of all this is difficult when calculations are scattered everywhere.  And if a variable is declared, then often only the author knows in detail what units it is in, since there are almost no comments in the code.  And the author quit / forgot / left for a binge. <br><a name="habracut"></a><br>  This suggests a solution to describe each unit as a separate type, for example: <br><br><pre><code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> TSizeMeter = single; TSizeMilliMeter = single;</code> </pre> <br>  This we have increased the readability of the code.  But how to protect yourself from conversion errors?  After all, these types are compatible, and their castes will not give any error or Vorning (see <a href="http://docwiki.embarcadero.com/RADStudio/Seattle/en/Type_Compatibility_and_Identity">here</a> ).  I haven‚Äôt found a way to output a worm when casting types, but we can write an automatic conversion if such a caste occurs.  Here is the simplest example with addition and subtraction: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> TSizeMeter = <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> value:single; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> units=<span class="hljs-string"><span class="hljs-string">'m'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> Add(a, b: TSizeMeter): TSizeMeter; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> Subtract(a, b: TSizeMeter): TSizeMeter; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> Implicit(a: single): TSizeMeter; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> Implicit(a: TSizeMeter): single; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; TSizeMiliMeter = <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> value:single; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> units=<span class="hljs-string"><span class="hljs-string">'mm'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> Add(a, b: TSizeMiliMeter): TSizeMiliMeter; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> Subtract(a, b: TSizeMiliMeter): TSizeMiliMeter; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> Implicit(a: single): TSizeMiliMeter; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> Implicit(a: TSizeMiliMeter): single; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> Implicit(a: TSizeMiliMeter): TSizeMeter; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> Implicit(a: TSizeMeter): TSizeMiliMeter; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">implementation</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> TSizeMeter.Add(a, b: TSizeMeter): TSizeMeter; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> result.value:=a.value+b.value; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> TSizeMeter.Subtract(a, b: TSizeMeter): TSizeMeter; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> result.value:=a.value-b.value; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> TSizeMeter.Implicit(a: single): TSizeMeter; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> result.value:=a; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> TSizeMeter.Implicit(a: TSizeMeter): single; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> result:=a.value; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> TSizeMiliMeter.Add(a, b: TSizeMiliMeter): TSizeMiliMeter; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> result.value:=a.value+b.value; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> TSizeMiliMeter.Subtract(a, b: TSizeMiliMeter): TSizeMiliMeter; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> result.value:=a.value-b.value; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> TSizeMiliMeter.Implicit(a: single): TSizeMiliMeter; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> result.value:=a; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> TSizeMiliMeter.Implicit(a: TSizeMiliMeter): single; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> result:=a.value; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> TSizeMiliMeter.Implicit(a: TSizeMiliMeter): TSizeMeter; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> result.value:=a.value/<span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> TSizeMiliMeter.Implicit(a: TSizeMeter): TSizeMiliMeter; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> result.value:=a.value*<span class="hljs-number"><span class="hljs-number">1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  But its use: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v1:TSizeMeter; v2:TSizeMiliMeter; v3:TSizeMeter; v4:TSizeMiliMeter; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> v1:=<span class="hljs-number"><span class="hljs-number">1.1</span></span>; v2:=<span class="hljs-number"><span class="hljs-number">111.1</span></span>; s1:=v1; s2:=v2; writeln(formatfloat(<span class="hljs-string"><span class="hljs-string">'0.000'</span></span>,v1.value)+<span class="hljs-string"><span class="hljs-string">' '</span></span>+v1.units+<span class="hljs-string"><span class="hljs-string">' or '</span></span>+formatfloat(<span class="hljs-string"><span class="hljs-string">'0.000'</span></span>,s1)); writeln(formatfloat(<span class="hljs-string"><span class="hljs-string">'0.000'</span></span>,v2.value)+<span class="hljs-string"><span class="hljs-string">' '</span></span>+v2.units+<span class="hljs-string"><span class="hljs-string">' or '</span></span>+formatfloat(<span class="hljs-string"><span class="hljs-string">'0.000'</span></span>,s2)); writeln(<span class="hljs-string"><span class="hljs-string">'+'</span></span>); v3:=v1+v2; v4:=v1+v2; writeln(formatfloat(<span class="hljs-string"><span class="hljs-string">'0.000'</span></span>,v3.value)+<span class="hljs-string"><span class="hljs-string">' '</span></span>+v3.units); writeln(formatfloat(<span class="hljs-string"><span class="hljs-string">'0.000'</span></span>,v4.value)+<span class="hljs-string"><span class="hljs-string">' '</span></span>+v4.units); writeln(<span class="hljs-string"><span class="hljs-string">'-'</span></span>); v3:=v1-v2; v4:=v1-v2; writeln(formatfloat(<span class="hljs-string"><span class="hljs-string">'0.000'</span></span>,v3.value)+<span class="hljs-string"><span class="hljs-string">' '</span></span>+v3.units); writeln(formatfloat(<span class="hljs-string"><span class="hljs-string">'0.000'</span></span>,v4.value)+<span class="hljs-string"><span class="hljs-string">' '</span></span>+v4.units); writeln(<span class="hljs-string"><span class="hljs-string">'cast'</span></span>); v3:=v2; v4:=v1; writeln(formatfloat(<span class="hljs-string"><span class="hljs-string">'0.000'</span></span>,v3.value)+<span class="hljs-string"><span class="hljs-string">' '</span></span>+v3.units); writeln(formatfloat(<span class="hljs-string"><span class="hljs-string">'0.000'</span></span>,v4.value)+<span class="hljs-string"><span class="hljs-string">' '</span></span>+v4.units); writeln(<span class="hljs-string"><span class="hljs-string">'mix'</span></span>); v3:=v2+<span class="hljs-number"><span class="hljs-number">22.22</span></span>; s1:=v1+<span class="hljs-number"><span class="hljs-number">33.33</span></span>; writeln(formatfloat(<span class="hljs-string"><span class="hljs-string">'0.000'</span></span>,v3.value)+<span class="hljs-string"><span class="hljs-string">' '</span></span>+v3.units); writeln(formatfloat(<span class="hljs-string"><span class="hljs-string">'0.000'</span></span>,s1)); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>.</code> </pre><br>  That will give this result: <br><blockquote>  1,100 m or 1,100 <br>  111,100 mm or 111,100 <br>  + <br>  1.211 m <br>  1211,100 mm <br>  - <br>  0.989 m <br>  988,900 mm <br>  cast <br>  0.111 m <br>  1100,000 mm <br>  mix <br>  0.133 m <br>  34,430 <br></blockquote><br>  This solution is not ideal, as it makes the conversion not obvious, which may give rise to new problems.  But, if you declare all variables with the correct type, there should be no problems. <br>  A more stiff decision that will limit casting types is to raise an escape when trying to cast, like this: <br><br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> TSizeMiliMeter.Implicit(a: TSizeMiliMeter): TSizeMeter; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> Exception.Create(<span class="hljs-string"><span class="hljs-string">'Typecast not allowed'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> TSizeMiliMeter.Implicit(a: TSizeMeter): TSizeMiliMeter; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> Exception.Create(<span class="hljs-string"><span class="hljs-string">'Typecast not allowed'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  In this case, we get an error in the line: <br><br><pre> <code class="delphi hljs">v3:=v1+v2;</code> </pre><br>  You can further develop the solution by creating your own type of function. <br><br>  If someone has encountered similar problems, share your experience in the comments :) Surely there are more elegant solutions than the one described above. <br><br>  PS: The test was performed in Delphi 10.1 </div><p>Source: <a href="https://habr.com/ru/post/314814/">https://habr.com/ru/post/314814/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314800/index.html">Russian hacker taught IT university students how to hack network</a></li>
<li><a href="../314802/index.html">About layout, logic, eccentrics and MTS portals</a></li>
<li><a href="../314804/index.html">50 shades of Go: traps, pitfalls and common mistakes beginners</a></li>
<li><a href="../314806/index.html">The history of the startup and our pivot</a></li>
<li><a href="../314810/index.html">Analyzing the performance of the server Oracle SPARC T7-2</a></li>
<li><a href="../314816/index.html">Microsoft fixed a serious vulnerability in Windows</a></li>
<li><a href="../314818/index.html">Search optimization when choosing a campaign</a></li>
<li><a href="../314820/index.html">Tricks for taking complex integrals</a></li>
<li><a href="../314822/index.html">Manage identity verification with Windows Hello for Business</a></li>
<li><a href="../314824/index.html">5 lessons of a seven-month stay in a start-up hell</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>