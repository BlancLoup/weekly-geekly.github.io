<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Upsert performance in MongoDB</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the MongoDB nosql-base there is an analogue of the mysql INSERT ... ON DUPLICATE KEY UPDATE - upsert (UPdate or inSERT). 

 How fast does mongodb d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Upsert performance in MongoDB</h1><div class="post__text post__text-html js-mediator-article"> In the <a href="http://www.mongodb.org/">MongoDB</a> nosql-base there is an analogue of the mysql <a href="http://dev.mysql.com/doc/refman/5.1/en/insert-on-duplicate.html">INSERT ... ON DUPLICATE KEY UPDATE</a> - upsert (UPdate or inSERT). <br><br>  How fast does mongodb do it? <br><br>  The question is not idle, since upsets carry out two operations ‚Äî read and write.  The presence of indexes speeds up reading, but slows down writing.  Which of them accelerates more strongly, and who slows down steeper? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>upd:    </code> <br> <br><a name="habracut"></a><br><br><h3>  Focusing on UPdate </h3><br><br><h4>  results </h4><br><br><img src="http://snick.ru/assets/mongodb-upserts-performance-20100224.png" alt="mongodb upsert's performance"><br><br><h4>  Comments </h4><br><br>  I considered the case when the document has an array and there is an active record.  Example - blog comments: <br><pre> db.blog.insert ({
   title: "new post",
   content: "&lt;p&gt; Hello world! &lt;/ p&gt;",
   comments: []
 });
</pre><br><br>  Each comment is an object of type: <br><pre> NEW_COMMENT = {
   content: "Thanks! Great article! Peshi is4o!",
   author: "vasily@example.com"
 }
</pre><br><br>  The graph shows the performance of the operation <code>db.blog.update({title: "new post"}, {"$push": {comments: NEW_COMMENT}}, <b>true</b> )</code> (the last parameter enables upsert mode) depending on the size of the <code>blog.comments</code> array and having an index on <code>blog.title</code> . <br><br><h3>  Focus on inSERT </h3><br><br><h3>  results </h3><br><br><img src="http://snick.ru/assets/mongodb-upserts-performance-20100224-2.png" alt="mongodb upsert's performance"><br><br><h3>  Comments </h3><br><br>  The same case, but the title of the post all the time generate randomly.  Meaning - the frequent posting of new articles through the upsert. <br><br>  It can be seen that with a small number of records (small base), the index is not needed.  But with the growth of the base and the increase in the number of extents, the index begins to help and gives a stable write speed. <br><br><h3>  Results </h3><br><br>  My verses upsert'am such: you can use when you can not say exactly what more - document changes or adding new ones, or their ratio is about 50/50.  In my environment, the "head-on" recording goes at a speed of 10K documents per second. <br><br>  Experimenters: pay attention to the size of the document, how many extents it occupies (nscanned).  With the increase in the number of extents, the picture will be the same as on the first graph, but it will degrade more abruptly. </div><p>Source: <a href="https://habr.com/ru/post/85804/">https://habr.com/ru/post/85804/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../85794/index.html">Labels and Copyright: The word to the musicians themselves</a></li>
<li><a href="../85795/index.html">Yandex Developer, Yandex API Bar: Yandex.Bar with your buttons</a></li>
<li><a href="../85797/index.html">Measuring temperature at a distance, a review of Fluke 62 mini</a></li>
<li><a href="../85801/index.html">I already love CS5</a></li>
<li><a href="../85803/index.html">Consumer Protection: a refund for a technically complex product in the event of a malfunction that reoccurs after elimination</a></li>
<li><a href="../85806/index.html">The site is running</a></li>
<li><a href="../85808/index.html">T-Mobile Rake for G1</a></li>
<li><a href="../85809/index.html">The end of the space era of the USSR</a></li>
<li><a href="../85810/index.html">65 meters near Moscow. Photo report from the presentation of MSI and NVIDIA</a></li>
<li><a href="../85811/index.html">Golden mean</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>