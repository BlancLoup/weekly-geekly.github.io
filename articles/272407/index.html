<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Verone - static analyzer for C ++ with analysis on the fly</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="My name is Vladimir Plyashkun and in today's article I am going to present a free Verone static analyzer for C ++ 03 / C ++ 11 / C ++ 14, the main fea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Verone - static analyzer for C ++ with analysis on the fly</h1><div class="post__text post__text-html js-mediator-article">  My name is Vladimir Plyashkun and in today's article I am going to present a free Verone static analyzer for C ++ 03 / C ++ 11 / C ++ 14, the main feature of which is on-the-fly analysis. <br><a name="habracut"></a><br>  Today there is a large selection of static analysis tools for the C ++ language: Coverity / Klocwork / Parasoft / Clang / CppCheck / PVS-Studio and many others.  And recently ReSharper C ++ was also released. <br><br>  However, the task of analyzing on the fly is still relevant, since  There are practically no solutions with this feature.  The same ReSharper integrates with Visual Studio and finds many problems online (for example, unused header files), but it is still seen more as a means of refactoring than a classic static analyzer.  R # has practically no diagnostics of semantic errors, copy-paste errors and typos, as well as run-time errors (memory leaks, buffer overflows, dereferencing null pointers, etc.) <br><br>  Coverity / Klocwork / Parasoft - each of these tools calls itself the market leader, but it will be extremely difficult for an individual developer to get even a trial version of these analyzers, because the target orientation of these products is different and aimed at large companies.  Therefore, it makes no sense to consider them. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Clang is mainly aimed at finding vulnerabilities in the source program.  Available checks are available <a href="http://clang-analyzer.llvm.org/available_checks.html">here</a> . <br><br>  It is disappointing that clang practically does not diagnose typos and semantic errors, and it is somewhat inconvenient to use clang at the moment outside of XCode.  Of course, the analyzer can be launched from the console, but such a scheme requires manual configuration (specifying a list of files, paths to directories of header files, predefined macros, etc.).  Therefore, such a periodic launch of an external utility outside the IDE can hardly be called convenient and useful. <br><br>  PVS-Studio went a little further and integrated into the build system.  Now the analysis is performed automatically after each build of the project.  But again, the question arises, why not to perform analysis on the fly, highlighting all the errors found right during coding?  Which is much more logical and convenient for the end user. <br><br>  This is exactly the problem that the Verone analyzer solves.  After installation, the analyzer will automatically start when you open Visual Studio.  In the background thread, Verone will track the changes that the programmer makes during the workflow, analyze them, and display the result of the problems found.  All diagnostics for the current file are indicated to the right of the editor in a special indent: <br><br><img src="https://habrastorage.org/files/7dc/62b/e0d/7dc62be0d59a48c0aa13ef9a463b402e.png"><br><br>  The color of the so-called glyph depends on the type of diagnosis (note, warning, error).  To view all the problems found, just click on the analyzer icon on the toolbar, after which a window will appear with all the problems found: <br><br><img src="https://habrastorage.org/files/1f1/40b/73f/1f140b73f3d241efa6a5377c3a6a5308.png"><br><br>  At the moment, the analyzer has about 20 diagnostics aimed at finding semantic errors and typos.  Of course, this is extremely small in order to compete with existing instruments, but it is worth understanding that this is only the first release and many developments simply did not enter it.  Plans for the future will be at the end of the article.  However, this is already enough to detect defects in real projects. <br><br>  For example, the following problems were found in the LLVM source code: <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ArgTy-&gt;isStructureOrClassType()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> record_type_class; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ArgTy-&gt;isUnionType()) <span class="hljs-comment"><span class="hljs-comment">//&lt;--- return union_type_class; else if (ArgTy-&gt;isArrayType()) return array_type_class; else if (ArgTy-&gt;isUnionType()) //&lt;---- return union_type_class;</span></span></code> </pre> <br>  Here is the condition <br><br><pre> <code class="cpp hljs">ArgTy-&gt;isUnionType()</code> </pre><br>  repeated twice due to commonplace inattention.  And if this fragment can hardly be considered a serious bug, then this code is already causing much more suspicion: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((NDesc &amp; MachO::REFERENCE_TYPE) == MachO::REFERENCE_FLAG_UNDEFINED_LAZY) <span class="hljs-comment"><span class="hljs-comment">//&lt;---- outs() &lt;&lt; "undefined [lazy bound]) "; else if ((NDesc &amp; MachO::REFERENCE_TYPE) == MachO::REFERENCE_FLAG_UNDEFINED_LAZY) //&lt;--- outs() &lt;&lt; "undefined [private lazy bound]) "; else if ((NDesc &amp; MachO::REFERENCE_TYPE) == MachO::REFERENCE_FLAG_PRIVATE_UNDEFINED_NON_LAZY) outs() &lt;&lt; "undefined [private]) "; else outs() &lt;&lt; "undefined) ";</span></span></code> </pre><br>  The second block will never get control, because its condition is completely identical to the condition of the first block.  After studying the source code, I can assume that in the second case there should be a condition of the form: <br><br><pre> <code class="cpp hljs">(NDesc &amp; MachO::REFERENCE_TYPE) == MachO:: REFERENCE_FLAG_PRIVATE_UNDEFINED_LAZY</code> </pre><br>  A similar problem was discovered by the libsass project. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lhs_tail-&gt;combinator() != rhs_tail-&gt;combinator()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lhs_tail-&gt;head() &amp;&amp; !rhs_tail-&gt;head()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!lhs_tail-&gt;head() &amp;&amp; rhs_tail-&gt;head()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lhs_tail-&gt;head() &amp;&amp; lhs_tail-&gt;head()) { <span class="hljs-comment"><span class="hljs-comment">//&lt;--- if (!lhs_tail-&gt;head()-&gt;is_superselector_of(rhs_tail-&gt;head())) return false; }</span></span></code> </pre><br>  In this fragment, the last condition is mistaken: <br><br><pre> <code class="cpp hljs">lhs_tail-&gt;head() &amp;&amp; lhs_tail-&gt;head()</code> </pre><br>  Again, the code is written in such a way that the error did not make itself felt, but this does not mean that it does not need to be corrected, which was done by the authors in one of the latest commits. <br><br>  A number of suspicious locations were found in the Torque 3D graphics engine. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Update accumulation texture if it changed. // Note: accumulation texture can be NULL, and must be updated. if ( passRI-&gt;accuTex != lastAccuTex ) { sgData.accuTex = passRI-&gt;accuTex; lastAccuTex = lastAccuTex; dirty = true; }</span></span></code> </pre><br>  Based on logic, the lastAccuTex pointer (GFXTextureObject *) refers to the last processed object passRI-&gt; accuTex, but due to inattention of the variable, an eigenvalue is assigned. <br><br>  And in this fragment: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConnectionProtocol</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: ConnectionProtocol(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processRawPacket</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BitStream *bstream)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> Net::<span class="hljs-function"><span class="hljs-function">Error </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendPacket</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BitStream *bstream)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">keepAlive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleConnectionEstablished</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleNotify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> recvd)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handlePacket</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BitStream *bstream)</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; ... };</code> </pre><br>  The class is polymorphic, but it has a default destructor (not virtual).  Therefore, it can lead to resource leaks in child classes, if the removal will use a pointer to the base class. <br><br>  There are suspicious places with integer division, rejecting the fractional part, such as here: <br><br><pre> <code class="cpp hljs">bm-&gt;avgfloat=PACKETBLOBS/<span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre><br>  The variable bm-&gt; avgfloat is a floating point type, but since the integer division is to the right of the assignment operator, the fractional part will be dropped.  Not to say that this is a clear mistake, but requires attention. <br><br>  In conclusion, it should be said that the development of a static analyzer is a very big task that requires a lot of resources and time.  There are many developments that are not included in this release.  Therefore, I want to describe several areas in which Verone will develop over the next six months or a year. <br><br><ol><li>  <b>More advanced analysis algorithm on the fly, based on the generation of mock files (thanks to Sasha Kokovin for the idea)</b> <br>  Now this algorithm works extremely simply.  In fact, everything is tied around the file with pairs <i>&lt;file name&gt; - &lt;last analysis date&gt;</i> .  And the core of the analyzer just starts at a certain frequency.  Since in the process of work a small number of files change, such a scheme still allowed to scale to large projects. </li><li>  <b>Ability to analyze still unsaved changes in the editor</b> <br>  The above scheme, unfortunately, is tied to files and does not take into account changes that have already been made in the editor, but not yet saved.  This task is quite voluminous and requires thorough testing, and therefore was not implemented in the first release. <br></li><li>  <b>Runtime error analysis</b> <br>  One of the main directions is the analysis of run-time errors, which is not in the current version.  Analysis of runtime errors, coupled with analysis on the fly, looks very promising, for I see, for example, dereferencing a null pointer at the time of encoding is very cool!  Of course, some simplifications will have to be made, since the data flow analysis algorithms are quite resource intensive.  But even, for example, local analysis will still bring tangible benefits, warning the developer about possible problems. <br></li></ol><br>  Of the more distant tasks, it is worth highlighting also: <br><br><ol><li>  <b>GUI Improvements</b> <br>  Now there is no functionality for hiding diagnostics, searching for them and saving to a file, which would be useful in everyday work. <br></li><li>  <b>Mastering other IDE and operating systems</b> <br></li><li>  <b>Standalone app</b> <br>  Independent graphical application is useful, because  not confined to any development environment.  Already, you can safely use the console version of the analyzer, but the GUI version seems to be a more convenient solution for this purpose. <br></li></ol><br>  The analyzer is available for download at the <a href="http://verone-analyzer.com/">link</a> .  At the moment, the analyzer is available only for Windows, a version is available for integration with Visual Studio 2015. Versions for Visual Studio 2012 and Visual Studio 2013 will appear in a week or two. <br><br>  Ready to answer any questions.  I would appreciate feedback and suggestions! </div><p>Source: <a href="https://habr.com/ru/post/272407/">https://habr.com/ru/post/272407/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272397/index.html">Cloud services that help us every day</a></li>
<li><a href="../272399/index.html">Passion for the domain Sex.com</a></li>
<li><a href="../272401/index.html">50 typical gaming camera design errors (part 1)</a></li>
<li><a href="../272403/index.html">The font of your letters spoils your life.</a></li>
<li><a href="../272405/index.html">Open source and intellectual property</a></li>
<li><a href="../272409/index.html">Record of the webinar "Kerio Operator - Why is it VoIP?"</a></li>
<li><a href="../272411/index.html">PostgreSQL Document-Oriented API Design: Full-Text Search and Save Many Documents (Part 2)</a></li>
<li><a href="../272413/index.html">Security Week 49: Used certificates, data theft from children's toys, Microsoft blocks unwanted software</a></li>
<li><a href="../272417/index.html">How to cope with problems in an inherited project after 3 other teams</a></li>
<li><a href="../272419/index.html">Alloy Navigator: Co-pilot for IT Infrastructure</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>