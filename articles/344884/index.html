<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúTruth in wine‚Äù or try programming NanoCAD under Linux (MultiCAD.NET API)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Almost since the release of the first ‚Äúcapable‚Äù version of NanoCAD, among the user community there was an acute question about the need to implement t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúTruth in wine‚Äù or try programming NanoCAD under Linux (MultiCAD.NET API)</h1><div class="post__text post__text-html js-mediator-article">  Almost since the release of the first ‚Äúcapable‚Äù version of NanoCAD, among the user community there was an acute <a href="http://forum.nanocad.ru/index.php%3Fs%3D1e6f4b440ca9dd47da46102a9e16bf99%26showtopic%3D30%26st%3D0">question about the need to implement this CAD for Linux</a> <br><br>  Probably, you thought that this article was born, because the developers finally "made it!".  <i>I hasten to reassure you - everything is left in their places</i> .  I still don‚Äôt know anything about the NanoCAD version for Linux.  Therefore, we will try to use Wine. <br><br>  So this short note will be not so much about using NanoCAD in Linux, but about programming for Nanocad in a system other than Windows, and if even more precisely, how I armed myself with Linux Mint, MonoDevelop and tried to build a library (.dll) for <b>free</b> version of NanoCAD using the <a href="https://habrahabr.ru/company/nanosoft/blog/242497/">MultiCAD.NET API.</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you're wondering what came out of it, you are welcome under the cat! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/926/b48/db9/926b48db967c3445d9e8970058e24786.png" alt="image"><br><a name="habracut"></a><br><a name="I"></a><br><h2>  Part I: ... restless hands </h2><br>  It seems that my new hobby will also ultimately result in a mini-cycle of articles, and since we will refer to past developments, I will cite all previous articles under the spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Other articles of the cycle</b> <div class="spoiler_text"><ul><li>  <a href="https://habrahabr.ru/post/342186/">Scarless Face or First Steps in Multicad.NET API 7 (for Nanocad 8.1)</a> </li><li>  <a href="https://habrahabr.ru/post/342680/">‚ÄúLike a ram on a new gate‚Äù or custom ‚Äúpseudo-3D‚Äù objects in NanoCAD using the MultiCAD.NET API</a> </li><li>  <a href="https://habrahabr.ru/post/343772/">‚ÄúI am watching you‚Äù or how to make SCADA from CADa (MultiCAD.NET API)</a> </li></ul><br></div></div><br>  At the very beginning, just in case, I‚Äôll clarify that I‚Äôm not a programmer, that I can‚Äôt be called a ‚Äúconfident Linux user‚Äù, and that <b>I‚Äôm not connected</b> <b>to the developers of NanoCAD</b> (Nanosoft), so everything that will be lower This is my private and in some places naive non-professional opinion. <br><br>  It would probably be appropriate to share the source data with which I approached the solution of the problem: <br><br><ol><li>  OS - Linux Mint 18.3 "Sylvia" - Cinnamon (64-bit) </li><li>  Wine - PlayOnLinux (Wine 2.2) </li><li>  IDE - MonoDevelp 7.1 (Mono 5.2.0) </li><li>  Hands - "from the priests" (and great curiosity) </li></ol><br>  Since there are so few people programming for NanoCAD, and among them there are so much extreme and uncontrollable people who are ready to program for NanoCAD under Linix, even less, I think that it will not have much practical value and will be considered only for the purpose of satisfying technical curiosity. <br><br>  If, after the previous paragraph, you have continued to read it, it means you have an <b>excerpt like Chuck Norris</b> , and this is worthy of respect. <br><br> <a href="https://youtu.be/r6ZBTsIgwVg%3Ft%3D42m10s"><img title="video link" src="https://habrastorage.org/webt/sq/ta/-l/sqta-leinhxatc7e5f6utaf7fgo.png"></a> <br><br>  It's finally time to find out what awaits us in this article. <br><br>  Content: <br><br><ul><li>  <a href="https://habr.com/ru/post/344884/">Part I: ... restless hands</a> </li><li>  <a href="https://habr.com/ru/post/344884/">Part II: trying to run using Wine</a> </li><li>  <a href="https://habr.com/ru/post/344884/">Part III: we collect the project in MonoDevelop</a> </li><li>  <a href="https://habr.com/ru/post/344884/">Part IV: the birth of a penguin</a> </li></ul><br><a name="II"></a><h2>  Part II: trying to run using Wine </h2><br><br>  It should be noted that the developers, although not directly spending their resources on adapting to Linux, still sometimes worry about us.  The impetus to the creation of this article served as their post on Habr√© which I accidentally stumbled upon - ‚Äú <a href="https://habrahabr.ru/company/nanosoft/blog/160813/">Council Repost: running nanoCAD free 3.5 / 3.7 under Linux using Wine‚Äù</a> . <br><br>  Of course, version 3.7 is already completely outdated, and I decided to try a more recent version of <a href="http://www.nanocad.ru/products/nanocad_free/">NanoCAD 5.1</a> close to it. <br><br>  If suddenly you are not at all familiar with Nanocad, then you can read the very <a href="https://habrahabr.ru/post/342186/">first article of the cycle</a> .  In short, NanoCAD 5.1, though not an open source program, but still it is absolutely <b>free for commercial use</b> , I personally think that if developers made sane adaptations for Linux, at least with the help of Wine, then thanks to the familiar interface and similarity with AutoCAD, in the functionality of a two-dimensional "electronic drawing board" it could well compete, the same FreeCAD and QCAD (LibreCAD). <br><br>  But for now, we will be content with what we have, and we have advice from the forum on <a href="http://forum.nanocad.ru/index.php%3Fshowtopic%3D7155%26pid%3D36925%26st%3D0%26">how to run NanoCAD 5.1 under Wine 1.4</a> . <br><br>  <i>Unfortunately, I stumbled upon this material after I finally lost my enthusiasm, so if someone starts up properly after following this instruction, share in the comments.</i> <br><br>  And I will tell you what happened with me. <br><br><ol><li>  I started by installing Wine from the Mint distribution, and there was version 1.6, it ended up with what was said in the above two tips from the articles.  Incorrect icon colors and problems with some buttons.  Actually, as it turned out, this could have been stopped, because I did not achieve much better results, but in the end I decided to put PlayOnLinux and continue to ‚Äúrevive Frankenstein‚Äù. </li><li>  For starters, I tried version 1.4.1, in which everything should work, and I suspect that it would really work fine, but there is one problem - I just could not install .NET Framework 3.5 (and .NET Framework 3 also ).  I tried a lot of things, but as a rule, during the installation process, an error always took off in different places. <br><br>  NET Framework 2 is an extreme version that you managed to deliver (the 4th version does not count), with this version of the NanoCAD framework, it even starts to load and, if lucky, will load a large part.  Only libraries will not work, primarily those related to the API (which does not suit us). <br><br><img src="https://habrastorage.org/webt/oq/5o/w-/oq5ow-rdg_v6bcabtipcg30v_a0.png"><br><br>  The screenshot shows that it is possible to draw and that all colors are displayed correctly, but unfortunately the Netload command does not work, which means that our library will not be loaded in the future, so we go ahead. </li><li>  Then I tried a bunch of versions of Wine under PlayOnLinux: 1.3.X, 1.5.X, 2.1, even <a href="http://etersoft.ru/products/wine/local">WINE @ Etersoft</a> tried, everywhere there were problems with the installation.  NET Framework 3.5. </li><li>  As a result, I settled on the latest version of Wine available to me in PlayOnLinux - 2.2, under it, by some miracle.  NET Framework got up, NanoCAD started up completely, though the colors are still problems.  Screenshots of what it looks like later. </li><li>  The other required prerequisite of Microsoft Visual C ++ 2008 SP1 Redistributable Package (x86), is almost always installed without problems (you can directly the one that comes with the program).  Also do not forget to install the development package (SDK) during the installation of NanoCAD <br>  Sometimes when installing knocks master registration.  I have had cases when direct on-line registration failed, then you can take a license file from an already installed version, for example, under a full-featured Windows (in the ProgramData \ Nanosoft \ RegWizard \ Licenses folder) and feed it to the license master. </li></ol><br>  I also tried to put NanoCAD 8.5 under Wine, it is different from NC 5.1, it already requires NET Framework 4, and there are fewer problems with it, but there I am stuck on installing the LocalDB prerequisite (apparently server components from MS).  If someone can run, please share in the comments. <br><br>  <b>UPD (12/29/17):</b> <br>  As it turned out the 32-bit version of NanoCAD 8.5 It is put and even works!  Albeit with brakes. <br>  You just need to install Microsoft Visual C ++ Redistributable Package 2008 and 2012, as well as .NET Framework 4.0 <br>  If during the installation you swear that you cannot find Visual C ++, then at the beginning click ‚ÄúOK‚Äù, then ‚Äúcancel‚Äù and continue the installation without them. <br><br><a name="III"></a><br><h2>  Part III: we collect the project in MonoDevelop </h2><br>  Having received a more or less workable version of NanoCAD to test our code, we will immediately try to check whether we can rebuild and run a previously written in C # and the assembled <a href="https://habrahabr.ru/post/343772/">library with a pseudo-three-dimensional door</a> in Linux. <br><br>  To build the project, I chose <a href="http://www.monodevelop.com/download/">MonoDevelop</a> (for Windows users, it may be known as Xamarin Studio). <br><br>  I did not come across it in its pure form (only as part of Unity) and was pleasantly surprised at what looks like everything we need in MonoDevelop. <br><br>  We open the project already created in MS Visual Studio and try to rebuild. <br><br>  The full code of the class, so that you do not need to search for anything in other articles, I will hide under the spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">Full code for door under NC 5.1</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Version 1.1 //Use Microsoft .NET Framework 3.5 and old version of MultiCad.NET (for NC 5.1) //Class for demonstrating the capabilities of MultiCad.NET //Assembly for the Nanocad 5.1 //Link mapimgd.dll from Nanocad SDK //Link System.Windows.Forms and System.Drawing //upd: for version 1.1 also link .NET API: hostdbmg.dll, hostmgd.dll //The commands: draws a pseudo 3D door. //This code in the part of non-infringing rights Nanosoft can be used and distributed in any accessible ways. //For the consequences of the code application, the developer is not responsible. // V 1.0. More detailed - https://habrahabr.ru/post/342680/ // V 1.1. More detailed - https://habrahabr.ru/post/343772/ // PS A big thanks to Alexander Vologodsky for help in developing a method for pivoting object. using System; using System.ComponentModel; using System.Windows.Forms; using Multicad.Runtime; using Multicad.DatabaseServices; using Multicad.Geometry; using Multicad.CustomObjectBase; using Multicad; //added in V 1.1. for monitoring using System.Security.Permissions; using System.IO; using Multicad.AplicationServices; using HostMgd.ApplicationServices; using HostMgd.EditorInput; namespace nanodoor2 { //change "8b0986c0-4163-42a4-b005-187111b499d7" for your Guid from Assembly. // Be careful GUID for door and wall classes must be different! // Otherwise there will be problems with saving and moving [CustomEntity(typeof(DoorPseudo3D_nc51), "b4edac1f-7978-483f-91b1-10503d20735b", "DoorPseudo3D_nc51", "DoorPseudo3D_nc51 Sample Entity")] [Serializable] public class DoorPseudo3D_nc51 : McCustomBase { // First and second vertices of the box private Point3d _pnt1 = new Point3d(0, 0, 0); private double _scale = 1000; private double _h = 2085; private Vector3d _vecStraightDirection = new Vector3d(1, 0, 0); private Vector3d _vecDirectionClosed = new Vector3d(1, 0, 0); public enum Status {closed , middle, open}; private Status _dStatus = Status.closed; //added in V 1.1. (monitor fileds) public enum Mon { off, on}; private Mon _monitor = Mon.off; private string _monFilePath = @"E:\test.txt"; // if it is serialized, you may not be able to copy the object in the CAD editor [NonSerialized] private FileSystemWatcher _watcher; [NonSerialized] private FileSystemEventHandler _watchHandler; [CommandMethod("DrawDoor", CommandFlags.NoCheck | CommandFlags.NoPrefix)] public void DrawDoor() { DoorPseudo3D_nc51 door = new DoorPseudo3D_nc51(); door.PlaceObject(); this.TryModify(); // this.Monitor = false; } public override void OnDraw(GeometryBuilder dc) { dc.Clear(); // Define the basic points for drawing Point3d pnt1 = new Point3d(0, 0, 0); Point3d pnt2 = new Point3d(pnt1.X + (984 * _scale), pnt1.Y, 0); Point3d pnt3 = new Point3d(pnt2.X + 0, pnt1.Y+(50 * _scale), 0); Point3d pnt4 = new Point3d(pnt1.X , pnt3.Y, 0) ; // Set the color to ByObject value dc.Color = McDbEntity.ByObject; Vector3d hvec = new Vector3d(0, 0, _h * _scale) ; // Draw the upper and lower sides dc.DrawPolyline(new Point3d[] { pnt1, pnt2, pnt3, pnt4, pnt1 }); dc.DrawPolyline(new Point3d[] { pnt1.Add(hvec), pnt2.Add(hvec), pnt3.Add(hvec), pnt4.Add(hvec), pnt1.Add(hvec)}); // Draw the edges dc.DrawLine(pnt1, pnt1.Add(hvec)); dc.DrawLine(pnt2, pnt2.Add(hvec)); dc.DrawLine(pnt3, pnt3.Add(hvec)); dc.DrawLine(pnt4, pnt4.Add(hvec)); // Drawing a Door Handle dc.DrawLine(pnt2.Add(new Vector3d( -190 * _scale, -0, _h*0.45 * _scale)), pnt2.Add(new Vector3d(-100 * _scale, 0, _h * 0.45 * _scale))); dc.DrawLine(pnt3.Add(new Vector3d(-190 * _scale, 0, _h * 0.45 * _scale)), pnt3.Add(new Vector3d(-100 * _scale, 0, _h * 0.45 * _scale))); } public override hresult PlaceObject(PlaceFlags lInsertType) { InputJig jig = new InputJig(); // Get the first box point from the jig InputResult res = jig.GetPoint("Select first point:"); if (res.Result != InputResult.ResultCode.Normal) return hresult.e_Fail; _pnt1 = res.Point; Stat = Status.closed; // Add the object to the database DbEntity.AddToCurrentDocument(); // added in v.1. return hresult.s_Ok; } /// &lt;summary&gt; /// Method for changing the object's SC (the graph is built at the origin of coordinates). /// &lt;/ summary&gt; /// &lt;param name = "tfm"&gt; The matrix for changing the position of the object. &lt;/ param&gt; /// &lt;returns&gt; True - if the matrix is passed, False - if not. &lt;/ returns&gt; public override bool GetECS(out Matrix3d tfm) { // Create a matrix that transforms the object. // The object is drawn in coordinates(0.0), then it is transformed with the help of this matrix. tfm = Matrix3d.Displacement(this._pnt1.GetAsVector()) * Matrix3d.Rotation (-this._vecStraightDirection.GetAngleTo(Vector3d.XAxis, Vector3d.ZAxis), Vector3d.ZAxis, Point3d.Origin); return true; } public override void OnTransform(Matrix3d tfm) { // To be able to cancel(Undo) McUndoPoint undo = new McUndoPoint(); undo.Start(); // Get the coordinates of the base point and the rotation vector this.TryModify(); this._pnt1 = this._pnt1.TransformBy(tfm); this.TryModify(); this._vecStraightDirection = this._vecStraightDirection.TransformBy(tfm); // We move the door only when it is closed if not - undo if (_dStatus == Status.closed) _vecDirectionClosed = _vecStraightDirection; else { MessageBox.Show("Please transform only closed door (when its status = 0)"); undo.Undo(); } undo.Stop(); } //Define the custom properties of the object [DisplayName("Height")] [Description("Height of door")] [Category("Door options")] public double HDoor { get { return _h; } set { //Save Undo state and set the object status to "Changed" if (!TryModify()) return; _h = value; } } [DisplayName("DScale")] [Description("Door Scale")] [Category("Door options")] public double DScale { get { return _scale; } set { if (!TryModify()) return; _scale = value; } } [DisplayName("Door status")] [Description("0-closed, 1-midle, 2-open")] [Category("Door options")] public Status Stat { get { return _dStatus; } set { //Save Undo state and set the object status to "Changed" if (!TryModify()) return; // Change the rotation vector for each of the door states switch (value) { case Status.closed: _vecStraightDirection = _vecDirectionClosed; break; case Status.middle: _vecStraightDirection = _vecDirectionClosed.Add(_vecDirectionClosed.GetPerpendicularVector().Negate() * 0.575) ; break; case Status.open: _vecStraightDirection = _vecDirectionClosed.GetPerpendicularVector()*-1; break; default: break; } _dStatus = value; } } // Create a grip for the base point of the object public override bool GetGripPoints(GripPointsInfo info) { info.AppendGrip(new McSmartGrip&lt;DoorPseudo3D_nc51&gt;(_pnt1, (obj, g, offset) =&gt; { obj.TryModify(); obj._pnt1 += offset; })); return true; } //Define the monitoring custom properties , added v. 1.1: // added in v. 1.1 [DisplayName("Monitoring")] [Description("Monitoring of file for door")] [Category("Monitoring")] public Mon Monitor { get { return _monitor; } set { //Save Undo state and set the object status to "Changed" if (!TryModify()) return; _monitor = value; if (_monitor==Mon.on) { StartMonitoring(); } else StopMonitoring(); } } // added in v. 1.1 [DisplayName("File path for Monitoring")] [Description("Monitoring of file for door")] [Category("Monitoring")] public string MonitoringFilPath { get { return _monFilePath; } set { // Get the command line editor DocumentCollection dm = HostMgd.ApplicationServices.Application.DocumentManager; Editor ed = dm.MdiActiveDocument.Editor; //for hot change filename if (Monitor==Mon.on) { StopMonitoring(); if (!TryModify()) return; _monFilePath = value; StartMonitoring(); ed.WriteMessage("Monitored file is changed"); } else { //Save Undo state and set the object status to "Changed" if (!TryModify()) return; _monFilePath = value; } } } //Define the methods, added v. 1.1: // added in v. 1.1 [PermissionSet(SecurityAction.Demand, Name = "FullTrust")] public void StartMonitoring() { DocumentCollection dm = HostMgd.ApplicationServices.Application.DocumentManager; Editor ed = dm.MdiActiveDocument.Editor; _watcher = new FileSystemWatcher(); if (File.Exists(_monFilePath)) { _watcher.Path = Path.GetDirectoryName(_monFilePath); _watcher.Filter = Path.GetFileName(_monFilePath); _watchHandler = new FileSystemEventHandler(OnChanged); _watcher.Changed += _watchHandler; _watcher.EnableRaisingEvents = true; } else ed.WriteMessage("File: " + _monFilePath + " " + "not Exists"); } // added in v. 1.1 public void StopMonitoring() { if (_watcher != null &amp; _watchHandler != null) { _watcher.Changed -= _watchHandler; _watcher.EnableRaisingEvents = false; } } // added in v. 1.1 private void OnChanged(object source, FileSystemEventArgs e) { DocumentCollection dm = HostMgd.ApplicationServices.Application.DocumentManager; Editor ed = dm.MdiActiveDocument.Editor; ed.WriteMessage("File: " + e.FullPath + " " + e.ChangeType); //read new value from file try { if (File.Exists(_monFilePath)) { int mStatus = -1; ed.WriteMessage("File exists "); using (StreamReader sr = new StreamReader(new FileStream(_monFilePath, FileMode.Open, FileAccess.Read, FileShare.ReadWrite))) { if (sr.BaseStream.CanRead) { if (int.TryParse(sr.ReadLine(), out mStatus)) { if (Enum.IsDefined(typeof(Status), mStatus)) { if (!TryModify()) return; Stat = (Status)mStatus; //  if (!TryModify()) return; DbEntity.Update(); McContext.ExecuteCommand("REGENALL"); ed.WriteMessage("Door state is changed"); } else ed.WriteMessage("Incorrect data in the file. Should be in diapason: 0, 1, 2 "); } } else ed.WriteMessage("Can't read file "); } } else ed.WriteMessage("File not exists "); _watcher.EnableRaisingEvents = false; // disable tracking } finally { _watcher.EnableRaisingEvents = true; // reconnect tracking } } } // </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> There are many shortcomings in this code. // Including failures when working with copying, moving objects and saving files, you can improve it if you want. }</span></span></code> </pre> <br></div></div><br><img src="https://habrastorage.org/webt/kr/l0/cs/krl0csw0vlirpdjzs-tck5f5lge.png"><br><br>  As you can see the build is successful.  Open NanoCAD, open the previously created .dwg file with the door and the sheep (posted on <a href="https://github.com/bosonbeard/Funny-models-and-scripts/tree/master/7.Pseudo_3D_for_NanoCAD">GitHub</a> ). <br><br><img src="https://habrastorage.org/webt/du/sy/6r/dusy6rwx77hlcfplthjmk4puzaw.png"><br><br>  As you can see everything opens.  And even intentionally included in the code error warning made on the basis of Windows Forms opens correctly (although it looks crooked). <br><br><img src="https://habrastorage.org/webt/tm/7q/8a/tm7q8aaqt_p1ib3dr6n7tauns8m.png"><br><br>  Once everything works, let's try to collect, something new and very very primitive, purely for educational purposes.  But first, prepare yourself the tools. <br><br>  In one of the articles I briefly described the process of creating a <a href="https://habrahabr.ru/post/342680/">project for NanoCAD 5.1 in MS Visual Studio</a> , in this I offer you the same brief instruction, only for MonoDevelop under Linux: <br><br><ol><li>  Open the IDE and in the File menu, select the item to create a new solution (project). </li><li>  In the new window, select the type - class library C # <br><br><img src="https://habrastorage.org/webt/s0/mo/xi/s0moxi2_qfi4yhh0rqutl766inw.png"></li><li>  We give him some name. <br><br><img src="https://habrastorage.org/webt/yo/jb/zl/yojbzlzj2ehb4mvbs1nsz-ignha.png"></li><li>  Connect the libraries MultiCAD.NET, you need to look for them in the Mint folder, in which the virtual disk of our Wine system is organized.  The SDK is usually placed in the same folder as the NanoCAD, the plug-in libraries are in the include folder.  For this project, we only have enough mapimgd.dll. <br><br><img src="https://habrastorage.org/webt/hs/bd/se/hsbdsezvf5atb0ja9w598nqcexg.png"></li><li>  Be sure to uncheck the "copy locally" option. <br><img src="https://habrastorage.org/webt/kq/ar/4e/kqar4e8yrb9copmwsk4yg2anvli.png"></li><li>  Then, by clicking RMB on the project name in the object inspector, select the options item and set the .NET Framework 3.5 as the final platform, as in the picture. <br><br><img src="https://habrastorage.org/webt/sj/kl/66/sjkl66edjv_kifo9li01hb7i77u.png"></li><li>  Then you can write code and collect code with the Build command (F8).  Then we will find our library in the debug folder of the project and copy it to the virtual drive ‚ÄúC‚Äù or to any other place where Wine has access. It is important that NanoCAD can see your .dll through its open file dialog. </li></ol><br><a name="IV"></a><h2>  Part IV: the birth of a penguin </h2><br>  You and I have so successfully set everything up, let's write something already.  I decided to offer you a very unpretentious code, so that it runs exactly without problems. <br><br>  Under the spoiler there is a code hiding, which draws us my ‚Äúhighly artistic vision‚Äù of the penguin.  The class contains only the ‚ÄúDping‚Äù command, which draws simple geometric objects and displays text. <br><br><div class="spoiler">  <b class="spoiler_title">Full code for NC 5.1 in C #</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Multicad.Runtime; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Multicad.DatabaseServices; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Multicad.Geometry; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Multicad.DatabaseServices.StandardObjects; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">nano</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">penguin</span></span> { [CommandMethod(<span class="hljs-string"><span class="hljs-string">"DPing"</span></span>, CommandFlags.NoCheck | CommandFlags.NoPrefix)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DrawFace</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { DbCircle body = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DbCircle(); body.Center = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); body.Radius = <span class="hljs-number"><span class="hljs-number">105</span></span>; body.DbEntity.AddToCurrentDocument(); DbCircle eye1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DbCircle(); eye1.Center = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">255</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); eye1.Radius = <span class="hljs-number"><span class="hljs-number">8</span></span>; eye1.DbEntity.AddToCurrentDocument(); DbCircle pupil1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DbCircle(); pupil1.Center = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">148</span></span>, <span class="hljs-number"><span class="hljs-number">254</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); pupil1.Radius = <span class="hljs-number"><span class="hljs-number">2</span></span>; pupil1.DbEntity.AddToCurrentDocument(); DbCircle eye2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DbCircle(); eye2.Center = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">250</span></span>, <span class="hljs-number"><span class="hljs-number">260</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); eye2.Radius = <span class="hljs-number"><span class="hljs-number">8</span></span>; eye2.DbEntity.AddToCurrentDocument(); DbCircle pupil2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DbCircle(); pupil2.Center = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">252</span></span>, <span class="hljs-number"><span class="hljs-number">258</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); pupil2.Radius = <span class="hljs-number"><span class="hljs-number">2</span></span>; pupil2.DbEntity.AddToCurrentDocument(); DbLine hand1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DbLine(); hand1.StartPoint = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">102</span></span>, <span class="hljs-number"><span class="hljs-number">239</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); hand1.EndPoint = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">72</span></span>, <span class="hljs-number"><span class="hljs-number">183</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); hand1.DbEntity.AddToCurrentDocument(); DbLine hand2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DbLine(); hand2.StartPoint = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">298</span></span>, <span class="hljs-number"><span class="hljs-number">236</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); hand2.EndPoint = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">325</span></span>, <span class="hljs-number"><span class="hljs-number">192</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); hand2.DbEntity.AddToCurrentDocument(); DbPolyline nose = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DbPolyline(); List&lt;Point3d&gt; nosePoints = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Point3d&gt;() { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">171</span></span>, <span class="hljs-number"><span class="hljs-number">222</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">198</span></span>, <span class="hljs-number"><span class="hljs-number">177</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">231</span></span>, <span class="hljs-number"><span class="hljs-number">222</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) }; nose.Polyline = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Polyline3d(nosePoints); nose.Polyline.SetClosed(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); nose.DbEntity.Transform(McDocumentsManager.GetActiveDoc().UCS); <span class="hljs-comment"><span class="hljs-comment">//change coordinates from UCS to WCS for BD nose.DbEntity.AddToCurrentDocument(); DbText spech = new DbText(); spech.Text = new TextGeom("Hello Habr!", new Point3d(310, 55, 0), Vector3d.XAxis, "Standard", 25); spech.DbEntity.AddToCurrentDocument(); } } }</span></span></code> </pre><br></div></div><br><br>  <b>UPD (12/29/17):</b> The code successfully without any problems (well, maybe with a few corrections of pluggable namespaces) will also compile for NC 8.5 if you connect libraries from its SDK, <s>but we won't be able to test it in Linux, because I said before NC 8.5 I didn‚Äôt take off at all under Wine</s> .  We can in the 32-bit version of NC 8.5. <br><br>  By the way, our compiled library, then without problems will open in version NC 5.1 running directly under Windows (which is obvious in principle). <br><br>  So, we transfer our library to the ‚ÄúC:‚Äù drive, open NanoCAD, enter the Netload command, select our library (I have ping.dll), and enjoy the spectacle. <br><br><img src="https://habrastorage.org/webt/qx/2x/8f/qx2x8fdowq6mcvucltg9f9cyscy.png"><br><br>  As you can see under Wine 2.2, for unknown reasons, in the settings of NanoCAD, options related to the assignment of color (instead of the color value - a cross) are muted; I could not solve this problem.  But otherwise the files seem to open, the print dialog works, simple objects are drawn, and the more I have not tested. <br><br>  Well, in order to make sure that everything is completely cross-platform with you, we will launch our penguin library in NC 5.1 under Windows. <br><br><img src="https://habrastorage.org/webt/mn/3m/-t/mn3m-tliv3vp9d3eisdwtdrio58.png"><br><br>  <b>UPD (12/29/17):</b> As already mentioned in the piece of the article added above, I managed to run the x86 version of NanoCAD 8.5 under Wine, so catch the penguin from it as well. <br><br><img src="https://habrastorage.org/webt/zl/63/z2/zl63z2nlnhqvru9zb_2sbkooe9g.png"><br><br>  To summarize: it seems that at first glance it is quite possible to directly program in C # for NC 5.1 using the MultiCAD.NET API in Linux, but testing your code is no longer so comfortable. <br><br>  I understand almost nothing in all issues related to Linux, but it seems to me that it is technically possible to create a container, package the correct version of Wine in it, install an inactivated NC 5.1 there, provide some way for the container with Wine to access external disks, and all happiness <br><br>  Unfortunately, I‚Äôll not be able to crank it on my own for the foreseeable future, so I‚Äôll have to wait and hope for experienced caring users or NanoCad developers. <br><br>  But if suddenly one day for myself, something happens, I will definitely share this with you.  All success and good week! </div><p>Source: <a href="https://habr.com/ru/post/344884/">https://habr.com/ru/post/344884/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../344868/index.html">Go there, I do not know where: in the wake of the conference SmartData</a></li>
<li><a href="../344872/index.html">RFC for wimps or the story of a single investigation</a></li>
<li><a href="../344876/index.html">JUnit logging tests</a></li>
<li><a href="../344878/index.html">Making responsive HTML by adding one line to CSS</a></li>
<li><a href="../344882/index.html">Changes in 3CX audio conferencing</a></li>
<li><a href="../344886/index.html">Dagger 2 for novice Android developers. Dagger 2. Part 2</a></li>
<li><a href="../344888/index.html">Convolution network in python. Part 3. Application of the model</a></li>
<li><a href="../344890/index.html">Function, script and event approximation</a></li>
<li><a href="../344892/index.html">Useful to the designer: free new items to optimize design processes. 2nd Edition</a></li>
<li><a href="../344894/index.html">Legal aspects of operations with cryptocurrencies for residents of the Russian Federation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>