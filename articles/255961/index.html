<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to distinguish day from night if you are Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr. 
 Today we will talk about how great it is to read in the dark. In childhood, all of us were forbidden to mothers from doing this, but now t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to distinguish day from night if you are Android</h1><div class="post__text post__text-html js-mediator-article"><h4>  Hi, Habr. </h4><br>  Today we will talk about how great it is to read in the dark.  In childhood, all of us were forbidden to mothers from doing this, but now there are tablets!  Unlike paper books, they do not need to shine a flashlight, they will do everything for you.  And that is what we teach them.  But first things first. <br><br><img src="https://habrastorage.org/files/fef/a0b/f7d/fefa0bf7d8954cf2b19094262875e0cb.PNG"><br><a name="habracut"></a><br><br>  In one of the mobile applications for Android, which we developed, there is a screen for reading news.  For the convenience of users, we have provided in it two display modes - day and night.  It's simple: if the device ‚Äúknows‚Äù what the day is (or just light), the usual screen works, with black font on white.  If it understands that the user is in the dark, he suggests that he switch to night mode ‚Äî a white font and a black screen. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/2a7/353/8b2/2a73538b24ed4ac89c84b315a225d4be.png"><img src="https://habrastorage.org/files/c25/32e/4db/c2532e4db9f542a8a4d12ad638d61818.png"><br><br>  The most important thing is to prompt the user to make the switch.  For this, it is necessary to determine whether the day is now or the night using the device sensor. <br><br>  Working with any sensor in Android comes down to the following steps: <br>  1. Access the <a href="http://developer.android.com/reference/android/hardware/SensorManager.html">SensorManager</a> . <br>  2. Get access to the desired sensor. <br>  3. Register a listener using a common interface for all sensors. <br><br>  An example of working with SensorManager: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SensorActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SensorEventListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SensorManager sensorManager; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Sensor lightSensor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SensorActivity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ sensorManager = (SensorManager)getSystemService(SENSOR_SERVICE); lightSensor = mSensorManager.getDefaultSensor(Sensor.TYPE_LIGHT); <span class="hljs-comment"><span class="hljs-comment">//  } protected void onResume() { super.onResume(); sensorManager.registerListener(this, lightSensor, SensorManager.SENSOR_DELAY_NORMAL); //   } protected void onPause() { super.onPause(); sensorManager.unregisterListener(this); //   } public void onAccuracyChanged(Sensor sensor, int accuracy) { } public void onSensorChanged(SensorEvent event) { //   SensorEvent } }</span></span></code> </pre> <br><br>  All data from the sensor comes in the array <a href="http//developer.android.com/reference/android/hardware/SensorEvent.html">SensorEvent # values</a> . <br>  According to the documentation, this is what the light sensor sends us: <br><br>  <i>Sensor.TYPE_LIGHT:</i> <i><br></i>  <i>values ‚Äã‚Äã[0]: Ambient light level in SI lux units</i> <br><br>  Only one value - the number of suites. <br><br><h4>  Minute of education </h4><br>  What is a suite?  Well, everything is simple here: a lux is a unit of illumination of a surface of 1m¬≤ with a luminous flux of radiation falling on it equal to 1 lm (lumen).  A lumen is a unit of luminous flux, equal to the luminous flux emitted by a point-like isotropic source, with a luminous intensity equal to one candela, in a solid angle of one steradian.  And steradian is ... But let's just look at the picture: <br><br><img src="https://habrastorage.org/files/ad0/f3c/58a/ad0f3c58a08a4ef1b52e07afe267344a.jpg"><br><br>  (source <a href="">blog.tredz.co.uk/wp-content/uploads/2012/09/light-dia1.jpg</a> ) <br>  If everything is together, then a luxury is such an illumination of a surface of 1 m¬≤, which arises when it is illuminated with such a bulb with a luminous intensity of 1 cd (candela) with such a beam of light the size of 1 steradian. <br>  OK, the number of suites we know, what next?  Next, we will try to find out what level of illumination is typical for daylight and for dark. <br>  By the way, do not try to search in search engines for the keywords "luxury", "day", "night", if you do not want to be aware of the best prices for comfortable hotel rooms :). <br><br>  In the Russian Wiki, you can find a table with <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D1%258E%25D0%25BA%25D1%2581">examples of illumination</a> , in which you can find such useful examples as: <br>  ‚Ä¢ up to 20 - In the sea at a depth of ~ 50 m. <br>  ‚Ä¢ 350 ¬± 150 - Sunrise or Sunset on Venus <br><br><img src="https://habrastorage.org/files/59f/026/a24/59f026a24b7d417293d18485dc2bfe84.PNG"><br><br>  Due to the fact that we are making the application not for the inhabitants of Venus, we will dwell on the value of 50 suites, which corresponds to the light in the living room. <br><br><h4>  The matter of technology </h4><br>  Let's write the LightSensorManager class, which can be ‚Äúturned on‚Äù and ‚Äúoff‚Äù and which will report to us if it has become dark or light. <br><br><div class="spoiler">  <b class="spoiler_title">Lightsensormanager</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LightSensorManager</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SensorEventListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Environment {DAY, NIGHT} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnvironmentChangedListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDayDetected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNightDetected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> THRESHOLD_LUX = <span class="hljs-number"><span class="hljs-number">50</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String TAG = <span class="hljs-string"><span class="hljs-string">"LightSensorManager"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SensorManager sensorManager; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Sensor lightSensor; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EnvironmentChangedListener environmentChangedListener; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Environment currentEnvironment; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LightSensorManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ sensorManager = (SensorManager) context.getSystemService(Context.SENSOR_SERVICE); lightSensor = sensorManager.getDefaultSensor(Sensor.TYPE_LIGHT); <span class="hljs-comment"><span class="hljs-comment">//   } public void enable() { if (lightSensor != null){ sensorManager.registerListener(this, lightSensor, SensorManager.SENSOR_DELAY_NORMAL); } else { Log.w(TAG, "Light sensor in not supported"); } } public void disable() { sensorManager.unregisterListener(this); } public EnvironmentChangedListener getEnvironmentChangedListener() { return environmentChangedListener; } public void setEnvironmentChangedListener(EnvironmentChangedListener environmentChangedListener) { this.environmentChangedListener = environmentChangedListener; } @Override public void onSensorChanged(SensorEvent event) { float luxLevel = event.values[0]; Environment oldEnvironment = currentEnvironment; currentEnvironment = luxLevel &lt; THRESHOLD_LUX ? Environment.NIGHT : Environment.DAY; if (hasChanged(oldEnvironment, currentEnvironment)){ callListener(currentEnvironment); } } @Override public void onAccuracyChanged(Sensor sensor, int accuracy) {} private boolean hasChanged(Environment oldEnvironment, Environment newEnvironment) { return oldEnvironment != newEnvironment; } private void callListener(Environment environment) { if (environmentChangedListener == null || environment == null){ return; } switch (environment) { case DAY: environmentChangedListener.onDayDetected(); break; case NIGHT: environmentChangedListener.onNightDetected(); break; } } }</span></span></code> </pre><br><br></div></div><br>  Now we can add this manager to our Activity, including it in onResume and off in onPause. <br>  You can watch how the light level changes without leaving the room.  Just find the sensor on the device and close it with your finger. <br>  It may happen that the device is in a room with an illumination level approximately equal to our chosen threshold value of 50 lux and, fluctuating, will often cross the threshold value.  This will lead to the fact that our manager will begin very often to inform us about the change of day and night.  We will get rid of this by entering 2 threshold values: upper and lower.  Above the top we will be considered daytime, below the bottom one - at night, and the changes between the thresholds will be ignored. <br><br><div class="spoiler">  <b class="spoiler_title">LightSensorManager with two thresholds</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LightSensorManager</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SensorEventListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Environment {DAY, NIGHT} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnvironmentChangedListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDayDetected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNightDetected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> THRESHOLD_DAY_LUX = <span class="hljs-number"><span class="hljs-number">50</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> THRESHOLD_NIGHT_LUX = <span class="hljs-number"><span class="hljs-number">40</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String TAG = <span class="hljs-string"><span class="hljs-string">"LightSensorManager"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SensorManager sensorManager; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Sensor lightSensor; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EnvironmentChangedListener environmentChangedListener; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Environment currentEnvironment; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LightSensorManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ sensorManager = (SensorManager) context.getSystemService(Context.SENSOR_SERVICE); lightSensor = sensorManager.getDefaultSensor(Sensor.TYPE_LIGHT); <span class="hljs-comment"><span class="hljs-comment">//   } public void enable() { if (lightSensor != null){ sensorManager.registerListener(this, lightSensor, SensorManager.SENSOR_DELAY_NORMAL); } else { Log.w(TAG, "Light sensor in not supported"); } } public void disable() { sensorManager.unregisterListener(this); } public EnvironmentChangedListener getEnvironmentChangedListener() { return environmentChangedListener; } public void setEnvironmentChangedListener(EnvironmentChangedListener environmentChangedListener) { this.environmentChangedListener = environmentChangedListener; } @Override public void onSensorChanged(SensorEvent event) { float luxLevel = event.values[0]; Environment oldEnvironment = currentEnvironment; if (luxLevel &lt; THRESHOLD_NIGHT_LUX){ currentEnvironment = Environment.NIGHT; } else if (luxLevel &gt; THRESHOLD_DAY_LUX){ currentEnvironment = Environment.DAY; } if (hasChanged(oldEnvironment, currentEnvironment)){ callListener(currentEnvironment); } } @Override public void onAccuracyChanged(Sensor sensor, int accuracy) {} private boolean hasChanged(Environment oldEnvironment, Environment newEnvironment) { return oldEnvironment != newEnvironment; } private void callListener(Environment environment) { if (environmentChangedListener == null || environment == null){ return; } switch (environment) { case DAY: environmentChangedListener.onDayDetected(); break; case NIGHT: environmentChangedListener.onNightDetected(); break; } } }</span></span></code> </pre><br><br></div></div><br>  And one more nuance: we can get a false positive with a short-term strong change in the level of illumination.  For example, if the light ‚Äúblinks‚Äù due to a voltage drop or the user will pass at night under a lamppost. <br><br><img src="https://habrastorage.org/files/dc6/e85/338/dc6e853382f9422ba53ec4cd9dd4db20.jpg"><br><br>  We can get rid of this problem if we program a low pass filter (aka low pass filter).  It will smooth out all the sharp and short-term changes in the data from the sensor. <br><br><div class="spoiler">  <b class="spoiler_title">LightSensorManager with low pass filter</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LightSensorManager</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SensorEventListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Environment {DAY, NIGHT} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EnvironmentChangedListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDayDetected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNightDetected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> SMOOTHING = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> THRESHOLD_DAY_LUX = <span class="hljs-number"><span class="hljs-number">50</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> THRESHOLD_NIGHT_LUX = <span class="hljs-number"><span class="hljs-number">40</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String TAG = <span class="hljs-string"><span class="hljs-string">"LightSensorManager"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SensorManager sensorManager; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Sensor lightSensor; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EnvironmentChangedListener environmentChangedListener; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Environment currentEnvironment; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> LowPassFilter lowPassFilter; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LightSensorManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ sensorManager = (SensorManager) context.getSystemService(Context.SENSOR_SERVICE); lightSensor = sensorManager.getDefaultSensor(Sensor.TYPE_LIGHT); lowPassFilter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LowPassFilter(SMOOTHING); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">enable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lightSensor != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ sensorManager.registerListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, lightSensor, SensorManager.SENSOR_DELAY_NORMAL); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Log.w(TAG, <span class="hljs-string"><span class="hljs-string">"Light sensor in not supported"</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ sensorManager.unregisterListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> EnvironmentChangedListener </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getEnvironmentChangedListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> environmentChangedListener; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setEnvironmentChangedListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EnvironmentChangedListener environmentChangedListener)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.environmentChangedListener = environmentChangedListener; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSensorChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SensorEvent event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> luxLevel = event.values[<span class="hljs-number"><span class="hljs-number">0</span></span>]; luxLevel = lowPassFilter.submit(luxLevel); Environment oldEnvironment = currentEnvironment; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (luxLevel &lt; THRESHOLD_NIGHT_LUX){ currentEnvironment = Environment.NIGHT; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (luxLevel &gt; THRESHOLD_DAY_LUX){ currentEnvironment = Environment.DAY; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hasChanged(oldEnvironment, currentEnvironment)){ callListener(currentEnvironment); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAccuracyChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sensor sensor, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> accuracy)</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasChanged</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Environment oldEnvironment, Environment newEnvironment)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> oldEnvironment != newEnvironment; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">callListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Environment environment)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (environmentChangedListener == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> || environment == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (environment) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> DAY: environmentChangedListener.onDayDetected(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> NIGHT: environmentChangedListener.onNightDetected(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LowPassFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> filteredValue; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> smoothing; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> firstTime = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LowPassFilter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> smoothing)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.smoothing = smoothing; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">submit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> newValue)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (firstTime){ filteredValue = newValue; firstTime = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filteredValue; } filteredValue += (newValue - filteredValue) / smoothing; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> filteredValue; } }</code> </pre><br></div></div><br>  By the way, Android developers have kindly added several constants to the <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D1%258E%25D0%25BA%25D1%2581">SensorManager</a> class, related to varying degrees of illumination, for example, <a href="http://developer.android.com/reference/android/hardware/SensorManager.html">SensorManager.LIGHT_CLOUDY</a> or <a href="http://developer.android.com/reference/android/hardware/SensorManager.html">SensorManager.LIGHT_FULLMOON</a> . <br><br>  Well, that's done, the implementation is quite simple.  It's great that under the soulless code there is a connection with physics.  Using the sensors with which the device is equipped, we can make the application more user-friendly and to some extent interactive.  Now you can continue to read without hesitation, regardless of the occurrence of the day or night, arrival in the tunnel or access to the beach. <br>  Moreover, summer is on the way - all run to the beach to read. <br><br><img src="https://habrastorage.org/files/cc1/7c7/6c9/cc17c76c99f446c7b5a96db233e3d790.PNG"></div><p>Source: <a href="https://habr.com/ru/post/255961/">https://habr.com/ru/post/255961/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255949/index.html">Retro style in photographic equipment: where does fashion end and need begin?</a></li>
<li><a href="../255951/index.html">New superblits on java hardcore</a></li>
<li><a href="../255953/index.html">Cross article publisher - what should it be?</a></li>
<li><a href="../255955/index.html">Tablet and domain: unity and struggle of opposites</a></li>
<li><a href="../255957/index.html">PHP and files. News without MySQL with flipping</a></li>
<li><a href="../255963/index.html">Krovi: Big Data - as dream. 6th series. BD (Bolt Data) - Fast Big Data Data</a></li>
<li><a href="../255967/index.html">How it all works: the node of financial trading from the inside</a></li>
<li><a href="../255969/index.html">We start the site on the cloud VPS from Infobox in 10 minutes</a></li>
<li><a href="../255971/index.html">IBM Lotus Domino / Notes Outsourcing</a></li>
<li><a href="../255975/index.html">Our new project on the Russian StartUp Tour 2015</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>