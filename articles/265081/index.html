<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implement StyleCop in MSBuild</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Increasingly, the task of automating different processes within CI. Having picked up with MSBuild, I am becoming more and more convinced that this is ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implement StyleCop in MSBuild</h1><div class="post__text post__text-html js-mediator-article">  Increasingly, the task of automating different processes within CI.  Having picked up with MSBuild, I am becoming more and more convinced that this is a fairly powerful tool.  If desired, they can do a lot of things.  However, neither in RuNet as a whole, nor specifically on Habr√©, I did not find articles on it and decided to fill this gap as much as I had and I had free time. <br>  So today we will cook <br><br><h2>  Stylecop </h2><br><br>  The task: to implement a total forced verification of the code (C #) for compliance with the rules of registration. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Condition: total, forced.  Those.  all code that falls on the assembly must be checked without fail.  In case of detection of violations - build error and forward, refactor. <br><br>  Tools: <a href="http://stylecop.codeplex.com/">StyleCop</a> , MSBuild (TFS or TeamCity - no matter). <br><a name="habracut"></a><br>  So.  We want the code to be run through StyleCop.  We are aware of the laziness and irresponsibility of the developers, so we do not trust client verification.  Those.  VSIX, which is installed from the StyleCop distribution kit, is available at the link above, and allows the studio to simply right-click on the project / solution and do the Run Stylecop, we are not satisfied. <br>  Any StyleCop Checkin Policy is not our way either.  Because they are tied to TFS, moreover as a repository.  Thus, by running Git for TFS, we will already lose these policies.  No, we do not consider (although, purely ideologically, this is the most correct way - the ‚Äúdirty‚Äù code simply should not fall into the repository). <br><br>  So, just do not let the code we can not <sup><b>1</b></sup> .  It remains only to not allow him to gather.  To do this, we have well studied mechanisms for implementation in the MSBuild pipeline.  Fortunately, most of the work has already been done for us - there are all the necessary files in the StyleCop.MSBuild nuget package.  These are the files of the StyleCop itself (the StyleCopTask class that implements the Task for MSBuild we already have is in the StyleCop.dll itself), and the default settings ( <i>StyleCop.Settings</i> ) and, most importantly, the StyleCop.MSBuild.targets.  This last one is what we need most. <br><br><h2>  How are we going to be introduced? </h2><br><br>  For MSBuild, there is a rather convenient extension mechanism via <a href="https://msdn.microsoft.com/en-us/library/92x05xfs.aspx">ImportBefore / After</a> .  In short: <br><blockquote>  If you want to find out what you want to do.  For this purpose, Microsoft.Common.Targets contains the following line at the top of the file. <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Import</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Project</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\$(MSBuildThisFile)\ImportBefore\*"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"'$(ImportByWildcardBeforeMicrosoftCommonTargets)' == 'true' and exists('$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\$(MSBuildThisFile)\ImportBefore')"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br></blockquote><br>  And also import files from <i>ImportAfter automatically</i> .  Those.  for <b>each</b> build, MSBuild imports files that are in <i>$ (MSBuildExtensionsPath) \ $ (MSBuildToolsVersion) \ Microsoft.Common.Targets \ ImportBefore \</i> and ImportAfter.  The difference between them is before or after downloading the file to be collected (sln / csproj / another proj), this is true for ... I'll tell you another time. <br><br>  You can follow the path of the monkey job: download .msi from the stylecop site, install it on the machine where MSBuild is running, put the .targets file in the same place ... <br>  But we have several machines with build agents (previously TFS, now also under TeamCity) and somehow I don‚Äôt want to copy / install with my hands.  God forbid more updates and then spill ... no, thank you. <br><br><h2>  We will automate. </h2><br>  Since we have TFS / TeamCity, we can go to the forehead.  We create a repository with the following file structure: <br><pre> /
 ‚îú [lib]
 ‚îÇ ‚îúmssp7en.dll
 ‚îÇ ‚îúmssp7en.lex
 ‚îÇ ‚îúSettings.StyleCop
 ‚îÇ ‚îúStyleCop.CSharp.dll
 ‚îÇ ‚îúStyleCop.CSharp.Rules.dll
 ‚îÇ tyleStyleCop.dll
 ‚îú [targets]
 ‚îÇ ‚îúStyleCop.MSBuild.Targets
 ‚îîbuild.proj
</pre><br><br><h4>  build.proj </h4><br>  This is just a project file in msbuild format, which will be executed on the agent and perform operations to put the files in the right places. <br><div class="spoiler">  <b class="spoiler_title">Content, say, such</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ToolsVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"4.0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DefaultTargets</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"StyleCopUpdate"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/developer/msbuild/2003"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StyleCopTargetsFolder</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"'$(StyleCopTargetsFolder)' == ''"</span></span></span><span class="hljs-tag">&gt;</span></span>$(MSBuildExtensionsPath)\$(MSBuildToolsVersion)\Microsoft.Common.targets\ImportAfter<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StyleCopTargetsFolder</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StyleCopFolder</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"'$(StyleCopFolder)' == ''"</span></span></span><span class="hljs-tag">&gt;</span></span>$(MSBuildExtensionsPath)\StyleCop<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StyleCopFolder</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"StyleCopUpdate"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DependsOnTargets</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"StyleCopClear"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StyleCopTargets</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(MSBuildThisFileDirectory)targets\ImportAfter\StyleCop*.targets"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StyleCopLibs</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(MSBuildThisFileDirectory)lib\*.*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MakeDir</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Directories</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(StyleCopTargetsFolder)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!Exists('$(StyleCopTargetsFolder)')"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Copy</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DestinationFolder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(StyleCopTargetsFolder)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SourceFiles</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@(StyleCopTargets)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SkipUnchangedFiles</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">OverwriteReadOnlyFiles</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">MakeDir</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Directories</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(StyleCopFolder)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!Exists('$(StyleCopFolder)')"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Copy</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DestinationFolder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(StyleCopFolder)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SourceFiles</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@(StyleCopLibs)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SkipUnchangedFiles</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">OverwriteReadOnlyFiles</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"StyleCopClear"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StyleCopToDelete</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(StyleCopTargetsFolder)\StyleCop*.targets"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StyleCopToDelete</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(StyleCopFolder)\*.*"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Delete</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Files</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@(StyleCopToDelete)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TreatErrorsAsWarnings</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@(StyleCopToDelete) != ''"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><br>  Running msbuild.exe build.proj we get: <br>  0. If there are old files - delete <br>  1. copying files from targets to <i>$ (MSBuildExtensionsPath) \ $ (MSBuildToolsVersion) \ Microsoft.Common.targets \ ImportAfter</i> (depending on the version of MSBuild being launched, it may be something like <i>C: \ Program Files (x86) \ MSBuild \ 14.0 \ Microsoft.Common.Targets \ ImportAfter</i> <br>  2. copy files from lib to $ (MSBuildExtensionsPath) \ StyleCop (for example <i>C: \ Program Files (x86) \ MSBuild \ StyleCop</i> ) <br><br>  We configure a build in TFS / TeamCity, which in the Continuous Integration mode reacts to commits to this repository and makes it so that it is forced to wake up on each agent.  Thus, after making changes, all our agents will be automatically updated to the latest StyleCop / dll / configs.  Milota. <br><br><h2>  Customize StyleCop </h2><br><br>  In StyleCop.MSBuild.targets it is important for us to fix two things. <br>  1. Enable StyleCop.  We find we change false to true: <br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"'$(StyleCopEnabled)' == ''"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StyleCopEnabled</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StyleCopEnabled</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"'$(StyleCopTreatErrorsAsWarnings)' == ''"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StyleCopTreatErrorsAsWarnings</span></span></span><span class="hljs-tag">&gt;</span></span>false<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StyleCopTreatErrorsAsWarnings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  (the second is that the test results fall out in Error, not Warn). <br>  2. Fix the path to StyleCop.dll <br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">UsingTask</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">AssemblyFile</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$(MSBuildExtensionsPath)\StyleCop\StyleCop.dll"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">TaskName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"StyleCopTask"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  and to config <br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Condition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"'$(StyleCopOverrideSettingsFile)' == '' and Exists('$(MSBuildExtensionsPath)\StyleCop\Settings.StyleCop')"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StyleCopOverrideSettingsFile</span></span></span><span class="hljs-tag">&gt;</span></span>$(MSBuildExtensionsPath)\StyleCop\Settings.StyleCop<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StyleCopOverrideSettingsFile</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  There is a nuance here. <br><br><h4>  File Settings.StyleCop </h4><br>  The default StyleCop rules are pretty controversial.  There are a number of both doubtful and simply uncomfortable to us.  To edit this file by hand is inconvenient.  To do this, it's easier to put the same .msi from the site and it will install <i>StyleCopSettingsEditor.exe</i> at the same time - a convenient GUI for editing the list of rules. <br>  The trick is that by default in StyleCop the inheritance of settings is enabled and default ones are taken from the one that you installed from msi (although the entire directory tree is scanned upward in search of a .stylecop file to inherit it automatically too). <br>  So opening a file in your own folder, correcting the rules and saving, you actually save only the <b>differences from the default</b> .  And if you put only this modified file in the repository, then only what is in it will be checked.  The default rules will not be received by StyleCop under MSBuil, because it does not have that default file. <br>  So as not to edit the source file and be able to replace it in case of anything, while saving my modifications, I did this: <br><img src="https://habrastorage.org/files/024/910/d2d/024910d2d9d54c1cbf785b16bf0d4e45.png"><br>  The original Settings.StyleCop file has been renamed to default.StyleCop and placed side by side. <br><br><h4>  What is the result? </h4><br>  We have a forced verification of the code through StyleCop.  Violations are immediately visible in the form of errors in the build log. <br>  We have a mechanism that automatically updates the stylecop on build machines. <br><br>  PS: You can run this ‚Äúmsbuild.exe build.proj‚Äù locally.  Then all the same mistakes will be visible immediately in the studio.  Those.  msbuild imports these ImportBefore / After even when it is run out of the studio.  Without any installation of plug-ins and other things, but right away in the Error List - know yourself click on the list and go where the studio puts the cursor.  Without reading logs from the build server. <br><br>  <sup><b>1</b></sup> .  I honestly tried to write an extension for TFS via ISubscriber, as described <a href="http://almsports.net/tfs-server-side-check-in-policy-for-git-repositories/1025/">here</a> , but I ended up drowning in meager documentation with no tools to publish ( <i>C: \ Program Files \ Microsoft Team Server Server 12.0). \ Application Tier \ Web Services \ bin \ Plugins. Then</i> it‚Äôs ridiculous, it‚Äôs ridiculous), a very obscure and confusing structure of classes / dependencies in this <a href="https://msdn.microsoft.com/en-us/library/microsoft.teamfoundation.git.server(v%3Dvs.120).aspx">Microsoft.TeamFoundation.Git.Server</a> library and even inconsistencies methods with their actions.  And as I imagined that I would have to rebuild this later under TFS2015 - I made a Close solution and went to look for other ways of implementation. </div><p>Source: <a href="https://habr.com/ru/post/265081/">https://habr.com/ru/post/265081/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265069/index.html">Tabrier - collective video greetings</a></li>
<li><a href="../265073/index.html">IBM mainframe as an alternative to the cloud</a></li>
<li><a href="../265075/index.html">IP blacklist do-it-yourself</a></li>
<li><a href="../265077/index.html">Clustering graphs and searching for communities. Part 1: introduction, overview of tools and Hair Spheres</a></li>
<li><a href="../265079/index.html">Implementing V8 Sorted by Google</a></li>
<li><a href="../265083/index.html">How does the search for applications on Google Play. Abstract</a></li>
<li><a href="../265089/index.html">How to choose a dress using the main component method</a></li>
<li><a href="../265091/index.html">Migrating from 3CX v12 Cloud Server to 3CX v14 Virtual PBX Server</a></li>
<li><a href="../265093/index.html">MOOC courses in robotics</a></li>
<li><a href="../265095/index.html">Cycle optimization: blocks needed</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>