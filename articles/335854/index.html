<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The history of the development of machine learning in the LC</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The author of the article is Alexey Malanov, an expert in the development of anti-virus technologies at Kaspersky Lab. 

 I came to Kaspersky Lab as a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The history of the development of machine learning in the LC</h1><div class="post__text post__text-html js-mediator-article">  <i>The author of the article is Alexey Malanov, an expert in the development of anti-virus technologies at Kaspersky Lab.</i> <br><br>  I came to Kaspersky Lab as a fourth year student in 2004.  Then we worked in shifts, at nights, to ensure the maximum speed of response to new threats in the industry.  At that time, many competing companies released updates to the anti-virus databases once a day; round-the-clock work was not so important for them.  We were proud to be able to upgrade to hourly updates. <br><br>  By the way, Evgeny V. Kaspersky himself was sitting in the same office room as other virus analysts.  He "hammered" viruses like everything, just faster.  And he also complained that the PR team constantly pulls him on business trips and does not allow him to work for his own pleasure.  In general, we can safely say that in 2004 machine learning was not used in the analysis and detection of malicious code in Kaspersky Lab. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The speed of my malware analysis was at that time an order of magnitude lower than the pace of work of other analysts, because experience plays a huge role here, and only with time do you begin to ‚Äúrecognize‚Äù the malware family just by looking inside. <br><br><img src="https://habrastorage.org/web/725/03f/56d/72503f56d4f443e79bf864f34a8d0820.png"><br>  <i>The characteristic look of the contents of Backdoor.Win32.Bifrose, the popular backdoor of the time.</i> <br><a name="habracut"></a><br>  Let me remind you that at that moment I was studying at the institute and was engaged in color segmentation of images.  I noticed that the researchers came up with many different methods to search for similar images and constantly worked on improving the approaches, but nothing to search for similar files and even determine the degree of similarity of the two options. <br><br>  <b>Find similar files</b> <br><br>  I decided to try to dig in this direction and in the course of the course work I set myself the following task: the program analyzes the entire collection of malware, then a new file under investigation is sent to it, and it informs what it looks like the most. <br><br>  For this, I presented the executable files as pictures (the brighter the dot, the greater the byte value in the file). <br><br><img src="https://habrastorage.org/web/53f/0d6/92b/53f0d692b8fa44399c572ff55cf09697.png"><br>  <i>spoolsv.exe, version 5.1.2600.2180, eng and Ipconfig.exe, version 5.1.2600.2180, rus</i> <br><br>  Looking at these pictures, even a person who is far from virus analysis is able to distinguish and recognize members of different viral families.  It turns out that this is the right way.  It remains only to formalize it and program it. <br><br>  At first, I tried to do everything ‚Äúaccording to science‚Äù using a <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D1%2581%25D0%25BA%25D1%2580%25D0%25B5%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25B2%25D0%25B5%25D0%25B9%25D0%25B2%25D0%25BB%25D0%25B5%25D1%2582-%25D0%25BF%25D1%2580%25D0%25B5%25D0%25BE%25D0%25B1%25D1%2580%25D0%25B0%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">discrete wavelet transform</a> .  After all, with such a search it seems logical to first take into account the most important thing and then gradually add more details, narrowing the scope of the query and finding the most similar option. <br><br><img src="https://habrastorage.org/web/661/5b4/b83/6615b4b83d4e47b886cc58f204972cc8.png"><br>  <i>An example of the 2D discrete wavelet transform that is used in JPEG2000</i> <br><br>  But after a series of experiments, it turned out that the best approach is the simplest, namely the use of <a href="https://ru.wikipedia.org/wiki/%25D0%259B%25D0%25B8%25D0%25BD%25D0%25B5%25D0%25B9%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25BF%25D0%25BE%25D0%25BB%25D1%258F%25D1%2586%25D0%25B8%25D1%258F">piecewise constant interpolation</a> .  In other words, you just need to split the file into pieces and calculate the average for all bytes in the piece. <br><br><img src="https://habrastorage.org/web/b73/5fd/2f2/b735fd2f244a43558ee9d04dad581034.png"><br>  <i>The process of piecewise constant interpolation reduces the amount of detail and makes it easier to see similar files.</i> <br><br>  And the utility name still remains from a difficult method - DWT (Discrete Wavelet Transform).  Interestingly, in parallel, another of our employees did essentially the same thing.  But in the end, when I showed Evgeny Valentinovich a working program, he praised and said: ‚ÄúUse everything‚Äù. <br><br>  In fact, this method can be considered the first step of the ‚ÄúLaboratory‚Äù to use <a href="https://blog.kaspersky.ru/machine-learning-explained/13605/">machine learning</a> , even if the approach itself was fairly simple by modern standards.  Kaspersky Lab secured its championship with a <a href="http://patents.justia.com/patent/8250655">patent</a> . <br><br>  <b>Find similar files 2.0</b> <br><br>  However, one thing is just to prompt the virus analyst what the known malware resembles the file being examined, and the other is to decide that the file being examined should be detected.  Before this, you need to make sure that the two specific files are really similar.  In other words, for autodetection, you first need to search, and then compare. <br><br>  The task of comparing files was solved by comparing functional strings. <br><br><img src="https://habrastorage.org/web/a28/1a3/5ff/a281a35ff3904bfe9cfe458ec1f70877.png"><br>  <i>String comparison of two copies of Trojan-PSW.Win32.LdPinch.</i>  <i>In the middle of the line, which are in both copies, on the left - the lines that are only in the first, on the right - only in the second</i> <br><br>  If there are more matching lines (and, therefore, the functional) than the differing lines, then the two files are considered similar, and, therefore, you can add detection.  However, at this stage, I was worried that we were looking for a similar file by its binary representation, and we were already checking the lines with other files.  It is the same as first identifying a criminal by a photograph, and only then by checking fingerprints.  Indeed, in our task, we can immediately search by fingerprints.  This will allow not to transfer to the "investigation department" those "suspects" whom the "witnesses" indicated by mistake. <br><br>  However, not everything is so simple.  Then it was necessary to solve also a technical problem.  After all, the files in our virus collection at that time were more than a million.  This is now a million malicious files, our collection systems are raking in three days (and only one clean instance in general, every day, a million arrives).  Then, in 2006, when the trees were small, and the grass was high, even then I wanted the prototype of the solution to work on the employee‚Äôs workstation and look for similar files in seconds.  After all, the industrial solution will need to handle the entire incoming flow of the "Lab". <br><br>  But we will not go into the technical details - we just say that the problem has been solved.  This allowed a 2.5-fold increase in the volume of files processed and detected automatically.  I remember when I fell asleep, I was very worried: ‚ÄúHow is it that we are now hiring professionals to analyze malware, and when we automate the process of operational control, these specialists will be left without work, so what?  We must complete the implementation as soon as possible, until we have hired too many employees! ‚Äù <br><br>  But reality put everything in its place: with the advent of automation, our virus analysts and experts were able to devote much more time to strategic anti-malware and the development of <a href="https://business.kaspersky.ru/multilayered-approach/4541/">advanced technologies</a> . <br><br>  Well, as usual, his championship, Kaspersky Lab, staked out with a <a href="http://www.findpatent.ru/patent/242/2420791.html">patent</a> . <br><br>  <b>Systems approach</b> <br><br>  Pretty quickly, in 2007, it became clear that it was necessary not only to automate the detection and thereby obtain the best reaction rate in the industry, we had to transfer the results to the product side so that the decision was made by the client. <br><br>  The Detection Methods Analysis Group was created inside the anti-virus lab.  Interestingly, at the moment only its head is a virus analyst in the past, the rest of the staff are pure Data Scientists.  They immediately set the task formally, developed similarity criteria, introduced a loss function, and began to use mathematical methods.  In general, they implemented an academic approach.  Pretty soon, the uninitiated did not understand anything in their conversations; I even began to doubt that anything would come out of such a systematic approach, they came up very fundamentally.  I just prefer a different way myself - ‚Äúzababahat prototype on the knee - and it‚Äôs ready.‚Äù  But, despite my cautious skepticism, the team coped with the task. <br><br>  The first approach of our experts was based on decisive trees. <br><br><img src="https://habrastorage.org/web/e46/359/ee2/e46359ee23b24065880478d32678c0c6.png"><br><br>  The principle of operation is reduced to the fact that the mathematical model (namely, an ensemble of decision trees) asks the anti-virus engine questions when analyzing a file: <br><ol><li>  And the file is more than 100 kilobytes? </li><li>  And if so, is the file packed? </li><li>  And if not, then in the file the section names are <a href="https://blog.kaspersky.ru/machine-learning-explained/13605/">human or garbage</a> ? </li><li>  And if yes, then ... and so on. </li></ol><br>  After answering all the questions, the antivirus engine receives the verdict ‚ÄúFile clean / malicious‚Äù from the model.  ‚ÄúHow to build such a cool tree?  - you ask.  ‚ÄúThe principle of operation is understandable, but what exactly should I write at the vertices of the decision tree?‚Äù I will answer this way: an ensemble of trees is built using the gradient boosting algorithm, and this is exactly what the Detection Methods Analysis Group competences are and I would even say, know how teams. <br><br>  The second approach is based on the use of locally stable convolutions. <br><br><br><img src="https://habrastorage.org/web/103/209/29a/10320929aab24e6e9a459a63c5e4ea6e.png"><br>  <i>The multi-colored dots (files) on the left are hashed in the traditional way - hashes have nothing in common;</i>  <i>to the right they are folded into LSH convolution - not very different files get close or identical convolutions</i> <br><br>  Again, the principle is simple, but in order to apply Orthogonal Projection Learning and build a mathematical model, we need the system approach and the best experts. <br><br><img src="https://habrastorage.org/web/c11/14e/48c/c1114e48c88e4cebb756f1d87b6c92bc.png"><br>  <i>Formal statement of the problem of constructing a set of locally stable convolutions</i> <br><br>  You can read more about these two methods <a href="http://media.kaspersky.com/en/business-security/machine-learning-human-expertise.pdf">here</a> and, of course, in the <a href="http://patents.justia.com/patent/20150007319">patent of</a> "Laboratories". <br><br>  <b>Behavioral mathematical model</b> <br><br>  Everything described above relates to static detection.  In other words, the antivirus receives a file at the entrance, the decision on which is made by the mathematical model.  However, machine learning experts agree that no matter how smart the model is, it can always be bypassed by a person if desired.  The fact is that a person is creative, he can look inside, understand how it works, and work on it.  That is why the model should be updated in parts, and the infrastructure should work like a clock for quick response. <br><br>  But there is another approach to solving this problem - dynamic detection.  In this case, the mathematical model can analyze the behavior of the executable file after launch.  It is possible to build and train a model according to the same principles as static detection matmodels, but with certain limitations.  After all, the model must decide not after analyzing the entire file behavior, but after the minimum number of actions (immediately after the start), since these actions can be malicious. <br><br>  Right now, the Detection Methods Analysis Group team is piloting a behavioral model that shows excellent results.  As soon as everything is debugged, the model will be released and delivered as part of the updates to our users. <br><br>  <b>Conclusion</b> <br><br>  I have been working for a long time at Kaspersky Lab and saw with my own eyes how the company developed and went through all the stages of its formation.  Of course, we had both technological breakthroughs and ‚Äústagnant‚Äù times, when it was completely incomprehensible where to go in order to get a qualitative improvement.  It even happened that new technologies contained errors that would inevitably lead to serious false positives if it were not for the multistage protection system.  But one thing has always remained the same: behind every technology and achievements there were always real people, my colleagues.  Perhaps that is why the place at the top of the triangle of our concept HuMachine given to our experts. <br><br><img src="https://habrastorage.org/web/745/83a/8a3/74583a8a36ca4ce39a4310641bea03ba.png"></div><p>Source: <a href="https://habr.com/ru/post/335854/">https://habr.com/ru/post/335854/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../335844/index.html">Automate workflow with the new platform. Part 1. Office. Work with "Incoming Documents"</a></li>
<li><a href="../335846/index.html">Logs as part of the product. How GrayLog Impacted Quality</a></li>
<li><a href="../335848/index.html">MIPSfpga - practical experience</a></li>
<li><a href="../335850/index.html">Taxes on IT-business in Russia</a></li>
<li><a href="../335852/index.html">‚ÄúJava-developers do not realize the problem with profilers‚Äù: Andrey Pangin and Nitsan Vakart about Java profiling</a></li>
<li><a href="../335856/index.html">EntityFramework: (anti) Repository pattern</a></li>
<li><a href="../335858/index.html">Why not rely on user error reports</a></li>
<li><a href="../335866/index.html">Memoization and Currying (Python)</a></li>
<li><a href="../335868/index.html">Redux store: horizontal expansion</a></li>
<li><a href="../335870/index.html">What is DNSBL and how can you not get there</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>