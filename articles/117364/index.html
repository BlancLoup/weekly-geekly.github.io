<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Alternative build environment for the N900</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the moment there is the only official way to compile under the N900 - through Scratchbox. What he did not please me? Yes, that's what. Firstly, it ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Alternative build environment for the N900</h1><div class="post__text post__text-html js-mediator-article">  At the moment there is the only official way to compile under the N900 - through Scratchbox.  What he did not please me?  Yes, that's what.  Firstly, it is <i>only</i> under i386, with all the amusingness arising from this as the need to keep a bunch of 32-bit libraries.  Secondly, it is put against any canons for some reason in / scratchbox, along the way prescribing its modules for binfmt and, getting up other obscene things, destroys the slender structure of the distribution.  Thirdly, there is quite an ancient qemu, which does not give a record compilation speed.  And fourthly, this miracle is put <i>very</i> slowly (I don‚Äôt know where they are hosted, but the installer has been downloading half a pack of packages for quite a long time. By the way, it also weighs pretty well in the installed form. And the SDK is still on top. <br>  Well, the most important thing.  qemu-user <i>does not support the</i> entire set of kernel system calls.  And, therefore, part of the software (in particular, mono), corny will not work.  The problem could be solved by chrooting to the environment from the arm system in full emulation mode, but see point one. <br>  In general, the poor part is, I don‚Äôt even know who had raised his hand to use it in a serious project. <br><br>  In theory, you can still compile directly on the device.  But here the problem is that there is a busybox, with which the same dpkg-buildpackage is very bad friends.  Accordingly, when transferring rootfs c devices and attempts to use it, these rakes do not disappear anywhere.  And to replace it with coreutils is not so easy, because it will break a part of dependencies and half the system will fall off. <br><br><img src="https://habrastorage.org/storage/habraeffect/04/a0/04a0d18b51a72330561804b5a4dd3e2a.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And what to do?  And we will go the other way.  Let's pose as ardent followers of Baron Munchhausen and, in the best traditions of the bootstrap procedure (raising oneself by the shoelace), install the system from scratch from the packages.  How exactly, read under the cut. <br><a name="habracut"></a><br>  Actually, it is necessary to get hold of and make the heart of any Debian-based distribution kit work - the APT package management system.  And then with the help of apt-get you can install everything else.  But for his work dpkg is needed.  And dpkg needs at least some basic environment to start.  Generally speaking, in normal distractions, debootstrap does the rough work to create it, but we do not have scripts for it for Maemo.  So the easiest way to do this is with your hands. <br><br>  To get started, you need this very dpkg installed in the main system.  If you do not have something based on debian, then you should not worry, dpkg is in the repositories of almost all distributions.  In addition, we need to somehow chroot into the "guest" system.  For these purposes, there is a qemu-user utility (which, incidentally, mercilessly exploits the scratchbox mentioned above), which, being known to the kernel module binfmt, allows you to run binaries for other architectures directly on the current kernel, emulating a processor and how to broadcast system calls (syscall) .  Everywhere packages are called differently, but we need a file qemu-arm-static and something that it will prescribe where necessary.  In Ubuntu, the required package is called qemu-kvm-extras-static. <br><br>  In addition, we will need to get 8 deb-packages.  libc6, gcc-4.2-base, libgcc1, perl-base, sysv-rc, dpkg, libstdc ++ 6 and apt.  Yes, only 8 packages are needed to raise the system from scratch.  They can be safely deflated by searching maemo.org/packages.  No, I'm lying.  The contents of these packages, as they say, ‚Äúwill not fly up‚Äù in the absence of such basic things as sh, ln, rm, etc.  And they lie in coreutils.  And coreutils is also not put in just like that and wants a bunch of all sorts of differences.  How to be? <br><br>  The aforementioned busybox comes to the rescue.  And the version from Maemo is not interesting for us, it also needs libraries.  Therefore, we stamp on ports.ubuntu.com (well, or with debian.org, you can, as you like) and pull out a package with statically linked bizybox.  It doesn't need anything other than the kernel system call interface.  A thing in itself.  Parse the package using dpkg -x and pull out the desired executable file from there. <br><br>  Well, now we have everything ready and you can proceed. <br><br>  To begin with, we will create a directory for the future system and throw qemu there (since we are going to chroot, it must be inside, otherwise the miracle will not work). <br><br><blockquote>  mkdir -p root / usr / bin <br>  cp / usr / bin / qemu-arm-static root / usr / bin </blockquote><br><br>  Now we throw a copy of the bizybox in / bin.  They will then be overwritten with utilities from coreutils and other packages, but now they are vital. <br><br><blockquote>  mkdir -p root / bin <br>  cp busybox root / bin / sh <br>  cp busybox root / bin / ln <br>  cp busybox root / bin / touch <br>  cp busybox root / bin / chmod <br>  cp busybox root / bin / chown <br>  cp busybox root / bin / cp <br>  cp busybox root / bin / tar <br>  cp busybox root / bin / rm <br>  cp busybox root / bin / gzip <br>  cp busybox root / bin / grep </blockquote><br><br>  Now you need to create a minimal set of directories, without which the main system dpkg can not do anything with the ‚Äúguest‚Äù: <br><br><blockquote>  mkdir root / etc <br>  mkdir -p root / var / lib / dpkg <br>  mkdir root / var / lib / dpkg / tmp.ci <br>  mkdir root / var / lib / dpkg / updates <br>  mkdir root / var / lib / dpkg / info <br>  mkdir -p root / var / log <br>  mkdir -p root / dev / pts <br>  touch root / var / lib / dpkg / status <br>  touch root / var / lib / dpkg / available <br>  touch root / etc / ld.so.conf <br>  mkdir / var / backups <br>  touch /var/backups/infodir.bak </blockquote><br><br>  How to put the packages now?  Yes, just.  Dpkg has a --root option that makes it work, considering the specified directory as the root.  Very useful.  In general, he should swear about non-compliance of architectures (you don‚Äôt have a basic system there?), So let's say --force-architecture <br><br><blockquote>  export DPKG = "dpkg --force-architecture --root = root -i‚Äû <br><br>  $ DPKG packages / libc6_2.5.1-1eglibc27 + 0m5_armel.deb <br>  $ DPKG packages / gcc-4.2-base_4.2.1-4maemo13 + 0m5_armel.deb <br>  $ DPKG packages / libgcc1_4.2.1-4maemo13 + 0m5_armel.deb <br>  $ DPKG packages / perl-base.deb <br>  $ DPKG packages / dpkg_1.14.25maemo3 + 0m5_armel.deb <br>  $ DPKG packages / sysv-rc_2.85-22.osso15_all.deb </blockquote><br><br>  In theory, he should report that everything is successful.  Now we will mount / dev / pts to the guest, because when installing some packages it is needed. <br><br><blockquote>  mount --bind / dev / pts root / dev / pts </blockquote><br><br>  That's it, you can chroot root / bin / sh.  Now we are in the newly created system.  It is still empty and practically nothing works.  Now we need to install apt.  Pit already existing in the system dpkg on the remaining two packages previously copied into it.  Pre-set the locale to C, because we don‚Äôt have a locale here yet. <br><br><blockquote>  export LC_ALL = C <br>  dpkg -i libstdc ++ 6_4.2.1-4maemo13 + 0m5_armel.deb <br>  dpkg -i apt_0.7.20.2maemo13.1 + 0m5_armel.deb <br></blockquote><br><br>  Now we register DNS in resolv.conf.  I usually put 8.8.8.8, but here on the fan.  We also bring sources.list to the following form: <br><br><blockquote>  deb http_: //repository.maemo.org/extras/ fremantle-1.3 free non-free <br>  deb http_: //repository.maemo.org/extras-testing/ fremantle-1.3 free non-free <br>  deb http_: //repository.maemo.org/extras-devel/ fremantle-1.3 free non-free <br>  deb http_: //repository.maemo.org/ fremantle / sdk free non-free <br></blockquote><br><br><blockquote>  apt-get update <br>  apt-get - allow-unauthenticated -y install apt-transport-https coreutils tar build-essential gzip grep bash aptitude libgtk2.0-dev <br>  apt-get clean </blockquote><br><br>  Sit, wait, while apt-get promptly downloads and installs packages.  When asked whether to overwrite resolv.conf, send the forest.  At the output we get a compact (about 200 megabytes, about 60 pumped out of the network in general) environment into which you can chroot and compile there any differences.  And all this without different Scratchboxes curves.  The only thing to take advantage of Xephir'om navryatli, but I somehow closer debugging on the hardware.  If you wish, you can deploy the same system in the i386 variant, the process is no different, but the X server must pick up. <br><br>  After the above steps, you may need to go <a href="http://tablets-dev.nokia.com/eula/index.php">here in</a> order to gain access to proprietary (in particular, OpenGL libs, Qt is not installed without them).  By the way, nokia-binaries and nokia-apps need to be installed via aptitude.  apt-get is not able to resolve dependencies for some reason. <br><br>  I remind you that in the qemu-user mode some set of software does not work.  I strongly recommend using qemu-arm-system, setting it to the image with the normal Linux compiled under ARM, and then from there to chroot.  The image of ubunt can be done here on <a href="https://wiki.ubuntu.com/ARM/RootfsFromScratch">this manual</a> , there is nothing complicated.  But for the usual GCC, qemu-user is more than enough. <br><br>  Thank you for your attention, see you soon. <br><br>  <a href="">Archive with packages and installer script</a> </div><p>Source: <a href="https://habr.com/ru/post/117364/">https://habr.com/ru/post/117364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117357/index.html">The App Store will appear in Windows 8</a></li>
<li><a href="../117359/index.html">Apache Hadoop (Report by Vladimir Klimontovich on ADD-2010)</a></li>
<li><a href="../117360/index.html">Google City Hash Family</a></li>
<li><a href="../117361/index.html">Clodo API Open</a></li>
<li><a href="../117362/index.html">Game boy music</a></li>
<li><a href="../117365/index.html">These countless paradigms, concepts, tools and frameworks</a></li>
<li><a href="../117366/index.html">IT in medicine in the Innovators Club</a></li>
<li><a href="../117367/index.html">What happened to the site of the Skolkovo Foundation in brief</a></li>
<li><a href="../117369/index.html">How to recognize pornography</a></li>
<li><a href="../117370/index.html">Russian Post - statistics, conclusions, suggestions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>