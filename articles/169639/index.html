<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Exception travel between C ++ and Python, or "Back and forth"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this chapter, a tale about friendships between C ++ and Python will have surprisingly little use of Boost.Python. Passing exceptions back and forth...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Exception travel between C ++ and Python, or "Back and forth"</h1><div class="post__text post__text-html js-mediator-article">  In this chapter, a tale about friendships between C ++ and Python will have surprisingly little use of Boost.Python.  Passing exceptions back and forth is essentially a weak point of this library.  We will manage the native API of the Python language, and where it is possible to use Boost.Python. <br>  Nevertheless, Boost.Python creates an environment in which exceptions from C ++ fall into Python as a standard RuntimeError, and back from Python, a C ++ exception of the error_already_set type is generated, which means ‚Äúsomething has flown to you, go see what is there‚Äù.  And here we just need to use the Python C-API to subtract the necessary information about the exception and convert it into the appropriate class according to the logic of the application. <br>  Why such difficulties?  - The fact is that in Python, unlike C ++, besides the exception text and its type, traceback comes as well - the stack to the point where the exception occurred.  Let's extend the standard std :: exception with an additional parameter for this stacktrace, and at the same time we will write an exception converter back and forth from the C ++ classes to the Python exception classes. <br><a name="habracut"></a><br><h4>  In the previous series </h4><br>  <a href="http://habrahabr.ru/post/168083/">1. Boost.Python.</a>  <a href="http://habrahabr.ru/post/168083/">Introduction</a>  <a href="http://habrahabr.ru/post/168083/">C ++ wrappers in Python.</a> <br>  <a href="http://habrahabr.ru/post/168233/">2. Boost.Python.</a>  <a href="http://habrahabr.ru/post/168233/">A wrapper for specific C ++ classes.</a> <br>  <a href="http://habrahabr.ru/post/168827/">3. Boost.Python.</a>  <a href="http://habrahabr.ru/post/168827/">Creating type converters between C ++ and Python.</a> <br><br><h4>  Introduction </h4><br>  Suppose there is a certain hierarchy of exceptions that you need to be one-to-one in the form of the corresponding class in C ++ and in Python when handling the exception.  This is especially true if you combine application logic in C ++ and complex scripting in Python, or if you are writing a module for Python in C ++ with complex logic.  Sooner or later we run into exception handling coming from C ++ in Python or vice versa. <br><br>  Of course, in most cases, you will only need the standard Boost.Python mechanism to convert exceptions from C ++ to Python in the form of a RuntimeException with the text that came from exception :: what ().  On the C ++ side, you need to catch an exception of the <b>error_already_set</b> type and use the native API of the Python language, but you can not only subtract the type and text of the exception, but also the traceback - in fact, the exception history. <br>  But first things first. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Traveling small exceptions from C ++ to Python </h4><br>  So, you wrote a module in C ++ using Boost.Python, hooked it up in Python code via a regular <b>import</b> and use one of the wrappers for functions or methods.  For example, in C ++ code, the most common exception is thrown through an equally ordinary <b>throw</b> .  In Python code, you will get a RuntimeException with text obtained from exception :: what () if this exception is thrown from std :: exception. <br>  If you are satisfied that you get nothing but the exception text, then you can even do nothing more.  However, if you need to catch the exception of a strictly defined class of errors, you will need to work a little. <br><br>  In fact, Boost.Python provides the ability to register your translation of the exception of a module leaving native penats written in C ++.  All you need to do: in the declaration function of the module, call the template function boost :: python :: <b>register_exception_translator</b> &lt;T, F&gt; (F), where T is the exception type in C ++, and F is the function that accepts the reference to the exception of this type and This is a way of doing your duty to pass an exception of the desired type to external code already in Python.  In general, something like this: <br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> exception { ... }; ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate_error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( error </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; )</span></span></span></span>; ... BOOST_PYTHON_MODULE( ... ) { ... register_exception_translator&lt;error&gt;( translate_error ); } ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate_error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( error </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; e )</span></span></span><span class="hljs-function"> </span></span>{ PyErr_SetString( PyExc_Exception, e.what() ); }</code> </pre> <br>  Here we used the standard exception Exception embedded in Python, but you can use absolutely any exception: <a href="http://docs.python.org/3/c-api/exceptions.html%3Fhighlight%3Dpyexc_exception">standard</a> , external connected via import with getting PyObject * via <b>object :: ptr</b> () or even your own one created right there on site via <a href="http://docs.python.org/3/c-api/exceptions.html%3Fhighlight%3Dpyerr_newexception">PyErr_NewException</a> . <br><br>  Let's add for completeness of sensations a couple more classes, which will be given as an analogue of ZeroDivisionError and ValueError and for complete happiness we will inherit them from our error, let's call them respectively zero_division_error and value_error: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> exception { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: error(); error( <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; message ); error( <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; message, <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; details ); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">what</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function">&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function">&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_details</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> m_message; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> m_details; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value_error</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> error { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: value_error(); value_error( <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; message ); value_error( <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; message, <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; details ); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">zero_division_error</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> error { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: zero_division_error(); zero_division_error( <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; message ); zero_division_error( <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; message, <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; details ); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span>; };</code> </pre><br>  We will need the <b>m_details</b> field on the way back from Python to C ++, for example, to save a traceback.  And the type method () will be needed for debugging a bit later.  Simple and clear hierarchy. <br><br>  Register for our exceptions function translators in Python: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate_error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( error </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate_value_error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value_error </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate_zero_division_error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( zero_division_error </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; )</span></span></span></span>; ... BOOST_PYTHON_MODULE( ... ) { ... register_exception_translator&lt;error&gt;( translate_error ); register_exception_translator&lt;value_error&gt;( translate_value_error ); register_exception_translator&lt;zero_division_error&gt;( translate_zero_division_error ); } ... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate_error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( error </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; e )</span></span></span><span class="hljs-function"> </span></span>{ PyErr_SetString( PyExc_Exception, e.what() ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate_value_error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( value_error </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; e )</span></span></span><span class="hljs-function"> </span></span>{ PyErr_SetString( PyExc_ValueError, e.what() ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translate_zero_division_error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( zero_division_error </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; e )</span></span></span><span class="hljs-function"> </span></span>{ PyErr_SetString( PyExc_ZeroDivisionError, e.what() ); }</code> </pre><br>  Great, it remains only to get test functions on the C ++ side, which will throw these exceptions: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">divide</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>( b ) &lt; numeric_limits&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;::epsilon() ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> zero_division_error(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a / b; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_num</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* val )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> res; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !val || !<span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>( val, <span class="hljs-string"><span class="hljs-string">"%LG"</span></span>, &amp;res ) ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> value_error(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> val )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !val ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> error( <span class="hljs-string"><span class="hljs-string">"Test failure."</span></span>, <span class="hljs-string"><span class="hljs-string">"test"</span></span> ); }</code> </pre><br>  Why not, these functions are not worse than any other and throw exactly what we need. <br>  Wrap them up: <br><pre> <code class="cpp hljs">... BOOST_PYTHON_MODULE( python_module ) { register_exception_translator&lt;error&gt;( translate_error ); register_exception_translator&lt;value_error&gt;( translate_value_error ); register_exception_translator&lt;zero_division_error&gt;( translate_zero_division_error ); def( <span class="hljs-string"><span class="hljs-string">"divide"</span></span>, divide, args( <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-string"><span class="hljs-string">"b"</span></span> ) ); def( <span class="hljs-string"><span class="hljs-string">"to_num"</span></span>, to_num, args( <span class="hljs-string"><span class="hljs-string">"val"</span></span> ) ); def( <span class="hljs-string"><span class="hljs-string">"test"</span></span>, test, args( <span class="hljs-string"><span class="hljs-string">"val"</span></span> ) ); } ...</code> </pre><br>  Well, we assemble our module, <b>import python_module</b> , call our functions with the necessary parameters, get the necessary exceptions (script in Python 3.x): <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> python_module <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pm <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: res = pm.divide( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ZeroDivisionError: print( <span class="hljs-string"><span class="hljs-string">"ZeroDivisionError - OK"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: print( <span class="hljs-string"><span class="hljs-string">"Expected ZeroDivisionError, but exception of type '{t}' with text: '{e}'"</span></span>.format(t=type(e),e=e) ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print( <span class="hljs-string"><span class="hljs-string">"Expected ZeroDivisionError, but no exception raised! Result: {r}"</span></span>.format(r=res) ) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: res = pm.to_num( <span class="hljs-string"><span class="hljs-string">'qwe'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError: print( <span class="hljs-string"><span class="hljs-string">"ValueError - OK"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: print( <span class="hljs-string"><span class="hljs-string">"Expected ValueError, but exception of type '{t}' with text: '{e}'"</span></span>.format(t=type(e),e=e) ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print( <span class="hljs-string"><span class="hljs-string">"Expected ValueError, but no exception raised! Result: {r}"</span></span>.format(r=res) ) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: res = pm.test( <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type(e) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> Exception: print( <span class="hljs-string"><span class="hljs-string">"Exception - OK"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print( <span class="hljs-string"><span class="hljs-string">"Exception of type '{t}', expected type 'Exception', message: '{e}'"</span></span>.format(t=type(e),e=e) ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: print( <span class="hljs-string"><span class="hljs-string">"Expected Exception, but no exception raised! Result: {r}"</span></span>.format(r=res) )</code> </pre><br>  Script output: <br>  ZeroDivisionError - OK <br>  ValueError - OK <br>  Exception - OK <br>  So far, so good.  Let's go in the opposite direction. <br><br><h4>  Adventures of our exception on the way from Python to C ++ </h4><br>  Let's separate into a separate project the types of exceptions and test functions and we will build from them a separate dynamic library, the <b>error_types</b> .  We will build the module for Python separately in the <b>python_module</b> project. <br>  And now we will get application on C ++ where we will catch exceptions from Python, we will call it <b>catch_exceptions</b> . <br>  All you need is to connect our module via import ("python_module"), then get access to the module's functions via attr ("divide"), attr ("to_num"), attr ("test").  We will call them, they will raise exceptions at the level of C ++ code, pass into the Python interpreter and forward to the C ++ application, causing the exception <b>error_already_set</b> - the exception of the Boost.Python library prepared just for such cases. <br><br>  By itself, an object of type <b>error_already_set</b> , it is important to just catch the exception.  In general, the handling of such an exception is as follows: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>( error_already_set <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; ) { PyObject *exc, *val, *tb; PyErr_Fetch( &amp;exc, &amp;val, &amp;tb ); PyErr_NormalizeException( &amp;exc, &amp;val, &amp;tb ); handle&lt;&gt; hexc(exc), hval( allow_null( val ) ), htb( allow_null( tb ) ); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> error( extract&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;( !hval ? str( hexc ) : str( hval ) ) ); }</code> </pre><br>  So we will always get the exception of the same type, but at least we can extract the text of the exception.  But we get the exception type in the variable exc, the exception object itself in the val variable, and even the object with the exception stack in the tb variable.  Let's convert the exception to zero_division_error and value_error if ZeroDivisionError or ValueError, respectively, arrived. <br><br>  Stop!  Not everyone understands what these two functions are, why everything is PyObject *, whence exceptions in the C-API, if they are not in C, let's take a look. <br>  Yes, there are no exceptions in pure C, but in Python they exist and its API provides an opportunity to extract information about the exception that occurred.  In Python C-API, all values ‚Äã‚Äãand types, and in general almost everything, is represented as PyObject *, therefore an exception E of type T is a pair of values ‚Äã‚Äãof type PyObject *, we add to this also PyObject * for traceback - the saved stack where the exception occurred . <br>  You can <a href="http://docs.python.org/3/c-api/exceptions.html%3Fhighlight%3Dpyerr_fetch">extract</a> information about an exception that has occurred with the <a href="http://docs.python.org/3/c-api/exceptions.html%3Fhighlight%3Dpyerr_fetch">PyErr_Fetch</a> function, after which the exception information can be normalized (if you don‚Äôt want to work in the internal representation in the form of a tuple) with the <a href="http://docs.python.org/3/c-api/exceptions.html%3Fhighlight%3Dpyerr_fetch">PyErr_NormalizeException</a> function. <br>  After calling a pair of these functions, we will fill in three values ‚Äã‚Äãof the PyObject * type, respectively: exception class, exception instance (object), and stack (traceback) saved at the time the exception was generated. <br><br>  Further, it is much more convenient to work with Boost.Python, wrap PyObject * in boost :: python :: <b>handle</b> &lt;&gt;, which is compatible with any object of the Boost.Python library, we just need boost :: python :: <b>str</b> .  After the conversion to the analogue of the python string in Boost.Python, we can extend the standard native string std :: string of the C ++ language.  If desired, you can extend the usual const char *. <br><br>  With the first two parameters, everything is clear, they are perfectly reduced to a string, but with traceback you will still have to convert to a readable form.  The easiest way to do this is with the <b>traceback</b> module, passing our three parameters to the <b>format_exception</b> function.  The traceback.format_exception (exc, val, tb) function will return an array of strings to us in the form of a standard Python <b>list list</b> , which joins into one large thick string. <br>  On the C ++ side, using Boost.Python, it will look something like this: <br><pre> <code class="cpp hljs"> ... format_exception = <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>( <span class="hljs-string"><span class="hljs-string">"traceback"</span></span> ).attr( <span class="hljs-string"><span class="hljs-string">"format_exception"</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> extract&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;( str( <span class="hljs-string"><span class="hljs-string">""</span></span> ).join( format_exception( exc, val, tb ) ) ); }</code> </pre><br>  You can make an auxiliary function to generate a string from the exception.  The problem, however, is that the import () call in the function each time leads to an expensive call, so the object obtained from import ("traceback") .attr ("format_exception") is best to save the result of the function in a separate object, we also need to save import result ("python_module").  Considering that this will need to be done somewhere between Py_Initialize () and Py_Finalize (), nothing better than singleton fields for storing such variables does not occur. <br><br><h4>  Work with Python API via singleton </h4><br>  So, let's get a singleton, it will complicate the application, but it will simplify the code a bit and allow us to correctly initialize the work with the interpreter, save all auxiliary objects and complete everything correctly: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">python_interpreter</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">divide</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to_num</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">format_error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( handle&lt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp;, handle&lt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp;, handle&lt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; )</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: object m_python_module; object m_format_exception; python_interpreter(); ~python_interpreter(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> python_interpreter&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">instance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">object&amp; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">python_module</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">format_error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( object </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp;, object </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp;, object </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; )</span></span></span></span>; };</code> </pre><br>  The constructor will initialize the work with the interpreter, and the destructor will clean up the saved fields and de-initialize the work with the interpreter. The python_module and format_error methods import the corresponding modules only once: <br><pre> <code class="cpp hljs">python_interpreter::python_interpreter() { Py_Initialize(); } python_interpreter::~python_interpreter() { m_python_module = object(); m_format_exception = object(); Py_Finalize(); } <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> python_interpreter::divide( <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> a, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> b ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> extract&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;( instance().python_module().attr(<span class="hljs-string"><span class="hljs-string">"divide"</span></span>)( a, b ) ); } <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> python_interpreter::to_num( <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; val ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> extract&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;( instance().python_module().attr(<span class="hljs-string"><span class="hljs-string">"to_num"</span></span>)( val ) ); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> python_interpreter::test( <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> val ) { instance().python_module().attr(<span class="hljs-string"><span class="hljs-string">"test"</span></span>)( val ); } <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> python_interpreter::format_error( handle&lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; exc, handle&lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; msg, handle&lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; tb ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance().format_error( object(exc), object(msg), object(tb) ); } python_interpreter&amp; python_interpreter::instance() { <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> python_interpreter single; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> single; } object&amp; python_interpreter::python_module() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( m_python_module.is_none() ) m_python_module = <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>( <span class="hljs-string"><span class="hljs-string">"python_module"</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_python_module; } <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> python_interpreter::format_error( object <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; exc, object <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; val, object <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; tb ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( m_format_exception.is_none() ) m_format_exception = <span class="hljs-keyword"><span class="hljs-keyword">import</span></span>( <span class="hljs-string"><span class="hljs-string">"traceback"</span></span> ).attr( <span class="hljs-string"><span class="hljs-string">"format_exception"</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> extract&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;( str( <span class="hljs-string"><span class="hljs-string">""</span></span> ).join( m_format_exception( exc, val, tb ) ) ); }</code> </pre><br>  So we got a ready-made mechanism, applicable for any C ++ application that uses Python as a powerful auxiliary functionality with a bunch of libraries. <br>  It's time to check our exception mechanism! <br><br><h4>  Checking the mechanism for translating exceptions from Python to C ++ </h4><br>  Let's get an auxiliary function: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rethrow_python_exception</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ PyObject *exc, *val, *tb; PyErr_Fetch( &amp;exc, &amp;val, &amp;tb ); PyErr_NormalizeException( &amp;exc, &amp;val, &amp;tb ); handle&lt;&gt; hexc(exc), hval( allow_null( val ) ), htb( allow_null( tb ) ); <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> message, details; message = extract&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;( !hval ? str( hexc ) : str( hval ) ); details = !tb ? extract&lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt;( str( hexc ) ) : python_interpreter::format_error( hexc, hval, htb ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( PyObject_IsSubclass( exc, PyExc_ZeroDivisionError ) ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> zero_division_error( message, details ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( PyObject_IsSubclass( exc, PyExc_ValueError ) ) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> value_error( message, details ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> error( message, details ); }</code> </pre><br>  Then the exception handling mechanism will be reduced to the following scheme for each method under test, such as for divide: <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { python_interpreter::divide( <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>( error_already_set <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; ) { rethrow_python_exception(); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>( error <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; e ) { output_error( e ); }</code> </pre><br>  Here, output_error is the simplest function that outputs information about the exception, for example, like this: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">output_error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( error </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">&amp; e )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">cerr</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\nError type: "</span></span> &lt;&lt; e.type() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\nMessage: "</span></span> &lt;&lt; e.get_message() &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\nDetails: "</span></span> &lt;&lt; e.get_details() &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; }</code> </pre><br>  This is where we really need the type () virtual method that we have introduced in the error base class. <br><br>  We create similar sections for to_num and for test, and also check what comes up if we just execute the ‚Äú1/0‚Äù line in Python via exec: <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { exec( <span class="hljs-string"><span class="hljs-string">"1 / 0"</span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>( error_already_set <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; ) { rethrow_python_exception(); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>( error <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>&amp; e ) { output_error( e ); }</code> </pre><br>  Running ... <br>  The output should be something like this: <br><br>  Error type: zero_division_error <br>  Message: Division by zero! <br>  Details: &lt;class 'ZeroDivisionError'&gt; <br><br>  Error type: value_error <br>  Message: Inappropriate value! <br>  Details: &lt;class 'ValueError'&gt; <br><br>  Error type: error <br>  Message: Test failure. <br>  Details: &lt;class 'Exception'&gt; <br><br>  Error type: zero_division_error <br>  Message: division by zero <br>  Details: Traceback (most recent call last): <br>  File "", line 1, in ZeroDivisionError: division by zero <br><br><h4>  Epilogue </h4><br>  Total: we received the mechanism of one-to-one conversion of exceptions from Python to C ++ and back. <br>  The minus is noticeable immediately - these are different completely unrelated entities.  This is due to the fact that the C ++ class cannot be inherited from a class from Python, nor is it vice versa.  There is a variant with the ‚Äúencapsulation‚Äù of the required exception class in the wrapper of the C ++ class for Python, but these will still be different classes that are simply converted to the corresponding ones in their own language. <br>  If you have a complicated exception hierarchy in C ++, the easiest way is to get yourself an analogue in Python in a separate .py module, because creating <a href="http://docs.python.org/3/c-api/exceptions.html%3Fhighlight%3Dpyerr_newexception">PyErr_NewException</a> and then storing it somewhere is quite expensive and will not add readability to the code. <br>  I don‚Äôt know about you, but I‚Äôm looking forward to when Boost.Python will get a decent exception translator, or at least an analogue of boost :: python :: bases to inherit the wrapper from the Python class.  In general, Boost.Python is an excellent library, but this aspect adds to the hemorrhoid when parsing exceptions from Python on the C ++ side.  Translation in Python through registration of the register_exception_translator &lt;E, F&gt; (F) translator function looks quite successful and allows you to convert an A type exception to C ++, to a completely different class B on the Python side, but at least automatically. <br>  In principle, it is not necessary to respond to the error_already_set exactly as described above, you can choose for yourself the recipe for the behavior of your application using the <a href="http://docs.python.org/3/c-api/exceptions.html%3Fhighlight%3Dpyerr_newexception">Python API to handle exceptions from Python</a> . <br><br>  Link to the project is <a href="http://www.2shared.com/file/PQ58Qabk/throw2py.html">here (~ 223 KB)</a> .  The MSVS v11 project is configured to build with Boost 1.52 and Python 3.3 x64. <br><br><h4>  useful links </h4><br>  <a href="http://wiki.python.org/moin/boost.python/EmbeddingPython">PyWiki - Extracting C ++ Exceptions</a> <br>  <a href="http://docs.python.org/3/c-api/exceptions.html%3Fhighlight%3Dpyerr_newexception">Exception Handling with Python C-API</a> <br>  <a href="http://www.boost.org/doc/libs/1_43_0/libs/python/doc/v2/exception_translator.html">Register translator exceptions from C ++ to Python</a> </div><p>Source: <a href="https://habr.com/ru/post/169639/">https://habr.com/ru/post/169639/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169619/index.html">Friday story about synchronized methods in the Thread class</a></li>
<li><a href="../169623/index.html">Tracker: real-time management</a></li>
<li><a href="../169629/index.html">Review of the calculator Felix M</a></li>
<li><a href="../169635/index.html">Questions to post Alex Rublev about design</a></li>
<li><a href="../169637/index.html">Amazon began to ship Kindle Paperwhite to Ukraine</a></li>
<li><a href="../169645/index.html">The digest of news from the world of mobile development for the last week ‚Ññ2 (February 10 - 16, 2013)</a></li>
<li><a href="../169647/index.html">3d printer: "Klein bottle" in 82 minutes</a></li>
<li><a href="../169649/index.html">LikeBtn.com - Like Button for a Site</a></li>
<li><a href="../169655/index.html">Google Store brand stores open until the end of the year</a></li>
<li><a href="../169659/index.html">Logic - the most interesting news gaming and IT-industry number 14</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>