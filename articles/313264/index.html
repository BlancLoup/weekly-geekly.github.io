<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to find out the attendance of 3.8 million sites</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It so happened that we at seo11.ru know the traffic of approximately 1 million sites. Data is taken from Liveinternet, Mail, Rambler, Openstat and Hot...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to find out the attendance of 3.8 million sites</h1><div class="post__text post__text-html js-mediator-article">  It so happened that we at seo11.ru know the traffic of approximately 1 million sites.  Data is taken from Liveinternet, Mail, Rambler, Openstat and Hotlog ratings.  But a huge number of sites do not participate in these rankings and prefer to measure attendance on Google Analytics or Yandex.Metrica.  Analytics has no open informers, so it will not work to get data.  And there is a Metric! <br><a name="habracut"></a><br><h3>  Plan </h3><br>  1. We collect base of sites of the RuNet. <br>  2. We look for the Metrics code on them. <br>  3. Check if the Metrics informer is open or not. <br>  4. If open, then parse the picture, recognize and write to the database. <br><br><h3>  Decision </h3><br>  <b>1.</b> First you need to get a list of all sites runet.  The first thought is to bypass <a href="http://statonline.ru/domainlist%3Ftld%3Dru">all domains</a> in the zones ru, su and rf.  However, many Russian-language sites are hosted on international domains.  It would be possible to bypass another Top <a href="https://support.alexa.com/hc/en-us/articles/200449834-Does-Alexa-have-a-list-of-its-top-ranked-websites-">Alexa</a> , Yandex.Catalog and the Russian section of <a href="http://rdf.dmoz.org/">Dmoz</a> , but all this will not give a complete base.  I would have to write a full-fledged crawler, but soberly assessing my resources, I began to look for alternative options. <br><br>  After all, it was not my first need to crawl the sites of the runet.  It was decided to turn to colleagues from <a href="https://www.keys.so/">Keys.so.</a>  They have their own crawler and almost 20 million sites analyzed.  They bypass sites for collecting keywords and other SEO data. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>2.</b> So, there is a base of 20 million sites.  It remains to find the metric code on them.  JS-code counter has several options.  If you search on yandexMetrikaId, then many sites will not be determined.  For example, yandex.ru itself has a metric, but yandexMetrikaId does not find it.  If you search by yaCounter or Ya.Metrik, then many other sites will not be detected, for example dnevnik.ru <br><br>  The most correct thing is to focus on the sequence ‚Äúmc.yandex.ru/watch/‚Äù, for example, ‚Äúmc.yandex.ru/watch/17969140‚Äù.  Accordingly, 17969140 is the site ID.  Thus, Keys.so sees the Metric on 3,846,867 domains. <br><br>  <b>3.</b> Knowing the site ID, you can request a picture of the informer at: <br><br>  <a href="https://informer.yandex.ru/informer/37616330/3_0_FFFFFFFF_FFFFFFFF_0_pageviews">informer.yandex.ru/informer/37616330/3_0_FFFFFFFF_FFFFFFFF_0_pageviews</a> <br><br>  From top to bottom: views, visits, visitors.  If the informer is disabled in the Yandex.Metrica settings, then the picture will look like this: <br><br>  <a href="https://informer.yandex.ru/informer/17969140/3_0_FFFFFFFF_FFFFFFFF_0_pageviews">informer.yandex.ru/informer/17969140/3_0_FFFFFFFF_FFFFFFFF_0_pageviews</a> <br><br>  This informer does not make sense to request and recognize.  It is enough to get the content-length and weed out unnecessary. <br><br>  <b>4.</b> Of the 3.8 million sites, the informer is open to just over 1 million sites.  Parse and recognize will be using NodeJS.  For parsing, I use the <a href="https://www.npmjs.com/package/request">request</a> module to create the <a href="https://www.npmjs.com/package/async">async.queue</a> queue.  I recognize the pictures using the <a href="https://www.npmjs.com/package/okrabyte">okrabyte</a> OCR library. <br><br>  The first problem: data can only be obtained from the informer in 24 hours.  The solution is to download informers at 23:55.  Of course, there will be small discrepancies with real data, but this is better than nothing. <br><br>  The second problem: the informer is reset to 00:00 according to the time zone selected in the counter settings.  How to find out what time zone is selected in the settings?  No  Therefore, you need to parse the informer in advance at intervals every hour and see when it is reset. <br><br>  That's all.  The result of the work is available on <a href="https://seo11.ru/">seo11.ru</a> </div><p>Source: <a href="https://habr.com/ru/post/313264/">https://habr.com/ru/post/313264/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313254/index.html">Category theory on javascript. Part 1. Category of sets</a></li>
<li><a href="../313256/index.html">YML (Yandex Market Language) - Generation of a product file for Yandex Webmaster</a></li>
<li><a href="../313258/index.html">Divide & Conquer over the Strassen algorithm</a></li>
<li><a href="../313260/index.html">According to the players of the IT market, the bill on the regulation of online cinemas will slow down their development</a></li>
<li><a href="../313262/index.html">7 rules of working with Linkedin that will help you get the desired result and save your nerves to counterparties</a></li>
<li><a href="../313268/index.html">What is a ‚Äútrap for a person‚Äù in the data center and why is it needed?</a></li>
<li><a href="../313270/index.html">Elections 2016. Part 1 - Results and Comparisons</a></li>
<li><a href="../313274/index.html">Misconceptions of most programmers regarding "time"</a></li>
<li><a href="../313276/index.html">Dirty COW dangerous 0-day vulnerability found in Linux kernel (CVE-2016-5195)</a></li>
<li><a href="../313278/index.html">The role of free software in a world where people don't care</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>