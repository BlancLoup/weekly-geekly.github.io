<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What's new in Windows Server 2016 RDS. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The author of the article is Roman Levchenko ( www.rlevchenko.com ), MVP - Cloud and Datacenter Management 
 We continue to dive into the innovations ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What's new in Windows Server 2016 RDS. Part 2</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <i>The author of the article is Roman Levchenko ( <a href="http://www.rlevchenko.com/">www.rlevchenko.com</a> ), MVP - Cloud and Datacenter Management</i> </blockquote><br>  We continue to dive into the innovations of RDS Windows Server 2016. <br>  <a href="https://habrahabr.ru/company/microsoft/blog/275997/">The first</a> part was devoted to a new type of RDS deployment - MultiPoint Services. <br>  Today we will talk about no less than wonderful, namely Personal Session Desktop and other innovations that extend and complement the existing RDS functionality in Windows Server 2012 and Windows Server 2012 R2 environments. <a name="habracut"></a><br><br>  Once again, I‚Äôll note that at the moment we start from the version of Windows Server 2016 that is officially available and open for use - <a href="https://www.microsoft.com/ru-ru/evalcenter/evaluate-windows-server-technical-preview">Technical Preview 4</a> .  In the RTM version, it is possible that there will be changes that we will notify about. <br><br>  Let's get started 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br><h1>  Personal Session Desktop </h1><br>  If you are a service provider and want to provide a full-fledged "desktop" to your customers, then in the current environment, the VDI script and the Service Provider License Agreement (SPLA) are an insurmountable wall for solving the problem.  According to the SPLA, it is impossible to provide a VDI infrastructure built on the basis of client OS to ‚Äúcloud‚Äù users. <br><br>  Habr loves evidence, so I quote from the official DaaS (Desktop As A Service) licensing guidelines. <br><br><h4>  SPLA (January, 2016): </h4><br><blockquote>  <i>Desktops are delivered under SPLA using Windows Server and Remote Desktop Services (RDS).</i>  <i><b>Windows Desktop Operating System cannot be used</b> .</i> </blockquote><br><br><h4>  Microsoft Desktop as a Service Licensing Guide: </h4><br><blockquote>  <i><b>No option is available for the SPLA to provide a hosted virtual desktop using the Windows Desktop Operating System;</b></i>  <i>however <b>this is possible to do through Dedicated Outsourcing</b></i> </blockquote><br>  <b>Dedicated Outsourcing</b> refers to the situation when a client is licensed through VL and you, as a service provider, provide dedicated physical resources for VDI based on client OS.  It is important to note that this scenario also does not give us the right to provide resources under the one to many scheme (1 app. Server &lt;-&gt; many clients).  Only a 1: 1 ratio.  In fact, we give a couple of units in our closet for rent to one and only one client. <br><br><img src="https://habrastorage.org/files/32a/9a5/161/32a9a5161a5c47dc8e2f342df958da4b.png"><br><br>  To circumvent such limitations, as a rule, the system is built on the basis of classical terminal solutions (session-based architecture, of course, with the desktop experience on board) and is given to the "tearing" of customers or users. <br><br>  In Windows Server 2016, they decided to simplify this business and add the method of ‚Äúbinding‚Äù users to specific terminal nodes (in the framework of RDS these are Remote Desktop Session Host, RDSH).  As a result, we get a new type of RDS collection - Personal Session Desktops (PSD) or private desktops based on terminal sessions.  Obviously, you can draw an analogy with Personal Virtual Desktops in VDI, also designed to highlight the "isolated" environment to users. <br><br>  Let's look at a couple of scenarios that are successfully solved thanks to the PSD: <br><ul><li>  If the user needs to work, the OS has all the features and appearance "as the client" (for example, Windows 10), then the full replacement of his desktop will be a PSD with installed Desktop Experience components that allow you to achieve the look and feel of the Windows Server interface to the usual client OS. </li><li>  If the user has administrative authority on his usual PC and you want to transfer it to PSD, then this can be done by adding the user to the group of local administrators (determined at the PSD deployment stage, ‚Äúmanual work‚Äù is not required) </li><li>  If the user does not see his future life without graphical applications that require additional hardware resources, then you can provide a PSD with updated RemoteFX capabilities.  We will talk about this a little later.  Looking ahead, we finally waited ... </li></ul><br><br>  The PSD was first announced in Technical Preview 2 and changed to TP3 / TP4 (one of the changes was the replacement of the cmdlet structure responsible for the PSD configuration).  Currently, the only way to deploy PSD is PowerShell.  GUI option plan to add no earlier than RTM release. <br><br>  For demonstration and testing purposes, you can use the session-based Quick Start deployment type.  This will install RD Connection Broker, RD Web Access and RD Session Host on the same physical server.  For real use it is recommended to form a distributed architecture.  Do not forget that each RDS component supports virtualization (for example, 1 VM RDSH &lt;-&gt; 1 PSD User) and high availability (for example, RD Connection Broker to have a highly accessible configuration). <br><br>  Just in case, I present the configuration steps. <div class="spoiler">  <b class="spoiler_title">"Foundation"</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/2f9/f6f/c0a/2f9f6fc0a2974db5b1e4a0a1e55ff8d6.jpg"><br><br><img src="https://habrastorage.org/files/853/81b/273/85381b27377443a5864fc8a7d8233771.jpg"><br><br><img src="https://habrastorage.org/files/6bb/751/c61/6bb751c617bb401aacfe890d95fcedf3.jpg"><br><br><img src="https://habrastorage.org/files/c04/19c/818/c0419c818d3248beb616dc0a114f4bca.jpg"><br><br><img src="https://habrastorage.org/files/d9e/bc9/841/d9ebc98410c243c2bfa2665e268019b0.jpg"><br><br><img src="https://habrastorage.org/files/f4b/552/d8b/f4b552d8b7624ccd9755bf2f4e83e50b.jpg"></div></div><br><br>  Additionally, install Desktop Experience on the RDSH site <br><br><pre><code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">Install</span></span>-WindowsFeature Desktop-Experience</code> </pre> <br><br>  Moving on to creating a collection of PSD. <br><br>  <i>The New-RDSessionCollection</i> was supplemented with a switch <i>-PersonalUnmanaged</i> , which is used to create a collection of type <b>Personal Session Desktop</b> (in Technical Preview 2, the name of the switch was different, namely <i>-PersonalSessionCollection</i> ) <br><br><pre> <code class="hljs mel">#   RDSH $rdshost=<span class="hljs-string"><span class="hljs-string">"tp4-root.democorp.ru"</span></span> # PSD-      New-RDSessionCollection -CollectionName Personal -ConnectionBroker $rdshost -SessionHost $rdshost -GrantAdministrativePrivilege -PersonalUnmanaged #  rdsuser   PSD   Personal Set-RDPersonalSessionDesktopAssignment -CollectionName Personal -User democorp\rdsuser -Name $rdshost # Get-RDPersonalSessionDesktopAssignment -CollectionName Personal CollectionName DesktopName User -------------- ----------- ---- Personal TP4-ROOT.DEMOCORP.RU DEMOCORP\rdsuser</code> </pre><br>  If the RDSH is already in one of the PSD collections, then based on it you cannot create a new collection.  Only after removing this RDSH from the current collection will it be possible to define it in a new one. <br><br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-RDSessionCollection -CollectionName Personal -ConnectionBroker $rdshost -SessionHost $rdshost -GrantAdministrativePrivilege -PersonalUnmanaged WARNING: The RD Session Host <span class="hljs-built_in"><span class="hljs-built_in">server</span></span> tp4-root.democorp.ru already exists <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> another collection. <span class="hljs-keyword"><span class="hljs-keyword">New</span></span>-RDSessionCollection : Unable <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> create the session collection. #   <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-RDSessionCollection CollectionName Size ResourceType CollectionType CollectionDescription -------------- ---- ------------ -------------- --------------------- QuickSessionCollection <span class="hljs-number"><span class="hljs-number">1</span></span> RemoteApp programs PooledUnmanaged #  <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-RDSessionCollection|Remove-RDSessionCollection</code> </pre><br>  After creating the PSD collection and linking the user to it, go to the RD Web Access node (https: // host fqdn / rdweb) for additional verification, using the credentials of our user.  A list of the collections available to the user should appear. <br><br><img src="https://habrastorage.org/files/9eb/e3b/656/9ebe3b6563234e7c8aa8b2514f8ac54b.jpg"><br><br>  I note that in the administrator‚Äôs usual list of collections (Server Manager -&gt; RDS -&gt; Collection List), this type of collection is not displayed, since it is created and managed only using PowerShell (at least until the RTM version is released). <br><br>  This is the appearance of the Start Panel in the PSD session: <br><br><img src="https://habrastorage.org/files/e9a/f42/374/e9af423745204cf9ba7559080a4a95ed.jpg"><br><br>  Our collection was created with the <i>-GrantAdministrativePrivilege</i> key, so the user was automatically added to the Administrators group on the dedicated RDSH server. <br><br><img src="https://habrastorage.org/files/575/8cd/4a9/5758cd4a9f0a426ca24a3d96cb03df3b.jpg"><br><br>  Moving on. <br><br><br><h1>  RemoteFX enhancements </h1><br>  In Windows Server 2012 R2, the RemoteFX adapter has a number of limitations: 256 MB is the maximum amount of dedicated VRAM, support for only OpenGL 1.1, and lack of support for OpenCL.  All this affects the supported number of monitors, resolution and adequate work of new graphics applications (for example, Autocad Re-Cap requires OpenGL 3.3 and 1 GB VRAM, Photoshop CC - OpenGL 2.0 and 512 MB VRAM at a minimum). <br><br>  Windows Server 2016 is designed to solve these problems and makes a number of changes: <br><ul><li>  Ability to select up to 1 GB VRAM.  Hyper-V virtual machines can use up to 1 GB of dedicated VRAM + to increase the amount of VRAM due to VM system memory, getting up to 2 GB VRAM, depending on the amount of memory available to the virtual machine. <br><br>  In addition, the dynamic definition of VRAM volume based on the number of monitors and resolution is replaced by the ability to set a specific VRAM value for each VM, regardless of the maximum number of monitors and resolution. <br><br><img src="https://habrastorage.org/files/aa4/6e0/d72/aa46e0d72f5d4a1592df9b74dda9ebe2.png"><br><br></li><li>  <a href="https://www.opengl.org/about/">OpenGL 4.4</a> and <a href="https://www.khronos.org/registry/cl/sdk/1.1/docs/man/xhtml/">OpenCL 1.1</a> support.  As a result, we have a ‚Äúcarte blanche‚Äù for the use of modern graphic applications. </li></ul><br><br>  RemoteFX settings are defined via both the GUI and PowerShell. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Set-VMRemoteFx3dVideoAdapter</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Set-VMRemoteFx3dVideoAdapter</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[-VM]</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">VirtualMachine</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[]</span></span>&gt; <span class="hljs-selector-attr"><span class="hljs-selector-attr">[[-MonitorCount]</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">byte</span></span>&gt;] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[[-MaximumResolution]</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">string</span></span>&gt;] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[[-VRAMSizeBytes]</span></span> &lt;<span class="hljs-selector-tag"><span class="hljs-selector-tag">uint64</span></span>&gt;] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[-Passthru]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[-WhatIf]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[-Confirm]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[&lt;CommonParameters&gt;]</span></span></code> </pre><br><br><br><h1>  New RDS customers </h1><br>  More recently, Microsoft did not have a single mobile client to access remote desktops, and had to use third-party paid solutions that support RD Gateway.  However, as the RDS solutions were promoted and used, the following clients were released and added: <br><ul><li>  <a href="https://technet.microsoft.com/en-us/library/dn473010.aspx">RD Client for Android</a> </li><li>  <a href="https://technet.microsoft.com/en-us/library/dn473013.aspx">RD Client for iOS</a> </li><li>  <a href="https://technet.microsoft.com/en-us/library/dn473012.aspx">RD Client for Mac</a> </li></ul><br>  <b>The RDP client</b> (MSTSC.EXE) has been upgraded to version 10, which has improved support for the AVC / H.264 codec and <b>AVC 444</b> mode, designed to improve fps, reduce color loss by using the features of the hardware H.264 decoder in high resolutions up to up to <b>4K</b> (GPU should support DirectX 11.0, H.264 decoder Level 4.1 / BT.709).  So far, only as part of a full-fledged client, but it is planned to add support for mobile clients, indicated above. <br>  AVC444 mode is used by default in RemoteFX, but it is possible to use AVC444 and in other scenarios using group policy settings: <br><br>  <b>Computer Configuration / Administrative Templates / Windows Components / Remote Desktop Session Host / Remote Session Environment:</b> <br>  <i>Prioritize H.264 / AVC 444 Graphics mode for Remote Desktop connections</i> <br>  and <br>  <i>Configure H.264 / AVC hardware encoding for Remote Desktop connections&gt;</i> <br><br><br><h1>  Support for second-generation virtual machines </h1><br>  Second generation VMs (Generation 2) became available even in Windows Server 2012 R2, but their use within RDS / VDI (and not only) was postponed.  For example, the ability to create VMM service templates based on Gen2 was added only within <a href="https://support.microsoft.com/en-us/kb/3050317">UR6</a> . <br>  In Windows Server 2016, we can use both generations for use in various types of collections (personal / pooled or personal session).  Additional configuration is not required. <br><br><br><h1>  Edge Stylus &amp; Browser Support </h1><br>  If your device, such as Surface, supports working with a stylus, and the local system is not lower than Windows 10, then you can use the stylus as part of an RDP session. <br><br>  In Windows Server 2012/2012 R2, such devices are also redirected, but are used as a replacement for the mouse.  As part of Windows Server 2016 and Windows 10, you can draw or write with the stylus, for example, by opening a graffiti application in Microsoft Edge, which also gained support when working in a remote session. <br><br><br><h1>  findings </h1><br>  Updated RemoteFX and RDP with support for 4K resolution increase the return on VMs with ‚Äúheavy‚Äù applications within VDI and increase their speed in comparison with Windows Server 2012/2012 R2 (of course, you need to test and look at real numbers). <br><br>  MultiPoint Server, which has moved under the ‚Äúwing‚Äù of RDS, expands the field of application of remote desktops and makes them more attractive (interactivity in the dashboard, ease of configuration play an important role in this). <br><br>  Personal Session Desktop (PSD) simplifies the provision of desktops within the DaaS service and extends the capabilities of RDS in Azure.  I don‚Äôt have to expect a global change in SPLA conditions.  Say "thank you" that they did not forget about us here either. <br><br>  Hope that was interesting.  All good virtualization and RDS implementation. </div><p>Source: <a href="https://habr.com/ru/post/277471/">https://habr.com/ru/post/277471/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277459/index.html">Automating stock purchases: large transaction processing architecture</a></li>
<li><a href="../277461/index.html">Traits out of the box</a></li>
<li><a href="../277463/index.html">Xeon Phi: Why do coprocessors use to create trading applications</a></li>
<li><a href="../277465/index.html">Initialized controllers in symfony and working with annotations</a></li>
<li><a href="../277467/index.html">The new locker "Locky"</a></li>
<li><a href="../277473/index.html">Zabbix 3.0: Problem Prediction</a></li>
<li><a href="../277475/index.html">Gmailify: The best of Gmail‚Äôs features are now available without the @gmail mailbox.</a></li>
<li><a href="../277477/index.html">The problem of malware for PoS - terminals in the hotel industry</a></li>
<li><a href="../277479/index.html">A bit about Kotlin</a></li>
<li><a href="../277481/index.html">Android meeting dedicated to the Kotlin language</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>