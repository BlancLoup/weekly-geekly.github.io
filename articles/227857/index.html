<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Gamma, ColorMapping and LinearWorkflow</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Overview and practical application of Gamma and Color Mapping in a combination of 3D max, V-ray and Nuke. 



 Part one. Gamma. Start 
 This story beg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Gamma, ColorMapping and LinearWorkflow</h1><div class="post__text post__text-html js-mediator-article">  Overview and practical application of Gamma and Color Mapping in a combination of 3D max, V-ray and Nuke. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e43/289/1bf/e432891bf35ba379125cba55ab22318a.png" alt="image"><br><a name="habracut"></a><br><h2>  Part one.  Gamma.  Start </h2><br>  This story began with the fact that the imperfect technology of displaying the video signal with a ray tube suffered from severe blackouts and the matter is not at all in the cookies.  It was impossible to compensate this deficiency programmatically, and the hardware is very expensive and therefore decided to make adjustments to the video itself at the stage of content production.  Years passed, the mountains turned out to be exclusively gamma-corrected images, and when the era of computers came, no one began to transfer the industry to new standards, but adopted the existing ones.  Since then, the computer and we see the image in different ways.  If everything is ‚Äúok‚Äù for us, then for the company the picture looks much brighter, just before showing us the image the signal goes through the ‚Äúnatural‚Äù reverse gamma correction on the monitor side.  Modern monitors can display a picture linearly, but we are haunted by the ‚Äúlegacy of the old time‚Äù in the form of a heap of bright films and TV shows. <br><br>  All-nothing, but for some reason, computer graphics was built on mathematical principles and all color manipulations converge on banal arithmetic operations.  And imagine now that you need to increase the average gray color in two.  In the linear space ‚Äúmedium gray‚Äù is equal to 0.5 * the total is 0.5x2 = 1.0, that is, you get pure white color, which is quite logical, and not in the linear space ‚Äúmedium gray‚Äù is equal to 0.72 somewhere, multiplied by 2 and it turns out ... nonsense it turns out guys. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So Rendering is a bunch of different arithmetic perverts and all sorts of multiplayer, overlayers and colorburns are a little different than what is required of them if the color space is not linear.  Therefore, those who have eyes able to distinguish blue from blue decided to work in the ‚Äúruler‚Äù in order not to create problems for themselves at all stages of image processing. <br><br>  Rule: We bring the input material into linear space.  We work in linear space.  Gamma correction is applied only to the final picture (and in most cases this happens automatically). <br><br>  An example of a gamma translation is in the description for Blender: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec5/c18/906/ec5c189060d34d55d6c11a5c45f52bdf.jpg"><br><br>  By the way, it‚Äôs not worthwhile to bring Normal Bump into linear space, since such maps are already in the ‚Äúruler‚Äù, when connecting such textures, you should exclude them from the correction. <br><br><h2>  Part two.  Color mapping </h2><br>  In addition to the complexity of the scale, we have a technological problem, which rests on the possibility of display.  We have 2 main ways to display images - on paper and on the screen.  Both methods differ fundamentally by the fact that one reflects light, and the second emits, but both of them have a very limited transmission range of the light intensity, in comparison with the one we can see, therefore the image must be ‚Äúcompressed‚Äù to the desired range.  Moreover, it is not enough just to squeeze the brightness, it should be done so that in places of weak sensitivity to compress a lot, and where we have a lot of sensitivity to compress it is necessary ... well, you understand.  This is done because of the peculiarities of our perception.  Now I am going to be a little more detailed. <br><br><h6>  Our feelings lie to us. </h6><br>  We perceive the world around us not linearly.  To enhance the feeling of something 2 times, it‚Äôs not enough for us to double the serving ... we need to triple or quadruple it, that is, if we twist the brightness of the light source by 2 times, we feel that we‚Äôve said that the brightness has increased by 30% ... we are such ‚Äúclear guys‚Äù .  All sense organs work in a logarithmic proportion.  The reverse natural logarithm is called the Exponent ... which looms in the Color Mapping settings.  Logarithm is the main function when converting intensity, regardless of whether it is an image, a portion of salt or the joy of the amount of money in the bank. <br><img src="https://habrastorage.org/getpro/habr/post_images/6d2/2b4/1e5/6d22b41e5a1fbc09438e701f0226bde0.png"><br>  For this reason, we are well aware of halftones in dark areas and are more indifferent to differences in bright ones.  That is why during compression we neglect high color values. <br>  Imagine that in the visible world, the difference in brightness can go far beyond a million, and the monitor is able to show a difference of about 10,000. ColorMapping ‚Äúsqueezes‚Äù a wide range of brightness into that small area that a monitor or picture printed on a sheet of paper can display. it is instead of our eyes, and the brain interprets the image as a finished image.  Pay attention to the Binary Logarithm graph, it becomes clear from it - mainly the light areas are compressed while the ‚Äúshadows‚Äù remain unchanged, so we get rid of the unpleasant ‚Äúglares‚Äù that run the work of novice visualizers. <br>  Logarithm and gamma are almost the same, but they have particular differences in construction: for gamma you need to have two extreme points - zero and one corresponding to black and white, between these points a curve is constructed with a bending force equal to gamma.  But for the exponent, one starting point is enough and the curve can be built to infinity.  Therefore, in the linear space with a high dynamic range (HDR) color, where there is no limit to the brightness of the applied exponent, and already in the ready-used gamma.  There are, of course, programs where gamma can be applied to an HDR image, but such a perversion can lead to unpredictable values ‚Äã‚Äãinitially standing above one. <br><br>  ColorMapping and gamma correction are two similar things, but deals with different tasks.  Gamma is designed to compensate for the ‚Äúold legacy‚Äù, while ColorMapping compresses the ‚Äúruler‚Äù. <br><br>  That is, in the work we take into account two separate color conversions and do not confuse them with each other. <br><br><h2>  Part Three  Practical work </h2><br>  There are two main ways of making pictures.  One path leads immediately to the finished file: with a gamut clipped by HDR, with a minimal number of bits per channel, with all that implies the absence of serious edits.  The second is preparing a ‚Äúraw cake mix‚Äù which wakes up ‚Äúcooked‚Äù until ready in the post-processing program.  If we are preparing a file for the post, we need to keep the linear space + high dynamic range of colors.  We will consider in practice both methods. <br><br><h6>  Path number 2. Longer - then skillfully! </h6><br>  In the latest version of 3D Max, Input and Output were removed from the Gamma settings, so the total gamma value should be set to 2.2.  3D Max itself will bring incoming textures into linear space. <br><br>  The settings for ColorMapping in 3D Max are as follows: <br>  Type - Linear multiply.  - We work in the line <br>  Dark - 1. <br>  Bright - 1. - these values ‚Äã‚Äãwill remain the default if necessary, we will change them in the post. <br>  Gamma - 2.2.  - The fact is that this scale will not be applied to the final image and in fact will remain - 1 ... because we will set a tick in: <br>  Don't affect colors - check the box.  We do this in order to stay in linear space, but knowing that Vraevsky Sampler does not always report in dark places, we apply the gamut only to him.  Thus, in the dark areas we will not lose the details and we will remain in the "line" <br>  Clamp - Disable, because we need the whole range of brightness. <br><br>  Save such images in Float point formats (32 bits), such as openEXR.  Now, at the output, we will have a relatively accurate model of color representation, almost like in reality. <br><br><h6>  Cooking cake mix in Nuke </h6><br>  I admit, I like the post with my creative flexibility.  When all the basic, rough work is done and it remains to ‚Äútwist‚Äù the buttons for taste. <br>  Omit the details specific to specific projects and go straight to ColorMapping for Nuke. <br>  So we have a ‚Äúlinear‚Äù picture with scorched light areas.  Recalling my story about the features of perception, we will repeat a similar focus.  And the mechanics of the work will be similar to the type of Reinhard in ColorMapping V-ray. <br>  We need 2 nodes: Grade and Log2Lin. <br>  Grade will play the role of the multiplier of the entire image or the ISO value of the camera if you prefer. <br><br>  Log2Lin will compress the image, but first you need to configure it: <br>  Operation - lin2log. <br>  Black - 0 <br>  White - 255 <br>  Gamma - 1 <br>  Mix - 0.95 <br><br>  ‚ÄúSqueezing‚Äù the brightness, we make the image darker, so you can immediately set the Gain value to 5 in the settings of the Grade node.  The two Log2Lin nodes will perform the same function that the Burn value in ColorMapping 3D Max is just the other way, that is, if the Burn value is 0.3, then Mix will set about 0.7 <br><br><h6>  Path number 1. Without dancing. </h6><br>  If you avoid Post, then you can do all color conversions in ColorMapping, but for this purpose it is necessary to do test renders.  Select the type of transformation - Rinhard, since it is averaging between the ruler and the exponent through the parameter Burn value.  If you have "burned" colors, then it is enough to lower the Burn value. <br><br>  Gamma - 1 <br>  Clamp - 1 <br>  Don't affect colors - uncheck. <br><br>  Since now the Sampler will scatter samples based on the visible image, it is necessary to lower the noise threshold in the DMC Sampler from 0.01 for the ‚Äúruler‚Äù to about 0.003. <br><br>  Some guys, instead of lowering the noise level, simply increase the gamma by 2.2, and in the Gamma settings of the program, set the unit to the Output field.  I think this is ideologically incorrect, although it also works. <br><br>  _______________________________________________________________________________ <br>  * Hereinafter we are talking about the color values ‚Äã‚Äãin Float Point where 0 = black, and 1 = white. </div><p>Source: <a href="https://habr.com/ru/post/227857/">https://habr.com/ru/post/227857/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227845/index.html">Experimental video post: two excavators, drones and railgun</a></li>
<li><a href="../227847/index.html">Moto 360: smart and beautiful watch from Motorola</a></li>
<li><a href="../227849/index.html">ELibrary Record Manager</a></li>
<li><a href="../227853/index.html">Develop mobile javascript MVC applications with Framework7, RequireJS and Handlebars</a></li>
<li><a href="../227855/index.html">The best way to store a large number of files on the server</a></li>
<li><a href="../227859/index.html">A simple Ethernet tunnel on Linux in four to six teams</a></li>
<li><a href="../227861/index.html">OpenUI5 - new javascript framework from SAP</a></li>
<li><a href="../227863/index.html">Xamarin. Pros and cons</a></li>
<li><a href="../227867/index.html">Bacon number and graphs</a></li>
<li><a href="../227869/index.html">Smart Home (The Beginning) - Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>