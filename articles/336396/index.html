<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Work with CST parameters from Matlab</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the beginning of our career path, small tasks are posed to us, the result of the solution of which we immediately run to show the leader. We get ti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Work with CST parameters from Matlab</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/bc3/111/bf0/bc3111bf05bad7049d327345458c4d74.jpg" alt="Headline"><br>  At the beginning of our career path, small tasks are posed to us, the result of the solution of which we immediately run to show the leader.  We get tips and comments, then we run to redo.  At the end of the working day we turn off the computer and go home with peace of mind. <br><br>  But as your experience and task list grows, there is a shortage of time.  At some point it begins to seem that you can not leave the office.  Then automation will help us become more productive.  Under a cat there will be a small experience of the designer of antenna engineering. <br><a name="habracut"></a><br><h1>  Introduction </h1><br>  In the past and my first <a href="https://habrahabr.ru/post/325012/">post</a> on Habr√©, I told you, dear reader, how to manage CST MWS using the Matlab code.  Let the comment in the comments this article has not received, but there are reviews of my colleagues and friends.  And the most important question: ‚ÄúWill you show specific applications?‚Äù It‚Äôs impossible that the application options are limited only by your imagination and the functionality of the package did not work.  According to this, at the request of the workers today we will look at the example of controlling the CST MWS from outside. <br><br>  In this case, I wanted to force the machine to perform tasks while I was not there, or I was busy with something more important and useful at the current time.  Therefore, it was not only decided to dig into your favorite electrodynamic modeling packages ( <a href="https://www.cst.com/applications/mwandrf">CST Microwave Studio</a> and <a href="http://www.ansys.com/products/electronics/ansys-hfss">Ansys HFSS</a> ) for control from outside.  Ideally, using a tool that I know very well, which is <a href="https://www.mathworks.com/">Mathworks Matlab</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First of all, I would like to note that the article does not claim to be super uniqueness and in some parts will consist of a translation of the CST certificate, and the things highlighted below will seem too obvious to someone. <br><br><h1>  Work with parameters </h1><br>  I love the options.  By inexperience, I used to develop non-parametric models, but now I parametrize almost everything.  Why am I doing this?  And I like it so much.  This way I can rebuild any geometry in seconds without error if I made a good model.  No problems with geometry = no problems with the calculated grid = no problems with optimization, so you can always quickly transfer the project to other frequencies, to other enclosures and much more. <br><br>  Very often a situation arises when it is necessary to carry out a series of calculations with a change in the parameter and an analysis of the behavior of the structure as it changes.  The built-in utility <i>Parameter Sweep</i> suggests that we change the parameters according to a linear or logarithmic law, choosing the number of points or the step between them.  It is also possible to enter specific parameter values.  And if the law of parameter change wants to see another? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/909/ea3/ecf/909ea3ecf3f8aa8e1c0822e89c25cac1.jpg" alt="Parameters in CST"><br><br><h1>  Strategy </h1><br>  In the general case, our task is quite simple, it comes down to calculating the parameter values ‚Äã‚Äãand transferring the CST for calculation.  Whatever was not so boring, fasten the output of any graphs.  Below is a simple flowchart of what we will do. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/581/78f/80b/58178f80bdc08e4f93a977938f56a203.jpg" alt="Figure 1 - Block diagram of the script" width="153" height="423"></div><br>  The only thing I want to note is that I called the export of the result in text format, and put the stage of presentation of the simulation results in Matlab into the ‚ÄúPost-processing‚Äù block. <br><br><h1>  Let's start </h1><br>  For example, we will use my 5-minute <a href="">project of a</a> rectangular patch antenna. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/21c/d5c/abf/21cd5cabf8e8ef171758380c0a09e26f.jpg" alt="Patch antenna" width="438" height="407"></div><br>  The figure above shows the model itself for the calculation and the parameter L, which we will change. <br><br>  Let the parameter L be a quadratic law ranging from 10 to 100, the number of values ‚Äã‚Äã5: <br><br><pre><code class="matlab hljs">x = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>):(<span class="hljs-number"><span class="hljs-number">10</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>))/<span class="hljs-number"><span class="hljs-number">5</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span>; y = x.^<span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre> <br>  Just in case, I‚Äôll give a graph, even though everyone understands how it should look. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/67c/12c/69f/67c12c69f0343311e1d00d1584931f0b.jpg" alt="Parabola" width="433" height="238"></div><br>  We launch CST and open our project, and also attach all the necessary CST objects to variables: <br><br><pre> <code class="matlab hljs">cst = actxserver(<span class="hljs-string"><span class="hljs-string">'CSTStudio.Application'</span></span>); mws = cst.invoke(<span class="hljs-string"><span class="hljs-string">'NewMWS'</span></span>); mws.invoke(<span class="hljs-string"><span class="hljs-string">'OpenFile'</span></span>,<span class="hljs-string"><span class="hljs-string">'path\to\file.cst'</span></span>); solv = mws.invoke(<span class="hljs-string"><span class="hljs-string">'Solver'</span></span>); export = mws.invoke(<span class="hljs-string"><span class="hljs-string">'ASCIIExport'</span></span>); plot1d = mws.invoke(<span class="hljs-string"><span class="hljs-string">'Plot1D'</span></span>);</code> </pre> <br>  Briefly about what these 6 lines represent in the order of their writing: <br><br><ol><li>  Binding the CST Studio application object to the <i>cst</i> variable </li><li>  Binding the CST MWS window to the <i>mws</i> variable </li><li>  Opening in the CST MWS file window </li><li>  Binding calculator object to <i>solv</i> variable </li><li>  Binding an Export Object in ASCII to an <i>Export</i> Variable </li><li>  Binding the object of one-dimensional graphs to the variable <i>plot1d</i> </li></ol><br>  Next, we introduce an intermediate variable, which is useful for generating the paths to the result files: <br><br><pre> <code class="matlab hljs">f_cell = cell(<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>(y),<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">What can we achieve from CST about the parameters used in the project?</b> <div class="spoiler_text"><ul><li>  We can delete the parameter with the command <pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'DeleteParameter'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterName'</span></span>);</code> </pre> </li><li>  Find out the number of parameters <pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'GetNumberOfParameters'</span></span>);</code> </pre> </li><li>  Find the name of the parameter by its number <pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'GetParameterName'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterNumber'</span></span>);</code> </pre> </li><li>  Find out the value of the parameter by its number in double <pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'GetParameterNValue'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterNumber'</span></span>);</code> </pre> </li><li>  Find out the value of the parameter by its number in string <pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'GetParameterNValue'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterNumber'</span></span>);</code> </pre> </li><li>  Find out the value of the parameter by its name in string <pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'RestoreParameter'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterName'</span></span>);</code> </pre> </li><li>  Find out the value of the parameter by its name in double <pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'RestoreDoubleParameter'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterName'</span></span>);</code> </pre> </li><li>  Learn the expression with which the parameter is calculated by its name in string <pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'RestoreParameterExpression'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterName'</span></span>);</code> </pre> </li><li>  Create a new parameter string (or replace the existing one) with its description <pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'StoreParameterWithDescription'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterName'</span></span>, <span class="hljs-string"><span class="hljs-string">'ParameterValue'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterDescription'</span></span>);</code> </pre> </li><li>  Create a new parameter string (or replace an existing one) without a description. <pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'StoreParameter'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterName'</span></span>, <span class="hljs-string"><span class="hljs-string">'ParameterValue'</span></span>);</code> </pre> </li><li>  Create a new double parameter (or replace an existing one) without a description. <pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'StoreDoubleParameter'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterName'</span></span>, <span class="hljs-string"><span class="hljs-string">'ParameterValue'</span></span>);</code> </pre> </li><li>  Make sure that the parameter name is not taken, if it is not necessary to create a new one with the specified values, otherwise do not touch the existing one. <pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'MakeSureParameterExists'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterName'</span></span>, <span class="hljs-string"><span class="hljs-string">'ParameterValue'</span></span>);</code> </pre></li><li>  Add a description to an existing parameter by name. <pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'SetParameterDescription'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterName'</span></span>);</code> </pre> </li><li>  Pull out the arrays by the number of the start of the calculation with the names of the parameters and their values <pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'GetParameterCombination'</span></span>,<span class="hljs-string"><span class="hljs-string">'ResultId'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterNames'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParametersValues'</span></span>);</code> </pre> </li></ul><br>  I somehow could not fasten the last function in the list to the matlab.  But not the essence, in this case, we do not need it. <br></div></div><br>  Since I greatly simplified the task, only one function is interesting from the list presented in the spoiler: <br><br><pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'StoreDoubleParameter'</span></span>,<span class="hljs-string"><span class="hljs-string">'ParameterName'</span></span>, <span class="hljs-string"><span class="hljs-string">'ParameterValue'</span></span>);</code> </pre> <br>  In the body of the loop, we will need to do only 4 operations: pass the parameter, update the model, run the calculation and export the results. <br><br>  Open a cycle with a length from 1 to the number of values ‚Äã‚Äãof the parameter <i>y</i> <br><br><pre> <code class="matlab hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">length</span></span>(y)</code> </pre> <br>  Pass the parameter: <br><br><pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'StoreDoubleParameter'</span></span>,<span class="hljs-string"><span class="hljs-string">'L'</span></span>, y(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>));</code> </pre> <br>  We update the model: <br><br><pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'Rebuild'</span></span>);</code> </pre> <br>  Run the calculation: <br><br><pre> <code class="matlab hljs">solv.invoke(<span class="hljs-string"><span class="hljs-string">'Start'</span></span>);</code> </pre> <br>  Next, we prepare string variables for the paths to save files (with the first line we translate the current parameter values ‚Äã‚Äãinto a string, the second one - create the string for the path to save the file, the third one - write the address of the current result file to the array of cells: <br><br><pre> <code class="matlab hljs">str_y = num2str(y(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>)); f_name = strcat(<span class="hljs-string"><span class="hljs-string">'C:\Results_patch\patch_z_im_y='</span></span>, str_y,<span class="hljs-string"><span class="hljs-string">'.txt'</span></span>); f_cell(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) = {f_name};</code> </pre> <br>  As a result for export, I chose the graph of the imaginary part of the input resistance, so next is the selection of the corresponding branch of the result tree, the procedure for exporting to ASCII, described in the previous <a href="https://habrahabr.ru/post/325012/">post</a> , as well as the end of the cycle. <br><br><pre> <code class="matlab hljs">mws.invoke(<span class="hljs-string"><span class="hljs-string">'SelectTreeItem'</span></span>,<span class="hljs-string"><span class="hljs-string">'1D Results\Z Matrix\Z1,1'</span></span>); plot1d.invoke(<span class="hljs-string"><span class="hljs-string">'PlotView'</span></span>,<span class="hljs-string"><span class="hljs-string">'imaginary'</span></span>); export.invoke(<span class="hljs-string"><span class="hljs-string">'Reset'</span></span>); export.invoke(<span class="hljs-string"><span class="hljs-string">'FileName'</span></span>,f_name); export.invoke(<span class="hljs-string"><span class="hljs-string">'Mode'</span></span>,<span class="hljs-string"><span class="hljs-string">'FixedNumber'</span></span>); export.invoke(<span class="hljs-string"><span class="hljs-string">'Step'</span></span>,<span class="hljs-string"><span class="hljs-string">'1001'</span></span>); export.invoke(<span class="hljs-string"><span class="hljs-string">'Execute'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  After the done actions, we have a set of files with the result of calculating the imaginary part of the input resistance.  But what else to do with frequency-dependent quantities?  Display as a graph. <br><br>  Since all the output results in ASCII from CST have a header, we need to get rid of it, in our case these are two lines at the beginning of each file: <br><br><pre> <code class="hljs pgsql"> Frequency / MHz Z1,<span class="hljs-number"><span class="hljs-number">1</span></span>/imaginary <span class="hljs-comment"><span class="hljs-comment">----------------------------------------------------------------------</span></span></code> </pre> <br>  To do this, we use the unpretentious function given under the spoiler below, which I wrote quite a while ago.  The input parameter for the function is the path to the file to remove the header. <br><br>  The function reads the file line by line, then overwrites the data without a header into it, and on output gives you a variable with the data from the file. <br><br><div class="spoiler">  <b class="spoiler_title">Remove header</b> <div class="spoiler_text"><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[f_cell]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h_remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ishod)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ffile</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fopen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ishod,'rt')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f_cell</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1003,1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">=1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">=1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f_cell)</span></span></span><span class="hljs-function"> %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">feof</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Farfield)</span></span></span><span class="hljs-function"> ==0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f_cell</span></span></span><span class="hljs-function">{</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">,1} = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fgetl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ffile)</span></span></span><span class="hljs-function">; %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">+1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f_cell</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f_cell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(3: end, 1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fclose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ffile)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ffile</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fopen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ishod, 'w+')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = 1: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f_cell)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fprintf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ffile, '%s\r\n', f_cell{i,1})</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fclose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ffile)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f_dat</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ishod)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre> <br></div></div><br>  With the help of the above function, we load into the variable results of the calculations, display the graph and lightly brush it. <br><br><pre> <code class="matlab hljs">y1 = h_remove(f_cell{<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}); y2 = h_remove(f_cell{<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}); y3 = h_remove(f_cell{<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}); y4 = h_remove(f_cell{<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}); y5 = h_remove(f_cell{<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}); y6 = h_remove(f_cell{<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}); <span class="hljs-built_in"><span class="hljs-built_in">plot</span></span>(y1(:,<span class="hljs-number"><span class="hljs-number">1</span></span>),y1(:,<span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-string"><span class="hljs-string">'-r'</span></span>, y1(:,<span class="hljs-number"><span class="hljs-number">1</span></span>),y2(:,<span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-string"><span class="hljs-string">'--r'</span></span>,y1(:,<span class="hljs-number"><span class="hljs-number">1</span></span>),y3(:,<span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-string"><span class="hljs-string">'-.r'</span></span>,y4(:,<span class="hljs-number"><span class="hljs-number">1</span></span>),y1(:,<span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-string"><span class="hljs-string">'-b'</span></span>,y1(:,<span class="hljs-number"><span class="hljs-number">1</span></span>),y5(:,<span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-string"><span class="hljs-string">'--b'</span></span>,y1(:,<span class="hljs-number"><span class="hljs-number">1</span></span>),y6(:,<span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-string"><span class="hljs-string">'-.b'</span></span>) grid on xlabel(<span class="hljs-string"><span class="hljs-string">', '</span></span>) ylabel(<span class="hljs-string"><span class="hljs-string">', '</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">legend</span></span>(num2str(y(<span class="hljs-number"><span class="hljs-number">1</span></span>)),num2str(y(<span class="hljs-number"><span class="hljs-number">2</span></span>)),num2str(y(<span class="hljs-number"><span class="hljs-number">3</span></span>)),num2str(y(<span class="hljs-number"><span class="hljs-number">4</span></span>)),num2str(y(<span class="hljs-number"><span class="hljs-number">5</span></span>)),num2str(y(<span class="hljs-number"><span class="hljs-number">6</span></span>)))</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/dc8/8c3/9e6/dc88c39e66e4113e5c78746e2c0fbcd4.jpg" alt="Final schedule"><br><br><h1>  findings </h1><br>  In just such an uncomplicated way, in just 39 lines, we forced CST to make a parametric calculation according to the law of parameter change that we set, derived the calculation results for further processing in ASCII, well, and screwed the output in Matlab. <br><br>  You can say: Uh, ‚Äúeverything can be done without Matlab!‚Äù  What are you thinking here is the built-in macro editor on VBA. ‚Äù  And I will answer: ‚ÄúYes, you are right.  You can write everything in VBA if you like it that way. ‚Äù <br><br>  But further processing of the results in Matlab may be useful.  You can also use the Report Generator.  Then it becomes possible to leave the car to carry out the calculation in your absence, and then it remains only to print and put the ready report on the manager‚Äôs table. <br><br><h1>  Links </h1><br>  Below I place the test script parsed here, and the h_remove functions for your experiments, as well as a link to the project file for those who did not notice the link in the text: <br><br>  ‚Üí <a href="">Antenna design</a> <br><br><div class="spoiler">  <b class="spoiler_title">Script</b> <div class="spoiler_text"><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%%    x = sqrt(10):(10-sqrt(10))/5:10; y = x.^2; %%     CST %cst = actxserver('CSTStudio.Application'); %mws = cst.invoke('NewMWS'); %mws.invoke('OpenFile','C:\patch.cst'); solv = mws.invoke('Solver'); export = mws.invoke('ASCIIExport'); plot1d = mws.invoke('Plot1D'); f_cell = cell(length(y),1); %%    for i=1: length(y) mws.invoke('StoreDoubleParameter','L', y(i)); mws.invoke('Rebuild'); solv.invoke('Start'); str_y = num2str(y(i)); f_name = strcat('C:\Results_patch\patch_z_im_y=', str_y,'.txt'); f_cell(i,1) = {f_name}; mws.invoke('SelectTreeItem','1D Results\Z Matrix\Z1,1'); plot1d.invoke('PlotView','imaginary'); export.invoke('Reset'); export.invoke('FileName',f_name); export.invoke('Mode','FixedNumber'); export.invoke('Step','1001'); export.invoke('Execute') end %%  y1 = h_remove(f_cell{1,1}); y2 = h_remove(f_cell{2,1}); y3 = h_remove(f_cell{3,1}); y4 = h_remove(f_cell{4,1}); y5 = h_remove(f_cell{5,1}); y6 = h_remove(f_cell{6,1}); plot(y1(:,1),y1(:,2), '-r', y1(:,1),y2(:,2), '--r',y1(:,1),y3(:,2), '-.r',y4(:,1),y1(:,2), '-b',y1(:,1),y5(:,2), '--b',y1(:,1),y6(:,2), '-.b') grid on xlabel(', ') ylabel(', ') legend(num2str(y(1)),num2str(y(2)),num2str(y(3)),num2str(y(4)),num2str(y(5)),num2str(y(6)))</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">h_remove</b> <div class="spoiler_text"><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[f_dat]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">h_remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ishod)</span></span></span><span class="hljs-function"> %     </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ffile</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fopen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ishod,'rt')</span></span></span><span class="hljs-function">; %        </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f_cell</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1003,1)</span></span></span><span class="hljs-function">; %          </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">=1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">=1:</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f_cell)</span></span></span><span class="hljs-function"> %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">while</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">feof</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Farfield)</span></span></span><span class="hljs-function"> ==0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f_cell</span></span></span><span class="hljs-function">{</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">,1} = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fgetl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ffile)</span></span></span><span class="hljs-function">; %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function">+1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f_cell</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f_cell</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(3: end, 1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fclose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ffile)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ffile</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fopen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ishod, 'w+')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = 1: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f_cell)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fprintf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ffile, '%s\r\n', f_cell{i,1})</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fclose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ffile)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">f_dat</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ishod)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/336396/">https://habr.com/ru/post/336396/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336384/index.html">‚ÄúThe State in the Clouds‚Äù and one GIS example from our practice</a></li>
<li><a href="../336386/index.html">Weather and routes in MajorDoMo</a></li>
<li><a href="../336388/index.html">Welcome to Rust Gamedev Mitap September 14</a></li>
<li><a href="../336390/index.html">Data Science: About love, names and more</a></li>
<li><a href="../336392/index.html">Better than C</a></li>
<li><a href="../336398/index.html">Shipbuilding of the 17th century and your unsuccessful development projects: find five differences</a></li>
<li><a href="../336400/index.html">Android: the evolution of the photo editor VK</a></li>
<li><a href="../336402/index.html">Amsterdam invites to work in the field of AI</a></li>
<li><a href="../336404/index.html">In-line cooling in the data center: myths and realities</a></li>
<li><a href="../336406/index.html">Terra Language - Low Level Partner Lua</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>