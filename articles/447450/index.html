<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Breaking a simple quack with Ghidra - Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The fact that this is such a beast - Ghidra (‚ÄúHydra‚Äù) - and what it eats with it is eaten by programs, many already, probably, know firsthand, althoug...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Breaking a simple quack with Ghidra - Part 1</h1><div class="post__text post__text-html js-mediator-article">  The fact that this is such a beast - <b>Ghidra</b> (‚ÄúHydra‚Äù) - and what <s>it eats with</s> it is eaten by programs, many already, probably, know firsthand, although this tool came to public access quite recently - in March of this year.  I will not bother readers with the description of Hydra, its functionality, etc.  Those who are in the subject, I am sure, have studied all this themselves, and those who are not yet in the subject can do it at any time, since it‚Äôs good now to find detailed information on the web is not difficult.  By the way, one of the aspects of Hydra (the development of plug-ins for it) has already been <a href="https://habr.com/ru/post/444562/">covered</a> in Habr√© (excellent article!) I‚Äôll only give the main links: <br><br><ul><li>  <a href="https://www.nsa.gov/resources/everyone/ghidra/">Official page on the NSA USA website</a> </li><li>  <a href="https://github.com/NationalSecurityAgency/ghidra">Github Project</a> </li><li>  <a href="https://xakep.ru/2019/03/20/nsa-ghidra/">The first review in the magazine "Hacker"</a> </li><li>  <a href="https://www.youtube.com/channel/UC3S8vxwRfqLBdIhgRlDRVzw">Great YouTube channel with Ghidra Parsing</a> </li></ul><br>  So, Hydra is a <em>free cross-platform interactive disassembler and decompiler with a modular structure, with support for almost all major CPU architectures and a flexible graphical interface for working with disassembled code, memory, restored (decompiled) code, debugging symbols, and much more</em> . <br><br>  Let's try something already to break this Hydra! <br><a name="habracut"></a><br><h2>  Step 1. Find and study quacks </h2><br>  As a ‚Äúvictim‚Äù we will find a simple ‚Äúcrackme‚Äù (crackme) program.  I just went to the website <a href="https://crackmes.one/">crackmes.one</a> , indicated the search level = 2-3 (‚Äúsimple‚Äù and ‚Äúmedium‚Äù), the source language of the program = ‚ÄúC / C ++‚Äù and the platform = ‚ÄúMultiplatform‚Äù, as in the screenshot below: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/oz/hh/4w/ozhh4w-nraygltspefvjnyrvpjk.png"><br><br>  The search gave 2 results (in green below).  The first crack was 16-bit and did not start on my Win10 64-bit, but the second one ( <b>level_2 by seveb</b> ) came up.  You can download it from <a href="https://crackmes.one/crackme/5ab77f5e33c5d40ad448c789">this link</a> . <br><br>  Download and unpack cracks;  The password for the archive, as indicated on the website, is <b>crackmes.de</b> .  In the archive we find two directories corresponding to Linux and Windows.  On my machine, I go to the Windows directory and meet in it the only executable - <b>level_2.exe</b> .  Let's run and see what it wants: <br><br><img src="https://habrastorage.org/webt/qx/mu/yj/qxmuyjfvnatrgoggnmet17egii8.png"><br><br>  Looks like a bummer!  When you run the program displays nothing.  We try to run again, passing it an arbitrary string as a parameter (what if it is waiting for the key?) - and nothing again ... But do not despair.  Let's assume that we also have to figure out the launch parameters as a task!  It's time to uncover our "Swiss knife" - Hydra. <br><br><h2>  Step 2. Creating a project in Hydra and preliminary analysis </h2><br>  Suppose you already have a Hydra installed.  If not, then everything is simple. <br><br><div class="spoiler">  <b class="spoiler_title">Install ghidra</b> <div class="spoiler_text">  1) Install <a href="https://www.oracle.com/technetwork/java/javase/downloads/2133151">JDK</a> version 11 or higher (I have <a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk12-downloads-5295953.html">12</a> ) <br><br>  2) download Hydra (for example, <a href="https://www.majorgeeks.com/files/details/ghidra.html">from here</a> ) and install it (at the time of this writing, the latest version of Hydra is 9.0.2, I have 9.0.1) <br></div></div><br>  We are launching Hydra and in the opened Project Manager we immediately create a new project;  I gave him the name <b>crackme3</b> (i.e., crackme and crackme2 have already been created).  The project is, in fact, a file directory, you can add any files to study it (exe, dll, etc.).  We will immediately add our level_2.exe ( <b>File | Import</b> or just the <b>I</b> key): <br><br><img src="https://habrastorage.org/webt/sb/gl/_e/sbgl_e0acdolgbxtvjnuohiscua.png"><br><br>  We see that already before the import, Hydra defined our experimental quackery as a 32-bit PE (portable executable) for the Win32 OS and the x86 platform.  After importing our waiting for more information: <br><br><img src="https://habrastorage.org/webt/zb/v0/ga/zbv0gatojwqtmbdejhe6zclenac.png"><br><br>  Here, besides the aforementioned digit capacity, we may still be interested in the <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D1%2580%25D1%258F%25D0%25B4%25D0%25BE%25D0%25BA_%25D0%25B1%25D0%25B0%25D0%25B9%25D1%2582%25D0%25BE%25D0%25B2">order of bytes</a> (endianness), which in our case is <b>Little</b> (from the youngest to the highest byte), which was to be expected for the ‚ÄúIntel‚Äù 86th platform. <br><br>  With the preliminary analysis we finished. <br><br><h2>  Step 3. Perform an automatic analysis. </h2><br>  Time to run a full automatic program analysis in Hydra.  This is done by double clicking on the corresponding file (level_2.exe).  Having a modular structure, Hydra provides all of its core functionality with a system of plug-ins that can be added / disabled or developed independently.  The same with analysis - each plugin is responsible for its own type of analysis.  Therefore, first a window opens in front of us, in which you can select the types of analysis of interest: <br><br><div class="spoiler">  <b class="spoiler_title">Analysis Settings Window</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/p2/aw/sa/p2awsa9slwl8tkbjo0mtcbkgnh8.png"></div></div><br>  For our purposes, it makes sense to leave the default settings and run the analysis.  The analysis itself is performed fairly quickly (it took me about 7 seconds), although users on the forums complain that for large projects Hydra loses its speed in <a href="https://ru.wikipedia.org/wiki/IDA">IDA Pro</a> .  Perhaps this is true, but for small files, this difference is not significant. <br><br>  So, the analysis is complete.  Its results are displayed in the Code Browser window: <br><br><img src="https://habrastorage.org/webt/lh/dy/e5/lhdye5faqmse8w2evahggln5bge.png"><br><br>  This window is essential for working in Hydra, so you should study it more closely. <br><br><div class="spoiler">  <b class="spoiler_title">Code Browser Interface Overview</b> <div class="spoiler_text">  The default interface settings break the window into three parts. <br><br>  In the <b>central part</b> there is the main window - the disassembler listing, which is more or less similar to its ‚Äúbrothers‚Äù in IDA, OllyDbg, etc.  The default columns in this listing are (from left to right): memory address, command opcode, ASM command, ASM command parameters, cross reference (if applicable).  Naturally, the display can be changed by clicking on the button in the form of a brick wall in the toolbar of this window.  To be honest, I have never seen such a flexible configuration of the disassembler output, it is extremely convenient. <br><br>  In the <b>left part</b> 3 of the panel: <br><br><ol><li> Program sections (click on the section to go through the sections) </li><li>  Tree of symbols (imports, exports, functions, titles, etc.) </li><li>  Type tree of used variables </li></ol><br>  For us, the most useful window here is a tree of characters that allows you to quickly find, for example, a function by its name and go to the appropriate address. <br><br>  In the <b>right part</b> is the listing of the decompiled code (in our case in the C language). <br><br>  In addition to the default windows, you can select and place about a dozen other windows and views anywhere in the browser's <b>Window</b> menu.  For convenience, I added a window for viewing memory (Bytes) and a window with a graph of functions (Function Graph) in the central part, and in the right part - string variables (Strings) and a table of functions (Functions).  These windows are now available in separate tabs.  Also, any windows can be detached and made ‚Äúfloating‚Äù, placing and changing their size at their discretion - this is also a very thoughtful, in my opinion, solution. <br></div></div><br><h2>  Step 4. Studying the program's algorithm - the main () function </h2><br>  Well, let's proceed to the direct analysis of our quack programs.  You should start in most cases with searching for the program entry point, i.e.  the main function that is called when it is started.  Knowing that our quacks are written in C / C ++, we guess that the name of the main function will be <b>main ()</b> or something like that :) Spoken-done.  Enter ‚Äúmain‚Äù into the Character Tree filter (in the left panel) and see the <b>_main ()</b> function in the <b>Functions</b> section.  Go to it by clicking the mouse. <br><br><h3>  Overview of the main () function and renaming of obscure functions </h3><br>  In the disassembler listing, the corresponding code section is immediately displayed, and on the right we see the decompiled C code of this function.  Here it is worth noting another convenient Hydra chip - the synchronization of the selection: when the mouse selects the range of ASM commands, the corresponding code section in the decompiler is highlighted and vice versa.  In addition, if the memory browser is open, the allocation is synchronized with the memory.  As they say, all ingenious is simple! <br><br>  I will immediately note an important feature of work in Hydra (as opposed to, say, work in IDA).  <em>Work in Hydra is focused, first of all, on the analysis of decompiled code</em> .  For this reason, the creators of Hydra (we remember - talking about spies from the NSA :)) paid great attention to the quality of decompilation and the convenience of working with the code.  In particular, one can proceed to the definition of functions, variables and sections of memory simply by double-clicking in the code.  Also, any variable and function can be immediately renamed, which is very convenient, since default names do not carry a meaning and can be confusing.  As you will see later, we will use this mechanism often. <br><br>  So, we have the <b>main ()</b> function, which Hydra ‚Äúprepared‚Äù as follows: <br><br><div class="spoiler">  <b class="spoiler_title">Main () listing</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __cdecl _main(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _Argc,<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **_Argv,<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **_Env) { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bVar1; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> iVar2; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *_Dest; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> sVar3; FILE *_File; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **ppcVar4; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> local_18; ___main(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_Argc == <span class="hljs-number"><span class="hljs-number">3</span></span>) { bVar1 = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; _Dest = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)_text(<span class="hljs-number"><span class="hljs-number">0x100</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); local_18 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (local_18 &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bVar1) { _text(_Dest,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x100</span></span>); _text(_Dest,_Argv[local_18],<span class="hljs-number"><span class="hljs-number">0x100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } sVar3 = _text(_Argv[local_18]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((sVar3 == <span class="hljs-number"><span class="hljs-number">2</span></span>) &amp;&amp; (((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)*_Argv[local_18] &amp; <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>U) == <span class="hljs-number"><span class="hljs-number">0x2d</span></span>)) &amp;&amp; (((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)_Argv[local_18][<span class="hljs-number"><span class="hljs-number">1</span></span>] &amp; <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>U) == <span class="hljs-number"><span class="hljs-number">0x66</span></span>)) { bVar1 = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } local_18 = local_18 + <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((bVar1) &amp;&amp; (*_Dest != <span class="hljs-number"><span class="hljs-number">0</span></span>)) { _File = _text(_Dest,<span class="hljs-string"><span class="hljs-string">"rb"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_File == (FILE *)<span class="hljs-number"><span class="hljs-number">0x0</span></span>) { _text(<span class="hljs-string"><span class="hljs-string">"Failed to open file"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } ppcVar4 = _construct_key(_File); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ppcVar4 == (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **)<span class="hljs-number"><span class="hljs-number">0x0</span></span>) { _text(<span class="hljs-string"><span class="hljs-string">"Nope."</span></span>); _free_key((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> **)<span class="hljs-number"><span class="hljs-number">0x0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _text(<span class="hljs-string"><span class="hljs-string">"%s%s%s%s\n"</span></span>,*ppcVar4 + <span class="hljs-number"><span class="hljs-number">0x10d</span></span>,*ppcVar4 + <span class="hljs-number"><span class="hljs-number">0x219</span></span>,*ppcVar4 + <span class="hljs-number"><span class="hljs-number">0x325</span></span>,*ppcVar4 + <span class="hljs-number"><span class="hljs-number">0x431</span></span>); _free_key(ppcVar4); } _text(_File); } _text(_Dest); iVar2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { iVar2 = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> iVar2; }</code> </pre> <br></div></div><br>  It seems to be okay - the definition of variables, standard C-types, conditions, cycles, function calls.  But looking more closely at the code, we notice that for some reason the names of some functions were not defined and replaced by the <b>_text ()</b> pseudo- <b>function</b> (in the decompiler window - <b>.text ()</b> ).  Let's start by defining what these functions are. <br><br>  Double-click on the body of the first call. <br><br><pre> <code class="cpp hljs"> _Dest = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)_text(<span class="hljs-number"><span class="hljs-number">0x100</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br>  we see that this is just a wrapper function around the standard <a href="http://www.cplusplus.com/reference/cstdlib/calloc/">calloc ()</a> function, which serves to allocate memory for data.  So let's just rename this function to <b>calloc2 ()</b> .  Having placed the cursor on the function header, we call the context menu and select the <b>Rename function</b> (hot key - <b>L</b> ) and enter a new name in the opened field: <br><br><img src="https://habrastorage.org/webt/nz/q1/3z/nzq13zx8ddn0vsbvni8mkpencyc.png"><br><br>  We see that the function was immediately renamed.  Go back to the body of <b>main ()</b> (the <b>Back</b> button in the toolbar or <b>Alt + &lt;-</b> ) and see that instead of the mysterious <b>_text () there is</b> already <b>calloc2 ()</b> .  Fine! <br><br>  We do the same with all the other wrapper functions: alternately, we go over their definition, see what they do, rename (I added index 2 to the standard C-function names) and go back to the main function. <br><br><h3>  We comprehend the function code main () </h3><br>  All right, with not clear functions have understood.  We start to study the code of the main function.  Skipping variable declarations, we see that the function returns the value of the variable iVar2, which is zero (a sign of the success of the function) only if the condition specified by the string is met <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_Argc == <span class="hljs-number"><span class="hljs-number">3</span></span>) { ... }</code> </pre><br>  <b>_Argc</b> is the number of command line parameters (arguments) passed to <b>main ()</b> .  That is, our program "eats" 2 arguments (the first argument, we remember, is always the path to the executable file). <br><br>  OK, go ahead.  Here we create a C-string ( <b>char</b> array) of 256 characters: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *_Dest; _Dest = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)calloc2(<span class="hljs-number"><span class="hljs-number">0x100</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  new char[256]  C++</span></span></code> </pre><br>  Next we have a cycle of 3 iterations.  In it, we first check whether the <b>bVar1</b> flag is <b>set,</b> and if so, copy the following command line argument (string) to <b>_Dest</b> : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/*    .  */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bVar1) { <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> memset2(_Dest,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0x100</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*    _Dest    */</span></span> strncpy2(_Dest,_Argv[i],<span class="hljs-number"><span class="hljs-number">0x100</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } ... }</code> </pre><br>  This flag is set when analyzing the following argument: <br><br><pre> <code class="cpp hljs">n_strlen = strlen2(_Argv[i]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((n_strlen == <span class="hljs-number"><span class="hljs-number">2</span></span>) &amp;&amp; (((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)*_Argv[i] &amp; <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>U) == <span class="hljs-number"><span class="hljs-number">0x2d</span></span>)) &amp;&amp; (((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)_Argv[i][<span class="hljs-number"><span class="hljs-number">1</span></span>] &amp; <span class="hljs-number"><span class="hljs-number">0x7fffffff</span></span>U) == <span class="hljs-number"><span class="hljs-number">0x66</span></span>)) { bVar1 = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre><br>  The first line calculates the length of this argument.  The condition further checks that the length of the argument must be 2, the penultimate character == "-", and the last character == "f".  Notice how the decompiler ‚Äútranslated‚Äù the extraction of characters from a string using a byte mask. <br><blockquote>  The decimal values ‚Äã‚Äãof the numbers, and at the same time the corresponding ASCII characters can be spied on by holding the cursor over the corresponding hexadecimal literal.  ASCII mapping does not always work (?), So I recommend looking at the ASCII table on the Internet.  It is also possible directly in Hydra to convert scalars from any number system to any other (via the context menu -&gt; <b>Convert</b> ), in this case, this number will be displayed everywhere in the selected number system (in the disassembler and in the decompiler);  but personally, I prefer to leave hexes in the code for slimming work, because  memory addresses, offsets, etc.  everywhere are given hexes. <br></blockquote>  After the loop goes this code: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((bVar1) &amp;&amp; (*_Dest != <span class="hljs-number"><span class="hljs-number">0</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">/*    1) "-f"  2)  -         */</span></span> _File = fopen2(_Dest,<span class="hljs-string"><span class="hljs-string">"rb"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_File == (FILE *)<span class="hljs-number"><span class="hljs-number">0x0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/*  1    */</span></span> perror2(<span class="hljs-string"><span class="hljs-string">"Failed to open file"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } ... }</code> </pre><br>  Here I immediately added comments.  We check the correctness of the arguments ("-f path_to_file") and open the corresponding file (the 2nd passed argument, which we copied to _Dest).  The file will be read in binary format, as indicated by the ‚Äúrb‚Äù parameter of the <a href="http://www.cplusplus.com/reference/cstdio/fopen/">fopen ()</a> function.  If a read error occurs (for example, the file is unavailable) an error message is output to the stderror stream and the program is terminated with code 1. <br><br>  Further - the most interesting: <br><br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">/* !!!     !!! */</span></span> ppcVar3 = _construct_key(_File); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ppcVar3 == (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **)<span class="hljs-number"><span class="hljs-number">0x0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/*    ,  "Nope" */</span></span> puts2(<span class="hljs-string"><span class="hljs-string">"Nope."</span></span>); _free_key((<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> **)<span class="hljs-number"><span class="hljs-number">0x0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">/*    -      */</span></span> printf2(<span class="hljs-string"><span class="hljs-string">"%s%s%s%s\n"</span></span>,*ppcVar3 + <span class="hljs-number"><span class="hljs-number">0x10d</span></span>,*ppcVar3 + <span class="hljs-number"><span class="hljs-number">0x219</span></span>,*ppcVar3 + <span class="hljs-number"><span class="hljs-number">0x325</span></span>,*ppcVar3 + <span class="hljs-number"><span class="hljs-number">0x431</span></span>); _free_key(ppcVar3); } fclose2(_File);</code> </pre><br>  The open file descriptor ( <b>_File</b> ) is passed to the <b>_construct_key ()</b> function, which, obviously, performs the check of the key to be found.  This function returns a two-dimensional byte array ( <b>char **</b> ), which is stored in the variable <b>ppcVar3</b> .  If the array is empty, a concise ‚ÄúNope‚Äù is output to the console (that is, in our opinion, ‚ÄúNah!‚Äù) And the memory is freed.  Otherwise (if the array is not empty), a seemingly valid key is displayed and the memory is also freed.  At the end of the function, the file descriptor is closed, the memory is freed and the <b>iVar2</b> value is <b>returned</b> . <br><br>  So now we understand what we need: <br><br>  <i>1) create a binary file with the correct key;</i> <i><br></i>  <i>2) pass his path to the quacks after the argument "-f"</i> <br><br>  In the <a href="https://habr.com/ru/post/447488/">second part of the article,</a> we will analyze the function <b>_construct_key ()</b> , which, as we found out, is responsible for checking the desired key in the file. </div><p>Source: <a href="https://habr.com/ru/post/447450/">https://habr.com/ru/post/447450/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447438/index.html">Unittest and abstract tests</a></li>
<li><a href="../447440/index.html">RBKmoney Payments under the hood - the logic of the payment platform</a></li>
<li><a href="../447442/index.html">Introducing shell-operator: it's even easier to create operators for Kubernetes</a></li>
<li><a href="../447446/index.html">IBM workshops: spring-summer 2019 - artificial intelligence, development in the cloud, chat bots, blockchain and other technologies</a></li>
<li><a href="../447448/index.html">Evolution of the intellect: the beginning</a></li>
<li><a href="../447452/index.html">Supply Chain Security: "If I were a Nation State ..."</a></li>
<li><a href="../447454/index.html">Seven-segment display control using FPGA</a></li>
<li><a href="../447456/index.html">How accurately does Yandex forecast rainfall in the winter? Analyzing the accuracy of forecast services.</a></li>
<li><a href="../447458/index.html">How new words are created in modern English</a></li>
<li><a href="../447464/index.html">What prevents to learn a foreign language</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>