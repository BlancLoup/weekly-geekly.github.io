<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We create a simple, compact and cheap Internet radio station</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Software platform will be Linux, for simplicity, it is better to use something common, with a lot of information on the Internet, if suddenly somethin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We create a simple, compact and cheap Internet radio station</h1><div class="post__text post__text-html js-mediator-article"> Software platform will be Linux, for simplicity, it is better to use something common, with a lot of information on the Internet, if suddenly something goes wrong.  Iron for an Internet radio station can be anything, a full-fledged server with your projects, some old laptop, or a netbook, we want cheap, and we do not need special performance from hardware. <br><br>  If there is nothing like that at hand, or we need a completely silent server, why not try using a mini-computer? <br><br>  Something like Raspberry Pi 3? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      No, we want cheaper, so we need something like the Orange Pi.  I found a Orange Pi Pc Plus model with 1GB DDR3 RAM and 8GB EMMC Flash. <br><br><img src="https://habrastorage.org/webt/ew/ry/mf/ewrymf0vj-86hqfa2v8e7rrmjks.png"><a name="habracut"></a><br><br>  UPD: Yesterday, everyone somehow took the article too seriously, but in fact the experiment was carried out for the sake of a fan, to see whether it turned out or not.  Naturally, there is no talk of any ‚Äúindustrial‚Äù use, it's like trying to voice the stadium with an ordinary music center. <br><br>  What else can we need? <br><br>  I want to try to configure everything in a simple way, so I still need a twisted pair to the router and a Micro SD memory card, since the operating system cannot be installed directly on the micro computer.  I found a 8 gigabyte memory card, this volume is enough. <br><br>  So, the first thing you need to write the image of the operating system on the memory card. <br>  For servers, I prefer to use time-tested Debian (yes, the younger generation most likely prefers CentOS, but gray-bearded people agree with me that Debian is still very good). <br><br>  In general, there is a huge amount of ready-made images for Orange Pi on <a href="http://www.orangepi.org/downloadresources">www.orangepi.org/downloadresources</a> , but I still go to <a href="https://www.armbian.com/download">www.armbian.com/download</a> and <a href="https://dl.armbian.com/orangepipcplus">download the</a> torrent file with armbian from dl.armbian.com/orangepipcplus (in my case of Debian_stretch_next.7z). <br><br>  I have an Orange Pi Pc Plus, you can have any other mini computer, so look for the appropriate image. <br><br>  After downloading, unpack the archive and see the image in img format.  Who wants what, and the image fills, I personally prefer Etcher (https://etcher.io).  They inserted a memory card, chose it if you have several carriers connected, pressed the sew button, entered the password if you also have Linux on your desktop or laptop. <br><br><img src="https://habrastorage.org/webt/lq/3w/3y/lq3w3yteie6cz8jage7vau5zssw.png"><br><br>  The map with the image is ready, you can start to connect everything. <br>  What do we need to start and start setting up our server? <br>  Itself a mini computer, Internet via Ethernet wire and power supply. <br>  And that's all. <br><br>  No, of course you can get stuck, connect the monitor and keyboard and configure everything directly, but I prefer the keyboard of my laptop, so I will configure my mini computer remotely via SSH. <br><br>  So let's get started, plug in an Ethernet cable, a Micro SD card with an Armbian image. <br>  It remains only to apply power to the mini computer. <br><br>  But with the power on the Orange Pi, everything is very sad.  What is on a normal mini computer?  Right, Micro-USB, and how can I power the Orange Pi?  Only 5V through pin connector, which is purchased separately. <br><br>  A power adapter with a suitable plug is more expensive than just a wire with a standard USB at the end, so you can take it. <br><br>  If there is no free power supply with USB (and we need not anyhow what, but 2 amps), then we dig in our mailbox with wires, adapters and motherboards for computers (you also have such a box, right?) And find a suitable adapter from of an old tablet, long broken by a child, we rewire the cable and the power for our server is ready. <br><br>  Well, or just take the charger from the old iRiver disk mp3 player (it is only 4.7 volts and 1.2 amps, but it also works). <br><br>  We supply power and we are ready to go, strictly speaking, to the point for which everything was started, to create an Internet radio station. <br><br>  If you, like me, intend to do with a minimum of peripherals, then we need to find out what IP address our mini computer received.  The easiest way to find it out is to log into your router and see what IP address the router gave to our server (does your router know how to use DHCP, right?). <br><br>  Now you can log in via SSH to our server.  To whom the SSH client is convenient, he uses that one (doesn‚Äôt you have windows, and as for SSH clients, I don‚Äôt know about it at all). <br>  In my case, I just slaughter ssh root@192.168.0.88 in the console, agree to add the ECDSA key, the default password for root is ‚Äú1234‚Äù, after logging in we find ourselves in the console of the microcomputer, which immediately suggests changing the root password. <br><br><img src="https://habrastorage.org/webt/gu/nz/c0/gunzc0ewl71jcxyhwrvoeegqpvc.png"><br><br>  After that, it is proposed to create an unprivileged user account, create it. <br>  Compared with previous versions of the OS, the current version is somewhat simplified in terms of settings and a lot of things are already configured automatically. <br><br>  Armbian has a very handy setup tool: <code>armbian-config</code> copy the command to the console and see what may come in handy. <br><br><img src="https://habrastorage.org/webt/ow/nr/yi/ownryigiv-au8gowgrfhvcetduk.png"><br><br>  We don‚Äôt need the system settings yet, but they may need them later, for example, to transfer a tuned system from Micro SD to the built-in 8GB EMMC Flash memory of a mini computer. <br><br>  The Network section will be useful to us, after all it would be nice to have a server with a static IP address.  Our Internet radio station can be connected to the network even via Wi-Fi.  Everyone establishes the level of perversion himself, but if you build Internet radio purely for yourself and you don‚Äôt plan more than 10 listeners at the same time, then why not pick up our server via Wi-Fi?  In extreme cases, you can plug in an Ethernet cable at any time. <br><br>  So, we decided on the connection type, now we need to configure a static IP address, for this we go to the IP settings and select the desired network interface, after which we say that we want a static address, we start it and save the settings.  There is no need to change the mask and gateway, as they are received from your router via DHCP. <br><br><img src="https://habrastorage.org/webt/b0/gp/qv/b0gpqvib6trft_pkir827aj8d3m.png"><br><br>  After you enter a new IP address and press Enter, your SSH session will immediately hang, as the device will immediately receive a new IP address.  Therefore, simply close the window with the terminal and go to our mini computer via SSH using the new IP address. <br><br>  By the way, since all the functions we will have are administrative in nature, in order not to write constantly before each sudo command, I simply log in to the mini computer as root. <br><br>  By running <code>armbian-config</code> again, we can see what else can be configured?  In the Personal section we can configure the time zone, locale and host name.  I added the ru_RU.UTF-8 UTF-8 locale, it suddenly comes in handy. <br><br>  To apply the settings, you need to exit the settings utility, log out and log in again, or restart the server using the reboot command. <br><br>  I used the reboot command to make sure that the settings were saved and the server started successfully with them. <br><br>  The basic server setup is done and why not install a microSD-based OS on the internal EMMC Flash memory?  Of course, if your mini computer has this very memory on board. <br><br>  To do this, go to <code>armbian-config</code> - System - Install, select an available drive, click Enter, get hi from the past, agree and choose the type of the ext4 file system. <br><br><img src="https://habrastorage.org/webt/yt/g4/ut/ytg4utinyttwtqoftarwnu-btv8.png"><br><br>  Now we can sit back and wait until the OS is transferred to the internal storage of the mini computer. <br><br><img src="https://habrastorage.org/webt/es/rz/0x/esrz0x4sqck7jn3sggbx6bba_yi.png"><br><br>  After copying is complete, select power off.  We wait a couple of seconds until the LED on the mini computer goes out, pull out the power, remove the MicroSD card, stick the power back in and turn on the computer. <br><br>  Yes, if you do not have an internal memory and you did not transfer the operating system to it, pulling out a MicroSD will most likely not be a very good idea. <br><br>  After logging into our mini computer via SSH and making sure that everything works, you can begin to tune the radio station itself. <br><br>  First of all we update information about packages by typing <code>apt update</code> into the server console. <br><br>  Yes, I love comfort, so I install mc with <code>apt install mc</code> . <br>  I love to do everything from under mc, and if I need to see the console, I just press ctrl + o. <br><br>  First install the daemon music player itself: <code>apt install mpd</code> . <br>  Together with him a lot of dependencies will be established. <br><br>  Let's go to the setting.  The /etc/mpd.conf file is responsible for the configuration of the daemon, open it with the <code>nano /etc/mpd.conf</code> command <code>nano /etc/mpd.conf</code> . <br><br>  My username is without hzs privileges, and my configuration file looks like this: <br><br><pre> <code class="php hljs">music_directory <span class="hljs-string"><span class="hljs-string">"/home/hzs/music"</span></span> playlist_directory <span class="hljs-string"><span class="hljs-string">"/home/hzs/.mpd/playlists"</span></span> db_file <span class="hljs-string"><span class="hljs-string">"/home/hzs/.mpd/tag_cache"</span></span> log_file <span class="hljs-string"><span class="hljs-string">"/home/hzs/.mpd.log"</span></span> pid_file <span class="hljs-string"><span class="hljs-string">"/home/hzs/.mpd/pid"</span></span> state_file <span class="hljs-string"><span class="hljs-string">"/home/hzs/.mpd/state"</span></span> sticker_file <span class="hljs-string"><span class="hljs-string">"/var/lib/mpd/sticker.sql"</span></span> user <span class="hljs-string"><span class="hljs-string">"hzs"</span></span> bind_to_address <span class="hljs-string"><span class="hljs-string">"localhost"</span></span> restore_paused <span class="hljs-string"><span class="hljs-string">"yes"</span></span> metadata_to_use <span class="hljs-string"><span class="hljs-string">"artist,title"</span></span> auto_update <span class="hljs-string"><span class="hljs-string">"yes"</span></span> audio_output { type <span class="hljs-string"><span class="hljs-string">"httpd"</span></span> name <span class="hljs-string"><span class="hljs-string">"My New Internet Radio Station!!!"</span></span> encoder <span class="hljs-string"><span class="hljs-string">"lame"</span></span> <span class="hljs-comment"><span class="hljs-comment"># optional, vorbis or lame port "8000" bind_to_address "0.0.0.0" # optional, IPv4 or IPv6 bitrate "256" # do not define if quality is defined format "44100:16:2" } volume_normalization "yes" filesystem_charset "UTF-8" id3v1_encoding "UTF-8"</span></span></code> </pre> <br>  Everything is clear and without any comments. <br><br>  To work, you need to create a directory structure from the top of the settings.  Please note that the owner for these directories should be an unprivileged user, from which everything will work, in my case hzs. <br><br>  From under root execute the following commands: <br><br> <code>chown -cR hzs:hzs /home/hzs/music</code> <br> <code>chown -cR hzs:hzs /home/hzs/.mpd</code> <br> <br>  It's time to upload music, we have SSH on the server, so we can connect with our favorite FTP client to our server. <br><br>  We know the IP address, port 22, the username and password that you specified when creating an unprivileged user, the type of SSH connection.  Fill some music for the test in the directory for music specified in the config. <br><br><img src="https://habrastorage.org/webt/hs/x6/wy/hsx6wyhf98bmwv5bvy5kkpdvogi.png"><br><br>  Now the player is running with the wrong config, so stop the daemon and run it again: <br><br> <code>service mpd stop</code> <br> <code>service mpd start</code> <br> <br>  For the simplest daemon control, we <code>apt install mpc</code> console utility with <code>apt install mpc</code> . <br><br>  After installation we will configure the player a bit: <br><br> <code>mpc random on</code> <br> <code>mpc repeat on</code> <br> <br>  Now you need to add tracks to a playlist, in the console it is somewhat gimorreyno, but nothing can be done. <br><br>  We look at the files available to us, which we can add to the playlist: <br><br> <code>mpc ls</code> <br> <br>  To add a file to the playlist, in the <code>mpc add</code> command we must specify the full name of the file being added, the selection by mask does not work: <br><br> <code>mpc add "01 Lost in Your Eyes.mp3"</code> <br> <br>  Watch the resulting playlist: <br><br> <code>mpc playlist</code> <br> <br>  It's time to launch our radio station: <br><br> <code>mpc play</code> <br> <br><img src="https://habrastorage.org/webt/8p/gc/j5/8pgcj5ce-fqssnegu8svkdjqxwu.png"><br><br>  Let's try to listen, for this we open the audio stream of our radio station in any audio player.  To do this, enter the address of the stream <code>http://ip:port</code> , I have it <code>http://192.168.0.90:8000</code> . <br><br>  Audacious played intermittently, there was a problem with caching, but SMPlayer and VLC did not feel any problems. <br><br><img src="https://habrastorage.org/webt/do/y_/e8/doy_e8rrunt7km5_eqddovxtp0c.png"><br><br><img src="https://habrastorage.org/webt/pl/dc/ec/pldcecft-jdoram8ixgsqbupi7o.png"><br><br><img src="https://habrastorage.org/webt/ff/j4/np/ffj4nptgv3ma90bakt63oyciqys.png"><br><br>  In principle, at this stage, our Internet radio station is already working, you need to add music to the playlist and forward the ports on the router, so that our Internet radio station becomes an Internet radio station, and not a radio on the local network. <br><br>  I have several domains, so first of all I create an ‚ÄúA‚Äù entry in the DNS settings with testradio and the static external IP address of my router at home.  You do not need to do this. <br><br>  Next, on my router, I configure port forwarding. <br><br>  Since I already have my own radio station on a large server, I specify the external source port 9000, and the internal local 8000, so from the outside the radio station will broadcast on <code>http://_ip:9000</code> . <br><br><img src="https://habrastorage.org/webt/z5/h5/vf/z5h5vf6bgcfm0k1t464-y9e1dlq.png"><br><br>  Everything, now we got a ‚Äúreal‚Äù Internet radio station. <br><br>  If you do not want to stop there, go further. <br><br>  We do not broadcast the voice of a DJ, but if necessary it can be implemented, but what is really needed is a convenient interface for managing the playlist. <br><br>  There are a bunch of management consoles, some can be <a href="https://musicpd.org/clients/">seen here</a> , but I will use the <a href="https://sourceforge.net/projects/pitchforkmpd/">Pitchfork MPD Client</a> . <br><br>  This is a full web snout, and yes, we will shoot a cannon at the sparrows and raise a full http server on the mini computer with our radio station: <br><br> <code>apt install apache2</code> <br> <br>  We also need PHP: <br><br> <code>apt-get install php</code> <br> <br>  More need <br><br> <code>apt install php7.0-xml</code> <br> <br>  and <br><br> <code>apt install php-pear</code> <br> <br>  Create the / home / hzs / wwwroot / pf directory in the home folder and unpack the pre-loaded SSH Pitchfork MPD Client into it. <br><br><img src="https://habrastorage.org/webt/vt/3j/wh/vt3jwhnfoip8vuciat5mtbjja44.png"><br><br>  In the apache2 web server configuration file /etc/apache2/sites-available/000-default.conf <br> <code>nano /etc/apache2/sites-available/000-default.conf</code> <br>  we mow and write everything (remembering to change ‚Äúhzs‚Äù in the name of your user): <br><br><pre> <code class="php hljs">&lt;VirtualHost *:<span class="hljs-number"><span class="hljs-number">80</span></span>&gt; ServerName localhost ServerAdmin webmaster@localhost DocumentRoot /home/hzs/wwwroot &lt;Directory /home/hzs/wwwroot/&gt; Options All AllowOverride All DirectoryIndex index.php index.html index.htm Order Allow,Deny Allow from All <span class="hljs-keyword"><span class="hljs-keyword">Require</span></span> all granted &lt;/Directory&gt; &lt;/VirtualHost&gt;</code> </pre> <br>  Then we reboot the http server <br><br> <code>service apache2 restart</code> <br> <br>  Having come to the address of the IP / pf server (in my case: <code>http://192.168.0.90/pf</code> ) <br><br>  We will see the control panel: <br><br><img src="https://habrastorage.org/webt/wf/ch/a-/wfcha-qsfl5kbftdhelmpue4a0s.png"><br><br>  Everything is quite simple and intuitive. <br><br>  Next, click on the folder icon on the right and the Filesystem tab. <br><br>  To update the file list, press the Update DB button, then select the remaining files that we still lack in the playlist and click the Add button just below. <br><br>  We update the page and see that all the files we have added to the playlist: <br><br><img src="https://habrastorage.org/webt/d4/iz/vm/d4izvmjxin4-aapy4fxwvelnbxk.png"><br><br>  If you want to hide the player control under the password, you can edit the configuration file: <br><br> <code>nano /home/hzs/wwwroot/pf/config/config.xml</code> <br> <br>  There is a clear structure of settings. <br><br>  So, we have a full-fledged Internet radio server with a size of 10 * 7 * 3 centimeters.  Of course, using a low-powered server will not pull hundreds of listeners, but at least it will not leave you without your favorite music wherever you are, if there is an Internet nearby. <br><br>  In principle, you can not continue to read, but for particularly persistent we continue on. <br>  We also have a full-fledged web server, why ... <br>  Well, you already understood. <br><br>  Create the testradio directory in the root of our web server, create the <code>"index.php"</code> file in it: <br><br><pre> <code class="php hljs">&lt;!DOCTYPE html&gt; &lt;html xmlns=<span class="hljs-string"><span class="hljs-string">"https://www.w3.org/1999/xhtml"</span></span> xml:lang=<span class="hljs-string"><span class="hljs-string">"ru-ru"</span></span> lang=<span class="hljs-string"><span class="hljs-string">"ru-ru"</span></span> dir=<span class="hljs-string"><span class="hljs-string">"ltr"</span></span>&gt; &lt;head&gt; &lt;meta http-equiv=<span class="hljs-string"><span class="hljs-string">"content-type"</span></span> content=<span class="hljs-string"><span class="hljs-string">"text/html; charset=utf-8"</span></span> /&gt; &lt;title&gt;My Test Radio&lt;/title&gt; &lt;script src=<span class="hljs-string"><span class="hljs-string">"jquery-3.3.1.min.js"</span></span>&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;My Test Radio&lt;/h1&gt; &lt;div id=<span class="hljs-string"><span class="hljs-string">"song"</span></span>&gt; now playing:&lt;br&gt; &lt;div id=<span class="hljs-string"><span class="hljs-string">"title"</span></span>&gt;now playing&lt;/div&gt; &lt;br&gt; &lt;div&gt; &lt;span id=<span class="hljs-string"><span class="hljs-string">"play"</span></span> type=<span class="hljs-string"><span class="hljs-string">"button"</span></span>&gt;Play&lt;/span&gt; &lt;span id=<span class="hljs-string"><span class="hljs-string">"pause"</span></span> type=<span class="hljs-string"><span class="hljs-string">"button"</span></span>&gt;Pause&lt;/span&gt; &lt;/div&gt; &lt;br&gt; &lt;div&gt; vol:&lt;br&gt; &lt;input id=<span class="hljs-string"><span class="hljs-string">"volume"</span></span> type=<span class="hljs-string"><span class="hljs-string">"range"</span></span> min=<span class="hljs-string"><span class="hljs-string">"0"</span></span> max=<span class="hljs-string"><span class="hljs-string">"10"</span></span> value=<span class="hljs-string"><span class="hljs-string">"5"</span></span> /&gt; &lt;/div&gt; &lt;span id=<span class="hljs-string"><span class="hljs-string">"duration"</span></span>&gt;&lt;/span&gt; &lt;br&gt; &lt;div&gt;<span class="hljs-number"><span class="hljs-number">256</span></span> kbps&lt;/div&gt; &lt;/div&gt; &lt;script language=<span class="hljs-string"><span class="hljs-string">"JavaScript"</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> audio = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Audio(<span class="hljs-string"><span class="hljs-string">'http://testradio.nisel.ru:9000'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> play = document.getElementById(<span class="hljs-string"><span class="hljs-string">'play'</span></span>); play.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ audio.play(); }, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pause = document.getElementById(<span class="hljs-string"><span class="hljs-string">'pause'</span></span>); pause.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ audio.pause(); }, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> volume = document.getElementById(<span class="hljs-string"><span class="hljs-string">'volume'</span></span>); volume.addEventListener(<span class="hljs-string"><span class="hljs-string">'change'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ audio.volume = parseFloat(this.value / <span class="hljs-number"><span class="hljs-number">10</span></span>); }, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); audio.addEventListener(<span class="hljs-string"><span class="hljs-string">"timeupdate"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> duration = document.getElementById(<span class="hljs-string"><span class="hljs-string">'duration'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> s = parseInt(audio.currentTime % <span class="hljs-number"><span class="hljs-number">60</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> m = parseInt((audio.currentTime / <span class="hljs-number"><span class="hljs-number">60</span></span>) % <span class="hljs-number"><span class="hljs-number">60</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> h = parseInt((audio.currentTime / <span class="hljs-number"><span class="hljs-number">3600</span></span>) % <span class="hljs-number"><span class="hljs-number">60</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) s = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + s; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) m = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + m; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (h &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) h = <span class="hljs-string"><span class="hljs-string">'0'</span></span> + h; duration.innerHTML = h + <span class="hljs-string"><span class="hljs-string">':'</span></span> + m + <span class="hljs-string"><span class="hljs-string">':'</span></span> + s; }, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); &lt;/script&gt; &lt;script language=<span class="hljs-string"><span class="hljs-string">"JavaScript"</span></span>&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $.ajax({ url: <span class="hljs-string"><span class="hljs-string">"trackname.php"</span></span>, cache: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, success: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(html)</span></span></span></span>{ $(<span class="hljs-string"><span class="hljs-string">"#title"</span></span>).html(html); } }); } $(document).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ show(); setInterval(<span class="hljs-string"><span class="hljs-string">'show()'</span></span>,<span class="hljs-number"><span class="hljs-number">5000</span></span>); }); &lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre> <br>  This is the simplest example of creating a player for a site, as well as it can display the name of the current composition, updated with ajax every 5 seconds. <br><br>  Appearance can be finished to taste with the help of css. <br><br>  The code shows that the audio stream is already going to the address specified in the DNS of my domain. <br>  Do not forget to upload the jquery file (in my case jquery-3.3.1.min.js) to the directory.  In general, of course, jquery is brute force and you could make an ajax request without it, but it turned out to be too lazy to think and I used a ready-made piece of code. <br><br>  Next, create the file <code>"trackname.php"</code> : <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> file_get_contents(<span class="hljs-string"><span class="hljs-string">'http://192.168.0.90/mpc'</span></span>);<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  Also in the root of the web server we create the directory ‚Äúmpc‚Äù and in it the file <code>"index.php"</code> : <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> exec(<span class="hljs-string"><span class="hljs-string">'mpc current'</span></span>);<span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  Why such crutches may be asked by some, the fact is that in my battle radio station the player server is on one server, and the web site muzzle is on a physically different web server. <br><br><img src="https://habrastorage.org/webt/sl/mg/eq/slmgeqlpij1qqccf75z2yfurvy4.png"><br><br>  Since you need to poll the track being played directly on the server with the player, the mpc server web directory should be on it, and the file <code>"trackname.php"</code> is on the web server of the site itself and loads the file with the description of the track from another server by its IP address. <br><br>  The player itself and the site of the radio station may be very far from each other and communicate both by external IP addresses and by addresses clogged in the DNS.  For everything to work, you just need to correctly forward ports. <br><br>  You can refine the project to your liking, well, I spent a pleasant Saturday half of the day. <br>  All successful experiments! <br><br>  <b>UPD2: The week-long experiment came to its logical conclusion, and I turn off my mini server with a radio station.</b> </div><p>Source: <a href="https://habr.com/ru/post/426349/">https://habr.com/ru/post/426349/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../426339/index.html">October 25, 2018 Atlassian User Group meeting in Raiffeisenbank</a></li>
<li><a href="../426341/index.html">Memoization of default kwarg in Python</a></li>
<li><a href="../426343/index.html">The rules of gentlemanly behavior in IT: the history of ITIL</a></li>
<li><a href="../426345/index.html">Interesting tasks from technical interviews</a></li>
<li><a href="../426347/index.html">ITMO University Digest: New Research, Alumni Experience and International Projects</a></li>
<li><a href="../426351/index.html">Microsoft Certification and Exam Changes</a></li>
<li><a href="../426355/index.html">Math.Sin (double) function for GPU</a></li>
<li><a href="../426357/index.html">Unity & Vive: Tutorial</a></li>
<li><a href="../426359/index.html">Yandex anti-piracy initiative not approved by copyright holders</a></li>
<li><a href="../426361/index.html">About the awesomeness of the bee, and how we kill it</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>