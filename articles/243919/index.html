<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>And once again about the recognition of numbers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the spring, the administration of Habr kindly provided us with a blog so that we would tell about our exercise with room recognition. All the maint...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>And once again about the recognition of numbers</h1><div class="post__text post__text-html js-mediator-article">  In the spring, the administration of Habr kindly provided us with a blog so that we would tell about our exercise with room recognition.  All the maintenance of this system was done simply out of interest and enthusiasm, but it allowed us to communicate with interesting people, help some people, and find a part-time job on completely different topics. <br><br><img src="https://habrastorage.org/files/f3a/da8/27b/f3ada827b5c848078ba8cd7d7e32e5c6.jpg"><br><br>  In any image processing tasks, 90% of success is a good database.  Representative and large.  In the spring, we promised to post a full database of images of what will come to us.  Subscribe blog ends, so the time to fulfill the promise (the blog may be extended, or maybe not).  Our server worked 95% of the time, starting with the first post.  All that has come is now available + we have made separate bases on the cut numbers and cut symbols. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Under the link to the base + its analysis + some code + a small story about what will be done next with our server / project life. <br><a name="habracut"></a><br><h4>  Base itself </h4><br>  Bases by numbers we are not marked (anywhere there is no file with the correct decryption).  Marked only the base of the characters. <br>  <a href="https://yadi.sk/d/0H2AipxrcrXqy">Base</a> uncircumcised photos of cars (1.4 GB).  Approximately 9,300 frames. <br>  The sizes will be from a couple of hundred pixels to a dozen megapixels.  Pictures look like this: <br><br><img src="https://habrastorage.org/files/004/3f6/387/0043f63877d24474bf8a303edddb1690.jpg"><br><br>  <a href="https://yadi.sk/d/EAfnQ947criHW">Base of</a> excised numbers + counterexamples (260 MB).  Approximately 5000 numbers + 1200 counterexamples. <br><br>  Pictures look like this: <br><br><img src="https://habrastorage.org/files/f88/cc1/a61/f88cc1a61fb947ba8612f35bc2916d6e.jpg"><br><br>  <a href="https://yadi.sk/d/U41QZ8v7cpJ6R">Base</a> cut characters for Russian numbers (60 MB).  Approximately 18 thousand letters, numbers and counterexamples. <br>  * Small addition.  Folder "17" is empty.  It contained the letters ‚ÄúO‚Äù, but the classifiers did not distinguish between it and zero, so we combined them in the folder ‚Äú0‚Äù. <br><br>  Pictures look like this: <br><br><img src="https://habrastorage.org/files/da0/815/e7b/da0815e7b2cd4a589de87e1ba9910fdf.jpg"><img src="https://habrastorage.org/files/36b/940/222/36b940222415409d84e160a9c1d69858.jpg"><img src="https://habrastorage.org/files/af8/21d/a1c/af821da1c2d2445da25a2479615b03f6.jpg"><img src="https://habrastorage.org/files/1c3/b86/ef6/1c3b86ef66ea44c6a84fe9565dc0891b.jpg"><img src="https://habrastorage.org/files/fa8/67d/6bf/fa867d6bfdd443f1bd9493e266fc289e.jpg"><img src="https://habrastorage.org/files/c1a/62d/da3/c1a62dda3c014bce98aa44e2c7181a9e.jpg"><img src="https://habrastorage.org/files/d91/e5c/80a/d91e5c80a7214b7ebbb2f1acc50087e4.jpg"><img src="https://habrastorage.org/files/6b2/54d/3a6/6b254d3a6db14935af04438086ed48bf.jpg"><img src="https://habrastorage.org/files/d53/f11/5dd/d53f115dde6e44ff800f40d6dff52eaf.jpg"><img src="https://habrastorage.org/files/1f5/b5d/e3d/1f5b5de3d5a74cc78ad85410b8638ffb.jpg"><img src="https://habrastorage.org/files/bc1/1e0/9cb/bc11e09cb1344a43956a0b09b5b13b78.jpg"><br><br><h4>  A few words about the base </h4><br>  The base is based on the fact that we collected ourselves + on the fact that we were sent + manual thinning from bad frames.  For the beeches, a sliced ‚Äã‚Äãbase of negative examples is given (folder number 22).  Without a negative sample, the operation of the real algorithm is almost impossible, the letters will be determined at any noise.  The negative sample contains chunks of beeches, without this, the eight-cut in half can be mistaken for three.  At the end of the article there will be an example of such a use of such a base.  A negative sample is also given for the excised numbers, if there are people willing to train a cascade on them. <br><br>  From the minuses of the base: <br><br>  - decent frames taken from the monitor <br>  - some numbers are found more than once <br>  - there are duplicate images, although not very many <br>  - thinning frames for the base with large photographs is imperfect.  Everything came to the server: absolutely irrelevant photographs, empty photographs, photographs with unreadable numbers.  I cleaned most of it, but there might be residues. <br><br><h4>  Why do you need it? </h4><br>  Strangely enough, but the problem of recognition of numbers is relevant in a variety of situations, often not related to numbers.  And, despite the fact that there seem to be dozens of solutions, there are many projects where it needs to be solved independently and from scratch.  Such a base is an aid to such projects. <br><br>  It is also interesting for testing machine recognition and classification algorithms.  Take the same <a href="http://en.wikipedia.org/wiki/MNIST_database">MNIST</a> .  A synthetic task, but still interesting to many.  And here there is the possibility of real application of the trained algorithm. <br><br><h4>  Further life of the project </h4><br>  We are planning to keep the server with number recognition recognized in working condition + sometimes we update the algorithm.  The application on the phones, as we expected, is not particularly fired.  It is available in the <a href="http://habrahabr.ru/company/recognitor/blog/222539/">PlayStore</a> + is a version for the <a href="http://habrahabr.ru/company/recognitor/blog/228195/">iPhone</a> .  The applications are generally working, but we will not do any further support for them.  Yes, and especially a large base did not meet.  The code for <a href="https://github.com/CodeGenerator/Recognitor">both</a> applications is <a href="https://github.com/ZlodeiBaal/Recognitor">open</a> .  If you want, you can finish it yourself. <br>  On the other hand, we were pleasantly surprised that our server was often used as a kind of benchmark for testing our algorithms.  Three times we were driven to the server huge databases.  We do not know exactly who and why.  But, nice.  It can be seen that people spent the time to compare their algorithm with ours, even if they are far from ideal. <br>  Hence the idea: a small piece of the base we left for ourselves.  If suddenly it will be interesting to anyone, we can run the algorithm on our base (or give the base to you), on the terms of non-proliferation of the base and publication of the results.  We will publish the results <a href="http://eye-recognition.ru/platerec.html">here</a> and <a href="https://docs.google.com/spreadsheets/d/1wANpQfbkE1mVC4GMUhMIwIKwVHVw1olB3IbZSbRmwEo/edit%3Fusp%3Dsharing">here</a> , when publishing we put a link to your website / contact. <br>  Non-proliferation of such a test base is necessary to avoid fitting the results, as they do when there are open bases (for example, MNIST). <br><br>  If the blog is extended to us, then the results and evaluation methodology will report on Habr√©. <br><br><h4>  About cascade </h4><br>  We have already asked five times to update the cascade.  You need to spend a few more evenings for this, but now there is no time.  Be sure to do, the ordered base presented here is a big piece of work in this direction.  The new version will appear in our <a href="https://github.com/ZlodeiBaal/Recognitor">repository</a> .  Approximately I will be busy on January holidays, but I can‚Äôt be in time.  In principle, if anyone is not lazy, you can use the base presented here and count on it a cascade.  How to do <a href="http://habrahabr.ru/post/208092/">this is the</a> instruction.  If you do, throw to us, or directly to the githab, we will update the cascade on it. <br><br><h4>  Letter recognition training </h4><br>  Despite the fact that we have published all the logic and algorithms in previous articles, we don‚Äôt want to publish the source codes of the piece where we recognize letter numbers (if we suddenly decide to turn off the server completely, then of course we will publish it). <br><br>  But still, we would like to show you how to recognize numbers quickly and easily.  Therefore, we went through several variants of simple algorithms that allow recognizing letters that are easy to train (if there is a large base) and were trained on the base that was laid out above.  The best interest and the simplest work in our opinion is the SVM in the Accord library (ML library of the AForge project).  In principle, everything is similarly done in OpenCV, SVM is there. <br><br>  Training: <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Accord.MachineLearning.VectorMachines; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Accord.MachineLearning.VectorMachines.Learning; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Accord.<span class="hljs-keyword"><span class="hljs-keyword">Statistics</span></span>.Kernels; //  ,     <span class="hljs-type"><span class="hljs-type">double</span></span>[][] inputs; //      <span class="hljs-type"><span class="hljs-type">int</span></span>[] outputs; //""   .   ,   ""  SVM <span class="hljs-type"><span class="hljs-type">double</span></span> sigma = <span class="hljs-number"><span class="hljs-number">12</span></span>; //   .   <span class="hljs-number"><span class="hljs-number">10</span></span> , <span class="hljs-number"><span class="hljs-number">12</span></span> , + <span class="hljs-number"><span class="hljs-number">1</span></span>     <span class="hljs-type"><span class="hljs-type">int</span></span> classCount=<span class="hljs-number"><span class="hljs-number">23</span></span>; MulticlassSupportVectorLearning teacher = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; //  :     ,   ,   //sigma -    .   - <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-number"><span class="hljs-number">-20</span></span>,   . machine = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> MulticlassSupportVectorMachine(width*height, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Gaussian(sigma), classCount); //  teacher = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> MulticlassSupportVectorLearning(machine, inputs, outputs); teacher.Algorithm = (svm, classInputs, classOutputs, i, j) =&gt; <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> SequentialMinimalOptimization(svm, classInputs, classOutputs) { CacheSize = <span class="hljs-number"><span class="hljs-number">0</span></span> }; teacher.Run(); machine.Save("MachineForSymbol");</code> </pre> <br>  Recognition is implemented in two lines: <br><br><pre> <code class="hljs pgsql">MulticlassSupportVectorMachine machine = MulticlassSupportVectorMachine.<span class="hljs-keyword"><span class="hljs-keyword">Load</span></span>("MachineForSymbol"); <span class="hljs-type"><span class="hljs-type">int</span></span> output = machine.Compute(<span class="hljs-keyword"><span class="hljs-keyword">input</span></span>);</code> </pre><br>  It is important that the input data is binarized.  This greatly improves the accuracy of work.  I will give an example of loading: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> AForge.Imaging; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> AForge.Imaging.Filters; private static List&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt; test(string str) { Bitmap bmp = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Bitmap(str); //  ,      .         <span class="hljs-number"><span class="hljs-number">34</span></span>*<span class="hljs-number"><span class="hljs-number">60.</span></span>     ,   . ResizeNearestNeighbor <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> ResizeNearestNeighbor(<span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>); <span class="hljs-type"><span class="hljs-type">int</span></span> count = <span class="hljs-number"><span class="hljs-number">0</span></span>; BitmapData bitmapData = bmp.LockBits(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Rectangle(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, bmp.Width, bmp.Height), ImageLockMode.ReadWrite, PixelFormat.Format24bppRgb); List&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt; res = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;<span class="hljs-type"><span class="hljs-type">double</span></span>&gt;(); <span class="hljs-type"><span class="hljs-type">int</span></span> width = bitmapData.Width; <span class="hljs-type"><span class="hljs-type">int</span></span> height = bitmapData.Height; <span class="hljs-type"><span class="hljs-type">int</span></span> stride = bitmapData.Stride; <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span> = stride - width*<span class="hljs-number"><span class="hljs-number">3</span></span>; unsafe { byte* ptr = (byte*)bitmapData.Scan0.ToPointer(); <span class="hljs-type"><span class="hljs-type">double</span></span> summ = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; bitmapData.Height; y++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; bitmapData.Width; x++, ptr+=<span class="hljs-number"><span class="hljs-number">3</span></span>) { //   ,   ,      res.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>((ptr[<span class="hljs-number"><span class="hljs-number">0</span></span>] + ptr[<span class="hljs-number"><span class="hljs-number">1</span></span>] + ptr[<span class="hljs-number"><span class="hljs-number">2</span></span>]) / (<span class="hljs-number"><span class="hljs-number">3</span></span>*<span class="hljs-number"><span class="hljs-number">255.0</span></span>)); summ += (ptr[<span class="hljs-number"><span class="hljs-number">0</span></span>] + ptr[<span class="hljs-number"><span class="hljs-number">1</span></span>] + ptr[<span class="hljs-number"><span class="hljs-number">2</span></span>]); } ptr += <span class="hljs-keyword"><span class="hljs-keyword">offset</span></span>; } summ = summ / (<span class="hljs-number"><span class="hljs-number">3</span></span>*<span class="hljs-number"><span class="hljs-number">255.0</span></span>* bitmapData.Height * bitmapData.Width); //     <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; res.Count; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (res[i]&lt;summ) res[i] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> res[i] = <span class="hljs-number"><span class="hljs-number">1</span></span>; } } bmp.UnlockBits(bitmapData); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res; }</code> </pre><br>  <a href="https://yadi.sk/d/es2D5USMcupjD">An example of a</a> trained SVM'a.  The percentage of correctly recognized characters in a training-independent sample is 96%. <br><br><h4>  PS </h4><br>  From the stories related to the numbers.  Now in Kazakhstan there is (or is happening) some kind of mass tender for the installation of number recognition systems.  But there are some very few competent firms connected with IT system solutions, or very little.  Somewhere once or twice a month, another manager contacts us and offers to supply them with a system immediately, already trained under the country numbers.  At the same time confusing the words "server" and "camera" ... </div><p>Source: <a href="https://habr.com/ru/post/243919/">https://habr.com/ru/post/243919/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243905/index.html">Freelance in Turkey</a></li>
<li><a href="../243907/index.html">I hear voices: voice recording for game project</a></li>
<li><a href="../243909/index.html">Chrome CSS bug that destroyed our site</a></li>
<li><a href="../243913/index.html">Modeling pandemics using the Wolfram Language (Mathematica 10) using the example of Ebola</a></li>
<li><a href="../243915/index.html">VPN to every home</a></li>
<li><a href="../243927/index.html">Photo tour of the data center from the Australian colocation provider Micron21</a></li>
<li><a href="../243929/index.html">FISCHERTECHNIK: Chemotronics, Ionistors, Electrochemical Supercapacitors Inside the Children's Designer for Programmers</a></li>
<li><a href="../243933/index.html">Using TTreeView in Firemonkey Applications</a></li>
<li><a href="../243937/index.html">Overview of the Hantek DSO-6022BL USB Oscilloscope with a Logic Analyzer and Diffuser</a></li>
<li><a href="../243939/index.html">Media Restart: Overview</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>