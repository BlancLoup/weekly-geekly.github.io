<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Teach Zend Memcache to work with tags.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the project, where I am a developer, the cache is used. Just want to make a reservation, the project is highly loaded, about two thousand people pe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Teach Zend Memcache to work with tags.</h1><div class="post__text post__text-html js-mediator-article"> In the project, where I am a developer, the cache is used.  Just want to make a reservation, the project is highly loaded, about two thousand people per day.  A convenient solution to unload the database was the use of memkesh.  Since the project on the Zend Framework, the implementation of the cache, respectively, took it.  But as it turned out, not the most successful implementation, since the work with tags is completely absent, it does not allow us to clean the cache selectively. <a name="habracut"></a><br><br>  How can I implement selective cache cleaning?  It's very simple, we create a container in which the tag names will be recorded, they will be keys for other containers, our hashes of aydishniki of cached methods will be stored in them.  Zend_Cache_Frontend_Class was taken for the cache frontend.  It is this one that generates the hashes of the data keys of the cached methods. <br><br>  It looks like this: <br><img src="https://habrastorage.org/storage2/433/adb/7f0/433adb7f0e85bc237ee527e62bdbc702.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code><b>Tags_Container</b> ‚Äì    ,   . <br> <b>MemcacheTag1, MemcacheTag2  MemcacheTagN</b> ‚Äì    ,     Tags_Container   ,        .</code> <br> <br>  Especially without going into the description of the implementation offer a turnkey solution. <br>  Create your backend file My_Cache_Backend_Memcached <br><pre> <code class="hljs bash">class My_Cache_Backend_Memcached extends Zend_Cache_Backend_Memcached { /** * @const string */ const TAGS_CONTAINER_NAME = <span class="hljs-string"><span class="hljs-string">'Tags_Container'</span></span>; /** * @<span class="hljs-built_in"><span class="hljs-built_in">return</span></span> array */ protected <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_getTagsContainer</span></span></span></span>() { <span class="hljs-variable"><span class="hljs-variable">$tagsContainer</span></span> = <span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;load(self::TAGS_CONTAINER_NAME); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-literal"><span class="hljs-literal">false</span></span> === <span class="hljs-variable"><span class="hljs-variable">$tagsContainer</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$tagsContainer</span></span> = array(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_string(<span class="hljs-variable"><span class="hljs-variable">$tagsContainer</span></span>)) { <span class="hljs-variable"><span class="hljs-variable">$tagsContainer</span></span> = array(<span class="hljs-variable"><span class="hljs-variable">$tagsContainer</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-variable"><span class="hljs-variable">$tagsContainer</span></span>; } /** * @param <span class="hljs-variable"><span class="hljs-variable">$tagName</span></span> * * @<span class="hljs-built_in"><span class="hljs-built_in">return</span></span> array */ protected <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> _getIdsByTag(<span class="hljs-variable"><span class="hljs-variable">$tagName</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$tagIds</span></span> = <span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;load(<span class="hljs-variable"><span class="hljs-variable">$tagName</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-literal"><span class="hljs-literal">false</span></span> === <span class="hljs-variable"><span class="hljs-variable">$tagIds</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$tagIds</span></span> = array(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_string(<span class="hljs-variable"><span class="hljs-variable">$tagIds</span></span>)) { <span class="hljs-variable"><span class="hljs-variable">$tagIds</span></span> = array(<span class="hljs-variable"><span class="hljs-variable">$tagIds</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-variable"><span class="hljs-variable">$tagIds</span></span>; } /** * Save some string datas into a cache record * * Note : <span class="hljs-variable"><span class="hljs-variable">$data</span></span> is always <span class="hljs-string"><span class="hljs-string">"string"</span></span> (serialization is <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> by the * core not by the backend) * * @param string <span class="hljs-variable"><span class="hljs-variable">$data</span></span> Datas to cache * @param string <span class="hljs-variable"><span class="hljs-variable">$id</span></span> Cache id * @param array <span class="hljs-variable"><span class="hljs-variable">$tags</span></span> Array of strings, the cache record will be tagged * by each string entry * @param bool|int <span class="hljs-variable"><span class="hljs-variable">$specificLifetime</span></span> If != <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> a specific lifetime * <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> this cache record (null =&gt; infinite lifetime) * @<span class="hljs-built_in"><span class="hljs-built_in">return</span></span> bool True <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> no problem */ public <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> save(<span class="hljs-variable"><span class="hljs-variable">$data</span></span>, <span class="hljs-variable"><span class="hljs-variable">$id</span></span>, <span class="hljs-variable"><span class="hljs-variable">$tags</span></span> = array(), <span class="hljs-variable"><span class="hljs-variable">$specificLifetime</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$lifetime</span></span> = <span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;getLifetime(<span class="hljs-variable"><span class="hljs-variable">$specificLifetime</span></span>); <span class="hljs-variable"><span class="hljs-variable">$tagsLifetime</span></span> = <span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;getLifetime(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$lifetime</span></span> &gt; <span class="hljs-variable"><span class="hljs-variable">$tagsLifetime</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$tagsLifetime</span></span> = <span class="hljs-variable"><span class="hljs-variable">$lifetime</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;_options[<span class="hljs-string"><span class="hljs-string">'compression'</span></span>]) { <span class="hljs-variable"><span class="hljs-variable">$flag</span></span> = MEMCACHE_COMPRESSED; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-variable"><span class="hljs-variable">$flag</span></span> = 0; } <span class="hljs-variable"><span class="hljs-variable">$result</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count(<span class="hljs-variable"><span class="hljs-variable">$tags</span></span>) &gt; 0) { <span class="hljs-variable"><span class="hljs-variable">$tagsContainer</span></span> = <span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;_getTagsContainer(); <span class="hljs-variable"><span class="hljs-variable">$containerChanged</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; foreach(<span class="hljs-variable"><span class="hljs-variable">$tags</span></span> as <span class="hljs-variable"><span class="hljs-variable">$tagName</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$tagName</span></span> == self::TAGS_CONTAINER_NAME) { Zend_Cache::throwException(<span class="hljs-string"><span class="hljs-string">'Incorrect name tag "'</span></span> . <span class="hljs-variable"><span class="hljs-variable">$tagName</span></span> . <span class="hljs-string"><span class="hljs-string">'"'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in_array(<span class="hljs-variable"><span class="hljs-variable">$id</span></span>, <span class="hljs-variable"><span class="hljs-variable">$tagsContainer</span></span>)) { Zend_Cache::throwException(<span class="hljs-string"><span class="hljs-string">'The key with id = "'</span></span> . <span class="hljs-variable"><span class="hljs-variable">$id</span></span> . <span class="hljs-string"><span class="hljs-string">'" already used in the tags'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!in_array(<span class="hljs-variable"><span class="hljs-variable">$tagName</span></span>, <span class="hljs-variable"><span class="hljs-variable">$tagsContainer</span></span>)) { <span class="hljs-variable"><span class="hljs-variable">$containerChanged</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-variable"><span class="hljs-variable">$tagsContainer</span></span>[] = <span class="hljs-variable"><span class="hljs-variable">$tagName</span></span>; } <span class="hljs-variable"><span class="hljs-variable">$tagIds</span></span> = <span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;_getIdsByTag(<span class="hljs-variable"><span class="hljs-variable">$tagName</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!in_array(<span class="hljs-variable"><span class="hljs-variable">$id</span></span>, <span class="hljs-variable"><span class="hljs-variable">$tagIds</span></span>)) { <span class="hljs-variable"><span class="hljs-variable">$tagIds</span></span>[] = <span class="hljs-variable"><span class="hljs-variable">$id</span></span>; } <span class="hljs-variable"><span class="hljs-variable">$result</span></span> = <span class="hljs-variable"><span class="hljs-variable">$result</span></span> &amp;&amp; @<span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;_memcache-&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>( <span class="hljs-variable"><span class="hljs-variable">$tagName</span></span>, array(<span class="hljs-variable"><span class="hljs-variable">$tagIds</span></span>), <span class="hljs-variable"><span class="hljs-variable">$flag</span></span>, <span class="hljs-variable"><span class="hljs-variable">$tagsLifetime</span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$containerChanged</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$result</span></span> = <span class="hljs-variable"><span class="hljs-variable">$result</span></span> &amp;&amp; @<span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;_memcache-&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>( self::TAGS_CONTAINER_NAME, array(<span class="hljs-variable"><span class="hljs-variable">$tagsContainer</span></span>), <span class="hljs-variable"><span class="hljs-variable">$flag</span></span>, <span class="hljs-variable"><span class="hljs-variable">$tagsLifetime</span></span> ); } } // ZF-8856: using <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> because add needs a second request <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> item already exists <span class="hljs-variable"><span class="hljs-variable">$result</span></span> = <span class="hljs-variable"><span class="hljs-variable">$result</span></span> &amp;&amp; @<span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;_memcache-&gt;<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>( <span class="hljs-variable"><span class="hljs-variable">$id</span></span>, array(<span class="hljs-variable"><span class="hljs-variable">$data</span></span>, time(), <span class="hljs-variable"><span class="hljs-variable">$lifetime</span></span>), <span class="hljs-variable"><span class="hljs-variable">$flag</span></span>, <span class="hljs-variable"><span class="hljs-variable">$lifetime</span></span> ); <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-variable"><span class="hljs-variable">$result</span></span>; } /** * @param string <span class="hljs-variable"><span class="hljs-variable">$mode</span></span> * @param array <span class="hljs-variable"><span class="hljs-variable">$tags</span></span> * * @<span class="hljs-built_in"><span class="hljs-built_in">return</span></span> array */ protected <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> _get(<span class="hljs-variable"><span class="hljs-variable">$mode</span></span>, <span class="hljs-variable"><span class="hljs-variable">$tags</span></span> = array()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (is_string(<span class="hljs-variable"><span class="hljs-variable">$tags</span></span>)) { <span class="hljs-variable"><span class="hljs-variable">$tags</span></span> = array(<span class="hljs-variable"><span class="hljs-variable">$tags</span></span>); } <span class="hljs-variable"><span class="hljs-variable">$tagNames</span></span> = <span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;_getTagsContainer(); switch(<span class="hljs-variable"><span class="hljs-variable">$mode</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'ids'</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'tags'</span></span>: <span class="hljs-variable"><span class="hljs-variable">$tagNames</span></span> = array_intersect(<span class="hljs-variable"><span class="hljs-variable">$tagNames</span></span>, <span class="hljs-variable"><span class="hljs-variable">$tags</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'matching'</span></span>: <span class="hljs-variable"><span class="hljs-variable">$tagNames</span></span> = array_intersect(<span class="hljs-variable"><span class="hljs-variable">$tagNames</span></span>, <span class="hljs-variable"><span class="hljs-variable">$tags</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'notMatching'</span></span>: <span class="hljs-variable"><span class="hljs-variable">$tagNames</span></span> = array_diff(<span class="hljs-variable"><span class="hljs-variable">$tagNames</span></span>, <span class="hljs-variable"><span class="hljs-variable">$tags</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; default: Zend_Cache::throwException(<span class="hljs-string"><span class="hljs-string">'Invalid mode for _get() method'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } <span class="hljs-variable"><span class="hljs-variable">$ids</span></span> = array(); foreach(<span class="hljs-variable"><span class="hljs-variable">$tagNames</span></span> as <span class="hljs-variable"><span class="hljs-variable">$tagName</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$ids</span></span> = array_merge(<span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;_getIdsByTag(<span class="hljs-variable"><span class="hljs-variable">$tagName</span></span>), <span class="hljs-variable"><span class="hljs-variable">$ids</span></span>); } <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-variable"><span class="hljs-variable">$ids</span></span>; } /** * Return an array of stored cache ids * * @<span class="hljs-built_in"><span class="hljs-built_in">return</span></span> array */ public <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getIds</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;_get(<span class="hljs-string"><span class="hljs-string">'ids'</span></span>, array()); } /** * Return an array of stored tags * * @<span class="hljs-built_in"><span class="hljs-built_in">return</span></span> array */ public <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTags</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;_get(<span class="hljs-string"><span class="hljs-string">'tags'</span></span>, array()); } /** * Return an array of stored cache ids <span class="hljs-built_in"><span class="hljs-built_in">which</span></span> match given tags * * In <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> of multiple tags, a logical AND is made between tags * * @param array <span class="hljs-variable"><span class="hljs-variable">$tags</span></span> array of tags * * @<span class="hljs-built_in"><span class="hljs-built_in">return</span></span> array */ public <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> getIdsMatchingTags(<span class="hljs-variable"><span class="hljs-variable">$tags</span></span> = array()) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;_get(<span class="hljs-string"><span class="hljs-string">'matching'</span></span>, <span class="hljs-variable"><span class="hljs-variable">$tags</span></span>); } /** * Return an array of stored cache ids <span class="hljs-built_in"><span class="hljs-built_in">which</span></span> don<span class="hljs-string"><span class="hljs-string">'t match given tags * * In case of multiple tags, a logical OR is made between tags * * @param array $tags array of tags * * @return array */ public function getIdsNotMatchingTags($tags = array()) { return $this-&gt;_get('</span></span>notMatching<span class="hljs-string"><span class="hljs-string">', $tags); } /** * Return an associative array of capabilities (booleans) of the backend * * @return array associative of with capabilities */ public function getCapabilities() { $capabilities = parent::getCapabilities(); $capabilities['</span></span>tags<span class="hljs-string"><span class="hljs-string">'] = true; return $capabilities; } /** * @param string $mode * @param array $tags * * @return bool */ protected function _clean($mode, $tags) { $result = false; switch ($mode) { case Zend_Cache::CLEANING_MODE_ALL: $result = $this-&gt;_memcache-&gt;flush(); break; case Zend_Cache::CLEANING_MODE_MATCHING_TAG: $ids = $this-&gt;getIdsMatchingTags($tags); $result = true; foreach($ids as $id) { $result = $result &amp;&amp; $this-&gt;remove($id); } break; case Zend_Cache::CLEANING_MODE_NOT_MATCHING_TAG: $ids = $this-&gt;getIdsNotMatchingTags($tags); $result = true; foreach($ids as $id) { $result = $result &amp;&amp; $this-&gt;remove($id); } break; case Zend_Cache::CLEANING_MODE_OLD: case Zend_Cache::CLEANING_MODE_MATCHING_ANY_TAG: $this-&gt;_log(self::TAGS_UNSUPPORTED_BY_CLEAN_OF_MEMCACHED_BACKEND); break; default: Zend_Cache::throwException('</span></span>Invalid mode <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> clean() method<span class="hljs-string"><span class="hljs-string">'); break; } return $result; } /** * @param string $mode * @param array $tags * * @return mixed */ public function clean($mode = Zend_Cache::CLEANING_MODE_ALL, $tags = array()) { return $this-&gt;_clean($mode, $tags); } }</span></span></code> </pre> <br>  How to use? <br><br>  I cite the example code, I warn you about the settings of the backend and frontend, you can transfer in another way, the given code is only to understand how to use. <br><br><pre> <code class="hljs php">$frontendName = <span class="hljs-string"><span class="hljs-string">'Class'</span></span>; $backendName = <span class="hljs-string"><span class="hljs-string">'My_Cache_Backend_Memcached'</span></span>; $frontendOptions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $memcacheDataObject1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Default_Models_MemcacheData1; $memcacheDataObject2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Default_Models_MemcacheData2; $backendOptions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'servers'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'host'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>, <span class="hljs-string"><span class="hljs-string">'port'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'11211'</span></span>, <span class="hljs-string"><span class="hljs-string">'persistent'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'weight'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'timeout'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'retry_interval'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">15</span></span> ) ) ); $frontendOptions[<span class="hljs-string"><span class="hljs-string">'cached_entity'</span></span>] = $memcacheDataObject1; $cachedObject1 = Zend_Cache::factory( $frontendName, $backendName, $frontendOptions, $backendOptions, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ); $cachedObject1-&gt;setTagsArray(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'Memcached_Tag1'</span></span>)); $frontendOptions[<span class="hljs-string"><span class="hljs-string">'cached_entity'</span></span>] = $memcacheDataObject2; $cachedObject2 = Zend_Cache::factory( $frontendName, $backendName, $frontendOptions, $backendOptions, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ); $cachedObject2-&gt;setTagsArray(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'Memcached_Tag2'</span></span>));</code> </pre> <br>  Instead of the standard Memcached backend, you must pass your backend class ‚ÄúMy_Cache_Backend_Memcached‚Äù, you also need to specify $ customBackendNaming = true, this is the 6th parameter in the call to the Zend_Cache :: factory. <br><br>  Default_Models_MemcacheData1 and Default_Models_MemcacheData2 are our cached classes, they are completely identical.  I give an example of one of them: <br><pre> <code class="hljs actionscript"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Default_Models_MemcacheData1</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cachedMethod</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rand(<span class="hljs-number"><span class="hljs-number">111</span></span>, <span class="hljs-number"><span class="hljs-number">999</span></span>); } }</code> </pre> <br>  As you can see from the code, each time the cachedMethod method is called, we must receive a random value. <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; $i++) { Zend_Debug::dump($memcacheDataObject1-&gt;cachedMethod(), <span class="hljs-string"><span class="hljs-string">'cached data:'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; $i++) { Zend_Debug::dump($memcacheDataObject2-&gt;cachedMethod(), <span class="hljs-string"><span class="hljs-string">'cached data:'</span></span>); }</code> </pre> <br>  When executing the code, we get something like the following: <br> <code>cached data: int(468) <br> cached data: int(676) <br> ached data: int(721) <br> ached data: int(182) <br> cached data: int(414) <br> cached data: int(561)</code> <br> <br>  You can check the cache in action by running the following code <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; $i++) { Zend_Debug::dump($cachedObject1-&gt;cachedMethod(), <span class="hljs-string"><span class="hljs-string">'cached data:'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; $i++) { Zend_Debug::dump($cachedObject2-&gt;cachedMethod(), <span class="hljs-string"><span class="hljs-string">'cached data:'</span></span>); }</code> </pre> <br>  The situation will change, we will get approximately the following data: <br> <code>cached data: int(901) <br> cached data: int(901) <br> cached data: int(901) <br> cached data: int(865) <br> cached data: int(865) <br> cached data: int(865)</code> <br> <br>  Subsequently, the situation does not change. <br><br>  To clear the cache, use the following code. <br><pre> <code class="hljs php">$cachedClass1-&gt;clean( Zend_Cache::CLEANING_MODE_MATCHING_TAG, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'Memcached_Tag1'</span></span>) );</code> </pre> <br>  Make sure that the cache is cleaned according to the transmitted tag. <br><br>  The problem of selective cache cleaning was solved, there was an increase in performance. <br><br>  * Thanks homm for the comments.  Now the lifetime for tags is calculated based on the settings, or if the $ specificLifetime parameter passed is longer, then it is taken.  Also added check for changes to the common container, if the tags have changed. <br><br>  ps I want to warn php developers, you can use this code at your own peril and risk.  This code may be a panacea for particular cases.  And is not explosive. <br>  Using this code, remember that tag names are also keys, as are the transmitted id. </div><p>Source: <a href="https://habr.com/ru/post/137150/">https://habr.com/ru/post/137150/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137133/index.html">Picstag.ru - photo tagging or interactive photo service</a></li>
<li><a href="../137134/index.html">Webmoney. Ukraine and tax - what awaits us in 2012?</a></li>
<li><a href="../137135/index.html">Is it worth developing for Nokia?</a></li>
<li><a href="../137137/index.html">Not for money: organizing a community of interest</a></li>
<li><a href="../137145/index.html">Web services with electronic signature support based on GOST cryptography</a></li>
<li><a href="../137152/index.html">Microsoft Tag Scanning SDK</a></li>
<li><a href="../137153/index.html">XenForo: add a new page to the help section</a></li>
<li><a href="../137154/index.html">Creating an Event Waiting Badge with HTML5 canvas</a></li>
<li><a href="../137155/index.html">Managing Arduino from your phone</a></li>
<li><a href="../137157/index.html">Easy pay and tax</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>