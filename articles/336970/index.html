<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RxSwift: a bit about share (), replay (), shareReplayLatestWhileConnected () and other cool operators</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I already wrote about Publish, Connect and RefCount in RxSwift . In order to better cover the topic, I present to your attention the translation of an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RxSwift: a bit about share (), replay (), shareReplayLatestWhileConnected () and other cool operators</h1><div class="post__text post__text-html js-mediator-article">  <i>I already wrote about <a href="https://habrahabr.ru/post/336662/">Publish, Connect and RefCount in RxSwift</a> .</i>  <i>In order to better cover the topic, I present to your attention the translation of another <a href="https://medium.com/%40_achou/rxswift-share-vs-replay-vs-sharereplay-bea99ac42168">wonderful article</a> about the differences between operators such as share (), replay (), replayAll (), shareReplay (), publish () and shareReplayLatestWhileConnected ().</i> <br><br>  A common mistake that newcomers make when taking up <a href="http://reactivex.io/">Rx</a> is misunderstanding that the chain of operators on the Observable is re-executed with each new subscriber: <br><br><pre><code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> results = query.rx.text .flatMapLatest { query <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> networkRequestAPI(query) } results.subscribe(...) <span class="hljs-comment"><span class="hljs-comment">//     results.subscribe(...) //  </span></span></code> </pre> <br>  We have several subscribers to a single Observable, but we do not want its code to be executed with each new Subscriber.  For this, there are several operators in <a href="https://github.com/ReactiveX/RxSwift">RxSwift</a> .  Here is a summary sign describing each one of them: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/web/69d/367/ba3/69d367ba364645eeaf80594928dd28b2.png" alt="image"><br>  <i><font color="99999">1 - retransmits elements produced before subscription no more than bufferSize.</font></i> <i><font color="99999"><br></font></i>  <i><font color="99999">2 - retransmits 1 element generated before the subscription, as long as at least one subscriber exists.</font></i> <br><a name="habracut"></a><br><h3>  Now consider in detail each property. </h3><br>  <b>Shared subscription.</b>  The returned Observable shares one major subscription among all subscribers. <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> results = query.rx.text .flatMapLatest { query <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> networkRequestAPI(query) } .<span class="hljs-number"><span class="hljs-number">_</span></span><span class="hljs-number"><span class="hljs-number">_</span></span><span class="hljs-number"><span class="hljs-number">_</span></span>() <span class="hljs-comment"><span class="hljs-comment">//        results.subscribe(...) results.subscribe(...)</span></span></code> </pre><br>  <b>Connectable.</b>  The return Observable will not produce elements until the <code>connect()</code> method is called. <br><br>  <b>Reference counting.</b>  The returned Observable counts the number of subscriber subscribed to.  As we remember from the first property, on Observable, to which the operator was applied (we will call it Source Observable), there is always only one ‚Äúprimary‚Äù subscription and it shares data with the rest of the subscribers. <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sourceObservable = query.rx.text .flatMapLatest { <span class="hljs-function"><span class="hljs-function">query </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">networkRequestAPI</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">query</span></span></span><span class="hljs-function">) } </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> resultObservable</span></span> = sourceObservable.share() resultObservable.subscribe(...) resultObservable.subscribe(...) resultObservable.subscribe(...) <span class="hljs-comment"><span class="hljs-comment">//  sourceObservable        //        resultsObservable</span></span></code> </pre><br>  When the subscriber count reaches zero, Source Observable resources are cleared.  Note: <b>each time the counter is increased from zero to one, a new subscription will be made to the Source Observable.</b>  But this may not happen if the Source Observable has completed or sent an error.  This is a rather unpredictable behavior, so I try to avoid it and when writing code I am convinced that after the number of subscribers has dropped to zero, there will be no subsequent subscriptions. <br><br>  <b>Replays events.</b>  The operator relays items from Source Observable to subscribers who have already subscribed after Source Observable began producing items.  For <code>replay(bufferSize)</code> and <code>shareReplay(bufferSize)</code> number of these elements is no more than bufferSize.  For <code>shareReplayLatestWhileConnected()</code> this number is not greater than one.  Unlike <code>shareReplay(bufferSize)</code> , <code>shareReplayLatestWhileConnected()</code> clears the buffer when the number of subscribers drops to zero.  Therefore, when Subscriber subscribes, which increases the counter from zero to one, it will not receive any items. <br><br>  It is also worth mentioning the <code>multicast</code> operator, which can be useful if you use <code>Subject</code> .  But, the operators described in this article are likely to be enough for most user cases. <br><br>  <i>Translator's note.</i> <i><br></i>  <i>For completeness, I advise you to read:</i> <i><br></i> <ol><li>  <i>An article about <a href="https://habrahabr.ru/post/336662/">Publish, Connect and RefCount in RxSwift</a> , it said about the first three properties described above.</i> </li><li>  <i><a href="https://habrahabr.ru/post/281292/">RxSwift cheat sheet for operators</a> .</i>  <i>The author has done a lot of work and collected in one place all the basic RxSwift operators, their descriptions with pictures and code examples.</i>  <i>I myself periodically glance at the cheat sheet if I need to remember any operator.</i> </li><li>  <i>Official RxSwift <a href="https://github.com/ReactiveX/RxSwift">documentation</a> , of course.</i> </li></ol> <i><br></i>  <i>If something remains unclear, please let me know in the comments.</i> </div><p>Source: <a href="https://habr.com/ru/post/336970/">https://habr.com/ru/post/336970/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336960/index.html">Security Week 35: Carders donate to Hutchins, 500 thousand pacemakers withdrawn, 711 million emails were found in the spam bot</a></li>
<li><a href="../336962/index.html">The flaw in formatting Swift blocks in Xcode</a></li>
<li><a href="../336964/index.html">40 spectacular ARKit demos that will soon see the world</a></li>
<li><a href="../336966/index.html">We configure the Internet gateway with transparent bypass of blocking (and we will block advertising)</a></li>
<li><a href="../336968/index.html">We pump USB Mass Storage Device on STM32F103 using FreeRTOS and DMA</a></li>
<li><a href="../336972/index.html">Optimization of the process of searching for violators of land legislation</a></li>
<li><a href="../336976/index.html">‚ÄúBy whom do you see yourself in 5 years?‚Äù: Wall Street top manager's advice on the answers to the cunning questions of recruiters</a></li>
<li><a href="../336978/index.html">Traffic mirroring on Juniper MX</a></li>
<li><a href="../336980/index.html">Creating a programming language using LLVM. Part 9: Add Debugging Information</a></li>
<li><a href="../336982/index.html">EWD: Substitution Processes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>