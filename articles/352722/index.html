<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to issue a self-signed SSL certificate and make your browser trust it</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All major sites have long switched to the https protocol. The trend continues, and many of our customers want their site to work over a secure protoco...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to issue a self-signed SSL certificate and make your browser trust it</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/vb/x-/fk/vbx-fkfz0qk7mwt7y0dmc0bkjmi.png"><br><br>  All major sites have long switched to the https protocol.  The trend continues, and many of our customers want their site to work over a secure protocol.  And if you are developing a backend for a mobile application, then https is required.  For example, Apple requires that the server communicate with the application using a secure protocol.  This requirement has <a href="https-connections-for-ios-apps-by-the-end-of-2016/">been introduced since the end of 2016</a> . <br><br>  On production there are no problems with certificates.  Typically, a hosting provider provides a convenient interface for connecting a certificate.  Issuing a certificate is also not difficult.  But while working on a project, each developer must take care of the certificate himself. <br>  In this article, I will explain how to issue a self-signed SSL certificate and make the browser trust it. <br><a name="habracut"></a><br>  To issue a certificate for your local domain, you need a root certificate.  All other certificates will be issued based on it.  Yes, for each new top level domain you need to issue your certificate.  Getting a root certificate is easy. <br>  First form the private key: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">openssl genrsa -out rootCA.key 2048</code> </pre> <br>  Then the certificate itself: <br><br><pre> <code class="bash hljs">openssl req -x509 -new -nodes -key rootCA.key -sha256 -days 1024 -out rootCA.pem</code> </pre> <br>  You will need to enter a <i>country</i> , <i>city</i> , <i>company</i> , etc.  As a result, we get two files: <u>rootCA.key</u> and <u>rootCA.pem</u> <br><br>  <b>Go to the main issue of the self-signed certificate.</b>  As with the root, these are two commands.  But the parameters of the teams will be much more.  And we need an auxiliary configuration file.  Therefore, we arrange all this in the form of a bash script <u>create_certificate_for_domain.sh</u> <br><br>  The first parameter is required, we will display a small instruction for the user. <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">"</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Please supply a subdomain to create a certificate for"</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"eg mysite.localhost"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br>  Create a new private key if it does not exist or use the existing one: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -f device.key ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> KEY_OPT=<span class="hljs-string"><span class="hljs-string">"-key"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> KEY_OPT=<span class="hljs-string"><span class="hljs-string">"-keyout"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br>  We will ask the user for the domain name.  Add the ability to set a ‚Äúcommon name‚Äù (it is used when generating a certificate): <br><br><pre> <code class="bash hljs">DOMAIN=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> COMMON_NAME=<span class="hljs-variable"><span class="hljs-variable">${2:-$1}</span></span></code> </pre> <br>  In order not to answer questions online, we will form a line with answers.  And set the time of validity of the certificate: <br><br><pre> <code class="bash hljs">SUBJECT=<span class="hljs-string"><span class="hljs-string">"/C=CA/ST=None/L=NB/O=None/CN=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$COMMON_NAME</span></span></span><span class="hljs-string">"</span></span> NUM_OF_DAYS=999</code> </pre> <br>  The SUBJECT variable lists all the same questions that were asked when creating the root certificate ( <i>country</i> , <i>city</i> , <i>company</i> , etc.).  All values ‚Äã‚Äãexcept CN can be changed at your discretion. <br><br>  <i>Create a csr</i> file (Certificate Signing Request) based on the key.  You can <a href="https://www.sslshopper.com/what-is-a-csr-certificate-signing-request.html">read</a> more about the certificate request file <a href="https://www.sslshopper.com/what-is-a-csr-certificate-signing-request.html">in this article</a> . <br><br><pre> <code class="bash hljs">openssl req -new -newkey rsa:2048 -sha256 -nodes <span class="hljs-variable"><span class="hljs-variable">$KEY_OPT</span></span> device.key -subj <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SUBJECT</span></span></span><span class="hljs-string">"</span></span> -out device.csr</code> </pre> <br>  <b>We form the certificate file</b> .  For this we need an auxiliary file with settings.  In this file we will write the domains for which the certificate will be valid and some other settings.  Let's call it <u>v3.ext</u> .  I draw your attention that this is a separate file, and not part of the bash script. <br><br><pre> <code class="bash hljs">authorityKeyIdentifier=keyid,issuer basicConstraints=CA:FALSE keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment subjectAltName = @alt_names [alt_names] DNS.1 = %%DOMAIN%% DNS.2 = *.%%DOMAIN%%</code> </pre> <br>  Yes, right, our certificate will be valid for the main domain, as well as for all subdomains.  Save the above lines to the <u>v3.ext</u> file <br><br>  We return to our bash script.  Based on the auxiliary file <u>v3.ext</u> we create a temporary file indicating our domain: <br><br><pre> <code class="bash hljs">cat v3.ext | sed s/%%DOMAIN%%/<span class="hljs-variable"><span class="hljs-variable">$COMMON_NAME</span></span>/g &gt; /tmp/__v3.ext</code> </pre> <br>  We issue a certificate: <br><br><pre> <code class="bash hljs">openssl x509 -req -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> device.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out device.crt -days <span class="hljs-variable"><span class="hljs-variable">$NUM_OF_DAYS</span></span> -sha256 -extfile /tmp/__v3.ext</code> </pre> <br>  Rename the certificate and delete the temporary file: <br><br><pre> <code class="bash hljs">mv device.csr <span class="hljs-variable"><span class="hljs-variable">$DOMAIN</span></span>.csr cp device.crt <span class="hljs-variable"><span class="hljs-variable">$DOMAIN</span></span>.crt <span class="hljs-comment"><span class="hljs-comment"># remove temp file rm -f device.crt;</span></span></code> </pre> <br>  The script is ready.  Run it: <br><br><pre> <code class="bash hljs">./create_certificate_for_domain.sh mysite.localhost</code> </pre> <br>  We <u>get</u> two files: <u>mysite.localhost.crt</u> and <u>device.key</u> <br><br>  Now you need to tell the web server the paths to these files.  For example, nginx will look like this: <br><br><img src="https://habrastorage.org/webt/8m/v4/rk/8mv4rkzcwxfnlr6uxkilnenonhs.png" alt="nginx ssl"><br><br>  Launch the browser, open <a href="https://mysite.localhost/">https: //mysite.localhost</a> and see: <br><br><img src="https://habrastorage.org/webt/q8/hi/wz/q8hiwzdowyfuus6a1qu75p6dtok.png"><br><br>  The browser does not trust this certificate.  How to be? <br><br>  It is necessary to note the certificate issued by us as Trusted.  On Linux (Ubuntu and, probably, other Debian-based distributions), this can be done through the browser itself.  On Mac OS X, this can be done through the Keychain Access application.  Run the application and drag the file <u>mysite.localhost.crt</u> into the window.  Then open the added file and select Always Trust: <br><br><img src="https://habrastorage.org/webt/qd/n6/8h/qdn68hbbkgsi7dyzy7hzra8mvv4.png"><br><br>  We update the page in the browser and: <br><br><img src="https://habrastorage.org/webt/vb/x-/fk/vbx-fkfz0qk7mwt7y0dmc0bkjmi.png"><br><br>  Success!  The browser trusts our certificate. <br><br>  The certificate can be shared with other developers so that they add it to themselves.  And if you use Docker, you can save the certificate there.  This is how it is implemented in all our projects. <br><br>  Share in comments, do you use https for local development? <br><br>  Maxim Kovtun, <br>  Head of Development </div><p>Source: <a href="https://habr.com/ru/post/352722/">https://habr.com/ru/post/352722/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352712/index.html">How to start working with lambda expressions in java</a></li>
<li><a href="../352714/index.html">Daily meetings in Agile development: 15 minutes, without which there is no release</a></li>
<li><a href="../352716/index.html">New C # 7.2. Span <T> and Memory <T></a></li>
<li><a href="../352718/index.html">Where better to live programmer. Compare 9 countries</a></li>
<li><a href="../352720/index.html">Centralized update of Let's Encrypt certificates</a></li>
<li><a href="../352724/index.html">What will be Web 3.0: blockchain-marketplace for machine learning</a></li>
<li><a href="../352726/index.html">Enough automation - it's time to draw an owl on PowerShell and teach the console to speak</a></li>
<li><a href="../352728/index.html">Standoff on the web</a></li>
<li><a href="../352730/index.html">To steal in 1100 seconds - the strangest bug that I saw</a></li>
<li><a href="../352732/index.html">Creating a simple RESTful API with Spark Framework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>