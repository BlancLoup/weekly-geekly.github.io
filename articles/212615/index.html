<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Xcode and Travis: running tests on a variety of configurations</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The basic idea of ‚Äã‚Äãthis note, in principle, can fit in one sentence: ‚Äúsince you write tests, it would be nice to run them on all possible configurati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Xcode and Travis: running tests on a variety of configurations</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/b55/032/081/b5503208119c9d4c2143450bc704f529.png" align="right">  The basic idea of ‚Äã‚Äãthis note, in principle, can fit in one sentence: ‚Äúsince you write tests, it would be nice to run them on all possible configurations, and not on a single one‚Äù.  But since the format of single-line articles in Habr√© is not accepted, and the information is assimilated in proportion to the logarithm of the number of words in the explanation, I will cut out the idea in more detail. <br><br clear="all"><a name="habracut"></a><br><h4>  Introduction </h4><br>  Do you like bugs?  I adore some here: fat juicy fatal bugs are sheer pleasure, they cannot be overlooked and released with them.  However, there are also improbable little bugs, which are not visible to the naked eye, but which strive to manifest themselves in some specific conditions, for example, only on a specific version of the <abbr title="operating system">OS</abbr> , or only when the compiler optimization is enabled.  These little scoundrels, being not caught, are able to drink a lot of the developer‚Äôs blood and ruin their sleep at night.  Paradoxically, the rarer the bug appears, the more effort it sometimes takes to capture and eliminate it.  If you understand what I mean, then probably the idea that tests should be run on all the many potentially used combinations of OS versions, devices, and compilation settings seems obvious to you. <br><br>  However, as a quick inspection of a couple of dozens of popular libraries on GitHub showed, most developers, even using automatic running of tests for each commit (via <a href="https://travis-ci.org/">Travis-CI</a> ), still test only one configuration for the latest version of iOS.  Units in addition run tests on OS X, but that‚Äôs the case.  Let's see how you can do it differently. <br><br>  In principle, the Continuous Integration module built into XCode 5 allows you to run tests on several simulators, but does not provide sufficient flexibility, and in general, many did not like it.  Therefore, we will not consider it in detail in this article, and we have already <a href="http://habrahabr.ru/company/touchinstinct/blog/199110/">written</a> about it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  xcodebuild </h4><br>  For testing, we will use the <i>xcodebuild</i> utility, which comes as part of the <i>Xcode Command Line Tools</i> .  Previously, most preferred <i><a href="https://github.com/facebook/xctool/">xctool</a></i> from Facebook, since  Firstly, <i>xcodebuild</i> would not start without tambourines and dances, and secondly, <i>xctool</i> produces a more pleasing to the eye.  However, with the release of Xcode 5, the situation has changed in favor of the native <i>xcodebuild</i> : tambourines are no longer needed, and <i>xctool</i> currently <a href="https://github.com/facebook/xctool/issues/205">does not</a> <a href="https://github.com/facebook/xctool/issues/275">allow us to</a> specify the type of simulator, which is the key moment for us. <br><br>  A typical test command looks like this: <br><pre><code class="bash hljs">xcodebuild <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> -project {project}.xcodeproj -scheme {scheme} -sdk iphonesimulator -destination OS=6.0,name=iPhone -configuration Release</code> </pre> <br>  Everything is pretty obvious: we specify the project (or workspace), scheme, SDK, OS version, simulator name and Debug / Release configuration. <br><br>  With a small script, we can easily iterate and test all possible configurations (assuming that the Deployment Target is 5.0, and we are testing the universal library for iOS and OS X): <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> configuration <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Release Debug <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> device <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">"iPhone"</span></span> <span class="hljs-string"><span class="hljs-string">"iPad"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> iosversion <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 6.0 6.1 5.0 5.1 <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> test_ios iOSTests <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$iosversion</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$device</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$configuration</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> device <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">"iPhone Retina (3.5-inch)"</span></span> <span class="hljs-string"><span class="hljs-string">"iPhone Retina (4-inch)"</span></span> <span class="hljs-string"><span class="hljs-string">"iPad Retina"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> iosversion <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 6.0 6.1 7.0 <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> test_ios iOSTests <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$iosversion</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$device</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$configuration</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> device <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">"iPhone Retina (4-inch 64-bit)"</span></span> <span class="hljs-string"><span class="hljs-string">"iPad Retina (64-bit)"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> test_ios iOSTests-64bit 7.0 <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$device</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$configuration</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span> test_osx OSXTests <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$configuration</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre>  <i>(test_ios and test_osx - functions for testing, the <a href="">full version of the script</a> is available in the <a href="https://github.com/rabovik/TravisCITests">test project</a> on GitHub)</i> <br><br>  This will give us 40 possible configurations, which probably already looks redundant.  After all, there is no point in testing logic at different resolutions or UI with different optimization settings.  And if you managed to upgrade the system to OS X Mavericks, then you managed to notice that iOS 5 simulators do not work on it. <br><br>  So, later in the article we will test the following configurations: <br><table><tbody><tr><td>  <b>Logic tests</b> </td><td>  iOS 6.0 </td><td>  iOS 6.1 </td><td>  iOS 7.0 </td><td>  iOS 7.0 64-bit </td><td>  OS X </td></tr><tr><td>  Release </td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td></tr><tr><td>  Debug </td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td></tr></tbody></table><table><tbody><tr><td>  <b>UI Tests</b> </td><td>  iphone </td><td>  iPad </td><td>  iPhone Retina (3.5-inch) </td><td>  iPhone Retina (4-inch) </td><td>  iPad Retina </td></tr><tr><td>  iOS 6.0 </td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td></tr><tr><td>  iOS 7.0 </td><td></td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td><td>  <b>‚úì</b> </td></tr></tbody></table>  For real projects, a set of current configurations will be different for everyone, of course. <br><br>  Adding a binding to count successfully tested configurations and exit at the first failure, we get <br>  final version of the script: <br><div class="spoiler">  <b class="spoiler_title">test-main-configurations.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh # Global settings project=XCode/TravisCI.xcodeproj</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Formatting output</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">red</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">=\"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(tput setaf 1)</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(tput sgr 0)</span></span></span><span class="hljs-string">\""</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">green</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">=\"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(tput setaf 2)</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(tput sgr 0)</span></span></span><span class="hljs-string">\""</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">yellow</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">=\"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(tput setaf 3)</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(tput sgr 0)</span></span></span><span class="hljs-string">\""</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bold</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">eval</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string">=\"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(tput bold)</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$2</span></span></span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(tput sgr 0)</span></span></span><span class="hljs-string">\""</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">echo_fmt</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> str=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> color=<span class="hljs-variable"><span class="hljs-variable">$2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> bold=<span class="hljs-variable"><span class="hljs-variable">$3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$color</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">''</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-variable"><span class="hljs-variable">$color</span></span> str <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$str</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$bold</span></span></span><span class="hljs-string">"</span></span> != <span class="hljs-string"><span class="hljs-string">''</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-variable"><span class="hljs-variable">$bold</span></span> str <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$str</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-variable"><span class="hljs-variable">$str</span></span> }</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Testing</b> <div class="spoiler_text"><pre> <code class="bash hljs">succeeded_count=0 <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> options=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$@</span></span></span><span class="hljs-string">"</span></span> echo_fmt <span class="hljs-string"><span class="hljs-string">"xcodebuild test -project </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$project</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$options</span></span></span><span class="hljs-string">"</span></span> yellow xcodebuild <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> -project <span class="hljs-variable"><span class="hljs-variable">$project</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$@</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> exitcode=$? <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [[ <span class="hljs-variable"><span class="hljs-variable">$exitcode</span></span> != 0 ]] ; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> echo_fmt <span class="hljs-string"><span class="hljs-string">"xcodebuild exited with code </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$exitcode</span></span></span><span class="hljs-string">"</span></span> red echo_fmt <span class="hljs-string"><span class="hljs-string">"=== TESTS FAILED ==="</span></span> red bold <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> 1 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> ((succeeded_count++)) <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_ios</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> scheme=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> iosversion=<span class="hljs-variable"><span class="hljs-variable">$2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> device=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$3</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> configuration=<span class="hljs-variable"><span class="hljs-variable">$4</span></span> <span class="hljs-built_in"><span class="hljs-built_in">shift</span></span> 4 echo_fmt <span class="hljs-string"><span class="hljs-string">"=== TEST SCHEME </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scheme</span></span></span><span class="hljs-string"> IOS </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$iosversion</span></span></span><span class="hljs-string"> DEVICE </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$device</span></span></span><span class="hljs-string"> CONFIGURATION </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$configuration</span></span></span><span class="hljs-string"> ==="</span></span> yellow bold <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> -scheme <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scheme</span></span></span><span class="hljs-string">"</span></span> \ -sdk iphonesimulator \ -destination OS=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$iosversion</span></span></span><span class="hljs-string">"</span></span>,name=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$device</span></span></span><span class="hljs-string">"</span></span> \ -configuration <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$configuration</span></span></span><span class="hljs-string">"</span></span> \ <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$@</span></span></span><span class="hljs-string">"</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_osx</span></span></span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> scheme=<span class="hljs-variable"><span class="hljs-variable">$1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> configuration=<span class="hljs-variable"><span class="hljs-variable">$2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">shift</span></span> 2 echo_fmt <span class="hljs-string"><span class="hljs-string">"=== TEST SCHEME </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scheme</span></span></span><span class="hljs-string"> OSX CONFIGURATION </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$configuration</span></span></span><span class="hljs-string"> ==="</span></span> yellow bold <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> -scheme <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$scheme</span></span></span><span class="hljs-string">"</span></span> -configuration <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$configuration</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$@</span></span></span><span class="hljs-string">"</span></span> }</code> </pre></div></div><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Logic tests for configuration in Release Debug do for iosversion in 6.0 6.1 7.0 #5.0 5.1 # Mavericks does not support iOS 5 Simulator do test_ios "iOSLogicTests" "$iosversion" "iPad Retina" "$configuration" done test_ios "iOSLogicTests-64bit" 7.0 "iPad Retina (64-bit)" "$configuration" ONLY_ACTIVE_ARCH=YES test_osx "OSXTests" "$configuration" done # UI tests test_ios "iOSUITests" 6.0 "iPhone" Debug for device in "iPad" "iPhone Retina (3.5-inch)" "iPhone Retina (4-inch)" "iPad Retina" do for iosversion in 6.0 7.0 do test_ios "iOSUITests" "$iosversion" "$device" Debug done done # Result echo_fmt "=== SUCCEEDED $succeeded_count CONFIGURATIONS. ===" green bold</span></span></code> </pre></div></div><br>  Running which: <br><pre> <code class="bash hljs">./Script/<span class="hljs-built_in"><span class="hljs-built_in">test</span></span>-main-configurations.sh</code> </pre>  will give us a message about successfully passed tests: <br><blockquote>  <font color="green"><b>=== SUCCEEDED 19 CONFIGURATIONS ===</b></font> </blockquote>  or error message: <br><blockquote>  <font color="red"><b>=== TESTS FAILED ===</b></font> </blockquote><br><div class="spoiler">  <b class="spoiler_title">About testing on the iOS 64-bit simulator</b> <div class="spoiler_text">  Because of some bug, Xcode often <a href="http://stackoverflow.com/questions/18743404/xcode5-says-simulator-in-use-when-running-64-bit-unit-tests">does not allow running tests on a 64-bit simulator</a> and swears with a strange message: <br><img src="https://habrastorage.org/getpro/habr/post_images/9df/393/ab7/9df393ab75c739b1bee573e14c87de9b.png"><br>  <a href="http://stackoverflow.com/a/21781010/441735">This outrage is fixed by setting</a> <b>‚ÄúBuild Active Architecture Only‚Äù</b> = <b>‚ÄúYES‚Äù</b> for the tested configuration (Debug / Release).  Therefore, in the script for 64-bit tests there is an additional option <code>ONLY_ACTIVE_ARCH=YES</code> . <br></div></div><br><h4>  Xcode </h4><br>  Someone may not like to run the script manually, so you can create a separate target that will launch it.  To do this, in Xcode, we perform the <b>Add Target ...</b> -&gt; <b>Other</b> -&gt; <b>Aggregate</b> manipulations, then the <b>Editor</b> -&gt; <b>Add Build Phase</b> -&gt; <b>Add Run Script Build Phase</b> , and add the following script: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">${SRCROOT}</span></span>/.. <span class="hljs-comment"><span class="hljs-comment">#     scriptname="test-main-configurations" script="Script/${scriptname}.sh" log="Script/${scriptname}.log" $script &gt; $log #  ,     if [[ $? != 0 ]] ; then #    , ... echo "error: TESTS FAILED" # ...     , ... exit 1 else rm $log # ...     fi</span></span></code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/d9b/b41/2c4/d9bb412c4250af388bd260bba8795a23.png"><br>  Now, if the build of this target ( <b>‚åò</b> + <b>B</b> ) has been successfully completed, then the tests have passed successfully, if not, go to the <i>Scripts / test-main-configurations.log</i> log and see what the reason is. <br>  Of course, to manually launch such testing before each commit no willpower is enough, but it is quite possible to make this a mandatory step when releasing a new release, for example, by adding a similar <i>Build Phase</i> in the release branch of <abbr title="Distributed Version Control System">DVS</abbr> . <br><br><h4>  Travis-ci </h4><br>  But of course, it‚Äôs more efficient when the tests are regularly run automatically, for this we set up the <a href="https://travis-ci.org/">Travis-CI</a> integration system, which will automatically run all our tests on every GitHub.  I will not describe the details in detail, the benefit has already <a href="http://habrahabr.ru/post/182294/">been the corresponding article</a> , I‚Äôll dwell only on the necessary points. <br><br>  All we need is to add the .travis.yml <i>file to the</i> repository root, which will indicate that we should run our script: <br><pre> <code class="hljs swift">language: objective-<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> script: <span class="hljs-type"><span class="hljs-type">Script</span></span>/test-main-configurations.sh</code> </pre><br>  Well, log in to Travis-CI and enable the checkbox for the desired repository.  In principle, everything.  Now commits will be thoroughly tested, and pull requests will be accompanied by messages from Travis: <br><img src="https://habrastorage.org/getpro/habr/post_images/8f9/a92/b71/8f9a92b71aa3d69a3783a891d5b27661.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/c63/c1f/f79/c63c1ff7965c47d76d30d44758647214.png"><br><br>  Do not forget to check that the test schemes are present in the repository, i.e.  they have the <i>Shared</i> checkbox <i>selected</i> : <br><img src="https://habrastorage.org/getpro/habr/post_images/ee6/7a1/de9/ee67a1de99d22cf7aa52a4c78be2e73c.png"><br><br>  By the way, Travis uses Xcode 5.0.2 on OS X 10.8.5, so it can run tests on iOS 5.0 and iOS 5.1. <br><br><h4>  Testing on the device. </h4><br>  If you have a device on iOS 5, then the tests can be run on it by writing a <a href="">similar script</a> for several configurations.  Logical tests are run only on the simulator, and on the device you can run only application tests.  Therefore, if you are testing a library, you will have to create an empty container application with your library, and test it. <br>  The <i>xcodebuild</i> command for testing on a device looks like this: <br><pre> <code class="bash hljs">xcodebuild <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> -project XCode/TravisCI.xcodeproj -scheme iOSDeviceLogicTests -sdk iphoneos -destination name=<span class="hljs-string"><span class="hljs-string">'iPad Yan'</span></span> -configuration Release</code> </pre><br><div class="spoiler">  <b class="spoiler_title">If something does not start, then look spoiler</b> <div class="spoiler_text"><ul><li>  There may be problems with the <i>provisioning profile</i> .  Check if the app is running on the device from Xcode. </li><li>  Verify that there is a container application for the <b>Build Phases</b> test target in <b>Target Dependencies</b> . </li><li>  The <b>Bundle Loader</b> parameter in <b>Build Settings</b> must be set to: <br><pre> <code class="hljs mel">$(BUILT_PRODUCTS_DIR)/MyExistingApp.app/MyExistingApp</code> </pre></li><li>  And the <b>Test Host</b> parameter is set to: <br><pre> <code class="hljs mel">$(BUNDLE_LOADER)</code> </pre></li><li>  In addition, in the build settings of the container application, the <b>Symbols Hidden by Default</b> parameter should be <b>NO</b> . </li></ul><br></div></div><br>  That's all.  Have a good test! <br><br><h4>  Links </h4><br><ul><li>  <a href="https://github.com/rabovik/TravisCITests">Test project on GitHub</a> </li><li>  <a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/xcodebuild.1.html">man xcodebuild</a> </li><li>  <a href="http://travis-ci.org/">Travis-ci</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/212615/">https://habr.com/ru/post/212615/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../212603/index.html">Cutting text vertically or what to do if the text does not fit in height</a></li>
<li><a href="../212605/index.html">Our partners: UC Browser to copy web pages to Evernote on iPhone and iPad</a></li>
<li><a href="../212607/index.html">What version of java are you using?</a></li>
<li><a href="../212609/index.html">Desktop printer: Ricoh Aficio SP C430DN printer overview</a></li>
<li><a href="../212611/index.html">RAD Studio XE5 World Tour</a></li>
<li><a href="../212617/index.html">Viber bought for 900 million dollars</a></li>
<li><a href="../212619/index.html">New IE 0day vulnerability used for drive-by</a></li>
<li><a href="../212621/index.html">We lift simple DAV server on Linux</a></li>
<li><a href="../212623/index.html">Russian breakthrough IT research</a></li>
<li><a href="../212629/index.html">Quick start to the stock market: 10 steps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>