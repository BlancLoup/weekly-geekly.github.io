<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lifehack for Same-Origin-Policy; Google Chrome and others</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Task: 
 - there is a REST server 
 - there is a one-page application (HTML / CSS / Javascript) which takes data from the server via XMLHttpRequest 
 -...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lifehack for Same-Origin-Policy; Google Chrome and others</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/b07/ca4/038/b07ca403862a9b30029a5f765a86c7a7.jpg" alt="debuger"><br><br>  <b>Task:</b> <br>  - there is a REST server <br>  - there is a one-page application (HTML / CSS / Javascript) which takes data from the server via XMLHttpRequest <br>  - need to develop a new feature <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When a front-end developer is faced with such a task, there are two options for vskidku: <br>  - raise the test server on localhost <br>  - ask the back-end to add the ‚ÄúAllow-Control-Allow-Origin: *‚Äù header to the server‚Äôs response to use <a href="http://habrahabr.ru/post/120917/">XMLHttpRequest2</a> <br><br>  The first option is time consuming and not always possible.  The second option is also not the best - to put "Allow-Control-Allow-Origin: *" seems to be not safe, and the back-end can do it for a long time. <br><br>  And then a seemingly <i>trivial idea</i> occurred to me - why should I change the headers on the server, if this can be done directly on the client. <br><br>  I tried <a href="http://habrahabr.ru/post/140147/">to write</a> about Fiddler once. <br><br><div class="spoiler">  <b class="spoiler_title">Fiddler Solution</b> <div class="spoiler_text">  Actually everything is trite and simple. <br>  - On the tab ‚ÄúFilters‚Äù Turn on Use filters <br>  - turn on ‚ÄúSet response header‚Äù and add the desired header ‚ÄúAllow-Control-Allow-Origin: *‚Äù <br>  <s>- enable ‚ÄúSet request header‚Äù is needed for Chrome; it is</s> <i>not needed for chrome; see below for flags in chrome</i> <br><img src="https://habrastorage.org/storage2/613/f2e/180/613f2e180b91106785102e03533eaccb.jpg"><br>  Everything! <br></div></div><br>  I am afraid that if the article ended on this, the public would not have appreciated, and I‚Äôm pretending to me and the post a little less than completely, so the solution for those who do not want to have anything in common with Fiedler and who is not looking for easy ways follows. <br><br>  Among the extensions for Chrome, for some reason I did not come across any one that could change the Response headers, although perhaps I was not looking well.  Therefore, I decided to write my bicycle quickly.  <a href="https://chrome.google.com/webstore/detail/allow-control-allow-origi/nlfbmbojpeacfghkpbjhddihlkkiljbi">link to the extension</a> and <a href="https://github.com/vitvad/Access-Control-Allow-Origin">github because it is fashionable and youth</a> <br><br><div class="spoiler">  <b class="spoiler_title">Chrome extension</b> <div class="spoiler_text">  <b><a href="https://developer.chrome.com/extensions/manifest.html">manifest.json</a></b> <br><pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Allow-Control-Allow-Origin: *"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"manifest_version"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Allow to you request any site with ajax from any source. Add to response - 'Allow-Control-Allow-Origin: *' header"</span></span>, <span class="hljs-string"><span class="hljs-string">"background"</span></span>: { <span class="hljs-comment"><span class="hljs-comment">//      "scripts": ["background.js"] }, "browser_action": { //      , "default_popup"    "default_icon": "off.gif", "default_title": "Allow-Control-Allow-Origin" }, "permissions": [ "storage", //  localStorage "webRequest", // webRequest API "webRequestBlocking", "*://*/*" //      ], "web_accessible_resources": [ //  -             "on.gif","off.gif" ] }</span></span></code> </pre> <br>  A little more detail: <br>  - <b>‚Äúbackground‚Äù</b> - <a href="https://developer.chrome.com/extensions/event_pages.html">one</a> , <a href="https://developer.chrome.com/extensions/background_pages.html">two</a> briefly - in order for the extension to work when Chrome runs in the background. <br>  In "permissions": ["*: // * / *"] you can specify the addresses of sites where the extension works and where there is access to send an ajax request from the extension.  Alternative <a href="https://developer.chrome.com/extensions/content_scripts.html">content_scripts</a> : [...], <br>  if you need to embed the script directly on the pages of the open site (useful if you need to use functions and variables declared in the site scripts, otherwise the extension works in its scope and the site scripts in its own) <br>  - <a href="https://developer.chrome.com/extensions/browserAction.html"><b>"browser_action"</b></a> - Needed to add a button to enable and disable the extension <br>  alternative <a href="https://developer.chrome.com/extensions/pageAction.html">page_action</a> <br>  page_action and browser_action cannot be used simultaneously <br>  - <a href="https://developer.chrome.com/extensions/webRequest.html">webRequest API</a> and webRequestBlocking - replace request and response headers <br>  - <b>‚Äúweb_accessible_resources‚Äù</b> - otherwise the path to the picture should look like this: <br>  <i>need a path:</i> <br>  background-image: url ("/ sprites.png"); <br>  <i>CSS</i> <br>  background-image: url ('chrome-extension: //__MSG_@@extension_id__/sprites.png'); <br>  <i>Js</i> <br>  var url = chrome.extension.getURL ('sprites.png'); <br><br>  <b>backgound.js</b> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> requestListener = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">details</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> flag = <span class="hljs-literal"><span class="hljs-literal">false</span></span>, rule = { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">"Origin"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-string"><span class="hljs-string">"http://evil.com/"</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; details.requestHeaders.length; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (details.requestHeaders[i].name === rule.name) { flag = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; details.requestHeaders[i].value = rule.value; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!flag) details.requestHeaders.push(rule); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">requestHeaders</span></span>: details.requestHeaders}; }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> responseListener = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">details</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rule = { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Access-Control-Allow-Origin"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>: <span class="hljs-string"><span class="hljs-string">"*"</span></span> }; details.responseHeaders.push(rule); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {<span class="hljs-attr"><span class="hljs-attr">responseHeaders</span></span>: details.responseHeaders}; }; <span class="hljs-comment"><span class="hljs-comment">/*On install*/</span></span> chrome.runtime.onInstalled.addListener(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ localStorage.active = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }); <span class="hljs-comment"><span class="hljs-comment">/*Icon change*/</span></span> chrome.browserAction.onClicked.addListener(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tab</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(localStorage.active === <span class="hljs-string"><span class="hljs-string">"true"</span></span>){ localStorage.active = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; chrome.browserAction.setIcon({<span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">"off.gif"</span></span>}); <span class="hljs-comment"><span class="hljs-comment">/*Remove Response Listener*/</span></span> chrome.webRequest.onHeadersReceived.removeListener(responseListener); chrome.webRequest.onBeforeSendHeaders.removeListener(requestListener); }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ localStorage.active = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; chrome.browserAction.setIcon({<span class="hljs-attr"><span class="hljs-attr">path</span></span>: <span class="hljs-string"><span class="hljs-string">"on.gif"</span></span>}); <span class="hljs-comment"><span class="hljs-comment">/*Add Response Listener*/</span></span> chrome.webRequest.onHeadersReceived.addListener(responseListener,{ <span class="hljs-attr"><span class="hljs-attr">urls</span></span>: [ <span class="hljs-string"><span class="hljs-string">"*://*/*"</span></span> ] },[<span class="hljs-string"><span class="hljs-string">"blocking"</span></span>, <span class="hljs-string"><span class="hljs-string">"responseHeaders"</span></span>]); chrome.webRequest.onBeforeSendHeaders.addListener(requestListener,{ <span class="hljs-attr"><span class="hljs-attr">urls</span></span>: [ <span class="hljs-string"><span class="hljs-string">"*://*/*"</span></span> ] },[<span class="hljs-string"><span class="hljs-string">"requestHeaders"</span></span>]); } });</code> </pre><br><br>  More details on the code: <br>  Callbacks for <b>onHeadersReceived</b> and <b>onBeforeSendHeaders</b> rendered responseListener and requestListener into separate functions, respectively, so that after the plug-in is turned on and off, the headers are not replaced.  We remove the hung <a href="http://developer.chrome.com/extensions/events.html">handlers.</a> <br><br>  <b>chrome.runtime.onInstalled</b> - run once - there you can initialize the default state of the plugin <br><br>  <b>chrome.browserAction.onClicked</b> .addListener - when we click on the extension button - we catch the event and simulate switching on and off of the plugin <br><br>  <b>if (localStorage.active === "true")</b> - for some reason I stumble on it every time and forget that the keys in localStorage are stored in &lt;String&gt; <br><br>  In fact, we do not need onBeforeSendHeaders, but since Chrome does not allow sending ajax requests to localhost, we had to add. <br>  In the first version of the extension, I did not notice this because when I run chrome, I have the flag --allow-file-access-from-files <br><br>  You can read more about the flags <a href="http://peter.sh/experiments/chromium-command-line-switches/">here</a> and <a href="http://www.chromium.org/developers/how-tos/run-chromium-with-flags">here.</a> <br><br>  I have these: <br>  <s>Right click on the shortcut -&gt; Properties -&gt; Targets</s> <br>  C: \ Users \ Ololo \ AppData \ Local \ Google \ Chrome \ Application \ chrome.exe - <b>allow-file-access-from-files - remote-debugging-port = 9222 - allow-file-access - allow -cross-origin-auth-prompt</b> <br></div></div><br>  As for the FF - for some reason, here too I did not find extensions for replacing the response from the server, but again I could not search well.  If someone tells insert in the post. <br><br>  <b>PS</b> <br>  I hope you find the extension or advice useful.  For those who thought it was banal and not worthy of a habr, I apologize, but at least one person was not as obvious as it became useful for you (me). <br>  I have doubts about security, in theory with the included extension, you can score on any site from <a href="http://en.wikipedia.org/wiki/Cross-Origin_Resource_Sharing">CORS</a> , but we are all honest and will use it only for development. <br><br>  <b>Pss</b> <br>  The topic of the post does not apply, but maybe someone wanted and forgotten - yesterday (January 21), another round of <a href="https://education.10gen.com/">online courses</a> on MongoDB began <br>  Impressions of the course can be read <a href="http://habrahabr.ru/post/162603/">here</a> .  Registration for the course should be available within a couple of weeks (judging by the previous round) </div><p>Source: <a href="https://habr.com/ru/post/166539/">https://habr.com/ru/post/166539/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../166527/index.html">Methodology Milashevich training technical translation</a></li>
<li><a href="../166529/index.html">Intel Perceptual Computing SDK</a></li>
<li><a href="../166531/index.html">Github is blocked in China</a></li>
<li><a href="../166533/index.html">Sergey Brin in the New York subway with glasses Google Glass</a></li>
<li><a href="../166537/index.html">The idea for a million or a new market with learning blackjack and sex technique</a></li>
<li><a href="../166543/index.html">Release of fuse-exfat 1.0.0</a></li>
<li><a href="../166549/index.html">Paul Graham: How to find an idea for a startup (part one)</a></li>
<li><a href="../166553/index.html">In the footsteps of New Year's corporate events</a></li>
<li><a href="../166557/index.html">Trolley Scanner</a></li>
<li><a href="../166561/index.html">Mobile Officer at Aruba Networks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>