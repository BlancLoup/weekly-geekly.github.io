<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MonCach√© - implementation of the MongoDB API based on InterSystems Cach√©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="IDEA 
 The idea of ‚Äã‚Äãthe project is to try to implement the basic functions of the MongoDB API to search, save, update and delete documents so that yo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MonCach√© - implementation of the MongoDB API based on InterSystems Cach√©</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/26f/995/320/26f995320d4a4d5fbe44c8ba3b3fe24d.png"></div><br><h4>  <b>IDEA</b> </h4><br>  The idea of ‚Äã‚Äãthe project is to try to implement the basic functions of the MongoDB API to search, save, update and delete documents so that you can use InterSystems Cach√© without changing the client code instead of MongoDB. <br><br><h4>  <b>MOTIVATION</b> </h4><br>  Perhaps if you take the MongoDB interface and use InterSystems Cach√© as a data warehouse, you can get some performance gain. <br><br>  Well, why not ?!  ¬Ø \ _ („ÉÑ) _ / ¬Ø <br><a name="habracut"></a><br><h4>  <b>LIMITATIONS</b> </h4><br>  Within the framework of the research project, several simplifications were made: <br>  - only primitive <a href="https://docs.mongodb.org/manual/reference/bson-types">data types are used</a> : <br>  - null, boolean, number, string, array, object, ObjectId; <br>  - client code works with MongoDB through the MongoDB driver; <br>  - client code uses MongoDB Node.js driver; <br>  - client code uses only the basic MongoDB API functions: <br>  - <a href="">find</a> , <a href="https://docs.mongodb.org/manual/reference/method/db.collection.findOne">findOne</a> - search for documents; <br>  - <a href="">save</a> , <a href="https://docs.mongodb.org/manual/reference/method/db.collection.insert">insert</a> - save documents; <br>  - <a href="https://docs.mongodb.org/manual/reference/method/db.collection.update">update</a> - update documents; <br>  - <a href="https://docs.mongodb.org/manual/reference/method/db.collection.remove">remove</a> - delete documents; <br>  - <a href="https://docs.mongodb.org/manual/reference/method/db.collection.count">count</a> - counting documents. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <b>REALIZATION</b> </h4><br>  As a result, the task was divided into the following subtasks: <br>  - play the MongoDB Node.js driver interface using the selected basic functions; <br>  - implement this interface using as a data warehouse - InterSystems Cach√©: <br>  - develop a database presentation scheme in Cach√©; <br>  - develop a scheme for the presentation of collections in Cach√©; <br>  - develop a scheme for the submission of documents in Cach√©; <br>  - develop a scheme for interaction with Cach√© using Node.js; <br>  - implement the developed schemes and test a <i>little</i> .  :) <br><br><h4>  <b>IMPLEMENTATION DETAILS</b> </h4><br>  There were no special difficulties with the first subtask, so I will go straight to the subtask of the implementation of the interface. <br><br>  MongoDB defines <a href="https://docs.mongodb.org/manual/reference/glossary">the database</a> as a physical container for <a href="https://docs.mongodb.org/manual/reference/glossary">collections</a> .  And the collection as a set of <a href="https://docs.mongodb.org/manual/reference/glossary/">documents</a> .  And finally, the document as a data set.  The document is similar to a <a href="https://docs.mongodb.org/manual/reference/glossary/">JSON</a> document, but with a large number of valid types - <a href="https://docs.mongodb.org/manual/reference/glossary/">BSON</a> . <br><br>  In InterSystems Cach√©, all data is stored in <a href="">globals</a> .  Simply, you can think of globala as hierarchical data structures. <br><br>  In this project, all data will be stored in one global - <b>^ MonCache</b> . <br><br>  Thus, it is required to develop a diagram of the presentation of the database, collections and documents using hierarchical data structures. <br><br><h6>  <b>Database representation scheme in Cach√©</b> </h6><br>  In MongoDB, there can be several databases on one instance, which means you need to develop a presentation scheme that allows you to store several databases that would be isolated from each other.  It is also important to note that MongoDB supports non-collection databases (hereinafter <i>referred to as ‚Äúempty‚Äù</i> databases). <br><br>  I chose the simplest and most obvious way to solve the problem.  Databases are represented by the first level node in the global ^ MonCache.  In addition, the value of "" is assigned to such a node in order to implement support for "empty" databases.  The thing is that if you do not do this and simply add child nodes, then as soon as all child nodes are deleted, the parent node will also be removed (features of globals). <br><br>  Total, each database is represented in Cach√© as follows: <br><br><pre><code class="lisp hljs">^MonCache(<span class="hljs-name"><span class="hljs-name">&lt;db&gt;</span></span>) = <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre> <br>  For example, the database representation "my_database" would be: <br><br><pre> <code class="lisp hljs">^MonCache(<span class="hljs-string"><span class="hljs-string">"my_database"</span></span>) = <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre><br><h6>  <b>Cach√© Collections Presentation Scheme</b> </h6><br>  MongoDB defines a collection as a database item.  All collections in one database have a unique name, which means the name can be used to uniquely identify the collection.  This fact allowed me to find an easy way to present collections in the global, namely to use second-level nodes.  Now we need to solve two small problems.  The first is that, like databases, collections can also be empty.  The second is that the collection is a collection of documents.  And all documents must be isolated from each other.  Honestly, I never thought of anything better than storing a counter, something like an auto-increment value, as the value of a collection node.  All documents have their own unique number.  When a new document is inserted into the collection, a node is created with the name equal to the current counter value, and then the counter value is increased by 1. <br><br>  In total, each collection is represented in Cach√© as follows: <br><br><pre> <code class="lisp hljs">^MonCache(<span class="hljs-name"><span class="hljs-name">&lt;db&gt;</span></span>) = <span class="hljs-string"><span class="hljs-string">""</span></span> ^MonCache(<span class="hljs-name"><span class="hljs-name">&lt;db&gt;</span></span>, &lt;collection&gt;) = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  For example, the representation of the collection ‚Äúmy_collection‚Äù in the database ‚Äúmy_database‚Äù would be: <br><br><pre> <code class="lisp hljs">^MonCache(<span class="hljs-string"><span class="hljs-string">"my_database"</span></span>) = <span class="hljs-string"><span class="hljs-string">""</span></span> ^MonCache(<span class="hljs-string"><span class="hljs-string">"my_database"</span></span>, <span class="hljs-string"><span class="hljs-string">"my_collection"</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br><h6>  <b>Cach√© Document Submission Scheme</b> </h6><br>  The document in this project is a JSON document extended by an additional type - ObjectId.  It was necessary to develop a scheme for the presentation of documents on hierarchical data structures.  Here I had a few surprises.  Firstly, there is no way to use native null in Cach√©, since Cach√© does not support null.  The second interesting point is that boolean values ‚Äã‚Äãare implemented with constants 0 and 1. That is, roughly speaking, true - 1, false - 0. The most expected problem point was what you need to think of how to store an ObjectId.  In general, all these problems have been successfully solved in the most, as it seemed to me, simple form.  Next, I will look at each data type and its presentation. <br><br><div class="spoiler">  <b class="spoiler_title">Presentation schemes</b> <div class="spoiler_text">  For a more concise record, I will use a special notation - <b>@</b> . <br>  Instead of <b>^ MonCache (&lt;db&gt;, &lt;collection&gt;, &lt;document id&gt;, ...)</b> I'll just write <br>  <b>@ (...)</b> . <br><br>  Let there be a field f of the type ‚Äúnull‚Äù. <br><br><pre> <code class="javascript hljs">f: <span class="hljs-literal"><span class="hljs-literal">null</span></span></code> </pre> <br>  We define for it the following view: <br><br><pre> <code class="lisp hljs">@(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"t"</span></span>) = <span class="hljs-string"><span class="hljs-string">"null"</span></span></code> </pre><br>  Let there be a field f of the type ‚Äúboolean‚Äù (true). <br><br><pre> <code class="javascript hljs">f: <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre> <br>  We define for it the following view: <br><br><pre> <code class="lisp hljs">@(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"t"</span></span>) = <span class="hljs-string"><span class="hljs-string">"boolean"</span></span> @(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  Let there be a field f of the type ‚Äúboolean‚Äù (value false). <br><br><pre> <code class="javascript hljs">f: <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre> <br>  We define for it the following view: <br><br><pre> <code class="lisp hljs">@(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"t"</span></span>) = <span class="hljs-string"><span class="hljs-string">"boolean"</span></span> @(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>) = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  Let there be a field f of the type "number". <br><br><pre> <code class="javascript hljs">f: <span class="hljs-number"><span class="hljs-number">3.14</span></span></code> </pre> <br>  We define for it the following view: <br><br><pre> <code class="lisp hljs">@(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"t"</span></span>) = <span class="hljs-string"><span class="hljs-string">"number"</span></span> @(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>) = <span class="hljs-number"><span class="hljs-number">3.14</span></span></code> </pre><br>  Let there be a field f of the type ‚Äústring‚Äù. <br><br><pre> <code class="javascript hljs">f: <span class="hljs-string"><span class="hljs-string">'Habrahabr.ru'</span></span></code> </pre> <br>  We define for it the following view: <br><br><pre> <code class="lisp hljs">@(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"t"</span></span>) = <span class="hljs-string"><span class="hljs-string">"string"</span></span> @(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>) = <span class="hljs-string"><span class="hljs-string">"Habrahabr.ru"</span></span></code> </pre><br>  Let there be a field f of the type ‚ÄúObjectId‚Äù. <br><br><pre> <code class="javascript hljs">f: ObjectId(<span class="hljs-string"><span class="hljs-string">'56b43c20af9c4f3fe2cc2908'</span></span>)</code> </pre> <br>  We define for it the following view: <br><br><pre> <code class="lisp hljs">@(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"t"</span></span>) = <span class="hljs-string"><span class="hljs-string">"objectid"</span></span> @(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>) = <span class="hljs-string"><span class="hljs-string">"56b43c20af9c4f3fe2cc2908"</span></span></code> </pre><br>  There are two types left: "object" and "array".  By their nature, these types are ‚Äúcontainers‚Äù for values ‚Äã‚Äãof more ‚Äúsimple‚Äù types.  Therefore, you can simply recursively apply the rules already described and get views for the elements of these containers.  The only subtle point is that you need to think of a way to preserve the order of the elements in an array container.  This is solved trivially - all elements are numbered in the traversal order, and the presentation is made in the same order. <br><br>  Suppose there is a field f of type ‚Äúobject‚Äù (empty). <br><br><pre> <code class="javascript hljs">f: {}</code> </pre> <br>  We define for it the following view: <br><br><pre> <code class="lisp hljs">@(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"t"</span></span>) = <span class="hljs-string"><span class="hljs-string">"object"</span></span></code> </pre><br>  Let there be a field f of the type ‚Äúobject‚Äù. <br><br><pre> <code class="javascript hljs">f: { <span class="hljs-attr"><span class="hljs-attr">site</span></span>: <span class="hljs-string"><span class="hljs-string">'Habrahabr.ru'</span></span>, <span class="hljs-attr"><span class="hljs-attr">topic</span></span>: <span class="hljs-number"><span class="hljs-number">276391</span></span> }</code> </pre> <br>  We define for it the following view: <br><br><pre> <code class="lisp hljs">@(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"t"</span></span>) = <span class="hljs-string"><span class="hljs-string">"object"</span></span> @(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>, <span class="hljs-string"><span class="hljs-string">"site"</span></span>, <span class="hljs-string"><span class="hljs-string">"t"</span></span>) = <span class="hljs-string"><span class="hljs-string">"string"</span></span> @(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>, <span class="hljs-string"><span class="hljs-string">"site"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>) = <span class="hljs-string"><span class="hljs-string">"Habrahabr.ru"</span></span> @(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>, <span class="hljs-string"><span class="hljs-string">"topic"</span></span>, <span class="hljs-string"><span class="hljs-string">"t"</span></span>) = <span class="hljs-string"><span class="hljs-string">"number"</span></span> @(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>, <span class="hljs-string"><span class="hljs-string">"topic"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>) = <span class="hljs-number"><span class="hljs-number">276391</span></span></code> </pre><br>  Let there be a field f of the type ‚Äúarray‚Äù (empty). <br><br><pre> <code class="javascript hljs">f: []</code> </pre> <br>  We define for it the following view: <br><br><pre> <code class="lisp hljs">@(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"t"</span></span>) = <span class="hljs-string"><span class="hljs-string">"array"</span></span></code> </pre><br>  Suppose there is a field f of the type ‚Äúarray‚Äù. <br><br><pre> <code class="javascript hljs">f: [ <span class="hljs-string"><span class="hljs-string">'Habrahabr.ru'</span></span>, <span class="hljs-number"><span class="hljs-number">276391</span></span> ]</code> </pre> <br>  We define for it the following view: <br><br><pre> <code class="lisp hljs">@(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"t"</span></span>) = <span class="hljs-string"><span class="hljs-string">"array"</span></span> @(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"t"</span></span>) = <span class="hljs-string"><span class="hljs-string">"string"</span></span> @(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>) = <span class="hljs-string"><span class="hljs-string">"Habrahabr.ru"</span></span> @(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"t"</span></span>) = <span class="hljs-string"><span class="hljs-string">"number"</span></span> @(<span class="hljs-string"><span class="hljs-string">"f"</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"v"</span></span>) = <span class="hljs-number"><span class="hljs-number">276391</span></span></code> </pre><br></div></div><br><h6>  <b>Cach√© Interaction Chart</b> </h6><br>  The logical and simple choice of driver for working with InterSystems Cach√© was the choice of a Node.js driver (on <a href="">the documentation website</a> you can see other drivers for interacting with Cach√©).  However, it is immediately worth noting that the driver capabilities were not enough  I wanted to do several inserts and all this within one transaction.  Therefore, it was decided to develop a set of Cach√© ObjectScript classes that were used to simulate the MongoDB API, but on the Cach√© side. <br><br>  Cach√© Node.js driver did not know how to access classes in Cach√©, but he could make program calls in Cach√©.  This fact led to the writing of a small program - a kind of bridge between the driver and classes in Cach√©. <br><br>  As a result, the scheme looked as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/38f/e34/6c9/38fe346c94ce4663a234d1e7057110fd.png"></div><br>  As part of the project, a special format NSNJSON (Not So Normal JSON) was developed, which allowed us to ‚Äúdrag‚Äù ObjectId, null, true, false through the driver in Cach√©.  This format can be found on the corresponding page on <a href="https://github.com/nsnjson/nsnjson-driver">GitHub - NSNJSON</a> .  I posted three articles on this format on Habrahabr: <br><br>  - <a href="https://habrahabr.ru/post/269461">Complicated simplified JSON</a> ; <br>  - <a href="https://habrahabr.ru/post/269461">JSON for lovers of braces</a> ; <br>  - <a href="https://habrahabr.ru/post/270031">NSNJSON.</a>  <a href="https://habrahabr.ru/post/270031">ÈÅì (Final article)</a> . <br><br><h4>  <b>OPPORTUNITIES MONCACH√â</b> </h4><br>  When executing a document search operation, the following criteria are supported: <br><br>  - <a href="https://docs.mongodb.org/manual/reference/operator/aggregation/eq">$ eq</a> - equivalence; <br>  - <a href="https://docs.mongodb.org/manual/reference/operator/aggregation/ne">$ ne</a> is not equivalent; <br>  - <a href="https://docs.mongodb.org/manual/reference/operator/query/not">$ not</a> - negation of the criterion; <br>  - <a href="https://docs.mongodb.org/manual/reference/operator/query/lt">$ lt</a> - less than; <br>  - <a href="https://docs.mongodb.org/manual/reference/operator/query/gt">$ gt</a> - more than; <br>  - <a href="https://docs.mongodb.org/manual/reference/operator/query/exists">$ exists</a> - existence. <br><br>  The following statements are supported during the update document operation: <br><br>  - <a href="https://docs.mongodb.org/manual/reference/operator/update/set">$ set</a> - set value; <br>  - <a href="https://docs.mongodb.org/manual/reference/operator/update/inc">$ inc</a> - increment the value by the specified value; <br>  - <a href="https://docs.mongodb.org/manual/reference/operator/update/mul">$ mul</a> - multiplying the value by the specified value; <br>  - <a href="https://docs.mongodb.org/manual/reference/operator/update/unset">$ unset</a> - delete value; <br>  - <a href="https://docs.mongodb.org/manual/reference/operator/update/rename">$ rename</a> - rename value. <br><br><h4>  <b>EXAMPLE</b> </h4><br>  I took this code from the page of the official driver and redid it a bit. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> insertDocuments = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">db, callback</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> collection = db.collection(<span class="hljs-string"><span class="hljs-string">'documents'</span></span>); collection.insertOne({ <span class="hljs-attr"><span class="hljs-attr">site</span></span>: <span class="hljs-string"><span class="hljs-string">'Habrahabr.ru'</span></span>, <span class="hljs-attr"><span class="hljs-attr">topic</span></span>: <span class="hljs-number"><span class="hljs-number">276391</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, result</span></span></span><span class="hljs-function">) </span></span>{ assert.equal(err, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Inserted 1 document into the document collection"</span></span>); callback(result); }); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> MongoClient = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mongodb'</span></span>).MongoClient , assert = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'assert'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = <span class="hljs-string"><span class="hljs-string">'mongodb://localhost:27017/myproject'</span></span>; MongoClient.connect(url, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, db</span></span></span><span class="hljs-function">) </span></span>{ assert.equal(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, err); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Connected correctly to server"</span></span>); insertDocument(db, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ db.close(); }); });</code> </pre> <br>  This code can be easily redone so that it works with MonCach√©! <br>  You just need to change the driver! <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// var MongoClient = require('mongodb').MongoClient var MongoClient = require('moncache-driver').MongoClient</span></span></code> </pre> <br>  After executing this code, the global ^ MonCache will look like this: <br><pre> <code class="lisp hljs">^MonCache(<span class="hljs-string"><span class="hljs-string">"myproject"</span></span>,<span class="hljs-string"><span class="hljs-string">"documents"</span></span>)=1 ^MonCache(<span class="hljs-string"><span class="hljs-string">"myproject"</span></span>,<span class="hljs-string"><span class="hljs-string">"documents"</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"_id"</span></span>,<span class="hljs-string"><span class="hljs-string">"t"</span></span>)=<span class="hljs-string"><span class="hljs-string">"objectid"</span></span> ^MonCache(<span class="hljs-string"><span class="hljs-string">"myproject"</span></span>,<span class="hljs-string"><span class="hljs-string">"documents"</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"_id"</span></span>,<span class="hljs-string"><span class="hljs-string">"v"</span></span>)=<span class="hljs-string"><span class="hljs-string">"b18cd934860c8b26be50ba34"</span></span> ^MonCache(<span class="hljs-string"><span class="hljs-string">"myproject"</span></span>,<span class="hljs-string"><span class="hljs-string">"documents"</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"site"</span></span>,<span class="hljs-string"><span class="hljs-string">"t"</span></span>)=<span class="hljs-string"><span class="hljs-string">"string"</span></span> ^MonCache(<span class="hljs-string"><span class="hljs-string">"myproject"</span></span>,<span class="hljs-string"><span class="hljs-string">"documents"</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"site"</span></span>,<span class="hljs-string"><span class="hljs-string">"v"</span></span>)=<span class="hljs-string"><span class="hljs-string">"Habrahabr.ru"</span></span> ^MonCache(<span class="hljs-string"><span class="hljs-string">"myproject"</span></span>,<span class="hljs-string"><span class="hljs-string">"documents"</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"topic"</span></span>,<span class="hljs-string"><span class="hljs-string">"t"</span></span>)=<span class="hljs-string"><span class="hljs-string">"number"</span></span> ^MonCache(<span class="hljs-string"><span class="hljs-string">"myproject"</span></span>,<span class="hljs-string"><span class="hljs-string">"documents"</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"topic"</span></span>,<span class="hljs-string"><span class="hljs-string">"v"</span></span>)=267391</code> </pre> <br><h4>  <b>DEMO</b> </h4><br>  Among other things, a small <a href="http://198.211.126.144:5000/portal">demo application</a> ( <a href="https://github.com/moncache/moncache-nodejs-server">source</a> ) was launched, also implemented on Node.js to demonstrate the driver change from MongoDB Node.js to MonCach√© Node.js without restarting the server and changing the source code.  The application is a tiny demonstration platform for performing CRUD operations on products and offices, as well as an interface for changing configurations (changing drivers). <br><br>  The server allows you to create <a href="http://198.211.126.144:5000/portal">products</a> and <a href="http://198.211.126.144:5000/portal">offices</a> that are saved to the storage selected in the configuration (Cach√© or MongoDB). <br><br>  The <a href="http://198.211.126.144:5000/portal">Orders</a> tab displays a list of orders.  I created the records, but the form did not finish, you can help the project ( <a href="https://github.com/moncache/moncache-nodejs-server">source code</a> ). <br><br>  You can change the configuration by going to the <a href="http://198.211.126.144:5000/portal">"Configuration"</a> page.  On the page there are two buttons "MongoDB" and "MonCache".  By clicking on the appropriate button you choose the configuration you need.  When changing the configuration, the client application reconnects to the data source (an abstraction that separates the application from the driver actually used). <br><br><h4>  <b>CONCLUSION</b> </h4><br>  In conclusion, I will answer the main question.  Yes!  Indeed, it was possible to get some increase in the performance of the basic operations. <br><br>  The <a href="https://github.com/moncache/moncache-nodejs-driver">MonCach√©</a> project <a href="https://github.com/moncache/moncache-nodejs-driver">is published on GitHub</a> and is available under the MIT license. <br><br><h4>  <b>BRIEF INSTRUCTIONS</b> </h4><br><ol><li>  Install Cach√© </li><li>  Download all the necessary MonCach√© components to Cach√© </li><li>  Create a MONCACHE area in Cach√© </li><li>  Create a moncache user in Cach√© with the password ehcacnom </li><li>  Create environment variable MONCACHE_USERNAME = moncache </li><li>  Create an environment variable MONCACHE_PASSWORD = ehcacnom </li><li>  Create an environment variable MONCACHE_NAMESPACE = MONCACHE </li><li>  Change your <a href="https://www.npmjs.com/package/mongodb">mongodb</a> dependency on your project to <a href="https://www.npmjs.com/package/moncache-driver">moncache-driver</a> </li><li>  Run your project!  :-) </li></ol><br><h4>  <b>ACADEMIC PROGRAM INTERSYSTEMS</b> </h4><br>  If you are interested in implementing your own research project on InterSystems technologies, then you can visit a specialized <a href="http://university.intersystems.ru/">website dedicated to InterSystems academic programs</a> . </div><p>Source: <a href="https://habr.com/ru/post/276391/">https://habr.com/ru/post/276391/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276377/index.html">Reducing the size of a thin disk in ESXi</a></li>
<li><a href="../276381/index.html">Who should live and who should die: priorities of processes in Android</a></li>
<li><a href="../276383/index.html">Habra graph, community and where did all the karma go</a></li>
<li><a href="../276385/index.html">Hyper-scale server farm Amazon, Apple, Google, Switch, Toyota</a></li>
<li><a href="../276389/index.html">Telegram bot framework</a></li>
<li><a href="../276393/index.html">Smart babysitter based on Intel Edison and Ubidots</a></li>
<li><a href="../276395/index.html">Cache it: increase the stability of the ONLYOFFICE server with Redis</a></li>
<li><a href="../276397/index.html">What is the future of email: Opinions of the creator of Wikipedia, engineers and entrepreneurs from Silicon Valley</a></li>
<li><a href="../276399/index.html">What experts in Data Science and Big Data are discussing today</a></li>
<li><a href="../276401/index.html">The book "Hello World! Entertaining programming ¬ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>