<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create a Viber bot using PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In November 2016, Viber introduced public accounts ( Viber public account , or simply PA). With their release, api became available, which allows: 


...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create a Viber bot using PHP</h1><div class="post__text post__text-html js-mediator-article"><p>  In November 2016, Viber introduced public accounts ( <em>Viber public account</em> , or simply PA).  With their release, api became available, which allows: </p><br><ul><li>  chat with user </li><li>  check the status of subscribers (online, offline) </li><li>  get information about a specific subscriber </li><li>  make entries (posts) on your page </li></ul><br><p>  All this allows you to create a pretty good bot, or integrate a bot into an existing project, which may well improve the quality of user interaction.  If you have already created bots for a telegram or slack, then creating a bot for Viber will not be difficult. </p><a name="habracut"></a><br><h2 id="vstuplenie">  Introduction </h2><br><p>  Some time ago I had a need to interact with Viber users.  I would like to introduce standard dialogs with users into my application, and also provide "button dialogs" (in those cases when the user sees several buttons under the chat).  But at that time there was no open (public) API for this, and we had to either refuse or dodge with a rake. </p><br><p>  With the release of public accounts (PA), the situation has changed, now we can create a more complete interaction with the "button dialogs" and the "conversions" we need.  All this is great, if not one BUT - <strong>there</strong> is <strong>no SDK for PHP</strong> (for the sake of justice, there is sdk for <a href="https://github.com/Viber/viber-bot-node">nodejs</a> and <a href="https://github.com/Viber/viber-bot-python">python</a> ).  I decided to fill this gap, and describe how you can create a simple bot in php, and create an SDK in one. </p><br><h2 id="pervye-shagi">  The first steps </h2><br><p>  Before creating a bot, you need to access a special account type.  It may seem strange to you, but at the time of writing this post it is.  To do this, go to <a href="https://www.viber.com/en/public-accounts">https://www.viber.com/en/public-accounts</a> and fill in the required form: </p><br><p><img src="https://habrastorage.org/files/902/56a/2a3/90256a2a356045e5ae4d2034611b4aa1.jpg" alt="early access to pa"></p><br><p>  In the form you indicate the phone to which access to public accounts will be issued, and after a while you will receive messages of the format "... You will have access to Public Accounts! ...".  After that, you need to restart the Viber client and go through the following steps: </p><br><ol><li><p>  Open the section "Public Accounts" (icon at the top right - <img src="https://github.com/Bogdaan/viber-bot-php/raw/master/docs/i-public_account_button.png" alt="ico">  ) </p><br></li><li><p>  Click on "create an account" (the icon at the bottom right - <img src="https://github.com/Bogdaan/viber-bot-php/raw/master/docs/i-create_button.png" alt="ico">  ) </p><br></li><li>  Fill in the data for your bot (requires a background image, the specified category, name, description, etc.) </li></ol><br><p>  At the last step, the choice of how to work with messages will be available, select "api" and copy the key.  (or you can just watch it on the "information editing" screen of PA): </p><br><p><img src="https://github.com/Bogdaan/viber-bot-php/raw/master/docs/i-authToken.jpg" alt="edit page token"></p><br><p> For example, my key will be: <code>1111111111111111-2222222222222222-3333333333333333</code> </p><br><h2 id="servernaya-chast">  Server part </h2><br><p>  To develop the bot and work with the Viber-API, I use a small SDK: <a href="https://github.com/Bogdaan/viber-bot-php">https://github.com/Bogdaan/viber-bot-php</a> .  It will allow to omit some details of the interaction with REST-api and build some logic of our bot.  Install it: </p><br><pre> <code class="hljs perl">composer <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> bogdaan/viber-bot-php</code> </pre> <br><p>  First we need to register the webhuk address - the address to which the vibe backend will deliver messages from users and some other events.  The web server on which the bot will be located (and, accordingly, the webhost) must work via https with the correct SSL certificate.  A self-signed certificate will not work here, if not, try using <a href="https://letsencrypt.org/">letsencrypt.org</a> . </p><br><p>  For example, my webhuk will be: <code>https://viber.hcbogdan.com/bot.php</code> .  Create a file <code>setup.php</code> : </p><br><pre> <code class="hljs bash">&lt;?php require_once(<span class="hljs-string"><span class="hljs-string">"../vendor/autoload.php"</span></span>); use Viber\Client; <span class="hljs-variable"><span class="hljs-variable">$apiKey</span></span> = <span class="hljs-string"><span class="hljs-string">'1111111111111111-2222222222222222-3333333333333333'</span></span>; // &lt;- PLACE-YOU-API-KEY-HERE <span class="hljs-variable"><span class="hljs-variable">$webhookUrl</span></span> = <span class="hljs-string"><span class="hljs-string">'https://viber.hcbogdan.com/bot.php'</span></span>; // &lt;- PLACE-YOU-HTTPS-URL try { <span class="hljs-variable"><span class="hljs-variable">$client</span></span> = new Client([ <span class="hljs-string"><span class="hljs-string">'token'</span></span> =&gt; <span class="hljs-variable"><span class="hljs-variable">$apiKey</span></span> ]); <span class="hljs-variable"><span class="hljs-variable">$result</span></span> = <span class="hljs-variable"><span class="hljs-variable">$client</span></span>-&gt;setWebhook(<span class="hljs-variable"><span class="hljs-variable">$webhookUrl</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Success!\n"</span></span>; } catch (Exception <span class="hljs-variable"><span class="hljs-variable">$e</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Error: "</span></span>. <span class="hljs-variable"><span class="hljs-variable">$e</span></span>-&gt;getError() .<span class="hljs-string"><span class="hljs-string">"\n"</span></span>; }</code> </pre> <br><p>  And register the webbook by running the file: </p><br><pre> <code class="hljs swift">$ php setup.php <span class="hljs-type"><span class="hljs-type">Success!</span></span></code> </pre> <br><p>  Now, when the user sends a message, or enters the chat, requests will be sent to the webhuk address.  Create a <code>bot.php</code> file: </p><br><pre> <code class="hljs perl">&lt;?php require_once(<span class="hljs-string"><span class="hljs-string">"../vendor/autoload.php"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> Viber\Bot; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> Viber\Api\Sender; $apiKey = <span class="hljs-string"><span class="hljs-string">'&lt;PLACE-YOU-API-KEY-HERE&gt;'</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      (   -  ) $botSender = new Sender([ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Whois bot'</span></span>, <span class="hljs-string"><span class="hljs-string">'avatar'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'https://developers.viber.com/img/favicon.ico'</span></span>, ]); try { $bot = new Bot([<span class="hljs-string"><span class="hljs-string">'token'</span></span> =&gt; $apiKey]); $bot -&gt;onConversation(function ($event) <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> ($bot, $botSender) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    ,       //    <span class="hljs-string"><span class="hljs-string">""</span></span>,       <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (new \Viber\Api\Message\Text()) -&gt;setSender($botSender) -&gt;setText(<span class="hljs-string"><span class="hljs-string">"Can i help you?"</span></span>); }) -&gt;onText(<span class="hljs-string"><span class="hljs-string">'|whois .*|si'</span></span>, function ($event) <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> ($bot, $botSender) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>         //      $bot-&gt;getClient()-&gt;sendMessage( (new \Viber\Api\Message\Text()) -&gt;setSender($botSender) -&gt;setReceiver($event-&gt;getSender()-&gt;getId()) -&gt;setText(<span class="hljs-string"><span class="hljs-string">"I do not know )"</span></span>) ); }) -&gt;run(); } catch (Exception $e) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> todo - <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> exceptions }</code> </pre> <br><p>  Next, it remains to place the <code>bot.php</code> file so that it is available at <code>https://viber.hcbogdan.com/bot.php</code> , and go to the chat with the bot from the client's viber.  If you do not see the answers of the bot, then you should check your error_log and access_log for errors. </p><br><p>  You can slightly improve the functionality of the bot and add logging.  We do this with the monolog: </p><br><pre> <code class="hljs perl">composer <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> monolog/monolog</code> </pre> <br><p>  And add the exception logging: </p><br><pre> <code class="hljs perl">&lt;?php //... } catch (Exception $e) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> <span class="hljs-keyword"><span class="hljs-keyword">log</span></span> exceptions $log = new \Monolog\Logger(<span class="hljs-string"><span class="hljs-string">'bot'</span></span>); $log-&gt;pushHandler(new \Monolog\Handler\StreamHandler(<span class="hljs-string"><span class="hljs-string">'/tmp/bot.log'</span></span>)); $log-&gt;warning(<span class="hljs-string"><span class="hljs-string">'Exception: '</span></span>. $e-&gt;getMessage()); }</code> </pre> <br><p>  All exceptions will be <code>/tmp/bot.log</code> to <code>/tmp/bot.log</code> . </p><br><p>  The basic version of your bot is ready, you can add your own logic, add buttons to the chat, use deep links and html markup - all this is available in the SDK.  I created several demos that you can see in the <a href="http://viber//pa%3FchatURI%3Dviber-bot-php%26context%3Dhabrahabr">viber</a> chat <a href="http://viber//pa%3FchatURI%3Dviber-bot-php%26context%3Dhabrahabr">: // pa? ChatURI = viber-bot-php &amp; context = habrahabr</a> .  If you do not already have a viber client, you can find the chat at this link: <a href="http://chats.viber.com/viber-bot-php">viber-bot-php</a> . </p><br><h2 id="poleznye-ssylki">  useful links </h2><br><ul><li>  <a href="https://github.com/Bogdaan/viber-bot-php">Php sdk</a> </li><li>  <a href="https://github.com/Bogdaan/viber-bot-php/blob/master/examples/bot-plus.php">Another example of a viber bot</a> </li><li>  <a href="https://developers.viber.com/api/rest-bot-api/index.html">REST-api documentation</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/321246/">https://habr.com/ru/post/321246/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321236/index.html">Angular - setting up the development and production environment for assemblies with AOT compilation and tree-shaking (Gulp, Rollup, SystemJS)</a></li>
<li><a href="../321238/index.html">Electronic ink for Wirenboard 5 or paint barcodes on Go</a></li>
<li><a href="../321240/index.html">What is traffic arbitration?</a></li>
<li><a href="../321242/index.html">Why I do not like synthetic tests</a></li>
<li><a href="../321244/index.html">Work with Flexbox in gifs</a></li>
<li><a href="../321248/index.html">How IT professionals work. Nikolai Grigoriev, architect of mobile games and applications</a></li>
<li><a href="../321250/index.html">We write the easiest and fastest input type file</a></li>
<li><a href="../321252/index.html">Tarantool: Good, Bad, Angry</a></li>
<li><a href="../321254/index.html">Pass to the ground - how Apple Pay and Samsung Pay were launched in Yandex.Money</a></li>
<li><a href="../321256/index.html">The logic of consciousness. Part 11. Natural coding of visual and sound information</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>