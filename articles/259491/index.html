<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Motion sensor for switching radio stations - part II</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! Today is the continuation of an improvised cycle of detailed posts for beginners. In the last post, we took a ready-made set of radio constr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Motion sensor for switching radio stations - part II</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  Today is the continuation of an improvised cycle of detailed posts for beginners.  In the <a href="http://habrahabr.ru/company/masterkit/blog/258691/">last post,</a> we took a ready-made set of radio constructors with Arduino and an ultrasonic range finder in order not only to combine them, and to be able to tune the radio ‚Äúwith one hand,‚Äù but also to sort out ‚ÄúArduinostroenii‚Äù from scratch.  If you only have Arduino and the sensor itself, you can also try to collect something from this post, but, apparently, stop, after you set up a good ultrasonic line - this is also good.  I wanted to go ahead and put the sensor on an expansion board to create a finished device.  That's how it came out for me. <br><br><img src="https://habrastorage.org/files/f2c/8c4/a7c/f2c8c4a7ced64bc38db7cd62e33aa9ef.jpg"><br><a name="habracut"></a><br>  We stopped at the fact that if everything became more or less with the sensor itself and its pins (I hope, more than less), it is not clear to which pins at Arduino and why.  Let's answer this question. <br><br><h2>  Pins on Arduino </h2><br>  Arduino Nano (chosen by chance, since it is small and suitable for prototyping moving and portable objects) is included in the package.  There is a wonderful <a href="">layout of her pinot</a> in (not the only one, but I like it the most). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As in the circuit diagram of the device, we so far will pay attention only to two parts of this scheme: <br><br><img src="https://habrastorage.org/files/29d/7c4/80f/29d7c480fa0d4bf191858940e2664356.png"><br><br>  On the left we see pins 5 and 6. Look again at the schematic diagram of the device from the <a href="http://habrahabr.ru/company/masterkit/blog/258691/">first part of the post</a> .  From K4 and K5, the contact goes to pins D5 and D6.  This means that the shield on which we are currently working transfers the voltage from these contacts to / from these pins: logical zero - 0 V;  the logical unit is 5 V. Therefore, connecting something to these contacts, we will send \ receive a signal from these pins. <br><br>  In principle, if, for example, we assemble a prototype not on a ready-made shield, but on a brainboard, you can connect the sensor directly to specific Arduino pins.  In this case, the shield simply helps to conveniently and beautifully assemble the device on the board so that it does not crumble in the hands. <br><br>  Why did we choose these two legs of Arduino?  Two reasons: <br><br>  1. It was they who ‚Äúremained free‚Äù in our scheme. <br>  2. They are the digital inputs / outputs that we can program to receive / send a signal. <br><br>  Based on the last phrase, guess which pins of the sensor we connect to K4 and K5?  That's right, digital input and output devices. <br><br><blockquote>  <b>Mistress note:</b> <br><br>  Digital I / O or - more correctly - Arduino Nano‚Äôs digital lines are D0 - D13 pins;  can be both digital and analog A0 - A5;  only analog A6, A7. </blockquote><br><br>  Precisely because it is possible to hook up devices sending / receiving a signal to the digital inputs \ outputs of Arduino, we could add here any other sensor or component, for example: a sensor of temperature, humidity, color, sound, light, etc., or executive devices like relays. <br><br>  This is important information for the future, since it is thanks to it that you can have an idea of ‚Äã‚Äãwhich components and how you can connect with your MC, creating your own prototype or device. <br><br><h2>  Power connection through Arduino </h2><br>  Ok, with two sensor pins sorted out.  Now where to connect the sensor power - the two remaining pins plus and minus? <br><br>  Arduino has several interchangeable power supply options.  In our case, we can connect the finished device (radio) through the batteries (the battery compartment I have now soldered so as not to interfere), as well as via USB.  And here, and there at the entrance, we get 5 volts - what we need. <br><br>  However, to date, we have two pins of the sensor connected to the Arduino pins to receive / send a signal, and the pins of the sensor power supply are free.  There is an exit!  We can connect them to the pins located at the top of Arduino (see top of the pin layout).  This is the part labeled ICSP.  The dot marked pin # 1.  Next, the pins are arranged in pairs: <br><br>  1 and 2, where 2 is Plus, Vcc <br>  3 and 4 <br>  5 and 6, where 6 is Minus, Grnd, Ground <br><br>  Here all the same voltage of 5 volts.  <b>Is it possible to connect a sensor here?</b>  Do you need, for example, resistors?  <a href="http://masterkit.ru/zip/mp562.pdf">We look at his performance characteristics</a> : <br><br>  Power supply: 5 V <br>  Power consumption in silence: 2mA <br>  Consumption at work: 15mA <br><br>  The correct answer is: you can.  Resistors are not needed. <br><br><blockquote>  <b>Important:</b> if we mix up the plus and the minus, then the first time, we may not burn Arduino.  Some components will heat up, some may start to smoke.  But, if something really burns, then most likely it will be a sensor, since  the power poles for it will be confused, and instead of 5 V it will have -5 V, that is, the sensor supply voltage will go beyond the permissible limit (5V per TTX). </blockquote><br><br><h2>  Component assembly </h2><br>  This is what happens when we connect the Arduino and the sensor via an expansion card: <br><br><img src="https://habrastorage.org/files/b4e/f8f/2bf/b4ef8f2bfbbb400ab5f5ffeb03c57110.jpg"><br><br>  Only the shield, the Arduino and the sensor that we connected as shown above are shown here.  We do not need all the other components yet, as we have not yet been informed about whether our new sensor is working.  If you put Arduino in his place on the board, everything will be ready to test the sensor.  Therefore, further with the "iron" everything, it is the turn of programming. <br><br>  At this stage, if you do not use, like me, an expansion card from <a href="http://masterkit.ru/shop/arduino/modules/1321792">this set</a> , you can directly connect the sensor to the required Arduino pins and act further.  Once again I repeat that, unfortunately, the author of the post is not responsible if you mix up something when you connect and burn Arduino or the sensor.  So please be careful. <br><br><h2>  Programming: sensor test </h2><br>  Last time we learned how to load a sketch for the operation of the entire device and a driver library for the operation of its individual components.  It seemed to us that IDE works approximately like iTunes, loading the program into an MC like music into a player.  However, now we will learn an additional opportunity: it turns out that with the help of IDE you can directly ping a new sensor, checking its operation and setting it up.  Here is how it is done: <br><br>  <b>Step 1:</b> Download the <a href="">library for the sensor</a> .  If you don't know how to work with the library and the sketch, you can quickly learn it <a href="http://habrahabr.ru/company/masterkit/blog/257747/">here</a> . <br><br>  <b>Step 2:</b> Open the NoBlindDemo2 example in a text editor. <br>  This is a .pde file ‚Äî <a href="https://ru.wikipedia.org/wiki/Processing">Processin</a> g files have this extension.  This is the same sketch.  Arduino understands .pde sketches in addition to its .ino files, because Arduino's environment is based on the Processing environment.  You can read about other types of files for Arduino and how to correctly name them <a href="http://habrahabr.ru/company/masterkit/blog/257747/">here</a> . <br><br><img src="https://habrastorage.org/files/fa0/04f/390/fa004f390b07458cae6b29efb5a0af17.png"><br><br>  Reassign the used I / O lines, then save the sketch. <br><br>  For TRIGGER_PIN, specify 5, for ECHO_PIN - 6. <br><br>  Why did we do that?  If the pin of the Trigger sensor receives a request from the MC, then let this request be sent to it by the 5th pin of Arduino.  We decided so.  As you remember, we have two free pins now - 5th and 6th, with this we have already figured out above.  Accordingly, Echo sends data from the sensor to Arduino, and let it send them to the sixth pin. <br><br>  <b>Pay attention to the commands used in this sketch:</b> <br><br><img src="https://habrastorage.org/files/706/09a/0af/70609a0af9664026996b8ac2caa911e5.jpg"><br><img src="https://habrastorage.org/files/13b/d81/8d9/13bd818d935e4af298b9f6ecbc01f972.jpg"><br><br>  Notice that each line of the sketch ends with a semicolon.  And also pay attention to the braces - they open and close at the right time.  Also, note that any sketch is divided into two parts: <br><br><blockquote> <b>Void setup () {}</b> <br>  In this part you write what happens once at the beginning of the program.  We have arduino connect to the serial port at the desired speed and write what went to measure. <br>  <b>Void loop () {}</b> <br>  Cycle.  In this part, you write something that will be repeated until you turn off the power of the MK.  In this case - measurement of the distance of the sensor every 50 ms. </blockquote><br><br>  Each part of the program fits between the corresponding {} <br>  What is written after // the program ignores is the comments of the developer of the code to the one who will understand it later, that is, to us.  As you can see, this code was written by a very responsible and accurate developer who commented everything. <br><br>  <b>Step 3:</b> Download our new sketch to Arduino. <br>  If you have never done this before, let me first tell you <a href="http://habrahabr.ru/company/masterkit/blog/257747/">how to do</a> it. <br><br>  <b>Important:</b> before any manipulations with Arduino, remove it from the board and de-energize it. <br><br>  <b>Step 4:</b> Disconnect the Arduino from the USB.  Put it on the board, connect the sensor.  Reconnect the USB to the computer. <br><blockquote>  You will probably have to close and open the IDE again, because  Now the device may not be defined in the Service - Serial port.  Do not worry, this is a bug.  Just disconnect and restart everything. </blockquote><br><br><img src="https://habrastorage.org/files/b4e/f8f/2bf/b4ef8f2bfbbb400ab5f5ffeb03c57110.jpg"><br>  <i>All the same, only now put Arduino on the board, too.</i>  <i>Make sure that you are not confused + and -, otherwise the Earth will fly on the heavenly axis.</i> <br><br>  <b>Important: the</b> author of the article does not bear any responsibility if you burn your Arduino.  Remember, all the manipulations with your MC are done at your own peril and risk. <br><br>  Last time we check that where: <br><img src="https://habrastorage.org/files/75f/7f2/a6a/75f7f2a6acad433d8e9e4de7ab1ad657.jpg"><br><br>  Now you can connect USB. <br><br>  <b>Step 5:</b> Launch the IDE.  Make sure that Arduino "hangs" at its designated port: <br><br>  Service ‚Üí Serial port ‚Üí the port is automatically registered here.  Otherwise, the whole inscription is gray and you need to restart everything. <br><br>  <b>Step 6:</b> Select Tools ‚Üí Port Monitor. <br><br>  Make sure that in the lower right corner is set the speed corresponding to our sketch: 115200 baud. <br>  Select the speed corresponding to the one specified in the program.  If you have already set this speed, then immediately after connecting Arduino with the sensor (after detecting it at one of the ports), the monitor will run to give you the Distance value, every 50 ms: <br><br><img src="https://habrastorage.org/files/cbe/749/c23/cbe749c233534a078d9819b2caa2f6b4.png"><br><br>  When turned on, the sensor lay on the table and looked at the ceiling, to which, as you can see, it was 180 cm. <br><br>  <b>Step 7:</b> Move your hand away from the sensor.  See how his testimony changes.  In my case it was like this: <br><br><img src="https://habrastorage.org/files/b5e/afc/95c/b5eafc95cec8403eb40c5bd55f5d6050.png"><br><br>  Congratulations to all of us: our sensor works!  We just checked it with a test sketch that sends the results to the serial port. <br><br><h2>  Arduino radio on ultrasound control </h2><br>  All we have left now are two things: <br><br>  1. Reassemble all remaining radio components back to shield. <br>  2. Download to Arduino a sketch that combines radio and sensor.  And for this we need to take a standard radio sketch and register something there. <br><br>  But in general, it is already unrealistically cool, because  we have just collected an ultrasonic ruler and now I know very well the distance at home from the table to the wall, window or cabinet and whatnot.  Having played enough, I reassembled the radio with a new sensor and used for this: <br><br>  <a href="">Here are the libraries for the set itself.</a> <br>  <a href="">Sensor library</a> <br>  <a href="">Here is the sketch</a> <br><br>  <b>Change radio station.</b> <br>  To change the radio station, you need to change the distance in increments of 5 cm. <br>  Approaching the sensor - switching the station down the band, <br>  distance from the sensor - switching the station up range. <br>  For the step of changing the distance meets the constant DISTANCE_STEP. <br>  Its value can be changed. <br><br>  <b>Exit station setup mode.</b> <br>  After setting up the station, it is necessary not to change the distance to the sensor for 5 seconds, <br>  tuning is completed with fixing the current station.  During the "commit" is responsible <br>  constant EXIT_TUNE_TIME.  If necessary, its value can be changed. <br><br>  That's all, I congratulate you on the assembly of a new device on the Arduino.  You and I have learned a lot from these two posts: <br>  1. Disassembled the characteristics of the new sensor and collected on it an excellent collection of links. <br>  2. Learned to choose pins on the Arduino and on the expansion card under it. <br>  3. Learned to navigate in charts and datasheets. <br>  4. Learned to test the new sensor before introducing it into the project. <br>  5. Collected and programmed the finished device. <br><br>  And although (I hope) you feel freer with the ‚Äúiron‚Äù, but it is important to note that I remember that so far we have tried to disassemble only one sketch - for testing the sensor.  Therefore, if you need to write or change the sketch for a new device now, you will probably not be ready yet.  Follow the new posts, <a href="http://habrahabr.ru/users/anastasiapmp/">subscribe</a> - I will definitely share with you what I know and can do in my future posts. <br><br>  What would you use the sound range for?  How can I change and add to my project?  Welcome to the comments! <br><br>  // ** PS In the comments I announce a contest for the best explanation of what baud is, why they have different speeds, and why this is important.  There will be no prize, but I will be happy to try to understand exactly your explanation. </div><p>Source: <a href="https://habr.com/ru/post/259491/">https://habr.com/ru/post/259491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259475/index.html">Another language recognizer 4</a></li>
<li><a href="../259477/index.html">That the new versions of the UEFI standards are prepared for us, part two, ACPI 6.0</a></li>
<li><a href="../259479/index.html">Configure OpenSWAN IPsec PSK using NAT Traversal (NAT-T)</a></li>
<li><a href="../259483/index.html">Exploring the format of the level map of the Jackal NES game</a></li>
<li><a href="../259489/index.html">Experiment: Testing Live ReactOS Applications</a></li>
<li><a href="../259493/index.html">Monitoring Server with Wiren Board NetMon-1</a></li>
<li><a href="../259495/index.html">HiDPI in Linux</a></li>
<li><a href="../259497/index.html">Type casting in PHP == stool with two legs?</a></li>
<li><a href="../259501/index.html">As I drove Baldu-2, or in search of the optimal algorithm</a></li>
<li><a href="../259503/index.html">Manipulation of numbers through LDAP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>