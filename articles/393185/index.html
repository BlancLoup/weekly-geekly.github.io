<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New nooLite MR1132 receiver module for Arduino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will discuss a new module of the receiver of the nooLite system for Arduino and microcontrollers. What is remarkable about this mod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New nooLite MR1132 receiver module for Arduino</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/24c/ab6/dab/24cab6dab74e4e778cd238d261be0b69.jpg" alt="image"><br><br>  In this article we will discuss a new module of the receiver of the nooLite system for Arduino and microcontrollers.  What is remarkable about this module?  Until now, there were no ways to receive information from sensors and control the on-air transmission of signals from <a href="http://www.noo.com.by/">nooLite</a> system <a href="http://www.noo.com.by/">consoles</a> on microcontrollers and Arduino, such a possibility existed only for computers, using special USB adapters. <br><br>  Now, with the release of the MR1132 module, it is possible to receive data on temperature, humidity, light and the presence of people in the room from the wireless sensors of the nooLite system in your sketches on Arduino, it is possible to track the commands given by the nooLite power units with remote control switches and much more that was previously unavailable. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article I will tell you about the work of this module and give a working sketch, on the basis of which you can easily create your devices on the MR1132.  In subsequent articles I will talk about the integration of this module with the popular <a href="http://hi-lab.ru/arduino-mega-server/details">Arduino Mega Server system</a> and about the great opportunities that will arise in connection with this integration. <br><a name="habracut"></a><br><h2>  Module </h2><br>  The MR1132 module is very similar to its brother, the MT1132 module (about which there was already a cycle of articles on Hiktatimes <a href="https://geektimes.ru/post/269100/">one</a> , <a href="https://geektimes.ru/post/269366/">two</a> , <a href="https://geektimes.ru/post/269450/">three</a> ).  The difference is that the MT1132 module is a transmitter, and the MR1132 module is a receiver and the greatest effect can be obtained by sharing them. <br><br>  Another important point is that the MT1132 transmitter is versatile and operates on both 3.3 V and 5 V (and therefore also works with 3.3-volt controllers and 5-volt), and the receiver only from 5 V. This should be taken into account when designing your devices and, if necessary, use logical level coordinators. <br><br><img src="https://habrastorage.org/files/36e/50c/816/36e50c816d1b4859b7a56eb2ae4f4996.jpg" alt="image"><br><br>  The connection is as simple as the MT1132 module - the supply voltage, ground and two contacts RX and TX.  RTS can be pulled up to the supply voltage, but everything worked for me without connecting this pin. <br><br><h2>  Job </h2><br>  The module operates on a serial interface at a speed of 9600. The module receives commands from the controller and, in turn, provides data received from the air (from sensors and nooLite consoles). <br><br>  Let's take a closer look at this moment so that you have a clear understanding of how this module works. <br><br>  All commands that the controller can send to the module via the serial interface refer to the ‚Äúbinding‚Äù or ‚Äúdecoupling‚Äù of nooLite devices, from which the module will then receive data.  There are no other control commands for this module.  For example, you tied a nooLite PT112 temperature sensor on the zero channel (total channels 32, which is reflected in the module name) and after that the module will start receiving data from this sensor and output them to the serial interface (where our task is to ‚Äúcatch‚Äù them and use for our goals). <br><br>  If we no longer need to receive data from any sensor, then we can send an unlink command (in this case, on the zero channel) and the receiver will no longer issue information to the controller from this sensor. <br><br>  As for the information received by the module MR1132 from nooLite devices, there is a separate <a href="http://www.noo.com.by/assets/files/PDF/MR1132.pdf">document</a> that describes the format of all possible commands.  We, in the context of this narrative, from all this extensive list will be interested in teams of sensors for temperature, humidity and movement.  Details of these commands will be discussed below, on the example of the sketch. <br><br><h2>  Sensors </h2><br>  Three sensors will be used in our experiments. <br><br><img src="https://habrastorage.org/files/3f9/ca8/0d4/3f9ca80d49e04e228406018485a56439.jpg" alt="image"><br><br>  PT112 temperature sensor and PT111 temperature and humidity sensor.  They look the same and work exactly the same way, the difference is that PT112 provides only information about temperature, and PT111 gives information about temperature and humidity.  These sensors can operate in both a simple sensor mode and in thermostat mode and a hygrostat mode, but we will be interested in the simple sensor mode. <br><br><img src="https://habrastorage.org/files/faa/396/a15/faa396a152b5477b9bdfd91d722c9ca3.jpg" alt="image"><br><br>  The third sensor is PM111.  This is a motion sensor that can directly control the power units of nooLite, but it will interest us only as a source of information about the movement and presence of people in the room. <br><br><h2>  Controller </h2><br><br>  The Arduino Mega 2560 will be used as the controlling controller, and its two serial interfaces will be Serial (for visual information control) Serial2 (for communication with the receiver module).  Serial1 is reserved for the MT1132 transmitter module. <br><br><img src="https://habrastorage.org/files/464/661/a69/464661a69db6436da29c14c265c92996.jpg" alt="image"><br><br><h2>  Sketch </h2><br>  In the setup () section, two interfaces are launched, an informational message about the start of the sketch is displayed, and a command is issued to link the nooLite devices on the zero channel.  This is a test command and you can comment it out or replace it with another command (for example, bindings on another channel or decoupling). <br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>); Serial2.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>); Serial.println(<span class="hljs-string"><span class="hljs-string">"*** Start sketch ***"</span></span>); mrBind(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">//mrUnbind(0); }</span></span></code> </pre> <br>  Before working with the sketch, you need to perform some preliminary actions, namely, to bind your sensors to the module as follows: <br><br>  <strong>PT112</strong> - zero channel <br>  <strong>PT111</strong> - first channel <br>  <strong>PM111</strong> - second channel <br><br>  To do this, you need to run the sketch three times, changing the binding command <br><br><pre> <code class="java hljs">mrBind(<span class="hljs-number"><span class="hljs-number">0</span></span>); mrBind(<span class="hljs-number"><span class="hljs-number">1</span></span>); mrBind(<span class="hljs-number"><span class="hljs-number">2</span></span>);</code> </pre><br>  and each time press the button on the corresponding sensor.  This needs to be done only once, then the binding command can be commented out.  Or, instead, put a decoupling command and untie any of the attached sensors. <br><br>  In the loop () section there is only one function mrCheck (), which is responsible for ‚Äúcatching‚Äù the messages of the MR1132 module from the serial interface Serial2. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mrCheck</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Serial2.available() == <span class="hljs-number"><span class="hljs-number">8</span></span>) { mrBuf[<span class="hljs-number"><span class="hljs-number">0</span></span>] = Serial2.read(); mrBuf[<span class="hljs-number"><span class="hljs-number">1</span></span>] = Serial2.read(); mrBuf[<span class="hljs-number"><span class="hljs-number">2</span></span>] = Serial2.read(); mrBuf[<span class="hljs-number"><span class="hljs-number">3</span></span>] = Serial2.read(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mrBuf[<span class="hljs-number"><span class="hljs-number">0</span></span>] == <span class="hljs-number"><span class="hljs-number">79</span></span> &amp;&amp; mrBuf[<span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-number"><span class="hljs-number">75</span></span> &amp;&amp; mrBuf[<span class="hljs-number"><span class="hljs-number">2</span></span>] == <span class="hljs-number"><span class="hljs-number">13</span></span> &amp;&amp; mrBuf[<span class="hljs-number"><span class="hljs-number">3</span></span>] == <span class="hljs-number"><span class="hljs-number">10</span></span>) { Serial.println(<span class="hljs-string"><span class="hljs-string">"OK"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { mrBuf[<span class="hljs-number"><span class="hljs-number">4</span></span>] = Serial2.read(); mrBuf[<span class="hljs-number"><span class="hljs-number">5</span></span>] = Serial2.read(); mrBuf[<span class="hljs-number"><span class="hljs-number">6</span></span>] = Serial2.read(); mrBuf[<span class="hljs-number"><span class="hljs-number">7</span></span>] = Serial2.read(); mrNewData(); } } }</code> </pre><br>  This function fills the mrBuf [8] array with incoming data from the module or transmits to the Serial the ‚ÄúOK‚Äù message issued by the MR1132 module.  Further, the contents of the mrBuf [8] array are parsed in accordance with the data format of the nooLite system commands, and the corresponding sketch functions are involved in this. <br><br>  The mrNewData () function extracts the main data from the mrBuf array [8] and, depending on the incoming command, provides the necessary information to Serial (channel, command, temperature, humidity, sensor battery status, etc.). <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mrNewData</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mrClearData(); mrPrintHeader(); mrSetBindState(); mrPrintBindState(); mrSetChannel(); mrPrintChannel(); mrSetCommand(); mrSetDatas(); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (mrCommand) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>: Serial.print(<span class="hljs-string"><span class="hljs-string">"PIR command: "</span></span>);Serial.println(<span class="hljs-string"><span class="hljs-string">"OFF"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>: Serial.print(<span class="hljs-string"><span class="hljs-string">"PIR command: "</span></span>); Serial.println(<span class="hljs-string"><span class="hljs-string">"ON"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>: mrSetDeviceType(); mrPrintDeviceType(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mrDeviceType == <span class="hljs-number"><span class="hljs-number">1</span></span>) { mrSetTemperature(); mrPrintTemperature(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (mrDeviceType == <span class="hljs-number"><span class="hljs-number">2</span></span>) { mrSetTemperature(); mrPrintTemperature(); mrSetHumidity(); mrPrintHumidity(); } <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: ; } <span class="hljs-comment"><span class="hljs-comment">// switch mrSetBatteryState(); } // newData()</span></span></code> </pre><br>  Functions containing the word Print in their names are engaged in outputting information to the Serial interface for visual control. <br><br>  The following functions are used to decrypt data located in the mrBuf array [8], in accordance with the data format of the nooLite system commands: <br><br>  <strong>mrSetTogl ()</strong> - the value of the counter of incoming teams <br>  <strong>mrSetBindState ()</strong> - module state (binding / norm) <br>  <strong>mrSetReceiveBit ()</strong> - control bit for receiving a new command <br>  <strong>mrSetChannel ()</strong> - channel number <br>  <strong>mrSetCommand ()</strong> - command <br>  <strong>mrSetFormat ()</strong> - data format <br>  <strong>mrSetDeviceType ()</strong> - sensor type <br>  <strong>mrSetDatas ()</strong> - filling four data bytes <br>  <strong>mrSetTemperature ()</strong> - getting the temperature value <br>  <strong>mrSetHumidity ()</strong> - getting the moisture value <br>  <strong>mrSetBrightness ()</strong> - getting the light value <br>  <strong>mrSetBatteryState ()</strong> - sensor battery status <br><br>  You can see the details of the implementation of these functions in the full sketch code attached below. <br><br>  Here is the full text of the sketch. <br><br><div class="spoiler">  <b class="spoiler_title">Full sketch code</b> <div class="spoiler_text">  // TX2 16 <br>  // RX2 17 <br>  // TX1 18 <br>  // RX1 19 <br><br>  // nooLite MR1132 data <br>  byte mrBuf [8]; <br>  int mrTogl = -1; <br>  int mrBindState = -1; <br>  int mrReceiveBit = -1; <br>  int mrChannel = -1; <br>  int mrCommand = -1; <br>  int mrFormat = -1; <br>  int mrData0 = -1; <br>  int mrData1 = -1; <br>  int mrData2 = -1; <br>  int mrData3 = -1; <br>  int mrDeviceType = -1; <br>  int mrBatteryState = -1; <br>  int mrHumidity = -1; <br>  int mrBrightness = -1; <br>  float mrTemp = -1.0; <br><br>  // nooLite MR1132 bind / unbind <br><br>  void mrSerialChannel (byte ch) { <br>  switch (ch) { <br>  case 0: Serial.println ("0");  break; <br>  case 1: Serial.println ("1");  break; <br>  case 2: Serial.println ("2");  break; <br>  case 3: Serial.println ("3");  break; <br>  case 4: Serial.println ("4");  break; <br>  case 5: Serial.println ("5");  break; <br>  case 6: Serial.println ("6");  break; <br>  case 7: Serial.println ("7");  break; <br>  case 8: Serial.println ("8");  break; <br>  case 9: Serial.println ("9");  break; <br>  case 10: Serial.println ("10");  break; <br>  case 11: Serial.println ("11");  break; <br>  case 12: Serial.println ("12");  break; <br>  case 13: Serial.println ("13");  break; <br>  case 14: Serial.println ("14");  break; <br>  case 15: Serial.println ("15");  break; <br>  case 16: Serial.println ("16");  break; <br>  case 17: Serial.println ("17");  break; <br>  case 18: Serial.println ("18");  break; <br>  case 19: Serial.println ("19");  break; <br>  case 20: Serial.println ("20");  break; <br>  case 21: Serial.println ("21");  break; <br>  case 22: Serial.println ("22");  break; <br>  case 23: Serial.println ("23");  break; <br>  case 24: Serial.println ("24");  break; <br>  case 25: Serial.println ("25");  break; <br>  case 26: Serial.println ("26");  break; <br>  case 27: Serial.println ("27");  break; <br>  case 28: Serial.println ("28");  break; <br>  case 29: Serial.println ("29");  break; <br>  case 30: Serial.println ("30");  break; <br>  case 31: Serial.println ("31");  break; <br>  } // switch <br>  } // mrSerialChannel () <br><br>  void mrSerial2Channel (byte ch) { <br>  switch (ch) { <br>  case 0: Serial2.print (‚Äú00‚Äù);  break; <br>  case 1: Serial2.print ("01");  break; <br>  case 2: Serial2.print ("02");  break; <br>  case 3: Serial2.print ("03");  break; <br>  case 4: Serial2.print ("04");  break; <br>  case 5: Serial2.print ("05");  break; <br>  case 6: Serial2.print (‚Äú06‚Äù);  break; <br>  case 7: Serial2.print (‚Äú07‚Äù);  break; <br>  case 8: Serial2.print ("08");  break; <br>  case 9: Serial2.print (‚Äú09‚Äù);  break; <br>  case 10: Serial2.print ("10");  break; <br>  case 11: Serial2.print ("11");  break; <br>  case 12: Serial2.print ("12");  break; <br>  case 13: Serial2.print ("13");  break; <br>  case 14: Serial2.print ("14");  break; <br>  case 15: Serial2.print ("15");  break; <br>  case 16: Serial2.print ("16");  break; <br>  case 17: Serial2.print ("17");  break; <br>  case 18: Serial2.print ("18");  break; <br>  case 19: Serial2.print ("19");  break; <br>  case 20: Serial2.print ("20");  break; <br>  case 21: Serial2.print ("21");  break; <br>  case 22: Serial2.print ("22");  break; <br>  case 23: Serial2.print ("23");  break; <br>  case 24: Serial2.print ("24");  break; <br>  case 25: Serial2.print ("25");  break; <br>  case 26: Serial2.print ("26");  break; <br>  case 27: Serial2.print ("27");  break; <br>  case 28: Serial2.print ("28");  break; <br>  case 29: Serial2.print ("29");  break; <br>  case 30: Serial2.print ("30");  break; <br>  case 31: Serial2.print ("31");  break; <br>  } // switch <br>  } // mrSerial2Channel () <br><br>  void mrPrintBind (byte ch) { <br>  Serial.print (‚ÄúBind on channel‚Äû); <br>  mrSerialChannel (ch); <br>  } <br><br>  void mrBind (byte ch) { <br>  mrPrintBind (ch); <br>  Serial2.print (‚Äúbind_mode_cell_‚Äù); <br>  mrSerial2Channel (ch); <br>  Serial2.write (3);  // End of Text - B00000011 (BIN) <br>  } <br><br>  void mrPrintUnbind (byte ch) { <br>  Serial.println (‚ÄúUnbind on channel‚Äû); <br>  mrSerialChannel (ch); <br>  } <br><br>  void mrUnbind (byte ch) { <br>  mrPrintUnbind (ch); <br>  Serial2.print (‚Äúclear_one_cell_‚Äù); <br>  mrSerial2Channel (ch); <br>  Serial2.write (3); <br>  } <br><br>  void mrBindStop () { <br>  Serial.println ("Bind mode off"); <br>  Serial2.print ("bind_mode_off"); <br>  Serial2.write (3); <br>  } <br><br>  void mrClearAll () { <br>  Serial.println ("Clear all cell"); <br>  Serial2.print ("clear_all_cell"); <br>  Serial2.write (3); <br>  } <br><br>  // nooLite MR1132 print works <br><br>  void mrPrintHeader () { <br>  Serial.println (); <br>  } <br><br>  void mrPrintDeviceType () { <br>  Serial.print (‚ÄúDevice:‚Äû); <br>  if (mrDeviceType == 1) { <br>  Serial.println (‚ÄúPT112‚Äù); <br>  } <br>  if (mrDeviceType == 2) { <br>  Serial.println ("PT111"); <br>  } <br>  } <br><br>  void mrPrintBindState () { <br>  if (mrBindState == 1) { <br>  Serial.print (‚ÄúBind State:‚Äû); <br>  Serial.println (‚ÄúON‚Äù); <br>  } <br>  } <br><br>  void mrPrintBatteryState () { <br>  if (mrBatteryState == 1) { <br>  Serial.print (‚ÄúBattery State:‚Äû); <br>  Serial.println (‚ÄúLOW!‚Äù); <br>  } <br>  } <br><br>  void mrPrintChannel () { <br>  Serial.print (‚ÄúChannel:‚Äû); <br>  Serial.println (mrChannel); <br>  } <br><br>  void mrPrintTemperature () { <br>  Serial.print (‚ÄúTemp:‚Äû); <br>  Serial.println (mrTemp); <br>  } <br><br>  void mrPrintHumidity () { <br>  Serial.print (‚ÄúHumidity:‚Äû); <br>  Serial.println (mrHumidity); <br>  } <br><br>  // nooLite MR1132 data works <br><br>  void mrClearData () { <br>  mrTogl = -1; <br>  mrBindState = -1; <br>  mrReceiveBit = -1; <br>  mrChannel = -1; <br>  mrCommand = -1; <br>  mrFormat = -1; <br>  mrData0 = -1; <br>  mrData1 = -1; <br>  mrData2 = -1; <br>  mrData3 = -1; <br>  mrDeviceType = -1; <br>  mrBatteryState = -1; <br>  mrHumidity = -1; <br>  mrBrightness = -1; <br>  mrTemp = -1.0; <br>  } <br><br>  void mrSetTogl () { <br>  byte b0 = bitRead (mrBuf [0], 0); <br>  byte b1 = bitRead (mrBuf [0], 1); <br>  byte b2 = bitRead (mrBuf [0], 2); <br>  byte b3 = bitRead (mrBuf [0], 3); <br>  byte b4 = bitRead (mrBuf [0], 4); <br>  byte b5 = bitRead (mrBuf [0], 5); <br>  mrTogl = 32 * b5 + 16 * b4 + 8 * b3 + 4 * b2 + 2 * b1 + b0; <br>  } <br><br>  void mrSetBindState () { <br>  mrBindState = bitRead (mrBuf [0], 6); <br>  } <br><br>  void mrSetReceiveBit () { <br>  mrReceiveBit = bitRead (mrBuf [0], 7); <br>  } <br><br>  void mrSetChannel () { <br>  mrChannel = mrBuf [1]; <br>  } <br><br>  void mrSetCommand () { <br>  mrCommand = mrBuf [2]; <br>  } <br><br>  void mrSetFormat () { <br>  mrFormat = mrBuf [3]; <br>  } <br><br>  void mrSetDeviceType () { <br>  byte tp1 = bitRead (mrBuf [5], 4); <br>  byte tp2 = bitRead (mrBuf [5], 5); <br>  byte tp3 = bitRead (mrBuf [5], 6); <br>  mrDeviceType = 4 * tp3 + 2 * tp2 + tp1; <br>  } <br><br>  void mrSetDatas () { <br>  mrData0 = mrBuf [4]; <br>  mrData1 = mrBuf [5]; <br>  mrData2 = mrBuf [6]; <br>  mrData3 = mrBuf [7]; <br>  } <br><br>  void mrSetTemperature () { <br>  byte t8 = bitRead (mrData1, 0); <br>  byte t9 = bitRead (mrData1, 1); <br>  byte t10 = bitRead (mrData1, 2); <br>  int temp2 = 1024 * t10 + 512 * t9 + 256 * t8; <br><br>  int temp = mrData0 + temp2; <br><br>  byte t11 = bitRead (mrData1, 3); <br>  if (t11 == 1) { <br>  temp = (4096 - temp) * -1; <br>  } <br>  mrTemp = (float) temp / 10.0; <br>  } <br><br>  void mrSetBatteryState () { <br>  mrBatteryState = bitRead (mrBuf [5], 7); <br>  } <br><br>  void mrSetHumidity () { <br>  mrHumidity = mrData2; <br>  } <br><br>  void mrSetBrightness () { <br>  mrBrightness = mrData3; <br>  } <br><br>  void mrNewData () { <br>  mrClearData (); <br>  mrPrintHeader (); <br><br>  mrSetBindState (); <br>  mrPrintBindState (); <br>  mrSetChannel (); <br>  mrPrintChannel (); <br><br>  mrSetCommand (); <br>  mrSetDatas (); <br><br>  switch (mrCommand) { <br>  case 0: <br>  Serial.print (‚ÄúPIR command:‚Äû);  Serial.println (‚ÄúOFF‚Äù); <br>  break; <br>  case 2: <br>  Serial.print (‚ÄúPIR command:‚Äû);  Serial.println (‚ÄúON‚Äù); <br>  break; <br>  case 21: <br>  mrSetDeviceType (); <br>  mrPrintDeviceType (); <br>  if (mrDeviceType == 1) { <br>  mrSetTemperature (); <br>  mrPrintTemperature (); <br>  } <br>  if (mrDeviceType == 2) { <br>  mrSetTemperature (); <br>  mrPrintTemperature (); <br>  mrSetHumidity (); <br>  mrPrintHumidity (); <br>  } <br>  break; <br>  default: <br>  ; <br>  } // switch <br>  mrSetBatteryState (); <br>  } // newData () <br><br>  void mrCheck () { <br>  if (Serial2.available () == 8) { <br>  mrBuf [0] = Serial2.read (); <br>  mrBuf [1] = Serial2.read (); <br>  mrBuf [2] = Serial2.read (); <br>  mrBuf [3] = Serial2.read (); <br>  if (mrBuf [0] == 79 &amp;&amp; mrBuf [1] == 75 &amp;&amp; mrBuf [2] == 13 &amp;&amp; mrBuf [3] == 10) { <br>  Serial.println ("OK"); <br>  } else { <br>  mrBuf [4] = Serial2.read (); <br>  mrBuf [5] = Serial2.read (); <br>  mrBuf [6] = Serial2.read (); <br>  mrBuf [7] = Serial2.read (); <br>  mrNewData (); <br>  } <br>  } <br>  } <br><br>  void setup () { <br>  Serial.begin (9600); <br>  Serial2.begin (9600); <br>  Serial.println ("*** Start sketch ***"); <br>  mrBind (0); <br>  // mrUnbind (0); <br>  } <br><br>  void loop () { <br>  mrCheck (); <br>  } // loop () <br><br></div></div><br><h2>  Conclusion </h2><br>  That's all you need to start working with the MR1132 module and use it in your sketches and projects.  This module can also be used to control the signals from the nooLite wall consoles and your system can now know where and which console worked and what command it sent to power units. <br><br>  A new 0.15 version of the popular <a href="http://hi-lab.ru/arduino-mega-server/details/download">Arduino Mega Server</a> system is coming soon and this version will include built-in support for the MR1132 modules and convenient management of them directly from a web page and much more interesting. </div><p>Source: <a href="https://habr.com/ru/post/393185/">https://habr.com/ru/post/393185/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../393175/index.html">New initiative of Microsoft OpenT2T: "Interface of all"</a></li>
<li><a href="../393177/index.html">Forty two seconds</a></li>
<li><a href="../393179/index.html">Intel Compute Stick got Intel Core processors and Realsense cameras</a></li>
<li><a href="../393181/index.html">Created a radio chip, simultaneously transmitting and receiving with a single antenna</a></li>
<li><a href="../393183/index.html">FBI paid hackers more than $ 1.3 million for hacking iPhone</a></li>
<li><a href="../393189/index.html">Oscar, modular body</a></li>
<li><a href="../393191/index.html">How much are Darth Vader armor</a></li>
<li><a href="../393193/index.html">"The unprecedented attempt on the privacy of citizens"</a></li>
<li><a href="../393195/index.html">MPAA wants ISPs to turn off repeat offenders from the Internet</a></li>
<li><a href="../393197/index.html">Russian hydrogen oktekopter set a world record for flight duration: 3 hours 10 minutes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>