<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Visualization of the neural network learning process using TensorFlowKit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hint  Before reading this article, I advise you to read the previous article about TensorFlowKit and put the star repository . 

 I do not like to rea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Visualization of the neural network learning process using TensorFlowKit</h1><div class="post__text post__text-html js-mediator-article"><div class="spoiler">  <b class="spoiler_title">Hint</b> <div class="spoiler_text">  Before reading this article, I advise you to read <a href="https://habrahabr.ru/post/342132/">the previous article about TensorFlowKit</a> and put the star <a href="https://github.com/Octadero/TensorFlow">repository</a> . <br></div></div><br><div class="spoiler">  <b class="spoiler_title">I do not like to read articles, I immediately go to GitHub</b> <div class="spoiler_text">  <a href="https://github.com/Octadero/TensorFlow">GitHub: TensorFlowKit</a> <br>  <a href="http://github.com/Octadero/Example">GitHub: Example</a> <br>  <a href="https://github.com/Octadero/">GitHub: Other</a> <br>  <a href="http://api.octadero.com/TensorFlowKit/index.html">TensorFlowKit API</a> <br>  <i>After visiting the repository, add it to ‚ÄúStars‚Äù this will help me write more articles on this topic.</i> <br></div></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4bd/003/1d3/4bd0031d34a70973fcb070c1dd975477.gif" alt="image"></div><br>  <i>Starting working in the field of machine learning, it was hard for me to move from objects and their behaviors to vectors and spaces.</i>  <i>At first, all this was rather hard in the head and far from all the processes seemed transparent and understandable at first glance.</i>  <i>For this reason, I tried to visualize everything that was happening inside my work: I built 3D models, graphs, charts, images, and so on.</i> <i><br><br></i>  <i>Speaking about the effective development of machine learning systems, there is always the issue of controlling the speed of learning, analyzing the learning process, collecting various learning metrics, and so on.</i>  <i>The particular difficulty lies in the fact that we (people) are used to operating with 2 and 3 dimensional spaces, describing various processes around us.</i>  <i>Processes inside neural networks occur in multidimensional spaces, which seriously complicates their understanding.</i>  <i>Realizing this, engineers around the world are trying to develop different approaches to visualizing or transforming multidimensional data into simpler and more understandable forms.</i> <i><br><br></i>  <i>There are entire communities that solve such tasks, for example <a href="https://distill.pub/">Distill</a> , <a href="https://www.youtube.com/user/Taylorns34/videos">Welch Labs</a> , <a href="https://www.youtube.com/channel/UCYO_jab_esuFRV4b17AJtAw/videos">3Blue1Brown</a> .</i> <br><a name="habracut"></a><br><h3>  Tensorboard </h3><br>  Before I started working with TensorFlow, I started working with the TensorBoard package.  It turned out that this is a very convenient, cross-platform solution for visualizing various kinds of data.  <a href="https://www.octadero.com/2017/03/15/using-tensorboard-as-data-representation-in-neural-networks-written-on-swift/">It took a couple of days to ‚Äúteach‚Äù the swift application to create reports in the TensorBoard format and integrate it into my neural network</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Development TensorBoard began in mid-2015 in one of the laboratories Google.  At the end of 2015, Google opened the source code and the work on the project became public. <br>  The current version of TensorBoard is a python package created to help TensorFlow, which allows you to visualize several data types: <br><br><ul><li>  Scalar data in terms of time, with the possibility of smoothing; </li><li>  Images, in the event that your data can be presented in 2D, for example: convolutional network weights (they are filters); </li><li>  Directly graph calculations (in the form of an interactive presentation); </li><li>  2D change of the tensor value in time; </li><li>  <a href="https://www.tensorflow.org/get_started/tensorboard_histograms">3D Histogram</a> - change in the distribution of data in the tensor in time; </li><li>  Text; </li><li>  Audio; </li></ul><br>  In addition, there is also a <a href="http://projector.tensorflow.org/">projector (projector)</a> and the <a href="">ability to extend TensorBoard with the help of plug-ins</a> , but I will not have time to tell about this in this article. <br><br>  To work we need TensorBoard on our computer (Ubuntu or Mac).  We need to have python3 installed.  I suggest installing TensorBoard as part of the TensorFlow package for python. <br><br><pre><code class="bash hljs">Linux: $ sudo apt-get install python3-pip python3-dev $ pip3 install tensorflow MacOS: $ brew install python3 $ pip3 install tensorflow</code> </pre> <br>  Run TensorBoard, specifying the folder in which we will store the reports: <br><br><pre> <code class="bash hljs">$ tensorboard --logdir=/tmp/example/</code> </pre><br> <code> http://localhost:6006/ <br></code> <br><br><h3>  TensorFlowKit </h3><br>  <a href="https://github.com/Octadero/Example/tree/master/02_MNIST">GitHub example</a> <br>  <i>Do not forget to put the "start" repository.</i> <br><br>  Let us consider several cases directly on an example.  Creation of reports (summary) in the TensorBoard format occurs at the moment of constructing the calculation graph.  In TensorFlowKit, I tried to repeat as much as possible the python approaches and interface, so that in the future you could use the general documentation. <br><br>  As I said above, we collect each report in summary.  This is the container in which the value array is stored, each of which represents an event that we want to visualize. <br><br>  Summary will be saved to a file on the file system, where TensorBoard will read it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a12/da2/473/a12da247321bf8b5d3a9360097a6e771.png" alt="image"><br><br>  Thus, we need to create a FileWriter by specifying the graph that we want to visualize and create a Summary into which we will add our values. <br><br><pre> <code class="hljs lisp">let summary = Summary(<span class="hljs-name"><span class="hljs-name">scope</span></span>: scope) let fileWriter = try FileWriter(<span class="hljs-name"><span class="hljs-name">folder</span></span>: writerURL, identifier: <span class="hljs-string"><span class="hljs-string">"iMac"</span></span>, graph: graph)</code> </pre><br>  By running the application and refreshing the page, we can already see the graph we created in the code.  It will be interactive, so you can navigate through it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1ac/4c9/ed1/1ac4c9ed1c9e3b9deedbc692e6442941.png" alt="image"><br><br>  Next, we want to see a change in a certain scalar value over time, for example, the value of the loss function or cost function and accuracy of our neural network.  To do this, add the outputs of our operations to the summary: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> summary.scalar(output: accuracy, key: <span class="hljs-string"><span class="hljs-string">"scalar-accuracy"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> summary.scalar(output: cross_entropy, key: <span class="hljs-string"><span class="hljs-string">"scalar-loss"</span></span>)</code> </pre><br>  Thus, after each step of computing our session, TensorFlow automatically subtracts the values ‚Äã‚Äãof our operations and passes them to the input of the resulting Summary, which we will save in FileWriter (how to do this, I will describe below). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e9c/06b/5a0/e9c06b5a0ea3653da62364dd166bf6d2.png" alt="image"><br><br>  We also have a greater number of weights and biases in the neural network (bias).  As a rule, these are various matrices of a rather large dimension and it is extremely difficult to analyze their values ‚Äã‚Äãwhen printing.  It will be better if we build a distribution schedule.  We also add to our Summary information about the magnitude of changes in weights that our network makes after each step of training. <br><br><pre> <code class="hljs lua">try summary.histogram(<span class="hljs-built_in"><span class="hljs-built_in">output</span></span>: bias.<span class="hljs-built_in"><span class="hljs-built_in">output</span></span>, key: <span class="hljs-string"><span class="hljs-string">"bias"</span></span>) try summary.histogram(<span class="hljs-built_in"><span class="hljs-built_in">output</span></span>: weights.<span class="hljs-built_in"><span class="hljs-built_in">output</span></span>, key: <span class="hljs-string"><span class="hljs-string">"weights"</span></span>) try summary.histogram(<span class="hljs-built_in"><span class="hljs-built_in">output</span></span>: gradientsOutputs[<span class="hljs-number"><span class="hljs-number">0</span></span>], key: <span class="hljs-string"><span class="hljs-string">"GradientDescentW"</span></span>) try summary.histogram(<span class="hljs-built_in"><span class="hljs-built_in">output</span></span>: gradientsOutputs[<span class="hljs-number"><span class="hljs-number">1</span></span>], key: <span class="hljs-string"><span class="hljs-string">"GradientDescentB"</span></span>)</code> </pre><br>  Now we have at our disposal a visualization of how the weights changed and what the changes were during the training. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d0c/c42/bd0/d0cc42bd0a22b5eac2503d804b1dbe9f.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc2/fae/db5/cc2faedb5b9ee547a1c7938b3c3005ce.png" alt="image"><br><br>  But that is not all.  Let's really take a look at the device of our neural network. <br>  Each picture of the handwritten text received at the entrance is reflected in its corresponding weights.  That is, the picture submitted to the input can activate certain neurons, thereby having a certain imprint inside our network.  Let me remind you that we have 784 weights for each neuron out of 10. Thus, we have 7840 weights.  All of them are presented in the form of a matrix 784x10.  Let's try to expand the entire matrix into a vector and then ‚Äúpull out‚Äù the weights that belong to each individual class: <br><br><pre> <code class="hljs pgsql">let flattenConst = try scope.addConst(<span class="hljs-keyword"><span class="hljs-keyword">values</span></span>: [Int64(<span class="hljs-number"><span class="hljs-number">7840</span></span>)], dimensions: [<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>: "flattenShapeConst") let imagesFlattenTensor = try scope.reshape(operationName: "FlattenReshape", tensor: weights.variable, shape: flattenConst.defaultOutput, tshape: Int64.self) try extractImage(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: imagesFlattenTensor, scope: scope, <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>, atIndex: <span class="hljs-number"><span class="hljs-number">0</span></span>) try extractImage(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: imagesFlattenTensor, scope: scope, <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>, atIndex: <span class="hljs-number"><span class="hljs-number">1</span></span>) ‚Ä¶ try extractImage(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: imagesFlattenTensor, scope: scope, <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>, atIndex: <span class="hljs-number"><span class="hljs-number">8</span></span>) try extractImage(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: imagesFlattenTensor, scope: scope, <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>, atIndex: <span class="hljs-number"><span class="hljs-number">9</span></span>)</code> </pre><br>  To do this, add a few more operations stridedSlice and reshape to the graph.  Now, add each received vector to the Summary as an image: <br><br><pre> <code class="hljs pgsql">try <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>.images(<span class="hljs-type"><span class="hljs-type">name</span></span>: "Image-\(String(index))", output: imagesTensor, maxImages: <span class="hljs-number"><span class="hljs-number">255</span></span>, badColor: <span class="hljs-keyword"><span class="hljs-keyword">Summary</span></span>.BadColor.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>)</code> </pre><br>  In the Images section of TensorBoard, we now see the ‚Äúprints‚Äù of the weights, as they were during the learning process. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/561/5d1/e69/5615d1e69ac754dfa7024a6fd88320b1.png" alt="image"><br><br>  It remains only to process our Summary.  To do this, we need to combine all created Summary into one and process it during network training. <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-number"><span class="hljs-number">_</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> summary.merged(identifier: <span class="hljs-string"><span class="hljs-string">"simple"</span></span>)</code> </pre><br>  At the time of our network: <br><br><pre> <code class="hljs pgsql">let resultOutput = try <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>.run(inputs: [x, y], <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>: [xTensorInput, yTensorInput], outputs: [loss, applyGradW, applyGradB, mergedSummary, accuracy], targetOperations: []) let <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span> = resultOutput[<span class="hljs-number"><span class="hljs-number">3</span></span>] try fileWriter?.addSummary(tensor: <span class="hljs-keyword"><span class="hljs-keyword">summary</span></span>, step: Int64(<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>))</code> </pre><br>  <i>Please note that in this example I do not consider the issue of calculating accuracy, it is calculated on the training data.</i>  <i>Calculate it on the data for learning is wrong.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4bd/003/1d3/4bd0031d34a70973fcb070c1dd975477.gif" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/583/8eb/845/5838eb8458d7d44f192768730fb06060.gif" alt="image"><br><br>  In the next article I will try to tell you how to build one neural network and run it on Ubuntu, MacOS, iOS from one repository. </div><p>Source: <a href="https://habr.com/ru/post/342934/">https://habr.com/ru/post/342934/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342922/index.html">Stupid js. Make filters "beauty"</a></li>
<li><a href="../342924/index.html">Programming under ARM TrustZone. Secure monitor</a></li>
<li><a href="../342928/index.html">Vivaldi 1.13 - everything is at hand</a></li>
<li><a href="../342930/index.html">Wireless Fiber Siklu</a></li>
<li><a href="../342932/index.html">HPE ProLiant for Microsoft Azure Stack: a piece of Azure cloud under your complete control</a></li>
<li><a href="../342936/index.html">App for CarPrice Inspectors</a></li>
<li><a href="../342938/index.html">HolyJS 2017 Moscow program overview: from WebAssembly to Yarn</a></li>
<li><a href="../342942/index.html">Analysis of the tasks of the second stage of the School Programmers HeadHunter 2017</a></li>
<li><a href="../342946/index.html">Versioning and Deploying PostgreSQL Code</a></li>
<li><a href="../342948/index.html">Migration from mainframe: how to convince management?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>