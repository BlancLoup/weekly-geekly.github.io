<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Gigahertz cheaply - Win 2008R2 Core on Amazon</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Being engaged in startups, I finally got to the point where you need to be ready to scale the application to N servers for 1M views per day and I bega...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Gigahertz cheaply - Win 2008R2 Core on Amazon</h1><div class="post__text post__text-html js-mediator-article">  Being engaged in startups, I finally got to the point where you need to be ready to scale the application to N servers for 1M views per day and I began to think how to do this most effectively using Amazon Ec2. <br><br>  The approximate plan is known to everyone - a server is more powerful for the database and a set of small servers that start / stop as needed depending on the load. <br><br>  From inexpensive servers, Amazon has no particular choice.  Initially, I planned to use <b>Small Instance</b> for this - this is the option that amazon recommends by default.  It has 1.7 GB of RAM, which is pretty comfortable for windows, but only 1 ECU.  In practice, 5-8 workflows can be placed in memory, however, they can‚Äôt really work at the same time - the core is one and very weak: 1 ECU is just 1 Ghz of one 2007 Xeon core.  According to my estimates, the approximate equivalent is a Celeron processor at a frequency of 1.5 Ghz.  There is such a server $ 0.12 per hour ~ $ 86 per month, a dozen - $ 860 per month ... It was obvious that this server configuration did not quite answer my tasks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So I decided to try <b>Micro instance</b> - only 613 MB of memory, but then: <br><ul><li>  performance reaches 2 ECU </li><li>  it is <b>4</b> times cheaper </li><li>  can use 64 bit <b>Windows Server 2008 R2 Core</b> platform </li></ul><br><br><a name="habracut"></a>  Probably many will be interested - why did I choose the x64 system for 613 MB of memory?  The arguments are as follows: <br><ul><li>  2008 R2 is a new system, compared to 2008. 2008 is based on Vista, R2 is based on windows 7. </li><li>  Improved IIS performance </li><li>  Improved OS-level virtualization, which we will use </li></ul><br><br>  <a href="http://technet.microsoft.com/en-us/library/cc753802(WS.10).aspx">Server Core</a> is a reduced installation of Windows, without many GUI elements - there is no Internet explorer, usual Explorer and even a taskbar! <br><br>  Let us analyze the steps for setting up such a server: <br><br>  <b>1. Install Windows</b> <br><br>  There is no Core version in the list of systems offered by default.  However, it can be found by searching for the keyword "2008R2": <br><img src="https://habrastorage.org/getpro/habr/post_images/558/1ec/915/5581ec915491003c7cb0a59d0343154f.png" alt="image"><br><br>  Having started Micro instance we can connect to it via RDC, where instead of the usual desktop we are met by a bare command line: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/087/91d/632/08791d632564e34f373b8b551280fb5a.png" width="673" height="415" alt="image"><br><br>  After typing the taskmanager, we see that we have 300 MB of memory occupied, the total amount of virtual memory is approximately 1.4 GB.  The instance has a single disk of 16 GB in size, of which after installation it is free a little more than 11 GB, which is quite enough for our tasks. <br><br>  <b>2. Connecting to other cloud computers</b> <br><br>  Firewall in Ec2 (called Security Groups), as usual, allows specified IPs to open the specified ports.  In order not to add the IP of each server running manually, you can use the following method ‚Äî instead of IP, enter the name of the security group (which is shown on the details tab, and looks something like ‚Äúsg-c45ac45a‚Äù) and allow access on all ports. <br>  When creating a new instance, we specify the same Security group and the new instance automatically has access to any other resources of your cloud.  My security groups look like this (note the first and last lines added for ms sql): <br><img src="https://habrastorage.org/getpro/habr/post_images/bef/f8e/58f/beff8e58f062e770ae7acb02b1a8082a.png" alt="image" width="623" height="255"><br><br>  Accordingly, we successfully execute the following command and connect via internal IP to the main server: <br><br> <code>net use z: \\10.20.30.40\C$ /user:Administrator</code> <br> <br>  <b>3. Installing IIS, .NET</b> <br><br>  The full set of various commands is described in detail by MS on this page - <a href="http://technet.microsoft.com/en-us/library/ee441260(WS.10).aspx">http://technet.microsoft.com/en-us/library/ee441260(WS.10).aspx</a> , however, in order not to type it all every time I did ‚Äúregiis. bat ‚Äùon the main server.  Having launched it on the blade, we perform all the necessary installations (I threw away the FTP server, you can remove a few more functions - experiment): <br><br> <code>start /w pkgmgr /iu:IIS-WebServerRole;IIS-WebServer;IIS-CommonHttpFeatures;IIS-StaticContent;IIS-DefaultDocument;IIS-DirectoryBrowsing;IIS-HttpErrors;IIS-HttpRedirect;IIS-ApplicationDevelopment;IIS-ISAPIExtensions;IIS-ISAPIFilter;IIS-ServerSideIncludes;IIS-HealthAndDiagnostics;IIS-HttpLogging;IIS-LoggingLibraries;IIS-RequestMonitor;IIS-HttpTracing;IIS-CustomLogging;IIS-ODBCLogging;IIS-Security;IIS-BasicAuthentication;IIS-WindowsAuthentication;IIS-DigestAuthentication;IIS-ClientCertificateMappingAuthentication;IIS-IISCertificateMappingAuthentication;IIS-URLAuthorization;IIS-RequestFiltering;IIS-IPSecurity;IIS-Performance;IIS-HttpCompressionStatic;IIS-HttpCompressionDynamic;IIS-WebServerManagementTools;IIS-ManagementScriptingTools;IIS-IIS6ManagementCompatibility;IIS-Metabase;IIS-WMICompatibility;IIS-LegacyScripts;WAS-WindowsActivationService;WAS-ProcessModel <br> <br> Dism /online /enable-feature /featurename:IIS-ManagementService <br> <br> Dism /online /enable-feature /featurename:WAS-NetFxEnvironment /featurename:IIS-ISAPIExtensions /featurename:IIS-ISAPIFilter /featurename:IIS-NetFxExtensibility /featurename:IIS-ASPNET</code> <br> <br>  To allow a remote connection to manage IIS, all that remains is to change the key in the registry (run regedit.exe): <br>  HKEY_LOCAL_MACHINE \ SOFTWARE \ Microsoft \ WebManagement \ Server - the EnableRemoteManagement property is set to 1. <br><br>  and run the remote control service on the blade instance: <br> <code>net start wmsvc</code> <br> <br>  We check the connection to IIS from the main server - Connect to server ..., specify the internal IP, Login / Password and save the connection: <br><img src="https://habrastorage.org/getpro/habr/post_images/3b2/73f/a39/3b273fa39e9840242468bc73b446618c.png" width="194" height="181"><br><br>  It remains to copy the application code, for which I created on the main server copylocal.bat, which copies the latest application sources into a predefined folder using xcopy. <br>  Again, this .bat needs to be run on a blade server. <br><br>  From the main server we configure iis - we check the use of .net in the application pool, the number of processes - I set 3, since the average size of W3WP.exe is about 100 MB, and after that we successfully open our server in the browser on http: // and its public dns. <br><br>  The server is ready to work and connect to loadbalancer. <br><br>  <b>4. Scaling</b> <br><br>  In order not to do these operations N times, we create the AMI of this instance that already includes all installed applications, network connections and the necessary code.  This gives us the opportunity to run exactly the same server with all the necessary software and our code with a few mouse clicks. <br><br>  The distribution of work between servers can be charged to loadbalancer from amazon, the 1st load balancer for 1 year is offered free of charge. <br><br>  Updating the server version looks like this: <br><ul><li>  we lift a new blade with the old code in the manual mode </li><li>  update the code (we have a batch file) </li><li>  we check work on http </li><li>  we do AMI of the new version </li><li>  we multiply the necessary number of servers </li><li>  change used servers in load balancing </li><li>  shut down old servers - Terminate command </li></ul><br>  There is also an option to use autoscaling, but I think to tell about it another time. <br><br>  <b>5. Speed ‚Äã‚Äãtesting</b> <br><br>  Until recently, I was afraid that there would be unjustified brakes on such a small amount of memory, so it was necessary to check the system under at least some load. <br>  For testing, I used <a href="http://www.loadimpact.com/">loadimpact.com</a> and a special controller method that redirect to a random page.  The result was quite decent - <a href="http://loadimpact.com/view-test.php%3Ftestlogid%3D476760">here is the report</a> , especially for the cost of this server at $ 21 / month. <br>  A large response time on 10 and 20 clients is explained by the initialization of the application, the swap of unnecessary parts of the system, since the test was started immediately after configuring. <br><br>  <b>Financial results</b> <br><br>  It is obvious that in the Windows world it is hard to imagine life without a mouse, context menus and GUI to customize anything.  However, this was not so difficult.  The biggest difficulty was to choose the firewall settings (both Amazon and built into windows) and come up with a simple layout that does not require a lot of effort.  I think that with this instruction it is really possible to set up such a server in an hour, and this will give you substantial monthly savings. <br>  My overall impression is that the effectiveness of this configuration in terms of $ 1 is about 3 times higher compared to using the array of small instance.  That is, approximately 6 small instances can be safely replaced by 8 micro instances, which in money terms means $ 173 dollars a month instead of $ 516 - more than 4,000 dollars a year. <br><br>  <b>Useful information</b> <br>  1. Getting started for Core - <a href="http://technet.microsoft.com/en-us/library/ee441260(WS.10).aspx">http://technet.microsoft.com/en-us/library/ee441260(WS.10).aspx</a> . <br>  2. If you closed the console, you can press Ctrl + Alt + End, which is the same as Ctrl + Alt + Del on your computer and run Taskmanager.  The "execute" command again allows you to run cmd. <br>  3. To end the session, use the logoff command. <br>  4. Types of Amazon instances - <a href="http://aws.amazon.com/ec2/instance-types/">http://aws.amazon.com/ec2/instance-types/</a> . <br>  5. Prices for Amazon instances (depending on the data center in which you want to place them) - <a href="http://aws.amazon.com/ec2/pricing/">http://aws.amazon.com/ec2/pricing/</a> . <br><br>  Update (07/26/2011): Stress testing such a server - <a href="http://loadimpact.com/result/ec2-50-19-133-136.compute-1.amazonaws.com/en/random-9ec1ada5c887d3d3c8607ecb740547a2">http://loadimpact.com/result/ec2-50-19-133-136.compute-1.amazonaws.com/en/random-9ec1ada5c887d3d3c8607ecb740547a2</a> </div><p>Source: <a href="https://habr.com/ru/post/120474/">https://habr.com/ru/post/120474/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../120465/index.html">Four new tablets, laptops and the first smartphone on WP Mango 7.1</a></li>
<li><a href="../120466/index.html">More grabbers. Good and different</a></li>
<li><a href="../120468/index.html">From June 1, the first channel switches to the 16: 9 broadcast format.</a></li>
<li><a href="../120471/index.html">On the issue of cache invalidation</a></li>
<li><a href="../120473/index.html">Image recovery using neural networks</a></li>
<li><a href="../120475/index.html">Using PowerShell to Administer Microsoft SQL Server</a></li>
<li><a href="../120476/index.html">Dropbox - we get 9GB in one hour</a></li>
<li><a href="../120479/index.html">Creating Qt + PySide Hybrid Applications</a></li>
<li><a href="../120480/index.html">Road to light</a></li>
<li><a href="../120481/index.html">Your life in the form of a personal exhibition</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>