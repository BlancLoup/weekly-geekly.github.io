<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Atlassian Plugins: Diving into Active Objects and Plugin Settings</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I work in Mail.Ru Group in the plug-in development department of JIRA. Plugins allow you to extend or change the functionality of the applic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Atlassian Plugins: Diving into Active Objects and Plugin Settings</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  I work in Mail.Ru Group in the plug-in development department of JIRA.  Plugins allow you to extend or change the functionality of the application.  For example, with their help, you can create new types of fields, gadgets, JQL-queries, panels with various information, charts and <a href="https://marketplace.atlassian.com/plugins/app/jira/highest-rated%3Fcost%3Dfree">much more</a> . <br><br>  Most of our plugins require the storage of additional data that they use.  In this article I want to tell how we solve this problem.  There are two main ways to store such data: Active Objects and Plugin Settings.  Consider them in more detail and understand in what case it is better and more convenient to use one, and in which - the other. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fde/c60/8fb/fdec608fb2eb921895ee0d95e5eed0bf.jpg" alt="image"><br><a name="habracut"></a><br><h1>  1. Active Objects </h1><br>  Active Objects is a library that is based on ORM technology (Object Relational Mapping).  It links databases with concepts of object-oriented programming, creating a so-called virtual object database. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Active Objects are used to work with data groups of the same type.  For example, it can be lists of equipment, warehouses, contractors.  Such information can be synchronized with other services or entered manually.  Active Objects are also suitable for storing project settings, fields, and many others. <br><br><h2>  Creating objects </h2><br>  To create an Active Objects entity, use an interface inherited from net.java.ao.Entity: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> price)</span></span></span></span>; }</code> </pre> <br>  Receiving and recording data takes place with the help of paired get and set methods.  Each pair refers to one field in the database table where information will be stored. <br><br>  To use Active Objects you need to connect the library in the pom-file. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>com.atlassian.activeobjects<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>activeobjects-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.23.7<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span>provided<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">scope</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The ActiveObjects component and all created entities are imported into the plugin structure file (atlassian-plugin.xml). <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">component-import</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ao"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">interface</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.atlassian.activeobjects.external.ActiveObjects"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ao</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ao-entities"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">entity</span></span></span><span class="hljs-tag">&gt;</span></span>com.jira.plugins.shop.model.Product<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">entity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">entity</span></span></span><span class="hljs-tag">&gt;</span></span>com.jira.plugins.shop.model.Shop<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">entity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ao</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><h2>  Work with Active Objects </h2><br>  To work with instances of Active Objects, it is convenient to use a separate class manager.  It aggregates the functions that allow you to create, modify and retrieve such objects.  After creating this class, connect it as a component in the atlassian-plugin.xml file: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">component</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"product-manager"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.jira.plugins.shop.ProductManager"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  All operations on objects are carried out in separate transactions.  For example, to get a store by its ID, you can write the following method: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ActiveObjects ao; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ao.executeInTransaction(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TransactionCallback&lt;Shop&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInTransaction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ao.get(Product.class, id); } }); }</code> </pre><br>  Often it is required to receive various data samples.  Using the <code>net.java.ao.Query</code> class, <code>net.java.ao.Query</code> can create any SQL queries.  However, it is undesirable to do this, because we will be tied to the names of the fields from the database. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Product[] getProducts(<span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String name) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ao.executeInTransaction(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TransactionCallback&lt;Product[]&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Product[] doInTransaction() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ao.find(Product.class, Query.select().where(<span class="hljs-string"><span class="hljs-string">"NAME = ?"</span></span>, name).order(<span class="hljs-string"><span class="hljs-string">"NAME"</span></span>)); } }); }</code> </pre><br>  An instance of Active Objects is created using the <code>ao.create</code> function.  Then, if necessary, fill its fields.  Important note: the object must be saved after editing, otherwise all changes will be lost. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> price)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ao.executeInTransaction(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TransactionCallback&lt;Product&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInTransaction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Product product = ao.create(Product.class); product.setName(name); product.setPrice(price); product.save(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> product; } }); }</code> </pre><br>  When changing, you must first get the object from the database, and then change its content. <br><br>  Deletion occurs with <code>ao.delete</code> , to which the instance itself is passed. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id)</span></span></span><span class="hljs-function"> </span></span>{ ao.executeInTransaction(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TransactionCallback&lt;Void&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Void </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doInTransaction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Product product = ao.get(Product.class, id); ao.delete(product); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } }); }</code> </pre><br>  In some cases, it is better not to delete the object permanently, but simply mark it as deleted, for example, with the <code>deleted</code> field. <br><br><h2>  Connections between objects </h2><br>  Active Objects can be linked together.  There are three types of links.  We will tell more about each of them. <br><br><h3>  One to one relationship </h3><br>  For example, a store can have only one address and, accordingly, one store from the network can be at one address. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shop</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@OneToOne</span></span> <span class="hljs-function"><span class="hljs-function">Address </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Shop </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getShop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setShop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Shop shop)</span></span></span></span>; }</code> </pre><br>  In order to link objects, you must call <code>setShop(Shop shop)</code> . <br><br><h3>  One to many relationship </h3><br>  For example, a store may have several sellers, but the seller only works in one store. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shop</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@OneToMany</span></span> Seller[] getSellers(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Seller</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Shop </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getShop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setShop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Shop shop)</span></span></span></span>; }</code> </pre><br><h3>  Many to many relationship </h3><br>  For example, a product may be in different stores of a chain and there may be many products in a store.  Accordingly, this relationship will be applied in the <code>Product</code> and <code>Shop</code> classes.  It is obligatory to create a third entity that will link the other two (as an additional table in relational databases). <br><br>  The annotation is set only for get-methods. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Shop</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ManyToMany</span></span>(value = ProductToShop.class) Product[] getProducts(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@ManyToMany</span></span>(value = ProductToShop.class) Shop[] getShops(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProductToShop</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Product </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setProduct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Product product)</span></span></span></span>; <span class="hljs-function"><span class="hljs-function">Shop </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getShop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setShop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Shop shop)</span></span></span></span>; }</code> </pre><br><h2>  Data storage </h2><br>  Active Objects are stored in a separate database table.  By default, the table name is formed from three parts.  The first consists of the prefix AO (Active Objects).  The second is the six characters of the hexadecimal value of the MD5 hash of the plug-in key or, if present, the Active Objects module <code>namespace</code> attribute.  The last part is the name of the Active Objects entity.  An example of a standard name looks like this: <code>AO_28BE2D_MY_OBJECT</code> . <br><br>  The names of the table columns are determined by the methods of inserting and receiving values ‚Äã‚Äãfrom the database.  Titles containing uppercase letters will be separated by an underscore.  For example, if the method was called <code>getProductId()</code> , then the column would be called <code>PRODUCT_ID</code> . <br><br>  Active Objects work with the following data types: <br><br><ul><li>  text ( <code>TEXT</code> , <code>VARCHAR</code> ); </li><li>  numbers ( <code>INTEGER</code> , <code>BIGINT</code> , <code>DOUBLE</code> ); </li><li>  date and time ( <code>DATETIME</code> ); </li><li>  boolean type (boolean). </li></ul><br><h3>  Rename tables and columns </h3><br>  Renaming is used in refactoring code and in long field names, since there is a limit on the length of a name in databases. <br><br>  To change the standard table name, you must use the <code>@Table("NewName")</code> annotation. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Table</span></span>(<span class="hljs-string"><span class="hljs-string">"Item"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> price)</span></span></span></span>; }</code> </pre><br>  When renaming fields, you must apply the annotations <code>@Mutator("NewName")</code> and <code>@Accessor("NewName")</code> .  In this case, the names of the columns in the table itself will not be changed.  The <code>@Accessor</code> annotation <code>@Accessor</code> specified for the function that returns a value, and <code>@Mutator</code> is <code>@Mutator</code> for the function that changes it. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Product</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Accessor</span></span>(<span class="hljs-string"><span class="hljs-string">"Cost"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@Mutator</span></span>(<span class="hljs-string"><span class="hljs-string">"Cost"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> price)</span></span></span></span>; }</code> </pre><br><h2>  Underwater rocks </h2><br>  Currently Active Objects do not work with the <code>BLOB</code> data type.  In this case, the information can be stored in the file system directly. <br><br>  There is also a problem when working with links.  Let's explain it with an example.  We have two entities: address and store.  One to one connection is established between them.  Let the name of the city be changed.  If you request the store object from the address, and the address object from it, the city value will return in the old version.  The fact is that the fields are not initialized when the object is changed.  In this case, if the object has references to other objects, it is necessary to initialize it again after changing it. <br><br>  In the creation and search operations in the database, the case of letters in the column name can be set.  Also, the length cannot exceed 30 characters and the reserved words cannot be used: <code>BLOB</code> , <code>CLOB</code> , <code>NUMBER</code> , <code>ROWID</code> , <code>TIMESTAMP</code> , <code>VARCHAR2</code> . <br><br>  If an object requires a long text field, then the <code>@StringLength(StringLength.UNLIMITED)</code> annotation is placed in front of it.  Since, for example, in MySQL a regular String will be 255 characters long. <br><br><h1>  2. Plugin Settings </h1><br>  Plugin Settings are part of the Shared Access Layer in the Atlassian framework.  They provide data storage in the form of a key-value pair, which the plugin will refer to during operation. <br><br>  There are situations when it is necessary to store general settings for the plugin.  At the same time, it is impractical to create a separate table for one record.  In such cases, it is convenient to use Plugin Settings. <br><br><h2>  Creating settings and using them </h2><br>  To create a Plugin Settings object, use the <code>PluginSettingsFactory</code> interface.  It allows you to create settings in the form of a key value.  Important: the key must be unique, so you can take the full name of your plug-in for it.  An example of working with Plugin Settings is as follows: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PluginData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDistributingFacilitiesName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setDistributingFacilitiesName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String distributingFacilitiesName)</span></span></span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PluginDataImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PluginData</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String PLUGIN_PREFIX = <span class="hljs-string"><span class="hljs-string">"com.jira.plugins.shop:"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String DISTRIBUTING_FACILITIES_NAME = PLUGIN_PREFIX + <span class="hljs-string"><span class="hljs-string">"distributingFacilitiesName"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> PluginSettingsFactory pluginSettingsFactory; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PluginDataImpl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PluginSettingsFactory pluginSettingsFactory)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.pluginSettingsFactory = pluginSettingsFactory; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDistributingFacilities</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (String) pluginSettingsFactory.createGlobalSettings().get(DISTRIBUTING_FACILITIES_NAME); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDistributingFacilities</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String distributingFacilitiesName)</span></span></span><span class="hljs-function"> </span></span>{ pluginSettingsFactory.createGlobalSettings().put(DISTRIBUTING_FACILITIES_NAME, distributingFacilitiesName); } }</code> </pre><br>  You can create both global settings and local ones for the project: <br><br><ul><li>  pluginSettingsFactory.createGlobalSettings () - global; </li><li>  pluginSettingsFactory.createSettingsForKey (projectKey) is local, where projectKey is the project key. </li></ul><br><h2>  Data storage </h2><br>  Information is stored in tables in a database.  The <code>propertyentry</code> table records the name, key, and value type of the Plugin Settings.  The value of the property is written to the table corresponding to its type, for example <code>propertystring</code> .  Data Types Supported by Plugin Settings: <br><br><ul><li>  text ( <code>TEXT</code> , <code>LONGTEXT</code> ); </li><li>  numbers ( <code>DECIMAL(18,6)</code> , <code>DECIMAL(18,0)</code> ); </li><li>  date and time ( <code>DATETIME</code> ); </li><li>  big data ( <code>BLOB</code> ). </li></ul><br><h2>  Underwater rocks </h2><br>  To use Plugin Settings in different classes, you must create an object for each operation.  The fact is that when creating an object, it will be initialized once.  If it is changed elsewhere, then in the current class these changes will not be displayed. <br><br>  A bad style is to store big data, such as a list of values, in one property of an object.  To access one item from this list, you need to initialize it entirely.  For the same type of settings, you will have to create keys of the form <code>COLOR_1</code> , <code>COLOR_2</code> , etc. You can easily get confused in them, forgetting what they refer to. <br><br>  It is worth noting that when storing users, you need to write down their key (key), and not the name (name), since the name can be changed, and the key always remains the same and unique. <br><br><h1>  Conclusion </h1><br>  We considered two ways to store data in plugins.  Plugin Settings are suitable for single configurations.  Their key-value structure allows you to quickly obtain the necessary settings.  Using Plugin Settings, you can create both local and global configurations. <br><br>  For large data sets of the same type, such as lists of equipment, contractors, etc., it is better to use Active Objects. <br>  According to Atlassian, they are a simple, fast and scalable way to store and access information.  Data is stored in a separate table in the database.  Objects can be linked to each other. <br><br>  Sources used: <br><br><ol><li>  <a href="https://developer.atlassian.com/docs/atlassian-platform-common-components/active-objects">Atlassian Active Objects Documentation</a> </li><li>  <a href="http://www.slideshare.net/sleberrigaud/all-your-data-belong-to-us-the-active-objects-plugin">Introducing Active Objects Plugin</a> </li><li>  <a href="https://developer.atlassian.com/docs/common-coding-tasks/storing-plugin-settings">Atlassian Plugin Settings Documentation</a> </li><li>  <a href="http://jiradev.blogspot.ru/2010/09/storing-data-in-jira-properties-tables.html">How and where to store Plugin Settings</a> </li></ol><br>  PS We have a professional community in social networks, where we discuss the use of Atlassian products, share experiences and even arrange live events.  Write your plugins and share the results!  Join us: <br><br><ul><li>  <a href="">In contact with</a> </li><li>  <a href="">Facebook</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/273179/">https://habr.com/ru/post/273179/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273169/index.html">Pebble: Timeline - Inside View</a></li>
<li><a href="../273171/index.html">Results of 2015: web development</a></li>
<li><a href="../273173/index.html">Server "second-hand" as an anti-crisis solution</a></li>
<li><a href="../273175/index.html">Usability of trading terminals: UX-trends of mobile and desktop applications for trading on the stock exchange</a></li>
<li><a href="../273177/index.html">How to work with timestamps in PostgreSQL?</a></li>
<li><a href="../273181/index.html">Lan Lite and Lan Base Differences for Cisco 2960 Switches</a></li>
<li><a href="../273183/index.html">Intel¬Æ Tamper Protection Toolkit - Obfuscating compiler and code integrity checking tools</a></li>
<li><a href="../273185/index.html">A bit about Facebook data center</a></li>
<li><a href="../273189/index.html">XML, XQuery and Triple Grief with Performance</a></li>
<li><a href="../273191/index.html">Test the theory of six handshakes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>