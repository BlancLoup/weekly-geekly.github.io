<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>fx - jq alternative for command line JSON processing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="jq is the most popular command line processing JSON utility, written in C and has its own syntax for working with JSON. 


 However, processing JSON o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>fx - jq alternative for command line JSON processing</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/mx/hn/vx/mxhnvxbqzs2pwh58td8ea1sauhe.png"></p><br><p>  <a href="https://stedolan.github.io/jq/">jq</a> is the most popular command line processing JSON utility, written in C and has its own syntax for working with JSON. </p><br><p>  However, processing JSON on the command line is not necessary very often, and when the need arises, you have to suffer with an unfamiliar programming language. </p><br><p>  So the idea to write <a href="https://github.com/antonmedv/fx">fx</a> with a simple and clear syntax that you will never forget.  And what programming language do everyone know?  That's right - javascript. </p><a name="habracut"></a><br><p>  fx takes as its argument a javascript code containing an anonymous function, and calls it, substituting as an argument the JSON obtained from stdin.  What the function returns will be output to stdout.  Everything.  No more complicated and incomprehensible designs. </p><br><p>  Compare two solutions of the same problem on jq and on fx: </p><br><pre><code class="bash hljs">jq <span class="hljs-string"><span class="hljs-string">'[.order[] as $x | .data[$x]]'</span></span></code> </pre> <br><pre> <code class="bash hljs">fx <span class="hljs-string"><span class="hljs-string">'input =&gt; input.order.map(x =&gt; obj.data[x])'</span></span></code> </pre> <br><p>  A little more verbose?  Yes, it's just plain javascript. </p><br><p>  If fx doesn't pass arguments at all, then JSON will be formatted and output: </p><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'{"key":"value"}'</span></span> | fx { <span class="hljs-string"><span class="hljs-string">"key"</span></span>: <span class="hljs-string"><span class="hljs-string">"value"</span></span> }</code> </pre> <br><p>  If the code does not contain <code>param =&gt;</code> , then the transferred code will be automatically converted to an anonymous function and <code>this</code> will contain the transferred JSON object: </p><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'{"foo": [{"bar": "value"}]}'</span></span> | fx <span class="hljs-string"><span class="hljs-string">'this.foo[0].bar'</span></span> <span class="hljs-string"><span class="hljs-string">"value"</span></span></code> </pre> <br><p>  fx, you can pass several arguments / anonymous functions, they will be applied alternately to JSON: </p><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'{"foo": [{"bar": "value"}]}'</span></span> | fx <span class="hljs-string"><span class="hljs-string">'x =&gt; x.foo'</span></span> <span class="hljs-string"><span class="hljs-string">'this[0]'</span></span> <span class="hljs-string"><span class="hljs-string">'this.bar'</span></span> <span class="hljs-string"><span class="hljs-string">"value"</span></span></code> </pre> <br><p>  If the code contains the <code>yield</code> keyword, the anonymous function created will contain a ‚Äúunwrapped‚Äù generator (example from a <a href="https://github.com/sebmarkbage/ecmascript-generator-expression">generator-expression</a> ): </p><br><pre> <code class="bash hljs">$ cat data.json | fx <span class="hljs-string"><span class="hljs-string">'\ for (let user of this) \ if (user.login.startsWith("a")) \ yield user'</span></span></code> </pre> <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'["a", "b"]'</span></span> | fx <span class="hljs-string"><span class="hljs-string">'yield* this'</span></span> [ <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-string"><span class="hljs-string">"b"</span></span> ]</code> </pre> <br><p>  This allows you to describe very simple samples in complex queries. </p><br><p>  By the way, modifying JSON with fx is also very simple: </p><br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'{"count": 0}'</span></span> | fx <span class="hljs-string"><span class="hljs-string">'{...this, count: 1}'</span></span> { <span class="hljs-string"><span class="hljs-string">"count"</span></span>: 1 }</code> </pre> <br><p>  You can also use any npm package if you put it globally: </p><br><pre> <code class="bash hljs">$ npm install -g lodash $ cat package.json | fx <span class="hljs-string"><span class="hljs-string">'require("lodash").keys(this.dependencies)'</span></span></code> </pre> <br><p>  For some, it is important that jq is just one binary (~ 2mb).  So fx also has <a href="https://github.com/antonmedv/fx/releases">separate binaries</a> . </p><br><p>  They weigh a little more (~ 30mb), but if this is not critical for you, and it costs nodejs, you can install fx using npm: </p><br><pre> <code class="bash hljs">npm install -g fx</code> </pre> <br><p>  And what about performance?  Let's measure with <a href="https://github.com/sharkdp/hyperfine">hyperfine</a> : </p><br><pre> <code class="bash hljs">$ curl <span class="hljs-string"><span class="hljs-string">'https://api.github.com/repos/stedolan/jq/commits'</span></span> &gt; data.json $ hyperfine --warmup 3 <span class="hljs-string"><span class="hljs-string">"jq ..."</span></span> <span class="hljs-string"><span class="hljs-string">"fx ..."</span></span> Benchmark <span class="hljs-comment"><span class="hljs-comment">#1: cat data.json | jq '[.[] | {message: .commit.message, name: .commit.committer.name}]' Time (mean ¬± œÉ): 10.7 ms ¬± 0.9 ms [User: 8.7 ms, System: 3.6 ms] Range (min ‚Ä¶ max): 9.0 ms ‚Ä¶ 14.9 ms Benchmark #2: cat data.json | fx 'this.map(({commit}) =&gt; ({message: commit.message, name: commit.committer.name}))' Time (mean ¬± œÉ): 159.6 ms ¬± 4.4 ms [User: 127.4 ms, System: 28.4 ms] Range (min ‚Ä¶ max): 153.0 ms ‚Ä¶ 170.0 ms</span></span></code> </pre><br><p>  An order of magnitude less.  And the thing is that fx uses <code>eval</code> to run the code from the arguments (and in general all the code fx &lt;70 lines of code).  If processing speed is important to you, do not use fx.  In all other cases - fx is an excellent choice. </p><br><ul><li>  <a href="https://github.com/antonmedv/fx">fx</a> </li><li>  <a href="https://github.com/stedolan/jq">jq</a> </li></ul><br><p>  I hope this utility is useful to someone.  Thanks for attention. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/347808/">https://habr.com/ru/post/347808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347798/index.html">Lectures Technopolis. Design of high-load systems (fall 2017)</a></li>
<li><a href="../347800/index.html">VoiceAttack Security Study</a></li>
<li><a href="../347802/index.html">I hated javascript. And now I like him</a></li>
<li><a href="../347804/index.html">WebAssembly and DOM manipulations</a></li>
<li><a href="../347806/index.html">20+ resources to start freelancing</a></li>
<li><a href="../347810/index.html">Learning to reliably manage Kubernetes</a></li>
<li><a href="../347812/index.html">For your attention - Webpack 4</a></li>
<li><a href="../347816/index.html">Learning the Spring Framework is 100% through practice. Active Tutorials and KML Markup Language. Project KciTasks (beta)</a></li>
<li><a href="../347820/index.html">Direct SQL in EntityFramework. Now with strong typing</a></li>
<li><a href="../347822/index.html">Phone Keyboard vs. Keyword Algorithms vs. Protection of personal information</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>