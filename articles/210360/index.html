<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Visualization with RGB strip</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, dear friends, I'll start a little from afar. I decided to order a cheap STMF4-DISCOVERY debugging handkerchief from eBay from America, I waited a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Visualization with RGB strip</h1><div class="post__text post__text-html js-mediator-article">  So, dear friends, I'll start a little from afar.  I decided to order a cheap STMF4-DISCOVERY debugging handkerchief from eBay from America, I waited a long time, I wanted to play around with the F4 series controller, but a month later at the post office I was bummed.  Natural crap came instead of delicious shawls - RGB strip based on the WS2801 controller.  The strip is waterproof with connectors and addressable LEDs separately, but first things first! <br><br>  The first thing you need to try it in!  Let's get started! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/110/01c/771/11001c771759437f94fd484267c02c2f.jpg" width="400" height="400" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/2de/d17/8b8/2ded178b8d625502d46cbcc2456a425f.jpg" width="400" height="400" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  What kind of applications can you find this bad thing?  Not many looking online, the following uses of the band were identified: <br><ul><li>  Incomprehensible thing for pampering and bullying colleagues </li><li>  Decorative lighting (car, window, cottage, etc.) </li><li>  Visual display of a parameter (sound, voltage, frequency, load, etc.) </li></ul><br>  Thus, for our simple test project, we will choose an option that will work perfectly on the table and spend not much time and money on solving the problem. <br><br>  <b>So, the goal will be: the</b> creation of an informer band showing the processor load or any other value. <br><br>  To solve the problem we need: <br><ul><li>  Arduino nano </li><li>  Bread board </li><li>  Several conductors </li><li>  Insulating tape </li><li>  Mini usb cable </li></ul><br><h4>  Stage 1. Hardware </h4><br>  As a controller, I found in my desk Arduino Nano, which had not been used for a long time to use for something valuable.  In addition to the scarves, there was also a layout with stuck conductors, which means you can create. <br><br>  Judging by the description of the seller cents, it is built on the controllers WS2801, controlled by SPI or I2C, the choice of the developer.  An interesting feature of this tape are RGB diodes and separately controlled IC drivers.  They are controlled by a sequence of shipments, by the number of strip segments.  The timing chart is attached below: <br><img src="https://habrastorage.org/getpro/habr/post_images/cfe/ac6/e68/cfeac6e68a3e4ea0a13c693a32796085.jpg" alt="image"><br><br>  As can be seen from the figure, one chip expects three bytes of brightness for each channel.  If the data is transmitted without pauses, then after the capture of the package, each microcircuit begins to output a sequence for the next receiver. <br><br>  The pinout is written on the tape itself and in the description, so there‚Äôs nothing complicated about it: <br><ul><li>  Red 5V DC </li><li>  Green Clock </li><li>  Yellow Data </li><li>  Brown Ground </li></ul><br>  We connect our ribbon directly to the controller on the breadboard, as shown in the figure: <br><img src="https://habrastorage.org/getpro/habr/post_images/ba5/55f/650/ba555f6505c20312f933f6e5cbe3afd6.jpg" width="600" height="400" alt="image"><br><br>  As a final touch, we fix tape ends with tape to make a ring. <br><br><h4>  Stage 2. Programming hardware and software </h4><br>  It‚Äôs not difficult to write our own implementation of the control protocol for the band, but since we didn‚Äôt have much time to spend, we <a href="http://fastled.io/">‚Äôll</a> turn to the ready-made <a href="http://fastled.io/">FastLED</a> control strip <a href="http://fastled.io/">library</a> that is ported to many controllers and supports various LED drivers in the strips. <br><br>  The hardware must meet the following requirements: <br><ol><li>  The main loop of the program should not be blocked </li><li>  The control protocol should be simple and clear. </li><li>  The device operates in SLAVE mode </li></ol><br><br>  The first requirement is very important, because beautiful effects should not block the program, i.e.  immediately after receiving the data from the port, the command must be processed and the behavior must change.  Thus, the use of the delay function for a specified time is excluded; it will only be used to set a delay of 1 ms after the entire tape has been filled. <br><br>  The tape control protocol includes the following commands: <br><table><tbody><tr><td>  SET MODE% d \ n </td><td>  Set the operation mode </td></tr><tr><td>  SET COLOR% d \ n </td><td>  Set Primary Color </td></tr><tr><td>  SET VALUE% d \ n </td><td>  Set a value from 0 to 1000 </td></tr></tbody></table><br><br>  As a response, echo strings of commands starting with the characters " <b>&gt;&gt;</b> " are returned, for example: <br><pre><code class="bash hljs">&gt;&gt; SET VALUE 673</code> </pre> <br><br>  The tape object is configured in the setup function, I will give it below: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Serial.begin(<span class="hljs-number"><span class="hljs-number">115200</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  ,   ,   .,  ,      FastLED.addLeds&lt;WS2801, DATA_PIN, CLOCK_PIN, RGB&gt;(leds, NUM_LEDS); }</span></span></code> </pre><br><br>  For example, here is the implementation of the non-blocking snake rendering function: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">runner</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CRGB color, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> period, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> s)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> pos = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> last = millis(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(millis() - last &gt; period) { <span class="hljs-comment"><span class="hljs-comment">//    last = millis(); clear_led(); if(pos &lt; NUM_LEDS - s) { //  for(uint8_t j = 0; j &lt; s; ++j) { leds[pos + j] = color; } FastLED.show(); ++pos; } else { pos = 0; } } }</span></span></code> </pre><br><br>  Operating modes we implement the following: <br><ul><li>  Running segment with a given offset rate </li><li>  Filling the tape with a specified color for a given length </li><li>  Filling the tape with a color change depending on the value (0 - 300 green, 301 - 660 yellow, 661 - 1000 red) </li><li>  Running segment with a given displacement rate with differently changing colors </li><li>  Filling the tape with a given color for a given length with differently changing colors </li><li>  Color check mode according to FastLED library documentation </li></ul><br>  In order not to suffer for a long time, you can rivet a C # control program that implements the protocol: <br><img src="http://bukin.su/habr/led/screen.png" alt="image"><br><br>  The program implements the above described control protocol and the ability with a specified period to send the value of the processor load and full memory (the current network speed in the plans). <br><br><h4>  Stage 3. Debugging and Testing </h4><br>  So, this whole farm needs to be checked, for which purpose we will use the <a href="http://www.overclockers.ru/softnews/22942/Hot_CPU_Tester_4.3_-_kompleksnyj_test_stabilnosti_sistemy_a_nuzhen_li_on.html">Hot CPU Tester 4.3</a> processor free test utility, the composition of the tests was specially cut, so that the ‚Äúlive‚Äù change in the tape effects could be seen.  The list of tests is shown in the picture: <br><img src="http://bukin.su/habr/led/cputest.png" alt="image"><br><br>  The test results and the functioning of the informer can be viewed on the video: <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/I_KEB4UEH9E%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253,15700256&amp;usg=ALkJrhjD6j7Kva0ShOc644djTb5FAfbTuQ" frameborder="0" allowfullscreen=""></iframe><br><br>  Source: <br>  <a href="">LEDInformer.rar</a> <br><br>  I plan to use this device either in the car, or to decorate the inside of the High Tower of my company, in order to show what is happening to it with beautiful colors! </div><p>Source: <a href="https://habr.com/ru/post/210360/">https://habr.com/ru/post/210360/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../210344/index.html">Input throttling on AngularJS using debounce</a></li>
<li><a href="../210346/index.html">Increase the efficiency of solar panels using a heating element</a></li>
<li><a href="../210348/index.html">Alice's syndrome in the looking glass: what and how to read ?.</a></li>
<li><a href="../210350/index.html">Family photo without a grandmother, or what to do when an ECC crashes?</a></li>
<li><a href="../210358/index.html">A cinema visitor wearing Google Glass was pulled out of the hall by FBI employees.</a></li>
<li><a href="../210362/index.html">The future of e-books</a></li>
<li><a href="../210364/index.html">Dynamic extension of the Linux kernel - add the function "delete to the basket"</a></li>
<li><a href="../210366/index.html">The digest of interesting news and materials from the world of PHP No. 34 (January 13 - 26, 2014)</a></li>
<li><a href="../210368/index.html">How to modify the settings of Bootstrap</a></li>
<li><a href="../210370/index.html">#GeekPicnic: How was the "largest European festival"?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>