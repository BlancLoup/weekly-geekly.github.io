<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Web application on Node and Vue, part 1: project structure, API, authentication</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Before you - the first material from the series devoted to the development of a full-fledged web application called Budget Manager. The main software ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Web application on Node and Vue, part 1: project structure, API, authentication</h1><div class="post__text post__text-html js-mediator-article">  Before you - the first material from the series devoted to the development of a full-fledged web application called Budget Manager.  The main software tools that will be used during the work on it are Node.js for the server, Vue.js for the frontend, and MongoDB as a database. <br><br> <a href="https://habrahabr.ru/company/ruvds/blog/340750/"><img src="https://habrastorage.org/webt/59/ed/d2/59edd235bdb46415116934.jpeg"></a> <br><br>  These materials are intended for readers who are familiar with JavaScript, have a general understanding of Node.js, npm, and MongoDB, and want to learn a bunch of Node-Vue-MongoDB and related technologies.  We will write the application from scratch, so please be your favorite code editor.  In order not to complicate the project, we will not use Vuex and will try to focus on the most important thing, without being distracted by minor things. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The author of this material, a developer from Brazil, says that he is far from a JavaScript guru, but he, in search of new knowledge, is ready to share with others what he has been able to find. <br><a name="habracut"></a><br>  Here we will consider the following questions: <br><br><ul><li>  Organization of the project structure. <br></li><li>  Installation of dependencies and description of used libraries. <br></li><li>  Working with MongoDB and creating Mongoose models. <br></li><li>  Development of application API methods. <br></li><li>  Preparation of routes Express. <br></li><li>  JWT authentication with Passport.js. <br></li><li>  Testing a project using Postman. <br></li></ul><br>  <a href="https://github.com/gdomaradzki/focus-budget-manager">The project code</a> on which we will work can be found on GitHub. <br><br><h2>  <font color="#3AC1EF">Project structure and dependency installation</font> </h2><br>  To begin with, we will create a folder structure for the project, which, at the very beginning of work, should look like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf3/ba7/081/cf3ba70816b467ed881672b086c67911.png"><br>  <i><font color="#999999">API folder structure</font></i> <br><br>  In the course of progress on the material, we will significantly expand this structure. <br><br>  Now you need to install several dependencies.  To do this, go to the root folder of the project (here it is <code>focus-budget-manager</code> ) and, after creating <code>package.json</code> with the <code>npm init</code> command, run the following command: <br><br><pre> <code class="hljs ruby">npm i --save express body-parser mongoose consign cors bcrypt jsonwebtoken morgan passport passport-jwt <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">alias</span></span></span></span></code> </pre> <br>  Consider some of these dependencies and their role in the project: <br><br><ul><li>  Express  This is a framework for Node.js, we will use it to facilitate the development of the API. <br></li><li>  Body Parser.  This package is a means of parsing the request body for Node.js.  It helps to parse the bodies of incoming requests before they get to the handlers, as a result, you can work with them using the <code>req.body</code> property. <br></li><li>  Mongoose.  This is an object modeling tool for MongoDB that is designed to work in an asynchronous environment. <br></li><li>  Consign.  This package is an aid, it is not necessary to use it.  It is intended for organizing autoload scripts. <br></li><li>  CORS.  This package is an aid to Connect / Express that can be used to activate CORS. <br></li><li>  Bcrypt.  With this package, we will generate cryptographic "salt" and hashes. <br></li><li>  Morgan.  This is an auxiliary tool for Node.js, designed to log HTTP requests. <br></li><li>  Module Alias.  This package allows you to create aliases for folders and register your own module paths in Node.js. <br></li></ul><br>  After installing the packages, if you plan to use Git, create a <code>.gitignore</code> file in the project root folder.  Write the following into it: <br><br><pre> <code class="hljs coffeescript"><span class="hljs-regexp"><span class="hljs-regexp">/node_modules/</span></span></code> </pre> <br>  Now, when preliminary preparation is complete, we will be engaged in programming. <br><br><h2>  <font color="#3AC1EF">File BudgetManagerAPI / config / index.js</font> </h2><br>  Create the <code>BudgetManagerAPI/config</code> file in the <code>BudgetManagerAPI/config</code> <code>index.js</code> and enter the following code into it: <br><br><pre> <code class="hljs pgsql">module.exports = { secret: <span class="hljs-string"><span class="hljs-string">'budgetsecret'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>: { <span class="hljs-keyword"><span class="hljs-keyword">session</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> }, <span class="hljs-keyword"><span class="hljs-keyword">database</span></span>: <span class="hljs-string"><span class="hljs-string">'mongodb://127.0.0.1:27017/budgetmanager'</span></span> }</code> </pre> <br>  This file contains the database connection parameters and the secret key that we use to create JWT tokens. <br><br>  Here it is supposed to work with the local MongoDB server.  In this case, in the line <code>127.0.0.1:27017</code> you can use <code>localhost</code> .  If you want, you can work with the MongoDB cloud database created, for example, by means of MLabs. <br><br><h2>  <font color="#3AC1EF">File BudgetManagerAPI / app / models / user.js</font> </h2><br>  Create a <code>User</code> model that will be used for JWT authentication.  To do this, go to the <code>BudgetManagerAPI/app</code> folder and create the <code>models</code> directory in it, and the <code>user.js</code> file in it.  At the beginning of the file connect dependencies: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mongoose = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mongoose'</span></span>),     bcrypt = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'bcrypt'</span></span>);</code> </pre> <br>  The <code>mongoose</code> package is needed here to create a <code>User</code> model, the <code>bcrypt</code> package tools will be used to hash user passwords. <br><br>  After that, in the same file, add the following: <br><br><pre> <code class="hljs pgsql">const Schema = mongoose.<span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>({ username: {   <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: String,   <span class="hljs-keyword"><span class="hljs-keyword">unique</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>,   required: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }, <span class="hljs-keyword"><span class="hljs-keyword">password</span></span>: {   <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: String,   required: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }, clients: [{}] });</code> </pre> <br>  This code is intended to create a <code>User</code> data schema.  Thanks to this description, the following data will be assigned to the user of our system: <br><br><ul><li>  Username. <br></li><li>  Password ( <code>password</code> ). <br></li><li>  The list of clients ( <code>clients</code> ). <br></li></ul><br>  Customer details will include email address (email), name (name), phone (phone), and financial documents (budgets).  A financial document includes data such as its state (state), title (title), items (items) and price (price). <br><br>  We continue to work with the file <code>user.js</code> , add the following code to it: <br><br><pre> <code class="hljs lua">//       -       Schema.pre(<span class="hljs-string"><span class="hljs-string">'save'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(next)</span></span></span></span> { const user = this; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (this.isModified(<span class="hljs-string"><span class="hljs-string">'password'</span></span>) || this.isNew) {   bcrypt.genSalt(<span class="hljs-number"><span class="hljs-number">10</span></span>, (<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>, salt) =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">next</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>);   bcrypt.hash(user.password, salt, (<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>, hash) =&gt; {     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">next</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">error</span></span>);     user.password = hash;       <span class="hljs-built_in"><span class="hljs-built_in">next</span></span>();     });   }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">next</span></span>(); } });</code> </pre> <br>  In this function, we generate a cryptographic salt and hash for user passwords. <br>  Following the code of this function, add a function that will compare passwords, checking the validity of user access to the system: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>.methods.comparePassword = <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>, callback) { bcrypt.compare(<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>, this.<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>, (error, matches) =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> callback(error);   callback(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, matches); }); };</code> </pre> <br>  Now, at the end of the file, create a <code>User</code> model: <br><br><pre> <code class="hljs pgsql">mongoose.model(<span class="hljs-string"><span class="hljs-string">'User'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Schema</span></span>);</code> </pre> <br><h2>  <font color="#3AC1EF">File BudgetManagerAPI / config / passport.js</font> </h2><br>  After the <code>User</code> model is ready, create a file <code>passport.js</code> in the <code>BudgetManagerAPI/config</code> folder.  Let's start working on this file with connecting dependencies: <br><br><pre> <code class="hljs lua">const PassportJWT = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'passport-jwt'</span></span>),     ExtractJWT = PassportJWT.ExtractJwt,     Strategy = PassportJWT.Strategy,     <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index.js'</span></span>),     models = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@BudgetManager/app/setup'</span></span>);</code> </pre> <br>  The <code>mongoose</code> package is needed to work with the <code>User</code> model, and <code>passport-jwt</code> is needed for authentication. <br><br>  Now add the following to this file: <br><br><pre> <code class="hljs coffeescript"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(passport)</span></span></span><span class="hljs-function"> =&gt;</span></span> { const User = models.User; const parameters = {   secretOrKey: config.secret,   jwtFromRequest: ExtractJWT.fromAuthHeaderAsBearerToken() }; passport.use(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Strategy(parameters, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(payload, done)</span></span></span><span class="hljs-function"> =&gt;</span></span> {   User.findOne({ id: payload.id }, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(error, user)</span></span></span><span class="hljs-function"> =&gt;</span></span> {     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> done(error, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (user) done(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, user);     <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> done(<span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);   }); })); }</code> </pre> <br>  Here we create an instance of the <code>User</code> model and find the user by performing a search on the JWT token received from the client. <br><br><h2>  <font color="#3AC1EF">File BudgetManagerAPI / config / database.js</font> </h2><br>  In the <code>BudgetManagerAPI/config</code> folder, create a <code>database.js</code> file that is responsible for working with the database.  Add the following to this file: <br><br><pre> <code class="hljs coffeescript"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mongoose, config)</span></span></span><span class="hljs-function"> =&gt;</span></span> { const database = mongoose.connection; mongoose.Promise = Promise; mongoose.connect(config.database, {   useMongoClient: <span class="hljs-literal"><span class="hljs-literal">true</span></span>,   promiseLibrary: <span class="hljs-built_in"><span class="hljs-built_in">global</span></span>.Promise }); database.<span class="hljs-literal"><span class="hljs-literal">on</span></span>(<span class="hljs-string"><span class="hljs-string">'error'</span></span>, error =&gt; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(`<span class="javascript"><span class="javascript">Connection to BudgetManager database failed: ${error}</span></span>`)); database.<span class="hljs-literal"><span class="hljs-literal">on</span></span>(<span class="hljs-string"><span class="hljs-string">'connected'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Connected to BudgetManager database'</span></span>)); database.<span class="hljs-literal"><span class="hljs-literal">on</span></span>(<span class="hljs-string"><span class="hljs-string">'disconnected'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Disconnected from BudgetManager database'</span></span>)); process.<span class="hljs-literal"><span class="hljs-literal">on</span></span>(<span class="hljs-string"><span class="hljs-string">'SIGINT'</span></span>, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {   database.close(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> {     <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'BudgetManager terminated, connection closed'</span></span>);     process.exit(<span class="hljs-number"><span class="hljs-number">0</span></span>);   }) }); };</code> </pre> <br>  Here we first switched <code>mongoose</code> to use the standard <code>Promise</code> object.  If you do not do this, you may encounter warnings displayed in the console.  Then we created a standard <code>mongoose</code> connection. <br><br><h2>  <font color="#3AC1EF">Server setup, services / index.js file</font> </h2><br>  After we have coped with some of the auxiliary subsystems, we will be engaged in server setup.  Go to the <code>services</code> folder and open the <code>index.js</code> file already in it.  Add the following to it: <br><br><pre> <code class="hljs javascript"><span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'module-alias/register'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> http = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http'</span></span>),     BudgetManagerAPI = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@BudgetManagerAPI'</span></span>),     BudgetManagerServer = http.Server(BudgetManagerAPI),     BudgetManagerPORT = process.env.PORT || <span class="hljs-number"><span class="hljs-number">3001</span></span>,     LOCAL = <span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>; BudgetManagerServer.listen(BudgetManagerPORT, LOCAL, () =&gt; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">`BudgetManagerAPI running on </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${BudgetManagerPORT}</span></span></span><span class="hljs-string">`</span></span>));</code> </pre> <br>  We start by connecting <code>module_alias</code> , which we will configure later (a step is optional, but this approach will help make the code cleaner).  If you decide not to use the <code>module_alias</code> package, then instead of <code>@BudgetManagerAPI</code> you will need to write <code>./services/BudgetManagerAPI/config</code> . <br><br>  In order to start the server, go to the root directory of the project and enter the <code>node services</code> command in the command line interpreter you use. <br><br><h2>  <font color="#3AC1EF">File BudgetManagerAPI / config / app.js</font> </h2><br>  In the <code>BudgetManagerAPI/config</code> directory, create an <code>app.js</code> file.  First, let's connect the dependencies: <br><br><pre> <code class="hljs lua">const express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>),     app = express(),     bodyParser = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'body-parser'</span></span>),     mongoose = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mongoose'</span></span>),     morgan = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'morgan'</span></span>),     consign = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'consign'</span></span>),     cors = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'cors'</span></span>),     passport = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'passport'</span></span>),     passportConfig = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./passport'</span></span>)(passport),     jwt = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'jsonwebtoken'</span></span>),     <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./index.js'</span></span>),     database = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./database'</span></span>)(mongoose, <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>);</code> </pre> <br>  In the <code>passportConfig = require('./passport')(passport)</code> we import the configuration file for <code>passport</code> , passing <code>passport</code> as an argument, since the following command is available in <code>passport.js</code> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c7e/80a/495/c7e80a4952c9be32dd430b05dfab8a15.png"><br><br>  Thanks to this approach, we can work with <code>passport</code> inside the <code>passport.js</code> file without having to connect it. <br><br>  Next, in the <code>app.js</code> file, we start working with packages and set the secret key: <br><br><pre> <code class="hljs php">app.<span class="hljs-keyword"><span class="hljs-keyword">use</span></span>(express.<span class="hljs-keyword"><span class="hljs-keyword">static</span></span>(<span class="hljs-string"><span class="hljs-string">'.'</span></span>)); app.<span class="hljs-keyword"><span class="hljs-keyword">use</span></span>(bodyParser.urlencoded({ extended: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> })); app.<span class="hljs-keyword"><span class="hljs-keyword">use</span></span>(bodyParser.json()); app.<span class="hljs-keyword"><span class="hljs-keyword">use</span></span>(morgan(<span class="hljs-string"><span class="hljs-string">'dev'</span></span>)); app.<span class="hljs-keyword"><span class="hljs-keyword">use</span></span>(cors()); app.<span class="hljs-keyword"><span class="hljs-keyword">use</span></span>(passport.initialize()); app.set(<span class="hljs-string"><span class="hljs-string">'budgetsecret'</span></span>, config.secret);</code> </pre> <br>  Alternatively, instead of using the <code>cors</code> package, you can do the following: <br><br><pre> <code class="hljs lua">app.use(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(req, res, next)</span></span></span></span> { res.header(<span class="hljs-string"><span class="hljs-string">"Access-Control-Allow-Origin"</span></span>, <span class="hljs-string"><span class="hljs-string">"*"</span></span>); res.header(<span class="hljs-string"><span class="hljs-string">"Access-Control-Allow-Headers"</span></span>, <span class="hljs-string"><span class="hljs-string">"Origin, X-Requested-With, Content-Type, Accept"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">next</span></span>(); });</code> </pre> <br><h2>  <font color="#3AC1EF">Configuring package.json</font> </h2><br>  Go to the root directory of the project, open the <code>package.json</code> and add to it, just before the <code>dependencies</code> block, the following: <br><br><pre> <code class="hljs perl"><span class="hljs-string"><span class="hljs-string">"homepage"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://github.com/gdomaradzki/focus-gestor-orcamentos#readme"</span></span>, <span class="hljs-string"><span class="hljs-string">"_moduleAliases"</span></span>: {   <span class="hljs-string"><span class="hljs-string">"@root"</span></span>: <span class="hljs-string"><span class="hljs-string">"."</span></span>,   <span class="hljs-string"><span class="hljs-string">"@BudgetManager"</span></span>: <span class="hljs-string"><span class="hljs-string">"./services/BudgetManagerAPI"</span></span>,   <span class="hljs-string"><span class="hljs-string">"@BudgetManagerModels"</span></span>:<span class="hljs-string"><span class="hljs-string">"./services/BudgetManagerAPI/app/models"</span></span>,   <span class="hljs-string"><span class="hljs-string">"@BudgetManagerAPI"</span></span>:<span class="hljs-string"><span class="hljs-string">"./services/BudgetManagerAPI/config/app.js"</span></span>,   <span class="hljs-string"><span class="hljs-string">"@config"</span></span>: <span class="hljs-string"><span class="hljs-string">"./services/BudgetManagerAPI/config/index.js"</span></span> }, <span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: {</code> </pre> <br>  Notice that the <code>dependencies</code> block already exists in the file, so you only need to add <code>homepage</code> and <code>_moduleAliases</code> . <br><br>  Thanks to these changes, you can access the project root directory using the <code>@root</code> alias, the <code>index.js</code> configuration file using the <code>@config</code> alias, and so on. <br><br><h2>  <font color="#3AC1EF">File BudgetManagerAPI / app / setup / index.js</font> </h2><br>  After setting up the aliases, go to the <code>BudgetManagerAPI/app</code> folder and create a new <code>setup</code> folder, and in it - the <code>index.js</code> file.  Add the following to it: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mongoose = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mongoose'</span></span>),    UserModel = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@BudgetManagerModels/user'</span></span>);; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> models = { <span class="hljs-attr"><span class="hljs-attr">User</span></span>: mongoose.model(<span class="hljs-string"><span class="hljs-string">'User'</span></span>) } <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = models;</code> </pre> <br>  We do this in order to ensure that models are loaded before something else is loaded into the application. <br><br><h2>  <font color="#3AC1EF">File BudgetManagerAPI / app / api / auth.js</font> </h2><br>  Now we start creating some of the API methods.  <code>BudgetManagerAPI/app</code> to the <code>BudgetManagerAPI/app</code> folder, create the <code>api</code> directory in it, and in it the <code>auth.js</code> file.  We write the following in it: <br><br><pre> <code class="hljs lua">const mongoose = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mongoose'</span></span>),     jwt = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'jsonwebtoken'</span></span>),     <span class="hljs-built_in"><span class="hljs-built_in">config</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@config'</span></span>);</code> </pre> <br>  Please note that by using the <code>module_alias</code> module <code>module_alias</code> we have made the code cleaner.  Otherwise I would have to write something like this: <br><br><pre> <code class="hljs lua"><span class="hljs-built_in"><span class="hljs-built_in">config</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./../../config);</span></span></code> </pre> <br>  Now, after connecting the packages, we will do the following in the same file: <br><br><pre> <code class="hljs pgsql">const api = {}; api.<span class="hljs-keyword"><span class="hljs-keyword">login</span></span> = (<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>) =&gt; (req, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>.findOne({ username: req.body.username }, (error, <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>) =&gt; {   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error) throw error;   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>) res.status(<span class="hljs-number"><span class="hljs-number">401</span></span>).send({ success: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, message: <span class="hljs-string"><span class="hljs-string">'Authentication failed. User not found.'</span></span> });   <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {     <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.comparePassword(req.body.<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>, (error, matches) =&gt; {       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (matches &amp;&amp; !error) {         const token = jwt.sign({ <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> }, config.secret);         res.json({ success: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, message: <span class="hljs-string"><span class="hljs-string">'Token granted'</span></span>, token });       } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {         res.status(<span class="hljs-number"><span class="hljs-number">401</span></span>).send({ success: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, message: <span class="hljs-string"><span class="hljs-string">'Authentication failed. Wrong password.'</span></span> });       }     });   } }); }</code> </pre> <br>  Here we create an empty <code>api</code> object, in which we save all the necessary methods.  In the <code>login</code> method, we first pass the <code>User</code> argument, since we need a method to access the <code>User</code> model, then we pass the arguments <code>req</code> and <code>res</code> . <br><br>  This method searches for a <code>User</code> object that matches the <code>username</code> .  If the username is not recognized, we give an error, otherwise we check the password and token associated with the user. <br><br>  Now we need another <code>api</code> method that will receive and parse the token: <br><br><pre> <code class="hljs kotlin">api.verify = (headers) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (headers &amp;&amp; headers.authorization) {   <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> split = headers.authorization.split(<span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (split.length === <span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> split[<span class="hljs-number"><span class="hljs-number">1</span></span>];   <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }</code> </pre> <br>  This method checks the headers and gets the <code>Authorization</code> header.  After all these steps, we can finally export the <code>api</code> object: <br><br><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">exports</span></span> = api;</code> </pre> <br><h2>  <font color="#3AC1EF">API routes, BudgetManagerAPI / app / routes / auth.js</font> </h2><br>  Let's create the API routes.  To do this, go to the <code>services/BudgetManagerAPI/app</code> folder and create the <code>routes</code> directory in it, in which we will create the <code>auth.js</code> file with the following contents: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> models = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@BudgetManager/app/setup'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">app</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> api = app.BudgetManagerAPI.app.api.auth; app.route(<span class="hljs-string"><span class="hljs-string">'/'</span></span>)    .get(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) =&gt;</span></span> res.send(<span class="hljs-string"><span class="hljs-string">'Budget Manager API'</span></span>)); app.route(<span class="hljs-string"><span class="hljs-string">'/api/v1/auth'</span></span>)    .post(api.login(models.User)); }</code> </pre> <br>  In this module, we pass the <code>app</code> object, so you can set routes.  Here we set the constant <code>api</code> , which we use to work with the <code>auth.js</code> file in the <code>api</code> folder.  Here we set the default route, <code>'/'</code> , when accessing which the string ‚ÄúBudget Manager API‚Äù is passed to the user.  Right there we create the route <code>'/api/v1/auth'</code> (for which the POST request is used).  To serve this route, we use the <code>login</code> method, passing the <code>User</code> model as an argument. <br><br><h2>  <font color="#3AC1EF">File BudgetManagerAPI / config / app.js</font> </h2><br>  Now let's <code>app.js</code> back to the <code>app.js</code> file, which is located in the <code>BudgetManagerAPI/config</code> folder and add the following (the <code>app.set('budgetsecret', config.secret)</code> line <code>app.set('budgetsecret', config.secret)</code> given as a guideline, you don‚Äôt need to add it to the file a second time): <br><br><pre> <code class="hljs pgsql">app.<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>(<span class="hljs-string"><span class="hljs-string">'budgetsecret'</span></span>, config.secret); consign({ cwd: <span class="hljs-string"><span class="hljs-string">'services'</span></span> })     .<span class="hljs-keyword"><span class="hljs-keyword">include</span></span>(<span class="hljs-string"><span class="hljs-string">'BudgetManagerAPI/app/setup'</span></span>)     .<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(<span class="hljs-string"><span class="hljs-string">'BudgetManagerAPI/app/api'</span></span>)     .<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(<span class="hljs-string"><span class="hljs-string">'BudgetManagerAPI/app/routes'</span></span>)     .<span class="hljs-keyword"><span class="hljs-keyword">into</span></span>(app); module.exports = app;</code> </pre> <br>  Here we check, before performing other actions, whether the contents of the <code>setup</code> folder are downloaded, so that an instance of the model will be created first.  Then we load the API methods, and finally the routes. <br><br><h2>  <font color="#3AC1EF">File BudgetManagerAPI / app / api / user.js</font> </h2><br>  Let's <code>BudgetManagerAPI/app/api</code> back to the <code>BudgetManagerAPI/app/api</code> folder and create the <code>user.js</code> file in it.  Put the following code in it: <br><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> mongoose = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'mongoose'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> api = {}; api.setup = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">User</span></span></span><span class="hljs-function">) =&gt;</span></span> (req, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> admin = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User({   <span class="hljs-attr"><span class="hljs-attr">username</span></span>: <span class="hljs-string"><span class="hljs-string">'admin'</span></span>,   <span class="hljs-attr"><span class="hljs-attr">password</span></span>: <span class="hljs-string"><span class="hljs-string">'admin'</span></span>,   <span class="hljs-attr"><span class="hljs-attr">clients</span></span>: [] }); admin.save(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> error; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Admin account was succesfully set up'</span></span>);   res.json({ <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); }) }</code> </pre> <br>  The <code>setup</code> method allows you to create an administrator account for debugging purposes.  In the finished application of this account should not be. <br><br>  Now, in the same file, we will create a method used for test purposes, allowing us to display a list of all users who have registered in the application, and needed to test the authentication mechanisms: <br><br><pre> <code class="hljs coffeescript">api.index = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(User, BudgetToken)</span></span></span><span class="hljs-function"> =&gt;</span></span> (req, res) =&gt; { const token = BudgetToken; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (token) {   User.find({}, <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(error, users)</span></span></span><span class="hljs-function"> =&gt;</span></span> {     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> error;     res.status(<span class="hljs-number"><span class="hljs-number">200</span></span>).json(users);   }); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.status(<span class="hljs-number"><span class="hljs-number">403</span></span>).send({ success: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, message: <span class="hljs-string"><span class="hljs-string">'Unauthorized'</span></span> }); }</code> </pre> <br>  Next, create a <code>signup</code> method that will be needed later.  It is designed to register new users: <br><br><pre> <code class="hljs pgsql">api.signup = (<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>) =&gt; (req, res) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!req.body.username || !req.body.<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>) res.json({ success: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, message: <span class="hljs-string"><span class="hljs-string">'Please, pass a username and password.'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {   const newUser = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>({     username: req.body.username,     <span class="hljs-keyword"><span class="hljs-keyword">password</span></span>: req.body.<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>,     clients: []   });   newUser.save((error) =&gt; {     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.status(<span class="hljs-number"><span class="hljs-number">400</span></span>).json({ success: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, message:  <span class="hljs-string"><span class="hljs-string">'Username already exists.'</span></span> });     res.json({ success: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, message: <span class="hljs-string"><span class="hljs-string">'Account created successfully'</span></span> });   }) } } module.exports = api;</code> </pre> <br>  Here, when trying to register a new user, it is checked whether the <code>username</code> and <code>password</code> fields are filled in, and if so, then, provided that a valid username is entered, a new user is created. <br><br>  At this stage of work on the application, we will assume that the API methods for working with users are ready. <br><br><h2>  <font color="#3AC1EF">BudgetManagerAPI / app / routes / user.js file</font> </h2><br>  Now create the <code>user.js</code> file in the <code>BudgetManagerAPI/app/routes</code> folder and write the following code into it: <br><br><pre> <code class="hljs pgsql">const passport = require(<span class="hljs-string"><span class="hljs-string">'passport'</span></span>),     config = require(<span class="hljs-string"><span class="hljs-string">'@config'</span></span>),     models = require(<span class="hljs-string"><span class="hljs-string">'@BudgetManager/app/setup'</span></span>); module.exports = (app) =&gt; { const api = app.BudgetManagerAPI.app.api.<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>; app.route(<span class="hljs-string"><span class="hljs-string">'/api/v1/setup'</span></span>)    .post(api.setup(models.<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>)) app.route(<span class="hljs-string"><span class="hljs-string">'/api/v1/users'</span></span>)    .<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(passport.authenticate(<span class="hljs-string"><span class="hljs-string">'jwt'</span></span>, config.<span class="hljs-keyword"><span class="hljs-keyword">session</span></span>),  api.<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>(models.<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>, app.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'budgetsecret'</span></span>))); app.route(<span class="hljs-string"><span class="hljs-string">'/api/v1/signup'</span></span>)    .post(api.signup(models.<span class="hljs-keyword"><span class="hljs-keyword">User</span></span>)); }</code> </pre> <br>  Here we import the <code>passport</code> library to organize the authentication, connect the configuration file to configure the session parameters, and connect the models so that you can check whether the user has the right to work with the API endpoints. <br><br><h2>  <font color="#3AC1EF">Tests</font> </h2><br>  Let's check what we have created by running the application server and the database server.  Namely, if you go to <a href="http://localhost:3001/,">http: // localhost: 3001 /,</a> then in the terminal window where the server is running, you will see information about the request (there should be 200, which means that the request was successful), and the time data answer.  It will look something like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/441/0b1/066/4410b1066d56ec9036f851974b987b44.png"><br><br>  The client application, that is, the browser, should display a regular page with the text ‚ÄúBudget Manager API‚Äù. <br><br>  Now let's check the route <code>route</code> , which can be accessed at <a href="http://localhost:3001/api/v1/auth">http: // localhost: 3001 / api / v1 / auth</a> . <br><br>  A message about the GET request with the status 404 will appear in the server window (this indicates that the server was able to be contacted, but it cannot provide what we need) and the response time. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b33/5b9/19f/b335b919fc2ed273458a4a0309377339.png"><br><br>  This happens because we use this API endpoint only for POST requests.  The server has nothing to answer if we execute a GET request. <br><br>  Check <code>user</code> routes by going to <a href="http://localhost:3001/api/v1/users">http: // localhost: 3001 / api / v1 / users</a> .  The server will report a GET method with a status of 401. This indicates that the request was not processed because we do not have enough privileges to work with the target resource.  The client will display a page with the text ‚ÄúUnauthorized‚Äù. <br><br>  All this makes it possible to judge that the authentication system works, however, the question here is how to verify the login methods, if we do not even have a registration form yet. <br><br>  One way to solve this problem is to use the Postman program.  You can either <a href="https://www.getpostman.com/">download</a> and install it as a normal application, or use the Chrome browser <a href="https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop">extension</a> format. <br><br><h2>  <font color="#3AC1EF">Testing the application using Postman</font> </h2><br>  First, connect to the <code>setup</code> endpoint to create an administrator account.  In the Postman interface, it will look like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6e1/a8a/226/6e1a8a226826451b254ed8855cde10f4.png"><br><br>  In the address field, enter <code>http://localhost:3001/api/v1/setup</code> , change the type of request to <code>POST</code> and click the <code>Send</code> button.  The server's JSON response must contain the message <code>"success": true</code> . <br><br>  Now we will try to log in with the administrator account. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d56/ce4/8c4/d56ce48c4f732e84e577fb5c6c7cc515.png"><br><br>  To do this, use the POST request to the endpoint <code>http://localhost:3001/api/v1/auth</code> , on the <code>Body</code> tab, specify the <code>username</code> and <code>password</code> keys with the same <code>admin</code> value and click the <code>Send</code> button. <br><br>  The server response should look like the one below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf6/a27/9fb/cf6a279fb4d7ae214e1c8966526f8054.png"><br><br>  Next, we get a list of users of the system. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/736/8f2/87e/7368f287e115232478417f0e8b8c213d.png"><br><br>  To do this, copy the value of the <code>token</code> key, use the GET request, enter <code>http://localhost:3001/api/v1/users</code> in the address field, then add a new <code>Authorization</code> header on the <code>Headers</code> tab with a value of the form <code>Bearer token</code> (instead of <code>token</code> insert the token copied from the previously received server response).  In the same place, add a <code>Content-Type</code> header with the value <code>application/x-www-form-urlencoded</code> and click <code>Send</code> . <br><br>  The JSON-array should come in response, in which, in our case, there will be information about only one user, who is the administrator. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/05a/603/980/05a60398006d685421f2e1a09b3c307f.png"><br><br>  Now let's check the method of registering a new user, <code>signup</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/68c/db5/eb5/68cdb5eb5efcb308f898667e18b976ee.png"><br><br>  To do this, open a new tab, configure a POST request to the endpoint <code>http://localhost:3001/api/v1/signup</code> , on the <code>Body</code> tab, select the <code>x-www-form-urlencoded</code> switch, enter the <code>username</code> and <code>password</code> keys with values ‚Äã‚Äãdifferent from <code>admin</code> , and click <code>Send</code> .  If everything works as it should, the following should come back: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c54/fcc/fc5/c54fccfc5230ac58da6f5baa18efb22b.png"><br><br>  Now, if we return to the <code>Postman</code> tab, which accessed <code>http://localhost:3001/api/v1/users</code> to get the list of users, and click <code>Send</code> , an array of two objects representing the administrator and the new user should come back. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bed/ba4/474/bedba4474e1d250c38fb5b84300b0514.png"><br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  This concludes the first part of this series.  Here you learned how to create a Node.js application from scratch and set up a simple JWT authentication.  In the next part, let's start developing the user interface of the application using Vue.js. <br><br>  Dear readers!  In your opinion, is the method of user authentication proposed by the author suitable for use in production? </div><p>Source: <a href="https://habr.com/ru/post/340750/">https://habr.com/ru/post/340750/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340738/index.html">DevOops 2017: Docker, Docker, Docker</a></li>
<li><a href="../340740/index.html">Vim after 15 years</a></li>
<li><a href="../340742/index.html">You can‚Äôt please everyone, or what we learn from the 2006 redesign of the Facebook feed</a></li>
<li><a href="../340744/index.html">Time Travel Debugging in the new WinDbg</a></li>
<li><a href="../340746/index.html">Video calls to Zoom video from web pages</a></li>
<li><a href="../340752/index.html">Secrets of a developer who has sold half a million copies of games</a></li>
<li><a href="../340754/index.html">Implementing a proxy server on the integration bus</a></li>
<li><a href="../340756/index.html">How quickly can the phone be infected with a virus, and what will happen to it after that?</a></li>
<li><a href="../340758/index.html">Asynchronous modes of gRPC framework and principles of their work in C ++</a></li>
<li><a href="../340760/index.html">Meeting in St. Petersburg November 16: Delivery-infrastructure for companies and individual projects</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>