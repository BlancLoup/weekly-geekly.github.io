<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JBrowser: MozSwing Reincarnation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recall what MozSwing is . MozSwing is the only adequate (in my opinion) free and cross-platform solution for embedding a browser as a component of a s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JBrowser: MozSwing Reincarnation</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/bec/4ff/e75/bec4ffe75bb52c331ab8c09ea3af14b6.gif" alt="image" align="left">  Recall what <a href="http://sourceforge.net/projects/mozswing/">MozSwing is</a> .  MozSwing is the only adequate (in my opinion) free and cross-platform solution for embedding a browser as a component of a swing.  But, sadly enough to admit it, the project died at that stage when there were too many mistakes in it.  These errors, as well as miscalculations in architecture, do not allow using this solution ‚Äúas is‚Äù for your projects.  With an overwhelming desire to fix it, I took up the job and did something for me. <br><br>  (An article about Mozilla browser integration as a Swing component.) <br><a name="habracut"></a><br>  <b>Why is bad MozSwing</b> <br><br>  No, no, don‚Äôt think that I think MozSwing sucks, this is a huge job for which you need to thank you so much (my work is several times less), but MozSwing doesn‚Äôt like me and that's why: <br><ol><li>  Support for <a href="https://developer.mozilla.org/en/XULRunner">xulrunner</a> `only version 1.9 (which, by the way, does not support Russian letters in transit for windows-systems) when there is version 1.9.2. </li><li>  A huge number of brain-breaking static classes and methods, which is why MozSwing appears before us an indestructible rock.  In order to change anything in it, you have to change the bytecode of the already loaded classes, because inheritance in the case of MozSwing does not work. </li><li>  The inability to explicitly override <a href="https://developer.mozilla.org/en/NsIWindowCreator">nsIWindowCreator</a> (the class implementing this interface is creating windows for the browser), which makes it necessary to invent crutches to create browsers as tabs, since MozSwing prefers to open new pages in new windows.  For example, this is how I replace nsIWindowCreator after initialization: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">nsIWindowWatcher winWatcher = XPCOMUtils.getService( <font color="#A31515">"@mozilla.org/embedcomp/window-watcher;1"</font> , nsIWindowWatcher. <font color="#0000ff">class</font> ); <font color="#008000">//$NON-NLS-1$</font> <br> winWatcher.setWindowCreator(wndCreator);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  However, the error is potentially hidden here, because MozSwing loves static classes, methods, and internally refers to its nsIWindowCreator. </li><li>  Some, let's say, very dubious solutions in the code (MozSwing source code: just in case a 3-window pool is created, so that you can take a window from this pool to embed a browser into it): <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">/**</font> <br> <font color="#008000">* When mozilla does a callback to createChromeWindow()</font> <br> <font color="#008000">* we need to create a swing window. But doing this on</font> <br> <font color="#008000">* Swing thread using invokeAndWait sometimes ends</font> <br> <font color="#008000">* with deadlock in AWT.</font> <br> <font color="#008000">* Therefore we keep a list of precreated windows</font> <br> <font color="#008000">* in case we will need them.</font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">private</font> <font color="#2B91AF">List</font> &lt;IMozillaWindow&gt; precreatedWins = <font color="#0000ff">new</font> LinkedList&lt;IMozillaWindow&gt;(); <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> ensurePrecreatedWindows() { <br> ensurePrecreatedWindows(3); <br> } <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> ensurePrecreatedWindows( <font color="#0000ff">int</font> winNum) { <br> assert !isMozillaThread(); <font color="#008000">//has to be called from swing</font> <br> <br> <font color="#0000ff">while</font> (precreatedWins.size()&lt;winNum) { <br> <br> <font color="#0000ff">if</font> (winFactory== <font color="#0000ff">null</font> ) <font color="#0000ff">return</font> ; <br> IMozillaWindow w = winFactory.create( <font color="#0000ff">false</font> ); <br> <font color="#0000ff">if</font> (!(w instanceof Component)) <font color="#0000ff">return</font> ; <br> <br> <font color="#008000">// w is instance of something we can work with</font> <br> precreatedWins.add(w); <br> Component c = (Component)w; <br> c.addNotify(); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The number three is especially scary.  It kind of hints us that the three windows should be enough in principle ... Probably ... </li><li>  To enable support for contextual commands (shortcut menu), some MozSwing'a methods have to be changed.  For example: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">@SuppressWarnings( <font color="#A31515">"deprecation"</font> ) <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> replaceChromeAdapterMethod() { <br> <font color="#0000ff">try</font> { <br> ClassPool classPool = ClassPool.getDefault(); <br> CtClass ctClass = classPool. <font color="#0000ff">get</font> ( <font color="#A31515">"org.mozilla.browser.impl.ChromeAdapter"</font> ); <br> CtMethod ctMethod = ctClass.getMethod( <font color="#A31515">"queryInterface"</font> , <font color="#A31515">"(Ljava/lang/String;)Lorg/mozilla/interfaces/nsISupports;"</font> ); <br> ctMethod.setBody( <font color="#A31515">"{ return ru.redstonegroup.geo.gui.components.browser.impl.QueryInterfaceImpl.getInstance().queryInterface(this, $1); }"</font> ); <br> ctClass.toClass(QueryInterfaceImpl. <font color="#0000ff">class</font> .getClassLoader()); <br> } <font color="#0000ff">catch</font> (Throwable e) { <br> logger.error(e.getMessage(), e); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> </li><li>  Constantly drops Sun JVM on some linux systems (ubuntu, openSUSE). </li><li>  Confusion of sources (by the way, rather it is connected with the complexity of the XPCOM technology itself). </li><li>  No integration with maven. </li><li>  Difficult to integrate with IoC container. </li><li>  It is not possible to create a window without any ryushechek, they can only be hidden. </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Jbrowser</b> <br><br>  Of course, I have no illusions - my decision is not ideal: since it is based on MozSwing, it took many of his illnesses.  If you like, JBrowser is my rethinking of MozSwing  ªand much more suitable for real-world systems.  Well, at least, I like my API many times more (although you may not like it at all). <br><br>  The main problem when meeting MozSwing was that there was no single entry point in it - creating a browser was done as a simple component creation (something like new MozillaWindow, I'm sorry, I don‚Äôt remember exactly).  Yes, it is in some sense convenient, as long as you do not need anything more than creating just a browser window, but how to configure the browser being created?  One option is to inherit from MozSwing-components, climb inside and dig-dig-dig ... <br><br>  Immediately I was not clear: how to change the proxy server settings for the browser?  After some time, it turned out that there is a corresponding MozillaConfig class with a static setProxy method (or something like that).  Oh my God, I would never have known if I hadn't opened the source.  In general, for me it is all not obvious. <br><br>  Therefore, JBrowser is a kind of opposite (currently not complete) MozSwing in terms of design.  JBrowser has an entry point - the <a href="">BrowserManager</a> interface.  This is the topmost level of xulrunner and swing ªa integration.  The class implementing the interface performs all the initialization, as it prepares the ground for further work.  In addition to initialization, the implementing class is obliged to provide you on demand with a certain implementation of the <a href="">BrowserConfig</a> interface, which allows you to adjust the policy of all browsers (enable / disable images, proxies, etc.) Just what I wanted. <br><br>  In contrast to the upper level of integration, JBrowser has the lowest level of integration, the so-called ‚Äúcomponent browser‚Äù.  Any browser component implements the <a href="">JBrowserComponent</a> interface.  This interface is a composite that combines the functionality of a Swing component and implements a <a href="">browser</a> interface. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">/**</font> <br> <font color="#008000">*     Swing // Browser embedded in swing component</font> <br> <font color="#008000">* @author caiiiycuk</font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">interface</font> JBrowserComponent&lt;T extends Component&gt; extends DisplayableComponent, Browser, NativeBrowser { <br> <font color="#008000">/**</font> <br> <font color="#008000">* @return See {@link java.awt.Component}</font> <br> <font color="#008000">*/</font> <br> T getComponent(); <br> ... <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  There is <a href="">JBrowserCanvas</a> - the basic implementation of this interface.  This is nothing more than a Swing-Canvas component with a browser built into it.  Other implementations of the browser component almost always wrap JBrowserCanvas (delegate calls to it).  For example, another browser component <a href="">JBrowserFrame</a> (browser and JFrame) does this. <br><br>  Between these two opposites, there is another link that unites everything into a single whole - this is a factory-layer (factorial-layer).  After creating the top integration layer based on BrowserManager, numerous factors of browser components can be created that implement the <a href="">ComponentFactory</a> interface.  Normally, when an application contains several such factors.  Properly configured factor through its methods creates specific implementations of browser components.  Suppose I use the following factors in my application: JFrameBrowserFactory (creates a browser as a new window), JTabbedBrowserFactory (creates a browser as a new tab).  Thanks to this scheme, it becomes possible to easily solve the problem of customization of browser components you create. <br><br>  So, here's the whole chain of working with JBrowser: create a BrowserManager (by the way, you can / should use the <a href="">builder</a> for this), create at least one factor for your browser component and finally, create a browser using factor.  This is the simplest way to work with JBrowser: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> GettingStartedSnippet { <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> main( <font color="#2B91AF">String</font> [] args) { <br> Dimension screenSize = Toolkit.getDefaultToolkit().getScreenSize(); <br> <br> JFrame frame = <font color="#0000ff">new</font> JFrame(); <br> frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE); <br> frame.setSize(( <font color="#0000ff">int</font> ) (screenSize.getWidth() * 0.75f), <br> ( <font color="#0000ff">int</font> ) (screenSize.getHeight() * 0.75f)); <br> frame.setLocationRelativeTo( <font color="#0000ff">null</font> ); <br> <br> BrowserManager browserManager = <br> <font color="#0000ff">new</font> JBrowserBuilder().buildBrowserManager(); <br> <br> JComponentFactory&lt;Canvas&gt; canvasFactory = browserManager.getComponentFactory(JBrowserCanvas. <font color="#0000ff">class</font> ); <br> JBrowserComponent&lt;?&gt; browser = canvasFactory.createBrowser(); <br> <br> frame.getContentPane().add(browser.getComponent()); <br> frame.setVisible( <font color="#0000ff">true</font> ); <br> <br> browser.setUrl( <font color="#A31515">"http://code.google.com/p/jbrowser/"</font> ); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Why factor?  I think (maybe I'm wrong) that it is very convenient.  For example, I register my factors in an IoC container and can easily access them from almost any part of the application, so I can at least make a button in the most recent menu that creates a new browser tab for me. <br>  The advantage of this architecture is that you can rewrite any of these three levels, and still get a working system efficiently. <br><br>  <b>Features that were not in MozSwing</b> <br>  In addition to the complete processing of interfaces, there are some more features added: <br><br><ul><li>  It became possible to easily get the favIcon of the open page (browser.getFavIcon ()). </li><li>  It became possible to easily build in the context menu. </li><li>  Full integration with maven.  In this regard, JBrowser is easy to connect and easy to assemble for your target system (by changing the profile in pom.xml).  At the moment, everything supported by MozSwing is supported - win, linux, solaris, mac. </li></ul><br>  Project links: <br>  Project <a href="http://code.google.com/p/jbrowser/">JBrowser (stable)</a> <br>  Project <a href="http://code.google.com/p/jbrowser-snippets/">with many examples (dev)</a> <br>  How to get started quickly with <a href="http://code.google.com/p/jbrowser-snippets/wiki/WikiGettingStartedEclipse">JBrowser under Eclipse</a> <br><br>  <b>What could not be achieved</b> <br><br>  Unfortunately, while Xulrunner 1.9.2 is not supported, however, there is a reserve, and the light at the end of the tunnel is visible. <br><br>  <b>Jwebpane</b> <br><br>  I hope he will come out someday and will save the world.  Really looking forward to this project. </div><p>Source: <a href="https://habr.com/ru/post/91884/">https://habr.com/ru/post/91884/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../91876/index.html">Real-time guitar sound processing on PC</a></li>
<li><a href="../91878/index.html">Millions of archival data on the Great Patriotic War will now be available on the Internet</a></li>
<li><a href="../91879/index.html">Cisco EEM Uses</a></li>
<li><a href="../91881/index.html">Creation of IP documentation</a></li>
<li><a href="../91883/index.html">FlashDevelop 3.1.0 RTM Overview</a></li>
<li><a href="../91885/index.html">What kind of indentation do you prefer to use to create a code hierarchy?</a></li>
<li><a href="../91887/index.html">Far Eastern Internet Forum 2010 May 19-21 May in Khabarovsk</a></li>
<li><a href="../91889/index.html">Russian section on Enetri.com</a></li>
<li><a href="../91891/index.html">ValueHost is dead, but alive - UNIQUE INDEX problems</a></li>
<li><a href="../91893/index.html">Another "trap" from Megafon-Moscow</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>