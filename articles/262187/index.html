<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a new field type for MS SharePoint using the example of a simple check field</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When working with SharePoint, it is often necessary to make your own field for any specific tasks. One of these tasks is the ability to check text fie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a new field type for MS SharePoint using the example of a simple check field</h1><div class="post__text post__text-html js-mediator-article">  When working with SharePoint, it is often necessary to make your own field for any specific tasks.  One of these tasks is the ability to check text fields, for example, the correctness of filling in Email or any data about the Organization: TIN, PPC, etc. <br><br><img src="https://habrastorage.org/files/395/0c8/c9e/3950c8c9e85a427a8664c9703d67c6e6.png"><br><a name="habracut"></a><br>  The simplest and most convenient in this case is the use of regular expressions, so we‚Äôll dwell on them. <br>  Let's start with the internal view of the field in Sharepoint.  This is a class inherited from the SPField class.  The fields themselves are stored in the Sharepoint database as encrypted XML.  Based on XML (field schema), an object inherited from SPField is created.  The scheme of a plain text field looks like this: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ID</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{fa564e0f-0c70-4ab9-b863-0177e6ddd247}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Title"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">SourceID</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.microsoft.com/sharepoint/v3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">StaticName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Title"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Group</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_Hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">DisplayName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TRUE"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FromBaseType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TRUE"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  First, create a class for our new field: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RegExpField</span></span> : <span class="hljs-title"><span class="hljs-title">SPFieldText</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegExpField</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SPFieldCollection fields, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fieldName</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fields, fieldName</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegExpField</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SPFieldCollection fields, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> typeName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> displayName</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fields, typeName, displayName</span></span></span><span class="hljs-function">)</span></span> { } }</code> </pre><br>  The field must have 2 custom properties - this is the property that stores the regular expression for its validation and the property that stores the text of the error displayed in cases of non-compliance of the string with the regular expression. <br>  With custom properties, SharePoint fields have certain difficulties, the most optimal is to use <s>forgive me. Gods of</s> reflection.  We need to add 2 methods to our field: <br><br><pre> <code class="hljs pgsql">//          private <span class="hljs-type"><span class="hljs-type">void</span></span> SetFieldAttribute(string <span class="hljs-keyword"><span class="hljs-keyword">attribute</span></span>, string <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> baseType; BindingFlags flags; MethodInfo mi; baseType = typeof(RegExpField); flags = BindingFlags.Instance | BindingFlags.NonPublic; mi = baseType.GetMethod("SetFieldAttributeValue", flags); mi.Invoke(this, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">attribute</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> }); } //          private string GetFieldAttribute(string <span class="hljs-keyword"><span class="hljs-keyword">attribute</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> baseType; BindingFlags flags; MethodInfo mi; baseType = typeof(RegExpField); flags = BindingFlags.Instance | BindingFlags.NonPublic; mi = baseType.GetMethod("GetFieldAttributeValue", flags, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>[] { typeof(String) }, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> obj = mi.Invoke(this, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[] { <span class="hljs-keyword"><span class="hljs-keyword">attribute</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ""; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> obj.ToString(); }</code> </pre><br>  Add 2 properties to the field: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ValidRegExp { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetFieldAttribute(<span class="hljs-string"><span class="hljs-string">"ValidRegExp"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetFieldAttribute(<span class="hljs-string"><span class="hljs-string">"ValidRegExp"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ErrorMessage { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> GetFieldAttribute(<span class="hljs-string"><span class="hljs-string">"ErrorMessage"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { SetFieldAttribute(<span class="hljs-string"><span class="hljs-string">"ErrorMessage"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); } }</code> </pre><br>  Now you need to add the ability to edit the field settings to the user.  To do this, create a UserControl RegExpFieldEdit.ascx and inherit it from the IFieldEditor interface.  The interface has one property and two methods that need to be overridden.  It will look like this: <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">bool</span></span> DisplayAsNewSection { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } //     <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> InitializeWithField(SPField field) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!IsPostBack) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (field <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> RegExpField) { var Validfield = field <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> RegExpField; RegExp.Text = Validfield.ValidRegExp; ErrorMessage.Text = Validfield.ErrorMessage; } } } //     <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> OnSaveChange(SPField field, <span class="hljs-type"><span class="hljs-type">bool</span></span> isNewField) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (field <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> RegExpField) { var Validfield = field <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> RegExpField; Validfield.ValidRegExp = RegExp.Text; Validfield.ErrorMessage = ErrorMessage.Text; } }</code> </pre><br>  The next step is to tell SharePoint that all we have created is a field.  To do this, create an XML in which we will write a new field type.  To get started, let's ‚Äúpatch‚Äù the XML folder from SharePoint into our project and create a new XML file with the name Fldtypes_RegExpField.xml, and the contents: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FieldTypes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FieldType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TypeName"</span></span></span><span class="hljs-tag">&gt;</span></span>RegExpField<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ParentType"</span></span></span><span class="hljs-tag">&gt;</span></span>Text<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TypeDisplayName"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TypeShortDescription"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FieldTypeClass"</span></span></span><span class="hljs-tag">&gt;</span></span>RegExpField.RegExpField, $SharePoint.Project.AssemblyFullName$<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"FieldEditorUserControl"</span></span></span><span class="hljs-tag">&gt;</span></span>/_controltemplates/15/RegExpFieldEdit.ascx<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FieldType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FieldTypes</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Now you need to understand the methods of rendering the field.  SharePoint has two methods for drawing fields: <br><ul><li>  Server rendering - for this, a certain WebControl is used inherited from BaseFieldControl, this technique is obsolete in SharePoint 2013. Therefore, we will not create this control. </li><li>  Client rendering (Client side rendering) - it refers to the field rendering directly using JavaScript in the client‚Äôs browser.  It appeared in SharePoint 2013 and is widely used there. </li></ul><br>  For our field we will use client rendering.  To begin with, we will create some JS file RegExpField.js in which the field will be drawn on the client.  To bind a file to our field, the JSLink mechanism is used.  Each field has a JSLink property.  It specifies the JS files that must be uploaded to the client for the field drawing to work.  Overload the property in our class field. <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> JSLink { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"/_layouts/15/RegExpField/RegExpField.js"</span></span>; } }</code> </pre><br>  Still need to transfer our new parameters to the client.  For this, there is a special method in SPField.  We will overload and add our parameters to it.  Here's what it looks like: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> Dictionary&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetJsonClientFormFieldSchema</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SPControlMode mode</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> formtctx = <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.GetJsonClientFormFieldSchema(mode); formtctx[<span class="hljs-string"><span class="hljs-string">"ValidRegExp"</span></span>] = ValidRegExp; formtctx[<span class="hljs-string"><span class="hljs-string">"ErrorMessage"</span></span>] = ErrorMessage; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> formtctx; }</code> </pre><br>  Here we take the already formed context and add our properties to it.  The data from this method is serialized by SharePoint in JSON using the JavaScriptSerializer class. <br>  Now you need to register the template for the field field on the client. For this we will write the following code in the JS file: <br><br><pre> <code class="javascript hljs">RegExpFieldTemplate = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegExpFieldTemplate</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ } RegExpFieldTemplate.$$cctor = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegExpFieldTemplate</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">$$$cctor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> (SPClientTemplates) != <span class="hljs-string"><span class="hljs-string">"undefined"</span></span>) SPClientTemplates.TemplateManager.RegisterTemplateOverrides(RegExpFieldTemplate.createRenderContextOverride()); <span class="hljs-comment"><span class="hljs-comment">//      } RegExpFieldTemplate.createRenderContextOverride = function () { var RegExpFieldTemplateContext = {}; RegExpFieldTemplateContext.Templates = {}; RegExpFieldTemplateContext.Templates['Fields'] = { RegExpField: { View: RegExpFieldTemplate.renderViewControl, DisplayForm: RegExpFieldTemplate.renderDisplayControl, NewForm: RegExpFieldTemplate.renderEditControl, EditForm: RegExpFieldTemplate.renderEditControl, }//          ,           }; return RegExpFieldTemplateContext; } function RegExpField_init() { RegExpFieldTemplate.$$cctor(); }; RegExpField_init();</span></span></code> </pre><br>  Now let's analyze the rendering of each display option separately. <br>  Let's start c drawing on the display (View) <br><br><pre> <code class="javascript hljs">RegExpFieldTemplate.renderViewControl = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">renderCtx, field, item, list</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (renderCtx.inGridMode === <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { field.AllowGridEditing = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//        GridView } return STSHtmlEncode(item[field.Name]);//    item.   Encode Html       }</span></span></code> </pre><br>  The html markup as a string is returned as the return value of the function. <br>  On the form of viewing will use the following code: <br><br><pre> <code class="javascript hljs">RegExpFieldTemplate.renderDisplayControl = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">renderCtx</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> STSHtmlEncode(renderCtx.CurrentFieldValue);<span class="hljs-comment"><span class="hljs-comment">//         Encode Html }</span></span></code> </pre><br>  The rendering of the field on the editing form and the element creation form remained.  Here's what happened: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    RegExpFieldTemplate.ValidatorValue = function (stringRegExp, errorMessage) { //     1     RegExpFieldTemplate.ValidatorValue.prototype.Validate = function (value) { //         if (value &amp;&amp; stringRegExp) { var reg = new RegExp(stringRegExp); //      if (!reg.test(value)) { //     , //       ,    return new SPClientFormsInclude.ClientValidation.ValidationResult(true, errorMessage);// } } return new SPClientForms.ClientValidation.ValidationResult(false); }; } RegExpFieldTemplate.renderEditControl = function (rCtx) { if (rCtx == null) return ''; var frmData = SPClientTemplates.Utility.GetFormContextForCurrentField(rCtx);//   ,    //           if (frmData == null || frmData.fieldSchema == null) return ''; var _inputElt; var _value = frmData.fieldValue != null ? frmData.fieldValue : '';//          var _inputId = frmData.fieldName + '_' + '_$RegExp' + rCtx.FormUniqueId;// Id input'  var validators = new Eos.Fields.ClientControls.ClientValidation.ValidatorSet();//  ,           if (frmData.fieldSchema.Required) {//         //              validators.RegisterValidator(new Eos.Fields.ClientControls.ClientValidation.RequiredValidator()); } //         validators.RegisterValidator(new RegExpFieldTemplate.ValidatorValue(rCtx.CurrentFieldSchema.ValidRegExp,rCtx.CurrentFieldSchema.ErrorMessage)); //   frmData.registerClientValidator(frmData.fieldName, validators); //     HTML   DOM frmData.registerInitCallback(frmData.fieldName, InitControl); //        ,  //       frmData.registerFocusCallback(frmData.fieldName, function () { if (_inputElt != null) { _inputElt.focus(); if (browseris.ie8standard) { var range = _inputElt.createTextRange(); range.collapse(true); range.moveStart('character', 0); range.moveEnd('character', 0); range.select(); } } }); //       frmData.registerValidationErrorCallback(frmData.fieldName, function (errorResult) { //      ,    span'a   SPFormControl_AppendValidationErrorMessage(_inputId, errorResult); }); //        frmData.registerGetValueCallback(frmData.fieldName, function () { return _inputElt == null ? '' : _inputElt.value; }); //      hidden (         ,   ) frmData.updateControlValue(frmData.fieldName, _value); //      var result = '&lt;span dir="' + STSHtmlEncode(frmData.fieldSchema.Direction) + '"&gt;'; result += '&lt;input type="text" value="' + STSHtmlEncode(_value) + '" maxlength="' + STSHtmlEncode(frmData.fieldSchema.MaxLength) + '" '; result += 'id="' + STSHtmlEncode(_inputId) + '" title="' + STSHtmlEncode(frmData.fieldSchema.Title); result += '" class="ms-long ms-spellcheck-true ' + (rCtx.CurrentFieldSchema.DoubleWidth ? 'InputDoubleWidth' : '') + ' " /&gt;'; result += '&lt;br /&gt;&lt;/span&gt;';// return result; //        DOM function InitControl() { //  Input _inputElt = document.getElementById(_inputId); if (_inputElt != null) //   AddEvtHandler(_inputElt, "onchange", OnValueChanged); } //    input function OnValueChanged() { if (_inputElt != null) //      hidden (         ,   ) frmData.updateControlValue(frmData.fieldName, _inputElt.value); } }</span></span></code> </pre><br>  Here I tried to describe everything as much as possible in the comments to the code, so I think there is nothing more to describe here. <br>  In general, our field is ready.  It remains to deploy the solution on SharePoint and configure our new field.  The field in Sharepoint will look like this: <br><br><img src="https://habrastorage.org/files/d85/bee/100/d85bee10046c4a55b3c1293b5b16ca47.png"><br><br>  Creating a new type of field of this level takes a couple of hours.  And it can greatly facilitate the work with user forms.  It can also be easily extended by adding an input mask to it, for example, using the <a href="https://plugins.jquery.com/maskedinput/">jQuery Masked Input</a> library. <br><br>  All sources are available on <a href="https://github.com/Bobs13/RegExpField/">GitHub</a> . </div><p>Source: <a href="https://habr.com/ru/post/262187/">https://habr.com/ru/post/262187/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262177/index.html">Web file manager with integrated chickenpox</a></li>
<li><a href="../262179/index.html">How to beat Excluded Constraints with RubyGem</a></li>
<li><a href="../262181/index.html">Using potential fields in real-time strategy scenarios</a></li>
<li><a href="../262183/index.html">React on ES6 +</a></li>
<li><a href="../262185/index.html">The history of routing in the project MAPS.ME</a></li>
<li><a href="../262189/index.html">Malevich</a></li>
<li><a href="../262191/index.html">Teach Hyper-V Server with Veeam B & R to backup yourself</a></li>
<li><a href="../262195/index.html">Multiboot in wysiwyg editor</a></li>
<li><a href="../262207/index.html">Telnet and echo - who is right, who is wrong</a></li>
<li><a href="../262211/index.html">Deploying Qt Applications on Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>