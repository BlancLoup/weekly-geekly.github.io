<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Applying a Poisson transform for seamless image overlay</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In tasks of machine vision and automated image processing, the task of seamless overlay of images is often encountered. For clarity, just give an exam...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Applying a Poisson transform for seamless image overlay</h1><div class="post__text post__text-html js-mediator-article">  In tasks of machine vision and automated image processing, the task of seamless overlay of images is often encountered.  For clarity, just give an example. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c9f/ba4/37d/c9fba437d34b00e4cf99671b84ea4a46.png"></div><br><a name="habracut"></a><br>  A seamless overlay of images (blending) will be called a method that allows you to insert a part of one image into another so that there are no noticeable seams on the borders of the inserted image.  This method adjusts the inserted part to the rest of the image.  In fact, to get the result, only the gradient field of the inserted part and the pixel values ‚Äã‚Äãof the original image on the border of the processed area are used. <br><br><h5>  Formulation of the problem </h5><br>  Suppose we have images A on which image B is superimposed in a certain place. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/77d/272/392/77d272392ff83695e48a3c90ead31845.png" alt="image"></div><br><br>  For seamless blending, it is necessary that the gradient of the image A in the area of ‚Äã‚Äãthe image B be equal to the gradient of the image B. The color restoration on the area B will be based on the gradient in the area B and the data about the color of the image A on the border of the area B. <br>  This means that to get the resulting image, you must restore the image by its gradient, i.e.  solve the Poisson problem. <br>  Below is a solution to the problem for the monotonous image.  For RGB image method is applied to each channel. <br><br><h5>  Decision </h5><br>  We define the boundary of the inserted area as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2ca/a88/097/2caa88097cdaaaf8bede17132384ee50.png" alt="image"></div><br><br>  And calculate the gradient of the overlay image: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f87/130/fd6/f87130fd6a66c0ff8cae212aa65866e1.png" alt="image"></div><br><br>  Now all the data is available and we can make up the Poisson equation: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b99/a07/f45/b99a07f45375d425c6367a50e85646ac.png" alt="image"></div><br>  where (x, y) is the current pixel coordinate, N is the number of neighboring pixels not including borders (no more than 4), (dx, dy) are coordinates of neighboring pixels, can take values ‚Äã‚Äãfrom the set {(-1, 0), (1 , 0), (0, -1), (0, 1)} <br><br>  Thus, an equation is compiled for each unknown pixel.  As a result, we get a system with M unknowns, where M is the number of pixels of the inserted image.  It remains only to solve this system.  There are quite a few methods for solving this problem, but the Jacobi method and the Gauss ‚Äì Seidel method are usually used for the solution. <br><br>  Often, a gradient field is mixed in the overlay area with the original image.  For example, take the maximum value of gradients A or B at a certain point.  It is best to feel the difference between the original and combined gradient by example. <br><br>  Image gradient recovery: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c99/855/5e2/c998555e2bd52d5834fa2e607d7f2435.jpg" alt="image"></div><br><br>  Recovery by the maximum gradient of images A and B: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c55/dd9/fcf/c55dd9fcf48923fb55da5b96a150b437.jpg" alt="image"></div><br><br>  It is obvious that it is advisable to apply image recovery by a combined gradient for objects that have a transparent structure (water, rainbow, clouds, etc.). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b27/a68/e3d/b27a68e3df02e0270affc7a93cb2b66b.png" alt="image"></div><br><br>  But what would a rainbow look like without a combination of gradients <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eef/a6f/480/eefa6f480b0cca6c2ec7324658c38410.png" alt="image"></div><br><br><h5>  Application of Poisson blending transform </h5><br><ul><li>  Replace faces / insert new objects into frame </li><li>  Overlaying objects in a frame with a transparent structure </li><li>  Image smoothing when creating panoramas </li><li>  Smoothing images when creating 3D-models of objects </li></ul><br><br><h5>  Links </h5><br><ul><li>  <a href="http://bybjhso.xeds.eu/clone/poisson.pdf">Original article</a> </li><li>  <a href="http://cgm.computergraphics.ru/issues/issue17/poissonimaging">A bit of theory, application and examples</a> </li><li>  Decision SLAE <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D0%25AF%25D0%25BA%25D0%25BE%25D0%25B1%25D0%25B8">by Jacobi method</a> and <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D0%2593%25D0%25B0%25D1%2583%25D1%2581%25D1%2581%25D0%25B0_%25E2%2580%2594_%25D0%2597%25D0%25B5%25D0%25B9%25D0%25B4%25D0%25B5%25D0%25BB%25D1%258F">Gauss-Seidel method</a> + source </li><li>  <a href="http://www.ctralie.com/Teaching/PoissonImageEditing/">Java program + source</a> </li><li>  Photos taken with the program <a href="http://blendme.ru/">Blend Me</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/213403/">https://habr.com/ru/post/213403/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../213385/index.html">Tai'Dzen: first steps</a></li>
<li><a href="../213389/index.html">How ServiceStack helps put the development of web services on stream</a></li>
<li><a href="../213391/index.html">Tame ZoG (Part 4: Beware of the Mines!)</a></li>
<li><a href="../213395/index.html">Announcement! DevCon 2014 becomes an international conference</a></li>
<li><a href="../213397/index.html">How I intercepted the traffic of the poker room or "Writing my MitM SSL proxy in C #"</a></li>
<li><a href="../213405/index.html">Weather station with Ethernet and tablet as a display device</a></li>
<li><a href="../213411/index.html">Unpacking, editing and packaging of DVR firmware and IP cameras from Xiong Mai</a></li>
<li><a href="../213413/index.html">The trouble with web security or the most secure bank of America</a></li>
<li><a href="../213415/index.html">Google Maps v2 for Android: Pop-up window with full redraw and input event support</a></li>
<li><a href="../213417/index.html">Smart video player or just gesture recognition</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>