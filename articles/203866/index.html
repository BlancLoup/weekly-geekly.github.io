<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>School geometry and Unity3D</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In a previous article, we talked about Planoplan , our online planner and apartment designer. With a small margin in the survey, the topic of school g...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>School geometry and Unity3D</h1><div class="post__text post__text-html js-mediator-article">  In a <a href="http://habrahabr.ru/company/kelnik/blog/198572/">previous article,</a> we talked about <a href="http://planoplan.com/">Planoplan</a> , our online planner and apartment designer.  With a small margin in the survey, the topic of school geometry in Planoplan and Unity3D won, and we are happy to talk about it. <br><br>  If we briefly sum up our experience, it turns out that the appropriate use of fairly simple algorithms improves the product significantly.  In the article we decided to do without formulas and pieces of code, because simple algorithms are used.  If some of them are still needed - write in the comments. <br><br> <a href="http://habrahabr.ru/company/kelnik/blog/203866/"><img src="https://habrastorage.org/getpro/habr/post_images/90d/ec7/02e/90dec702efca4934d4c9893fe8545c74.jpg"></a> <br><a name="habracut"></a><br><h3>  Correct intersections of walls, baseboards and other surfaces </h3><br>  Crossing the walls are very easy to find.  Each wall has two lines, roughly speaking, external and internal.  By solving a system of two equations, one can find the points of intersection of each pair of straight lines on the plane (except for boundary cases when the straight lines are parallel or the angle between them is small).  Course algebra for grade 7. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/33e/c49/237/33ec49237abf096d0f11be48d8b88156.jpg"><br><br>  On the left you can see a good intersection of the walls.  On the right is the boundary case when the point of intersection of the walls is in an unacceptable place.  Wall intersections are determined dynamically in Unity3D if the position or thickness of the walls changes. <br><br><h3>  Curved walls and openings </h3><br>  The next step to realism after calculating the correct intersections of straight walls is the construction and intersection of curved walls. <br><br>  Curved walls are constructed using <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D1%2580%25D0%25B8%25D0%25B2%25D0%25B0%25D1%258F_%25D0%2591%25D0%25B5%25D0%25B7%25D1%258C%25D0%25B5">quadratic Bezier curves</a> .  The algorithm is simple: when we have two points (the beginning and the end of the wall), we manually select the third point.  Along these three points, the algorithm can find any point on the curve.  Curved walls consist of a set of blocks the center of each of which lies on this curve.  Approximately 10 blocks fall per running meter of the wall - the number is chosen empirically. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b32/154/812/b32154812c746b789b00927e56836530.jpg"><br><br>  The ends of the walls triangulate a little differently to ensure the correct joints with other walls. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3a8/815/a85/3a8815a85545fb1c38976ce7c4c96444.png"><br><br>  It turns out quite simple mesh, which does not greatly affect the performance. <br><br>  The complexity of such walls is created in the fact that we have not yet figured out how to build windows, doors, and openings into them.  Curving windows and doors in the program can be, but it does not happen in real life.  But for the construction of balconies, various projections (often in modern homes) curved walls fit perfectly. <br><br>  The use of Boolean operations (see below) will solve this problem.  If there are other real-life ideas or stories about openings, windows, and doors in curved walls, welcome to comments. <br><br>  The intersection of curved walls is calculated a little smarter - and here we must deal with the Delaunay triangulation and the generation of meshes. <br><br><h3>  Delaunay triangulation and figured openings </h3><br>  It is widely known that 3D graphics deal with the approximation of real-world objects using triangles.  In addition, it is intuitively clear that any surface can be approximated by triangles in an infinite number of ways.  Even a polygon with a large number of vertices can be divided into triangles in a very large number of ways. <br><br>  One of the most well-known methods (geometry course for grade 9) is the <a href="http://ru.wikipedia.org/wiki/%25D0%25A2%25D1%2580%25D0%25B8%25D0%25B0%25D0%25BD%25D0%25B3%25D1%2583%25D0%25BB%25D1%258F%25D1%2586%25D0%25B8%25D1%258F_%25D0%2594%25D0%25B5%25D0%25BB%25D0%25BE%25D0%25BD%25D0%25B5">Delaunay triangulation</a> (named not in honor of any Frenchman, but by the name of the Russian mathematician Boris Nikolayevich Delone). <br><br>  Before using triangulation, meshes were generated from rectangular parts.  On the example of a window opening, a rectangle was generated before the window, above and below the window and after the window.  This imposes certain restrictions on the shape of the window itself - for such a method the window can only be square. <br><br>  <i>It was</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/f13/db2/384/f13db2384acee22c20c563ec481de8d1.png"><br><br>  <i>It became</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/b6e/8f6/415/b6e8f64158eecb974d115b28e06fae4b.png"><br><br>  In the case of a rectangular window, the effect is not obvious, but the Delaunay triangulation allowed us to use different shapes, sizes and positions of the holes in the wall. <br><br>  We use triangulation with restrictions.  In this case, the surface is defined by two types of contours: external - specifying external boundaries, and internal - specifying constraints (or, more simply, holes).  There may be several internal circuits. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c08/381/8b9/c083818b9daff60c0a0f106614852295.png"><br><br><h3>  Procedural generation of meshes </h3><br>  As an inquisitive reader managed to understand this section, all the elements in the project, with the exception of the prepared furniture, are generated in the Planoplan on the fly. <br><br>  Straight walls in 2D-mode are generated by six points (two ends of the middle line of the wall and four vertices of a quadrilateral), have a width, length and height. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b5/b03/c3f/6b5b03c3f04f286058e269ab67866240.png"><br><br>  Curved walls in 2D-mode (as we have already described above) are generated by an array of points lying on a quadratic Bezier curve, have width, length and height. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/274/969/2c5/2749692c501f4d5e2851831938fe0255.png"><br><br>  3D walls are generated based on 2D wall data and wall height. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5f9/124/e2e/5f9124e2e60fa6cfe1fd77634137f7ed.png"><br><br>  Holes for windows and doors are generated in the walls and stitched up by the slopes generated along the contour of the hole.  There can be almost any form. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cab/ba5/46a/cabba546af1375cafc6f579a6b918234.png"><br><br>  The floor and ceiling are automatically created by the points describing the given room (see further about the search for rooms).  Delaunay triangulation is used. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/039/28b/b57/03928bb57b6616a87545d82fc283c857.png"><br><br>  For generating contour elements (for example, baseboards), two contours are used - section and path. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3e4/9b2/093/3e49b2093a68659e8f9e53ad7b6871cc.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/f9f/93f/6be/f9f93f6bead60ca4977878e227659657.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/a3f/657/7f1/a3f6577f11f345b269351fb1a9bbf1cd.jpg"><br><br><h3>  Meshing (boolean) </h3><br>  The task of our Jedi from school geometry today is the implementation of Boolean operations for calculating the intersection of surfaces in three-dimensional space (for example, for curved zoning of curved walls).  At the moment, Boolean operations are used only to create a render of an apartment with cut walls, like this. <br><img src="https://habrastorage.org/getpro/habr/post_images/3b4/5e0/b66/3b45e0b66779e5d148515f2a0851919f.png"><br><br>  Here‚Äôs how it looks in theory: <br><img src="https://habrastorage.org/getpro/habr/post_images/163/3bc/c6a/1633bcc6add8ce584c63570409498066.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/913/17d/e78/91317de78cda5ac76fd2072c0e3aaed7.jpg"><br><br>  And here is the current development in practice. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ef/9ec/3a4/8ef9ec3a48682587c3c5471bcad2df02.png"><br><br>  In the future, it is planned to introduce boolean operations everywhere, which will allow us to place windows and doors without any restrictions (for example, you can easily place a window above the window, or a window above the door, take out the window to the edge of the wall, arrange the window at the junction of walls, etc.) .  It will also allow us to create holes in the floor and ceiling for the realization of stairways or to embed elements such as a sink into absolutely any worktop, simply cutting a hole in it. <br><br>  In the future, it is planned to implement the placement of windows and doors directly in 3D-mode. <br><br><h3>  Search for rooms </h3><br>  For a snack, from simple algorithms, in Planoplan, an automatic search for rooms is implemented, which allows the user to remove the job of manually setting them.  For example, if the user creates a closed loop of the walls, the floor and ceiling are created in Planoplan automatically.  This allows the user to build an apartment ‚Äúwall by wall‚Äù rather than modify the base square of the room. <br><br>  The search is implemented recursively, based on connections between points (walls) using the right-by-round method. <br><br><div class="spoiler">  <b class="spoiler_title">8 steps with pictures</b> <div class="spoiler_text">  1. Build walls and points. <br><img src="https://habrastorage.org/getpro/habr/post_images/931/ce1/45b/931ce145bc469c9222996d4e72a5679f.png"><br><br>  2. We begin the search for a closed loop with one of the walls. <br><img src="https://habrastorage.org/getpro/habr/post_images/579/d8c/9e9/579d8c9e9952136b4671a145b02978d3.png"><br><br>  3. Proceeding from the connections between the points, we proceed to the rightmost (in the corners) wall at the second point of the selected wall. <br><img src="https://habrastorage.org/getpro/habr/post_images/c6c/b70/439/c6cb704399558de59b7b7a5c071cced6.png"><br><br>  4. Then we go on until we stop at the initial wall. <br><img src="https://habrastorage.org/getpro/habr/post_images/ae4/3b6/dcc/ae43b6dccce9a390a7fb50473cc93879.png"><br><br>  5. Create a room. <br><img src="https://habrastorage.org/getpro/habr/post_images/735/98e/1d0/73598e1d039a424ee20197adbc041200.png"><br><br>  6. Go to the search for the next room.  There, as you can see, there is a trick with dead-end walls.  We simply find a wall that has no continuation, and mark it with a dead end.  Go back a step and look for the next right wall, excluding dead ends. <br><img src="https://habrastorage.org/getpro/habr/post_images/2ee/485/0a9/2ee4850a9de176b4226eccf9995b24a8.png"><br><br>  One more step back. <br><img src="https://habrastorage.org/getpro/habr/post_images/950/10f/90c/95010f90c3bcb70af68699fe4d50f878.png"><br><br>  7. Go ahead ... <br><img src="https://habrastorage.org/getpro/habr/post_images/c89/6c9/251/c896c9251cfabdee8c8a0b7719eb93d4.png"><br><br>  ... until we close the loop again. <br><img src="https://habrastorage.org/getpro/habr/post_images/74a/829/0a5/74a8290a5a4e5907a0bdc12bc0ee33cd.png"><br><br>  8. This completes the search.  All contours found. <br><br>  It should be said about a couple of nuances. <br><ul><li>  We go through the walls and exclude from the further search those that are dead-end, as well as those that already consist in two closed contours. </li><li>  In the course of the search, we find the external circuit, which includes all the rooms.  We also exclude it. </li></ul></div></div><br><h3>  I want to know more! </h3><br>  Our management and Unity-fighters in the person of Anton <a href="http://habrahabr.ru/users/jagahee/" class="user_link">Jagahee</a> Karpuntsova will perform a story about Planoplan at the <a href="http://www.cgevent.ru/">CG Event</a> on December 1 at 14:30 (Moscow, Holiday Inn Sokolniki, Chistye Prudy hall).  Come see, ask questions, chat with developers and twist in the hands of Oculus Rift. <br><br>  On the basis of a speech at the CG Event, in the next article in the series we will tell you how server-side rendering of user images is arranged in Planoplan. </div><p>Source: <a href="https://habr.com/ru/post/203866/">https://habr.com/ru/post/203866/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../203852/index.html">University timetable s01e02: Windows phone, mobile site and how to help us</a></li>
<li><a href="../203858/index.html">ScienceHub # 08: Neural Interfaces</a></li>
<li><a href="../203860/index.html">Overview interface service PrettyTasks</a></li>
<li><a href="../203862/index.html">Released Yandex.Navigator and SpeechKit for Windows Phone</a></li>
<li><a href="../203864/index.html">Why it is worth using special classes for event binding</a></li>
<li><a href="../203868/index.html">Object-Oriented Business: How a Franchise Works</a></li>
<li><a href="../203872/index.html">Microsoft has released a program for seamless looping animation.</a></li>
<li><a href="../203874/index.html">Key indicators of customer service quality in the retail and service industries</a></li>
<li><a href="../203876/index.html">Curiosity rover fully recovered after electrical system failure</a></li>
<li><a href="../203878/index.html">How to become a "big fish" in the sea of ‚Äã‚Äãmobile applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>