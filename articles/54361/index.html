<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Calculation of periods of experience in MySQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At one forum they asked a question about how to correctly calculate the difference in dates in MySQL to account for the experience of an employee. At ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Calculation of periods of experience in MySQL</h1><div class="post__text post__text-html js-mediator-article">  At one forum they asked a question about how to correctly calculate the difference in dates in MySQL to account for the experience of an employee.  At first glance, the question turned out to be simple, but on closer examination, everything turned out to be much more interesting. <br><a name="habracut"></a><br><h4>  Problem </h4>  To begin with, I spoke with a couple of familiar personnel officers and asked them about how, in our country, it is considered to be the period of insurance service of an employee.  As it turned out not so simple.  According to the legislation, periods of service are considered as follows: every 30 days are converted into months, and every 12 months - into years.  But nevertheless, accounting for insurance experience according to a different scheme is widespread - full months and years are counted as they are, and the days that make up the incomplete initial and final months are added up and converted into months of 30 days.  That's about the release of the latter method, and I want to tell. <br><br><h4>  Decision </h4>  I decided to design this algorithm as a stored function with two input parameters - the start and end date.  The result of the work will be the string dd.mm.yy, although for the date difference the format ‚Äúy years, m months, d days‚Äù is better suited.  Formation of a readable line, I oputil in this topic in order to save space and not be distracted by trivial tasks.  I have broken all possible variations of input parameters into two cases: the first - the dates are in one month, and the second - in different.  In the first case, the date difference will be simply transferred to the days.  In the second case, it is necessary to calculate the difference in months between the dates (minus one month), as well as the sum of the days missing in the beginning of the month in the starting date and the day of the month in the ending date.  The code is: <br><blockquote><code><font color="black"><font color="#990099">CREATE</font> <font color="#990099">FUNCTION</font> <font color="#008000">`fNaturalDateDiff`</font> <font>(</font> iStartDate <font color="#999900">DATE</font> <font color="#000033">,</font> iFinalDate <font color="#999900">DATE</font> <font>)</font> <br> <font color="#990099">RETURNS</font> <font color="#999900">varchar</font> <font>(</font> <font>255</font> <font>)</font> <br> <font color="#990099">DETERMINISTIC</font> <br> <font color="#990099">CONTAINS SQL</font> <br> <font color="#990099">SQL SECURITY</font> <font color="#990099">DEFINER</font> <br> <font color="#990099">COMMENT</font> <font color="#008000">''</font> <br> <font color="#990099">BEGIN</font> <br> <font color="#990099">DECLARE</font> aDays <font color="#000033">,</font> aMonths <font color="#999900">INTEGER</font> <font color="#000033">;</font> <br> <br> <font color="#009900">IF</font> <font color="#000099">DATE_FORMAT</font> <font>(</font> iStartDate <font color="#000033">,</font> <font color="#008000">' <font color="#008080">%</font> Y <font color="#008080">%</font> m'</font> <font>)</font> <font color="#CC0099">=</font> <font color="#000099">DATE_FORMAT</font> <font>(</font> iFinalDate <font color="#000033">,</font> <font color="#008000">' <font color="#008080">%</font> Y <font color="#008080">%</font> m'</font> <font>)</font> <font color="#009900">THEN</font> <br> <font color="#990099">SET</font> aDays <font color="#CC0099">=</font> <font color="#000099">DATEDIFF</font> <font>(</font> iFinalDate <font color="#000033">,</font> iStartDate <font>)</font> <font color="#CC0099">+</font> <font>1</font> <font color="#000033">;</font> <br> <font color="#990099">SET</font> aMonths <font color="#CC0099">=</font> 0 <font color="#000033">;</font> <br> <font color="#009900">ELSE</font> <br> <font color="#990099">SET</font> aDays <font color="#CC0099">=</font> <font color="#000099">DATEDIFF</font> <font>(</font> <font color="#000099">LAST_DAY</font> <font>(</font> iStartDate <font>)</font> <font color="#000033">,</font> iStartDate <font>)</font> <font color="#CC0099">+</font> <font color="#000099">DAYOFMONTH</font> <font>(</font> iFinalDate <font>)</font> <font color="#CC0099">+</font> <font>1</font> <font color="#000033">;</font> <br> <font color="#990099">SET</font> aMonths <font color="#CC0099">=</font> <font color="#000099">PERIOD_DIFF</font> <font>(</font> <font color="#000099">DATE_FORMAT</font> <font>(</font> iFinalDate <font color="#000033">,</font> <font color="#008000">' <font color="#008080">%</font> Y <font color="#008080">%</font> m'</font> <font>)</font> <font color="#000033">,</font> <font color="#000099">DATE_FORMAT</font> <font>(</font> iStartDate <font color="#000033">,</font> <font color="#008000">' <font color="#008080">%</font> Y <font color="#008080">%</font> m'</font> <font>)</font> <font>)</font> <font color="#CC0099">-</font> <font>1</font> <font color="#000033">;</font> <br> <font color="#009900">END</font> <font color="#009900">IF</font> <font color="#000033">;</font> <br> <font color="#990099">SET</font> aMonths <font color="#CC0099">=</font> aMonths <font color="#CC0099">+</font> aDays <font color="#CC0099">DIV</font> <font>30</font> <font color="#000033">;</font> <br> <font color="#990099">SET</font> aDays <font color="#CC0099">=</font> aDays <font color="#CC0099">%</font> <font>30</font> <font color="#000033">;</font> <br> RETURN <font color="#000099">CONCAT</font> <font>(</font> <font color="#000099">LPAD</font> <font>(</font> aDays <font color="#000033">,</font> <font>2</font> <font color="#000033">,</font> <font color="#008000">'0'</font> <font>)</font> <font color="#000033">,</font> <font color="#008000">'.'</font> <font color="#000033">,</font> <font color="#000099">LPAD</font> <font>(</font> aMonths <font color="#CC0099">%</font> <font>12</font> <font color="#000033">,</font> <font>2</font> <font color="#000033">,</font> <font color="#008000">'0'</font> <font>)</font> <font color="#000033">,</font> <font color="#008000">'.'</font> <font color="#000033">,</font> <font color="#000099">LPAD</font> <font>(</font> aMonths <font color="#CC0099">DIV</font> <font>12</font> <font color="#000033">,</font> <font>2</font> <font color="#000033">,</font> <font color="#008000">'0'</font> <font>)</font> <font>)</font> <font color="#000033">;</font> <br> <font color="#009900">END</font> <font color="#000033">;</font></font></code> <br> </blockquote><br><h4>  Second question </h4>  In order to find out one working period, this function is quite enough, but what to do if you need to calculate the sum of several working periods using the same algorithm.  To do this, you will need to do three stored procedures: the first (fCountFullMonths) will deduct the number of complete months in the specified period, the second (fCountCutOffDays) will deduct the number of days unaccounted for by the first function (at the beginning and end of the period), and the third ( fFormatPeriod) - will take the number of months as the first parameter and the number of days as the second, and will format this data into a string convenient for output, taking into account the translation of every 30 days into months, and 12 months into years . <br>  With these functions, it is not difficult to calculate the total experience of an employee: <br><blockquote> <code><font color="black"><font color="#990099">SELECT</font> Person <font color="#000033">,</font> fFormatPeriod <font>(</font> <font color="#000099">SUM</font> <font>(</font> fCountFullMonths <font>(</font> StartDate <font color="#000033">,</font> EndDate <font>)</font> <font>)</font> <font color="#000033">,</font> <font color="#000099">SUM</font> <font>(</font> fCountCutOffDays <font>(</font> StartDate <font color="#000033">,</font> EndDate <font>)</font> <font>)</font> <font>)</font> <font color="#990099">FROM</font> experience <font color="#990099">WHERE</font> Person <font color="#CC0099">=</font> ...</font></code> <br> </blockquote>  I will not give here the implementation of these functions, since  it is easy to compose them by ‚Äúdisassembling into pieces‚Äù the function above. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/54361/">https://habr.com/ru/post/54361/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../54354/index.html">Compress Psd Files</a></li>
<li><a href="../54356/index.html">rumors with pictures: Wacom Intuos 4</a></li>
<li><a href="../54357/index.html">Competition "Internet Mathematics 2009"</a></li>
<li><a href="../54358/index.html">[Interview] They did Dracula!</a></li>
<li><a href="../54359/index.html">Friday's light humor from WebDesignerDepot</a></li>
<li><a href="../54362/index.html">PDFVue: PDF annotation from browser</a></li>
<li><a href="../54364/index.html">VKontakte and SPAM DETECTED</a></li>
<li><a href="../54367/index.html">Program life cycle</a></li>
<li><a href="../54369/index.html">How to draw the ‚ÄúLada‚Äù sign if there is no computer at hand</a></li>
<li><a href="../54372/index.html">A bit of search humor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>