<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple Inter-Process Communication in C #</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the beginning of my work as a junior developer, I had to deal with such an incomprehensible for me at that time concept like Inter-Process Communic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple Inter-Process Communication in C #</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/177/c74/de1/177c74de1b67e3989c88e5baa9e8d64f.png" alt="image" align="right"><br>  At the beginning of my work as a junior developer, I had to deal with such an incomprehensible for me at that time concept like Inter-Process Communication.  It was a complete wildness for a novice programmer, who, within the framework of the logic of one application, was guided with great difficulty.  It is worth mentioning that the project is written in Delphi, and the IPC mechanism itself is implemented using File Mapping and Windows Messages. <br>  What is surprising, I learned how this whole system works from the inside, after almost a year, when I had to tinker a little with it.  And only then I finally realized how high-level its implementation was, and the API was convenient.  Who is interested in the implementation of something similar to the above system under C # - please under the cat. <br><a name="habracut"></a><br>  Since in my free time I study the .NET Framework, I was interested in how easily / conveniently implemented IPC on .NET.  To my own disappointment, I realized that the functionality from the box is significantly inferior to the convenience and simplicity of the handicraft Delphi system.  Here you can make a good holivar of this kind, relying on the fact that .NET is focused on abstracting from the data transfer channel and allows you to fumble objects equally well across the network and between processes.  But since the topic of the article is IPC, I will ask not to do this. <br><br>  A little introduction.  I was not able to fully understand all the tricks of IPC on .NET, but having <s>smoked manuals after</s> reading the thematic articles, I realized that it‚Äôs realistic to use the following options: <br>  1. com, <br>  2. File Mapping, <br>  3. IPC Channels. <br>  Since the implementation using COM or File Mapping will differ little from analogs in other languages, the choice clearly fell on the built-in IPC mechanism for .NET. <br><br>  After trying to write a little bit of a functional application, I realized that even the transmission of a simple string using it requires unnecessary gestures on both applications, both in the sender and in the receiver.  As a result, for the object balls between processes it is necessary to do something like: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Server: <br><pre><code class="cs hljs">IpcChannel serverChannel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IpcChannel(<span class="hljs-string"><span class="hljs-string">"MyServerChannel"</span></span>); ChannelServices.RegisterChannel(serverChannel); RemotingConfiguration.RegisterWellKnownServiceType( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(IPCChannelRemoting.MyRemoteObject), <span class="hljs-string"><span class="hljs-string">"SharedObj"</span></span>, WellKnownObjectMode.SingleCall);</code> </pre> <br>  Customer: <br><pre> <code class="cs hljs">IpcChannel clientChanel = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IpcChannel(<span class="hljs-string"><span class="hljs-string">"myClient"</span></span>); ChannelServices.RegisterChannel(clientChanel); ISharedObj obj = (Remoteable.ISharedAssemblyInterface)Activator.GetObject( <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(Remoteable.ISharedAssemblyInterface), <span class="hljs-string"><span class="hljs-string">"ipc://MyServerChannel/SharedObj "</span></span>);</code> </pre><br>  But what if the data exchange is to be used everywhere in the application?  In this case, you will have to duplicate the code throughout the descriptions above and specify the rules for creating URIs for shared objects.  And if it is necessary not only to request data from another process, but also to subscribe to receive some kind of signal / message?  You can make a thread / timer that loops in a validation loop or use WaitForSingleObject / EventWaitHandle.  In general, there is no longer do without personally created architecture. <br><br>  From previous experience in developing an application that makes extensive use of IPC mechanisms, it is very convenient to use the following approach: <br>  - there are three main entities: the sender, the recipient and the message; <br>  - each recipient and sender has their own unique ID, which is the sending of messages.  They can be tied to the PID of the application, the window handle or any well-known identifier that is known to both parties; <br>  - a message is an abstract concept that can contain fields of any * type, be synchronous or asynchronous.  Applications that exchange these messages should be aware of specific classes that are descendants of basic messages.  The difference between synchronous and asynchronous messages is that in a synchronous message you can put the result of the request, if necessary, and it will be available to the sender immediately after processing the message (by returning the stack from calling the sending method). <br><br>  As a result, using the resulting system, sending data between processes is reduced to <br>  - create sender objects and messages, <br>  - sending messages using the sender, <br>  - its processing in the process of the recipient. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (BaseIPCDispatcher dispatcher = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BaseIPCDispatcher(slaveReceaverGUID)) { TestAsyncComplexMessage testMessage = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestAsyncComplexMessage (ReceaverID, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); dispatcher.Dispatch(testMessage); }</code> </pre><br>  Subscribing to a message in another, or the same process: <br><br><pre> <code class="cs hljs">‚Ä¶ Receiver.OnReceaveIPCMessage += OnReceaveMessage; ‚Ä¶ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnReceaveMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, ReceaveMessageEventArgs e</span></span></span><span class="hljs-function">)</span></span> { TestAsyncComplexMessage testAsyncMessage = e.Message <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TestAsyncComplexMessage; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (testAsyncMessage != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// process message } }</span></span></code> </pre><br>  IMHO, it turned out a little more obvious, flexible and readable.  The code is covered in functional tests using the Master / Slave architecture. <br><br>  Who wants to get acquainted - the result is on GitHub <br>  <a href="https://github.com/perevernihata/SimpleIPCCommSystem">github.com/perevernihata/SimpleIPCCommSystem</a> <br>  ZY  I understand that maybe I unknowingly invented my bike with square wheels, but it's really damn interesting to do!  Constructive criticism is welcome. <br><br>  * (Serializable for asynchronous messages). </div><p>Source: <a href="https://habr.com/ru/post/187172/">https://habr.com/ru/post/187172/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../187162/index.html">Just5 Brick Presentation: How I Met Thomofon + Answers to Habroid Questions</a></li>
<li><a href="../187164/index.html">HttpRequest - a library for easy work with the HTTP protocol</a></li>
<li><a href="../187166/index.html">Sound transmission through pictures in social networks</a></li>
<li><a href="../187168/index.html">Small office scan optimization</a></li>
<li><a href="../187170/index.html">Sony is preparing a camera that connects to the smartphone</a></li>
<li><a href="../187176/index.html">Map with projections from Proj4js to Canvas</a></li>
<li><a href="../187178/index.html">Symfony2 subscribe to dynamic events</a></li>
<li><a href="../187182/index.html">Using XML on the example of offline work with documents</a></li>
<li><a href="../187184/index.html">A selection of useful for fans of Twitter Bootstrap</a></li>
<li><a href="../187186/index.html">Overview of the @to Music mobile app for the Android platform</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>