<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ray Tracer of four-dimensional space</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently I did a simple raytracer of 3-dimensional scenes. It was written in JavaScript and was not very fast. For fun, I wrote a raytracer on C and m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ray Tracer of four-dimensional space</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage/a11620ee/5134132f/c2478695/2049fcc7.jpg" alt="TitlePic"><br><br>  Recently I did a simple raytracer of 3-dimensional scenes.  It was written in JavaScript and was not very fast.  For fun, I wrote a raytracer on C and made him a 4-dimensional rendering mode - in this mode, he can project a 4-dimensional scene on a flat screen.  Under the cat you will find several videos, some pictures and a raytracer code. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Why write a separate program for drawing a 4-dimensional scene?  You can take a regular raytracer, slip him a 4D scene and get an interesting picture, but this picture will not be a projection of the whole scene on the screen.  The problem is that the scene has 4 dimensions, and the screen is only 2 and when the raytracer starts the rays through the screen, it covers only the 3-dimensional subspace and the screen will only see a 3-dimensional cut of the 4-dimensional scene.  A simple analogy: try to project a 3-D scene onto a 1-D segment. <br><br>  It turns out that a 3-dimensional observer with 2-dimensional vision cannot see the entire 4-dimensional scene - at best, he will see only a small part.  It is logical to assume that the 4-dimensional scene is more convenient to look at with 3-dimensional vision: a certain 4-dimensional observer looks at an object and on its 3-dimensional retinal analogue a 3-dimensional projection is formed.  My program will rayten this three-dimensional projection.  In other words, my raytracer depicts what a 4-dimensional observer sees with his 3-dimensional vision. <br><br><h4>  Features 3-dimensional view </h4><br><br>  Imagine that you are looking at a circle of paper that is right in front of your eyes - in which case you will see a circle.  If this circle is put on the table, then you will see an ellipse.  If you look at this circle from a distance, it will appear smaller.  Similarly for three-dimensional vision: a four-dimensional ball will appear to the observer as a three-dimensional ellipsoid.  Below are a couple of examples.  On the first, 4 identical mutually perpendicular cylinders rotate.  On the second, the framework of a 4-dimensional cube rotates. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/I2pPfNZ5LwY%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhjS3lc6Fn4sHeuiUZLsr6AchZiagg" frameborder="0" allowfullscreen=""></iframe><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/YhuXzTDqWG4%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhhCQC_5mk4znSdVe60HtJBTmvYCQw" frameborder="0" allowfullscreen=""></iframe><br><br><img src="https://habrastorage.org/storage/768f95a7/71c150db/c87f65c6/d16d743f.jpg" alt="Cube4d"><br><br>  Let's go to the reflections.  When you look at a ball with a reflective surface (a Christmas-tree toy, for example), the reflection is drawn on the surface of the sphere.  Also for 3-dimensional view: you look at a 4-dimensional ball and reflections are drawn as if on its surface.  Only here the surface of a 4-dimensional ball is three-dimensional, so when we look at a 3-dimensional projection of a ball, the reflections will be inside, not on the surface.  If we make the reystrayser release the beam and find the nearest intersection with the 3-dimensional projection of the ball, we will see a black circle - the surface of the three-dimensional projection will be black (this follows from Fresnel formulas).  It looks like this: <br><br><img src="https://habrastorage.org/storage/3dc7eae8/5cf606a1/9c0391f9/8933c54c.jpg" alt="ReflectionFirstHit"><br><br>  For 3D, this is not a problem, because the whole 3-D ball is visible to it and the internal points are visible as well as those on the surface, but I need to somehow convey this effect on a flat screen, therefore I made an additional Raytracer mode when he considers that three-dimensional objects are smoky: the beam passes through them and gradually loses energy.  It turns out like this: <br><br><img src="https://habrastorage.org/storage/22a80896/ab8be25c/4bd45fe1/a327ef91.jpg" alt="image"><br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/hqbM65sT2bU%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhhHTlj1--xIvMUyT4PRI1urcmKHmg" frameborder="0" allowfullscreen=""></iframe><br><br>  The same is true for shadows: they do not fall to the surface, but inside 3-dimensional projections.  It turns out that inside a 3-dimensional ball - a projection of a 4-dimensional ball - there can be a darkened area in the form of a projection of a 4-dimensional cube, if this cube casts a shadow on the ball.  I haven't figured out how to convey this effect on a flat screen. <br><br><h4>  Optimization </h4><br><br>  Raytrasit 4-dimensional scene is more complicated than 3-dimensional: in the case of 4D you need to find the colors of the three-dimensional area, and not the flat.  If you write a raytracer "in the forehead", its speed will be extremely low.  There are a couple of simple optimizations that can reduce the rendering time of a 1000 √ó 1000 image to a few seconds. <br><br>  The first thing that catches your eye when looking at such pictures is a bunch of black pixels.  If you depict an area where a raytracer ray hits at least one object, it will turn out like this: <br><br><img src="https://habrastorage.org/storage/29a642e8/5289f4d5/8d176242/051378e5.jpg" alt="Map"><br><br>  It can be seen that about 70% are black pixels, and that the white area is connected (it is connected because the 4-dimensional scene is connected).  You can calculate pixel colors not in order, but guess one white pixel and make a fill from it.  This will only tracerays white pixels + some black pixels that represent the 1-pixel border of the white area. <br><br>  The second optimization is obtained from the fact that the figures - balls and cylinders - are convex.  This means that for any two points in such a figure, the segment connecting them also lies entirely inside the figure.  If the beam intersects a convex object, while point A lies inside the object and point B is outside, then the remainder of the beam from side B will not cross the object. <br><br><h4>  Some more examples </h4><br><br>  Here the cube rotates around the center.  The ball of the cube does not apply, but on a 3-dimensional projection they can intersect. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/fTfnElgE4VM%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhiBCqbxrTzgkBx_oyJfZy2hCzld8A" frameborder="0" allowfullscreen=""></iframe><br><br>  In this video, the cube is stationary, and a 4-dimensional observer flies through the cube.  That 3-dimensional cube that seems larger is closer to the observer, and the smaller one is further. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/ekrZF9iBZnQ%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhhVOYvGX5TBeJdt-5fdTQLQlciV1Q" frameborder="0" allowfullscreen=""></iframe><br><br>  Below is the classic rotation in the planes of axes 1-2 and 3-4.  Such a rotation is given by the product of two Givens matrices. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/idvwTqcvGjo%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhiWQTmI2gtikVSOKe1IVtBhayxvRA" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  How does my raytracer </h4><br><br>  The code is written in ANSI C 99. You can download it <a href="">here</a> .  I checked on ICC + Windows and GCC + Ubuntu. <br><br>  The program accepts a text file with a scene description as input. <br><br><pre><code class="hljs mel">scene = { objects = -- list of objects <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the scene { <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> -- <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> of objects can have an assigned affine transform { axiscyl1, axiscyl2, axiscyl3, axiscyl4 } }, lights = -- list of lights { light{{<span class="hljs-number"><span class="hljs-number">0.2</span></span>, <span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-number"><span class="hljs-number">0.4</span></span>, <span class="hljs-number"><span class="hljs-number">0.7</span></span>}, <span class="hljs-number"><span class="hljs-number">1</span></span>}, light{{<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>}, <span class="hljs-number"><span class="hljs-number">1</span></span>}, } } axiscylr = <span class="hljs-number"><span class="hljs-number">0.1</span></span> -- <span class="hljs-keyword"><span class="hljs-keyword">cylinder</span></span> radius axiscyl1 = <span class="hljs-keyword"><span class="hljs-keyword">cylinder</span></span> { {<span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, axiscylr, material = {<span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}} } axiscyl2 = <span class="hljs-keyword"><span class="hljs-keyword">cylinder</span></span> { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, axiscylr, material = {<span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}} } axiscyl3 = <span class="hljs-keyword"><span class="hljs-keyword">cylinder</span></span> { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, axiscylr, material = {<span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>}} } axiscyl4 = <span class="hljs-keyword"><span class="hljs-keyword">cylinder</span></span> { {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>}, axiscylr, material = {<span class="hljs-keyword"><span class="hljs-keyword">color</span></span> = {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}} }</code> </pre> <br><br>  Then parsit this description and creates a scene in its internal presentation.  Depending on the dimension of space, it renders a scene and gets either a four-dimensional image as above in the examples, or a regular three-dimensional one.  To turn a 4-dimensional raytracer into a 3-dimensional one, you need to change the vec_dim parameter from 4 to 3 in the vector.h file. You can also set it in the command line parameters for the compiler.  Compilation in GCC: <br><br> <code>cd /home/ <u>username</u> /rt/ <br> gcc -lm -O3 *.c -o rt <br></code> <br><br>  Test run: <br><br> <code>/home/ <u>username</u> /rt/rt cube4d.scene cube4d.bmp <br></code> <br><br>  If you compile the raytracer with vec_dim = 3, then it will give out a regular <a href="">cube</a> for the cube3d.scene scene. <br><br><h4>  How to make a video </h4><br><br>  For this, I wrote a script on Lua which for each frame calculated the rotation matrix and added it to the reference scene. <br><br><pre> <code class="hljs cs">axes = { {<span class="hljs-number"><span class="hljs-number">0.933</span></span>, <span class="hljs-number"><span class="hljs-number">0.358</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, -- axis <span class="hljs-number"><span class="hljs-number">1</span></span> {<span class="hljs-number"><span class="hljs-number">-0.358</span></span>, <span class="hljs-number"><span class="hljs-number">0.933</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>}, -- axis <span class="hljs-number"><span class="hljs-number">2</span></span> {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0.933</span></span>, <span class="hljs-number"><span class="hljs-number">0.358</span></span>}, -- axis <span class="hljs-number"><span class="hljs-number">3</span></span> {<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-0.358</span></span>, <span class="hljs-number"><span class="hljs-number">0.933</span></span>} -- axis <span class="hljs-number"><span class="hljs-number">4</span></span> } scene = { objects = { <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> { axes = axes, axiscyl1, axiscyl2, axiscyl3, axiscyl4 } }, }</code> </pre><br><br>  The group object in addition to the list of objects has two affine transformation parameters: axes and origin.  By changing the axes you can rotate all the objects in the group. <br><br>  Then the script called the compiled raytracer.  When all the frames were rendered, the script called the mencoder and he collected video from individual images.  The video was made in such a way that it could be put on auto-repeat - i.e.  the end of the video is the same as the beginning.  The script runs like this: <br><br> <code>luajit animate.lua <br></code> <br><br>  And finally, in <a href="">this archive there are</a> 4 avi files 1000 √ó 1000.  All of them are cyclic - you can put on auto-repeat and you get a normal animation. </div><p>Source: <a href="https://habr.com/ru/post/114698/">https://habr.com/ru/post/114698/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../114693/index.html">Samsung 9 series / 7 series at the exhibition in Budapest</a></li>
<li><a href="../114694/index.html">Hello, we are looking for speakers!</a></li>
<li><a href="../114695/index.html">Radically redesigned Evernote 4 for iPhone and iPod Touch</a></li>
<li><a href="../114696/index.html">Web analytics from Avinash Koshyk</a></li>
<li><a href="../114697/index.html">To a conference on MeeGo</a></li>
<li><a href="../114699/index.html">Installing symfony on VDS / FreeBSD</a></li>
<li><a href="../114700/index.html">Game Boy games on an oscilloscope</a></li>
<li><a href="../114701/index.html">Qt Mobility 1.1.1, QtCreator 2.1.0, Qt 4.7.2</a></li>
<li><a href="../114702/index.html">The European Union imposed a temporary ban on the importation of PS3 in Europe</a></li>
<li><a href="../114703/index.html">Books in the Web 2.0 era</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>