<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Panoramas: fast or high quality? Both!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 The article will be for fans of photopans. Shooting and glue panoramas - this is my hobby, the occupation is dusty, fascinating and, importan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Panoramas: fast or high quality? Both!</h1><div class="post__text post__text-html js-mediator-article"><h4>  Hello! </h4><br>  The article will be for fans of photopans.  Shooting and glue panoramas - this is my hobby, the occupation is dusty, fascinating and, importantly, with a spectacular result.  I mean that when I demonstrate ready-made panoramas to my acquaintances (non-specialists), then there are no indifferent ones. <a name="habracut"></a>  Unlike, say, from philatelic hobby - once a classmate showed a collection of "Daddy Stamps", the viewing experience was depressing: I didn‚Äôt like the funeral of faded pieces of paper between the sheets of the album with thick cardboard pages.  Either the collection was not a fountain, or (more likely) the taste and color, we were far from comrades with my classmate's dad. <br><br>  Uh ... well, yes, panoramas.  Hobby <b>_voobsche_</b> , in my understanding, the occupation is a relaxing, rather pleasant pastime, but after the collection of the first trial series <b>__particle_</b> I was haunted by the idea that although it is certainly pleasant, it looks more like killing this very time in my performance.  (I want to draw your attention to these, at first glance, not noticeable words ‚Äúin my performance‚Äù, all that will be described further - will mainly concern my experience. If other normal people have sharply different results for the better, then let me link there, and I will be grateful to you.) <br><br><h4>  Handwork </h4><br>  For further reasoning, you need to arm yourself with some source data - for example, a spherical panorama requires about 96 frames with a 48mm lens, which stretches the shooting process for an hour or more.  Hour shooting can be quite fascinating to yourself - say, a session for posters with the participation of nice looking people of the opposite sex, but as far as panoramas are concerned, everything is completely different.  Who tried to shoot the panel manually knows that this process is more mechanical than creative.  Indeed: you jump around a tripod with a camera like an abnormal one, fully concentrating on turning the device to the desired angle and pressing the button so as not to get a ‚Äújig‚Äù.  And so 96 times.  And this is for one panorama (and still manage not to forget to take a picture under a tripod - otherwise it will turn out far from camille).  Why so much?  Because it is necessary.  Now I will explain at the moment.  It just so happened that I put the first experiments on the camera with the name of a friend of Panasonic, with a 24mm lens at cropping 2, which resulted in 48 equivalent millimeters per full frame.  With an equivalent focal length of 48mm, the lens sees 41.1 degrees horizontally and 28.1 vertically (for a 3: 2 aspect ratio).  To shoot a spherical panorama horizontally, you need to make (360 / 41.1) + 30% = 12 frames rounded.  That is, every 30 degrees .. And vertically (180 / 28.1) + 30% = 9. The overlap of 30% in height and width of adjacent frames was read in the Internet, and is intended to facilitate the process of pasting the panorama. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Taking into account the fact that the ‚Äútopmost floor‚Äù as well as the ‚Äúbottommost‚Äù is just one frame (it can of course be photographed 12 times with chamomile, but it may be like another time), it turns out that 7 floors of 12 yes plus anti-aircraft and nadir snapshots.  Total 96 frames.  Since it is impossible to ‚Äúbroaden‚Äù the existing lens - someone else‚Äôs camera was taken with the words ‚ÄúI‚Äôll just look and give it away‚Äù, and it would be unbearable to reduce this wild 96, there were only a few options left, or rather one: you need to devalue 30%.  In fact, after all, 1.3 horizontally multiplied by 1.3 vertically gives an excess area of ‚Äã‚Äã69%, that is, out of 96 frames, most of them will be cropped when glued together.  Here I will omit the matershinnye details on shooting and gluing very tightly, but the meaning is the following: mathematics is good when in pencil on paper, and ruthless practice suggests that the decision to devaluate the overlap was arrogant and erroneous, therefore leaving 96 frames did not work.  Gluing these 96 frames by the amount of pleasure corresponds to the hobbies of those strange monks who beat themselves with whips and sing songs. <br><br>  For assembling panoramas, I use the PTGui program - it has the most convenient interface for hand gluing.  It would not have been advertised, no matter how much the experienced and not so great producers of software for panoramas would boast, but so far I have not met programs that can be glued on the machine without any complaints.  Yes - there is an automatic mode, yes - it works, but the quality of such an assembly lies somewhere at the level of google-street.  To the poet, if we are talking about a good, good-quality panorama, alas, it does not work out to avoid manual work. <br><br>  The idea of ‚Äã‚Äãthe amount of work can be counted on the fingers: each frame has 4 sides to glue together with its neighbors, on each side in theory you need to put 4-5 points, in fact, about 10.  Otherwise, a reproduction on the imperishable Salvador Dali is likely to be obtained.  How long does it take to set up one pair of points on adjacent frames?  If you ‚Äútune in‚Äù and click the mouse methodically like a robot, then I get about 3-4 seconds for a couple of points.  All together gives about 3-4 hours to build one panorama.  It's horrible. <br><br><h4>  How to live on? </h4><br>  In theory, the time spent in any process can be simply represented as the product of the number of elementary operations and the speed of this elementary operation.  So there are two ways to reduce the time spent: <br><ul><li>  reducing the number of iterations </li><li>  reduction of time for one operation </li></ul><br>  in the case of panoramas, this means that we must strive to reduce the number of shots and to accelerate the processing of each individual picture.  Strange as it may seem, but both tasks are overcome with the help of one technical solution - you need to shoot panoramas according to a template.  Because if the geometry of one set is indistinguishable from the geometry of another set, then it is enough to reduce only one control set of frames and all the other panoramas are collected only by replacing the original images and do not require re-installation of key points.  And for this, in the process of shooting, you always need to turn the camera absolutely exactly.  But man can not do this.  But here the robot can.  Therefore, I began assembling the apparatus for shooting panoramas. <br><br><h4>  Materiel </h4><br>  The following items were purchased for the device: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/be7/762/67d/be776267d74d8c6d3287a19f80f10c5f.jpg" alt="Arduino"><br>  electronic toy for not very adults - Arduino <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/eb9/1ec/ba4/eb91ecba43fba32cc10f8c20defa3b94.jpg" alt="L298"><br>  Stepper motors control modules compatible with it - 2 pieces <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/22b/863/fc0/22b863fc03cd74c16608675f6262225e.jpg" alt="Stepper"><br>  three stepper motors (one of them is spare) <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/198/6ea/d85/1986ead851e0bc461c02928b80332ae8.jpg" alt="Tchugunij"><br>  a piece of aluminum (600x150x10mm) from which in my school a man in a blue robe cut out blanks for a frame according to my drawings <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/c03/e97/919/c03e9791997674218dddbdc77c01d33d.jpg" alt="Akku"><br>  Acid batteries 6V 4.5A <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/9ce/ddb/5d7/9ceddb5d7f7ac4ff16288477acab8cd1.jpg" alt="Olympes PEN E-P1"><br>  Olympus PEN E-P1 camera (somehow, quite unexpectedly, the Panasonic host remembered that the device should be returned) with a 14-42mm lens (28-84 as it approaches the full frame) <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/fba/7da/225/fba7da2255d700987808f2abfa0cb2e6.jpg" alt="Knopka"><br>  and radio button to it <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/90c/4e2/f0e/90c4e2f0e73d5c635a1bd4f0f27790d1.jpg" alt="Hama"><br>  as well as a dumb tripod. <br><br>  After the aluminum blanks according to my drawings <br><img src="https://habrastorage.org/getpro/geektimes/post_images/4a9/4d8/396/4a94d839634ffd4ce6d2b9f20057c919.jpg" alt="Schema"><br>  they were ready, it remains only to gather everything in a heap and program Arduin. <br>  The design is simple as mooing: on an aluminum L-shaped form two stepper motors are mounted.  And in absolutely shamelessly simple version - no gearboxes, nothing.  The axis of the lower engine coincides with (and in truth, it is) the vertical axis of rotation of the installation and is fixed tightly in a specially machined stainless steel shoe, which can be clamped in the head of the tripod.  Thus, the entire mass of the device is loaded (I do not own special terms from mechanical engineering, so excuse me if something goes wrong) on ‚Äã‚Äãthe lower motor.  The axis of the upper engine is perpendicular to the axis of the lower one and carries the camera through the aluminum adapter (green in the diagram below).  The point of intersection of the axes of these motors is inside the lens and coincides with the nodal point of the lens.  Parallax, I'm not afraid of you anymore !!! <br><img src="https://habrastorage.org/getpro/geektimes/post_images/02a/eb3/67c/02aeb367cf8ed46c6ef5c8a4973c084c.jpg" alt="Plan"><br>  From the very beginning, everything was programmed as it should, I did not have any problems with the Arduin software, I don‚Äôt know why, so there‚Äôs nothing much to write about it.  Next, Arduino is connected to the motor controllers and jointly mounted on the lateral surface of the frame (in the figure - to the left on the blue strip).  The transmitter of the radio button was broken down and is now controlled by the same Arduna by means of relays hung on free ports.  The picture slightly does not coincide with the reality in terms of those gray blocks that personify electronics and batteries.  This happened mainly because I had no idea about their true size and missed the scale once every 10. Thus, the electronics were left of the blue vertical, the battery hangs to the right of the burgundy, and the batteries for the radio button are between the lower motor and the burgundy vertical, well and it turned out that inside, and sometimes outside, everything is entangled by wires.  Who would have thought‚Ä¶ <br>  Everything! <br><br><h4>  Result </h4><br><img src="https://habrastorage.org/getpro/geektimes/post_images/3b5/701/763/3b5701763ba26e3a1a590470ef05ca9d.jpg" alt="Complete"><br>  The result was the following: <br>  The camera is equipped with a 14mm lens with a crop of 2, which gives approximately 28mm in full-frame equivalent.  Accordingly, the angle that captures the camera with one shot is about 64 x 48 degrees (the aspect ratio of the frame in this line is not the usual 3: 2 and 4: 3, which is actually more convenient for panoramas).  Since the camera is portrait oriented, it turns out 360/48 = 7.5 frames per circle.  I do not know how to shoot 7.5 frames, so I rounded up to 8 in a big way and added a couple more to the gluing.  It turned out 10 frames per lap.  There were three floors along the vertical line (calculations): Horizon, +40 degrees above Horizon, -40 degrees below Horizon, 1 frame vertically up, 1 frame vertically down (which still has to be shot manually).  Total 32 frames!  Three times less than originally!  It takes about 6 seconds per frame, that is, less than 4 minutes for the entire shooting!  Hooray!!!  The same goes for the panorama assembly.  Since the area of ‚Äã‚Äãthe fields that should overlap in the pictures is decently less than 30%, then the assembly of the template project required a trip to a large hangar to my friend.  The location was chosen in such a way as to have as many details as possible throughout the room.  There was no lack of details in the hangar with openwork thermal armies, a bunch of equipment, suspended walkways and other furniture.  I collected the first project very long and hard - almost the whole day, until I decided that the file generated by the sticher does not require retouching in Photoshop.  Now the process looks like this - shooting 4 minutes, copying to a computer 1 minute, correction of geometric distortions in Bubble5 2 minutes, assembling HDR images in Photomatix 3 minutes (I forgot to say - without HDR, it turned out that there is almost nothing to catch in panorama, or one hemisphere is white , or another black one), scaling in XnView is 1 minute, stitching in PTGui is 3 minutes.  Total 14 minutes for one panorama, and the main work for the operator in the field: press a button and run away, and in the studio: copy files and run programs, the brain does not need to be turned on completely, so while the routine lasts you can calmly scroll something more in your mind important.  14 minutes is better than 4 hours, just the case when the size (of the time spent) matters. <br><br>  You can see how it ultimately looks like, for example: <br><br>  <a href="http://sergej-hof.de/panotest/">sergej-hof.de/panotest</a> <br>  <a href="http://projektinarbeit.de/oldenburg/">projektinarbeit.de/oldenburg</a> <br><br><h4>  What for? </h4><br>  The simple answer is to quickly.  Honest answer - I wanted to do service for the real estate market in this way, I thought that seeing the interior photo is convenient and useful, and seeing the panorama of the room you are interested in is generally space.  But I somehow miscalculated.  Brokers nod, praise, but ordering such projects for the money is in no hurry.  I suspect the problem is that I am a bad manager, but I haven‚Äôt yet found a good one.  As for the above, ask questions, I will try to answer them.  I understand that the whole essay is chaotic and fragmentary, as it turned out - if you describe each stage more thoroughly, you will get a lot of words, but if you are interested, I‚Äôll write separately about the details you are interested in. </div><p>Source: <a href="https://habr.com/ru/post/142106/">https://habr.com/ru/post/142106/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142097/index.html">Money from the air</a></li>
<li><a href="../142098/index.html">Solitaire & Mahjong E-government Kiosk</a></li>
<li><a href="../142103/index.html">Factors of popularity of userscripts on the example of one site</a></li>
<li><a href="../142104/index.html">How am I driving?</a></li>
<li><a href="../142105/index.html">Color coding</a></li>
<li><a href="../142109/index.html">Red Hat joins the OpenStack community</a></li>
<li><a href="../142112/index.html">Software Developer Remains the Best Profession in the USA</a></li>
<li><a href="../142115/index.html">Unusual Orchestra (‚ÄúOrchestrion‚Äù by Pat Metheny)</a></li>
<li><a href="../142117/index.html">Do you format candid content?</a></li>
<li><a href="../142118/index.html">Enigma Encryption Machine in Excel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>