<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introducing Coarray Fortran: will we be parallel?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A long time ago I wanted to write about the stage at which one of the ‚Äúancestors‚Äù of the programming languages ‚Äã‚Äãthat are popular today is now. Yes, I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introducing Coarray Fortran: will we be parallel?</h1><div class="post__text post__text-html js-mediator-article">  A long time ago I wanted to write about the stage at which one of the ‚Äúancestors‚Äù of the programming languages ‚Äã‚Äãthat are popular today is now.  Yes, I'm talking about FORTRAN.  I will try to destroy the stereotype that exists in the minds of many developers - that Fortran is an ancient language without any prospects, and certainly no one writes on it anymore.  On the contrary, it is very actively evolving and has long been offering a rich set of different functionalities, enshrined in standards, which, by the way, are comparable with the same C / C ++. <br>  From the "old" 77th Fortran, there are not so many left ... in the 95th standard, we could completely create our own data types, dynamically allocate and clear memory, work with pointers, overload functions and operators, and much more.  In fact, it differs slightly from its set of tools.  However, I do not want to try to compare languages ‚Äã‚Äã- it is a question of philosophy.  I can only say that <a href="http://software.intel.com/en-us/fortran-compilers">Intel's Fortran compiler</a> is very much in demand, and, in fact, is acquired even more actively than the same C ++. <br>  The purpose of this post is to talk about the current state of affairs.  Actually, Fortran today is a parallel language, and it became such after the adoption of the Fortran 2008 standard, in which Coarray appeared. <br><a name="habracut"></a><br>  So, about everything in order.  The model was based on the SPMD (Single Program MultipleData) programming model.  If you are familiar with MPI, then the essence is the same - we are writing our application, copies of which will be executed a certain number of times in parallel.  In addition, each copy has its own local data.  Those data that need access from different copies are described using a special syntax called Coarray. <br><br>  For understanding, it is enough to give a simple Hello World example: <br><br><pre><code class="hljs pgsql">program hello <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(*,*) "Hello world" <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> program hello</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Actually, the most common code.  After compiling it with the ‚Äìcoarray key (Intel compiler), we will see ‚Äúgreetings‚Äù from several different copies of the program, or, in terms of Coarray, from different images (images).  Moreover, their number can be controlled, for example, using the ‚Äìcoarray-num-images = x key, or the environment variable FOR_COARRAY_NUM_IMAGES.  It is clear that there is a way to determine in which way the execution takes place.  Let's complicate our example: <br><br><pre> <code class="hljs pgsql">program hello_image <span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(*,*) "Hello from image ", this_image(), "out of ", num_images()," total images‚Äú end program hello_image</code> </pre> <br><br>  After launch we will see something like this: <br><br><pre> <code class="hljs pgsql">Hello <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> image <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> total images Hello <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> image <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> total images Hello <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> image <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> total images Hello <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> image <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> total images</code> </pre><br><br>  Obviously, our application was executed 4 times (4 copies / images).  Having this data on Coarray, we are, in principle, already capable of creating parallel applications. <br><br>  That's just very stupid, because there is no answer to the main question - what about the data?  To do this, a very simple and clear syntax is introduced: <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">real</span></span>, codimension[*] :: x <span class="hljs-type"><span class="hljs-type">real</span></span> :: y[*]</code> </pre> <br><br>  Square brackets tell us that we use Coarray. <br>  In this example, these are just scalars, which are still available in every copy of the program.  But now we can refer to the value of this scalar in the copy we need (image). <br><br>  For example, writing y [2], we turn to the value of y in image 2. This opens up opportunities for us to ‚Äúpresent‚Äù parallel work with data. <br><br>  Naturally, there are a number of logical restrictions imposed on Coarray'i, such as, for example, any attempt to associate a Coarray object with another object through pointers, or transferring Coarray objects to C code. <br>  Let's look at a few more examples, assuming that we have already declared the variable x as Coarray earlier: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">x</span></span> = <span class="hljs-number"><span class="hljs-number">42</span></span>.<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><br>  In this case, we operate on the local for the image of the variable x. <br>  As soon as square brackets appear in our code, this is an explicit pointer to the fact that the variable is being accessed in another program image: <br><br><pre> <code class="hljs matlab">x[<span class="hljs-number"><span class="hljs-number">3</span></span>] = <span class="hljs-number"><span class="hljs-number">42.0</span></span> !     <span class="hljs-number"><span class="hljs-number">42</span></span>   <span class="hljs-number"><span class="hljs-number">3</span></span> x = x[<span class="hljs-number"><span class="hljs-number">1</span></span>] !           <span class="hljs-number"><span class="hljs-number">1</span></span> x[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] = x[<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>] !     I      <span class="hljs-built_in"><span class="hljs-built_in">j</span></span></code> </pre> <br><br>  What is good about Coarray is that, unlike pure MPI, we don‚Äôt care about sending or receiving messages.  All this on the shoulders of the implementation (which already uses the same MPI).  But we are "over" this.  In addition, the code will work both on systems with distributed memory and on systems with shared memory.  Just change the key to coarray = shared or coarray = distributed. <br><br>  Since we have data in different copies of our program, it is logical to assume that there must be means to synchronize them.  Of course they are.  This, for example, the construction of SYNC ALL, synchronizes all images.  There is also SYNC IMAGES (), which allows you to synchronize only certain images. <br><br>  One more example: <br><br><pre> <code class="hljs delphi">integer, codimension[*] :: fact integer :: i, factorial fact = this_image() SYNC ALL <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( this_image() == <span class="hljs-number"><span class="hljs-number">1</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> factorial = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>, num_images() factorial = factorial * fact[i] <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">write</span></span><span class="hljs-comment"><span class="hljs-comment">(*, *)</span></span> num_images(), <span class="hljs-string"><span class="hljs-string">'factorial is '</span></span>, factorial <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span></code> </pre> <br><br>  Naturally, it is not the fastest way to calculate factorial, but it is a good illustration of the essence of working with Coarray. <br><br>  To begin with, declare fact as Coarray, and then in each image we assign a value equal to the image number.  Before we multiply all the values, you need to make sure that they are already assigned, so we use SYNC ALL.  And in the image with the number 1, this supposedly "master image", we calculate the factorial. <br><br>  As a result, we got a very effective tool - a part of the language that allows you to create parallel applications for systems with different memory organization.  Naturally, in the compiler support and implementation of Coarray, the main difficulty is performance.  At the moment, it still remains not the strongest side ... but here there are great prospects for various compilers. <br><br>  I‚Äôm finishing my brief description regarding the ‚Äúnew buns‚Äù from the last accepted standard.  I hope it was not very boring to watch the Fortran code.  If the reviews show the opposite and wake up a lively interest on this topic, I will not deny you the pleasure and continue the topic.  And now thank you all for your attention. </div><p>Source: <a href="https://habr.com/ru/post/203618/">https://habr.com/ru/post/203618/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../203598/index.html">We assemble a sound station based on Linux and MPD</a></li>
<li><a href="../203602/index.html">Pochta Rossii invites private carriers and implements GLONASS</a></li>
<li><a href="../203608/index.html">Order Nexus 5 D821 from Japan</a></li>
<li><a href="../203610/index.html">Ideal site - TK as the basis of the site, built on the basis of competent software solutions</a></li>
<li><a href="../203612/index.html">Turn any webcam into a powerful microscope</a></li>
<li><a href="../203622/index.html">Web analytics with Google Tag Manager</a></li>
<li><a href="../203624/index.html">Google Inc. has patented a ‚Äúsmart‚Äù answering machine for social networks / e-mail / sms</a></li>
<li><a href="../203626/index.html">Dual SSD + HDD hard drive in one package</a></li>
<li><a href="../203628/index.html">How to develop unsupported software</a></li>
<li><a href="../203632/index.html">How we became Santa Claus. Christmas rake. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>