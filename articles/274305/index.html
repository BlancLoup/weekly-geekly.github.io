<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Custom Cortina in Unity 5.3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. This is a translation of an article from the official blog of the Unity engine. It will talk about how to create your own korutin, which appear...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Custom Cortina in Unity 5.3</h1><div class="post__text post__text-html js-mediator-article">  <i>Hello.</i>  <i>This is a translation of an article from the official <a href="http://blogs.unity3d.com/">blog of</a> the Unity engine.</i>  <i>It will talk about how to create your own korutin, which appeared in version 5.3.</i> <br><br><img src="https://habrastorage.org/files/1e5/d05/e9a/1e5d05e9a8614188b0afb1311b4d8db2.png"><br><br>  Among the brilliant new features of Unity 5.3, I discovered one small thing that turned out to be useful to me, and I think it can be useful to you.  These are custom corutines, represented by the class <i>CustomYieldInstruction</i> .  Thanks to him, you can very easily create your own <a href="http://docs.unity3d.com/Manual/Coroutines.html">Cortina</a> yield operators.  Let's take a look at this with a live example. <br><a name="habracut"></a><br><h1>  Real life example - bug fix </h1><br>  Recently, I was studying an error in a <a href="http://docs.unity3d.com/Manual/script-Dropdown.html">Dropdown</a> UI element that appeared in Unity 5.2.  When setting the time scale <a href="http://docs.unity3d.com/ScriptReference/Time-timeScale.html">Time.timeScale</a> to 0, Dropdown worked only once, after which it did not appear again until the time scale was set to some non-zero value. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After a short search, we found that the problem occurs in the Show method: <br><br><img src="https://habrastorage.org/files/bad/405/af5/bad405af5e524bde8cb2104e79150ac0.png"><br>  <i>The m_Dropdown variable is not null and this prevents the display of a dropdown</i> <br><br>  After the first mapping, m_Dropdown is minimized and destroyed.  Yes, it should be destroyed, but when Time.timeScale is zero, this does not happen. <br><br>  Take a look at the destruction method and try to find the problem: <br><br><img src="https://habrastorage.org/files/fa4/4bc/0ba/fa44bc0ba4774c5b92beee6fee0443b2.png"><br><div class="spoiler">  <b class="spoiler_title">Note from the translator</b> <div class="spoiler_text">  In the original article (and here) there is an error in the code - the call to <i>m_Items.Clear ()</i> must be after the for loop, and not inside it.  Thanks to <a href="http://habrahabr.ru/users/hruks/" class="user_link">Hruks</a> for the tip. <br></div></div><br>  Thanks to the title of this article, you can guess that the problem is in <a href="http://docs.unity3d.com/ScriptReference/WaitForSeconds.html">WaitForSeconds</a> .  This class uses scaled time.  This means that when you ask WaitForSeconds to wait 1 second with a time scale of 0.5, it will actually take 2 seconds (1 / 0.5 = 2).  If the time scale is 0, then you have to wait indefinitely (until the scale becomes non-zero).  Dropdown will never be destroyed after its first use due to our use of the WaitForSeconds class. <br><br><h1>  Decision </h1><br>  We need to implement a delay using real time.  The most elegant approach would be to create a new yield operator ‚Äî the <i>WaitForSecondsRealtime</i> class.  Of course, if our own developers have not implemented WaitForSeconds using scaled time, then we should inform them about it.  WaitForSecondsRealtime reinforces this message.  We also need to update the documentation for WaitForSeconds, because we did not mean scaled time anywhere. <br><br>  So I discovered the CustomYieldInstruction class, which was added recently to create new yield operators. <br><br>  Adding a new operator is very simple, and this will be the solution to our problem: <br><br><img src="https://habrastorage.org/files/5ca/4b2/8b6/5ca4b28b6fad4dd89a0c023d66f6fa21.png"><br>  In any custom yield operator, you need to override the <i>keepWaiting</i> property.  If we want the program to continue, this property should return <i>false</i> . <br><br>  Now our bug fix will look like this: <br><br><img src="https://habrastorage.org/files/4d0/078/787/4d007878744d4300b5e254b6bf8b2c99.png"><br>  In our example, we take the real time and compare it with each check.  It could not be simpler ... although it can be made easier with the help of the new yield operators <a href="http://docs.unity3d.com/ScriptReference/WaitUntil.html">WaitUntil</a> and <a href="http://docs.unity3d.com/ScriptReference/WaitWhile.html">WaitWhile</a> .  Using them, we can pass a delegate who will be called for our verification. <br><br>  Here is an alternative way to solve the problem (suppose we just want to make a five-second delay): <br><br><img src="https://habrastorage.org/files/79a/e2b/c93/79ae2bc9337744b7a28d6fdc93625b23.png"><br>  So it was a simple but potentially wide opportunity.  I believe that the moral here is this: you must not forget to read the descriptions for the release versions, because you can find new useful features in them!  And if you like custom korutiny, also take a look at <a href="http://docs.unity3d.com/Manual/UnityEvents.html">UnityEvents</a> - another favorite of mine that you might have missed. </div><p>Source: <a href="https://habr.com/ru/post/274305/">https://habr.com/ru/post/274305/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../274293/index.html">Adobe has released an emergency patch to fix critical vulnerabilities Flash Player</a></li>
<li><a href="../274295/index.html">Prototype messaging service Geotalk</a></li>
<li><a href="../274299/index.html">Rayon: data parallelism in Rust</a></li>
<li><a href="../274301/index.html">Opening a new data center Hydro66</a></li>
<li><a href="../274303/index.html">Why does percentile calculation not work as expected?</a></li>
<li><a href="../274307/index.html">Video of the best reports of the JPoint 2015 Java Conference - Part 1</a></li>
<li><a href="../274309/index.html">New Year's gift from the Russian hoster low-cost</a></li>
<li><a href="../274311/index.html">Materials from Azov Developers Meetup 2015</a></li>
<li><a href="../274313/index.html">Compare incomparable: json in PostgreSQL vs Mysql vs Mongodb</a></li>
<li><a href="../274315/index.html">JOIN the dark side of the SQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>