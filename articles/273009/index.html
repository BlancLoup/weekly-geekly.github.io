<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Deploy Drupal 8 with Otto</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This post was the result of my acquaintance with Otto, one of the latest products of Hashicorp, which was already a review article on Habr√©. 

 My pos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Deploy Drupal 8 with Otto</h1><div class="post__text post__text-html js-mediator-article">  This post was the result of my acquaintance with Otto, one of the latest products of Hashicorp, which was already a <a href="http://habrahabr.ru/post/268497/">review article</a> on Habr√©. <br><br>  My post is more practical.  I decided to raise a standard project on otto in order not to immediately stumble upon the subtleties of customization, and in order to be interested, I chose Drupal 8, which was released recently. <br><br><img src="https://habrastorage.org/files/6d4/ec4/b47/6d4ec4b4786f47048d5fd55301234115.png" alt="image"><br><a name="habracut"></a><br><h4>  Installation </h4><br>  The latest version tagged is 0.1.2 from 10/20/2015.  Looking ahead, I‚Äôll say that I didn‚Äôt manage to set up MySQL on it right away, and also, looking in CHANGELOG, I decided to try the master branch because of Layered Dev Environments. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Otto 0.1.3-dev requires Vagrant 1.7.99+, <s>since the stable version is 1.7.4, which means that Vagrant is also needed from the master branch</s> .  UPD: Vagrant 1.8 is out, Vagrant is no longer needed. <br><br>  The compilation of both projects is well described on the <a href="https://github.com/hashicorp/otto">otto</a> and <a href="https://github.com/mitchellh/vagrant">vagrant pages</a> , it took me half an hour to install golang, configure gopath and compile both projects without the knowledge of Go and Ruby. <br>  The main thing is not to add <br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">export</span></span> PATH=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$GOPATH</span></span></span><span class="hljs-string">/bin:</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$PATH</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br>  Restart the terminal, check that we are running the dev version: 'vagrant version', 'otto version'. <br><br><div class="spoiler">  <b class="spoiler_title">NFS configuration</b> <div class="spoiler_text">  Directly to otto does not apply, but, having learned about the <a href="http://mitchellh.com/comparing-filesystem-performance-in-virtual-machines">terrible</a> stagnation of standard virualbox shared folders, I realized the need to configure NFS. <br><br>  On Ubuntu, it is enough to install the nfs-common nfs-kernel-server packages and add a few lines to / etc / sudoers so that Vagrant does not ask for a password every time it is started, for more details see <a href="https://docs.vagrantup.com/v2/synced-folders/nfs.html">the documentation</a> . <br></div></div><br><br><h4>  Project preparation </h4><br>  Download Drupal 8: <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">git</span></span> clone https://github.com/drupal/drupal.git drupal8 cd drupal8</code> </pre><br><h4>  Appfile </h4><br>  <a href="https://www.ottoproject.io/docs/concepts/appfile.html">Appfile</a> - the main otto configuration file for the project, must be at the root of the project. <br><br>  In general, it may not be at all, then otto will determine the requirements for the environment in which the application can run.  The logic of determining the type of application is nowhere simpler, for example, a project will be defined as php if there are * .php files in the root <br><br><h4>  otto compile </h4><br>  The first command that is needed in otto is ' <a href="https://www.ottoproject.io/docs/concepts/compile.html">otto compile</a> '.  It analyzes the project and its Appfile, and then generates a tree in the .otto folder, containing all the information about the dev and deploy configurations of the environments. <br><br>  Documentation advises not to edit the contents of this folder.  But you can and should look. <br><br>  It will also generate .ottoid - a unique identifier of your application, by which otto will track its deployment, store history, use it as a dependency, etc. <br><br>  At this point, our environment is described and ready for deployment. <br><br><h4>  otto dev </h4><br>  The next thing you need is to deploy a local dev environment on the local machine. <br>  In essence, otto dev is the same as vagrant up. <br><br><h6>  Layered Dev Environments </h6><br>  The concept of layers is interesting, they are very similar to Docker layers: when you first launch otto dev, the Vagrant virtual environment will be configured sequentially, taking a snapshot after each step.  Layers are described in application type.  All this allows to significantly reduce the time of creation of the dev environment.  Thus, we get an instant launch of the finished environment, even with the full re-creation of the virtual machine.  The difference between restarting and re-creating the machine ('otto dev halt &amp;&amp; time otto dev' and 'otto dev destroy &amp;&amp; time otto dev') is about 5 seconds. <br><br>  Judging by the changelog, vagrant will not get this functionality, at least in the next version, but in Vagrant there will be a functionality for creating snapshots. <br><br>  You can view the layers with the command 'otto dev layers': <br><pre> <code class="hljs ruby">$ otto dev layers consul php5.<span class="hljs-number"><span class="hljs-number">6</span></span></code> </pre><br>  As a result, in the case of a PHP application, otto should issue further instructions: <br><pre> <code class="bash hljs">$ otto dev IP address: 100.66.143.21 A development environment has been created <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> writing a PHP app. You can access the environment from this machine using the IP address above. For example, <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you start your app with <span class="hljs-string"><span class="hljs-string">'php -S 0.0.0.0:5000'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> you can access it using the above IP at port 5000.</code> </pre><br><br>  What have we got with auto setup? <br><ul><li>  Ubuntu 12.04 (at the moment you can not choose a basic system image) </li><li>  Consul </li><li>  PHP 5.6 (otto installs PHP not from the standard repository, but from the PPA) </li><li>  Composer </li></ul><br>  Drupal is critically short of MySQL. <br><br><h4>  Depencies </h4><br>  The easiest way to add MySQL is to specify a dependency.  Create an Appfile in the project root: <br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">application</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">name</span></span> = <span class="hljs-string"><span class="hljs-string">"drupal8"</span></span> type = <span class="hljs-string"><span class="hljs-string">"php"</span></span> dependency { <span class="hljs-attribute"><span class="hljs-attribute">source</span></span> = <span class="hljs-string"><span class="hljs-string">"github.com/hashicorp/otto/examples/mysql"</span></span> } }</code> </pre><br>  This config explicitly indicates the type of application (php) and adds MySQL as a dependency. <br>  Despite the fact that the link in the source is invalid, otto will understand it, there are <a href="https://www.ottoproject.io/docs/appfile/dep-sources.html">other source formats</a> . <br><br>  There is a way to add mysql even easier, but it is wrong, I will say about it in flaws. <br><br>  <a href="https://github.com/hashicorp/otto/blob/master/examples/mysql/Appfile">Appfile mysql</a> describes a dependent application as a Docker container, the path to the container image and launch parameters.  As a result, we will get the running container inside Vagrant, thanks to Consul it will be available at the address mysql.service.consul (inside the virtual machine) with the user and root password: root.  The default Consul makes it much easier to use Docker, you can not understand the intricacies of setting service discovery, but simply use it. <br><br>  A dependency can be any other application, but it is strongly recommended that it have a .ottoid file that will allow otto to understand what it is running, even if the application is renamed. <br><br>  Dependencies at the moment do not support versioning (they promise to add in the future), which means that with every 'otto compile' you have a chance to get not what you expected, so you should fork dependencies yourself or put it on a local machine. <br><br>  Making 'otto compile', 'otto dev destroy', 'otto dev' - we get a machine ready to launch Drupal.  It remains to run the server in it. <br><br><h4>  otto dev ssh </h4><br>  We come in virtualka on SSH.  We execute the above command to start the PHP-embedded web server; I see nothing wrong with running as root on port 80 on dev: <br><pre> <code class="bash hljs">sudo php -S 0.0.0.0:80</code> </pre><br>  After that, you can go to the browser to open the IP address that issued the 'otto dev', you can get it explicitly by executing the 'otto dev address'. <br><br><h4>  disadvantages </h4><br><h5>  Raw code </h5><br>  It can be seen that the code is rather prototypical in some places.  For example, in Vagrantfile bash is used to expand the environment, and not ansible or something similar. <br><br>  I looked into the App type php code, found there a definition that the application being started is wordpress (by the presence of the wp-config.php file), the only difference from the standard php application is the automatic addition of mysql depending.  That is, you can now specify in Appfile 'type = "wordpress"' or make 'touch wp-config.php' to get mysql, but, of course, this is not worth doing. <br><br><h5>  Environment not worked </h5><br>  Judging by the issue tracker of the project, the best practices are not yet ready and it is not entirely clear how they will be prepared.  For example, in the case of PHP, there are Hashicorp, which do not know the features of the environment of PHP projects and PHP programmers who do not know Go and cannot send a pull request. <br><br>  Mitchell Hashimoto, the author of Otto, offers everyone interested to write on Github suggestions with improvements, links to articles with setting the right environment, and Hashicorp will take care of their integration into the product.  It seems to me that abstractions will appear later, which will enable a wide range of non-go programmers to help in product development. <br><br><h5>  Dev is different from prod </h5><br>  I did not get to the 'otto infra' and 'otto deploy' commands, but I learned that now they only support AWS and that for php projects the dev environment is different from the deploy environment, in the first case it is suggested to run the server built into PHP, in the second rises apache2 with mod-php. <br><br><h5>  Dev poorly customizable </h5><br>  Otto at the moment does not allow customizing Vagrantfile dev-environments through Appfile.  We are looking at .otto / compiled / app / dev / Vagrantfile, it turns out that it contains / vagrant mount options incompatible with NFS.  We fix the line with something like: <br><pre> <code class="hljs lua"><span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.vm.synced_folder <span class="hljs-string"><span class="hljs-string">'/home/popstas/projects/site/drupal8'</span></span>, <span class="hljs-string"><span class="hljs-string">"/vagrant"</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: <span class="hljs-string"><span class="hljs-string">"nfs"</span></span></code> </pre><br>  The following 'otto compile' will overwrite these changes. <br><br>  The only way to do this is to completely redefine the Vagrantfile using application type = ‚Äúcustom‚Äù, but in this case all the magic of the environment auto-tuning disappears. <br><br><h4>  findings </h4><br>  I made a conclusion for myself that Otto is not yet ready for full use, as the product version 0.1 suggests in general.  Nevertheless, the product is very interesting and already has advantages over Vagrant, and all the disadvantages are explained by the novelty of Otto, the developers know about them and have plans to eliminate. <br><br>  Now it is not clear how to create your layers, when the layers will appear in Otto fully, for me it will be enough reason to switch to it from Vagrant. </div><p>Source: <a href="https://habr.com/ru/post/273009/">https://habr.com/ru/post/273009/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272995/index.html">You can not use tools</a></li>
<li><a href="../272999/index.html">Audio and video in the Tox messenger</a></li>
<li><a href="../273001/index.html">Black PR Telegram. Who to believe?</a></li>
<li><a href="../273003/index.html">Games that teach programming</a></li>
<li><a href="../273007/index.html">The digest of interesting materials for the mobile # 133 developer (December 7-13)</a></li>
<li><a href="../273011/index.html">MongoDB certification</a></li>
<li><a href="../273013/index.html">Situation Center of the Central PPK (electric trains of the Moscow Region) - we have done a lot of hell</a></li>
<li><a href="../273017/index.html">Bizagi. Description. Example</a></li>
<li><a href="../273019/index.html">Separate medical data storage and regional information systems</a></li>
<li><a href="../273021/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ189 (December 6 - 13, 2015)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>