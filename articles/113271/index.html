<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a simple bot for WoW: continued</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a continuation of the previous article: 
 Creating a simple bot for the online game world of warcraft 

 In this part I will discuss the proce...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a simple bot for WoW: continued</h1><div class="post__text post__text-html js-mediator-article">  This is a continuation of the previous article: <br>  <a href="http://habrahabr.ru/blogs/gdev/113258/">Creating a simple bot for the online game world of warcraft</a> <br><br>  In this part I will discuss the process of interaction with the auctioneer and the mailbox.  If the previous part was more general, then this part is already more connected with the world of WoW and much will hardly be applicable to other online games. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In that article, we created a bot that can independently come to the NPC auctioneer.  Now we need to implement our further actions.  First, I will tell you a little about how the auction takes place.  I personally trade symbols, but the addons that I use also automate the trading of any craft items.  I use <a href="http://wow.curse.com/downloads/wow-addons/details/tradeskill-master.aspx">TradeSkill Master</a> , this is an addon from the authors auction profit master, which used to be called quick auctions.  The point is: I have about 400-500 of my items at auction.  In addition to me on the server there are another 4-5 people who sell the same product in the same volumes.  My task is to keep the price of the product all the time lower than theirs.  This allows you to make an addon: it automatically scans the auction, if it finds that someone put the item at a price lower than mine, it removes my lot from the auction.  The item is sent to the post office.  Accordingly, it then needs to be picked up from the post office and put out at a price lower than that of competitors.  The price is also assigned by the addon. <br><br>  Those.  in fact, the bot's task is to come to the auctioneer, open the auction window, start auctioning items, then start canceling lots when everything is canceled - go to the post office and pick up everything, then go back to the auction.  Bot, who knows how to come to the NPC-auctioneer, we have already written.  Now our task is to start trading. <br><br><h4>  Trade </h4><br>  There is already a clean AutoIt, with a little macro added. <br>  We will need one macro that will target the auctioneer - this is <br><pre><code class="hljs">/  </code> </pre> <br>  We assign this macro, for example, to the button "9".  Next we need to start trading with him.  Here, too, everything is simple: in the settings of the assignment of keys, the section ‚Äúfunctions of using targets‚Äù, you must assign the button ‚Äúinteract with a target‚Äù, I assigned it to ‚Äú\‚Äù for example. <br>  After the opening of the auction, you must start the process of placing goods from the bags to the auction.  In my addon, this is desired by a simple click on the button, in other addons, it may take two clicks - it doesn't matter, all the same, the function is trivial: <br><pre> <code class="hljs 1c">Func StartPostingAuc() Send(<span class="hljs-string"><span class="hljs-string">"9"</span></span>) ;     Sleep(<span class="hljs-number"><span class="hljs-number">300</span></span>) Send(<span class="hljs-string"><span class="hljs-string">"\"</span></span>) ;   Sleep(<span class="hljs-number"><span class="hljs-number">2000</span></span>);        <span class="hljs-keyword"><span class="hljs-keyword"></span></span>   -   MouseClick(<span class="hljs-string"><span class="hljs-string">"left"</span></span>, <span class="hljs-number"><span class="hljs-number">1278</span></span>, <span class="hljs-number"><span class="hljs-number">155</span></span>) ;    <span class="hljs-string"><span class="hljs-string">" "</span></span> Sleep(<span class="hljs-number"><span class="hljs-number">2000</span></span>) $state = <span class="hljs-string"><span class="hljs-string">"posting"</span></span> ;  EndFunc</code> </pre><br><br>  Actually the function of the posting is also quite simple.  After clicking on the button we have this window: <br><img src="https://habrastorage.org/storage/9059c719/a268028e/54aae1d6/5f605b71.png"><br>  There is a progress bar at the bottom, and a button appears at the top, on clicking on it our goods are put up for auction. <br>  Accordingly, our task is to click on the button while there is a progress bar, as soon as the progress bar ends - proceed to the next step - the cancellation of goods for which the price was interrupted <br><pre> <code class="hljs php">Func PostingAuc() $borderPixelColor = PixelGetColor(<span class="hljs-number"><span class="hljs-number">937</span></span>,<span class="hljs-number"><span class="hljs-number">527</span></span>);       -   ,   - <span class="hljs-keyword"><span class="hljs-keyword">While</span></span> $borderPixelColor = <span class="hljs-number"><span class="hljs-number">6249826</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> $state = <span class="hljs-string"><span class="hljs-string">"posting"</span></span> ;   - -  MouseClick(<span class="hljs-string"><span class="hljs-string">"left"</span></span>, <span class="hljs-number"><span class="hljs-number">1026</span></span>, <span class="hljs-number"><span class="hljs-number">210</span></span>) Sleep(<span class="hljs-number"><span class="hljs-number">500</span></span>); $borderPixelColor = PixelGetColor(<span class="hljs-number"><span class="hljs-number">937</span></span>,<span class="hljs-number"><span class="hljs-number">527</span></span>); Wend <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $state = <span class="hljs-string"><span class="hljs-string">"posting"</span></span> then ;    -     -  $state = <span class="hljs-string"><span class="hljs-string">"startcancel"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EndIf</span></span> EndFunc</code> </pre><br><br>  Cancellation is not fundamentally different from the posting, the same exact window with a progress bar and one button.  Accordingly, the functions are exactly the same, just click.  That's the whole process of trading. <br><br><h4>  Move to mailbox </h4><br>  After all canceled goods got to the post office, you need to pick them up from there.  For this we go to the mailbox.  In principle, the process of walking to the mailbox is almost the same as the process of walking to the auctioneer: <br>  We also write a semaphore that will show where to go.  We also rotate the coordinate system to make it easier to navigate.  When a character is facing the mailbox, the angle is 2.31 rad. <br><br>  The only difference is that when you walk in the direction of the mailbox there are protruding elements in the walls, into which I sometimes crashed, so when creating a semaphore, I took this moment into account and made it so that when I approach the wall I move away from it to the right.  In principle, this was done by simply adding another branch to the if: <br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">elseif</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">mailPosX</span></span> &lt; 0<span class="hljs-selector-class"><span class="hljs-selector-class">.2000</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">and</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mailPosY</span></span> &gt; 0<span class="hljs-selector-class"><span class="hljs-selector-class">.896</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">then</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">PlayerMailGoForvard</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:SetTexture(1</span></span>,0,0); <span class="hljs-selector-tag"><span class="hljs-selector-tag">PlayerMailGoBack</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:SetTexture(1</span></span>,0,0); <span class="hljs-selector-tag"><span class="hljs-selector-tag">PlayerMailGoLeft</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:SetTexture(1</span></span>,0,0); <span class="hljs-selector-tag"><span class="hljs-selector-tag">PlayerMailGoRight</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:SetTexture(0</span></span>,1,0); <span class="hljs-selector-tag"><span class="hljs-selector-tag">PlayerOnMail</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:SetTexture(1</span></span>,0,0);</code> </pre><br>  Those.  x &lt;0.2 is until I leave the building, y&gt; 0.896 - I approach the wall, I have to move.  As soon as the wall left the building, there is no need to move away. <br><br>  Now that the character has come to the mailbox, you must open it in some way. <br>  The way as with the auctioneer does not work here - the mailbox can not be taken on target. <br>  Therefore, a little preparation is required here: before launching the bot, it is necessary to bring the camera as close as possible and make it look ahead and down.  Previously, api Vova allowed you to find out the current position of the camera, and you could write a semaphore to control the camera, but after enterprising people wrote an augmented reality addon that greatly simplified the player‚Äôs life, this function was forbidden to use in addons.  Therefore, it is necessary to set up the camera manually when the bot starts: to interact with the auctioneer, it‚Äôs all the same how the camera is directed. <br><br>  So, we came to the mailbox, the camera is pointing down.  We see something like this: <br><img src="https://habrastorage.org/storage/b4b9d203/b482d5c4/f0fb01b2/1bf19e19.jpg"><br>  Our task is to click on the mailbox with the right mouse button. <br>  There are problems: <br>  1. we can not guarantee exactly the point at which we will come, only about <br>  2. mailbox can be blocked by another player <br><br>  These problems mean the following: we cannot save the point we need to click on to open the mailbox, as we do in the case of other buttons. <br>  But taking into account our algorithm for going to the mailbox, we believe that it will most likely be somewhere in the left third of the screen. <br>  Correspondingly, we will write a function that will click first to the place where the mailbox is most often located, and if it does not find it, click on the left third of the screen until it finds it. <br>  For 9 hours of testing, this function only 2 times could not find the mailbox, and it was my fault: the way to the box was poorly prescribed, the character fell from the ledge on which he stood and there was no box on the screen at all.  The problem was solved by prescribing a condition in the semaphore, in which the character must step back a bit so as not to fall. <br><pre> <code class="hljs css"> <span class="hljs-selector-tag"><span class="hljs-selector-tag">elseif</span></span> (<span class="hljs-selector-tag"><span class="hljs-selector-tag">mailposX</span></span> &gt; 0<span class="hljs-selector-class"><span class="hljs-selector-class">.203</span></span>) <span class="hljs-selector-tag"><span class="hljs-selector-tag">then</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">PlayerMailGoForvard</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:SetTexture(1</span></span>,0,0); <span class="hljs-selector-tag"><span class="hljs-selector-tag">PlayerMailGoBack</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:SetTexture(0</span></span>,1,0); <span class="hljs-selector-tag"><span class="hljs-selector-tag">PlayerMailGoLeft</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:SetTexture(1</span></span>,0,0); <span class="hljs-selector-tag"><span class="hljs-selector-tag">PlayerMailGoRight</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:SetTexture(1</span></span>,0,0); <span class="hljs-selector-tag"><span class="hljs-selector-tag">PlayerOnMail</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:SetTexture(1</span></span>,0,0);</code> </pre><br>  Mailbox in the open state (at the top left you can see a piece of the updated semaphore, more compact): <br><img src="https://habrastorage.org/storage/6e069d44/6e745b44/131b0fa5/50d41e33.png"><br><br>  Actually, we will determine the opening of the mailbox by the appearance of the red button ‚Äúreceive all‚Äù.  The function for autoit I got is this: <br><pre> <code class="hljs php">Func OpenMail() $x1 = <span class="hljs-number"><span class="hljs-number">392</span></span> ; ,        $y1 = <span class="hljs-number"><span class="hljs-number">382</span></span> <span class="hljs-keyword"><span class="hljs-keyword">While</span></span> not (PixelGetColor(<span class="hljs-number"><span class="hljs-number">237</span></span>,<span class="hljs-number"><span class="hljs-number">515</span></span>) = <span class="hljs-number"><span class="hljs-number">6226176</span></span>) ;      -     MouseClick(<span class="hljs-string"><span class="hljs-string">"right"</span></span>, $x1, $y1); $y1 = $y1 + <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $y1 &gt; <span class="hljs-number"><span class="hljs-number">620</span></span> Then $x1 = $x1 + <span class="hljs-number"><span class="hljs-number">10</span></span> $y1 = <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> $x1 &gt; <span class="hljs-number"><span class="hljs-number">650</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> $y1 &gt; <span class="hljs-number"><span class="hljs-number">620</span></span> Then $x1 = <span class="hljs-number"><span class="hljs-number">194</span></span> $y1 = <span class="hljs-number"><span class="hljs-number">54</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EndIf</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EndIf</span></span> Sleep(<span class="hljs-number"><span class="hljs-number">200</span></span>) Wend MouseClick(<span class="hljs-string"><span class="hljs-string">"left"</span></span>, <span class="hljs-number"><span class="hljs-number">237</span></span>,<span class="hljs-number"><span class="hljs-number">515</span></span>)<span class="hljs-number"><span class="hljs-number">4</span></span>    -    Sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>) MouseClick(<span class="hljs-string"><span class="hljs-string">"left"</span></span>, <span class="hljs-number"><span class="hljs-number">237</span></span>,<span class="hljs-number"><span class="hljs-number">535</span></span>);     $state = <span class="hljs-string"><span class="hljs-string">"givingmails"</span></span>;     EndFunc</code> </pre><br>  After clicking on the red button, it becomes gray until all letters are received. <br><br><h4>  Receive letters </h4><br>  In general, the receipt of letters works quite simply: you just need to stand and wait until the smart TradeSkillMaster extracts all the letters from the mail.  As soon as the addon extracts everything - the button changes to red and you can go back to the auctioneer: we already know how. <br><br>  It would seem that the bot was written.  But then the biggest problems were waiting for me: to find out that all the letters had been received turned out to be not such a trivial task as it looked at first.  In general, there are two ways to know that all letters have been received: <br>  1. The button turned red again.  The easiest option, unfortunately - the rarest. <br>  2. The bags are filled - at the same time the button does not turn red and the bot could always stand and wait near the mail.  To solve this problem, the bot automatically opens the last bag at startup and ensures that the last cell in it is empty.  As soon as the color of the last cell of the bag changes, it means the bags are full, it's time to go to the auction <br>  3. Sometimes trade skill master is buggy and some empty letters are not deleted from the mail.  In this case, the button also never turns red, even if there are no more letters in the mail.  In this case, the problem is solved simply: I took the last slot of the mail, and I see whether it changes or not: when I receive letters, they constantly move up and the slot changes.  When all letters are received, it ceases to change.  If it does not change within 20 seconds - then it‚Äôs time to go to exhibit the goods. <br><br>  Total function turned out like this: <br><pre> <code class="hljs ruby">Func GiveMails() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> PixelGetColor(<span class="hljs-number"><span class="hljs-number">237</span></span>,<span class="hljs-number"><span class="hljs-number">515</span></span>) = <span class="hljs-number"><span class="hljs-number">6226176</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> $i = <span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> (PixelGetColor(<span class="hljs-number"><span class="hljs-number">1665</span></span>, <span class="hljs-number"><span class="hljs-number">868</span></span>) = <span class="hljs-number"><span class="hljs-number">2761500</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ;        $state = <span class="hljs-string"><span class="hljs-string">"goingtoauc"</span></span> $i = <span class="hljs-number"><span class="hljs-number">0</span></span> EndIf <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> PixelGetColor(<span class="hljs-number"><span class="hljs-number">52</span></span>,<span class="hljs-number"><span class="hljs-number">470</span></span>) = $prevcolor <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> ;       ,      $i = $i+<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $i = <span class="hljs-number"><span class="hljs-number">0</span></span> EndIf $prevcolor = PixelGetColor(<span class="hljs-number"><span class="hljs-number">52</span></span>,<span class="hljs-number"><span class="hljs-number">470</span></span>) Sleep(<span class="hljs-number"><span class="hljs-number">1000</span></span>) EndFunc</code> </pre><br><br><h5>  Everything, we successfully received letters, we return to the auctioneer! </h5><br><br>  In general, I completed my development on this, because now my bot knows how to do everything that I originally wanted from him: comes to the auctioneer, exposes his items, cancels items with interrupted prices, comes to the post office, picks up his belongings, returns to the auction , exposes, and further in a circle. <br><br>  As a conclusion, I want to say that the development of bots for online games is like a logical game: <br>  How to make him pick up all the letters?  How to bypass this or that feature?  How best to implement this or that function?  Weekends are considered well spent, a good warm-up for the brain :) </div><p>Source: <a href="https://habr.com/ru/post/113271/">https://habr.com/ru/post/113271/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113266/index.html">Search strings and related questions</a></li>
<li><a href="../113267/index.html">On foreign films can enter tax</a></li>
<li><a href="../113268/index.html">Do we need a language?</a></li>
<li><a href="../113269/index.html">Putting order in the old rubbish, or a tale about how accidentally collected a mini BP</a></li>
<li><a href="../113270/index.html">Recens CP - samopisnaya beta server control panel</a></li>
<li><a href="../113272/index.html">Eric Schmidt predicts the future of computers - and he plans to be involved</a></li>
<li><a href="../113274/index.html">The second normal form (in SQL terminology)</a></li>
<li><a href="../113275/index.html">Capture an iPhone character from the screen</a></li>
<li><a href="../113278/index.html">IBM's supercomputer beat people on the Jeopardy quiz!</a></li>
<li><a href="../113279/index.html">Motorola smashes Apple in an ad for Xoom</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>