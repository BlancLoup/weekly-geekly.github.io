<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The history of first place on the ML Boot Camp VI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Mail.ru has been holding machine learning championships for several years now, each time the task is interesting in its own way and difficult in its o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The history of first place on the ML Boot Camp VI</h1><div class="post__text post__text-html js-mediator-article">  Mail.ru has been holding machine learning championships for several years now, each time the task is interesting in its own way and difficult in its own way.  I participate in competitions for the fourth time, I really like the platform and organization, and it was with the bootcamps that I started my way into competitive machine learning, but I managed to take first place for the first time.  In the article I will tell you how to show a stable result, without having retrained neither on the public leaderboard, nor on the delayed samples, if the test part is significantly different from the training part of the data. <br><br><h2>  Task </h2><br>  The full text of the problem is available at ‚Üí <a href="https://mlbootcamp.ru/round/14/sandbox/">link</a> .  Briefly: there are 10 GB of data, where each line contains three json'a of the form "key: counter", a certain category, a certain timestamp and a user ID.  One user can match multiple entries.  It is required to determine to which class the user belongs, first or second.  The quality metric for the model is ROC-AUC, it is perfectly written on the blog of Alexander Dyakonov <a href="https://alexanderdyakonov.wordpress.com/2017/07/28/auc-roc-%25D0%25BF%25D0%25BB%25D0%25BE%25D1%2589%25D0%25B0%25D0%25B4%25D1%258C-%25D0%25BF%25D0%25BE%25D0%25B4-%25D0%25BA%25D1%2580%25D0%25B8%25D0%25B2%25D0%25BE%25D0%25B9-%25D0%25BE%25D1%2588%25D0%25B8%25D0%25B1%25D0%25BE%25D0%25BA/">[1]</a> . <br><br>  File entry example 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs go"><span class="hljs-number"><span class="hljs-number">00000d</span></span>2994b6df9239901389031acaac <span class="hljs-number"><span class="hljs-number">5</span></span> {<span class="hljs-string"><span class="hljs-string">"809001"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-string"><span class="hljs-string">"848545"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-string"><span class="hljs-string">"565828"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"490363"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>} {<span class="hljs-string"><span class="hljs-string">"85789"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"238490"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"32285"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"103987"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"16507"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-string"><span class="hljs-string">"6477"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"92797"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>} {} <span class="hljs-number"><span class="hljs-number">39</span></span></code> </pre> <a name="habracut"></a><br><h2>  Decision </h2><br>  The first idea that arises from a data scientist who successfully downloaded dataset is to turn json columns into a sparse matrix.  At this place, many participants experienced problems with lack of RAM.  When deploying even one column in python, memory consumption was higher than that available on an average laptop. <br><br>  A bit of dry statistics.  The number of unique keys in each column: 2053602, 20275, 1057788. At the same time, both in the train part and in the test part are only: 493866, 20268, 141931. 427994 unique users in the train and 181024 in the test part.  Approximately 4% of class 1 in the training part. <br><br>  As we see, we have a lot of signs, using them all is an obvious way to overfit to the train, for example, decisive trees use combinations of signs, and unique combinations of such a large number of signs are even greater and almost all of them exist only in the training part. data or in test.  However, one of the base models I had was a lightgbm with colsample ~ 0.1 and very tight regularization.  However, even despite the huge parameters of regularization, it showed an unstable result in the public and private parts, as it turned out after the end of the competition. <br><br>  The second thought of a person who decided to participate in this competition would surely be to collect the train and test, aggregating information by identifiers.  For example, the sum.  Or maximum.  And then it turns out two very interesting things that Mail.ru invented for us.  First, the test can be classified with very high accuracy.  Even according to the statistics on the number of records for cuid and the number of unique keys in the json test, the test significantly exceeds the train.  The base classifier gave 0.9+ roc-auc in test recognition.  Secondly, the counters have no meaning, almost all the models became better from switching from counters to binary signs of the form: there is / no key.  Even trees, which in theory should not be worse than the fact that instead of a unit there is a certain number, seem to have retrained to the counters. <br><br>  The results on the public leaderboard greatly exceeded those on cross-validation.  This was probably due to the fact that it was easier for the model to build the ranking of two records in the test than in the train, because more signs gave more terms for ranking. <br><br>  At this stage, it became finally clear that the validation in this competition is not a simple thing at all, and neither the public nor the CV information of other participants, which could be tricked out in an official chat <a href="https://t.me/mlbootcamp">[2]</a> .  Why did this happen?  It seems that the train and the test are separated in time, which was later confirmed by the organizers. <br><br>  Any experienced kaggle member will immediately advise Adversarial validation <a href="http://fastml.com/adversarial-validation-part-one">[3]</a> , but it's not that simple.  Despite the fact that the accuracy of the classifier on the train and the test is close to 1 according to the roc-auc metric, but there are not so many records similar to the test in the train.  I tried to summarize cuid aggregated samples with the same target in order to increase the number of entries with a large number of unique keys in json, but this gave a drawdown for cross-validation and public reporting, and I was afraid to use such models. <br><br>  There are two ways: to search for eternal values ‚Äã‚Äãwith the help of unsupervised learning or to try to take more important features for the test.  I went both ways, using TruncatedSVD for unsupervised and selecting features by frequency in the test. <br><br>  The first step, however, I did was a deep autoencoder, but I made a mistake by taking the same matrix twice, correcting the error and using the full set of features: the input tensor did not fit into the memory of the GPU for any size of the dense layer.  I found a mistake and did not try to encode features in the future. <br><br>  I generated SVD by all means for which I had enough imagination: on the original dataset with cat_feature and subsequent summation over cuid.  For each column separately.  By tf-idf on json as bag-of-words <a href="https://en.wikipedia.org/wiki/Bag-of-words_model">[4]</a> (did not help). <br><br>  For more variety, I tried to select a small number of features in the train, using A-NOVA for the train portion of each fold for cross-validation. <br><br><h2>  Models </h2><br>  The main base models: lightgbm, vowpal wabbit, xgboost, SGD.  In addition, I used several neural network architectures.  Dmitry Nikitko, who was in the first place of the public leaderboard, advised to use <a href="https://github.com/Puzer/hashembedding">HashEmbeddings</a> , this model after a certain selection of parameters showed a good result and improved the ensemble. <br><br>  Another neural network model with the search for interactions (factorization machine style) between 3-4-5 data columns (three left inputs), numerical statistics (4 inputs), SVD matrices (5 inputs). <br><br><img src="https://habrastorage.org/webt/g5/xb/yp/g5xbypjhkxazihg5vfcd7mglya0.png"><br><br><h2>  Ensemble </h2><br>  I counted all the models on the folds, averaging the test predictions from models trained on different folds.  Train predictions were used for stacking.  The best result showed a stack of level 1 using xgboost on the predictions of the basic models and 250 signs from each json-column, selected according to the frequency with which the sign was encountered in the test. <br><br>  I spent ~ 30 hours of my time on the solution, counted on a server with 4 cores core-i7, 64 gigabytes of RAM, and one GTX 1080. As a result, my solution turned out to be quite stable and I moved up from the third place of the public leaderboard to the first private one. <br><br>  A significant part of the code is available on the beatback in the form of laptops <a href="https://bitbucket.org/sergeif/bootcampvi/src/master/">[5]</a> . <br><br>  I want to thank Mail.ru for interesting contests and other participants for interesting communication in the group! <br><br>  [1] <a href="https://alexanderdyakonov.wordpress.com/2017/07/28/auc-roc-%25D0%25BF%25D0%25BB%25D0%25BE%25D1%2589%25D0%25B0%25D0%25B4%25D1%258C-%25D0%25BF%25D0%25BE%25D0%25B4-%25D0%25BA%25D1%2580%25D0%25B8%25D0%25B2%25D0%25BE%25D0%25B9-%25D0%25BE%25D1%2588%25D0%25B8%25D0%25B1%25D0%25BE%25D0%25BA/">ROC-AUC in the blog of Aleksandrov Dyakonov</a> <br>  [2] <a href="https://t.me/mlbootcamp">Official chat ML BootCamp official</a> <br>  [3] <a href="http://fastml.com/adversarial-validation-part-one">Adversarial validation</a> <br>  [4] <a href="https://en.wikipedia.org/wiki/Bag-of-words_model">bag-of-words</a> <br>  [5] <a href="https://bitbucket.org/sergeif/bootcampvi/src/master/">source code of most models</a> </div><p>Source: <a href="https://habr.com/ru/post/418743/">https://habr.com/ru/post/418743/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../418727/index.html">Where and how to get into embeddingings of graphs</a></li>
<li><a href="../418729/index.html">All that you have asked for a long time, in one release - CLion 2018.2</a></li>
<li><a href="../418735/index.html">Focusing on ownership</a></li>
<li><a href="../418737/index.html">Laser ablation, tellurite glass and Er2O3 dopant</a></li>
<li><a href="../418739/index.html">Center for Additive Technology: Industrial 3D Printers 3D Systems, Stratasys, SLM, EOS</a></li>
<li><a href="../418747/index.html">Problem Solving: how to effectively solve problems in a team?</a></li>
<li><a href="../418751/index.html">Dexp brazen chinese spy</a></li>
<li><a href="../418753/index.html">vSAN in VMware based cloud</a></li>
<li><a href="../418755/index.html">How e-commerce survive major promotions. Getting ready for peak loads on the web [Part 1]</a></li>
<li><a href="../418757/index.html">Thinning timeframes (cryptocurrency, forex, stock exchange)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>