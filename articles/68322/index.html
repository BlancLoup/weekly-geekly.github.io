<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SQL and flags</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Of course, this is not about the mode of the game Capture The Flag on the SQL server, but about the use of bit flags. Bit operations are familiar, pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SQL and flags</h1><div class="post__text post__text-html js-mediator-article"> <i>Of course, this is not about the mode of the game Capture The Flag on the SQL server, but about the use of bit flags.</i>  <i>Bit operations are familiar, probably, to all those involved in panning, regardless of the development environment and language.</i>  <i>However, the use of flags, in my opinion, for many is an exotic rather than a daily tool.</i>  <i>On Habr√©, we have repeatedly mentioned the possibility of a convenient .NET ability to work with flags through enum, but after all, SQL gives us excellent opportunities to use flags!</i> <br><br>  And so, we will consider a simple example - in some application there should be a certain system for notifying users.  Suppose you are building a forum and want to enable the user to receive alerts by mail: a new answer in the chosen topic, a new personal message, forum news. A quick look at the task will be given by the trivial design of the tables: <br>  <b>tblUsers</b> {userID (PK) as int, name as nvarchar (50), password as nvarchar (50)} <br>  <b>tblUserAlerts</b> {userID (FK) as int, alertID (FK) as int} <br>  <b>tblAlerts</b> {alertID (PK) as int, message as nvarchar (50)} <br><a name="habracut"></a><br><br>  That is, there is a table of users, a table of alerts and the connection between them is implemented through an auxiliary table in order to allow each user to select more than one alert.  The data will look something like this: <br>  <u><b>tblUsers</b></u> <br>  1, "Vasya", "tricky" 4 " 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <u><b>tblUserAlerts</b></u> <br>  eleven <br><br>  <u><b>tblAlerts</b></u> <br>  1, "You received a new personal message" <br><br>  Now consider an example using the flag: <br>  <b>tblUsers</b> {userID (PK) as int, name as nvarchar (50), password as nvarchar (50), alerts as int}, <br>  <b>tblAlerts</b> {alertID (PK) as int, message as nvarchar (50)} <br><br>  In this embodiment, we get the same functionality and at the same time do without an additional table.  In the tblAlerts table, we set the alertID as a flag bit using the same int (size depends on the number of alert options), and in the tblUsers table, the alerts field displays the alert mask bit.  Suppose we create 3 types of alerts, then in the tblAlerts table there will be 4 (no alerts + 3 types mentioned) rows in the alertID field.  The first ID will be 0 - in bits it will look like 0000, the value, respectively - no alerts.  Then we add our alerts, igniting a different bit each time (each identifier will be a power of two): 0001 = 1, 0010 = 2, 0100 = 4: <br>  <u><b>tblAlerts</b></u> <br>  0, NULL <br>  1, ‚ÄúNew Answer in Favorite Topic‚Äù <br>  2, "You received a new personal message" <br>  4, "We have news!" <br><br>  Now we need to subscribe the user, say, to the news and to alerts about personal messages.  To do this, we summarize the identifiers of these alerts and get 0110 = 6: <br>  <u><b>tblUsers</b></u> <br>  1, ‚ÄúVasya‚Äù, ‚Äúslyp4r0l‚Äù, 6 <br><br>  Now we will build a query in the tblUsers table to find out which users are subscribed to the news: <br> <code><b>SELECT</b> * <b>FROM</b> tblUsers <b>WHERE</b> (tblUsers.alert &amp; 4) &gt; 0 <br></code> <br>  The meaning of this operation is simple: <br>  0110 - our mask <br>  0100 - news flag <br>  0100 - the result (that is, there is an intersection of the mask and the flag, the result will be greater than zero) <br><br>  Pleasant aspect - you can compare and mask.  Suppose we want to get a list of users subscribed to all types of alerts 1 + 2 + 4 = 7: <br> <code><b>SELECT</b> * <b>FROM</b> tblUsers <b>WHERE</b> (tblUsers.alert &amp; 7) = 7 <br></code> <br>  Note that there is an intersection between mask 6 and 7, but the result will be different from 7 <br>  0110 - user mask <br>  0111 - check mask <br>  0110 - result (intersection or minimum of 7 and 6 = 6) <br><br>  With the same ease, you can make a request for a list of users who have signed up, either to notify you about replies or to be notified about personal messages 1 + 2 = 3: <br> <code><b>SELECT</b> * <b>FROM</b> tblUsers <b>WHERE</b> (tblUsers.alert &amp; 3) &gt; 0 <br></code> <br>  A positive result will be a check of the user's mask with values ‚Äã‚Äãof 1, and 2, and 3 (that is, either one of the two alerts, or both). <br><br>  In this simple way, you can get rid of the link table and even simplify queries.  However, the downside may not be the ability to do some actions (say JOIN) through the standard visual query editor, since the standard will compare identifiers.  It will be necessary to manually replace the comparison with a bit operation: <br> <code><b>SELECT</b> tblUsers.*, tblAlerts.* <br> <b>FROM</b> tblUsers <b>INNER JOIN</b> tblAlerts <b>ON</b> (tblUsers.alerts &amp; tblAlerts.alertID) = tblAlerts.alertID <br></code> </div><p>Source: <a href="https://habr.com/ru/post/68322/">https://habr.com/ru/post/68322/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../68315/index.html">Coffee'n'Code in Kharkov</a></li>
<li><a href="../68318/index.html">Introduction to the Bean Validation API</a></li>
<li><a href="../68319/index.html">Approximation Horizon</a></li>
<li><a href="../68320/index.html">Dark theme for TextMate</a></li>
<li><a href="../68321/index.html">Wolfram Alpha will provide an API for accessing data.</a></li>
<li><a href="../68323/index.html">Vectorize the image with a genetic algorithm.</a></li>
<li><a href="../68324/index.html">Industry news for the week</a></li>
<li><a href="../68325/index.html">Dark Theme (Twilight) for Netbeans</a></li>
<li><a href="../68326/index.html">In the near future, two new navigation applications will become available for Android using DWA - ‚ÄúAugmented Reality for Driving‚Äù</a></li>
<li><a href="../68330/index.html">OpenGL ES 2.0 to iPhone 3G S Basics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>