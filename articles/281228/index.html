<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Friday format: How Netflix works</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In our blog on Habr√©, we tell not only about the technological aspects of the work of the cloud service 1cloud , but also address the issues of organi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Friday format: How Netflix works</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/company/1cloud/blog/281228/"><img src="https://habrastorage.org/files/b63/2f8/284/b632f828476b46b185d208277467bbb0.png" width="700"></a> <br><br>  <i>In our blog on Habr√©, we tell not only about the <a href="https://habrahabr.ru/company/1cloud/blog/278479/">technological aspects of the</a> work of the cloud service <a href="https://1cloud.ru/">1cloud</a> , but also address the issues of organizing the workflow.</i>  <i>For example, recently we discussed the work of <a href="https://habrahabr.ru/company/1cloud/blog/280748/">those.</a></i>  <i><a href="https://habrahabr.ru/company/1cloud/blog/280748/">support</a></i> <i><br><br></i>  <i>Today we decided to diversify the Friday Habr's tape with the analysis of materials on the subject of the device service Netflix, which supplies viewers with films and series based on streaming media technologies.</i> <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Netflix was founded in 1997 by Mark Randolph (Marc Randolph) and Reed Hastings (Scotts Valley, California).  At first, it employed 30 employees involved in the provision of 925 movies and TV shows by subscription.  Today, Netflix is ‚Äã‚Äãthe world's leading Internet TV network serving tens of millions of customers. <br><br>  The company actively spreads to the Network information about applied technologies, infrastructure and unusual solutions.  For example, in their <a href="http://techblog.netflix.com/">blog</a> , Netflix employees talked about what the company is doing so that the content provided is always of high quality.  For this, they developed a whole methodology.  The content delivery network (CDN) of the company takes into account what devices its customers use and supports a wide range of Internet connections - from mobile Internet at speeds of less than 0.5 Mb / s to high-speed Internet (over 100 Mb / s). <br><br>  Netflix uses adaptive streaming technology that regulates the quality of audio and video in accordance with the user's Internet speed, but the company also provides customers with the opportunity to set the video quality on their own.  A large number of combinations of codecs and bitrate values ‚Äã‚Äãin Netflix imply "the obligatory encoding of one film in 120 different ways before transferring it to any streaming platform." <br><br>  The entire video encoding process is carried out in the cloud, which gives the company great opportunities for scaling: if there is a sharp need to process more films, then cloud technologies make it easy to use additional resources.  The reverse is also true - if necessary, the amount of computing power can be reduced. <br><br>  Tasks for processing long videos are divided into smaller ones and are performed in parallel.  This can significantly reduce the time for their implementation.  The figure below shows the whole process.  After receiving the source video is encoded in different formats and in different quality and only then gets into the CDN. <br><br><img src="https://habrastorage.org/files/2f4/331/a8c/2f4331a8c9e44801a48544b665c64d25.png" width="700"><br><br>  Netflix receives source files with video from its own film studio or from its partners, but this does not exclude the likelihood that some of the files received will have defects arising during storage or multiple data processing.  For this reason, at the initial stage, it is checked whether the sources meet the necessary requirements: this is how content that can cause negative viewing impressions is revealed. <br><br>  If the source file does not meet the requirements, the system automatically notifies the company's partners about the problem and requests a new source.  If everything is in order, metadata is attached to the file for encoding.  To improve the efficiency of working with large files (for example, video with 4K resolution), they are fragmented - the file is conventionally divided into small parts, which are checked in parallel. <br><br>  During the test, errors are detected and metadata are generated that contain the temporal characteristics of the fragment.  Upon completion of the analysis, all the pieces are collected in a special aggregator, which decides whether to transfer the file to the next stage of the production process.  As a result, 4K video is checked for defects in less than 15 minutes. <br><br><img src="https://habrastorage.org/files/06c/6de/3d2/06c6de3d2e4544769896318cf4ae2f95.jpg" width="700"><br><br>  With regard to the encoding of the video file, it is the same as in the case of quality control, is carried out in parallel.  After successful processing of the fragments, the special program assembles all the parts into a single whole. <br><br>  Prior to the use of parallel processing techniques, the system processed the film with a resolution of 1080p for several days.  Today, the same film can be fully tested and encoded in various formats in just a few hours. <br><br><img src="https://habrastorage.org/files/5b8/e5a/208/5b8e5a2083e64672b7035c6f70a1ba2b.jpg" width="700"><br><br>  Before quality control was integrated into the Netflix system, all errors ‚Äúsurfaced‚Äù when customers contacted technical support.  Most often, users were very unhappy, and this affected the financial position of the company.  After the introduction of the quality control system, the Netflix team began to identify all errors in a timely manner, and the reliability of the coding of the source code that was checked today is more than 99.99%.  If a company is faced with a problem that could not be identified with the help of automation algorithms, employees will start developing new verification mechanisms to prevent this from happening in the future. <br><br>  Based on its content delivery and delivery system, Netflix conducts large-scale video file experiments, for example, comparing different types of codecs and optimizing the encoding process.  According <a href="http://techblog.netflix.com/2015/12/high-quality-video-encoding-at-scale.html">to the</a> company's employees, Netflix solves the tasks necessary for optimal delivery of high-quality video streams, while also benefiting the community. <br><br>  The Netflix Open Connect content delivery network <a href="https://habrahabr.ru/company/1cloud/blog/271159/">provides</a> its services to larger ISPs with more than 100,000 customers.  Special embedded equipment with low power and high recording density for a certain fee can transfer content stored in data centers of Internet service providers from the Netflix site, thereby reducing the cost of transferring data from the Web.  This hardware runs on the FreeBSD operating system using the nginx server and the BIRD routing service. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/mBCXdaukvcc%3Ffeature%3Doembed&amp;xid=17259,15700002,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgboDOCS_jJGUlDmgSVoLi1IyfYYw" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Monitoring failed servers </h4><br>  Currently, Netflix is ‚Äã‚Äãrunning on several tens of thousands of servers, and less than one percent of them are malfunctioning.  A faulty server is not necessarily disconnected, and therein lies the main danger: it responds to requests during health checks, and its system metrics remain within the normal range, but it functions at a level far from optimal. <br><br>  A slow or bad server is much worse than an inoperable one.  Even a small negative impact can be enough to cause discomfort among customers of the service.  For this reason, Netflix is ‚Äã‚Äãconcerned with automating the search for faulty servers that are not detected by monitoring systems. <br><br>  In the video below, Cody Rioux talks about what prompted the company to tackle these problems, and also shares the technical details of the algorithms used (with examples). <br><br><iframe src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://player.vimeo.com/video/120851298&amp;xid=17259,15700002,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgzKDeRSYkVN3k1-dXK3qNbcgdRmA" width="560" height="315" frameborder="0" title="Cody Rioux: Netflix Outlier and Anomaly Detection" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe><br><br>  The company widely uses the so-called cluster analysis, which is a method of machine learning without a teacher.  When choosing a cluster algorithm, the Netflix guys chose the spatial data clustering algorithm with the presence of DBSCAN noise (Density-Based Spatial Clustering of Applications with Noise). <br><br>  DBSCAN accepts as input a set of points and marks as cluster points those that have a large number of neighbors.  Points that are in areas with lower density are considered to be statistical emissions.  If a certain point belongs to a cluster, then it must be located at a certain distance from other points of this cluster, which is determined by a special function (Naftali Harris) in its blog <a href="http://www.naftaliharris.com/blog/visualizing-dbscan-clustering/">gave an</a> excellent visualization of the DBSCAN method. <br><br>  DBSCAN is used as follows: <a href="http://techblog.netflix.com/2014/12/introducing-atlas-netflixs-primary.html">Atlas's</a> main dynamic telemetry platform tracks a given metric and generates a data window.  This data is then transmitted to the DBSCAN algorithm, which returns a set of servers with suspected malfunction.  The image below shows the data that is input to the DBSCAN algorithm.  The area highlighted in red is the current data window. <br><br><img src="https://habrastorage.org/files/5a0/2c9/01f/5a02c901f80e41e89fe00da0f7491fdf.png" width="700"><br><br>  When the servers are identified, control is transferred to the alert system, which takes one (or several) of the following: contact the owner of the service by email, disconnect the server from the service without stopping it, collect expert data for further investigation, stop the server, allowing it to be replaced. <br><br>  It is impossible to perfectly determine the failed servers, but the probability of this is quite <a href="https://habrahabr.ru/company/1cloud/blog/267201/">high</a> .  A non-ideal solution is quite acceptable in a cloudy environment, since the cost of the error here is quite small.  Since the servers being shut down are immediately replaced with ‚Äúfresh‚Äù ones, erroneous stopping the server or shutting it down has a minor effect on the system, if it has any. <br><br>  Netflix's cloud infrastructure is constantly expanding, and automating operational solutions opens up new opportunities, improving service availability and reducing the number of situations where human intervention is required.  Determining faulty servers is just one example of this automation. <br><br><h4>  Recommended Algorithms </h4><br>  In 2009, Netflix held a competition called the Netflix Prize.  She opened access to her personal data and gave participants the opportunity to try to improve the algorithm for predicting the assessment, which the viewer will put the film, based on the ratings of other viewers.  The winning team managed to increase the efficiency of the algorithm by 10.06%. <br><br>  As for the recommender system, it consists of several algorithms, some of which are responsible for the <a href="http://techblog.netflix.com/2015/04/learning-personalized-homepage.html">process of</a> creating a personalized home page.  For example, <a href="http://www.netflixprize.com/">an</a> estimate prediction <a href="http://www.netflixprize.com/">algorithm</a> that a user will deliver to a movie, <a href="http://techblog.netflix.com/2012/06/netflix-recommendations-beyond-5-stars.html">a</a> video ranking <a href="http://techblog.netflix.com/2012/06/netflix-recommendations-beyond-5-stars.html">algorithm</a> for each row and a movie grouping algorithm. <br><br>  Currently, movies and shows on the Netflix home page are organized in the form of subject lines (each of which has a specific name), and service users can scroll the page in both horizontal and vertical planes.  This approach allows the user to quickly decide for himself whether a whole group of films is worth his attention, or he can go on to the next line. <br><br>  Machine learning is used to create a personalized page - the algorithm is trained on the basis of historical information about all the home pages ever created and information about user interaction with them. <br><br>  Netflix has a fairly large selection of features that can be used to represent a string for a learning algorithm.  Since a line is a set of videos, you can use as attributes all the properties that they possess both together and separately.  This may be the usual metadata or more useful recommendations, showing how this or that picture will be of interest to a specific user. <br><br>  It is extremely important to evaluate its quality when generating a page with any algorithm.  Coming up with assessment metrics, Netflix employees scooped up ideas in an area like information retrieval.  For example, a company has found a use for a value called ‚Äúfullness‚Äù (Recall), which is the ratio of the number of relevant objects (films that the client has chosen) in the sample to the total number of relevant objects. <br><br>  It was decided to use the Rec [m; n] value, which is the number of relevant objects in the first m lines and n columns on the page divided by the total number of relevant objects.  Thus, Rec [3; 4] is the quality of the video (for a specific user) presented on the device, the display of which allows you to display only 3 lines of 4 videos each.  The advantage of such a metric is that, by fixing one of the values ‚Äã‚Äã(m or n) and changing the other, you can see how the value of completeness changes as you scroll the page. <br><br>  When forming the homepage, it is also very important to understand how users view it, that is, to which points on the screen they pay the most attention.  Placing the most up-to-date videos in the most frequently viewed places (most often this is the upper left corner of the screen) should help reduce the search time for a movie for the evening. <br><br><img src="https://habrastorage.org/files/114/bbb/7c3/114bbb7c3dcc40f48aa63ed0fbbfc5e6.png" width="500"><br><br>  As for the diversity of genres, this is a whole separate story.  If you are a Netflix user, then you most likely have noticed that sometimes strange, sometimes absurd films are offered to you.  Documentary dramatic films about the fighters with the system?  The play about the royal family, based on real events?  Foreign stories about the Satanists of the 80s? <br><br>  And what is interesting, it turns out, Netflix has 76897 different ways to describe movies.  The company has created special teams whose members tagged each movie with their meta tags.  This process turned out to be so complicated that participants were given a 36-page guide, which described how to evaluate films by the presence of sexual content, the amount of blood, how to determine the romanticism of the film and assess the level of acting.  Even the morality of the characters was assessed. <br><br>  The Atlantic journalist Alexis Madrigal (Alexis Madrigal) decided to look into the situation in more detail and discovered that Netflix has an absurdly large number of genres (their number exceeded 90,000).  To shed some light on the situation, Alexis wrote a script that ‚Äúpulled‚Äù all existing genres from the company's website. <br><br>  ‚ÄúI immediately noticed that the site does not have films of all the genres represented,‚Äù <a href="https://habrahabr.ru/company/1cloud/blog/258753/">notes</a> Madrigal.  ‚ÄúThe presence of a genre in the database means that, according to the algorithm, such films may appear later, or there are already materials that fall under the description, but have not yet been added to the site.‚Äù  For example, category # 91300 was called ‚ÄúGood romantic TV shows in Spanish‚Äù and was empty, category # 91307 bore the title ‚ÄúBeautiful Latin American comedies‚Äù and contained two films, and in category No. 6307 ‚ÄúBeautiful romantic dramas‚Äù 20 films were presented. <br><br>  However, if you try to analyze all genres, then the grammar of Netflix will become quite transparent.  For example, information about the ‚Äúoskranosnosti‚Äù picture is always recorded at the beginning: ‚ÄúOscar-winning romantic dramas‚Äù, but temporary periods always follow at the end: ‚ÄúOscar-winning romantic dramas of the 50s‚Äù.  Categories that reveal the content of the film are also placed near the end: "Oscar-winning romantic films about the wedding." <br><br>  It turned out that for each descriptor there is a strict hierarchy.  In short, the genre is formed according to the established pattern: <br><br>  <i>Location + Adjectives + Noun + Based on ... + Filmed at ... + From the director ... + O ... + For ages X to Y</i> <br><br><img src="https://habrastorage.org/files/76f/e00/eaf/76fe00eaf12c4fe5b5dda44dd746bf9e.png" width="500"><br><br>  All 76897 genres that Madrigal's bot found were created from these basic components.  Netflix Vice President Todd Yellin told more about the process of forming ‚Äúmicro-genres‚Äù.  In 2006, Yellin, with a team of engineers, began work on documentation called the Netflix Quantum Theory.  In this context, a quantum is a small ‚Äúenergy packet‚Äù (micro tag) that is part of each movie. <br><br>  Yellin said that genres are limited to three main factors: <br><br><ul><li>  The name of the genre should not exceed 50 characters due to the peculiarities of the user interface. </li><li>  In order for an algorithm to form a genre, an ‚Äúcritical mass‚Äù of content must be accumulated that would fit its description. </li><li>  Registered genres are syntactically correct. </li></ul><br>  In the world of Netflix there are no genres consisting of more than five descriptors.  Four descriptors are very rare, but they can be found: "Cult horror films about crazy scientists of the 1970s."  Three descriptors are found quite often: ‚ÄúGood foreign comedies for incorrigible romantics.‚Äù  Two descriptors are used very often: "Films saturated with riddles."  Very often there are single descriptors: "Unusual films." <br><br>  However, the magic of Netflix lies in the fact that, it turns out, not all tags were placed by people, some of them are developed by the system itself.  For example, the adjective "encouraging" is attached to films that have a certain set of features, the most important of which is a happy ending.  It turns out that ‚Äúencouraging‚Äù is not a direct tag, but a computed category based on a set of tags. </div><p>Source: <a href="https://habr.com/ru/post/281228/">https://habr.com/ru/post/281228/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281216/index.html">Lambdify - a new look at working with AWS Lambda</a></li>
<li><a href="../281218/index.html">To solder or not to solder? Internet of things for beginners</a></li>
<li><a href="../281220/index.html">Microsoft is going to get rid of Flash Player in the Edge web browser</a></li>
<li><a href="../281222/index.html">Overload standard DataAnnotation attributes for use with custom resource provider</a></li>
<li><a href="../281226/index.html">Comparative testing of nine ORM for Android</a></li>
<li><a href="../281230/index.html">The law ‚ÄúOn Personal Data‚Äù and the practice of its application in Russian reality</a></li>
<li><a href="../281232/index.html">Honda has improved the management of the power plant of a Formula 1 car with the help of IBM Watson IoT</a></li>
<li><a href="../281234/index.html">New vulnerability Flash Player is exploited in-the-wild</a></li>
<li><a href="../281236/index.html">Garbage collection in the persistent model: from terabyte and beyond</a></li>
<li><a href="../281238/index.html">IoT solution for 1.5 hours</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>