<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zabbix 3.4: Mass data collection using the examples of the counter Mercury and smartmontools</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello everyone, we have previously mentioned the possibilities for mass data collection in the new version of the open source monitoring system Zabbix...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zabbix 3.4: Mass data collection using the examples of the counter Mercury and smartmontools</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/c5b/8ba/d9a/c5b8bad9a58545459d8ebac4620f5e9b.png"><br><br>  Hello everyone, we have previously mentioned the possibilities for mass data collection in the new version of the open source monitoring system Zabbix 3.4.  Now we‚Äôll dwell on this functionality in more detail, and in order to make it clearer, let‚Äôs tell you about it in two examples: <br><br><ul><li>  collecting all the data at once, received in JSON from the console utility of the electricity meter Mercury 236 </li><li>  collecting indicators SMART hard drives and SSD, obtained in tabular form from smartmontools. </li></ul><a name="habracut"></a><br><h2>  And what was the actual problem? </h2><br>  It was possible to collect data via console utilities or API calls, but there were difficulties: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  slow start of utilities every time, for each necessary data item </li><li>  access to the resource (disk, port, counter, application API) for each data item </li><li>  result parsing needed to be done with external scripts / utilities </li><li>  and if then it was necessary to correct the parsing - I had to update UserParameters or scripts again </li><li>  among other things, simultaneous requests from several Zabbix pollers led to an error when accessing, for example, a serial port. </li></ul><br>  In general, it was like this: <br><br><img src="https://habrastorage.org/web/9a9/82d/cac/9a982dcac4824ad8b04ac6bf27b22254.png"><br><br>  And with the advent of <a href="https://www.zabbix.com/documentation/3.4/ru/manual/config/items/itemtypes/dependent_items">dependent data elements</a> , it became possible like this: <br><br><img src="https://habrastorage.org/web/e48/120/7be/e481207bef204c25b19a6713bd9d628f.png"><br><br>  How it works? <br><br><ul><li>  In Zabbix 3.4, the data source may be another data element, which is called the parent or master element.  Such an element may, for example, contain an array of data in JSON, XML or arbitrary text format. </li><li>  At the time of receipt of new data in the parent element, the remaining data elements, which are called dependent, refer to the parent element and using such <a href="https://www.zabbix.com/documentation/3.4/ru/manual/config/items/item">preprocessing functions</a> like JSON path, XPath or Regex select the desired metric from the text. </li></ul><br>  By the way, <a href="https://www.zabbix.com/documentation/3.4/manual/introduction/whatsnew340">preprocessing</a> is also an innovation 3.4, it is implemented by adding new processes preprocessing_manager and preprocessing_worker on Zabbix-server.  Therefore, if you are updating from 3.2 - do not forget to update the <a href="https://share.zabbix.com/official-templates/zabbix-components/zabbix-server">template for the server</a> in order to monitor their work. <br><br>  Go to the examples. <br><br><br><h2>  Mercury 236 </h2><br><img src="https://habrastorage.org/web/e29/141/08d/e2914108def64856bac857bc4a68cfca.jpeg"><br>  Imagine that on our project, besides containers, virtual machines, applications, network devices, databases, business indicators and everything else requiring control, there is a need to monitor the indicators of the power grid and other ‚Äúengineers‚Äù, such as climate control equipment.  Standard devices for our middle band are used: a three-phase electricity meter Mercury 236 RT-01 PQRS with RS-485 interface, on top of which communication takes place through the manufacturer‚Äôs proprietary protocol. <br><br>  The task is responsible - immediately collect indicators of voltage, power, current, consumption, frequency.  Connecting such a device to a server with a Zabbix agent is a feasible task - a serial port with RS-485 will be enough, for example, in the form of a USB adapter.  But how to read the data?  If it were not for github and <a href="https://github.com/Shden">kind people</a> who shared their <a href="https://github.com/Shden/mercury236">solution</a> for a smart home, we would write a <a href="https://habrahabr.ru/company/zabbix/blog/268119/">module</a> to Zabbix, which we would learn to talk on the protocol of the counter and interrogate the indicators. <br><br>  The utility is simple and convenient (for which the author thanks a lot) thanks to the counter on the specified port, reads the data and gives us as text, CSV or JSON. <br><br>  Let's try to install and run: <br><br> <code>git clone https://github.com/Shden/mercury236.git <br> cd mercury236 <br> make <br> ./mercury236 /dev/ttyS0 --help <br> Usage: mercury236 RS485 [OPTIONS] ... <br> RS485 address of RS485 dongle (eg /dev/ttyUSB0), required <br> --debug to print extra debug info <br> --testRun dry run to see output sample, no hardware required <br> Output formatting: <br> .... <br> --help prints this screen <br></code> <br>  Runs!  Ok, we connect the counter, we query, we get JSON: <br><br>  ./mercury236 / dev / ttyS0 --json <br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"U"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"p1"</span></span>: <span class="hljs-number"><span class="hljs-number">0.35</span></span>, <span class="hljs-attr"><span class="hljs-attr">"p2"</span></span>: <span class="hljs-number"><span class="hljs-number">0.35</span></span>, <span class="hljs-attr"><span class="hljs-attr">"p3"</span></span>: <span class="hljs-number"><span class="hljs-number">226.86</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"I"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"p1"</span></span>: <span class="hljs-number"><span class="hljs-number">0.00</span></span>, <span class="hljs-attr"><span class="hljs-attr">"p2"</span></span>: <span class="hljs-number"><span class="hljs-number">0.00</span></span>, <span class="hljs-attr"><span class="hljs-attr">"p3"</span></span>: <span class="hljs-number"><span class="hljs-number">0.39</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"CosF"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"p1"</span></span>: <span class="hljs-number"><span class="hljs-number">0.00</span></span>, <span class="hljs-attr"><span class="hljs-attr">"p2"</span></span>: <span class="hljs-number"><span class="hljs-number">0.00</span></span>, <span class="hljs-attr"><span class="hljs-attr">"p3"</span></span>: <span class="hljs-number"><span class="hljs-number">0.60</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sum"</span></span>: <span class="hljs-number"><span class="hljs-number">0.60</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"F"</span></span>: <span class="hljs-number"><span class="hljs-number">50.00</span></span>, <span class="hljs-attr"><span class="hljs-attr">"A"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"p1"</span></span>: <span class="hljs-number"><span class="hljs-number">41943.03</span></span>, <span class="hljs-attr"><span class="hljs-attr">"p2"</span></span>: <span class="hljs-number"><span class="hljs-number">41943.03</span></span>, <span class="hljs-attr"><span class="hljs-attr">"p3"</span></span>: <span class="hljs-number"><span class="hljs-number">41943.03</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"P"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"p1"</span></span>: <span class="hljs-number"><span class="hljs-number">0.00</span></span>, <span class="hljs-attr"><span class="hljs-attr">"p2"</span></span>: <span class="hljs-number"><span class="hljs-number">0.00</span></span>, <span class="hljs-attr"><span class="hljs-attr">"p3"</span></span>: <span class="hljs-number"><span class="hljs-number">53.45</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sum"</span></span>: <span class="hljs-number"><span class="hljs-number">53.45</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"S"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"p1"</span></span>: <span class="hljs-number"><span class="hljs-number">0.00</span></span>, <span class="hljs-attr"><span class="hljs-attr">"p2"</span></span>: <span class="hljs-number"><span class="hljs-number">0.00</span></span>, <span class="hljs-attr"><span class="hljs-attr">"p3"</span></span>: <span class="hljs-number"><span class="hljs-number">89.83</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sum"</span></span>: <span class="hljs-number"><span class="hljs-number">89.83</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"PR"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"ap"</span></span>: <span class="hljs-number"><span class="hljs-number">120.51</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"PR-day"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"ap"</span></span>: <span class="hljs-number"><span class="hljs-number">86.00</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"PR-night"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"ap"</span></span>: <span class="hljs-number"><span class="hljs-number">34.51</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"PY"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"ap"</span></span>: <span class="hljs-number"><span class="hljs-number">0.00</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"PT"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"ap"</span></span>: <span class="hljs-number"><span class="hljs-number">0.04</span></span> } }</code> </pre> <br>  As a result, the utility has already done all the hard work for us, implementing the protocol of communication with the counter, pulling out the data, and even offered it to us as a convenient JSON object.  That's just before, we just could not use it - we would have to write the binding in the form of scripts, and the most important thing is to implement a mechanism for controlling access to the serial port environment.  After all, if two polisher Zabbix simultaneously turn to it - one for the current of the third phase 3, and the other for the current of phase 2, we would not return anything. <br><br>  In 3.4, everything becomes much simpler, and we can now quickly and easily transfer data from third-party console utilities to Zabbix, without resorting to wrapping scripts, and without running the same data item separately for each data element 10 times.  So, <br><br><h3>  Configure the launch of the Zabbix mercury236 utility </h3><br> <code>sudo cp mercury236 /etc/zabbix/scripts <br> cd /etc/zabbix/scripts <br> chmod +x mercury236 <br> sudo usermod -G dialout zabbix <br></code> <br>  To run the script, create a new <a href="https://habrahabr.ru/company/zabbix/blog/196218/">UserParameter</a> in the Zabbix agent <a href="https://habrahabr.ru/company/zabbix/blog/196218/">config</a> : <br><br><pre> <code class="hljs ruby">UserParameter=mercury236[*],<span class="hljs-regexp"><span class="hljs-regexp">/etc/zabbix</span></span><span class="hljs-regexp"><span class="hljs-regexp">/scripts/mercury</span></span>236 $1 $2</code> </pre> <br>  Save the file, do not forget to restart our Zabbix agent. <br><br>  Now we will create a parent data element in the new template: <br><br><img src="https://habrastorage.org/web/636/3f3/a98/6363f3a9883c4fcf8131e0b6b483c12a.png"><br><br>  As you can see, there is nothing special about the parent data element - just check through the Zabbix Agent <a href="https://habrahabr.ru/company/zabbix/blog/196218/">UserParameter</a> .  This means that there are no restrictions on what type of verification can act as a parent element - here there can be data obtained through <a href="https://www.zabbix.com/documentation/3.4/ru/manual/config/items/itemtypes/trapper">Zabbix trapper</a> or through <a href="https://www.zabbix.com/documentation/3.4/ru/manual/config/items/itemtypes/external">External checks</a> .  The only thing we chose Type of information - Text and history retention period in 1 day - we keep storing metrics separately in dependent elements for longer (you can not store data at all in the parent element by setting the retention period to 0).  Please note that we do not touch the preprocessing in this data element. <br><br><h3>  Configure receipt of our meter metrics </h3><br>  In order to start creating dependent data elements, you can use the new assistant.  Well, or just click "Create a data item": <br><br><img src="https://habrastorage.org/web/4ef/481/290/4ef481290a964f00a48f36c44c94cae0.png"><br><br>  Create a data element for the voltage of the first phase, choose: <br><br><ul><li>  Type: Dependent Data Item </li><li>  Master Data Item: mercury-get </li></ul><br><img src="https://habrastorage.org/web/89b/456/4f6/89b4564f64464979a4e1107281b7e39a.png"><br><br>  Then in the ‚ÄúPre-Processing‚Äù tab add our JSON Path expression: <br><br>  JSON path: $ .U.p1 <br><br><img src="https://habrastorage.org/web/de5/152/5dd/de51525dd7a24148a2e9f7da2556e221.png"><br><br>  By the way, a little advice.  In order not to spend a lot of time debugging and catching errors, before filling in the JSON Path, you can quickly check the correctness of the expression online, for example, here: <a href="http://jsonpath.com/">jsonpath.com</a> , copying there the JSON received from the utility. <br><br>  Similarly, we create other metrics of interest.  Including - for the accumulated energy at the daily rate. <br><br>  To do this, create a new data item and select: <br><br><ul><li>  Type: Dependent Data Item </li><li>  Master Data Item: mercury-get </li></ul><br>  But in the tab "Pre-processing", pay attention to two nuances: <br><br><ul><li>  we will use the notation with square brackets, since there is a hyphen in the JSON path </li><li>  preprocessing can be multi-step, for example, here the result of the first step is multiplied by 1000 to get Wh / hr from kWh </li></ul><br><img src="https://habrastorage.org/web/55b/783/af8/55b783af815b409a8be50c39868b9ce4.png"><br><br>  Let's do the same for the other key metrics of the counter, in the end we get the following list: <br><br><img src="https://habrastorage.org/web/019/718/d05/019718d050a943e0bbd22dd4b38bb9ca.png"><br><br><h3>  We bring our template to mind </h3><br>  To make the template complete, we add triggers using <a href="https://www.zabbix.com/documentation/3.4/ru/manual/config/macros/usermacros">macros</a> , making it as flexible as possible.  Do not forget about the <a href="https://www.zabbix.com/documentation/3.4/ru/manual/config/triggers/dependencies">dependencies of the triggers</a> . <br><br><img src="https://habrastorage.org/web/bc1/dea/3fd/bc1dea3fd5c54048bf3207cfae6cec7b.png"><br><br><h3>  What happened </h3><br>  The template is ready, the data ran, let's see what we got: <br><br><img src="https://habrastorage.org/web/780/d46/19f/780d4619f1e44486bd077eff7554de1c.png"><br><br>  All the latest data collected for one appeal: <br><br><img src="https://habrastorage.org/web/628/6ae/cb0/6286aecb0c1541a08c4cb36220526c98.png"><br><br>  Please note that the collection time for all metrics is absolutely identical. <br><br>  The final counter template is available in the decision repository at share.zabbix.com <a href="https://share.zabbix.com/power-ups/template-pwr-mercury236-236">here</a> . <br><br>  Let's sum up: <br><br><ul><li>  reused a good program and did not waste time on writing their own implementation of data collection under the Mercury protocol </li><li>  UserParameter remained, but collapsed before a simple call.  In fact, you can even <a href="https://www.zabbix.com/documentation/3.4/ru/manual/config/items/itemtypes/zabbix_agent">use system.run []</a> </li><li>  Wrappers, too, did not write.  All parsed via JSON path in the template </li><li>  The counter was not tortured much, one request - all the data we need at once. </li></ul><br><h2>  Smartctl and smartmontools </h2><br><img src="https://habrastorage.org/web/65b/2d9/21c/65b2d921c9404eaf8cbdeb8a0f256491.png"><br><br>  Long time ago we <a href="https://habrahabr.ru/company/zabbix/blog/196218/">wrote</a> on Habr√© how it is possible to monitor SMART hard drives in order to have time to change them using UserParameters.  This <a href="https://habrahabr.ru/company/zabbix/blog/196218/">approach</a> works, but it was not without flaws: <br><br><ul><li>  redundant smartctl launches, and in turn each time it accessed the hard disk controller </li><li>  I had to do a separate parsing for Linux and Windows.  It is especially painful to work with Win now: (for / F ... so ... we screen double quotes with more quotes .... Aaaa !!!!) </li></ul><br>  We will try to get rid of all this in 3.4. <br><br>  The case of smartmontools has two differences from the example with the counter above: <br><br><ul><li>  smartctl does not return us JSON </li><li>  There are different numbers of disks in the server, so we need to use <a href="https://www.zabbix.com/documentation/3.4/ru/manual/discovery/low_level_discovery">low-level detection</a> (LLD). </li></ul><br>  But do not worry!  Firstly, dependent data elements work for LLD, and secondly, PCRE regex is among the preprocessing filters.  We will use it to pull out the necessary indicators from the not super strongly structured answer of the utility.  About this: <br><br><img src="https://habrastorage.org/web/85d/44e/102/85d44e1029b84e3e991285c404b8da1d.PNG"><br><br>  Let's get started <br><br><h3>  Simplify UserParameters </h3><br>  It was: <br><br><pre> <code class="hljs perl">UserParameter=uHDD[*], sudo smartctl -A $1| <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> -i <span class="hljs-string"><span class="hljs-string">"$2"</span></span>| tail -<span class="hljs-number"><span class="hljs-number">1</span></span>| cut -c <span class="hljs-number"><span class="hljs-number">88</span></span>-|cut -f1 -d<span class="hljs-string"><span class="hljs-string">' '</span></span> UserParameter=uHDD.model.[*],sudo smartctl -i $1 |<span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> -i <span class="hljs-string"><span class="hljs-string">"Device Model"</span></span>| cut -f2 -d: |<span class="hljs-keyword"><span class="hljs-keyword">tr</span></span> -d <span class="hljs-string"><span class="hljs-string">" "</span></span> UserParameter=uHDD.sn.[*],sudo smartctl -i $1 |<span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> -i <span class="hljs-string"><span class="hljs-string">"Serial Number"</span></span>| cut -f2 -d: |<span class="hljs-keyword"><span class="hljs-keyword">tr</span></span> -d <span class="hljs-string"><span class="hljs-string">" "</span></span> UserParameter=uHDD.health.[*],sudo smartctl -H $1 |<span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> -i <span class="hljs-string"><span class="hljs-string">"test"</span></span>| cut -f2 -d: |<span class="hljs-keyword"><span class="hljs-keyword">tr</span></span> -d <span class="hljs-string"><span class="hljs-string">" "</span></span> UserParameter=uHDD.errorlog.[*],sudo smartctl -l error $1 |<span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> -i <span class="hljs-string"><span class="hljs-string">"ATA Error Count"</span></span>| cut -f2 -d: |<span class="hljs-keyword"><span class="hljs-keyword">tr</span></span> -d <span class="hljs-string"><span class="hljs-string">" "</span></span> UserParameter=uHDD.discovery,sudo /etc/zabbix/scripts/smartctl-disks-discovery.pl</code> </pre><br>  It became: <br><br><pre> <code class="hljs pgsql">UserParameter=uHDD.A[*],sudo smartctl -A <span class="hljs-meta"><span class="hljs-meta">$1</span></span> UserParameter=uHDD.i[*],sudo smartctl -i <span class="hljs-meta"><span class="hljs-meta">$1</span></span> UserParameter=uHDD.health[*],sudo smartctl -H <span class="hljs-meta"><span class="hljs-meta">$1</span></span> UserParameter=uHDD.discovery,sudo /etc/zabbix/scripts/smartctl-disks-discovery.pl</code> </pre><br>  We do the same for Windows, simultaneously getting rid of CMD magic using for / F and <b>find</b> .  You can see <a href="https://github.com/v-zhuravlev/zbx-smartctl">here</a> . <br><br><h3>  Create new parent data items. </h3><br>  To collect all the attributes of SMART create a prototype of the master data element: <br><br><img src="https://habrastorage.org/web/c44/d31/ea2/c44d31ea2c83415397e877fd65fa63e9.png"><br><br>  As in the previous example, nothing special needs to be configured.  Only the Type of information is Text, and the Storage period is 1 day. <br><br>  To collect test results and inventory data, we will need to run smartctl with other keys.  Therefore, in the same way, we will create two more data items: <br><br><ul><li>  uHDD.i ["{# DISKNAME}"] </li><li>  uHDD.health ["{# DISKNAME}"] </li></ul><br><h3>  Configure getting our SMART disk attributes </h3><br>  Create a dependent data element for attribute <b>5, Reallocated</b> : <br><br><img src="https://habrastorage.org/web/8e6/b93/2eb/8e6b932ebb9544f1ab973f5d33b44f78.png"><br><br>  And in the tab "Pre-processing" we use a regular expression: <br><br><img src="https://habrastorage.org/web/2d2/551/86b/2d255186bd9b45b582fa795a315bab05.png"><br><br>  And just like with the JSON Path, in order not to spend a lot of time debugging and catching errors, before filling in a regex, it is convenient to quickly check the correctness of the expression online, for example, here: <a href="https://regex101.com/">regex101.com</a> copying our smartctl output there. <br><br>  As a result, we get the following list of prototypes: <br><br><img src="https://habrastorage.org/web/54b/38f/c80/54b38fc80e9f4766a38ef527b63e4102.png"><br><br><h3>  Testing, see what happened </h3><br>  For two HDDs: <br><br><img src="https://habrastorage.org/web/ca2/238/241/ca2238241bec4c51944d6425344b4a0f.png"><br><br>  For SSD under Windows: <br><br><img src="https://habrastorage.org/web/384/d42/45a/384d4245a17f443c89fbe85ab61fa4b5.png"><br><br>  Let's summarize the example with smartmontools: <br><br><ul><li>  we removed all parsing from UserParameters </li><li>  there are no external scripts (except LLD), no external dependencies, all parsing occurs on the Zabbix server, it is easy to see and correct it if necessary </li><li>  when the utility or API does not return XML / JSON - it does not matter, you can always try using regular expressions </li><li>  we don‚Äôt torture hard drives any more - first we get the whole list of SMART parameters, and then on the Zabbix server we decompose it by metrics. </li></ul><br>  The updated template (at the same time updated the triggers, added items for the SSD) is available in the decision repository on share.zabbix.com <a href="https://share.zabbix.com/storage-devices/smart-monitoring-with-smartmontools-lld">here</a> . <br><br><h2>  At the end </h2><br>  Mass collection of metrics is a simple and easy way to reduce the load on the network and on the resources of monitored systems, as well as reduce the need for external scripts.  We are sure that many Zabbix users will like it. <br><br>  PS The article is also available in English in our <a href="http://blog.zabbix.com/zabbix-3-4-mass-data-collection-using-mercury-and-smartmontools-as-an-example/">blog</a> . </div><p>Source: <a href="https://habr.com/ru/post/337856/">https://habr.com/ru/post/337856/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337842/index.html">How to speed up the loading site</a></li>
<li><a href="../337844/index.html">We invite you to Hackathon "M.Video": we are looking for solutions on the topic of AI and machine learning</a></li>
<li><a href="../337848/index.html">Hackathon HackCV, October 7-8</a></li>
<li><a href="../337852/index.html">Final Imagine Cup 2017 through the eyes of the MIPT team</a></li>
<li><a href="../337854/index.html">My 5 kopecks about Highload Cup 2017 or the history of the 9th place</a></li>
<li><a href="../337860/index.html">DBaaS: databases in the cloud</a></li>
<li><a href="../337862/index.html">RailsClub 2017. Interview with Luca Guidi, author Hanami: mix FP and OOP in Ruby</a></li>
<li><a href="../337864/index.html">Parallel Hystrix. Improve the performance of distributed applications</a></li>
<li><a href="../337866/index.html">Hi, Programmer</a></li>
<li><a href="../337868/index.html">How to write a good solution for Highload Cup, but not good enough to get to the top</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>