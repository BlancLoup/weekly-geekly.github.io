<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Connecting Digium E1 boards in FreeSWITCH</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, using the example of a single-port E1 Digium TE121P card, we consider an example of connecting it to FreeSWITCH on the CentOS operati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Connecting Digium E1 boards in FreeSWITCH</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/3d8/01b/73b/3d801b73bbd6b7f419a7ab2f046fcac5.jpg" alt="Digium TE12x"><br>  In this article, using the example of a single-port E1 <a href="http://www.digium.com/en/products/digital/single-span/">Digium TE121P</a> card, <a href="http://www.digium.com/en/products/digital/single-span/">we</a> consider an example of connecting it to FreeSWITCH on the CentOS operating system. <br><a name="habracut"></a><br><h4>  Physical connection </h4><br>  The physical connection you are supposed to provide a telephony provider.  The card has a 75 ohm RJ-45 connector. <br>  We, for example, use NSGate NS-200 / SB-LE modems with E1 + LAN + V.35 ports to connect to the provider, I highly recommend that you can immediately connect one dedicated line and E1 and Ethernet to the provider. <br>  Cable pinout can be viewed <a href="http://www.chebucto.ns.ca/Chebucto/Technical/Manuals/Max/max6000/gs/cables.htm">here</a> . <br>  When the card connects to the provider, the light on it lights up green, of course, if you configure everything correctly, as described below. <br><br><h4>  Customization </h4><br>  For the board to work, you need to install and configure three components: <br><ol><li>  <b>libPRI</b> is a library designed to work with ISDN TDM streaming interfaces: PRI (Primary Rate Interface) and BRI (Basic Rate Interface). </li><li>  <b>DAHDI</b> - drivers for Digium boards. </li><li>  <b>FreeTDM</b> - FreeSWITCH module for working with telephony cards. </li></ol><br><br><h4>  libPRI </h4><br>  Download libpri from here: <a href="http://downloads.asterisk.org/pub/telephony/libpri/">downloads.asterisk.org/pub/telephony/libpri</a> <br>  For example: <br><pre><code class="bash hljs">wget http://downloads.asterisk.org/pub/telephony/libpri/libpri-1.4-current.tar.gz</code> </pre>  And install: <br><pre> <code class="bash hljs">make make install</code> </pre> <br>  Actually install and everything.  It does not require any special configuration. <br>  FreeSWITCH interacts with DAHDI via libPRI. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  DAHDI </h4><br>  Also, the DAHDI installation process is described here: <a href="http://wiki.freeswitch.org/wiki/OpenZap_Dahdi">wiki.freeswitch.org/wiki/OpenZap_Dahdi</a> <br>  So, after installing the card, check it in the system. <pre> <code class="bash hljs">lspci -v</code> </pre>  And we look at what interruption the card is sitting on: <pre> <code class="bash hljs">cat /proc/interrupts</code> </pre>  If wctdm takes a separate irq, then it‚Äôs good, but if it shares it with someone, then it can affect the card‚Äôs performance and voice quality, so it‚Äôs best to separate the drivers across different interrupts. <br><br>  Download DAHDI from here: <a href="http://downloads.asterisk.org/pub/telephony/dahdi-linux-complete/">downloads.asterisk.org/pub/telephony/dahdi-linux-complete</a> <br>  For example: <br><pre> <code class="bash hljs">wget http://downloads.asterisk.org/pub/telephony/dahdi-linux-complete/dahdi-linux-complete-current.tar.gz</code> </pre>  Add Asterisk User <br><pre> <code class="bash hljs">adduser asterisk</code> </pre>  And create a folder in / etc <br><pre> <code class="bash hljs">mkdir /etc/asterisk</code> </pre>  We will not need it, but this will have to be done to avoid errors when installing drivers. <br><pre> <code class="bash hljs">make all make install</code> </pre>  If it was the first installation, you need to run the config to install the sample configuration files <br><pre> <code class="bash hljs">make config</code> </pre>  You can immediately enable DAHDI in autoload. <br><pre> <code class="bash hljs">chkconfig dahdi on</code> </pre> <br>  Run the DAHDI configuration generator <br><pre> <code class="bash hljs">/usr/sbin/dahdi_genconf</code> </pre> <br>  Editing the / etc / dahdi / modules file <br>  There should be one uncommented line: <br>  wcte12xp <br>  The rest of the modules we do not need, they need to be commented out so as not to load. <br><br>  Next, configure /etc/dahdi/system.conf: <br>  <u>Connection setup:</u> <br>  span = &lt;span num&gt;, &lt;timing source&gt;, &lt;line build out (LBO)&gt;, &lt;framing&gt;, &lt;coding&gt; [, yellow] <br>  <b>span num</b> - the serial number of the span <br>  <b>timing source</b> ‚Äî select the source for timer synchronization.  0 - master, 1 or more - master is the remote side.  The higher the number, the lower the priority. <br>  <b>line build out (LBO)</b> - selection depending on the distance to the remote side.  I do not know if it works in this case, but the table is as follows: <br>  0: 0 db (CSU) / 0-133 feet (DSX-1) <br>  1: 133-266 feet (DSX-1) <br>  2: 266-399 feet (DSX-1) <br>  3: 399-533 feet (DSX-1) <br>  4: 533-655 feet (DSX-1) <br>  5: -7.5db (CSU) <br>  6: -15db (CSU) <br>  7: -22.5db (CSU) <br>  <b>framing</b> is a type of telephone alarm.  For E1, select ccs or cas. <br>  <b>coding</b> - line coding.  For E1, choose ami or hdb3. <br>  <b>yellow</b> - check and generation of crc4 is performed. <br>  All these E1 parameters should be reported to your telephony provider (of course, except for span num). <br>  Next comes <u>the channel configuration:</u> <br>  &lt;device&gt; = &lt;channel list&gt; <br>  For the E1 stream, we will be interested in the device only bchan and dchan.  For E1, the following setting is used: <br>  bchan = 1-15,17-31 <br>  dchan = 16 <br>  The following describes the <u>time zone:</u> <br>  loadzone = &lt;zone&gt; <br>  defaultzone = &lt;zone&gt; <br>  The time zone is indicated by a two-letter code.  The default is us. <br>  The following describes the PCM encoding on the channels: <br>  The choice between mulaw (G.711u = PCMU) and alaw (G.711a = PCMA). <br>  The following describes <u>echo cancellers:</u> <br>  echocanceller = &lt;echocanceller name&gt;, &lt;channel's&gt; <br>  <b>echocanceller name</b> - mg2, kb1, sec2, sec. <br><br>  Here is my /etc/dahdi/system.conf file for example: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Autogenerated by ./dahdi_genconf on Tue Jun 7 18:38:22 2011 # If you edit this file and execute ./dahdi_genconf again, # your manual changes will be LOST. # Dahdi Configuration File # # This file is parsed by the Dahdi Configurator, dahdi_cfg # # Span 1: WCT1/0 "Wildcard TE121 Card 0" (MASTER) HDB3/CCS ClockSource. span=1,1,0,ccs,hdb3 bchan=1-15,17-31 dchan=16 alaw=1-15,17-31 loadzone = ru defaultzone = ru echocanceller=mg2,1-15,17-31</span></span></code> </pre> <br>  Now you can start DAHDI: <br><pre> <code class="bash hljs">service dahdi start</code> </pre> <br>  When installing DAHDI in / usr / sbin, several utilities are written: <br>  <b>dahdi_test</b> <br><pre> <code class="bash hljs">dahdi_test Opened pseudo dahdi interface, measuring accuracy... 99.999% 99.995% 99.999% 99.999% 99.999% 99.999% 99.999% --- Results after 7 passes --- Best: 99.999 -- Worst: 99.995 -- Average: 99.998506, Difference: 99.998507</code> </pre> <br>  Values ‚Äã‚Äãbelow 99.9 are bad results.  It means that the DAHDI device has to compete with other processes for interruptions and processor time, which can lead to a deterioration in sound quality. <br><br>  <b>dahdi_tool</b> <br>  Shows the status of the card and errors in its work. <br><img src="https://habrastorage.org/storage2/cd8/ce5/71f/cd8ce571f8a7d92dcde6472016ea9865.png" alt="dahdi_tool"><br><br>  <b>dahdi_scan</b> <br>  Shows information about the map, for example, like this: <br><pre> <code class="bash hljs">[1] active=yes alarms=OK description=Wildcard TE121 Card 0 name=WCT1/0 manufacturer=Digium devicetype=Wildcard TE121 (VPMADT032) location=PCI Bus 05 Slot 09 basechan=1 totchans=31 irq=169 <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=digital-E1 syncsrc=1 lbo=0 db (CSU)/0-133 feet (DSX-1) coding_opts=AMI,HDB3 framing_opts=CCS,CRC4 coding=HDB3 framing=CCS</code> </pre> <br>  <b>dahdi_cfg</b> [options] <br>  Shows the configuration <br><br>  <b>dahdi_hardware</b> <br>  Shows information about the installed card <br><br><h5>  FreeTDM </h5><br>  To work with the board you have to have the freetdm module installed on FreeSWITCH.  Moreover, it must be compiled with libpri support.  If it is compiled without libpri, you will have to recompile: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> libs/freetdm ./configure --with-libpri make make install</code> </pre> <br>  To configure FreeTDM, you need to adjust three files in the conf folder: freetdm.conf, zt.conf, and autoload_configs / freetdm.conf.xml.  Well, naturally, the FreeTDM module should be included in the autoload_configs / modules.conf.xml file. <br><br><h6>  Configure freetdm.conf </h6><br>  Configure the Zaptel / DAHDI section.  To do this, create (by default, it has already been created) the following section: <br>  [span zt myDAHDISpan] <br>  myDAHDISpan - any name you choose can be here. <br>  Please note that in this file the parameter is separated from the value by the ‚Äú=&gt;‚Äù sign. <br>  <b>name</b> - your chosen name. <br>  <b>trunk_type</b> ‚Äî Determines the type, possible values: E1, T1, J1, BRI, BRI_PTMP, FXO, FXS, EM. <br>  <b>group</b> - A conditional group name for outgoing calls, must begin with a letter.  Further, in the example of dialplan, we will see how it can be used. <br>  <b>txgain</b> - Gain or attenuate sound for transmission.  Type float.  Too much value may lead to distortion.  Typical values ‚Äã‚Äãrange from -5.0 to 5.0 <br>  <b>rxgain</b> - Gain or attenuate sound for reception.  Type float.  Too much value may lead to distortion.  Typical values ‚Äã‚Äãrange from -5.0 to 5.0 <br>  The <b>analog-start-type</b> and <b>number</b> options for E1 streams are not needed. <br>  <b>b-channel</b> - <b>b-channel</b> numbers.  From the bchan parameter (/etc/dahdi/system.conf file) <br>  <b>d-channel</b> ‚Äî The d-channel number.  From the dchan parameter (/etc/dahdi/system.conf file) <br>  The <b>fxo-channel</b> , <b>fxs-channel</b> and <b>em-channel</b> parameters are not needed in our case. <br>  The parameters <b>cas-channel</b> and <b>debugdtmf</b> may also be useful. <br>  An example of my working freetdm.conf: <br><pre> <code class="bash hljs">[span zt pri] name =&gt; pri trunk_type =&gt; E1 group =&gt; e1group b-channel =&gt; 1-15 d-channel =&gt; 16 b-channel =&gt; 17-31</code> </pre> <br><h6>  Configuring zt.conf </h6><br>  I did not bother with it and took all the default values: <br><pre> <code class="bash hljs">[defaults] codec_ms =&gt; 20 wink_ms =&gt; 150 flash_ms =&gt; 750 echo_cancel_level =&gt; 64 rxgain =&gt; 0.0 txgain =&gt; 3.0</code> </pre> <br><h6>  Configure freetdm.conf.xml </h6><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"freetdm.conf"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">description</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Freetdm Configuration"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">settings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"debug"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"7"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--&lt;param name="hold-music" value="$${moh_uri}"/&gt;--&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--&lt;param name="enable-analog-option" value="call-swap"/&gt;--&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--&lt;param name="enable-analog-option" value="3-way"/&gt;--&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">settings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">libpri_spans</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"pri"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"node"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"network"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"switch"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"euroisdn"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"l1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alaw"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"international"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"debug"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"all"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dialplan"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"XML"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"context"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">libpri_spans</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The <b>name</b> attribute is the name of the span that matches the name we specified in the freetdm.conf file. <br>  The remaining parameters can take the following values: <br>  <b>node or mode</b> is the node type (in brackets are valid synonyms): cpe (user), network (net) <br>  <b>switch or dialect</b> (in brackets - acceptable synonyms): ni1, ni2, dms100, lucent5e (5ess), att4ess (4ess), euroisdn (q931), gr303eoc, gr303tmc <br>  <b>l1 or layer1</b> : alaw, ulaw <br>  <b>dp or ton</b> : international, national, local, private, unknown <br>  As you understand these parameters, the provider to which you connect the E1 stream must inform. <br>  Next, specify where to send calls: <br>  <b>dialplan</b> - <b>dialplan</b> to which the call will be sent: XML, YAML, Asterisk (?) <br>  <b>context</b> - the context to which the call will be sent. <br>  The following parameters are optional: <br>  <b>debug</b> : q921_all, q921_raw, q921_dump, q921_state, q931_all, q931_dump, q931_state, q931_anomaly, config, apdu, aoc <br>  <b>overlapdial</b> (in brackets - valid synonyms): yes (both), incoming (receive), outgoing (send), no <br>  <b>opts</b> : suggest_channel, omit_display, omit_redirecting_number, aoc <br>  <b>service_message_support</b> : true, false <br>  The parameters of the node type, dialect, encoding, should be given to you by the telephony provider. <br>  And yes, parameter names have synonyms, i.e.  node = mode, switch = dialect. <br><br><h5>  Dialplan setup </h5><br>  Outgoing calls are written according to the following rule: <br>  freetdm / &lt;span name or group name&gt; / a / &lt;destination_number&gt; <br><br>  The letter "a" can be small, and maybe even big.  The size of the letter (hehe) determines how FreeTDM will select free channels in the span.  "A" - upwards, i.e.  from the first to the maximum, and ‚ÄúA‚Äù from top to bottom, i.e.  from the maximum (31, in our case) to the first. <br><br>  For example, all numbers starting with 9 are sent to our map. <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"outgoing_pri"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">condition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">field</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"destination_number"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">expression</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"^9(\d+)$"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">application</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bridge"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"freetdm/e1group/a/$1"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">condition</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  The following example sends all incoming calls to an extension card with the name ivr_main (in my case the IVR menu): <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"pri_input"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">condition</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">field</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"chan_name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">expression</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"^(FreeTDM)"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">application</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"set"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ringback=${ru-ring}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">application</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"set"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transfer_ringback=${ru-ring}"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">application</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transfer"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ivr_main XML default"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">condition</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Well, in general, something like that. <br><br>  The main source of information, of course, is here: <a href="http://wiki.freeswitch.org/wiki/FreeTDM">http://wiki.freeswitch.org/wiki/FreeTDM</a> <br>  There is also a lot of additional information, such as: CLI commands, SIP headers, channel variables, etc. </div><p>Source: <a href="https://habr.com/ru/post/141843/">https://habr.com/ru/post/141843/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141834/index.html">Meteor - A new way to create applications</a></li>
<li><a href="../141835/index.html">Disassembly of the Nikon D5100 DSLR and 18-55mm lens</a></li>
<li><a href="../141839/index.html">Linux Hacking Exercises</a></li>
<li><a href="../141840/index.html">Meetup Stack Overflow in Moscow</a></li>
<li><a href="../141841/index.html">–ódMax: create a clip with space scenes</a></li>
<li><a href="../141844/index.html">Could the word "browser" (and its derivative forms) sound different in Russian?</a></li>
<li><a href="../141847/index.html">Published video reports of the conference WebProfessionals</a></li>
<li><a href="../141849/index.html">Necomimi ears</a></li>
<li><a href="../141850/index.html">Cloud of contact centers "Beeline": what happens at peak load</a></li>
<li><a href="../141851/index.html">International Mobile Developers Conference MobileOptimized 2012</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>