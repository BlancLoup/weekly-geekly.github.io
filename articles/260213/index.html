<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introducing OsmocomBB: 0x03 Software</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello again! It's time to talk about building software for working with OsmocomBB. At this stage, beginning researchers may have difficulty, so I will...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introducing OsmocomBB: 0x03 Software</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/2dd/7bc/bb3/2dd7bcbb3fe542658f10e73e0d9a59f6.jpg"><br><br>  Hello again!  It's time to talk about building software for working with OsmocomBB.  At this stage, beginning researchers may have difficulty, so I will try to sort it all out.  In this part I will talk about the structure of the project, the principles of interaction between the phone and the computer, and also describe in detail the compilation process.  I recommend arming with some Linux distribution, because the server part of the project was developed specifically for this family of operating systems.  I also advise you to refrain from using virtual machines, as there may be problems with running applications on the phone due to time delays. <br><a name="habracut"></a><br><h3>  Navigation </h3><br><ul><li>  <a href="http://habrahabr.ru/post/257631/">0x01 Introduction</a> </li><li>  <a href="http://habrahabr.ru/post/258661/">0x02 Hardware</a> </li><li>  <a href="https://habr.com/ru/post/260213/">0x03 Software</a> </li></ul><br><h3>  Basics of the basics </h3><br>  The GSM protocol stack, which regulates the processes of interaction between mobile phones and base stations, can be divided into 3 logical levels: <br><br><ul><li>  <b>Layer 1:</b> Physical level.  Local protocols describe the principles of interaction of devices in the radio.  Two technologies of multiple access are used to ensure simultaneous interaction between the network and several mobile devices in GSM networks: FDMA (Frequency-Division Multiple Access) and TDMA (Time-Division Multiple Access).  FDMA implies splitting the available frequency range into channels (ARFCN), each of which allows you to transfer data from subscribers to the network (uplink) and from the network to subscribers (downlink).  TDMA involves multiplexing a physical channel with time division, that is, each device is provided with the ability to receive and transmit data at certain points in time.  According to TDMA, the physical channel (ARFCN) is divided into several logical channels, for example, PCH (Paging channel), on which the base station notifies the phone of an incoming call, or BCCH (Broadcast Control channel), used to identify the base station with mobile phones.  And so on... <img src="https://habrastorage.org/files/4eb/283/4a8/4eb2834a89cf47c68ad8a3c905060956.gif"></li><li>  <b>Layer 2:</b> The link layer, the main tasks of which are: establishing, maintaining and breaking connections between network devices;  control of data flows, error detection, and third level data transit.  At this level, the LAPD and LAPDm protocols work, multiple connections are provided, as well as the functionality of the logical channels BCCH, PCH, AGCH and DCCH. </li><li>  <b>Layer 3:</b> Network layer, divided into three sublevels: <br><ul><li>  <b><a href="https://en.wikipedia.org/wiki/Radio_Resource_Management">Radio Resource</a> (RR)</b> is a sublayer responsible for the creation and release of logical channels between devices; </li><li>  <b><a href="https://en.wikipedia.org/wiki/Mobility_management">Mobility Management</a> (MM)</b> ‚Äîa sublayer that authenticates users and also tracks the movement of subscribers between the coverage areas (cells) of different base stations; </li><li>  <b><a href="https://en.wikipedia.org/wiki/Call_control">Call Control</a> (CC)</b> - sublevel responsible for phone calls. </li></ul><br></li></ul>  A detailed description of this topic can be found in <a href="https://en.wikipedia.org/wiki/Um_interface">Wikipedia</a> .  Most of all, we are interested in the distribution of roles between the telephone and the computer: <br><img src="https://habrastorage.org/files/6a4/739/ff3/6a4739ff38f947a3b68184c9d7c5cafd.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The physical level works on the phone, the other two are implemented on the computer side.  As mentioned in the previous article, the phone and computer interact through the phone‚Äôs UART interface. <br><br><h3>  OsmocomBB Review </h3><br>  Let's start with the fact that OsmocomBB is developed based on the Git version control system, and its source codes are available on the official website <a href="http://git.osmocom.org/osmocom-bb/">git.osmocom.org</a> .  Most project features, such as RSSI, an interface for receiving / making voice calls and exchanging SMS messages, are available in the main branch of the project (master).  However, the most interesting features are available in the form of branches of the repository - branches (branch): <br><br><ul><li><h6>  <b>luca / catcher</b> </h6>  Perhaps you've ever heard of the <a href="https://en.wikipedia.org/wiki/IMSI-catcher">IMSI-Catcher</a> .  Most often, IMSI-Catcher implies a device masquerading as a real base station for the purpose of collecting <a href="https://ru.wikipedia.org/wiki/IMSI">IMSI (international mobile subscriber ID) of the</a> nearest subscribers (which, for example, allows tracking their location).  It is more correct to assume that IMSI-Catching is only one of the capabilities of fake base stations (FakeBTS), the principle of which is quite simple.  IMSI and IMEI subscriber codes are transmitted to the base station only at the moment of its connection, then the subscriber is assigned a temporary TMSI identifier, on the basis of which their further interaction takes place.  TMSI, unlike IMSI, is not permanent and changes when connected to other base stations.  To de-anonymize the subscriber, the attacker launches his base station (for example, based on USRP), the signal power of which exceeds the power of the real base stations.  Due to this, the subscriber's phone connects to the station with a more powerful signal, and then transmits its IMSI and IMEI codes.  Sometimes, FakeBTS can act as an intermediary between a subscriber and a real base station, allowing an attacker to perform various MiTM-attacks, as well as spend the subscriber's money.  No matter how frightening it may sound, the presence of such "miracles" on the air can be detected, for example, using projects: <a href="http://fakebts.com/en/">FakeBTS</a> or <a href="https://secupwn.github.io/Android-IMSI-Catcher-Detector/">Android IMSI-Catcher Detector</a> .  The author of this branch also integrated into the project the ability to detect such activity.  Read more about this <a href="https://opensource.srlabs.de/projects/mobile-network-assessment-tools/wiki/CatcherCatcher">here</a> . </li><li><h6>  <b>jolly / emi</b> </h6>  It integrates an EMI application designed to conduct stress tests of wireless equipment.  Read more on the project site <a href="http://bb.osmocom.org/trac/wiki/emi-firmware">wiki / emi-firmware</a> .  Also, do not forget that broadcasting on GSM frequencies in many countries, including the Russian Federation, requires a license.  If the license is all difficult, you can use the <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BB%25D0%25B5%25D1%2582%25D0%25BA%25D0%25B0_%25D0%25A4%25D0%25B0%25D1%2580%25D0%25B0%25D0%25B4%25D0%25B5%25D1%258F">Faraday cage</a> . </li><li><h6>  <b>sylvain / burst_ind</b> </h6>  The main focus of this thread is on GSM traffic sniffing, which I will discuss in more detail in one of the following articles. </li><li><h6>  <b>jolly / menu</b> </h6>  This branch will allow you to write applications to the flash-memory of the phone.  What for?  For example, if you need autonomy when using the phone in any portable projects.  It is possible to flash the boot menu, which using the graphical interface will provide the choice of the application to download.  The firmware process is described on the <a href="http://bb.osmocom.org/trac/wiki/flashing_new">wiki / flashing_new</a> page. </li><li><h6>  <b>luca / libosmosim</b> </h6>  This branch will allow you to use an OsmocomBB-compatible phone to interact with the SIM card.  After the project is built in the <i>src / host / layer23 / src / libosmosim / .libs</i> folder, the libosmosim.so library will be available, on the basis of which the <a href="https://opensource.srlabs.de/projects/simtester">SIMTester</a> project is <a href="https://opensource.srlabs.de/projects/simtester">running</a> .  With it, you can check the cryptographic strength of SIM-cards, as well as the security of applications installed on them. </li><li><h6>  <b>sylvain / testing</b> </h6>  Here you can find the TRX application, which turns an OsmocomBB-compatible phone into a small base station.  I will tell you more about this later, but for now you can read a small HOWTO <a href="http://bb.osmocom.org/trac/wiki/Software/Transceiver">wiki / Software / Transceiver</a> and watch a presentation <a href="http://media.ccc.de/browse/congress/2012/29c3-5226-en-further_hacks_calypso_h264.html">on the phone</a> . </li></ul><br>  The remaining branches of the repository mainly contain corrections and innovations of other developers of the project, which sometimes fall into the master branch.  OsmocomBB has a <a href="http://bb.osmocom.org/trac/wiki/Software/AreasOfWork">lot of</a> development vectors, so any interested developer can join the project development. <br><br><h3>  Build project </h3><br>  Let's determine the location of files and folders.  Based on my experience, I recommend creating the / opt / osmocom folder - in it we will store libraries and cross-compiler.  And to build a project, use, for example, a home folder, or another place for which you do not need administrator rights.  As a result of the project compilation, you will receive applications (firmware) running on the phone, and programs for interacting with them from the computer (server) side.  The build process is described using the example of Ubuntu 14.04, so the command syntax may differ slightly on other distributions.  So what do we need? <br><br><ul><li>  <b>libosmocore</b> is the main library of the project, details of which can be found in the <a href="http://bb.osmocom.org/trac/wiki/libosmocore">wiki / libosmocore section</a> .  Despite the fact that a part of its source code is supplied when cloning the OsmocomBB repository, it should be collected separately; </li><li>  <b>Cross-compiler</b> - OsmocomBB-compatible phones are mainly built on the basis of the ARM platform, so you need a cross-compiler (toolchain) to build the firmware.  The developers recommend using exactly the version of the cross-compiler, which is listed on the site, as when using third-party firmware can work unstable.  The cross-compiler <a href="http://bb.osmocom.org/trac/wiki/GnuArmToolchain">build</a> is described in the <a href="http://bb.osmocom.org/trac/wiki/GnuArmToolchain">wiki / GnuArmToolchain section</a> ; however, when compiling on modern systems, an error often occurs, so I created a <a href="https://github.com/axilirator/gnu-arm-installer">fork</a> with a fixed installer. </li></ul><br>  To compile the source code, we need autoconf, automake, libtool, pkg-config, make and GCC.  At the same time create the / opt / osmocom directory: <br><br><pre><code class="hljs smalltalk">#      ,     sudo. <span class="hljs-string"><span class="hljs-string">$ </span></span>sudo su #  . <span class="hljs-string"><span class="hljs-string">$ </span></span>apt get update <span class="hljs-string"><span class="hljs-string">$ </span></span>apt-get install libtool shtool automake autoconf git-core pkg-config make gcc #      -. <span class="hljs-string"><span class="hljs-string">$ </span></span>mkdir /opt/osmocom</code> </pre> <br>  In the process of assembling source codes, errors often occur.  More often than not, there are not enough libraries.  On <a href="http://baseband-devel.722152.n3.nabble.com/">baseband-devel.722152.n3.nabble.com</a> you can find ways to solve most of them - use the search.  If the error occurs during the configuration process (autoreconf or ./configure commands), try to resolve it and reconfigure it. <br><br>  Let's start with libosmocore: <br><br><pre> <code class="hljs smalltalk"><span class="hljs-string"><span class="hljs-string">$ </span></span>cd /opt/osmocom <span class="hljs-string"><span class="hljs-string">$ </span></span>git clone git://git.osmocom.org/libosmocore.git <span class="hljs-string"><span class="hljs-string">$ </span></span>cd libosmocore <span class="hljs-string"><span class="hljs-string">$ </span></span>autoreconf -i #  pcsclite    libosmocore. <span class="hljs-string"><span class="hljs-string">$ </span></span>apt-get install libpcsclite-dev <span class="hljs-string"><span class="hljs-string">$ </span></span>./configure <span class="hljs-string"><span class="hljs-string">$ </span></span>make <span class="hljs-string"><span class="hljs-string">$ </span></span>make install</code> </pre><br>  Go ahead.  Building a cross-compiler is the main source of errors and takes most of the time.  In most cases, the error <code>"@itemx must follow @item"</code> occurs.  The fact is that the assembly requires an older version of TexInfo.  You can run downgrade manually, or you can use my fixed version of the installer: <br><br><pre> <code class="hljs smalltalk"><span class="hljs-string"><span class="hljs-string">$ </span></span>cd /opt/osmocom #  -. <span class="hljs-string"><span class="hljs-string">$ </span></span>apt-get install build-essential libgmp3-dev libmpfr-dev libx11<span class="hljs-number"><span class="hljs-number">-6</span></span> libx11-dev flex bison libncurses5 libncurses5-dbg libncurses5-dev libncursesw5 libncursesw5-dbg libncursesw5-dev zlibc zlib1g-dev libmpfr4 libmpc-dev texinfo #   . <span class="hljs-string"><span class="hljs-string">$ </span></span>git clone https://github.com/axilirator/gnu-arm-installer.git gnu-arm-toolchain <span class="hljs-string"><span class="hljs-string">$ </span></span>cd gnu-arm-toolchain #   . <span class="hljs-string"><span class="hljs-string">$ </span></span>./download.sh #    <span class="hljs-string"><span class="hljs-string">$ </span></span>./build.sh</code> </pre><br>  <b>UPD:</b> Despite the fact that the project site has an updated version of the cross-compiler based on GCC 4.8.2, Binutils 2.21.1 and Newlib 1.19, I recommend using its previous version available in my repository.  As a result of the compilation of the code of such forks of the project as <a href="https://github.com/DrWhax/osmocom-bb-raw">DrWhax / osmocom-bb-raw</a> and <a href="https://github.com/offlinehacker/osmocombb">offlinehacker / osmocombb</a> , the layer1 firmware hangs when trying to synchronize with the base station.  In the firmware of the official project repository compiled with the new version of the cross-compiler, similar problems are not observed. <br><br>  If errors occur, <a href="https://google.com/">Google</a> will always come to the rescue.  Additional libraries may be required.  It all depends on your distribution.  In any case, you need to achieve a successful build and the message ‚ÄúBuild complete!‚Äù, After which you need to add the path to the cross-compiler executable files to the PATH environment variable. <br><br><pre> <code class="hljs smalltalk">#     . <span class="hljs-string"><span class="hljs-string">$ </span></span>su &lt;  &gt; <span class="hljs-string"><span class="hljs-string">$ </span></span>cd ~ # ,   /opt/osmocom/gnu-arm-toolchain/install/bin/    #   -, ,    ls. #   : <span class="hljs-string"><span class="hljs-string">$ </span></span>gedit .bashrc #      : # export <span class="hljs-type"><span class="hljs-type">PATH</span></span>=<span class="hljs-string"><span class="hljs-string">$P</span></span>ATH:/opt/osmocom/gnu-arm-toolchain/install/bin/ #   . <span class="hljs-string"><span class="hljs-string">$ </span></span>source .bashrc #    : <span class="hljs-string"><span class="hljs-string">$ </span></span>arm-elf-gcc -v #        . #         bin      <span class="hljs-type"><span class="hljs-type">PATH</span></span>.</code> </pre><br>  Congratulations!  Now your system is ready to build OsmocomBB.  It's time to build the master branch. <br><br><pre> <code class="hljs smalltalk">#      osmocombb: <span class="hljs-string"><span class="hljs-string">$ </span></span>mkdir ~/osmocombb <span class="hljs-string"><span class="hljs-string">$ </span></span>cd ~/osmocombb #  : <span class="hljs-string"><span class="hljs-string">$ </span></span>git clone git://git.osmocom.org/osmocom-bb.git master # : <span class="hljs-string"><span class="hljs-string">$ </span></span>cd master/src <span class="hljs-string"><span class="hljs-string">$ </span></span>make</code> </pre><br>  If the error <code>"no such instruction: `eor %edx,%ecx,%ecx,ror'"</code> occurs, then your cross-compiler executable files are not available - check everything again.  Remember this sequence of actions - it is used every time you build a new branch.  To clone a specific repository branch, use the -b flag, for example: <br><br><pre> <code class="hljs 1c"><span class="hljs-meta"><span class="hljs-meta">#    sylvain/burst_ind: $ cd ~/osmocombb $ git clone git:</span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//git.osmocom.org/osmocom-bb.git -b sylvain/burst_ind burst_ind</span></span></span></span></code> </pre><br><h3>  Run Hello, world! </h3><br>  The most awaited moment.  First you need to clarify the platform of your phone (on the <a href="http://bb.osmocom.org/trac/wiki/Hardware/Phones">wiki / Hardware / Phones</a> page), for example, for the C123, C115 and C118 - this is Compal E88.  The firmware for each platform is located in the same directory under the path src / target / firmware / board /.  So, turn off the phone, connect the cable to the computer, then: <br><br><pre> <code class="hljs 1c"><span class="hljs-meta"><span class="hljs-meta">#    : $ cd ~/osmocombb/master/src/ #  ,    </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">  E88: $ host/osmocon/osmocon -m c123xor -p /dev/ttyUSB0 target/firmware/board/compal_e88/hello_world.compalram.bin #      . #   , </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword"></span></span></span><span class="hljs-meta">     .</span></span></code> </pre><br><img src="https://habrastorage.org/files/893/d12/4c4/893d124c40f34f0b8a6c9e85520dd93a.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">Conclusion:</b> <div class="spoiler_text">  Received PROMPT1 from phone responding with CMD <br>  read_file (target / firmware / board / compal_e88 / hello_world.compalram.bin): file_size = 25180, hdr_len = 4, dnload_len = 25187 <br>  got 1 bytes from modem, data looks like: 1b. <br>  got 1 bytes from modem, data looks like: f6. <br>  got 1 bytes from modem, data looks like: 02. <br>  got 1 bytes from modem, data looks like: 00. <br>  got 1 bytes from modem, data looks like: 41 A <br>  got 1 bytes from modem, data looks like: 02. <br>  got 1 bytes from modem, data looks like: 43 C <br>  Received PROMPT2 from phone, starting download <br>  handle_write (): 4096 bytes (4096/25187) <br>  handle_write (): 4096 bytes (8192/25187) <br>  handle_write (): 4096 bytes (12288/25187) <br>  handle_write (): 4096 bytes (16384/25187) <br>  handle_write (): 4096 bytes (20480/25187) <br>  handle_write (): 4096 bytes (24576/25187) <br>  handle_write (): 611 bytes (25187/25187) <br>  handle_write (): finished <br>  got 1 bytes from modem, data looks like: 1b. <br>  got 1 bytes from modem, data looks like: f6. <br>  got 1 bytes from modem, data looks like: 02. <br>  got 1 bytes from modem, data looks like: 00. <br>  got 1 bytes from modem, data looks like: 41 A <br>  got 1 bytes from modem, data looks like: 03. <br>  got 1 bytes from modem, data looks like: 42 B <br>  Received DOWNLOAD ACK from phone, your code is running now! <br>  battery_compal_e88_init: starting up <br><br>  OsmocomBB Hello World (revision osmocon_v0.0.0-1754-gfc20a37-modified) <br>  ================================================= ==================== <br>  Device ID code: 0xb4fb <br>  Device Version code: 0x0000 <br>  ARM ID code: 0xfff3 <br>  cDSP ID code: 0x0128 <br>  Die ID code: 14190d16f00215c6 <br>  ================================================= ==================== <br>  REG_DPLL = 0x2413 <br>  CNTL_ARM_CLK = 0xf0a1 <br>  CNTL_CLK = 0xff91 <br>  CNTL_RST = 0xfff3 <br>  CNTL_ARM_DIV = 0xfff9 <br>  ================================================= ==================== <br>  REG_DPLL = 0x2413 <br>  CNTL_ARM_CLK = 0xf0a1 <br>  CNTL_CLK = 0xff91 <br>  CNTL_RST = 0xfff3 <br>  CNTL_ARM_DIV = 0xfff9 <br>  ================================================= ==================== <br>  entering interrupt loop <br>  BAT-ADC: 549 4 0 0 1023 392 449 127 <br>  Charger at 34 mV. <br>  Battery at 3753 mV. <br>  Charging at 0 mA. <br>  Battery capacity is 69%. <br>  Battery range is 3199..3999 mV. <br>  Battery full at 468 LSB ... full at 585 LSB <br>  Charging at 239 LSB (204 mA). <br>  BCICTL2 = 0x3ff <br>  battery-info.flags = 0x00000000 <br>  bat_compal_e88_chg_state = 0 <br></div></div><br>  If something goes wrong while loading, the bootloader may hang.  Just remove the battery for a couple of seconds and reinsert it. <br><br><h3>  What happens and how does it work? </h3><br>  We will deal with everything in order.  When launched, the osmocon program blocks the serial port and waits for the bootloader messages, sending special beacon messages.  The built-in phone loader when you press the power button sends to the serial port a request to download the firmware (ACK).  If nobody answers him, he simply sends the message "@ftmtoolerror".  In our case, osmocon accepts the request (as indicated by the line ‚ÄúReceived PROMPT1 from phone responding with CMD‚Äù) and responds with a special message (file_size = 25180, hdr_len = 4, dnload_len = 25187).  Then the phone loader either agrees to load the firmware (Received PROMPT2 from the phone, starting download), or reports an error.  As soon as the firmware is loaded (handle_write (): finished) into RAM, the loader notifies us again (Received DOWNLOAD ACK from phone, your code is running now!) And provides power to the board (battery_compal_e88_init: starting up).  Your phone shows the well-known words ‚ÄúHello, world!‚Äù, And the code already running on it is written to the console.  Cool! <br><br><h3>  FTMTOOL error </h3><br>  This error in most cases occurs due to cable and / or converter problems, when osmocon cannot communicate with the bootloader.  Make sure that the GND, RxD and TxD pins are properly connected, and the chipset name of your USB-TTL converter is included in the <a href="http://bb.osmocom.org/trac/wiki/Hardware/SerialCable">list of recommended ones</a> .  Try pressing the power button again after a few seconds.  Also, for some phone models and converters, the value of the -m key of the osmocon program should be specified without ending xor, for example, <i>-m c123</i> instead of <i>-m c123xor</i> . <br><br><div class="spoiler">  <b class="spoiler_title">Osmocon output in case of error:</b> <div class="spoiler_text">  got 1 bytes from modem, data looks like: 00. <br>  got 1 bytes from modem, data looks like: 00. <br>  got 1 bytes from modem, data looks like: 81. <br>  got 4 bytes from modem, data looks like: 1b f6 02 00 ... <br>  got 1 bytes from modem, data looks like: 41 A <br>  got 1 bytes from modem, data looks like: 01. <br>  got 1 bytes from modem, data looks like: 40 @ <br>  Received PROMPT1 from phone responding with CMD <br>  read_file (chainloader): file_size = 32, hdr_len = 4, dnload_len = 39 <br>  got 1 bytes from modem, data looks like: 66 f <br>  got 1 bytes from modem, data looks like: 74 t <br>  got 1 bytes from modem, data looks like: 6d m <br>  got 1 bytes from modem, data looks like: 74 t <br>  got 1 bytes from modem, data looks like: 6f o <br>  got 1 bytes from modem, data looks like: 6f o <br>  got 1 bytes from modem, data looks like: 6c l <br>  Received FTMTOOL from phone, ramloader has aborted <br>  got 1 bytes from modem, data looks like: 65 e <br>  got 1 bytes from modem, data looks like: 72 r <br>  got 1 bytes from modem, data looks like: 72 r <br>  got 1 bytes from modem, data looks like: 6f o <br>  got 1 bytes from modem, data looks like: 72 r <br>  got 1 bytes from modem, data looks like: 00. <br></div></div><br><h3>  Does it violate the law? </h3><br>  The application launched by us does not interact with the cellular network, but before launching other applications, I would like to dwell on the issue of legality.  In some countries, using third-party software to interact with cellular networks is illegal.  The conditions on which cellular services are provided may vary among different operators, and, more often than not, do not allow the use of non-certified software.  Therefore, by default, the ability to transfer data to the network is disabled.  If you know what you are doing and your actions do not violate existing laws, you can enable data transfer before building the project in the src / target / firmware / Makefile file by uncommenting the line "CFLAGS + = -DCONFIG_TX_ENABLE".  The project authors have devoted a small <a href="http://bb.osmocom.org/trac/wiki/LegalAspects">wiki / LegalAspects</a> page to this issue. <br><br><h3>  The structure of the project, the process of downloading applications (firmware) </h3><br>  There are three folders in the root folder: doc, include, and src.  There is hardly anything useful in doc or include.  We are most interested in the src folder, which contains the following directories: <br><br><ul><li>  <b>host</b> - the source code of the programs executed on the server side; </li><li>  <b>target</b> - the source code of the firmware, as well as libraries for their compilation; </li><li>  <b>target_dsp</b> - tools for working with executable DSP code and plugins for IDA; </li><li>  <b>wireshark</b> - patches for old versions of Wireshark; </li><li>  <b>shared</b> - contains a copy of the libosmocore library used to build the firmware. </li></ul><br>  More information about the structure of the project can be found in the file README.development.  The source codes of the OsmocomBB applications are stored in the src / target / firmware / apps folder, and their compiled versions are available separately for each platform in the / src / target / firmware / board folder.  You can find two versions of the compiled application (firmware): compalram and highram.  The first option is to download using the standard phone loader.  Some ‚Äúvoluminous‚Äù applications, for example, RSSI, cannot be loaded with the standard loader, therefore, ‚Äúchain loading‚Äù is performed: first, the custom loader loader.compalram.bin is loaded, which loads firmware of the highram type.  The syntax of the "download chain": <br><br><pre> <code class="hljs swift">#       : $ host/osmocon/osmocon -m c123xor -p /dev/ttyUSB0 -<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> target/firmware/board/compal_e88/rssi.highram.bin target/firmware/board/compal_e88/chainload.compalram.bin #      chainload   osmocon,     . #    -<span class="hljs-built_in"><span class="hljs-built_in">c</span></span>: $ host/osmocon/osmocon -m c123xor -p /dev/ttyUSB0 -<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> target/firmware/board/compal_e88/rssi.highram.bin</code> </pre><br>  As soon as you need to shut down the application, stop the osmocon process, and then press and hold the shutdown button for two seconds. <br><br><h3>  What is interesting here? </h3><br>  A few words about the applications available in the various branches of the project.  A more detailed review will be devoted to the following article, but for now you can read the official <a href="http://bb.osmocom.org/trac/wiki/Applications">wiki / Applications</a> documentation. <br><br><h4>  Interaction with equipment </h4><br><ul><li>  <b>osmocon</b> - downloads firmware into the phone's RAM, and also creates an interface for exchanging information between the firmware and other server programs.  The -m parameter allows you to specify the data exchange protocol for various phone models, and the -c option performs a chainloading of heavyweight applications that the standard phone loader cannot load. </li><li>  <b>osmoload</b> - allows you to read and write the contents of the flash-memory of the phone.  Used when flashing applications.  Read more on the <a href="http://bb.osmocom.org/trac/wiki/flashing">wiki / flashing</a> page. </li><li>  <b>calypso_pll, rita_pll</b> - used to get information about the chipset and transceiver of the phone. </li></ul><br><h4>  Applications 2 and 3 levels of the GSM protocol stack </h4><br><ul><li>  <b>mobile</b> is an application that implements the functionality of a regular phone, expanded with additional functionality for interaction with the GSM network.  Read more on the <a href="http://bb.osmocom.org/trac/wiki/mobile">wiki / mobile</a> page. </li><li>  <b>cell_log</b> - allows you to scan the frequency range, find the nearest base station, as well as receive information about them (received signal power, MNC, MCC and other system information).  Allows you to synchronize with the base station and receive information transmitted on the <a href="https://en.wikipedia.org/wiki/Broadcast_control_channel">BCCH</a> channel. </li><li>  <b>ccch_scan, bcch_scan</b> - allow you to synchronize with the base station and receive its service information. </li><li>  <b>cbch_sniff</b> - allows you to record network service information to a file. </li><li>  <b>gsmmap</b> - using cell_log output, generates a KML file for Google Maps, visualizing the location of base stations on the map. </li></ul><br><h4>  Applications running on the phone </h4><br><ul><li>  <b><a href="">loader.bin</a></b> - loader, written by the developers of the project.  It is used for reading and writing flash-memory, as well as during ‚Äúchain loading‚Äù. </li><li>  <b><a href="">compal_dsp_dump.bin</a></b> - allows you to get a dump of the contents of the DSP-processor. </li><li>  <b><a href="http://bb.osmocom.org/trac/wiki/flashing_new">menu.bin</a></b> - provides the ability to select applications to download from flash-memory. </li><li>  <b><a href="http://bb.osmocom.org/trac/blog/rssi-firmware">rssi.bin</a></b> is an application that allows you to track the received signal power on various channels of the cellular network. </li><li>  <b><a href="http://bb.osmocom.org/trac/wiki/emi-firmware">emi.bin</a></b> is an application for stress testing wireless equipment. </li><li>  <b>layer1.bin</b> - used to interact with the cellular network and SIM-card. </li><li>  <b><a href="http://bb.osmocom.org/trac/wiki/Software/Transceiver">trx.bin</a></b> - turns your phone into a Transceiver for running OpenBTS or OsmoBTS. </li></ul><br><h3>  The end? </h3><br>  This article has come to an end.  I hope this material will be useful as a novice researcher of mobile networks, and a specialist in this field.  In the next article I will talk more about applications compiled by us and their practical application, but for now, by tradition, leave a list of interesting articles, presentations and speeches: <br><br><ul><li>  <a href="http://media.ccc.de/browse/congress/2012/29c3-5333-en-gsm_cell_phone_network_review_h264.html">GSM cell phone network review</a> </li><li>  <a href="http://events.ccc.de/congress/2010/Fahrplan/attachments/1783_101228.27C3.GSM-Sniffing.Nohl_Munaut.pdf">GSM Sniffing (Sylvain Munaut, Karsten Nohl)</a> </li><li>  <a href="http://snake.cs.uidaho.edu/~pere5027/gsm/Pereyda_GsmSniffing.pdf">GSM Sniffing (Joshua Pereyda)</a> </li><li>  <a href="http://events.ccc.de/camp/2011/Fahrplan/attachments/1868_110810.SRLabs-Camp-GRPS_Intercept.pdf">GPRS Intercept: Wardriving your country (Karsten Nohl, Luca Melette)</a> </li><li>  <a href="https://www.youtube.com/watch%3Fv%3D0hjn-BP8nro">Blackhat 2010: Attacking Phone Privacy (Karsten Nohl)</a> </li><li>  <a href="https://xakep.ru/2012/02/20/58309/">Receiving device coordinates in GSM-protocol (Anatoly Alizar)</a> </li></ul><br>  Successes to all! <br><br><h3>  Navigation </h3><br><ul><li>  <a href="http://habrahabr.ru/post/257631/">0x01 Introduction</a> </li><li>  <a href="http://habrahabr.ru/post/258661/">0x02 Hardware</a> </li><li>  <a href="https://habr.com/ru/post/260213/">0x03 Software</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/260213/">https://habr.com/ru/post/260213/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260187/index.html">Emulation of 1-wire slave devices on MSP430</a></li>
<li><a href="../260191/index.html">Apple plans to integrate its data centers using high-speed network</a></li>
<li><a href="../260193/index.html">Fun starts 2: for_each vs accumulate</a></li>
<li><a href="../260197/index.html">Elvish programming language</a></li>
<li><a href="../260201/index.html">Upgrade to Middle PHP developer in 3 months</a></li>
<li><a href="../260215/index.html">ReactOS has significantly improved support for themes.</a></li>
<li><a href="../260217/index.html">Async / await and the implementation mechanism in C # 5.0</a></li>
<li><a href="../260219/index.html">Semishagovy test logo Paul Rand</a></li>
<li><a href="../260221/index.html">A bit about unit testing and external APIs in PHP</a></li>
<li><a href="../260223/index.html">Why Go is doomed to success (updated)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>