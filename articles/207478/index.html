<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Do-it-yourself balancing stand on the SiLabs C8051F120-TB debug board</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you want to balance something rotating, be it a wheel, a propeller or a flying saucer. Or you are interested in the story of how a programmer‚Äôs wor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Do-it-yourself balancing stand on the SiLabs C8051F120-TB debug board</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/c76/79e/96e/c7679e96e3f8bddbe55d7ff7b1df4fd8.jpg"><br>  If you want to balance something rotating, be it a wheel, a propeller or a flying saucer.  Or you are interested in the story of how a programmer‚Äôs working days are going.  A fascinating story of creating a balancing stand ... <br><a name="habracut"></a><br><br>  Preface. <br>  I express my gratitude to my head, Dmitriev, Ivan Alekseevich, engineer, designer Arapov, Andrey, and electronics engineers, Turaev, Alexander, and Gidal Grigorievich.  This stand is the result of the work of the team. <br><br>  I'll start with the pre story: I work as a programmer in the organization <blockquote>  Not at all secret, but not relevant, I can only say that we are engaged in <abbr title="Unmanned Aerial Vehicles">UAV</abbr> </blockquote>  where many different interesting tasks periodically appear, and we have a need to balance the high precision of the propeller of the aircraft.  Equipment for such a balancing as it turned out you can buy, but it will be very expensive, they decided to do it themselves. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will tell you a little why it was needed.  Our aircraft, with this propeller, badly sausage at idle (800 rev / min).  Usually balance such things, statically and dynamically.  Static balancing consists in balancing relative to the center of rotation, without rotation, and dynamic balancing is during rotation. <br><br>  As for static balancing, then everything is clearly screw just balanced around the center of rotation, but what to do with dynamic balancing, when the screw starts to create a vibration during rotation. <br><br>  For such a task was built <div class="spoiler">  <b class="spoiler_title">simple device</b> <div class="spoiler_text">  consisting of a frame attached on springs to a massive base. <br>  An electric motor is mounted on a massive base, and through a pulley it rotates an axis on which a balanced screw is mounted.  Accelerometers are also installed on the frame, and a hall sensor on the axis with a screw.  The electric motor is connected to the frequency changer, which controls the frequency of its rotation. <br>  An accelerometer on two axes was used as a deflection meter, through an amplifier connected to the <abbr title="Analog to Digital Converter">ADC</abbr> of the SiLabs C8051F120-TB debug board.  In order to catch the moment of the rotation of the rotating body through 0 degrees, a hall sensor was set, the signal from which was fed to another leg of the debug board. <br><br>  So we got a simple unit </div></div>  which can measure the acceleration of the frame with the body of rotation, and give a signal about the passage through 0 degrees of the shaft, which rotates the balanced screw. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/715/03d/ccb/71503dccba86317705c25149eab7ba6d.jpg"><br>  / appearance of a simple device / <br><br>  I was given this construction, and they set the task programmatically to find out what quantity of <s>electrical tape</s> , <s>pieces of plasticine</s> <s>or arakala needed</s> very precisely weighted loads, to stick on the edge of the propeller blade, in order for it to become balanced.  And make an application with a convenient and understandable interface so that in 5 minutes you can figure out how to use it. <br><div class="spoiler">  <b class="spoiler_title">And I started an exciting job.</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/57c/d31/e2a/57cd31e2a2cf5e97b5e034e84b5843c8.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/618/f06/7e3/618f067e376bc6617cb86db309237c7d.jpg"><br></div></div><br><br>  At first, I thought that I would manage in one day, and the task is very simple.  But when taking a signal with an oscilloscope, it was found that the vibration of the entire installation, interference from the mains, and other noise, turn the captured signal from the ADC into a uniform incomprehensible noise.  Although if you take a closer look, then there is a clear periodic maximum and minimum.  It took about a week to debug the software and hardware, or even a little more, but then the accuracy of the device began to please the eye. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/61b/6c8/68a/61b6c868ac291a99a66b3b70054a33b1.jpg"><br>  / Oscilloscope testimony / <br><br>  I wrote a program on the debug board that takes readings and sends them to the COM port. <br><div class="spoiler">  <b class="spoiler_title">defines</b> <div class="spoiler_text">  We configure the controller, we define the main variables, we select arrays and constants.  We are preparing a debug board for programming. <br><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"c8051f120.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> SYSCLK 98000000 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//     #define BAUDRATEU0 57600 //  Uart0    RS232  COM  #define SAMPLE_RATE 24500000 // Sample frequency in Hz #define INT_DEC 256 #define SAR_CLK 12250000 //   #define FREQT0 (748*2) //  0 #define BUFADCSIZE 512 //BUFADC sfr16 ADC0 = 0xbe; // ADC0 data sfr16 RCAP2 = 0xca; // Timer2 capture/reload sfr16 RCAP3 = 0xca; // Timer3 capture/reload sfr16 TMR2 = 0xcc; // Timer2 sfr16 TMR3 = 0xcc; // Timer3 bit ProcessFlag = 0, ADCFlag = 0, flFree = 1, flNewADC = 0; // xdata unsigned int BufADC[BUFADCSIZE], ADCcount = 0, RTC = 0, RTCP = 0, int_dec = INT_DEC, tmpA = 0, lastTmp = 0; xdata float Propeller = 0.0, tmp_float; xdata long accumulator = 0L; #define RESETTICK (1496) sbit LED = P1^6; //      sbit BUTTON = P3^7; // //UART0      #define NBFM 50 xdata unsigned char BuferFromModem [NBFM]; xdata unsigned char wBFM, rBFM, marBFM; #define SIZE_BUFFER0 50 xdata char BufferInModem[SIZE_BUFFER0]; xdata int r0, rk; bit flTransmiter; //-----         void OutModem1(unsigned char Data, char i) { BufferInModem[i] = Data | 0x80; } //------------------------------------------------------------------------------ void OutModem2(unsigned int Data, char i) { BufferInModem[i] = (Data &amp; 0x007f)| 0x80; BufferInModem[i+1] = ((Data &amp; 0x3f80) &gt;&gt; 7)| 0x80; } //------------------------------------------------------------------------------ void OutModem4(unsigned long int Data, char i) { BufferInModem[i] = (Data &amp; 0x0000007f)| 0x80; BufferInModem[i+1] = ((Data &amp; 0x3f80) &gt;&gt; 7) | 0x80; BufferInModem[i+2] = ((Data &amp; 0x1fc000) &gt;&gt; 14) | 0x80; BufferInModem[i+3] = ((Data &amp; 0xfe00000)&gt;&gt; 21) | 0x80; } //----       void OSCILLATOR_Init (void) { int loop; char SFRPAGE_SAVE = SFRPAGE; SFRPAGE = CONFIG_PAGE; OSCICN = 0x83; CLKSEL = 0x00; SFRPAGE = CONFIG_PAGE; PLL0CN = 0x00; SFRPAGE = LEGACY_PAGE; FLSCL = 0x10; SFRPAGE = CONFIG_PAGE; PLL0CN |= 0x01; PLL0DIV = 0x01; PLL0FLT = 0x01; PLL0MUL = 0x04; for (loop=0; loop&lt;256; loop++); PLL0CN |= 0x02; while(!(PLL0CN &amp; 0x10)); CLKSEL = 0x02; SFRPAGE = SFRPAGE_SAVE; } /*Init*/ void Init() { //  SFRPAGE = TIMER01_PAGE; TCON = 0x51; TMOD = 0x11; CKCON = 0x18; SFRPAGE = TMR3_PAGE; TMR3CN = 0x04; TMR3CF = 0x08; RCAP3 = -SYSCLK/SAMPLE_RATE; TMR3 = RCAP3; EIE2 &amp;= ~0x01; TR3 = 1; //    Uart SFRPAGE = TMR2_PAGE; TMR2CF = 0x08; // Timer 2 Configuration RCAP2 = - ((long) SYSCLK/BAUDRATEU0/16); TMR2L = 0x00; // Timer 2 Low Byte TMR2H = 0x00; // Timer 2 High Byte TMR2CN = 0x04; // Timer 2 CONTROL TR2 = 1; SFRPAGE = UART0_PAGE; SCON0 = 0x50; SSTA0 = 0x05; ES0 = 1; // ADC() SFRPAGE = ADC0_PAGE; AMX0SL = 0x01; ADC0CN = 0x80; SFRPAGE = ADC0_PAGE; ADC0CN = 0x04; REF0CN = 0x07; AMX0CF = 0x00; AMX0SL = 0x01; ADC0CF = (SYSCLK/SAR_CLK) &lt;&lt; 3; ADC0CF |= 0x00; //   PGA gain =&gt; 00 = 1 (default), 01 =2, 02 = 4, 03 = 8 EIE2 |= 0x02; // enable ADC interrupts SFRPAGE = ADC0_PAGE; ADC0CN = 0x84; //   SFRPAGE = CONFIG_PAGE; P0MDOUT = 0xFF; P1MDOUT = 0xFF; P2MDOUT = 0xFF; P3MDOUT = 0xFF;*/ XBR0 = 0x44; XBR1 = 0x04; XBR2 = 0x40; //   OSCILLATOR_Init(); //  IE = 0x9B; EIE2 |= 0x02; //  IP = 0x13; EIP2 = 0x02; // }</span></span></span></span></code> </pre> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Main function</b> <div class="spoiler_text">  Here we are constantly spinning in an infinite loop, and send the received measurements of the ADC <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//------------------------------------------------------------------- void main(void) { xdata unsigned int i=0, tmpint; WDTCN = 0xde; //  ,     WDTCN = 0xad; //   ,          ,      EA=0; //     Init(); //  i = 0; while(i++ &lt; BUFADCSIZE) { BufADC[i]=0; } EA=1; while(1) { if(RTC&gt;(7*FREQT0)) { IE0=1; } if(ProcessFlag == 1) { ADCFlag = 0; flFree = 0; EIE2 &amp;= ~0x02; //  //     tmpint = ADCcount; ADCcount = 1; while(ADCcount &lt; tmpint) { //Write to UART0-------------------------------------- BufferInModem[0] = 40 | 0x40; BufferInModem[0] &amp;= ~0x80; OutModem2((int)Propeller, 1); OutModem2((int)ADCcount, 3); OutModem2((int)BufADC[ADCcount++],5); OutModem2((int)tmpint, 7); r0 = 0; rk = 9; BufferInModem[rk] = 0; for (i = r0; i &lt; rk; i++ ) BufferInModem[rk] = BufferInModem[rk] ^ BufferInModem[i]; BufferInModem[rk] = BufferInModem[rk] | 0x80; rk++; flTransmiter = 1; SFRPAGE = 0x00; TI0 = 1; RTC=0; while(flTransmiter) { if(RTC&gt;(RESETTICK)) { RTC=0; break; } } RTC=0; LED=0; } i = 0; while(i++ &lt; BUFADCSIZE) { BufADC[i]=0; } ADCcount = 0; ProcessFlag = 0; flFree = 1; } } }</span></span></code> </pre><br></div></div><br><br>  Create an interrupt event from the leg to which the hall sensor is connected. <br><div class="spoiler">  <b class="spoiler_title">Interruptions</b> <div class="spoiler_text">  Here we monitor interrupts from the Hall sensor. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">INT0</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> interrupt 0 </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//         { if(LED!=1) { LED=1; //   } else if(RTC &gt; RTCP) //     ( 0 - 60000 /) { Propeller = Propeller+((60.0*FREQT0/(RTC - RTCP))-Propeller)*1.0; RTCP = RTC; } RTCP=0; RTC=0; if((flFree == 1)&amp;&amp; (ADCFlag == 1)) { ProcessFlag = 1; } else if(!ProcessFlag) EIE2 |= 0x02; //  return; }</span></span></span></span></code> </pre><br></div></div><br><br>  To know exactly how much time has passed, we start the timer, and count the time in it <br><div class="spoiler">  <b class="spoiler_title">Timer</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TIMER_ISR0</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> interrupt 1 </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//     FREQT0 = SYSCLK/65535  { RTC++; return; }</span></span></span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">A separate event, this is an operation with an input / output port.</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UART0_isr</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> interrupt 4 </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//    ,        { xdata char SFRPAGE_SAVE = SFRPAGE; SFRPAGE = UART0_PAGE; if (RI0) { BuferFromModem [wBFM++] = SBUF0; //    if(wBFM &gt;= NBFM) { wBFM = 0; marBFM = 1; } RI0 = 0; } if (TI0) { if(r0 &lt; rk) { SBUF0 = BufferInModem[r0++]; //    } else { flTransmiter = 0; } TI0 = 0; } SFRPAGE = SFRPAGE_SAVE; return; }</span></span></span></span></code> </pre><br></div></div><br><br>  All data removed from the <abbr title="Analog to Digital Converter">ADC is</abbr> written to the buffer in order to transfer the whole pack in one turn.  This method allowed not to spend time on the transfer during the removal of information, as a result, works faster and removes more points. <br><br><div class="spoiler">  <b class="spoiler_title">ADC interrupts</b> <div class="spoiler_text">  Here we write to the buffer the measurement of the <abbr title="Analog to Digital Converter">ADC</abbr> <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ADC0_ISR</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> interrupt 15 </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//      { xdata char SFRPAGE_SAVE = SFRPAGE; SFRPAGE = ADC0_PAGE; //  ,   AD0INT = 0; accumulator += ADC0; int_dec--; if (int_dec == 0) { int_dec = INT_DEC; BufADC[ADCcount] = accumulator &gt;&gt; 8; AMX0SL = 0x00; ADCcount++; ADCFlag = 1; if(ADCcount&gt;BUFADCSIZE) { ADCcount=BUFADCSIZE; ProcessFlag=1; EIE2 &amp;= ~0x02; //  } accumulator = 0L; } SFRPAGE = SFRPAGE_SAVE; return; }</span></span></span></span></code> </pre><br></div></div><br><br>  In order to somehow separate the necessary deviations, on the desktop application, I decided to apply the Fourier transform, which I had previously used to process the images, after tweaking a bit with the tambourine, it turned out to select the necessary frequencies. <br>  I used C ++ Builder 6.0 to develop the interface <br><br><div class="spoiler">  <b class="spoiler_title">Header plug-in libraries, variables, constants</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//--------------------------------------------------------------------------- #include &lt;vcl.h&gt; #pragma hdrstop #include "balansCom4.h" #include &lt;windows.h&gt; #include &lt;vector.h&gt; #include "fstream.h" #include "math.h" //--------------------------------------------------------------------------- #define assert(ignore)((void)0) #define BUFSIZE 4096 //--------------------------------------------------------------------------- #pragma package(smart_init) #pragma link "CPort" #pragma link "PERFGRAP" #pragma resource "*.dfm" TForm1 *Form1; int N=1024,k=10; ShortComplex arr[4096]; double Amp_F[4096]; double Phase_F[4096]; double Amp_max=0, Phase_max=0; float r=0,rmax=0, fi=0, xx=0, yy=0; float K_flt = 0.00005; float Krmax = 0.05; float kAmp = 0.1; float a=1, b=0; //--------------------------------------------------------------------------- bool perekl=false; struct hComException{}; String tmptxt; float RadMass[365], RadMassMax, j_max; int fiMax, WACHDOG; long data_i=0; long bad = 0; int V, Xlast, A, Alast, Vlast; #define COM "Com5" #define BodRate CBR_57600 #define TIMEOUT 3000 //---------------------------------------------------------------------------</span></span></code> </pre><br></div></div><br><br>  For the selection of the desired frequency from the received signal, the direct and inverse Fourier transform turned out to be very useful.  The data flows in a continuous stream, and in order to process them, I applied an optimized version, the so-called <abbr title="Fast Fourier Transformation">FFT</abbr> .  This is not a panacea, and it is better to parallelize and use the GPU for video stream processing, but for this task it is quite applicable. <br><br><div class="spoiler">  <b class="spoiler_title">FFT function</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> reverse256[]= { <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x80</span></span>, <span class="hljs-number"><span class="hljs-number">0x40</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x20</span></span>, <span class="hljs-number"><span class="hljs-number">0xA0</span></span>, <span class="hljs-number"><span class="hljs-number">0x60</span></span>, <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x10</span></span>, <span class="hljs-number"><span class="hljs-number">0x90</span></span>, <span class="hljs-number"><span class="hljs-number">0x50</span></span>, <span class="hljs-number"><span class="hljs-number">0xD0</span></span>, <span class="hljs-number"><span class="hljs-number">0x30</span></span>, <span class="hljs-number"><span class="hljs-number">0xB0</span></span>, <span class="hljs-number"><span class="hljs-number">0x70</span></span>, <span class="hljs-number"><span class="hljs-number">0xF0</span></span>, <span class="hljs-number"><span class="hljs-number">0x08</span></span>, <span class="hljs-number"><span class="hljs-number">0x88</span></span>, <span class="hljs-number"><span class="hljs-number">0x48</span></span>, <span class="hljs-number"><span class="hljs-number">0xC8</span></span>, <span class="hljs-number"><span class="hljs-number">0x28</span></span>, <span class="hljs-number"><span class="hljs-number">0xA8</span></span>, <span class="hljs-number"><span class="hljs-number">0x68</span></span>, <span class="hljs-number"><span class="hljs-number">0xE8</span></span>, <span class="hljs-number"><span class="hljs-number">0x18</span></span>, <span class="hljs-number"><span class="hljs-number">0x98</span></span>, <span class="hljs-number"><span class="hljs-number">0x58</span></span>, <span class="hljs-number"><span class="hljs-number">0xD8</span></span>, <span class="hljs-number"><span class="hljs-number">0x38</span></span>, <span class="hljs-number"><span class="hljs-number">0xB8</span></span>, <span class="hljs-number"><span class="hljs-number">0x78</span></span>, <span class="hljs-number"><span class="hljs-number">0xF8</span></span>, <span class="hljs-number"><span class="hljs-number">0x04</span></span>, <span class="hljs-number"><span class="hljs-number">0x84</span></span>, <span class="hljs-number"><span class="hljs-number">0x44</span></span>, <span class="hljs-number"><span class="hljs-number">0xC4</span></span>, <span class="hljs-number"><span class="hljs-number">0x24</span></span>, <span class="hljs-number"><span class="hljs-number">0xA4</span></span>, <span class="hljs-number"><span class="hljs-number">0x64</span></span>, <span class="hljs-number"><span class="hljs-number">0xE4</span></span>, <span class="hljs-number"><span class="hljs-number">0x14</span></span>, <span class="hljs-number"><span class="hljs-number">0x94</span></span>, <span class="hljs-number"><span class="hljs-number">0x54</span></span>, <span class="hljs-number"><span class="hljs-number">0xD4</span></span>, <span class="hljs-number"><span class="hljs-number">0x34</span></span>, <span class="hljs-number"><span class="hljs-number">0xB4</span></span>, <span class="hljs-number"><span class="hljs-number">0x74</span></span>, <span class="hljs-number"><span class="hljs-number">0xF4</span></span>, <span class="hljs-number"><span class="hljs-number">0x0C</span></span>, <span class="hljs-number"><span class="hljs-number">0x8C</span></span>, <span class="hljs-number"><span class="hljs-number">0x4C</span></span>, <span class="hljs-number"><span class="hljs-number">0xCC</span></span>, <span class="hljs-number"><span class="hljs-number">0x2C</span></span>, <span class="hljs-number"><span class="hljs-number">0xAC</span></span>, <span class="hljs-number"><span class="hljs-number">0x6C</span></span>, <span class="hljs-number"><span class="hljs-number">0xEC</span></span>, <span class="hljs-number"><span class="hljs-number">0x1C</span></span>, <span class="hljs-number"><span class="hljs-number">0x9C</span></span>, <span class="hljs-number"><span class="hljs-number">0x5C</span></span>, <span class="hljs-number"><span class="hljs-number">0xDC</span></span>, <span class="hljs-number"><span class="hljs-number">0x3C</span></span>, <span class="hljs-number"><span class="hljs-number">0xBC</span></span>, <span class="hljs-number"><span class="hljs-number">0x7C</span></span>, <span class="hljs-number"><span class="hljs-number">0xFC</span></span>, <span class="hljs-number"><span class="hljs-number">0x02</span></span>, <span class="hljs-number"><span class="hljs-number">0x82</span></span>, <span class="hljs-number"><span class="hljs-number">0x42</span></span>, <span class="hljs-number"><span class="hljs-number">0xC2</span></span>, <span class="hljs-number"><span class="hljs-number">0x22</span></span>, <span class="hljs-number"><span class="hljs-number">0xA2</span></span>, <span class="hljs-number"><span class="hljs-number">0x62</span></span>, <span class="hljs-number"><span class="hljs-number">0xE2</span></span>, <span class="hljs-number"><span class="hljs-number">0x12</span></span>, <span class="hljs-number"><span class="hljs-number">0x92</span></span>, <span class="hljs-number"><span class="hljs-number">0x52</span></span>, <span class="hljs-number"><span class="hljs-number">0xD2</span></span>, <span class="hljs-number"><span class="hljs-number">0x32</span></span>, <span class="hljs-number"><span class="hljs-number">0xB2</span></span>, <span class="hljs-number"><span class="hljs-number">0x72</span></span>, <span class="hljs-number"><span class="hljs-number">0xF2</span></span>, <span class="hljs-number"><span class="hljs-number">0x0A</span></span>, <span class="hljs-number"><span class="hljs-number">0x8A</span></span>, <span class="hljs-number"><span class="hljs-number">0x4A</span></span>, <span class="hljs-number"><span class="hljs-number">0xCA</span></span>, <span class="hljs-number"><span class="hljs-number">0x2A</span></span>, <span class="hljs-number"><span class="hljs-number">0xAA</span></span>, <span class="hljs-number"><span class="hljs-number">0x6A</span></span>, <span class="hljs-number"><span class="hljs-number">0xEA</span></span>, <span class="hljs-number"><span class="hljs-number">0x1A</span></span>, <span class="hljs-number"><span class="hljs-number">0x9A</span></span>, <span class="hljs-number"><span class="hljs-number">0x5A</span></span>, <span class="hljs-number"><span class="hljs-number">0xDA</span></span>, <span class="hljs-number"><span class="hljs-number">0x3A</span></span>, <span class="hljs-number"><span class="hljs-number">0xBA</span></span>, <span class="hljs-number"><span class="hljs-number">0x7A</span></span>, <span class="hljs-number"><span class="hljs-number">0xFA</span></span>, <span class="hljs-number"><span class="hljs-number">0x06</span></span>, <span class="hljs-number"><span class="hljs-number">0x86</span></span>, <span class="hljs-number"><span class="hljs-number">0x46</span></span>, <span class="hljs-number"><span class="hljs-number">0xC6</span></span>, <span class="hljs-number"><span class="hljs-number">0x26</span></span>, <span class="hljs-number"><span class="hljs-number">0xA6</span></span>, <span class="hljs-number"><span class="hljs-number">0x66</span></span>, <span class="hljs-number"><span class="hljs-number">0xE6</span></span>, <span class="hljs-number"><span class="hljs-number">0x16</span></span>, <span class="hljs-number"><span class="hljs-number">0x96</span></span>, <span class="hljs-number"><span class="hljs-number">0x56</span></span>, <span class="hljs-number"><span class="hljs-number">0xD6</span></span>, <span class="hljs-number"><span class="hljs-number">0x36</span></span>, <span class="hljs-number"><span class="hljs-number">0xB6</span></span>, <span class="hljs-number"><span class="hljs-number">0x76</span></span>, <span class="hljs-number"><span class="hljs-number">0xF6</span></span>, <span class="hljs-number"><span class="hljs-number">0x0E</span></span>, <span class="hljs-number"><span class="hljs-number">0x8E</span></span>, <span class="hljs-number"><span class="hljs-number">0x4E</span></span>, <span class="hljs-number"><span class="hljs-number">0xCE</span></span>, <span class="hljs-number"><span class="hljs-number">0x2E</span></span>, <span class="hljs-number"><span class="hljs-number">0xAE</span></span>, <span class="hljs-number"><span class="hljs-number">0x6E</span></span>, <span class="hljs-number"><span class="hljs-number">0xEE</span></span>, <span class="hljs-number"><span class="hljs-number">0x1E</span></span>, <span class="hljs-number"><span class="hljs-number">0x9E</span></span>, <span class="hljs-number"><span class="hljs-number">0x5E</span></span>, <span class="hljs-number"><span class="hljs-number">0xDE</span></span>, <span class="hljs-number"><span class="hljs-number">0x3E</span></span>, <span class="hljs-number"><span class="hljs-number">0xBE</span></span>, <span class="hljs-number"><span class="hljs-number">0x7E</span></span>, <span class="hljs-number"><span class="hljs-number">0xFE</span></span>, <span class="hljs-number"><span class="hljs-number">0x01</span></span>, <span class="hljs-number"><span class="hljs-number">0x81</span></span>, <span class="hljs-number"><span class="hljs-number">0x41</span></span>, <span class="hljs-number"><span class="hljs-number">0xC1</span></span>, <span class="hljs-number"><span class="hljs-number">0x21</span></span>, <span class="hljs-number"><span class="hljs-number">0xA1</span></span>, <span class="hljs-number"><span class="hljs-number">0x61</span></span>, <span class="hljs-number"><span class="hljs-number">0xE1</span></span>, <span class="hljs-number"><span class="hljs-number">0x11</span></span>, <span class="hljs-number"><span class="hljs-number">0x91</span></span>, <span class="hljs-number"><span class="hljs-number">0x51</span></span>, <span class="hljs-number"><span class="hljs-number">0xD1</span></span>, <span class="hljs-number"><span class="hljs-number">0x31</span></span>, <span class="hljs-number"><span class="hljs-number">0xB1</span></span>, <span class="hljs-number"><span class="hljs-number">0x71</span></span>, <span class="hljs-number"><span class="hljs-number">0xF1</span></span>, <span class="hljs-number"><span class="hljs-number">0x09</span></span>, <span class="hljs-number"><span class="hljs-number">0x89</span></span>, <span class="hljs-number"><span class="hljs-number">0x49</span></span>, <span class="hljs-number"><span class="hljs-number">0xC9</span></span>, <span class="hljs-number"><span class="hljs-number">0x29</span></span>, <span class="hljs-number"><span class="hljs-number">0xA9</span></span>, <span class="hljs-number"><span class="hljs-number">0x69</span></span>, <span class="hljs-number"><span class="hljs-number">0xE9</span></span>, <span class="hljs-number"><span class="hljs-number">0x19</span></span>, <span class="hljs-number"><span class="hljs-number">0x99</span></span>, <span class="hljs-number"><span class="hljs-number">0x59</span></span>, <span class="hljs-number"><span class="hljs-number">0xD9</span></span>, <span class="hljs-number"><span class="hljs-number">0x39</span></span>, <span class="hljs-number"><span class="hljs-number">0xB9</span></span>, <span class="hljs-number"><span class="hljs-number">0x79</span></span>, <span class="hljs-number"><span class="hljs-number">0xF9</span></span>, <span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0x85</span></span>, <span class="hljs-number"><span class="hljs-number">0x45</span></span>, <span class="hljs-number"><span class="hljs-number">0xC5</span></span>, <span class="hljs-number"><span class="hljs-number">0x25</span></span>, <span class="hljs-number"><span class="hljs-number">0xA5</span></span>, <span class="hljs-number"><span class="hljs-number">0x65</span></span>, <span class="hljs-number"><span class="hljs-number">0xE5</span></span>, <span class="hljs-number"><span class="hljs-number">0x15</span></span>, <span class="hljs-number"><span class="hljs-number">0x95</span></span>, <span class="hljs-number"><span class="hljs-number">0x55</span></span>, <span class="hljs-number"><span class="hljs-number">0xD5</span></span>, <span class="hljs-number"><span class="hljs-number">0x35</span></span>, <span class="hljs-number"><span class="hljs-number">0xB5</span></span>, <span class="hljs-number"><span class="hljs-number">0x75</span></span>, <span class="hljs-number"><span class="hljs-number">0xF5</span></span>, <span class="hljs-number"><span class="hljs-number">0x0D</span></span>, <span class="hljs-number"><span class="hljs-number">0x8D</span></span>, <span class="hljs-number"><span class="hljs-number">0x4D</span></span>, <span class="hljs-number"><span class="hljs-number">0xCD</span></span>, <span class="hljs-number"><span class="hljs-number">0x2D</span></span>, <span class="hljs-number"><span class="hljs-number">0xAD</span></span>, <span class="hljs-number"><span class="hljs-number">0x6D</span></span>, <span class="hljs-number"><span class="hljs-number">0xED</span></span>, <span class="hljs-number"><span class="hljs-number">0x1D</span></span>, <span class="hljs-number"><span class="hljs-number">0x9D</span></span>, <span class="hljs-number"><span class="hljs-number">0x5D</span></span>, <span class="hljs-number"><span class="hljs-number">0xDD</span></span>, <span class="hljs-number"><span class="hljs-number">0x3D</span></span>, <span class="hljs-number"><span class="hljs-number">0xBD</span></span>, <span class="hljs-number"><span class="hljs-number">0x7D</span></span>, <span class="hljs-number"><span class="hljs-number">0xFD</span></span>, <span class="hljs-number"><span class="hljs-number">0x03</span></span>, <span class="hljs-number"><span class="hljs-number">0x83</span></span>, <span class="hljs-number"><span class="hljs-number">0x43</span></span>, <span class="hljs-number"><span class="hljs-number">0xC3</span></span>, <span class="hljs-number"><span class="hljs-number">0x23</span></span>, <span class="hljs-number"><span class="hljs-number">0xA3</span></span>, <span class="hljs-number"><span class="hljs-number">0x63</span></span>, <span class="hljs-number"><span class="hljs-number">0xE3</span></span>, <span class="hljs-number"><span class="hljs-number">0x13</span></span>, <span class="hljs-number"><span class="hljs-number">0x93</span></span>, <span class="hljs-number"><span class="hljs-number">0x53</span></span>, <span class="hljs-number"><span class="hljs-number">0xD3</span></span>, <span class="hljs-number"><span class="hljs-number">0x33</span></span>, <span class="hljs-number"><span class="hljs-number">0xB3</span></span>, <span class="hljs-number"><span class="hljs-number">0x73</span></span>, <span class="hljs-number"><span class="hljs-number">0xF3</span></span>, <span class="hljs-number"><span class="hljs-number">0x0B</span></span>, <span class="hljs-number"><span class="hljs-number">0x8B</span></span>, <span class="hljs-number"><span class="hljs-number">0x4B</span></span>, <span class="hljs-number"><span class="hljs-number">0xCB</span></span>, <span class="hljs-number"><span class="hljs-number">0x2B</span></span>, <span class="hljs-number"><span class="hljs-number">0xAB</span></span>, <span class="hljs-number"><span class="hljs-number">0x6B</span></span>, <span class="hljs-number"><span class="hljs-number">0xEB</span></span>, <span class="hljs-number"><span class="hljs-number">0x1B</span></span>, <span class="hljs-number"><span class="hljs-number">0x9B</span></span>, <span class="hljs-number"><span class="hljs-number">0x5B</span></span>, <span class="hljs-number"><span class="hljs-number">0xDB</span></span>, <span class="hljs-number"><span class="hljs-number">0x3B</span></span>, <span class="hljs-number"><span class="hljs-number">0xBB</span></span>, <span class="hljs-number"><span class="hljs-number">0x7B</span></span>, <span class="hljs-number"><span class="hljs-number">0xFB</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span>, <span class="hljs-number"><span class="hljs-number">0x87</span></span>, <span class="hljs-number"><span class="hljs-number">0x47</span></span>, <span class="hljs-number"><span class="hljs-number">0xC7</span></span>, <span class="hljs-number"><span class="hljs-number">0x27</span></span>, <span class="hljs-number"><span class="hljs-number">0xA7</span></span>, <span class="hljs-number"><span class="hljs-number">0x67</span></span>, <span class="hljs-number"><span class="hljs-number">0xE7</span></span>, <span class="hljs-number"><span class="hljs-number">0x17</span></span>, <span class="hljs-number"><span class="hljs-number">0x97</span></span>, <span class="hljs-number"><span class="hljs-number">0x57</span></span>, <span class="hljs-number"><span class="hljs-number">0xD7</span></span>, <span class="hljs-number"><span class="hljs-number">0x37</span></span>, <span class="hljs-number"><span class="hljs-number">0xB7</span></span>, <span class="hljs-number"><span class="hljs-number">0x77</span></span>, <span class="hljs-number"><span class="hljs-number">0xF7</span></span>, <span class="hljs-number"><span class="hljs-number">0x0F</span></span>, <span class="hljs-number"><span class="hljs-number">0x8F</span></span>, <span class="hljs-number"><span class="hljs-number">0x4F</span></span>, <span class="hljs-number"><span class="hljs-number">0xCF</span></span>, <span class="hljs-number"><span class="hljs-number">0x2F</span></span>, <span class="hljs-number"><span class="hljs-number">0xAF</span></span>, <span class="hljs-number"><span class="hljs-number">0x6F</span></span>, <span class="hljs-number"><span class="hljs-number">0xEF</span></span>, <span class="hljs-number"><span class="hljs-number">0x1F</span></span>, <span class="hljs-number"><span class="hljs-number">0x9F</span></span>, <span class="hljs-number"><span class="hljs-number">0x5F</span></span>, <span class="hljs-number"><span class="hljs-number">0xDF</span></span>, <span class="hljs-number"><span class="hljs-number">0x3F</span></span>, <span class="hljs-number"><span class="hljs-number">0xBF</span></span>, <span class="hljs-number"><span class="hljs-number">0x7F</span></span>, <span class="hljs-number"><span class="hljs-number">0xFF</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> temp; <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>+=(ShortComplex &amp;x, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Complex &amp;y) { x.re += (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)y.re; x.im += (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)y.im; } <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>-=(ShortComplex &amp;x, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Complex &amp;y) { x.re -= (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)y.re; x.im -= (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)y.im; } <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>*=(Complex &amp;x, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Complex &amp;y) { temp = x.re; x.re = temp * y.re - x.im * y.im; x.im = temp * y.im + x.im * y.re; } <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>*=(Complex &amp;x, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ShortComplex &amp;y) { temp = x.re; x.re = temp * y.re - x.im * y.im; x.im = temp * y.im + x.im * y.re; } <span class="hljs-keyword"><span class="hljs-keyword">inline</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span>/=(ShortComplex &amp;x, <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> div) { x.re /= div; x.im /= div; } <span class="hljs-comment"><span class="hljs-comment">//array exp(-2*pi*j/2^n) for n= 1,...,32 //exp(-2*pi*j/2^n) = Complex( cos(2*pi/2^n), -sin(2*pi/2^n) ) static Complex W2n[32]={ {-1.00000000000000000000000000000000, 0.00000000000000000000000000000000}, // W2 calculator (copy/paste) : po, ps { 0.00000000000000000000000000000000, -1.00000000000000000000000000000000}, // W4: p/2=o, p/2=s { 0.70710678118654752440084436210485, -0.70710678118654752440084436210485}, // W8: p/4=o, p/4=s { 0.92387953251128675612818318939679, -0.38268343236508977172845998403040}, // p/8=o, p/8=s { 0.98078528040323044912618223613424, -0.19509032201612826784828486847702}, // p/16= { 0.99518472667219688624483695310948, -9.80171403295606019941955638886e-2}, // p/32= { 0.99879545620517239271477160475910, -4.90676743274180142549549769426e-2}, // p/64= { 0.99969881869620422011576564966617, -2.45412285229122880317345294592e-2}, // p/128= { 0.99992470183914454092164649119638, -1.22715382857199260794082619510e-2}, // p/256= { 0.99998117528260114265699043772857, -6.13588464915447535964023459037e-3}, // p/(2y9)= { 0.99999529380957617151158012570012, -3.06795676296597627014536549091e-3}, // p/(2y10)= { 0.99999882345170190992902571017153, -1.53398018628476561230369715026e-3}, // p/(2y11)= { 0.99999970586288221916022821773877, -7.66990318742704526938568357948e-4}, // p/(2y12)= { 0.99999992646571785114473148070739, -3.83495187571395589072461681181e-4}, // p/(2y13)= { 0.99999998161642929380834691540291, -1.91747597310703307439909561989e-4}, // p/(2y14)= { 0.99999999540410731289097193313961, -9.58737990959773458705172109764e-5}, // p/(2y15)= { 0.99999999885102682756267330779455, -4.79368996030668845490039904946e-5}, // p/(2y16)= { 0.99999999971275670684941397221864, -2.39684498084182187291865771650e-5}, // p/(2y17)= { 0.99999999992818917670977509588385, -1.19842249050697064215215615969e-5}, // p/(2y18)= { 0.99999999998204729417728262414778, -5.99211245264242784287971180889e-6}, // p/(2y19)= { 0.99999999999551182354431058417300, -2.99605622633466075045481280835e-6}, // p/(2y20)= { 0.99999999999887795588607701655175, -1.49802811316901122885427884615e-6}, // p/(2y21)= { 0.99999999999971948897151921479472, -7.49014056584715721130498566730e-7}, // p/(2y22)= { 0.99999999999992987224287980123973, -3.74507028292384123903169179084e-7}, // p/(2y23)= { 0.99999999999998246806071995015625, -1.87253514146195344868824576593e-7}, // p/(2y24)= { 0.99999999999999561701517998752946, -9.36267570730980827990672866808e-8}, // p/(2y25)= { 0.99999999999999890425379499688176, -4.68133785365490926951155181385e-8}, // p/(2y26)= { 0.99999999999999972606344874922040, -2.34066892682745527595054934190e-8}, // p/(2y27)= { 0.99999999999999993151586218730510, -1.17033446341372771812462135032e-8}, // p/(2y28)= { 0.99999999999999998287896554682627, -5.85167231706863869080979010083e-9}, // p/(2y29)= { 0.99999999999999999571974138670657, -2.92583615853431935792823046906e-9}, // p/(2y30)= { 0.99999999999999999892993534667664, -1.46291807926715968052953216186e-9}, // p/(2y31)= }; void fft(ShortComplex *x, int T, bool complement) { unsigned int I, J, Nmax, N, Nd2, k, m, mpNd2, Skew; unsigned char *Ic = (unsigned char*) &amp;I; unsigned char *Jc = (unsigned char*) &amp;J; ShortComplex S; ShortComplex *Wstore, *Warray; Complex WN, W, Temp, *pWN; Nmax = 1 &lt;&lt; T; //first interchanging for(I = 1; I &lt; Nmax - 1; I++) { Jc[0] = reverse256[Ic[3]]; Jc[1] = reverse256[Ic[2]]; Jc[2] = reverse256[Ic[1]]; Jc[3] = reverse256[Ic[0]]; J &gt;&gt;= (32 - T); if (I &lt; J) { S = x[I]; x[I] = x[J]; x[J] = S; } } //rotation multiplier array allocation Wstore = new ShortComplex[Nmax / 2]; Wstore[0].re = 1.0; Wstore[0].im = 0.0; //main loop for(N = 2, Nd2 = 1, pWN = W2n, Skew = Nmax &gt;&gt; 1; N &lt;= Nmax; Nd2 = N, N += N, pWN++, Skew &gt;&gt;= 1) { //WN = W(1, N) = exp(-2*pi*j/N) WN= *pWN; if (complement) WN.im = -WN.im; for(Warray = Wstore, k = 0; k &lt; Nd2; k++, Warray += Skew) { if (k &amp; 1) { W *= WN; *Warray = W; } else W = *Warray; for(m = k; m &lt; Nmax; m += N) { mpNd2 = m + Nd2; Temp = W; Temp *= x[mpNd2]; x[mpNd2] = x[m]; x[mpNd2] -= Temp; x[m] += Temp; } } } delete [] Wstore; if (complement) { for( I = 0; I &lt; Nmax; I++ ) x[I] /= Nmax; } }</span></span></code> </pre><br></div></div><br><br>  Prepare a <abbr title="Graphical user interface">GUI</abbr> , and configure the COM port for reception. <br><div class="spoiler">  <b class="spoiler_title">Options at startup and shutdown</b> <div class="spoiler_text"><pre> <code class="cpp hljs">__fastcall TForm1::TForm1(TComponent* Owner) : TForm(Owner) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;<span class="hljs-number"><span class="hljs-number">362</span></span>; i++) RadMass[i]=<span class="hljs-number"><span class="hljs-number">0</span></span>; RadMassMax=<span class="hljs-number"><span class="hljs-number">0</span></span>; Image1-&gt;Canvas-&gt;Rectangle(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,Image1-&gt;Width, Image1-&gt;Height); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> r, fi=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> xx, yy; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i&lt;<span class="hljs-number"><span class="hljs-number">100</span></span>) { Image1-&gt;Canvas-&gt;Pen-&gt;Color=clGreen; i=i+<span class="hljs-number"><span class="hljs-number">10</span></span>; r=i; fi=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(fi&lt;<span class="hljs-number"><span class="hljs-number">360</span></span>) { fi=fi+<span class="hljs-number"><span class="hljs-number">1</span></span>; xx = r*<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(fi) + Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>; yy = r*<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(fi) + Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>; Image1-&gt;Canvas-&gt;Ellipse((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)xx,(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)yy, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)xx+<span class="hljs-number"><span class="hljs-number">2</span></span>,(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)yy+<span class="hljs-number"><span class="hljs-number">2</span></span>); } } Image1-&gt;Canvas-&gt;Pen-&gt;Color=clBlack; Button2Click(Owner); flEdit=<span class="hljs-number"><span class="hljs-number">0</span></span>; hCom = CreateFile(COM,GENERIC_READ | GENERIC_WRITE,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, OPEN_EXISTING, FILE_FLAG_OVERLAPPED, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( hCom == INVALID_HANDLE_VALUE ) { ShowMessage(<span class="hljs-string"><span class="hljs-string">"Com port error"</span></span>); CloseHandle(hCom); Stat-&gt;SimpleText=<span class="hljs-string"><span class="hljs-string">"Com port error"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { SetCommMask(hCom, EV_RXCHAR); SetupComm(hCom, <span class="hljs-number"><span class="hljs-number">1500</span></span>, <span class="hljs-number"><span class="hljs-number">1500</span></span>); CommTimeOuts.ReadIntervalTimeout = MAXDWORD; CommTimeOuts.ReadTotalTimeoutMultiplier = TIMEOUT; CommTimeOuts.ReadTotalTimeoutConstant = TIMEOUT; CommTimeOuts.WriteTotalTimeoutMultiplier = TIMEOUT; CommTimeOuts.WriteTotalTimeoutConstant = TIMEOUT; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!SetCommTimeouts(hCom, &amp;CommTimeOuts)) { hCom = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> hComException(); } <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(&amp;dcb, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(dcb)); dcb.DCBlength = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(DCB); GetCommState(hCom, &amp;dcb); dcb.BaudRate = BodRate; dcb.fParity = <span class="hljs-number"><span class="hljs-number">0</span></span>; dcb.ByteSize = <span class="hljs-number"><span class="hljs-number">8</span></span>; dcb.Parity = NOPARITY; dcb.StopBits = ONESTOPBIT; dcb.fAbortOnError = FALSE; dcb.fDtrControl = DTR_CONTROL_DISABLE; dcb.fRtsControl = RTS_CONTROL_DISABLE; dcb.fBinary = TRUE; dcb.fParity = FALSE; dcb.fInX = FALSE; dcb.fOutX = FALSE; dcb.XonChar = <span class="hljs-number"><span class="hljs-number">0</span></span>; dcb.XoffChar = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>)<span class="hljs-number"><span class="hljs-number">0xFF</span></span>; dcb.fErrorChar = FALSE; dcb.fNull = FALSE; dcb.fOutxCtsFlow = FALSE; dcb.fOutxDsrFlow = FALSE; dcb.XonLim = <span class="hljs-number"><span class="hljs-number">128</span></span>; dcb.XoffLim = <span class="hljs-number"><span class="hljs-number">128</span></span>; SetCommState(hCom,&amp;dcb); PurgeComm(hCom, PURGE_RXCLEAR); begin = GetTickCount(); tmptxt = COM; tmptxt += <span class="hljs-string"><span class="hljs-string">" br"</span></span>; tmptxt += dcb.BaudRate; tmptxt += <span class="hljs-string"><span class="hljs-string">" p"</span></span>; tmptxt += dcb.Parity; tmptxt += <span class="hljs-string"><span class="hljs-string">" By"</span></span>; tmptxt += dcb.ByteSize; tmptxt += <span class="hljs-string"><span class="hljs-string">" sb"</span></span>; tmptxt += dcb.StopBits; Stat-&gt;SimpleText= tmptxt; overlapped.hEvent = CreateEvent(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> __fastcall TForm1::FormClose(TObject *Sender, TCloseAction &amp;Action) { CloseHandle(hCom); }</code> </pre><br></div></div><br>  I decided to attach the functions of saving and loading, so that you can somehow raise the data if necessary, although it is not necessary for the stand.  Although the data was saved, they were never used in the future, so you can not do it. <br><div class="spoiler">  <b class="spoiler_title">Save and Load Functions</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> TForm1::SaveToFile(String FileName) { fstream file_; file_.open(FileName.c_str(), ios::out); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_) { file_.close(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count_ = <span class="hljs-number"><span class="hljs-number">0</span></span>, tmp_count; tmp_count = Series1-&gt;XValues-&gt;MaxValue<span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(tmp_count&gt;(Series2-&gt;XValues-&gt;MaxValue<span class="hljs-number"><span class="hljs-number">-1</span></span>)) tmp_count = Series2-&gt;XValues-&gt;MaxValue<span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(tmp_count&gt;(Series6-&gt;XValues-&gt;MaxValue<span class="hljs-number"><span class="hljs-number">-1</span></span>)) tmp_count = Series6-&gt;XValues-&gt;MaxValue<span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(count_++ &lt; tmp_count) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a1Propeller = Series1-&gt;YValue[count_]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a2X1 = Series2-&gt;YValue[count_]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> a6Ugol = Series6-&gt;YValue[count_]; file_ &lt;&lt; a1Propeller &lt;&lt; <span class="hljs-string"><span class="hljs-string">" "</span></span> &lt;&lt; a2X1 &lt;&lt; <span class="hljs-string"><span class="hljs-string">" "</span></span> &lt;&lt; a6Ugol &lt;&lt; <span class="hljs-string"><span class="hljs-string">" "</span></span> ; } file_.close(); } <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> TForm1::LoadFromFile(String FileName) { fstream file; file.open(FileName.c_str()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file) { file.close(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a1Propeller = <span class="hljs-number"><span class="hljs-number">0</span></span>, a2X1 = <span class="hljs-number"><span class="hljs-number">0</span></span>, a6Ugol = <span class="hljs-number"><span class="hljs-number">0</span></span>; Series1-&gt;Clear(); Series2-&gt;Clear(); Series6-&gt;Clear(); <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> file_i=<span class="hljs-number"><span class="hljs-number">0</span></span>; file_i=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(!file.eof()) { file &gt;&gt; a1Propeller &gt;&gt; a2X1 &gt;&gt; a6Ugol; Application-&gt;ProcessMessages(); Series1-&gt;Add(a1Propeller); Series2-&gt;Add(a2X1); Series6-&gt;Add(a6Ugol); Dannye-&gt;Cells[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]=<span class="hljs-string"><span class="hljs-string">"Propeller"</span></span>; Dannye-&gt;Cells[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>]=a1Propeller; Dannye-&gt;Cells[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]=<span class="hljs-string"><span class="hljs-string">"X1"</span></span>; Dannye-&gt;Cells[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]=a2X1; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> r, fi, xx, yy; r = (Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>)*(a*a2X1-b)/<span class="hljs-number"><span class="hljs-number">4095</span></span>; fi = a6Ugol; RadMass[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)fi]=RadMass[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)fi] + (r-RadMass[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)fi])*Krmax; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(RadMass[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)fi]&gt;RadMassMax) { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> lastRadMax; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> lastfiMax; lastfiMax = fiMax; lastRadMax = RadMass[lastfiMax]; Image1-&gt;Canvas-&gt;Pen-&gt;Color=clWhite; Image1-&gt;Canvas-&gt;MoveTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>); xx= lastRadMax*<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(lastfiMax) + Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>; yy= lastRadMax*<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(lastfiMax) + Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>; Image1-&gt;Canvas-&gt;LineTo(xx, yy); Image1-&gt;Canvas-&gt;MoveTo(xx, yy+<span class="hljs-number"><span class="hljs-number">1</span></span>); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>); Image1-&gt;Canvas-&gt;MoveTo(xx, yy<span class="hljs-number"><span class="hljs-number">-1</span></span>); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>); Image1-&gt;Canvas-&gt;MoveTo(xx+<span class="hljs-number"><span class="hljs-number">1</span></span>, yy); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>); Image1-&gt;Canvas-&gt;MoveTo(xx<span class="hljs-number"><span class="hljs-number">-1</span></span>, yy); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>); RadMassMax = RadMass[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)fi]; fiMax = fi; lastRadMax = RadMassMax; lastfiMax = fiMax; Image1-&gt;Canvas-&gt;Pen-&gt;Color=clRed; Image1-&gt;Canvas-&gt;MoveTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>); xx= RadMassMax*<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>*M_PI*fiMax/<span class="hljs-number"><span class="hljs-number">360</span></span>)+Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>; yy= RadMassMax*<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>*M_PI*fiMax/<span class="hljs-number"><span class="hljs-number">360</span></span>) + Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>; Image1-&gt;Canvas-&gt;LineTo(xx, yy); Image1-&gt;Canvas-&gt;MoveTo(xx, yy+<span class="hljs-number"><span class="hljs-number">1</span></span>); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>); Image1-&gt;Canvas-&gt;MoveTo(xx, yy<span class="hljs-number"><span class="hljs-number">-1</span></span>); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>); Image1-&gt;Canvas-&gt;MoveTo(xx+<span class="hljs-number"><span class="hljs-number">1</span></span>, yy); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>); Image1-&gt;Canvas-&gt;MoveTo(xx<span class="hljs-number"><span class="hljs-number">-1</span></span>, yy); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>); Image1-&gt;Canvas-&gt;Pen-&gt;Color=clBlack; Dannye-&gt;Cells[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>]=<span class="hljs-string"><span class="hljs-string">""</span></span>; Dannye-&gt;Cells[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>]= (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)RadMassMax; } xx = r*<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>*M_PI*fi/<span class="hljs-number"><span class="hljs-number">360</span></span>) + Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>; yy = r*<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>*M_PI*fi/<span class="hljs-number"><span class="hljs-number">360</span></span>) + Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>; Image1-&gt;Canvas-&gt;Ellipse((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)xx,(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)yy, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)xx+<span class="hljs-number"><span class="hljs-number">2</span></span>,(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)yy+<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_i &gt; (N+<span class="hljs-number"><span class="hljs-number">1</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> count_= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(count_ &lt; N) { arr[count_].re= Series2-&gt;YValue[count_+file_i-N]; arr[count_++].im= <span class="hljs-number"><span class="hljs-number">0.0</span></span>; } Series7-&gt;Clear(); Series8-&gt;Clear(); fft(arr, k, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> nSamplesPerSec; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Nmax= (N + <span class="hljs-number"><span class="hljs-number">1</span></span>) / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> *freq= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[Nmax]; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> *amp= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[Nmax]; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> *phase= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[Nmax]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j= <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> limit= <span class="hljs-number"><span class="hljs-number">0.001</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> abs2min= limit * limit * N * N; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> abs2max= <span class="hljs-number"><span class="hljs-number">10E150</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arr[i].re &gt;= limit) { amp[j]= arr[i].re / N; freq[j]= <span class="hljs-number"><span class="hljs-number">0.0</span></span>; phase[j]= <span class="hljs-number"><span class="hljs-number">0.0</span></span>; ++j; } ++i; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i= <span class="hljs-number"><span class="hljs-number">1</span></span>; i &lt; Nmax; ++i) { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> re= arr[i].re; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> im= arr[i].im; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> abs2; abs2 = re * re + im * im; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (abs2 &lt; abs2min) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (abs2 &gt; abs2max) abs2=abs2max; amp[j]= <span class="hljs-number"><span class="hljs-number">2.0</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)abs2) / N; Amp_F[j] = Amp_F[j]+(amp[j]-Amp_F[j])*K_flt; Series7-&gt;Add(Amp_F[j]); phase[j]= <span class="hljs-built_in"><span class="hljs-built_in">atan2</span></span>(im, re); phase[j]+= M_PI_2; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (phase[j] &gt; M_PI) phase[j]-= <span class="hljs-number"><span class="hljs-number">2</span></span>*M_PI; phase[j]= phase[j] * M_PI / <span class="hljs-number"><span class="hljs-number">180.0</span></span>; Phase_F[j] = Phase_F[j] + (phase[j] - Phase_F[j])*K_flt; Series8-&gt;Add(Phase_F[j]); freq[j]= (nSamplesPerSec * i) / N; ++j; } <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>[] amp; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>[] freq; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>[] phase; } file_i++; } file.close(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//--------------------------------------------------------------------------- void __fastcall TForm1::Button1Click(TObject *Sender) { String FileName_; FileName_ = ExtractFilePath(Application-&gt;ExeName); FileName_ += "Data\\"; FileName_ += FormatDateTime("dd_mmm_yyy'-'hh_nn'",Now()); SaveDialog1-&gt;FileName = FileName_; if(SaveDialog1-&gt;Execute()) { SaveToFile(SaveDialog1-&gt;FileName); flEdit=0; } } //--------------------------------------------------------------------------- void __fastcall TForm1::Button3Click(TObject *Sender) { if(OpenDialog1-&gt;Execute()) { LoadFromFile(OpenDialog1-&gt;FileName); } }</span></span></code> </pre><br></div></div><br><br>  To receive and decrypt the buffer automatically, I made it possible to do this on a timer, not quite a good idea, now I would do it differently, I would collect data on the arrival in a separate stream, and transmit to the output, so as not to interfere with the input interface and others applications.  However, this option was viable, and coped with its task quite successfully. <br><div class="spoiler">  <b class="spoiler_title">Timer with processing</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> __fastcall TForm1::Timer1Timer(TObject *Sender) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(CheckBox1-&gt;Checked) { flEdit=<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Propeller, X1, ADCcount, ADCcountMax, Amax; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> tmp40; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> attempts = <span class="hljs-number"><span class="hljs-number">3</span></span>, nLetter40 = <span class="hljs-number"><span class="hljs-number">11</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rBUF=<span class="hljs-number"><span class="hljs-number">0</span></span>, wBUF=<span class="hljs-number"><span class="hljs-number">0</span></span>, marBUF=<span class="hljs-number"><span class="hljs-number">0</span></span>; feedback = <span class="hljs-number"><span class="hljs-number">0</span></span>; BYTE data1[BUFSIZE]; <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>&gt; data(data1, data1+BUFSIZE); <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* buf = &amp;data[<span class="hljs-number"><span class="hljs-number">0</span></span>]; ADCcountMax=<span class="hljs-number"><span class="hljs-number">0</span></span>; WaitCommEvent(hCom, &amp;mask, &amp;overlapped); signal = WaitForSingleObject(overlapped.hEvent, <span class="hljs-number"><span class="hljs-number">7000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(signal == WAIT_OBJECT_0) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(GetOverlappedResult(hCom, &amp;overlapped, &amp;feedback, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((mask &amp; EV_RXCHAR)!=<span class="hljs-number"><span class="hljs-number">0</span></span>) { ClearCommError(hCom, &amp;feedback, &amp;comstat); btr = comstat.cbInQue; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(btr) { ReadFile(hCom, buf, btr, &amp;feedback, &amp;overlapped); wBUF+=btr;<span class="hljs-comment"><span class="hljs-comment">//(DWORD)data.size(); if(wBUF &gt;= BUFSIZE) { wBUF = 0; marBUF = 1; } } while(rBUF &lt; (wBUF + (marBUF*BUFSIZE))) { unsigned char tmpBuf = data[rBUF]; tmpBuf = tmpBuf&amp;~0x80; if(tmpBuf==(0x40 | 40)) { nLetter40=0; tmp40 = 0; tmp40 = tmp40 ^ data[rBUF]; } else if(nLetter40==0 &amp;&amp; (data[rBUF]&gt;&gt;7)==1) { nLetter40++; Propeller = data[rBUF]&amp;~0x80; tmp40 = tmp40 ^ data[rBUF]; } else if(nLetter40==1 &amp;&amp; (data[rBUF]&gt;&gt;7)==1) { nLetter40++; Propeller |= ((int)(data[rBUF]&amp;~0x80)&lt;&lt;7); tmp40 = tmp40 ^ data[rBUF]; } else if(nLetter40==2 &amp;&amp; (data[rBUF]&gt;&gt;7)==1) { nLetter40++; ADCcount = data[rBUF]&amp;~0x80; tmp40 = tmp40 ^ data[rBUF]; } else if(nLetter40==3 &amp;&amp; (data[rBUF]&gt;&gt;7)==1) { nLetter40++; ADCcount |= ((int)(data[rBUF]&amp;~0x80)&lt;&lt;7); tmp40 = tmp40 ^ data[rBUF]; } else if(nLetter40==4 &amp;&amp; (data[rBUF]&gt;&gt;7)==1) { nLetter40++; X1 = data[rBUF]&amp;~0x80; tmp40 = tmp40 ^ data[rBUF]; } else if(nLetter40==5 &amp;&amp; (data[rBUF]&gt;&gt;7)==1) { nLetter40++; X1 |= ((int)(data[rBUF]&amp;~0x80)&lt;&lt;7); tmp40 = tmp40 ^ data[rBUF]; } else if(nLetter40==6 &amp;&amp; (data[rBUF]&gt;&gt;7)==1) { nLetter40++; Amax = data[rBUF]&amp;~0x80; tmp40 = tmp40 ^ data[rBUF]; } else if(nLetter40==7 &amp;&amp; (data[rBUF]&gt;&gt;7)==1) { nLetter40++; Amax |= ((int)(data[rBUF]&amp;~0x80)&lt;&lt;7); tmp40 = tmp40 ^ data[rBUF++]; tmp40 = tmp40 | 0x80; float Angle=400; if(Amax&gt;0) Angle = 360*ADCcount/Amax; if(tmp40 != 0x80 &amp;&amp; tmp40 == data[rBUF] &amp;&amp; ADCcount&gt;0 &amp;&amp; X1&lt;4096 &amp;&amp; X1&gt;0 &amp;&amp; Amax&gt;0 &amp;&amp; Propeller&lt;1000 &amp;&amp; Propeller&gt;100 &amp;&amp; Angle&gt;=0 &amp;&amp; Angle&lt;=360) { //Chart1-&gt;BottomAxis-&gt;Scroll(1, false); Dannye-&gt;Cells[0][0]=""; Dannye-&gt;Cells[1][0]=Propeller; Series1-&gt;Add(Propeller); Dannye-&gt;Cells[0][1]="X1"; Dannye-&gt;Cells[1][1]=X1; V=Xlast-X1; A=Vlast-V; Vlast=V; Alast=A; Series2-&gt;Add(X1); Series6-&gt;Add(360*ADCcount/Amax); if (data_i &gt; (N+1)) { int count_= 0; while(count_ &lt; N) { arr[count_].re= Series2-&gt;YValue[count_+data_i-N]; arr[count_++].im= 0.0; } Series7-&gt;Clear(); Series8-&gt;Clear(); fft(arr, k, false); int i=0; double nSamplesPerSec; int Nmax= (N + 1) / 2; double *freq= new double[Nmax]; double *amp= new double[Nmax]; double *phase= new double[Nmax]; int j= 0; double limit= 0.001; double abs2min= limit * limit * N * N; double abs2max= 10E150; if (arr[i].re &gt;= limit) { amp[j]= arr[i].re / N; freq[j]= 0.0; phase[j]= 0.0; ++j; } ++i; for(i= 1; i &lt; Nmax; ++i) { double re= arr[i].re; double im= arr[i].im; long double abs2; abs2 = re * re + im * im; if (abs2 &lt; abs2min) continue; if (abs2 &gt; abs2max) abs2=abs2max; amp[j]= 2.0 * sqrt((double)abs2) / N; //Series7-&gt;Add(amp[j]); Amp_F[j] = Amp_F[j]+(amp[j]-Amp_F[j])*K_flt; Series7-&gt;Add(Amp_F[j]); phase[j]= atan2(im, re); phase[j]+= M_PI_2; if (phase[j] &gt; M_PI) phase[j]-= 2*M_PI; phase[j]= phase[j] * M_PI / 180.0; //Series8-&gt;Add(phase[j]); Phase_F[j] = Phase_F[j] + (phase[j] - Phase_F[j])*K_flt; Series8-&gt;Add(Phase_F[j]); freq[j]= (nSamplesPerSec * i) / N; ++j; } delete[] amp; delete[] freq; delete[] phase; for(i= 0; i&lt;Nmax; i++) { if(i&gt;(j_max+1)) arr[i].re = 0; arr[i].im = 0; } fft(arr, k, true); /* count_= 0; while(count_ &lt; N) { Series4-&gt;Add(arr[count_++].re); } */ Series4-&gt;Add(arr[(N-1)].re); float r, fi, xx, yy; r = (Image1-&gt;Height/2)*(a*arr[(N-1)].re-b)/4095; //X1=arr[1023].re; ///!!!!!!!!!! fi = 360*(ADCcount)/Amax; xx= r*cos(2*M_PI*fi/360)+Image1-&gt;Width/2; yy= r*sin(2*M_PI*fi/360) + Image1-&gt;Height/2; Image1-&gt;Canvas-&gt;Pen-&gt;Color = clYellow; Image1-&gt;Canvas-&gt;Ellipse((int)xx,(int)yy, (int)xx+2,(int)yy+2); } else { Series4-&gt;Add(X1); } Image1-&gt;Canvas-&gt;Pen-&gt;Color = clBlack; data_i++; Dannye-&gt;Cells[0][2]="  "; Dannye-&gt;Cells[1][2]=Amax; float r, fi, xx, yy; r = (Image1-&gt;Height/2)*(a*X1-b)/4095; fi = 360*(ADCcount)/Amax; if(X1&gt;0 &amp;&amp; X1&lt;4095 &amp;&amp; fi&lt;361 &amp;&amp; fi &gt;0) { //  xx = r*cos(2*M_PI*fi/360) + Image1-&gt;Width/2; yy = r*sin(2*M_PI*fi/360) + Image1-&gt;Height/2; Image1-&gt;Canvas-&gt;Ellipse((int)xx,(int)yy, (int)xx+2,(int)yy+2); X1=arr[(N-1)].re; ///!!!!!!!!!! r = (Image1-&gt;Height/2)*(a*X1-b)/4095; RadMass[(int)fi]=RadMass[(int)fi] + (r-RadMass[(int)fi])*Krmax; //  xx= RadMass[(int)fi]*cos(2*M_PI*fi/360)+Image1-&gt;Width/2; yy= RadMass[(int)fi]*sin(2*M_PI*fi/360) + Image1-&gt;Height/2; Image1-&gt;Canvas-&gt;Pen-&gt;Color = clYellow; Image1-&gt;Canvas-&gt;Ellipse((int)xx,(int)yy, (int)xx+2,(int)yy+2); Image1-&gt;Canvas-&gt;Pen-&gt;Color = clBlack; if(RadMass[(int)fi]&gt;RadMassMax) { Image1-&gt;Canvas-&gt;Pen-&gt;Color=clWhite; Image1-&gt;Canvas-&gt;MoveTo(Image1-&gt;Width/2, Image1-&gt;Height/2); xx= RadMassMax*cos(2*M_PI*fiMax/360)+Image1-&gt;Width/2; yy= RadMassMax*sin(2*M_PI*fiMax/360) + Image1-&gt;Height/2; Image1-&gt;Canvas-&gt;LineTo(xx, yy); Image1-&gt;Canvas-&gt;MoveTo(xx, yy+1); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/2, Image1-&gt;Height/2+1); Image1-&gt;Canvas-&gt;MoveTo(xx, yy-1); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/2, Image1-&gt;Height/2-1); Image1-&gt;Canvas-&gt;MoveTo(xx+1, yy); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/2+1, Image1-&gt;Height/2); Image1-&gt;Canvas-&gt;MoveTo(xx-1, yy); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/2-1, Image1-&gt;Height/2); RadMassMax = RadMass[(int)fi]; fiMax = (int)fi; Image1-&gt;Canvas-&gt;Pen-&gt;Color=clRed; Image1-&gt;Canvas-&gt;MoveTo(Image1-&gt;Width/2, Image1-&gt;Height/2); xx= RadMassMax*cos(2*M_PI*fiMax/360)+Image1-&gt;Width/2; yy= RadMassMax*sin(2*M_PI*fiMax/360) + Image1-&gt;Height/2; Image1-&gt;Canvas-&gt;LineTo(xx, yy); Image1-&gt;Canvas-&gt;MoveTo(xx, yy+1); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/2, Image1-&gt;Height/2+1); Image1-&gt;Canvas-&gt;MoveTo(xx, yy-1); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/2, Image1-&gt;Height/2-1); Image1-&gt;Canvas-&gt;MoveTo(xx+1, yy); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/2+1, Image1-&gt;Height/2); Image1-&gt;Canvas-&gt;MoveTo(xx-1, yy); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/2-1, Image1-&gt;Height/2); Image1-&gt;Canvas-&gt;Pen-&gt;Color=clBlack; Dannye-&gt;Cells[0][6]=""; Dannye-&gt;Cells[1][6]= (int)RadMassMax; Dannye-&gt;Cells[0][7] =""; Dannye-&gt;Cells[1][7] =(int)fiMax; } RadMassMax = RadMass[(int)fiMax]; } } else { bad++; } String tmp_txt; if(Amax&gt;0) j_max = (int)((float)N/(float)Amax); Amp_max = Amp_max + ((Amp_F[(int)j_max]+Amp_F[(int)j_max-1]+Amp_F[(int)j_max+1])/3. - Amp_max)*kAmp; Phase_max = Phase_F[(int)j_max]; Dannye-&gt;Cells[0][3]=""; Dannye-&gt;Cells[1][3]=(int)Amp_max; Dannye-&gt;Cells[0][4]="  "; tmp_txt = j_max; tmp_txt += " |"; tmp_txt +=Phase_max; Dannye-&gt;Cells[1][4]=tmp_txt; Dannye-&gt;Cells[0][5]=" "; if(data_i&gt;0) { tmp_txt = (int)(100*bad/(data_i+bad)); tmp_txt +=" %"; } else { tmp_txt = "100%"; } Dannye-&gt;Cells[1][5]=tmp_txt.c_str(); } if(rBUF++ &gt;= BUFSIZE) { rBUF = 0; marBUF = 0; } } memset(buf, 0, BUFSIZE); } } else { CheckBox1-&gt;Checked = false; } delete[] buf; } }</span></span></code> </pre><br></div></div><br>  So that you can clear everything and start over, you made a clear button and a function that cleans and redraws the field with the accumulated data. <br><div class="spoiler">  <b class="spoiler_title">Cleaning function</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> __fastcall TForm1::Button2Click(TObject *Sender) { Series1-&gt;Clear(); Series2-&gt;Clear(); Series3-&gt;Clear(); Series4-&gt;Clear(); Series5-&gt;Clear(); Series6-&gt;Clear(); Series7-&gt;Clear(); Series8-&gt;Clear(); r=<span class="hljs-number"><span class="hljs-number">0</span></span>; rmax=<span class="hljs-number"><span class="hljs-number">0</span></span>; fi=<span class="hljs-number"><span class="hljs-number">0</span></span>; xx=<span class="hljs-number"><span class="hljs-number">0</span></span>; yy=<span class="hljs-number"><span class="hljs-number">0</span></span>; data_i = <span class="hljs-number"><span class="hljs-number">0</span></span>; bad=<span class="hljs-number"><span class="hljs-number">0</span></span>; Image1-&gt;Canvas-&gt;Rectangle(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,Image1-&gt;Width, Image1-&gt;Height); rmax = <span class="hljs-number"><span class="hljs-number">0.3</span></span>*<span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(Image1-&gt;Width*Image1-&gt;Width+Image1-&gt;Height*Image1-&gt;Height); Image1-&gt;Canvas-&gt;Pen-&gt;Color=clBlue; r = rmax; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(fi&lt;<span class="hljs-number"><span class="hljs-number">360</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(fi&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>) { Image1-&gt;Canvas-&gt;Pen-&gt;Color=clGreen; } xx = r*<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>*M_PI*fi/<span class="hljs-number"><span class="hljs-number">360</span></span>) + Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>; yy = r*<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>*M_PI*fi/<span class="hljs-number"><span class="hljs-number">360</span></span>) + Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>; Image1-&gt;Canvas-&gt;MoveTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>); Image1-&gt;Canvas-&gt;LineTo(xx, yy); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(fi&lt;=<span class="hljs-number"><span class="hljs-number">1</span></span>){ Image1-&gt;Canvas-&gt;MoveTo(xx, yy+<span class="hljs-number"><span class="hljs-number">1</span></span>); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>); Image1-&gt;Canvas-&gt;MoveTo(xx, yy<span class="hljs-number"><span class="hljs-number">-1</span></span>); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>); Image1-&gt;Canvas-&gt;MoveTo(xx+<span class="hljs-number"><span class="hljs-number">1</span></span>, yy); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>); Image1-&gt;Canvas-&gt;MoveTo(xx<span class="hljs-number"><span class="hljs-number">-1</span></span>, yy); Image1-&gt;Canvas-&gt;LineTo(Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>, Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>); } fi=fi+<span class="hljs-number"><span class="hljs-number">30</span></span>; } r=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { r=r+<span class="hljs-number"><span class="hljs-number">15</span></span>; fi=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(fi&lt;<span class="hljs-number"><span class="hljs-number">360</span></span>) { fi=fi+<span class="hljs-number"><span class="hljs-number">1</span></span>; xx = r*<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>*M_PI*fi/<span class="hljs-number"><span class="hljs-number">360</span></span>) + Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>; yy = r*<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>*M_PI*fi/<span class="hljs-number"><span class="hljs-number">360</span></span>) + Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>; Image1-&gt;Canvas-&gt;Ellipse((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)xx,(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)yy, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)xx+<span class="hljs-number"><span class="hljs-number">2</span></span>,(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)yy+<span class="hljs-number"><span class="hljs-number">2</span></span>); } }<span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(r&lt;rmax); Image1-&gt;Canvas-&gt;Pen-&gt;Color=clRed; fi=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(fi&lt;<span class="hljs-number"><span class="hljs-number">360</span></span>) { fi=fi+<span class="hljs-number"><span class="hljs-number">1</span></span>; r=RadMass[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)fi]; xx = r*<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>*M_PI*fi/<span class="hljs-number"><span class="hljs-number">360</span></span>) + Image1-&gt;Width/<span class="hljs-number"><span class="hljs-number">2</span></span>; yy = r*<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>*M_PI*fi/<span class="hljs-number"><span class="hljs-number">360</span></span>) + Image1-&gt;Height/<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">//Image1-&gt;Canvas-&gt;LineTo(xx, yy); Image1-&gt;Canvas-&gt;Ellipse((int)xx,(int)yy, (int)xx+2,(int)yy+2); } Image1-&gt;Canvas-&gt;Pen-&gt;Color=clRed; for(int i=0; i&lt;4; i++) { Image1-&gt;Canvas-&gt;MoveTo(Image1-&gt;Width/2+i, Image1-&gt;Height/2+i); Image1-&gt;Canvas-&gt;LineTo(RadMassMax*cos(2*M_PI*fiMax/360)+Image1-&gt;Width/2+i, RadMassMax*sin(2*M_PI*fiMax/360) + Image1-&gt;Height/2+i); } for(int i=0; i&lt;362; i++) RadMass[i]=0; RadMassMax=0; for(int i=0; i&lt;4095; i++) { Amp_F[i]=0; Phase_F[i]=0; arr[i].re=0; arr[i].im=0; } Image1-&gt;Canvas-&gt;Pen-&gt;Color=clBlack; }</span></span></code> </pre><br></div></div><br>  To be able to gradually increase the sensitivity on the graphic field of balance deviation, added the sensitivity switch. <br><div class="spoiler">  <b class="spoiler_title">Scale switches</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> __fastcall TForm1::RadioButton1Click(TObject *Sender) { a=<span class="hljs-number"><span class="hljs-number">1</span></span>; b=<span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//--------------------------------------------------------------------------- void __fastcall TForm1::RadioButton2Click(TObject *Sender) { a=2; b=2550; } //--------------------------------------------------------------------------- void __fastcall TForm1::RadioButton3Click(TObject *Sender) { a=3; b=5500; } //--------------------------------------------------------------------------- void __fastcall TForm1::RadioButton4Click(TObject *Sender) { a=4; b=8000; }</span></span></code> </pre><br></div></div><br><br>  The result was a fairly handy program that shows the direction in which the imbalance exists, and, adapting to sticking pieces of arakala at 0.15g, we managed to balance the screw fairly accurately. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f88/a51/592/f88a51592ac2113630a08bb1926929cb.jpg"><br>  / The program itself is at work / <br><br>  If you look at the peaks in frequency, then you can see that two amplitudes are pronounced, as it turned out, one is responsible for the screw's vibration, and the second is created by an electric motor, as it is connected through the belt and spin faster.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Thus, balancing the screw, we minimize the first peak, attaching a weight commensurate with the deviation of the circle on the opposite side. </font></font></div><p>Source: <a href="https://habr.com/ru/post/207478/">https://habr.com/ru/post/207478/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../207466/index.html">We will do TICT. Creation experience, prospects</a></li>
<li><a href="../207468/index.html">Types of digital generators</a></li>
<li><a href="../207470/index.html">Working with tar and gz archives using PHP</a></li>
<li><a href="../207472/index.html">VMware: "To quiesce or not to quiesce?", Back up the virtual machines correctly</a></li>
<li><a href="../207476/index.html">TeamLab 2013: the results of the year in funny pictures and one stern video</a></li>
<li><a href="../207480/index.html">Ws-security in SoapUI Pro</a></li>
<li><a href="../207482/index.html">Virt2real results of the year, or "The main question of life, the universe and all that"</a></li>
<li><a href="../207486/index.html">Work with alerts in System Center Operations Manager using your connector</a></li>
<li><a href="../207496/index.html">Christmas gifts from the publishing house "Peter"</a></li>
<li><a href="../207500/index.html">Simultaneous support for Windows Phone 7 and Windows Phone 8</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>