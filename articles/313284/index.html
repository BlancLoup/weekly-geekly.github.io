<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The Stage for the Tower of Babel, or On Custom Data Types for Multilingual Applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Engraving by M. Escher "Tower of Babel", 1928 

 Introduction 


 Perhaps you are ready for the fact that your application will be multilingual at the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The Stage for the Tower of Babel, or On Custom Data Types for Multilingual Applications</h1><div class="post__text post__text-html js-mediator-article"><p> <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B0%25D0%25B2%25D0%25B8%25D0%25BB%25D0%25BE%25D0%25BD%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D0%25B1%25D0%25B0%25D1%2588%25D0%25BD%25D1%258F_(%25D0%25B3%25D1%2580%25D0%25B0%25D0%25B2%25D1%258E%25D1%2580%25D0%25B0_%25D0%25AD%25D1%2588%25D0%25B5%25D1%2580%25D0%25B0)"><img src="https://habrastorage.org/getpro/habr/post_images/7e6/c8b/60a/7e6c8b60aeefc6547c6ad52a6784b90d.png" alt="Engraving by M. Escher &amp; quot; The Tower of Babel &amp; quot;"><br></a>  <a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B0%25D0%25B2%25D0%25B8%25D0%25BB%25D0%25BE%25D0%25BD%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D0%25B1%25D0%25B0%25D1%2588%25D0%25BD%25D1%258F_(%25D0%25B3%25D1%2580%25D0%25B0%25D0%25B2%25D1%258E%25D1%2580%25D0%25B0_%25D0%25AD%25D1%2588%25D0%25B5%25D1%2580%25D0%25B0)"><i>Engraving by M. Escher "Tower of Babel", 1928</i></a> </p><br><br><h1>  Introduction </h1><br><p>  Perhaps you are ready for the fact that your application will be multilingual at the start of the project.  But most likely, the news of the need for internationalization, as it once happened to humanity, will find you in the midst of the construction of the Tower of Babel.  In any case, it is useful to have with you a gentleman's set of tools that give a chance to complete the construction of the century successfully. </p><br><p>  Four thousand years after the Tower of Babel, technology offers us some wonderful tools.  What do we have? </p><br><p>  First, the hodgepodge is an abstraction of locale.  Locale includes not only language, but also writing, calendar, formatting rules for numbers, monetary units, dates, etc. </p><br><p>  Secondly, Unicode.  Unicode is not just a character encoding table.  It also includes various forms of the same letters, accented characters, the sort order of characters, case-insensitive rules, string normalization algorithms, the UTF character set of characters, and much more. </p><br><p>  All this is a great help.  Such capabilities, as a rule, are already built into the operating systems and are available in standard libraries.  Programmers and users in all corners of the planet successfully use the same operating systems, development tools, databases.  But, alas, there is no perfection in the world ... <a name="habracut"></a>  If your application must simultaneously serve users in many languages, you, whoever you are (analyst, architect or programmer), have new needs. </p><br><p>  Next, we will tell you about some of these often-needed needs in enterprise applications, based on the experience of our company.  Code examples in the article will be in C #.  The <a href="">source code of the</a> library is laid out on GitHub, including the data types in question, their workable implementations, and more.  Despite the fact that the material contains some specificity of .NET, the outlined concepts of working with multilingual data will be useful for specialists on other platforms. </p><br><p>  And for starters, we recommend that you read the previous <a href="https://habrahabr.ru/post/166053/">material</a> on the internationalization of applications. </p><br><br><h2>  Conditions of the problem </h2><br><p>  Imagine that our application should work with several languages ‚Äã‚Äãat once.  Depending on the user's environment, on any of them, user interfaces will not only be displayed, but also operational and reference data will be entered.  At the same time, in one session from several variants of data localization, both the variant in only one specific language and the localization for all languages ‚Äã‚Äãcan be used. </p><br><p>  For example, consider the domain nature of the product, which has, among other attributes, the article number and name in various languages.  We need to be able to describe the domain entity, display and enter product records through the user interface, and also print price tags. </p>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Multilingual strings </h1><br><p>  The first thought about the name of the product in the domain entity is a dictionary with a locale code as the key. </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Product</span></span> {    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Code { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  The option impresses with its simplicity, but immediately violates the principles of designing public contracts, because the dictionary <code>IDictionary&lt;string, string&gt;</code> has no clear semantics.  A little to save the situation can be the renaming of the <code>Name</code> entity attribute to <code>MultilingualName</code> and the use of such an agreement wherever the semantics of the multilingual attribute is required. </p><br><p>  If you think about it, then you and I will surely find cases when it is necessary to do the same operation with lines in several (or all at the same time) languages ‚Äã‚Äãsimultaneously (for example, to bring all the letters of the title to uppercase).  It would seem, what could be easier? </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IDictionary&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToUpper</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; source</span></span></span><span class="hljs-function">)</span></span> {   IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; destination = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;();   <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> source)   {       destination[pair.Key] = pair.Value.ToUpper();   }   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> destination; }</code> </pre> <br><p>  Or quite short: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IDictionary&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToUpper</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; source</span></span></span><span class="hljs-function">)</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source.ToDictionary(p =&gt; p.Key, p =&gt; p.Value.ToUpper()); }</code> </pre> <br><p>  However, the error has already crept into the code, however, it is world-famous: we did not pass <a href="https://www.w3.org/International/wiki/Case_folding">The Turkey Test</a> . </p><br><p>  The fact is that to change the case of characters you need to apply the rules of a particular language.  And if we do not specify it, the current locale (regional settings locale) is used. </p><br><p>  Here we will make a reservation that the locale in .NET is called culture.  Two cultures are available for each stream: <code>CurrentCulture</code> and <code>CurrentUICulture</code> .  The first is used to format numbers, dates, and other regional settings, and the second is used in <a href="https://habrahabr.ru/post/166053/">the</a> search <a href="https://habrahabr.ru/post/166053/">algorithm</a> for suitable localized resources, such as strings, images, layout of user interfaces, etc. </p><br><p>  Since we intentionally change strings for different locales, the correct code might look like this: </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IDictionary&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">, </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToUpper</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IDictionary&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; source</span></span></span><span class="hljs-function">)</span></span> {   IDictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; destination = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;();   <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pair <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> source)   {       <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> culture = CultureInfo.GetCultureInfo(pair.Key);       destination[pair.Key] = pair.Value.ToUpper(culture);   }   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> destination; }</code> </pre> <br><br><h2>  Draft new data type </h2><br><p>  These two facts: the desire to follow a good design style and a high likelihood of errors during regular work with multilingual data - may well and should encourage us to introduce a new data type - a <i><b>multilingual string</b></i> . </p><br><p>  What should be able to multilingual string?  It is necessary at least: </p><br><ul><li>  Have the ability to contain values ‚Äã‚Äãfor any available locales. </li><li>  Provide a list of contained locales. </li><li>  Provide an ordinary string for a given locale. </li><li>  Return a string in the current locale when calling <code>ToString()</code> . </li></ul><br><p>  At the same time, it seems intuitively that a multilingual string with its behavior and properties should be very similar to a regular string: </p><br><ul><li>  To be immutable (unchangeable). </li><li>  To be serialized. </li><li>  Implement the following methods: <br><ul><li>  Change of case: <code>ToLower()</code> , <code>ToUpper()</code> . </li><li>  Check for emptiness and non-printable characters: <code>IsNullOrEmpty()</code> , <code>IsNullOrWhiteSpace()</code> . </li><li>  <code>Join()</code> multiple lines through the delimiter (s): <code>Join()</code> . </li><li>  Padded spaces at the beginning and end of the line: <code>PadLeft()</code> , <code>PadRight()</code> . </li></ul></li></ul><br><p>  However, a multilingual string should not explicitly support string concatenation.  Concatenation in localized applications is practically forbidden (at least within the same sentence), because the word order may differ in different languages. </p><br><div class="spoiler">  <b class="spoiler_title">So, let's see what we get</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">  . </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;remarks&gt;</span></span></span><span class="hljs-comment">           . </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;see langword="null"/&gt;</span></span></span><span class="hljs-comment">-  . </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/remarks&gt;</span></span></span><span class="hljs-comment">   [Serializable] public sealed class MultiCulturalString {   #region    </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">  . Ctor. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   private MultiCulturalString() {...}   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">  . Ctor. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">    public MultiCulturalString(IEnumerable</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;KeyValuePair&lt;CultureInfo, string&gt;</span></span></span><span class="hljs-comment">&gt; localizedStrings) {...}   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">  . Ctor.        </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">   . </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public MultiCulturalString(CultureInfo culture, string value) {...}   #endregion   #region     </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;paramref name="value"/&gt;</span></span></span><span class="hljs-comment">  </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;c&gt;</span></span></span><span class="hljs-comment">null</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/c&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">  </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;see cref="MultiCulturalString"/&gt;</span></span></span><span class="hljs-comment">     ? </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public static bool IsNullOrEmpty(MultiCulturalString value) {...}   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;paramref name="value"/&gt;</span></span></span><span class="hljs-comment">  </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;see langword="null"/&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">  </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;see cref="MultiCulturalString"/&gt;</span></span></span><span class="hljs-comment">       </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">   ? </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public static bool IsNullOrWhiteSpace(MultiCulturalString value) {...}   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">      . </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public static MultiCulturalString Join(MultiCulturalString separator, params object[] args) {...}   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">          </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;paramref name="localizedString"/&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;paramref name="culture"/&gt;</span></span></span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public MultiCulturalString SetLocalizedString(CultureInfo culture, string localizedString) {...}   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">        </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public MultiCulturalString MergeWith(MultiCulturalString other) {...}   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">         . </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public bool ContainsCulture(CultureInfo culture) {...}   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">    ,    .   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">         . </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public MultiCulturalString ToLower() {...}   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">    ,    .   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">         . </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public MultiCulturalString ToUpper() {...}   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">   ,         </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">       -    .   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public MultiCulturalString PadLeft(int totalWidth, char paddingChar = ' ') {...}     </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">   ,         </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">       -    .   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public MultiCulturalString PadRight(int totalWidth, char paddingChar = ' ') {...}   #endregion   #region  ToString()   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">    UI-  </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public override string ToString() {...}   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">      </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public string ToString(CultureInfo culture) {...}   #endregion   #region    </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">   ,       </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">    .</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public static MultiCulturalString Empty {...}   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">   ,     . </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public IEnumerable</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;CultureInfo&gt;</span></span></span><span class="hljs-comment"> Cultures {...}   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">     ? </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public bool IsEmpty {...}   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">        ? </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public bool IsWhiteSpace {...}   #endregion }</span></span></code> </pre> </div></div><br><p>  But inside the class all the same dictionary and simple manipulations with it are hidden. </p><br><p>  And the product description looks quite decent: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Product</span></span> {   <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Code { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }   <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> MultiCulturalString Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><br><h2>  Enhancements </h2><br><p>  As soon as we begin to implement or use the above methods, we will encounter several previously not entirely obvious problems. </p><br><br><h3>  Tostring () is not enough </h3><br><p>  Imagine that when entering a product, we filled in the name only for some of the required languages: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ru = CultureInfo.GetCultureInfo(<span class="hljs-string"><span class="hljs-string">"ru"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> en = CultureInfo.GetCultureInfo(<span class="hljs-string"><span class="hljs-string">"en"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> product = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Product {   Code = <span class="hljs-string"><span class="hljs-string">"V0016887"</span></span>,   Name = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MultiCulturalString(ru, <span class="hljs-string"><span class="hljs-string">" "</span></span>)       .SetLocalizedString(en, <span class="hljs-string"><span class="hljs-string">"Chocolate Alina"</span></span>) };</code> </pre> <br><p>  And then they requested a name for the missing language: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> zhHans = CultureInfo.GetCultureInfo(<span class="hljs-string"><span class="hljs-string">"zh-Hans"</span></span>); Console.WriteLine(product.Name.ToString(zhHans)); <span class="hljs-comment"><span class="hljs-comment">// ?</span></span></code> </pre> <br><p>  What result would you expect to get? </p><br><p>  Well, no exception!  Maybe <code>null</code> ?  Probably!  But the <a href="https://msdn.microsoft.com/en-us/library/system.object.tostring(v%3Dvs.110).aspx">documentation</a> for <code>Object.ToString()</code> does not recommend returning either <code>null</code> or an empty string.  And <a href="https://www.microsoft.com/en-us/research/project/code-contracts/">Code Contracts</a> directly <a href="">prohibit the</a> return of <code>null</code> . </p><br><p>  Nevertheless, we need to be able to distinguish between the situation of the presence of an empty string for a given locale from the case of its absence.  Therefore, our multilanguage string class will grow using <code>GetString(...)</code> methods that will be able to return <code>null</code> and have the same signatures as the <code>ToString(...)</code> methods. </p><br><br><h3>  Formatting </h3><br><p>  As we have already said, we cannot use string concatenation, so substitutions are our everything.  In most cases, localized strings contain the same substitutions for all locales. </p><br><p>  Therefore, it would be good to be able to format a multilingual string.  What would it mean?  After all, we immediately guessed to support overloading <code>GetString(CultureInfo) / ToString(CultureInfo)</code> .  But the standard for .NET method of converting any objects into a string representation with customizable (!) Is the implementation of the <code>IFormattable</code> interface.  If the arguments involved in the substitutions implement this interface, then it will be used to convert the argument to a string.  Thus, we have to implement <code>IFormattable</code> in a multilingual string. </p><br><p>  As a format provider for the <code>IFormattable.ToString(string format, IFormatProvider formatProvider)</code> method <code>IFormattable.ToString(string format, IFormatProvider formatProvider)</code> you can use the locale (culture).  And the first parameter allows you to set formatting parameters that are independent of locale.  For example, you can set the percentage to display a percentage in English for India: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//          // https://en.wikipedia.org/wiki/Indian_numbering_system 12345.6789.ToString("P", CultureInfo.GetCultureInfo("en-IN")); // 12,34,567.89%</span></span></code> </pre> <br><p>  So, let's try to create a price tag for the same product: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ru = CultureInfo.GetCultureInfo(<span class="hljs-string"><span class="hljs-string">"ru"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> en = CultureInfo.GetCultureInfo(<span class="hljs-string"><span class="hljs-string">"en"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> product = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Product {   Code = <span class="hljs-string"><span class="hljs-string">"V0016887"</span></span>,   Name = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MultiCulturalString(ru, <span class="hljs-string"><span class="hljs-string">" "</span></span>)       .SetLocalizedString(en, <span class="hljs-string"><span class="hljs-string">"Chocolate Alina"</span></span>) }; IFormatProvider localizationFormatProvider = en; Console.WriteLine(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(localizationFormatProvider,   <span class="hljs-string"><span class="hljs-string">": {0}\r\n: {1}"</span></span>,   product.Code,   product.Name)); <span class="hljs-comment"><span class="hljs-comment">// : V0016887 // : Chocolate Alina</span></span></code> </pre> <br><p>  Great, we got the line " <code>: V0016887\r\n: Chocolate Alina</code> ", as expected!  Now let's slightly complicate the task by adding the date of its creation to the price tag and placing the user in the English-language interface with Russian regional settings: </p><br><pre> <code class="cs hljs">Thread.CurrentThread.CurrentCulture = ru; IFormatProvider localizationFormatProvider = en; Console.WriteLine(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(localizationFormatProvider,   <span class="hljs-string"><span class="hljs-string">": {0}\r\n: {1}\r\n: {2:d}"</span></span>,   product.Code,   product.Name,   DateTime.Now)); <span class="hljs-comment"><span class="hljs-comment">// : V0016887 // : Chocolate Alina // : 11/25/2016</span></span></code> </pre> <br><p>  And what did the reader expect to get?  The author, for example, would expect to receive " <code>: V0016887\r\n: Chocolate Alina\r\n: 25.11.2016</code> ". </p><br><p>  Yes, yes, we should not forget about the separation of regional and localization settings. </p><br><p>  In the .NET Framework there are at least three standard implementations of <code>IFormatProvider</code> ( <code>CultureInfo, NumberFormatInfo, DateTimeFormatInfo</code> ), and none of them are suitable for us.  We need our own implementation, which will carry information about the required locale for localization, in particular, for multilingual strings, but will not be used to format numbers and dates.  Let's call it <code>LocalizationFormatInfo</code> .  Using looks no more difficult than the code before: </p><br><pre> <code class="cs hljs">Thread.CurrentThread.CurrentCulture = ru; IFormatProvider localizationFormatProvider = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LocalizationFormatInfo(en); Console.WriteLine(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Format(localizationFormatProvider,   <span class="hljs-string"><span class="hljs-string">": {0}\r\n: {1}\r\n: {2:d}"</span></span>,   product.Code,   product.Name,   DateTime.Now)); <span class="hljs-comment"><span class="hljs-comment">// : V0016887 // : Chocolate Alina // : 25.11.2016</span></span></code> </pre> <br><p>  And the implementation of <code>IFormattable</code> in <code>MultiCulturalString</code> looks like this: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">string</span></span> IFormattable.ToString(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> format, IFormatProvider formatProvider) {   <span class="hljs-comment"><span class="hljs-comment">// format     var formatInfo = LocalizationFormatInfo.GetInstance(formatProvider);   return ToString(formatInfo.Culture ?? CultureInfo.CurrentUICulture); }</span></span></code> </pre> <br><p>  But the ability to delegate the formatting of non-multilingual strings (dates, numbers and anything else) to other suppliers in <code>LocalizationFormatInfo</code> will be very useful. </p><br><div class="spoiler">  <b class="spoiler_title">The first draft of LocalizationFormatInfo may look like this.</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">    . </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> [Serializable] public sealed class LocalizationFormatInfo : IFormatProvider {   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">    . </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="culture"&gt;</span></span></span><span class="hljs-comment">   .</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="provider"&gt;</span></span></span><span class="hljs-comment">  .</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment">   public LocalizationFormatInfo(CultureInfo culture, IFormatProvider provider = null)   {       _culture = culture;       _provider = provider;   }   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">      -     . </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public object GetFormat(Type formatType)   {       if (formatType == GetType())       {           return this;       }       if (Provider != null)       {           //     ,     .           return Provider.GetFormat(formatType);       }       return null;   }   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">    .   null. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public CultureInfo Culture   {       get { return _culture; }   }   private readonly CultureInfo _culture;   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">   .   null. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   public IFormatProvider Provider   {       get { return _provider; }   }   private readonly IFormatProvider _provider;       </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;paramref name="provider"/&gt;</span></span></span><span class="hljs-comment">  </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;see cref="LocalizationFormatInfo"/&gt;</span></span></span><span class="hljs-comment">.   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="provider"&gt;</span></span></span><span class="hljs-comment">  .   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;see langword="null"/&gt;</span></span></span><span class="hljs-comment">.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;returns&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;see cref="LocalizationFormatInfo"/&gt;</span></span></span><span class="hljs-comment">.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><span class="hljs-comment">   public static LocalizationFormatInfo GetInstance(IFormatProvider provider)   {       LocalizationFormatInfo lfi = null;       //            if (provider != null)       {           lfi = provider.GetFormat(typeof(LocalizationFormatInfo)) as LocalizationFormatInfo;       }       return lfi ?? Default;   }   private static readonly LocalizationFormatInfo Default = new LocalizationFormatInfo(null); }</span></span></code> </pre> </div></div><br><p>  The development of the considered example can be the transformation of the formatting line of the price tag into a multilingual string. </p><br><br><h1>  Search for a suitable location </h1><br><p>  Let's once again imagine that we created a copy of the product with the name in Russian and English, and then requested the name for the missing Chinese language.  The question is the same: what result would you expect to get? </p><br><p>  In the previous section, we settled on the possibility that <code>null</code> acceptable. </p><br><p>  Consider common situations.  New versions of applications are coming out, but the translation cycle is not in time for all the changes in time.  Many free products are translated by enthusiasts, often localizations from older versions are used in new ones.  As a result, not all user interface elements can be translated or the desired user language is not supported by the application at all. </p><br><p>  Obviously, in such cases, empty in the interface is not allowed.  It is necessary to display resources for at least some language.  It is desirable that the displayed element can be perceived by the user: recognized, read, but not necessarily understood or translated. </p><br><div class="spoiler">  <b class="spoiler_title">An example of the absence of some translations, replacement of pt locale resources with en</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/0b9/229/77c/0b922977cac448419e306c60db2239dd.png"></div></div><br><p>  Here comes the rational assumption that for a localized application there is a default locale for which the set of resources is always relevant and complete. </p><br><p>  However, there is another problem with the default locale: for a user in Kazakhstan, in the absence of Kazakhstan localization, it is most natural to display a resource for the Russian locale, while for a user in China it is logical to show the resource for the English locale, since in China, English at least somehow owns a large proportion of the population than Russian. </p><br><p>  The <a href="https://msdn.microsoft.com/en-us/library/sb6a8618(v%3Dvs.110).aspx">documentation</a> on localization in .NET describes the term resource fallback process, which can be translated into Russian as "processing alternative resources."  The essence of processing is that if the corresponding resources are not found for the current user interface locale, then an attempt will be made to find resources for the parent locale.  So, for the <code>en-IN</code> locale, the parent <code>en-IN</code> will be the neutral locale <code>en</code> (neutral - not containing region-specific).  Therefore, in most cases, neutral locales can be recommended for storing the universal language for the dialects of one localization language.  And for the <code>en</code> locale, in turn, the parent will be invariant, if selected, an attempt will be made to find the default resources that must always exist. </p><br><p>  Alas, in the .NET Framework, the logic for processing alternative resources is ‚Äúwired‚Äù deep into the platform‚Äôs depth. </p><br><p>  Our task is to learn how to customize the process of finding resources.  To do this, let's introduce the abstraction <code>IResourceFallbackProcess</code> .  Its sole responsibility will be to generate convenient locale sequences for us to search for suitable resources.  At the same time, completely different classes, for example, <a href="https://msdn.microsoft.com/en-us/library/system.resources.resourcemanager(v%3Dvs.110).aspx">ResourceManager</a> , are responsible for searching and loading resources (in the file system, database, etc.). </p><br><p>  Imagine a new interface: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IResourceFallbackProcess</span></span> {   <span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">         ,   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment">     .   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment">   </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="initial"&gt;</span></span></span><span class="hljs-comment"> .</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment">   IEnumerable</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;CultureInfo&gt;</span></span></span><span class="hljs-comment"> GetFallbackChain(CultureInfo initial); }</span></span></code> </pre> <br><p>  This interface will allow us to implement our plans for each locale of user interfaces: </p><br><ul><li>  for <code>initial</code> <code>zh-CH</code> locales, we can return the chain <code>zh-CH -&gt; zh-CHS -&gt; zh-Hans -&gt; zh -&gt; en</code> , </li><li>  for the <code>initial</code> <code>kz-KZ</code> locale, we can return the <code>kz-KZ -&gt; kz -&gt; ru</code> chain <code>kz-KZ -&gt; kz -&gt; ru</code> . </li></ul><br><p>  And, of course, <code>IResourceFallbackProcess</code> should be actively used in a multilingual string.  The overloads of the <code>GetString(...) / ToString(...)</code> methods look appropriate with the <code>IResourceFallbackProcess resourceFallbackProcess</code> and <code>bool useFallback</code> , overloads without <code>useFallback</code> use <code>true</code> , and overloads without <code>resourceFallbackProcess</code> is a standard search order for your application. </p><br><br><h1>  Conclusion </h1><br><p>  The <a href="">source code of</a> our library shows a working implementation of the <code>IResourceFallbackProcess</code> .  It may be useful for the reader to make this implementation configurable, as well as create your own <code>CustomizedResourceManager</code> using <code>IResourceFallbackProcess</code> .  You can also write an extension for Visual Studio so that classes automatically generated for resource files use your <code>CustomizedResourceManager</code> . </p><br><p>  Obviously, we considered not all possible ‚Äústages‚Äù, but only the most demanded and universal ones.  For example, you can think about <code>MultiCulturalStringBuilder</code> , and for formatting - about <code>IMultiCulturalFormattable</code> . </p><br><p>  In the next article ‚ÄúBasements of the Tower of Babel, or About the Internationalization of the Database with Access via ORM‚Äù, we will look at the storage of localized data in the database and access to it through the object-relational mapper. </p></div><p>Source: <a href="https://habr.com/ru/post/313284/">https://habr.com/ru/post/313284/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313268/index.html">What is a ‚Äútrap for a person‚Äù in the data center and why is it needed?</a></li>
<li><a href="../313270/index.html">Elections 2016. Part 1 - Results and Comparisons</a></li>
<li><a href="../313274/index.html">Misconceptions of most programmers regarding "time"</a></li>
<li><a href="../313276/index.html">Dirty COW dangerous 0-day vulnerability found in Linux kernel (CVE-2016-5195)</a></li>
<li><a href="../313278/index.html">The role of free software in a world where people don't care</a></li>
<li><a href="../313286/index.html">Breaking Up the Monolith: Refactoring the Web Application Architecture</a></li>
<li><a href="../313288/index.html">Fixed dangerous vulnerability in Linux kernel</a></li>
<li><a href="../313290/index.html">Tutorial: listing modules and cameras</a></li>
<li><a href="../313292/index.html">Windows Server 2016: clouds - to the masses</a></li>
<li><a href="../313294/index.html">Overview of decentralized crypto platforms. Part 2: Lisk</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>