<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Database Version Control Engine in GIT (MySQL Dump Management)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, lovers of Habr! Today I decided to share my version of data backup from MySql and talk about how it can be used to control versions in Git. And...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Database Version Control Engine in GIT (MySQL Dump Management)</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello, lovers of Habr!  Today I decided to share my version of data backup from MySql and talk about how it can be used to control versions in Git.  And if you are interested in finding out how to monitor the state of the database at all stages of development, or just make the <strong>correct</strong> backups of your project database and deploy it at any time, then I ask you to read it! <a name="habracut"></a></p><br><h3 id="chto-eto">  What is it? </h3><br><p>  This is a set of scripts written in BASH, which allows them to work on almost any machine in which this shell works, designed to facilitate the creation and deployment of backups.  The original idea was to create control points for the database when the project was written by a team of developers, and to keep it in the game, I know that there are more serious things for such a purpose, and this solution does not pretend to be their place. </p><br><h3 id="dlya-kogo">  For whom? </h3><br><p>  For example, you prefer to develop the site immediately on the customer's hosting and monitor the development progress and changes in the database.  Either you have little money (or a toad strangles) to spend it on good products to control database versions.  You can also use the project as a data backup based on certain rules, which can be used for the crown.  And of course it will come in handy if you are a beginner developer and are just starting to master the basics of development, and you have the 500th periodically and you don‚Äôt know why.  Either you are developing a product with a team and you want to automatically synchronize it with the production to assess the customer when pushing into the master. </p><br><p>  Consider an example of a standard site development on the hosting side (most cases): </p><br><ol><li>  There is a server on which the project is spinning and most likely it is either a local machine or hosting the client of the current project. </li><li>  There is a local computer where you work and traditionally store files and snapshots of states there. </li><li>  And Production, this is where the final product merges - but it can also be the 1st item just another folder. </li></ol><br><h3 id="kak-s-etim-rabotat">  How to work with it? </h3><br><p>  In order to comply with the control version of the database using git, obviously you need to get its dumps at some stages, where to store them, and when switching branches take into account this point.  For this, I used the hooks of the gita, which are the files of the corresponding scripts (they must be installed on the local computer where git is used).  Depending on the configuration file settings, the workflow <strong>may</strong> look like this: </p><br><p>  We create a branch (automatically a backup has occurred) and switch, we work, we add files, we create a commit (a backup has automatically occurred) ... <br>  switched to the master Verka, the database was switched to the previous state ... <br>  returned to development, merged branches, started.  Those.  backups are automatically created at commit <br>  or forced before the checkout, the behavior is configured in the config.  You can manually call export or import the database on the server, from your local computer, by running the corresponding script. </p><br><p>  Each script can get help in the classical way through the argument -h or --help. </p><br><p> I do not recommend backing up the entire database, git does not like large files, and in most cases it is not necessary.  Therefore, you can easily configure using <code>config.ini</code> Since the settings are used both on the server side (on which mySql is raised) and on the client side (the developer‚Äôs computer), the same file is responsible for the settings.  And of course it can be the same computer, if you are developing locally. </p><br><h3 id="chto-mozhno-nastraivat-dlya-sozdaniya-dampa">  What can be configured to create a dump </h3><br><ul><li>  Database connection settings and storage paths of dumps </li><li>  An indication of a provider who can not only get the connection data to the database, but <br>  and correctly clear the cache on the server when switching branches. </li><li>  Export the entire database </li><li>  List of tables to be excluded from export </li><li>  Or export of certain tables </li><li>  Preserving the structure without inserting data in certain tables </li><li>  Indication of fields in tables whose values ‚Äã‚Äãshould not be exported, and should <br>  be replaced by default values. </li><li>  Separate sets of rules in one config, which will allow you to make different backups for CRON </li></ul><br><p>  In order to facilitate the process of creating dumps.  I used the file providers.  And set up (while only one) for CMS MODX revolution.  Based on it, you can write the same provider for any CMS. </p><br><h3 id="kratkie-shagi-k-nachalu-raboty">  Short steps to getting started </h3><br><pre> <code class="plaintext hljs"> ,       .git,   ,     git [git clone ](https://github.com/Setest/.git-db-watcher)          chmod +x install.sh;   ./install.sh   ,     ./install.sh -nh</code> </pre> <br><p>  Now you need to make changes to the <code>config.ini</code> .  For example, like this: </p><br><pre> <code class="plaintext hljs">;  [hooks] ; H_CHECK_DB_HASH_BEFORE_CHECKOUT=1 ;      checkout      ;           ;  git checkout -b new_branch_name H_CHECKOUT_FORCE=0 ;        H_CHECKOUT_EVERCOM=1 ;       H_CHECKOUT_CLEARCACHE=1 [common] ;       EXPORT_FILE="db.sql" ;           ;   ./export.sh [develop] ;  db_export.sh   CLI_DB_EXPORT="ssh host '/path/to/project/on/server/.git-db-watcher/db_export.sh'" CLI_DB_IMPORT="ssh host '/path/to/project/on/server/.git-db-watcher/db_import.sh'" ;   [server] PHP_PATH="/usr/local/bin/php" CONFIG_INC_PATH="/path/to/project/on/server/core/config/config.inc.php" PROVIDER=modx DB_TABLES_INCLUDE=site_content DB_TABLES_AUTOPREFIX=1 [server_full_site] PHP_PATH="/usr/local/bin/php" CONFIG_INC_PATH="/path/to/project/on/server/core/config/config.inc.php" ; '' -       DB_CONFIG_     ;  providers PROVIDER=modx ;          DB_CONFIG_HOST= DB_CONFIG_TYPE= DB_CONFIG_USER= DB_CONFIG_PASSWORD= DB_CONFIG_CONNECTION_CHARSET= DB_CONFIG_DBASE= DB_CONFIG_TABLE_PREFIX= DB_CONFIG_DATABASE_DSN= ;        ( ) ;     ; DB_TABLES_INCLUDE=manager_log register_messages user_attributes ; DB_TABLES_INCLUDE=site_content ;    ; DB_TABLES_EXCLUDE=session register_messages mse2_words ec_messages ; ,    ,    DB_TABLES_AUTOPREFIX=1 ;       INSERT DB_TABLES_REMOVE_INSERT="manager_log session register_messages" ; DB_TABLES_REMOVE_INSERT="manager_log" ;        ; DB_TABLES_DEFAULT=user_attributes users DB_TABLES_DEFAULT=user_attributes ;   ,     ;       ,     ;    DB_TABLES_DEFAULT_user_attributes=sessionid logincount lastlogin thislogin ; DB_TABLES_DEFAULT_users=session_stale ;  ,     [only_users] DB_TABLES_INCLUDE=user user_attributes EXPORT_FILE="users.sql" DB_TABLES_DEFAULT=user_attributes user DB_TABLES_DEFAULT_user_attributes=sessionid logincount lastlogin thislogin DB_TABLES_DEFAULT_users=session_stale</code> </pre> <br><p>  If everything is configured correctly, you can run <code>./export.sh</code> and you should <br>  there will be a dump of the database on the local computer and on the server. </p><br><h3 id="ostalnye-voprosy">  Other questions </h3><br><blockquote>  I need to save the result on the server to another location: </blockquote><br><pre> <code class="plaintext hljs"> ./db_export.sh --output 1&gt;./xxx.sql</code> </pre> <br><blockquote>  I want to export to the server using the data in my section of the configuration file: </blockquote><br><pre> <code class="plaintext hljs"> ./db_export.sh -=only_users --output 1&gt;./users.sql</code> </pre> <br><blockquote>  I want to import a database file, but I don‚Äôt want to do it through GIT interceptors? </blockquote><br><pre> <code class="plaintext hljs"> ./import.sh ./import.sh EXPORT_FILE=site_name.sql ./import.sh DB_BACKUP_FILE=/.../../site_name.sql ./import.sh --config=site DB_BACKUP_FILE=./site_name.sql</code> </pre> <br><blockquote>  How to import while being on the server? </blockquote><br><pre> <code class="plaintext hljs"> ./db_import.sh &lt; db_backup/db.sql</code> </pre> <br><blockquote>  In different projects I use CMS xxx and I am tired of entering data every time <br>  for database management, how can I simplify the process? </blockquote><p>  To do this, you need to write your provider file by analogy with the existing ones. </p><br><blockquote>  I created the CRON job and configuration using the php provider, but it <br>  is not executed, or the CMS site cache is not cleared, what could be wrong? </blockquote><p>  Depending on the server settings and the task itself, the CRON tasks can run in a completely different environment, in which the path to the php preprocessor may differ and, as a result, run a completely different version of php that is not compatible with the one running your CMS. </p><br><h3 id="posleslovie">  Afterword </h3><br><p>  I have never written BASH scripts and therefore probably <del>  head code </del>  I am sure there are literate guys here who, if interested, will be able to add their edits.  I will develop the project to the extent of incoming interest and the identification of errors in the work. </p><br><p>  And you should not immediately stink that nothing works, perhaps you could not figure out how to make the proper configuration and installation (especially if you are working on Windows, yet BASH is a Linux environment). </p><br><p>  Instructions for installation and use is in the readme.  I tried to immediately write in English, but also because of my amateur level, maybe not everything is clear, in the future I will write in Russian.  If you want to make changes to the translation or code, fork your health!  And if there are good tips - share. </p><br><p>  PS: if you read it to the bottom, then it became interesting for you and can't wait to try :-) </p><br><p>  <a href="https://github.com/Setest/.git-db-watcher">Then tych bolder on this ssylochku!</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/449868/">https://habr.com/ru/post/449868/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../449858/index.html">Sound transmission by amplitude modulation of ultrasound</a></li>
<li><a href="../449860/index.html">Cloud box office, my humble experience</a></li>
<li><a href="../449862/index.html">The digest of interesting materials for the mobile developer # 296 (April 22 - 26)</a></li>
<li><a href="../449864/index.html">ResNet50. Its implementation</a></li>
<li><a href="../449866/index.html">Potential HTTPS attacks and how to protect against them</a></li>
<li><a href="../44987/index.html">Running a project on different hosts</a></li>
<li><a href="../449870/index.html">Universal JSONDecoder</a></li>
<li><a href="../449876/index.html">Innovation SSI-2001: the story of one of the rarest sound cards for the IBM PC (and its replicas)</a></li>
<li><a href="../449878/index.html">Patent research in IT. Course young fighter. Part I. How to understand customer requirements and prepare a report template</a></li>
<li><a href="../44988/index.html">Answers on questions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>