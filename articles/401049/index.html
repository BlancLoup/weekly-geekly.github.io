<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Jarvis is back in business</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Surely, everyone dreams of his voice assistant, under the cut is another implementation of "Jarvis" from the famous movie. 



 It has long been the t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Jarvis is back in business</h1><div class="post__text post__text-html js-mediator-article">  Surely, everyone dreams of his voice assistant, under the cut is another implementation of "Jarvis" from the famous movie. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/b15/9f2/15a/b159f215ad483c84e9927b2639336182.jpg" alt="image"><br><a name="habracut"></a><br>  It has long been the thought of his "Jarvis" and the management of equipment in the house voice.  And then, finally, the hands reached the creation of this miracle.  I didn‚Äôt have to think long over the brains; <br><br>  So iron: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Raspberry pi 3 model b </li><li>  Logitech usb camera </li></ul><br><h2>  Implementation </h2><br>  Our assistant will work on the principle of Alexa / Hub: <br><br><ol><li>  Activate offline for a specific word </li><li>  Recognize the team in the cloud </li><li>  Execute the command </li><li>  Report on the work or inform the requested information. </li></ol><br>  Since  My camera is supported out of the box, I didn‚Äôt have to mess with the drivers, so we immediately proceed to the software part. <br><br><h4>  Offline activation </h4><br>  Activation will occur with the help of CMU Sphinx, and everything would be fine, but out of the box, recognition is very slow, more than 10 seconds, which is absolutely not suitable, you need to clear the dictionary of unnecessary words to solve the problem. <br><br>  Install everything you need: <br><br><pre><code class="hljs sql">pip3 <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> SpeechRecognition pip3 <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> pocketsphinx</code> </pre> <br>  Further <br><br><pre> <code class="hljs pgsql">sudo nano /usr/<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/lib/python3<span class="hljs-number"><span class="hljs-number">.4</span></span>/dist-packages/speech_recognition/pocketsphinx-data/en-US /pronounciation-<span class="hljs-keyword"><span class="hljs-keyword">dictionary</span></span>.dict</code> </pre> <br>  delete everything except the Jarvis we need: <br><br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">jarvis</span></span> JH AA RV AH S</code> </pre> <br>  Now pocketsphinx recognizes pretty quickly. <br><br><h4>  Speech recognition </h4><br>  At first there was the idea to use the Google service, besides its support is in SpeechRecognition.  But as it turned out, Google takes money for it and does not work with physical.  by individuals. <br><br>  The benefit of Yandex also <a href="https://tech.yandex.ru/speechkit/">provides</a> such an opportunity, free of charge and extremely simple. <br><br>  Register, get API KEY.  All work can be done curl'om. <br><br><pre> <code class="hljs kotlin">curl -X POST -H <span class="hljs-string"><span class="hljs-string">"Content-Type: audio/x-wav"</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>-binary <span class="hljs-string"><span class="hljs-string">"@file"</span></span> ¬´https:<span class="hljs-comment"><span class="hljs-comment">//asr.yandex.net/asr_xml?uuid=ya_uid&amp;key=yf_api_key&amp;topic=queries¬ª</span></span></code> </pre> <br><h4>  Speech synthesis </h4><br>  Here again Yandex will help us.  We send the text in reply we receive the file with the synthesized text <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">curl</span></span> ¬´https://tts.voicetech.yandex.net/generate?format=wav&amp;lang=ru-RU&amp;speaker=zahar&amp;emotion=good&amp;key=ya_api_key¬ª -G --data-urlencode <span class="hljs-string"><span class="hljs-string">"text=text"</span></span> &gt; file</code> </pre> <br><h4>  Jarvis </h4><br>  Putting it all together and get this script. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#! /usr/bin/env python # -*-coding:utf-8-*- import os import speech_recognition as sr from xml.dom import minidom import sys import random r = sr.Recognizer() ya_uuid = '' ya_api_key = '' # os.system('echo "+ +" |festival --tts --language russian') def convert_ya_asr_to_key(): xmldoc = minidom.parse('./asr_answer.xml') itemlist = xmldoc.getElementsByTagName('variant') if len(itemlist) &gt; 0: return itemlist[0].firstChild.nodeValue else: return False def jarvis_on(): with sr.WavFile("send.wav") as source: audio = r.record(source) try: t = r.recognize_sphinx(audio) print(t) except LookupError: print("Could not understand audio") return t == ("jarvis") def jarvis_say(phrase): os.system( 'curl "https://tts.voicetech.yandex.net/generate?format=wav&amp;lang=ru-RU&amp;speaker=zahar&amp;emotion=good&amp;key='+ya_api_key+'" -G --data-urlencode "text=' + phrase + '" &gt; jarvis_speech.wav') os.system('aplay jarvis_speech.wav') def jarvis_say_good(): phrases = ["", "", "", "", "- ?", ] randitem = random.choice(phrases) jarvis_say(randitem) try: while True: os.system('arecord -B --buffer-time=1000000 -f dat -r 16000 -d 3 -D plughw:1,0 send.wav') if jarvis_on(): os.system('aplay jarvis_on.wav') os.system('arecord -B --buffer-time=1000000 -f dat -r 16000 -d 3 -D plughw:1,0 send.wav') os.system( 'curl -X POST -H "Content-Type: audio/x-wav" --data-binary "@send.wav" "https://asr.yandex.net/asr_xml?uuid='+ya_uuid+'&amp;key='+ya_api_key+'&amp;topic=queries" &gt; asr_answer.xml') command_key = convert_ya_asr_to_key() if (command_key): if (command_key in ['key_word', 'key_word1', 'key_word2']): os.system('') jarvis_say_good() continue except Exception: jarvis_say('-   ')</span></span></code> </pre><br>  What's going on here.  Run an infinite loop, arecord'om write three seconds and send sphinx for recognition if the word ‚Äújarvis‚Äù appears in the file <br><br><pre> <code class="hljs objectivec"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> jarvis_on():</code> </pre> <br>  We play a pre-recorded activation alert file. <br><br>  Again, write 3 seconds and send to Yandex, in response we get our team.  Next, perform actions based on the command. <br><br>  That's all for it.  A lot of scripts can be created. <br><br><h2>  Use-case </h2><br>  Now some real examples of my use. <br><br><h4>  Philips Hue </h4><br>  Install <br><br><pre> <code class="hljs sql">pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> phue</code> </pre> <br>  In the Hue application, set the static IP: <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/752/bd3/7f6/752bd37f6ef7197d803e685eebcb3e3f.png" alt="image" width="50%"><br><br>  Run: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python import sys from phue import Bridge b = Bridge('192.168.0.100') # Enter bridge IP here. #If running for the first time, press button on bridge and run with b.connect() uncommented #b.connect() print (b.get_scene())</span></span></code> </pre> <br>  We write out the ID of the necessary schemes, type "470d4c3c8-on-0" <br><br>  The final script: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python import sys from phue import Bridge b = Bridge('192.168.0.100') # Enter bridge IP here. #If running for the first time, press button on bridge and run with b.connect() uncommented #b.connect() if (sys.argv[1] == 'off'): b.set_light([1,2,3],'on', False) else: b.activate_scene(1,sys.argv[1])</span></span></code> </pre> <br>  Add to jarvis: <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (command_key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>]): os.system(<span class="hljs-string"><span class="hljs-string">'python3 /home/pi/smarthome/hue/hue.py a1167aa91-on-0'</span></span>) jarvis_say_good() <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (command_key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>]): os.system(<span class="hljs-string"><span class="hljs-string">'python3 /home/pi/smarthome/hue/hue.py ac637e2f0-on-0'</span></span>) jarvis_say_good() <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (command_key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>]): os.system(<span class="hljs-string"><span class="hljs-string">'python3 /home/pi/smarthome/hue/hue.py "off"'</span></span>) jarvis_say_good() <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span></code> </pre><br><h4>  Lg tv </h4><br>  We take the script <a href="https://github.com/ubaransel/lgcommander">from here</a> .  After the first launch and input of the pairing code, the code itself does not change, so you can cut this part out of the script and leave only the manager. <br><br>  Add to jarvis: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#1 - POWER #24 - VOLUNE_UP #25 - VOLUME_DOWN #400 - 3D_VIDEO if (command_key in [' ', ' ']): os.system('python3 /home/pi/smarthome/TV/tv2.py 1') jarvis_say_good() continue if (command_key in [' ', '']): os.system('python3 /home/pi/smarthome/TV/tv2.py 24') jarvis_say_good() continue</span></span></code> </pre> <br><h4>  Radio </h4><br><pre> <code class="hljs swift">sudo apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install mpg123</code> </pre> <br>  Add to jarvis: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (command_key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>,<span class="hljs-string"><span class="hljs-string">' '</span></span>]): os.system(<span class="hljs-string"><span class="hljs-string">'mpg123 URL'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span></code> </pre> <br>  You can also put a <a href="https://github.com/nfarina/homebridge">homebridge</a> and manage everything through Siri, if you don‚Äôt shout before Jarvis. <br><br>  As for the quality of speech recognition, not Alexa of course, but at a distance of 5 meters the percentage of correct hit is decent.  The main problem - the speech from the TV \ speakers is recorded along with the commands and interferes with the recognition. <br><br>  That's all, thank you. </div><p>Source: <a href="https://habr.com/ru/post/401049/">https://habr.com/ru/post/401049/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../401039/index.html">End of the Freebies: I Also Know What You Download (Part 2)</a></li>
<li><a href="../401041/index.html">BYD auto - the company that overtook Apple</a></li>
<li><a href="../401043/index.html">Life and pinball. What common?</a></li>
<li><a href="../401045/index.html">Facts and speculations about space issues in Voronezh</a></li>
<li><a href="../401047/index.html">Human Behavior Biology: Lecture # 4. Molecular genetics, I [Robert Sapolski, 2010. Stanford]</a></li>
<li><a href="../401051/index.html">Scientists have confirmed the existence of "time crystals" - the phase state of matter with the violation of time symmetry</a></li>
<li><a href="../401053/index.html">Physics in the animal world: ofiuras and their unusual vision</a></li>
<li><a href="../401057/index.html">The UK military system sees working equipment even behind a concrete wall</a></li>
<li><a href="../401059/index.html">Former Firefox Developer: Remove Third-Party Antiviruses</a></li>
<li><a href="../401061/index.html">Humidification and air cleaning system</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>