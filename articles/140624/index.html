<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create a simple widget for Mac OS X Dashboard</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, habravchane-makovody! 

 Today we will try to understand the basics of creating a widget for the Dashboard in Mac OS X. We will need the Dashco...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create a simple widget for Mac OS X Dashboard</h1><div class="post__text post__text-html js-mediator-article"> Hello, habravchane-makovody! <br><img src="https://habrastorage.org/storage2/9ec/afd/457/9ecafd457dd040b1fd49fb3b7d29345b.png" align="right" alt=" " title="Post picture"><br>  Today we will try to understand the basics of creating a widget for the Dashboard in Mac OS X. We will need the Dashcode program designed just for this. <br><br>  First, a little theory.  Dashboard widget is a specially crafted webpage packed in a bundle along with all the resources.  Well, some service information in the appendage.  Accordingly, the programming language used is JavaScript.  If you are already familiar with it, as well as with HTML / CSS (although this is hardly needed), then you are <b>already</b> able to write a simple widget.  If not, then you should not be upset, this language is very simple and intuitive, you can deal with it quickly enough.  Further, I will assume that the JS reader is more or less familiar.  The article itself is designed for beginners, so please do not scold for "too simple presentation and detailed chewing of elementary things."  In addition, I also ask you not to kick in for the design - well, I'm not a designer, not a designer!  If anyone wants to help with this business - <i>welcome =)</i> <br><br>  For convenience, all source codes (as well as a widget that is ready to use) are posted on the githab, the link at the end of the article.  But do not rush to just download them!  It is better to spend a little time and figure out how to create it all yourself. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So let's get started.  As a goal for experiments, I, of course, chose our favorite habr.  We will step by step make a widget that displays karma, rating and position in the ranking of habraudera of the selected habraiser. <br><img src="https://habrastorage.org/storage2/90e/660/c75/90e660c750f892165d6a25c5a92dd575.png" alt="   " title="Picture to attract attention"><br>  Such a widget (well, very similar) was <a href="http://habrahabr.ru/post/9547/">already created by the</a> neoromantic <a href="https://habrahabr.ru/users/neoromantic/" class="user_link">hacker</a> as much as in 2007, but the download links are not working, and besides, that article did not contain practical guidelines for creating such widgets. <br><a name="habracut"></a><br>  <s>Restoring the right We</s> fill these shortcomings. <br><br>  Create an empty project.  To do this, run Dashcode and click in the right places.  The process is trivial. <br><br>  What do we see?  The base widget has the main and auxiliary states (respectively, front and back in the left panel).  The first is displayed in the normal mode of operation, the second - to configure the widget parameters.  You can switch between them by selecting the corresponding items in the list of components on the left.  We can safely remove all unnecessary, except for the ‚Äúinfo‚Äù and ‚ÄúDone‚Äù buttons, which are used to switch between the main and auxiliary states.  Further, for simplicity, we will call it the front and back sides of the widget. <br><br>  Now on the front side of our widget (without a single line of code!) We throw the necessary components: several labels.  To do this, open the library component - button <img src="https://habrastorage.org/storage2/a42/2c7/df1/a422c7df1b3262581309396514fd7488.png">  Library at the top right - and dragging components of the type ‚ÄúText‚Äù to the widget.  Now open <img src="https://habrastorage.org/storage2/b5c/010/505/b5c010505705b4fa06b633041c838685.png">  Inspector (also the button on the right above) and with its help we adjust the sizes, colors and so on for our widget.  With his help, we will give meaningful names to our inscriptions - for easier access from the code. <br><br>  On the back side of the kinema inscription and input box.  Well, and another picture - for beauty.  And in the end we get something like <br><br><img src="https://habrastorage.org/storage2/94d/241/7f1/94d2417f1c4ae555c4f02dd904eb6eb0.png"><br><br>  Well, not bad, our GUI is ready!  We can press <img src="https://habrastorage.org/storage2/2f6/338/fac/2f6338fac83291b0e2adca663b8b5c5e.png">  <code>Cmd+R</code> and poke the buttons (i) and Done, admiring the effect of the widget's coup. <br><br>  But one GUI is not enough for us, so go to the logic.  To do this, at the top left click on the button <img src="https://habrastorage.org/storage2/e90/ba5/24d/e90ba524dfdd43ed09bc91e06b21ee1a.png">  View and choose in the drop-down list Source Code.  And we can already see our automatically generated JavaScript code.  And we boldly begin to rule it! <br><br>  To begin with, let's define the ‚Äúarchitecture‚Äù of our widget.  We will request a timer using <a href="http://habrahabr.ru/info/help/api/">the habr API</a> about the user, parse them and display the karma and rating on the front side of the widget.  To do this, we declare the global variable <code>updateTimer</code> at the beginning of the main.js file, create the <code>startTimer(msec)</code> and <code>stopTimer()</code> functions that will work with this timer.  Also create a function <code>updateStats()</code> , which will be called on a timer. <br><br><pre> <code class="hljs actionscript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(msec)</span></span></span><span class="hljs-function"> </span></span>{ updateTimer = setTimeout(<span class="hljs-string"><span class="hljs-string">"updateStats()"</span></span>, msec); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stopTimer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ clearTimeout(updateTimer); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateStats</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ alert(<span class="hljs-string"><span class="hljs-string">"It works!"</span></span>); startTimer(updateInterval); }</code> </pre><br>  In the <code>show()</code> function, we <code>startTimer(5000)</code> call to start the timer when the widget is shown, and in the <code>hide()</code> function, respectively, we <code>stopTimer()</code> to save resources when the widget is not shown (Dashboard is not active).  Now we can start our widget and see in the console (Cmd + Alt + 1) the output ‚ÄúIt works!‚Äù Every 5 seconds. <br><br>  But we are not interested in such nonsense, we want to delay karma and rating on a timer!  So, in the <code>updateStatus()</code> function, instead of an alert, we will call the <code>execStatsRequest()</code> function (the Habr API advises not to tweak user data more than once per minute, so at the same time we increase the interval). <br><br>  Now it's up to HTTP requests to the habrahabr API.  We create new functions - execStatsRequest () and processStatsRequest (), which will serve to launch and process requests.  Here is how they look at me: <br><pre> <code class="hljs actionscript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execStatsRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (userName().length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Url = <span class="hljs-string"><span class="hljs-string">"http://habrahabr.ru/api/profile/"</span></span> + userName() + <span class="hljs-string"><span class="hljs-string">"/"</span></span>; alert(<span class="hljs-string"><span class="hljs-string">"User: "</span></span> + userName() + <span class="hljs-string"><span class="hljs-string">"\nURL: "</span></span> + Url); xmlHttp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xmlHttp.onreadystatechange = processStatsRequest; xmlHttp.overrideMimeType(<span class="hljs-string"><span class="hljs-string">'text/xml'</span></span>); xmlHttp.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>, Url, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xmlHttp.send(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { resetStats(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processStatsRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xmlHttp.readyState == <span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; xmlHttp.status == <span class="hljs-number"><span class="hljs-number">200</span></span>) { alert(<span class="hljs-string"><span class="hljs-string">"xml is "</span></span> + xmlHttp.responseXML); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xmlHttp.responseXML == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { resetStats(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { alert(xmlHttp.responseText); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> error = xmlHttp.responseXML.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"error"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (error != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { alert(<span class="hljs-string"><span class="hljs-string">"Some error occured!"</span></span>); resetStats(); setLogin(<span class="hljs-string"><span class="hljs-string">"&lt;"</span></span> + userName() + <span class="hljs-string"><span class="hljs-string">" not found&gt;"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> login = xmlHttp.responseXML.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"login"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].firstChild.nodeValue; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> karma = xmlHttp.responseXML.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"karma"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].firstChild.nodeValue; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rating = xmlHttp.responseXML.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"rating"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].firstChild.nodeValue; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> position = xmlHttp.responseXML.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"ratingPosition"</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].firstChild.nodeValue; setLogin(login); setKarma(karma); setRating(rating); setPosition(position); } } }</code> </pre><br>  Here we create the URL of the request, create an object of the XMLHttpRequest type, and with its help we request our data using the GET method.  What is remarkable, we have to <b>force the</b> answer to the MIME type <i>"text / xml"</i> , because for some reason for some reason it returns the text / html.  And in the <code>processStatsRequest()</code> function we parse the response received in XML.  At the same time, we check it for an error - and notify the user about it. <br><br>  Here it is necessary to distract from the code and configure the widget itself - allow it to work with the network.  To do this, in the left pane, scroll down the list of items and see the Widget Attributes item.  Here we just tick the ‚ÄúAllow Network Access‚Äù.  You can also customize the widget id and its version.  Now back to the code. <br><br>  The functions <code>setLogin()</code> , <code>setKarma()</code> and their ilk display the string passed to them in the required fields on the front side.  They were created for convenience and look the same, like that: <br><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setLogin</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">login</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"userName"</span></span>).innerText = login; }</code> </pre><br>  The <code>resetStats()</code> function sets default values ‚Äã‚Äãfor all fields.  And the setUserName () and userName () functions serve as a wrapper over the input field for the name of the habrauser on the back side of the widget: <br><br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">userName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"nameEdit"</span></span>).value; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUserName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"nameEdit"</span></span>).value = name; }</code> </pre><br>  Well, the widget is almost ready.  Why almost?  Yes, because we need to save the entered username in the settings.  To do this, we write the <code>loadPrefs()</code> and <code>savePrefs()</code> functions. <br><br><pre> <code class="hljs actionscript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> preferenceKey = <span class="hljs-string"><span class="hljs-string">"habraUserName"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadPrefs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = widget.preferenceForKey(widget.identifier + <span class="hljs-string"><span class="hljs-string">"-"</span></span> + preferenceKey); alert(widget.identifier + <span class="hljs-string"><span class="hljs-string">"-"</span></span> + preferenceKey); alert(<span class="hljs-string"><span class="hljs-string">"name from preferences: "</span></span> + name); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (name != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) setUserName(name); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">savePrefs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ widget.setPreferenceForKey(userName(), widget.identifier + <span class="hljs-string"><span class="hljs-string">"-"</span></span> + preferenceKey); }</code> </pre><br>  It is advisable to call these functions in the <code>show()</code> and <code>hide()</code> functions, respectively.  The setting will be unique for each widget, which allows you to add widgets to the Dashboard with information on several users. <br><br>  Well, now the widget is certainly ready to use.  But there is no limit to perfection!  We now localize our widget in order to have Russian and English versions.  You can also do (as homework) localization into French and Japanese. <br><br>  Go to our front, we call the inspector.  Now we select our labels one by one and in the Localization section of the inspector set the value in English in the Value field.  They will probably coincide with the preset values ‚Äã‚Äãof the Key field.  These values ‚Äã‚Äãwill be entered in the default (English) localization, which can be seen in the file <code>en.lproj/localizedStrings.js</code> . <br><br>  Now add Russian localization.  Transitions in Widget Attributes and in the Localization section add (in the left list) the Russian language.  We select it, and now in the right list we can enter localized strings. <br><img src="https://habrastorage.org/storage2/954/13d/eb5/95413deb51f203a6599a69068043a409.png"><br>  These values, respectively, will be written in <code>ru.lproj/localizedStrings.js</code> . <br><br>  Actually, that's all, we can run our widget and admire our (or someone else's) karma!  To install the widget in the Dashboard, you need to select Run &amp; Share in the left pane and select Save to Disk or Deploy to Dashboard - depending on our needs. <br><br>  If you want to download a ready-made widget, then you are welcome: <a href="">here it is</a> !  The source code of the project for Dashcode can be taken on a <a href="https://github.com/silvansky/HabraDash">githaba</a> . <br><br>  I hope someone found this article useful and the list of widgets for the Dashboard will be updated with great things! </div><p>Source: <a href="https://habr.com/ru/post/140624/">https://habr.com/ru/post/140624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140612/index.html">SCSS - a little practice, part I</a></li>
<li><a href="../140613/index.html">There are only structural and object programming paradigms.</a></li>
<li><a href="../140616/index.html">Access to static data</a></li>
<li><a href="../140617/index.html">Without wires. Release 3</a></li>
<li><a href="../140623/index.html">We trade Bitcoin title characters</a></li>
<li><a href="../140627/index.html">Creating a window interface using jQuery UI. Part 2</a></li>
<li><a href="../140629/index.html">IPv6 - he is near. Part 1</a></li>
<li><a href="../140630/index.html">Super smooth transformations for jQuery</a></li>
<li><a href="../140631/index.html">FCGI :: ProcManager module development</a></li>
<li><a href="../140633/index.html">Rails-based REST providers: a nightmare with views</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>