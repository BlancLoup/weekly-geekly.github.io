<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Infrastructure migration to the ‚Äúcloud‚Äù in steps: what difficulties arise and where</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We often help the customer's business to move to the "cloud" . This is a completely normal request, and most large companies somehow transfer their ca...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Infrastructure migration to the ‚Äúcloud‚Äù in steps: what difficulties arise and where</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/8d0/7d5/c46/8d07d5c46f7e4bbd98b61302dc838fe3.jpg"><br><br>  We often help the customer's business to move to the <a href="https://cloud.croc.ru/%3Futm_source%3Dhabr%26utm_medium%3Dblog%26utm_campaign%3Did324654">"cloud"</a> .  This is a completely normal request, and most large companies somehow transfer their capacities.  About 80% of cases occur in the transfer of an already virtualized infrastructure from the ‚Äúhome‚Äù server to the data center, the remaining 20% ‚Äã‚Äãis the transfer directly from hardware (including users' workstations) to the virtual environment plus the removal of the computing node itself into the ‚Äúcloud‚Äù. <br><br>  <b>Let's tell in steps how it happens with <a href="https://cloud.croc.ru/%3Futm_source%3Dhabr%26utm_medium%3Dblog%26utm_campaign%3Did324654">us</a> .</b>  I will begin with the fact that rarely anyone moves at once with all services.  Usually, non-criticals are taken away first, they look for a couple of months, and then everything else is translated. <br><a name="habracut"></a><br><h2>  Training </h2><br>  So, the first thing that is done is an assessment of capacity and infrastructure.  About the choice of a hypervisor and technical details can be read <a href="http://cloud.croc.ru/">here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In fact, you need to have a list of services and know what capacities are needed for them and what needs.  The task of a good administrator on the part of the customer is to make an accurate list of what is moving.  That is, ‚Äúsplitting up‚Äù services to the level when it becomes clear what process is needed for what and how many resources it eats. <br><br>  We allocate power with a small margin. <br><br>  <b>Then begins the assessment of the means of moving</b> - as a rule, there are issues of data transfer and conversion of virtual machines into the format of the desired hypervisor. <br><br>  <b>Then, in fact, the relocation of some services:</b> first, as I said, non-critical ones are taken away.  Most often they start with virtual users or, in the case of development, with test environments.  After a couple of months of running the test environments in the new "cloud" comes the turn of production.  Although there were reverse examples - for example, we have one bank almost from scratch transferred a heavy database to our ‚Äúcloud‚Äù (we gave IaaS and helped us adapt to our ‚Äúcloud‚Äù).  They really needed to move quickly - they did not have enough computing resources, and, after weighing all the risks, they decided that this was better. <br><br>  But usually everything is easier.  Depending on the migration tools, we plan the time when the services will be moved.  The easiest and cheapest way is to do it with downtime at least in 4-6 hours, more difficult - if you need full availability of the service during the move.  There are still cases when both the full availability of the service and the customer‚Äôs channels are slow at the same time, do not allow to transfer data quickly. <br><br><h2>  Moving </h2><br>  For offline travel, information is most often collected using the Clonezilla product.  An even simpler method is to turn off the product, download to the file storage of the entire image (more on this <a href="https://habrahabr.ru/company/croc/blog/277011/">here</a> ), then convert.  We support all types of virtualization. <br><br>  If you need to move online, we most often work this way: we put Double-Take agents on both sides (from where we are going and where we are going, that is, to the customer‚Äôs server and the virtual machine in the cloud), plus to the control machine.  It is cheaper to switch from idle in a few minutes, but Vizhn has a license for instant switching (it is an order of magnitude more expensive).  We had a case with an oraklovy base, there was a simple 2 seconds. <br><br>  You can move the means of applications - this is when we do not the image of the operating system as a whole, but directly the necessary part.  Most often it is about MS SQL, it has an excellent "native" replication. <br><br>  <b>Further the image is dragged through a dedicated channel or VPN.</b>  Some customers simply send over the big Internet.  As a rule, if we are talking about transferring the server node to the ‚Äúcloud‚Äù, the customer has his own channel right up to the provider.  If a ‚Äúzoo‚Äù is transferred without virtualization, it is sometimes more difficult: you have to build a VPN tunnel or upload images to alienable media.  In general, often the usual VPN with providers is limited to somewhere around 20 Mbit purely by the peculiarities of the technology.  Therefore, you must have a provider L2VPN, or you have to carry it over the Internet at your own risk.  Or you need a patchcord to the provider to do the exchange directly, but with encryption.  Dedicated channels are not a problem, many get a ‚Äúcloud‚Äù - physics connection: we calmly connect the iron servers in Vladivostok with the virtual ones in our country.  VPN through the "cloud": nothing is specifically needed, is there as a basic service. <br><br>  There are cases when there is really a lot of data, and even a gigabit channel on the customer‚Äôs side is not comfortable.  Then you can download everything to your hard drive from the product, bring it to us, download it to the ‚Äúcloud‚Äù.  Once they even dragged a laptop with a huge hard drive.  By the way, it is easy to call all providers, the main question of customers is how to leave if necessary.  We have exactly the same problem: for example, once a customer moved away from us with their S3-like storage (more precisely, they dragged everything from their S3-compatible to their site due to the peculiarities of how they processed their personal data).  Just asked to unload in S3 all virtualki in VMDK.  Profits with 2 hard drives of 2 TB each, connected to the server, copied the images.  We can safely give away in VMDK or other format. <br><br>  Another method of natural relocation is through backup and recovery at a new site, if the customer has a good backup or disaster recovery scheme. <br><br>  The customer is often surprised that there is the importance of the order of migration.  It happens this way: when the move begins, it turns out that one of the services was needed for the work of another service.  Therefore, dependency schemes are always compiled, a migration plan is worked out, so what. <br><br>  Often, when migrating from iron platforms, you also need to upgrade the OS of the source servers - this is also no problem, but you need to plan. <br><br><h2>  Platform Features </h2><br>  It often happens that the customer has one virtualization platform in the server node, and the move is made to another for various reasons.  Especially often migrating from VMware to KVM.  The key point here is that for KVM there are two types of virtualization.  The first and more productive is virtio, its work requires pre-installed drivers.  In the second case, legacy is less productive when using an IDE disk and an Intel E1000 network adapter.  However, sometimes this type of virtualization solves compatibility issues. <br><br>  <b>Then begins the quest with a different range of guest operating systems</b> - 2003 and even 2008 (it also was).  The hardest thing was since 2003, because not everything was getting smooth.  In particular, drivers are usually installed on the device, which should be in the operating system, but in the case of migration, firewood is also installed on the machine that is being transferred to devices that are not actually present.  So that when you deploy everything immediately fell as it should.  This is important, because before running in the cloud, such a machine does not have a network adapter, the virtual machine has its own HDD and Ethernet.  The car in the "cloud" has its own HDD driver and its own network.  As a result, in the Legacy mode, the old IDE disk and adapter are thrown through it.  But not in all cases it worked.  As a result, we came to the conclusion that with the Windows 2003s that got us, they decided to unload the snapshots into the intermediate environment (Proxmoxy), and there you can start the virtual machine so that it will have the first disk its ‚Äúold‚Äù IDE, and the second will be the virtual one Windows will see as an existing device.  Initially, in the Proxmox virtualization environment, drivers were installed on the VM to work in the KVM leverage, and then the VM was downloaded to us in the ‚Äúcloud‚Äù.  Then the virtual machine loaded back into the ‚Äúcloud‚Äù and took off.  Ubuntu-8 was also shaggy, but even it is newer than the 2003 Windows.  The most fun is that you cannot upgrade these operating systems on the customer side, for example, on some older systems, the Consultant Plus with a purchased license is spinning - this is a legacy that they are afraid to touch. <br><br>  <b>The next feature is the cluster.</b>  If the customer used his site, then when migrating to the ‚Äúcloud‚Äù such architecture usually requires rework.  More precisely, dragging a classic cluster into a ‚Äúcloud‚Äù is not the most rational approach.  There are always difficulties with this: how to drag?  Cluster software itself will be an extra layer.  But from the product it is often impossible to pull out.  Here we attract experts on clusters and we think - most often the cluster is removed in advance on the side of the customer, because there is no sense in dragging him behind. <br><br>  Compatibility issues arise, often - when moving Cisco to KVM or when migrating to MikroTik.  In general, it starts: Mikrotik is not supported directly in KVM, but we have experience in setting it up.  From our "cloud" came bundles to Ryazan, Kazan and Podolsk, where, in fact, stood Mikrotik, who built all the tunnels between the industries. <br><br>  Often, customers have the expectation that the ‚Äúcloud‚Äù itself presupposes DR (because it is located in two data centers).  This is not out of the box, and we must immediately design the infrastructure so that it can move.  We try to help: we estimate the possibility of moving, we give advice.  Mature customers are ready for this, and they immediately rejoice at such opportunities (the benefit of their services are ready for this).  And it is not at all necessary to do this by means of the hypervisor - you can configure replication from within the virtual machine. <br><br>  In fact, we supply the customer with resources of one large ‚Äúcloud‚Äù, where he can choose three different platforms: KVM leverage to accommodate one piece of infrastructure, cloud leverage on VMware (Cisco Powered platform) for another, and MS leverage based on Hyper-V for the third, respectively.  For example, one large jar really wanted to start a test environment with us and cross it with its own iron, where docker was spinning.  The docker in FIG did not drop our webcam, but the developers really liked the cloud API - they have their own custom-made web-environment for all test sites in different data centers.  We hooked our API, then the merger of dockers went fine (thanks to the capabilities and flexibility of KVM, which allows you to tweak a lot).  Another feature: the cloud shoulder on Hyper-V, we specifically designed to protect PD.  This approach imposes a number of restrictions, and not any customer with arbitrary requirements can be ‚Äúlanded‚Äù on the Hyper-V cloud leg. <br><br>  Workstations do not drag as separate machines - often either one image and file shareware is transferred, or the customer installs a Tsitriks farm.  In theory, you can bring your own server with such a farm to the ‚Äúcloud‚Äù, but this feature is rarely needed.  Two buttons - and now you can copy the settings for your piece of iron.  Plus, we can well combine the ‚Äúclouds‚Äù, including the shoulders of various hypervisors inside the data center. <br><br>  Often there are mistakes in performance.  Channel, wheels - could underestimate the requirements for the car.  For example, often on the ‚Äúiron‚Äù crossings, those who are accustomed to working without virtualization, forget that you need to give a few percent of the performance to the work of the hypervisor.  If someone on the servers had graphic cards - we do not have graphic cards in the "cloud".  There was an embarrassment: the customer did not read the spec, and did virtualization for video editing, 32 cores, 200 gigs of operatives.  But we had this machine as a ‚Äúcloud‚Äù server, and it was assumed that it gives the desktop only for consoles (there was a limit of 1.5 FPS for this exchange).  But the storage with a wild performance: you can choose the number of operations for certain needs, payment after the fact. <br><br>  Some more customers do not know about the restrictions in licensing products placed in the "cloud".  For example, Windows virtual machines are licensed exclusively by an IaaS service provider (as the owner of physical servers). <br><br>  Often, when migrating, network errors appear that are many years old.  For example, in one difficult move, it turned out that MSS was incorrectly configured - a crutch remained from 2007, and no one touched him as a result.  The result was that the RDP sessions were torn. <br><br>  There is also a feature of external addressing.  It turns out that machines can enter the Internet through NAT, there is a static translation. <br><br>  One of the customers wanted to have in the "cloud" a subnet of "white" IP addresses from a particular provider.  In order to save money and time, we came up with the following scheme: <br><br><ol><li>  A VPN tunnel was built from the customer‚Äôs router to the ‚Äúcloud‚Äù, but without specifying AS CROC. </li><li>  Since the customer is a provider, he has allocated the necessary white subnet IP addresses. </li><li>  Traffic through VPN came to the equipment of the provider and was transmitted via its own AS via BGP to the Internet. </li></ol><br><img src="https://habrastorage.org/files/009/e05/df6/009e05df6ca143d89237d0d1ddf29e74.png"><br><br>  That is, they simply transmitted their Internet address through their external server, that is, they did not go through the ‚Äúcloud‚Äù output, but through the router at the factory.  They did not bother, because the channel allowed. <br><br>  <b>That's about it.</b>  <b>Read more about the "clouds" here:</b> <br><br><ul><li>  <a href="https://habrahabr.ru/company/croc/blog/277011/">CEPH cluster</a> </li><li>  <a href="http:">The All-Flash Story</a> </li><li>  <a href="https://habrahabr.ru/company/croc/blog/226755/">Hybrid Cloud FAQ</a> </li><li>  <a href="https://habrahabr.ru/company/croc/blog/195288/">Transfer 5 days</a> </li><li>  <a href="https://habrahabr.ru/company/croc/blog/232509/">Migration to Infiniband 56G</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/324654/">https://habr.com/ru/post/324654/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324642/index.html">Error Handling in C</a></li>
<li><a href="../324644/index.html">On technical aspects of external and internal motivation</a></li>
<li><a href="../324646/index.html">Rust, Eclipse and STM32</a></li>
<li><a href="../324648/index.html">How I started programming better</a></li>
<li><a href="../324650/index.html">Count to three: two</a></li>
<li><a href="../324658/index.html">Launching the project Otus.ru</a></li>
<li><a href="../324660/index.html">Manage domain permissions using PowerShell and the ADSI API</a></li>
<li><a href="../324662/index.html">How to independently serve 2500 accounting bases</a></li>
<li><a href="../324664/index.html">10 main difficulties on the way to adaptation DevOps</a></li>
<li><a href="../324666/index.html">How to develop a product, if there is one developer and two customers in a team?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>