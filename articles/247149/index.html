<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a photomosaic using the Wolfram Language (Mathematica)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Download the translation in the form of a Mathematica document that contains all the code used in the article here (archive, ~ 3 MB). 

 Introduction ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a photomosaic using the Wolfram Language (Mathematica)</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/189/51d/dd2/18951ddd2fd149cda60df2a1514207c1.png" width="700"></div><br>  <i>Download the translation in the form of a Mathematica document that contains all the code used in the article <a href="http://goo.gl/Ow8y8G">here</a> (archive, ~ 3 MB).</i> <br><br><h3>  Introduction </h3><br>  Until New Year 2015, there are already less than a day: <br><br>  <b>In [1]: =</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/3f7/766/102/3f7766102f6f585aa9bda0bfab6ab30d.png" alt="ImageMosaic_2.png" width="655" height="18"><br><br>  <b>Out [1] =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a0/70f/d5a/7a070fd5ad0c661fa0a797ca0da65e44.png" alt="ImageMosaic_3.png" width="81" height="21"><br><br>  I would like to congratulate everyone on the Coming New Year 2015 and tell you how you can give your loved ones an unusual gift in the form of photo mosaic created using the <i>Mathematica</i> 10 system and the Wolfram Language. <br><br>  The idea of ‚Äã‚Äãphoto mosaic as a whole is quite simple: <i>create an image based on a collection of other small-sized images</i> . <br><br>  In order to create a photo mosaic you can act in two main ways: <br><br><ul><li>  <b>A simple way</b> : split the image into fragments of a fixed size, then pick up each fragment with the most ‚Äúsimilar‚Äù image from a given collection and replace this fragment with it.  As a result, the smaller the fragment size and the larger the collection, the better the photo mosaic will be. </li></ul><br><ul><li>  <b>Complicated method</b> : essentially repeats the first method, except that the source image is split by some ‚Äúadaptive‚Äù algorithm into fragments of various sizes. </li></ul><br>  To simplify the problem under consideration, we will create a mosaic of square thumbnails. <br><a name="habracut"></a><br><h3>  Creating a collection of images </h3><br>  Of course, you can use any collection of images that you have, be it family photos or travel photos. <br><br>  I do not think that my collections of this kind will be very interesting to most readers, so I will use a collection of images of a famous person as a collection.  As such a person, I will take someone who is known to absolutely everyone, namely, Arnold Schwarzenegger. <br><br>  To create a collection of images, use the parser from the <a href="http://www.zimbio.com/">Zimbio</a> website: <br><br>  <b>In [2]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/42c/811/050/42c811050d96dc502dd1da4b6be91a41.png" alt="ImageMosaic_4.png" width="180" height="18"><br><br>  <b>In [3]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e58/283/130/e58283130a368c0d3cebbad13e184a6e.png" alt="ImageMosaic_5.png" width="702" height="502"><br><br>  We import all available photos from Arnold's profile: <br><br>  <b>In [4]: ‚Äã‚Äã=</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dbe/3b3/b2b/dbe3b3b2b103e1e61908894f4683dd38.png" alt="ImageMosaic_6.png" width="637" height="88"><br><br>  In total, 5436 photos were imported: <br><br>  <b>In [5]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0f7/74f/a49/0f774fa495a924255a11e085c5cb9b49.png" alt="ImageMosaic_7.png" width="527" height="42"><br><br>  <b>Out [5] =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e8d/2a6/7da/e8d2a67da910082a8789c602fb9f680b.png" alt="ImageMosaic_8.png" width="38" height="21"><br><br>  The total ‚Äúweight‚Äù of which is almost 5 GB. <br><br>  <b>In [6]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/29e/cf9/75f/29ecf975faa9a34da7c87dc176bc6b10.png" alt="ImageMosaic_9.png" width="731" height="134"><br><br>  <b>Out [6] =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/731/83e/dae/73183edaec3652b0d318ca972437d73c.png" alt="ImageMosaic_10.png" width="91" height="21"><br><br>  We can look at the collection briefly, making a collage of 150 randomly selected images: <br><br>  <b>In [7]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c6a/1ed/83a/c6a1ed83a8086cfbac86277f44d08b23.png" alt="ImageMosaic_11.png" width="614" height="88"><br><br>  <b>Out [7] =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/992/bf4/75e/992bf475eeab61df8afbc2ccc9f1c946.png" alt="ImageMosaic_12.png" width="700" height="700"><br><br><h3>  Simple photo mosaic </h3><br>  Let's start creating a simple photo mosaic. <br><br>  To begin with, we indicate the directory in which the collection of our images is stored: <br><br>  <b>In [8]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/58d/76b/68b/58d76b68b155222ade9bc32f6b0127d8.png" alt="ImageMosaic_13.png" width="527" height="42"><br><br>  Now we will load the paths to each of the images: <br><br>  <b>In [9]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a8/c82/23d/5a8c8223db23566d56c0ccbd47e36f57.png" alt="ImageMosaic_14.png" width="486" height="65"><br><br>  <b>Out [9] // Short =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/81b/117/54a/81b11754adbbea7dd8eb9155fd9d841e.png" alt="ImageMosaic_15.png" width="601" height="213"><br><br>  Save the number of images in a separate variable: <br><br>  <b>In [10]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ad/5c0/a1f/7ad5c0a1f57747e56f768ae1460834ed.png" alt="ImageMosaic_16.png" width="500" height="18"><br><br>  <b>Out [10] =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/484/4a9/6ab/4844a96aba48ca7d03f6eae045750e6b.png" alt="ImageMosaic_17.png" width="38" height="21"><br><br>  Now we will create a collection of thumbnail images, since, obviously, we will not need images in their original size.  The size of each thumbnail does not exceed 150x150 pixels (by default). <br><br>  <b>In [11]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/23c/bf6/63f/23cbf663f2398fdea5997c44863014bc.gif" alt="ImageMosaic_18.gif" width="577" height="111"><br><br>  <b>In [13]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/96b/e16/b04/96be16b044b66e02cee78e699569d68c.png" alt="ImageMosaic_19.png" width="596" height="134"><br><br>  <b>In [14]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d8f/815/9c4/d8f8159c4ce0fc75841a7378cdfa08b0.png" alt="ImageMosaic_20.png" width="445" height="18"><br><br>  Load the paths to each of the thumbnails: <br><br>  <b>In [15]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ecc/7ef/560/ecc7ef56069874e5912a4f132364b4a5.png" alt="ImageMosaic_21.png" width="558" height="42"><br><br>  Now upload all the thumbnails to the system: <br><br>  <b>In [16]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e2/7cb/8d3/1e27cb8d3b973cb9f26b2313884cc59c.png" alt="ImageMosaic_22.png" width="685" height="42"><br><br>  Calculate for each of the thumbnails its average RGB color: <br><br>  <b>In [17]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9d6/670/169/9d6670169d8287c72bcec7672aca46cc.png" alt="ImageMosaic_23.png" width="673" height="65"><br><br>  Let's create a function that will select the miniature closest to it for some image.  At the same time, we will provide for the possibility of randomly selecting from the n nearest miniatures (this will be necessary in order for the photo mosaic to lack areas filled with one miniature, which occurs, say, if a large section of the image has one color). <br><br>  <b>In [18]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b9/23f/9bf/6b923f9bfdbf3003d3c7a081b35bea5e.gif" alt="ImageMosaic_24.gif" width="702" height="157"><br><br>  <b>Out [18] =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/86a/e07/d58/86ae07d58691c6e3146cfb785ca5f6e7.png" alt="ImageMosaic_25.png" width="335" height="55"><br><br>  Create a function that makes photomosaic: <br><br>  <b>In [20]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1bc/f71/057/1bcf71057850fc3c7eeef2fa13b97c3d.png" alt="ImageMosaic_26.png" width="730" height="410"><br><br>  Let's set the image, the mosaic of which we want to get: <br><br>  <b>In [21]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b31/bff/24f/b31bff24f91dd49da5464c1bdb408a70.png" alt="ImageMosaic_27.png" width="351" height="140"><br><br>  Let's see what the mosaic will look like if the nearest miniature is taken when the thumbnails are gradually reduced: <br><br>  <b>In [22]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/784/c57/7f1/784c577f1862907903951ee231be0968.png" alt="ImageMosaic_28.png" width="607" height="88"><br><br>  <b>Out [22] =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0b0/2a4/193/0b02a4193fbdfe5b8630c543871a722e.png" alt="ImageMosaic_29.png" width="707" height="2403"><br><br>  On the last photo mosaic, the effect that was mentioned earlier is most noticeable - areas filled with one miniature in areas of an image with one (or very close) color. <br><br>  In order to get rid of this, let's set a random selection of the 10 nearest thumbnails: <br><br>  <b>In [23]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/570/37b/8f1/57037b8f182d44fd209f6bff5fc9f741.png" alt="ImageMosaic_30.png" width="617" height="88"><br><br>  <b>Out [23] =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/777/02d/257/77702d257f31e1841905f10cf8f6933b.png" alt="ImageMosaic_31.png" width="707" height="2403"><br><br>  Of course, using this algorithm, you can create any mosaic of this kind: <br><br>  <b>In [24]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d5/ae0/a79/7d5ae0a79498bb61c7a1ec36dcb2a051.png" alt="ImageMosaic_32.png" width="361" height="110"><br><br>  <b>Out [24] =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/533/e38/ea0/533e38ea064345333e227f74baba1ff0.png" alt="ImageMosaic_33.png" width="700" height="1045"><br><br><h3>  Adaptive photo mosaic </h3><br>  Create a function that will split the image into smaller images in an adaptive way. <br><br>  The <b>adaptiveImagePartition</b> function works as follows: <br><br><ul><li>  it is an iterative adaptive partition using the steps below; </li><li>  the <b>toParts</b> function calls the <b>parts</b> function applied to each image (or the original image in the first step); </li><li>  the <b>parts</b> function splits the image into 4 equal parts (straight lines drawn through the middle of the opposite sides of the image) and returns the result of the <b>toParts</b> function; </li><li>  for each of the four obtained fragments, its average color is calculated, then pairwise distances between average colors are searched for using the <a href="http://reference.wolfram.com/language/ref/ColorDistance.html">ColorDistance</a> function (according to the <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BE%25D1%2580%25D0%25BC%25D1%2583%25D0%25BB%25D0%25B0_%25D1%2586%25D0%25B2%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B3%25D0%25BE_%25D0%25BE%25D1%2582%25D0%25BB%25D0%25B8%25D1%2587%25D0%25B8%25D1%258F">CIE2000</a> standard), then the average value of the distance is searched.  If it is more than the <b>prec</b> value, then the original image is replaced with four new ones, otherwise the image is left as it was; </li><li>  The rule processing <b>rule</b> is applied to the resulting image set. </li></ul><br>  <b>In [25]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0a7/078/4f2/0a70784f280cc59d5d36039b47de6beb.png" alt="ImageMosaic_34.png" width="721" height="295"><br><br>  <b>In [26]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/aa9/d6e/a7c/aa9d6ea7c05b4e63f93f72a32d0ee1ca.png" alt="ImageMosaic_35.png" width="626" height="180"><br><br>  <b>In [27]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bc6/753/d60/bc6753d60a0acd25c61156c9f07fb65b.png" alt="ImageMosaic_36.png" width="723" height="433"><br><br>  Set the base image: <br><br>  <b>In [28]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/72d/3db/922/72d3db922eb999ef09f1d8b2c4a91186.png" alt="ImageMosaic_37.png" width="384" height="110"><br><br>  Let's look at the steps of the created function: <br><br>  <b>In [29]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bc5/d02/cee/bc5d02cee47785d8ff9a1115aff7fa67.png" alt="ImageMosaic_38.png" width="566" height="157"><br><br>  <b>Out [29] =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dec/f9c/c14/decf9cc145e7e9c70653efcf811cddc7.png" alt="ImageMosaic_39.png" width="531" height="4488"><br><br>  By changing the handler, we can get adaptive pixelation: <br><br>  <b>In [30]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b0c/0a7/36e/b0c0a736ed0b93adb58b31976939b6cf.png" alt="ImageMosaic_40.png" width="694" height="226"><br><br>  <b>Out [30] =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b9b/709/576/b9b709576ea8514104d9224199fe85f8.png" alt="ImageMosaic_41.png" width="531" height="4488"><br><br>  Finally, if, as a handler, specify the replacement of a fragment of the image with the nearest thumbnail, we get: <br><br>  <b>In [31]: =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/29d/12a/b75/29d12ab75b412bf0dd2398d52e09ebdb.png" alt="ImageMosaic_42.png" width="732" height="249"><br><br>  <b>Out [31] =</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/19e/aca/9cf/19eaca9cfbd9cbf137444d81510a049c.png" alt="ImageMosaic_43.png" width="512" height="513"><br><br><h3>  Conclusion </h3><br>  I hope that my post could please you and interest.  Of course, you can create even more complex algorithms for photo mosaics that take into account: not only the average color, but also the dominant colors of fragments and miniatures ( <a href="http://reference.wolfram.com/language/ref/DominantColors.html">DominantColors</a> );  image morphology;  more complex adaptive partitioning, etc. But, I think, the created algorithms may already be quite enough to make an original gift yours close to the Coming New Year 2015. <br><br>  Resources for learning Wolfram Language ( <i>Mathematica</i> ) in Russian: <a href="http://habrahabr.ru/post/244451">http://habrahabr.ru/post/244451</a> </div><p>Source: <a href="https://habr.com/ru/post/247149/">https://habr.com/ru/post/247149/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../247131/index.html">What you need * (in difficult 2015)</a></li>
<li><a href="../247135/index.html">Risen from the dead (review of target installations umus-127)</a></li>
<li><a href="../247139/index.html">Requests to Yandex live</a></li>
<li><a href="../247145/index.html">PHP 7 will get twice as efficient Hashtable</a></li>
<li><a href="../247147/index.html">Cloud IDE for web programmers</a></li>
<li><a href="../247153/index.html">IBM is working with Nvidia to create new generation supercomputers</a></li>
<li><a href="../247155/index.html">On the threshold of a new reality</a></li>
<li><a href="../247159/index.html">Review of the best posts for the year</a></li>
<li><a href="../247161/index.html">Fucky new year!</a></li>
<li><a href="../247163/index.html">Read data with Arduino and Processing. Processing with R</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>