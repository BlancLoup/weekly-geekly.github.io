<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Configuring VM Instance Google Cloud for machine learning tasks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Solving heavy machine learning problems on stationary computers is a thankless and unpleasant task. Imagine that you are making an ensemble of N neura...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Configuring VM Instance Google Cloud for machine learning tasks</h1><div class="post__text post__text-html js-mediator-article"><p>  Solving heavy machine learning problems on stationary computers is a thankless and unpleasant task.  Imagine that you are making an ensemble of N neural networks on a home laptop to <a href="https://www.kaggle.com/c/planet-understanding-the-amazon-from-space">study the Amazon forests</a> on a laptop.  Dubious pleasure, especially since now there is an excellent choice of cloud services for this purpose - Amazon Web Services, Google Cloud Platform, Microsoft Azure and others.  Some are even relatively free and provide video cards. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/761/60a/3d8/76160a3d8397777bb8ca05cc5f21a893.png" alt="image"></p><br><p>  We will configure the VM on the Google Cloud Platform from scratch.  Bonus - starting $ 300 for a year on one gmail account.  Go. </p><br><ol><li>  Creating and configuring Virtual Machine Instances </li><li>  Configure network settings </li><li>  Installing Anaconda and Optional Packages </li><li>  Jupyter Notebook Setup </li><li>  Setting File Transfer <a name="habracut"></a></li></ol><br><h2 id="1-sozdanie-i-nastroyka-virtual-machine-instances">  1. Creating and Configuring Virtual Machine Instances </h2><br><h3 id="sozdaem-akkaunt">  Create an account </h3><br><p>  From the first steps, it may be misleading that Google categorically categorizes you as a legal entity without the right to change status.  This is the norm for quite some time now and we will have to accept this.  Next, we fearlessly indicate the payment details, money without warning will not be withdrawn, even when the free limit is reached. </p><br><h3 id="sozdaem-virtual-machine-i-podbiraem-parametry">  Create a Virtual Machine and select parameters </h3><br><p>  Here are some interesting points.  Graphic processors are not in all zones.  I did not find it in European and West Asian countries, I didn‚Äôt search in South American, so I chose the East American zone.  There you can even set up eight with a subscription fee of $ 5,000 per hour.  We average the data and set up eight processors, twenty gigabytes of RAM and one graphics processor.  All this pleasure will cost $ 1 per hour. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f3a/158/217/f3a158217f46be1fb6c4828ac05ece6b.png" alt="image"></p><br><p>  The operating system can be chosen for every taste.  Take the Linux distribution you like and set the checkboxes "allow traffic".  Network configuration and SSH skip.  We will configure them further.  And finally, one important point, uncheck the <em>delete boot disk when instance is deleted</em> .  This will save your nerves when you start creating images for different tasks. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/66d/f3e/1b9/66df3e1b9b878e326a79bf2d93a5bd4e.png" alt="image"></p><br><h2 id="2-nastroyka-setevyh-parametrov">  2. Configure network settings </h2><br><h3 id="nastroyka-staticheskogo-ip">  Static IP Configuration </h3><br><p>  The default external ip is dynamic.  Let's make it static and live immediately becomes much easier.  When linked to a project or a virtual machine (just our case), it's free. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3af/9e8/1ab/3af9e81ab65c488b6b941a3ed390c724.png" alt="image"></p><br><h3 id="nastroyka-brandmauera">  Firewall configuration. </h3><br><p>  Jupyter Notebook is our main tool and it will need access to the virtual machine.  Create a rule with the following parameters: </p><br><ul><li>  Allow incoming traffic </li><li>  We indicate any port within reasonable limits.  For example, the 22nd will not work, SSH hangs on it. </li><li>  The address range is the default 0.0.0.0/0 (can be changed) </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/956/585/c2f/956585c2fb2600fa100e0e4bb90b18a7.png" alt="image"></p><br><p>  We have created a clean VM and you should end up with something like this: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3ed/c65/db6/3edc65db6cfbeb6a27c9722e0d88aa1f.png" alt="image"></p><br><p>  And most importantly - do not forget to turn off the VM when finished work! </p><br><h2 id="3-ustanovka-anaconda-i-dopolnitelnyh-paketov">  3. Installing Anaconda and Optional Packages </h2><br><p>  Run the created Instance, connect via SSH and to install the Anaconda distribution we enter on the command line: </p><br><pre><code class="bash hljs">wget http://repo.continuum.io/archive/Anaconda3-5.0.1-Linux-x86_64.sh bash Anaconda3-5.0.1-Linux-x86_64.sh</code> </pre> <br><p>  At the end of the installation, do not forget to enter "yes" to set the PATH variable. <br>  Put your favorite packages: </p><br><pre> <code class="bash hljs">conda install seaborn conda install keras conda install tensorflow</code> </pre> <br><p>  And move on to setting up Jupyter Notebook. </p><br><h2 id="4-nastroyka-jupyter-notebook">  4. Configure Jupyter Notebook </h2><br><p>  Enter into the command line (port - which you specified in the firewall settings): </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> c.NotebookApp.ip = <span class="hljs-string"><span class="hljs-string">'*'</span></span> &gt; ~/.jupyter/jupyter_notebook_config.py <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> c.NotebookApp.open_browser = False&gt; ~/.jupyter/jupyter_notebook_config.py <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> c.NotebookApp.port = 8888 &gt; ~/.jupyter/jupyter_notebook_config.py</code> </pre> <br><p>  Checking: </p><br><pre> <code class="bash hljs">tail -n 10 ~/.jupyter/jupyter_notebook_config.py</code> </pre> <br><p>  Run: </p><br><pre> <code class="bash hljs">jupyter notebook --ip=0.0.0.0 --port=8888 --no-browser &amp;</code> </pre> <br><p>  And now one interesting point.  If everything went well with you, after starting Jupiter Server in the bash you will see something like this: </p><br><pre> <code class="bash hljs">Copy/paste this URL into your browser when you connect <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the first time, to login with a token: http://localhost:8888/?token=[  id ]</code> </pre> <br><p>  If you click on the link, the authorization error will fall out in the browser, which is quite obvious.  To do this, you must explicitly specify the external static IP created above in the browser line: </p><br><blockquote>  http: // &lt;your IP&gt;: 8888 /? token = [here will be the token id] </blockquote><p>  Welcome aboard! </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/714/155/a68/714155a6841950d9f52237cf321b269d.png" alt="image"></p><br><p>  Now we just need to configure File Transfer between our local system and the remote one.  Without this, the Amazon forest does not explore. </p><br><h2 id="5-nastroyka-file-transfer">  5. Setting File Transfer </h2><br><p>  We have a Linux boot disk and therefore four methods are available: </p><br><ol><li>  Using the gcloud command line (private SSH keys required) </li><li>  Via SFTP in the browser.  This is the easiest way, not requiring an SSH key and using a native browser.  Prerequisite - the local system you have Linux or Mac. </li><li>  Using the SDC command line (private SSH keys required) </li><li>  WinSCP program for happy owners of Windows (private SSH keys required) </li></ol><br><p>  You can <a href="https://cloud.google.com/compute/docs/instances/transfer-files">read in</a> detail <a href="https://cloud.google.com/compute/docs/instances/transfer-files">here</a> and choose the way you like.  I have Windows 10 on my laptop, so the choice is not rich.  Let's go not the easiest way and consider in detail the fourth method. </p><br><p>  First you need to generate SSH keys.  Download the distribution <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">PuTTY</a> and install.  With it, we will generate keys. </p><br><ol><li>  Open puttygen.exe.  A window will appear where you can generate keys. </li><li>  We leave all the default parameters except the key comment field.  Enter the username of the remote system into it.  Most likely this is your gmail account.  It is important - not all mail, but only the part that is up to the @ sign.  I first read the instructions diagonally and eventually killed half an hour to understand why WinSCP returned an error. </li><li>  Save the private key - it is used locally in WinSCP. </li><li>  Copy the private key text field (make sure to copy all the text completely! In the screenshot, only a part of it) </li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/639/8af/2a4/6398af2a4a9b6b3968fc24d961450b3d.png" alt="image"></p><br><ol><li>  We go to the Google clouds and there in the "Metadata -&gt; SSH-keys" add the copied key. </li></ol><br><p>  Details on <a href="">Google Offsite</a> </p><br><p>  Very little is left; the most pleasant part is to configure the WinSCP file manager. </p><br><ol><li>  Download it <a href="https://winscp.net/eng/docs/guide_install">here.</a> </li><li>  Configure the configuration.  Remember that IP is our static IP of the remote system.  Username - similar to PuTTY. </li></ol><br><p><img src="https://habrastorage.org/getpro/habr/post_images/530/d15/8ee/530d158eee5492605979af19f1c0323f.png" alt="image"></p><br><p>  In the additional settings, we specify the private key and set the checkboxes as in the screenshot. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b6c/8e9/608/b6c8e960863d57cdeddc4350d8da8aff.png" alt="image"></p><br><p>  Everything!  Our combat system is ready to digest heavy convolutional neural networks and bulk data. </p><br><p>  Additionally, I want to note that the use of one Instance is not very reasonable economically.  Different tasks require different resources.  You can create twelve virtualok with different settings for processors, memory and graphics, or work with images.  Experiment and love the data. </p><br><p>  Useful links: </p><br><ol><li>  <a href="https://cloud.google.com/compute/">Compute Engine Features</a> </li><li>  <a href="https://cloud.google.com/compute/docs/instances/transfer-files">Transferring Files to Instances</a> </li><li>  <a href="https://cloud.google.com/compute/docs/instances/adding-removing-ssh-keys">Managing Instance Access with SSH Keys</a> </li></ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/341446/">https://habr.com/ru/post/341446/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341432/index.html">Widget Ideas for Online Surfing</a></li>
<li><a href="../341436/index.html">Ecosystem blockchain projects</a></li>
<li><a href="../341440/index.html">Roskomnadzor and all-all-all</a></li>
<li><a href="../341442/index.html">Cockroaches and Keys: What can break in modern trading scales</a></li>
<li><a href="../341444/index.html">Sberbank: damage from cyber attacks will rise to 1.5 trillion rubles in two years</a></li>
<li><a href="../341448/index.html">Highload fwdays conference review</a></li>
<li><a href="../341452/index.html">Libraries in 2027</a></li>
<li><a href="../341454/index.html">Welcome to the YAPC :: Russia conference on November 4</a></li>
<li><a href="../341456/index.html">Bitcoin hardware wallets</a></li>
<li><a href="../341458/index.html">GitLab 10.1 released: commenting on images and blocking unsigned commits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>