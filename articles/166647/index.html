<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Adding your functionality to UMI.CMS using event handlers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the site management system UMI.CMS, the division into the main engine of the site, which is not touched by the web developer (and which is overwrit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Adding your functionality to UMI.CMS using event handlers</h1><div class="post__text post__text-html js-mediator-article">  In the site management system UMI.CMS, the division into the main engine of the site, which is not touched by the web developer (and which is overwritten when the system is updated), and the additional (custom) functionality, which the site developer already adapts for himself: the design templates, macros (PHP functions called from templates), own modules, if necessary. <br><br>  However, when developing your site, there are situations when it is necessary to change the existing functionality of the site: <br><ul><li>  add your own logic to import data from XML; </li><li>  perform some actions when importing data; </li><li>  perform some actions when creating or changing an order; </li><li>  perform some actions on a schedule; </li><li>  ‚Ä¶ and so on. </li></ul><br>  In this case, you have to either edit the system code of the engine (which immediately adds problems when updating the CMS), or use the built-in event functionality.  In the <a href="http://api.docs.umi-cms.ru/razrabotka_nestandartnogo_funkcionala/sobytijnaya_model_umicms/naznachenie_obrabotchika_sobytiya/">documentation</a> or <a href="http://umi-cms.spb.su/api/events/216/">on third-party resources,</a> this issue is considered, however, in my opinion, not sufficiently detailed.  This article is an attempt to put together information about working with events in UMI.CMS, as well as to show, using an example, how the system can be extended with the help of event processing. <br><a name="habracut"></a><br>  According to the documentation in UMI.CMS, there are two types of event handlers: <br><ul><li>  <b>system</b> - these are pre-installed handlers, which are written when developing a module.  These handlers are written in the events.php file, which lies in the module directory.  For the modules included in the UMI.CMS distribution, this file cannot be changed. <br></li><li>  <b>custom</b> - these handlers must be in the custom_events.php file in the module directory. <br></li></ul><br>  When an event occurs, all handlers assigned to it (both system and user) are called.  In addition (this is not written in the documentation), system event handlers are executed <b>after the</b> user.  This must be considered when developing its functionality. <br><br>  Events can be triggered before the object changes (so-called <i>before</i> mode) and after the object changes ( <i>after</i> mode).  Not all events can be ‚Äúbefore‚Äù and ‚Äúafter‚Äù, which ones, you should look at the link below. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A list of internal events can be found in the <a href="http://api.docs.umi-cms.ru/razrabotka_nestandartnogo_funkcionala/sobytijnaya_model_umicms/standartnye_tochki_vyzova/">documentation</a> .  It must be remembered that when handling the same object in different places, different event handlers will be called.  This causes certain inconveniences: <br><br>  Suppose, for example, we are developing an online store based on UMI, and we need to perform some actions when changing the status of an order (for example, send additional emails, set some other fields in the order, etc., depending on the status).  We look where we can "catch" events of change of the status of the order: <br><ul><li>  status change when a user creates a site <b>order</b> - the <b>order-status-changed</b> event of the Emarket module; <br></li><li>  status change from admin page on order details page - system event <b>systemModifyObject</b> ; <br></li><li>  status change from admin page on the list of all orders - system event <b>systemModifyPropertyValue</b> ; <br></li><li>  status change when importing it via XML (for example, when unloading from 1C) - the <b>exchangeOnUpdateObject</b> event. <br></li></ul><br>  Thus, in order to take into account all the places where the order status changes, you will have to write 4 handlers. <br><br>  Let us dwell on the <b>systemModifyPropertyValue</b> system event.  I did not find any mention of him in the documentation, I saw his call only when analyzing the system code, and it‚Äôs quite difficult to manage without him in the described situation, since the site administrator (manager) can change the order data in two ways: <br><ul><li>  on the main page of the Online Store module in the list of all orders - UMI allows editing status and other order data directly in this list; <br></li><li>  in the window of detailed information about the order, which opens after clicking on the order. <br></li></ul><br>  And if you use only the <b>systemModifyObject</b> event <b>handler</b> , you will have to explain to all future administrators of the site that they should in no case change the order data from the list of orders, but just have to go into each order and change something there.  Which, of course, is very inconvenient and leaves a great opportunity to make a mistake. <br><br>  The <b>systemModifyPropertyValue</b> system event has the following parameters: <br><ul><li>  <i>entity</i> - reference to the object whose property is being changed; <br></li><li>  <i>property</i> - the name of the <i>property being</i> changed; <br></li><li>  <i>oldValue</i> - old property value; <br></li><li>  <i>newValue</i> is the new value of the property; <br></li></ul><br>  This event handler can be used not only when editing the list of orders in the Online Store module, but also in other similar lists of objects in the UMI.CMS admin panel. <br><br>  How an event handler is assigned can be viewed, for example, <a href="http://api.docs.umi-cms.ru/razrabotka_nestandartnogo_funkcionala/sobytijnaya_model_umicms/naznachenie_obrabotchika_sobytiya/">here</a> or <a href="http://wiki.umisoft.ru/%25D0%2598%25D0%25B7%25D0%25BC%25D0%25B5%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25BF%25D0%25B0%25D1%2580%25D0%25B0%25D0%25BC%25D0%25B5%25D1%2582%25D1%2580%25D0%25B0_name_%25D0%25BF%25D1%2580%25D0%25B8_%25D0%25B8%25D0%25BC%25D0%25BF%25D0%25BE%25D1%2580%25D1%2582%25D0%25B5">here</a> .  I want to show a more complicated example: how to add the missing functionality to the UMI using the creation of a data import event handler ‚Äî to teach the system to import optional product properties. <br><br>  Let, for example, we develop an online store selling t-shirts.  We have established 1C "Trade Management", in which we are going to keep records of goods and orders.  In 1C, all the necessary range of products has been entered and it is desirable that it be downloaded to the site with minimal actions. <br><br>  The specificity of the sale of such goods is such that we have, for example, the Dolce T-shirt model, which has specific units sold: <br><ul><li>  Dolce White T-shirt, 40 size; <br></li><li>  Dolce White T-shirt, 48 size; <br></li><li>  T-shirt Dolce Red, 44 size; <br></li><li>  ‚Ä¶ and so on. <br></li></ul><br>  That is, the set of positions of this model, differing in color and size (and possibly price, for certain combinations).  In terms of 1C, these are ‚Äúcharacteristics of the nomenclature‚Äù.  And from the point of view of the online store, we want us to have one page of the ‚ÄúDolce T-shirt‚Äù model, on which the buyer could choose his color and size and create an order with them. <br><br>  From the point of view of 1C, everything seems simple.  We put a tick "characteristics" in the settings of the nomenclature.  We first upload the goods to the disk, look at the resulting XML file (offers.xml), we need these offers, rejoice and upload to the site.  And here we understand that we rejoiced early.  The goods themselves were added, but their characteristics (that a particular T-shirt has a dozen sentences with different combinations of colors and sizes) are not. <br><br>  In the UMI system, the functionality we need is implemented using <a href="http://help.docs.umi-cms.ru/rabota_s_modulyami/modul_katalog/redaktirovanie_obekta_kataloga/">optional properties</a> .  That is, at first glance, everything is there.  However, after further digging in the source code and documentation, it turns out that in the current version of UMI (2.8.6) the Data Exchange module does not support the import of optional properties.  So we will add the necessary functionality independently. <br><br>  The specifics of importing from 1C to UMI are described in the <a href="http://wiki.umisoft.ru/%25D0%25A2%25D0%25B5%25D1%2585%25D0%25BD%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D1%2581%25D1%2582%25D0%25BE%25D1%2580%25D0%25BE%25D0%25BD%25D0%25B0_%25D0%25B8%25D0%25BC%25D0%25BF%25D0%25BE%25D1%2580%25D1%2582%25D0%25B0_%25D0%25B4%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D1%2585_%25D0%25B8%25D0%25B7_1%25D0%25A1">documentation</a> .  To add your functionality when importing data, you must modify the import template /xsl/import/custom/commerceML2.xsl, and add your own import event handler. <br><br>  Modify the import template: <br><div class="spoiler">  <b class="spoiler_title">Import template</b> <div class="spoiler_text"><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">match</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!--        --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"charateristics-kinds"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'   ""'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">parent-id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"root-guides-type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">guide</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"guide"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">base</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldgroups</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"charateristics_kinds"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1c_id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"  1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">visible</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"visible"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"color"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">field-type-id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">visible</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"visible"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"required"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"size"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">field-type-id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">visible</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"visible"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">required</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"required"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"3"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldgroups</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"shirts"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'1C: '</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">parent-id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"root-catalog-object-type"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">base</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">module</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"catalog"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"object"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">base</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldgroups</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"optioned_properties"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"charateristics"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">visible</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"visible"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">guide-id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"charakteristics-kinds"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data-type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"optioned"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multiple</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"multiple"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">field</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldgroups</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--     - ,         --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">match</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">page</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">parentId</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{$group_id}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type-id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"shirts"</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">page</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">match</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source-name</span></span></span><span class="hljs-tag">&gt;</span></span>commerceML2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">objects</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:apply-templates</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"objects"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">objects</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pages</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:apply-templates</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"items"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pages</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">match</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"objects"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">object</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{substring-after(,'#')}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type-id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"charakteristics-kinds"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"charateristics_kinds"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1c_id"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">is-public</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">visible</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"visible"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>  1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:value-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:apply-templates</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/[ = '']"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"color"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:apply-templates</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/[ = '']"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"size"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">object</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">match</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"color"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"color"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">is-public</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">visible</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"visible"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:value-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:value-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">match</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"size"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"size"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">is-public</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">visible</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"visible"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:value-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:value-of</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">select</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  ,     --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">match</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"items"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">page</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{substring-before(,'#')}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">update-only</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"optioned_properties"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"charateristics"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"optioned"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">is-public</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">visible</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"visible"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">int</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">float</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{//}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">object</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{substring-after(,'#')}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type-id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"charakteristics-kinds"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">option</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">value</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">group</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">page</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xsl:template</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br>  Using this template, a separate directory is created (Reference book for the "Characteristics" field), in which all received characteristics options from 1C are written.  In addition, the type for the catalog object (product) is modified to add optional properties there.  Thus, we have already uploaded the characteristics to the site, it remains only to write a code that would match the characteristics of the product. <br><br>  Add your event handler.  To do this, create a custom_events.php file in the / classes / modules / exchange folder with the code <br><pre> <code class="hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">new</span></span></span><span class="php"> umiEventListener(</span><span class="hljs-string"><span class="php"><span class="hljs-string">"exchangeOnUpdateElement"</span></span></span><span class="php">, </span><span class="hljs-string"><span class="php"><span class="hljs-string">"exchange"</span></span></span><span class="php">, </span><span class="hljs-string"><span class="php"><span class="hljs-string">"onImportElement"</span></span></span><span class="php">); </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">new</span></span></span><span class="php"> umiEventListener(</span><span class="hljs-string"><span class="php"><span class="hljs-string">"exchangeOnAddElement"</span></span></span><span class="php">, </span><span class="hljs-string"><span class="php"><span class="hljs-string">"exchange"</span></span></span><span class="php">, </span><span class="hljs-string"><span class="php"><span class="hljs-string">"onImportElement"</span></span></span><span class="php">); </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br>  Thus, we specified that both when creating and updating an item (product page) during import, the onImportElement method will be called.  Let's write the code of this method in the __custom.php file: <br><div class="spoiler">  <b class="spoiler_title">Event handler code</b> <div class="spoiler_text"><pre> <code class="hljs bash"> /** *       1 * @param e -     */ public <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> onImportElement(<span class="hljs-variable"><span class="hljs-variable">$e</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-variable"><span class="hljs-variable">$e</span></span>-&gt;getMode() == <span class="hljs-string"><span class="hljs-string">"after"</span></span>) { //   <span class="hljs-variable"><span class="hljs-variable">$this</span></span>-&gt;addOptionedProperties(<span class="hljs-variable"><span class="hljs-variable">$e</span></span>); } } /** *      .      *  UMI * @param e -     */ <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> addOptionedProperties(<span class="hljs-variable"><span class="hljs-variable">$e</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$hierarchy</span></span> = umiHierarchy::getInstance(); <span class="hljs-variable"><span class="hljs-variable">$element</span></span> = <span class="hljs-variable"><span class="hljs-variable">$e</span></span>-&gt;getRef(<span class="hljs-string"><span class="hljs-string">'element'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-variable"><span class="hljs-variable">$element</span></span> instanceof umiHierarchyElement || <span class="hljs-variable"><span class="hljs-variable">$element</span></span>-&gt;getMethod() != <span class="hljs-string"><span class="hljs-string">'object'</span></span>) { //    <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-variable"><span class="hljs-variable">$object_id</span></span> = <span class="hljs-variable"><span class="hljs-variable">$element</span></span>-&gt;objectId; //XML DOM node     <span class="hljs-variable"><span class="hljs-variable">$element_info</span></span> = <span class="hljs-variable"><span class="hljs-variable">$e</span></span>-&gt;getParam(<span class="hljs-string"><span class="hljs-string">'element_info'</span></span>); <span class="hljs-variable"><span class="hljs-variable">$properties</span></span> = <span class="hljs-variable"><span class="hljs-variable">$element_info</span></span>-&gt;getElementsByTagName(<span class="hljs-string"><span class="hljs-string">'property'</span></span>); <span class="hljs-variable"><span class="hljs-variable">$propertiesSize</span></span> = <span class="hljs-variable"><span class="hljs-variable">$properties</span></span>-&gt;length; <span class="hljs-variable"><span class="hljs-variable">$types</span></span> = umiObjectTypesCollection::getInstance(); //     XML foreach(<span class="hljs-variable"><span class="hljs-variable">$properties</span></span> as <span class="hljs-variable"><span class="hljs-variable">$key</span></span> =&gt; <span class="hljs-variable"><span class="hljs-variable">$info</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$old_name</span></span> = <span class="hljs-variable"><span class="hljs-variable">$info</span></span>-&gt;getAttribute(<span class="hljs-string"><span class="hljs-string">'name'</span></span>); //    <span class="hljs-variable"><span class="hljs-variable">$name</span></span> = self::translateName(<span class="hljs-variable"><span class="hljs-variable">$old_name</span></span>); <span class="hljs-variable"><span class="hljs-variable">$nl</span></span> = <span class="hljs-variable"><span class="hljs-variable">$info</span></span>-&gt;getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"value"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-variable"><span class="hljs-variable">$nl</span></span>-&gt;length) { //     XML <span class="hljs-built_in"><span class="hljs-built_in">continue</span></span>; } <span class="hljs-variable"><span class="hljs-variable">$value_node</span></span> = <span class="hljs-variable"><span class="hljs-variable">$nl</span></span>-&gt;item(0); //          <span class="hljs-variable"><span class="hljs-variable">$type_id</span></span> = (<span class="hljs-variable"><span class="hljs-variable">$element</span></span> instanceof umiHierarchyElement) ? <span class="hljs-variable"><span class="hljs-variable">$element</span></span>-&gt;getObjectTypeId() : <span class="hljs-variable"><span class="hljs-variable">$element</span></span>-&gt;getTypeId(); <span class="hljs-variable"><span class="hljs-variable">$type</span></span> = umiObjectTypesCollection::getInstance()-&gt;getType(<span class="hljs-variable"><span class="hljs-variable">$type_id</span></span>); <span class="hljs-variable"><span class="hljs-variable">$field_id</span></span> = <span class="hljs-variable"><span class="hljs-variable">$type</span></span>-&gt;getFieldId(<span class="hljs-variable"><span class="hljs-variable">$name</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-variable"><span class="hljs-variable">$field</span></span> = umiFieldsCollection::getInstance()-&gt;getField(<span class="hljs-variable"><span class="hljs-variable">$field_id</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-variable"><span class="hljs-variable">$field</span></span> instanceof umiField) { <span class="hljs-built_in"><span class="hljs-built_in">continue</span></span>; } switch(<span class="hljs-variable"><span class="hljs-variable">$field</span></span>-&gt;getDataType()) { //     ,       UMI <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"optioned"</span></span>: //storing old settings <span class="hljs-variable"><span class="hljs-variable">$oldForce</span></span> = umiObjectProperty::<span class="hljs-variable"><span class="hljs-variable">$USE_FORCE_OBJECTS_CREATION</span></span>; umiObjectProperty::<span class="hljs-variable"><span class="hljs-variable">$USE_FORCE_OBJECTS_CREATION</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; // ,     <span class="hljs-variable"><span class="hljs-variable">$objectsCollection</span></span> = umiObjectsCollection::getInstance(); <span class="hljs-variable"><span class="hljs-variable">$guideItems</span></span> = <span class="hljs-variable"><span class="hljs-variable">$objectsCollection</span></span>-&gt;getGuidedItems(<span class="hljs-variable"><span class="hljs-variable">$field</span></span>-&gt;getGuideId()); <span class="hljs-variable"><span class="hljs-variable">$options</span></span> = <span class="hljs-variable"><span class="hljs-variable">$value_node</span></span>-&gt;getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"option"</span></span>); <span class="hljs-variable"><span class="hljs-variable">$items</span></span> = Array(); foreach(<span class="hljs-variable"><span class="hljs-variable">$options</span></span> as <span class="hljs-variable"><span class="hljs-variable">$option</span></span>) { //  int            <span class="hljs-variable"><span class="hljs-variable">$int</span></span> = <span class="hljs-variable"><span class="hljs-variable">$option</span></span>-&gt;hasAttribute(<span class="hljs-string"><span class="hljs-string">"int"</span></span>) ? <span class="hljs-variable"><span class="hljs-variable">$option</span></span>-&gt;getAttribute(<span class="hljs-string"><span class="hljs-string">"int"</span></span>) : null; //  <span class="hljs-built_in"><span class="hljs-built_in">float</span></span>      <span class="hljs-variable"><span class="hljs-variable">$float</span></span> = <span class="hljs-variable"><span class="hljs-variable">$option</span></span>-&gt;hasAttribute(<span class="hljs-string"><span class="hljs-string">"float"</span></span>) ? <span class="hljs-variable"><span class="hljs-variable">$option</span></span>-&gt;getAttribute(<span class="hljs-string"><span class="hljs-string">"float"</span></span>) : null; <span class="hljs-variable"><span class="hljs-variable">$objects</span></span> = <span class="hljs-variable"><span class="hljs-variable">$option</span></span>-&gt;getElementsByTagName(<span class="hljs-string"><span class="hljs-string">"object"</span></span>); foreach(<span class="hljs-variable"><span class="hljs-variable">$objects</span></span> as <span class="hljs-variable"><span class="hljs-variable">$object</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$objectId</span></span> = <span class="hljs-variable"><span class="hljs-variable">$object</span></span>-&gt;hasAttribute(<span class="hljs-string"><span class="hljs-string">"id"</span></span>) ? <span class="hljs-variable"><span class="hljs-variable">$object</span></span>-&gt;getAttribute(<span class="hljs-string"><span class="hljs-string">"id"</span></span>) : null; <span class="hljs-variable"><span class="hljs-variable">$objectName</span></span> = <span class="hljs-variable"><span class="hljs-variable">$object</span></span>-&gt;hasAttribute(<span class="hljs-string"><span class="hljs-string">"name"</span></span>) ? <span class="hljs-variable"><span class="hljs-variable">$object</span></span>-&gt;getAttribute(<span class="hljs-string"><span class="hljs-string">"name"</span></span>) : null; <span class="hljs-variable"><span class="hljs-variable">$objectTypeId</span></span> = <span class="hljs-variable"><span class="hljs-variable">$object</span></span>-&gt;hasAttribute(<span class="hljs-string"><span class="hljs-string">"type-id"</span></span>) ? <span class="hljs-variable"><span class="hljs-variable">$object</span></span>-&gt;getAttribute(<span class="hljs-string"><span class="hljs-string">"type-id"</span></span>) : null; //   <span class="hljs-variable"><span class="hljs-variable">$item</span></span> = Array(); <span class="hljs-variable"><span class="hljs-variable">$item</span></span>[<span class="hljs-string"><span class="hljs-string">"int"</span></span>] = (int)<span class="hljs-variable"><span class="hljs-variable">$int</span></span>; <span class="hljs-variable"><span class="hljs-variable">$item</span></span>[<span class="hljs-string"><span class="hljs-string">"float"</span></span>] = (<span class="hljs-built_in"><span class="hljs-built_in">float</span></span>)<span class="hljs-variable"><span class="hljs-variable">$float</span></span>; <span class="hljs-variable"><span class="hljs-variable">$item</span></span>[<span class="hljs-string"><span class="hljs-string">"varchar"</span></span>] = <span class="hljs-variable"><span class="hljs-variable">$objectName</span></span>; // ,    property foreach(<span class="hljs-variable"><span class="hljs-variable">$guideItems</span></span> as <span class="hljs-variable"><span class="hljs-variable">$key</span></span> =&gt; <span class="hljs-variable"><span class="hljs-variable">$value</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-variable"><span class="hljs-variable">$value</span></span> == <span class="hljs-variable"><span class="hljs-variable">$objectName</span></span>) { //  id       int,    <span class="hljs-variable"><span class="hljs-variable">$item</span></span>[<span class="hljs-string"><span class="hljs-string">"rel"</span></span>] = (int)<span class="hljs-variable"><span class="hljs-variable">$key</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } } <span class="hljs-variable"><span class="hljs-variable">$items</span></span>[] = <span class="hljs-variable"><span class="hljs-variable">$item</span></span>; } } //   <span class="hljs-variable"><span class="hljs-variable">$entityId</span></span> = <span class="hljs-variable"><span class="hljs-variable">$element</span></span>-&gt;getId(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-variable"><span class="hljs-variable">$element</span></span> instanceof umiHierarchyElement) { <span class="hljs-variable"><span class="hljs-variable">$entityId</span></span> = <span class="hljs-variable"><span class="hljs-variable">$element</span></span>-&gt;getObject()-&gt;getId(); } <span class="hljs-variable"><span class="hljs-variable">$pageObject</span></span> = <span class="hljs-variable"><span class="hljs-variable">$objectsCollection</span></span>-&gt;getObject(<span class="hljs-variable"><span class="hljs-variable">$entityId</span></span>); //      ,    <span class="hljs-variable"><span class="hljs-variable">$existingItems</span></span> = <span class="hljs-variable"><span class="hljs-variable">$pageObject</span></span>-&gt;getValue(<span class="hljs-variable"><span class="hljs-variable">$name</span></span>); <span class="hljs-variable"><span class="hljs-variable">$newItems</span></span> = Array(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-variable"><span class="hljs-variable">$existingItems</span></span>) { //    ,     foreach(<span class="hljs-variable"><span class="hljs-variable">$existingItems</span></span> as <span class="hljs-variable"><span class="hljs-variable">$existingItem</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$found</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; foreach(<span class="hljs-variable"><span class="hljs-variable">$items</span></span> as <span class="hljs-variable"><span class="hljs-variable">$item</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-variable"><span class="hljs-variable">$item</span></span>[<span class="hljs-string"><span class="hljs-string">"rel"</span></span>] == <span class="hljs-variable"><span class="hljs-variable">$existingItem</span></span>[<span class="hljs-string"><span class="hljs-string">"rel"</span></span>]) { <span class="hljs-variable"><span class="hljs-variable">$found</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!<span class="hljs-variable"><span class="hljs-variable">$found</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$newItems</span></span>[] = <span class="hljs-variable"><span class="hljs-variable">$existingItem</span></span>; } } } //    foreach(<span class="hljs-variable"><span class="hljs-variable">$items</span></span> as <span class="hljs-variable"><span class="hljs-variable">$item</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$newItems</span></span>[] = <span class="hljs-variable"><span class="hljs-variable">$item</span></span>; } <span class="hljs-variable"><span class="hljs-variable">$pageObject</span></span>-&gt;setValue(<span class="hljs-variable"><span class="hljs-variable">$name</span></span>, <span class="hljs-variable"><span class="hljs-variable">$newItems</span></span>); <span class="hljs-variable"><span class="hljs-variable">$pageObject</span></span>-&gt;commit(); //restoring settings umiObjectProperty::<span class="hljs-variable"><span class="hljs-variable">$USE_FORCE_OBJECTS_CREATION</span></span> = <span class="hljs-variable"><span class="hljs-variable">$oldForce</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">break</span></span>; } } } /** *  UMI-       */ protected static <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> translateName(<span class="hljs-variable"><span class="hljs-variable">$name</span></span>) { <span class="hljs-variable"><span class="hljs-variable">$name</span></span> = umiHierarchy::convertAltName(<span class="hljs-variable"><span class="hljs-variable">$name</span></span>, <span class="hljs-string"><span class="hljs-string">"_"</span></span>); <span class="hljs-variable"><span class="hljs-variable">$name</span></span> = umiObjectProperty::filterInputString(<span class="hljs-variable"><span class="hljs-variable">$name</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!strlen(<span class="hljs-variable"><span class="hljs-variable">$name</span></span>)) <span class="hljs-variable"><span class="hljs-variable">$name</span></span> = <span class="hljs-string"><span class="hljs-string">'_'</span></span>; <span class="hljs-variable"><span class="hljs-variable">$name</span></span> = substr(<span class="hljs-variable"><span class="hljs-variable">$name</span></span>, 0, 64); <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-variable"><span class="hljs-variable">$name</span></span>; }</code> </pre><br></div></div><br>  In the above code, <b>after</b> creating or adding a product (checking for after), we read the product properties from the XML and, if there are optional properties, add the corresponding optional properties to the product from the Reference book for the Characteristics field. <br><br>  After adding the specified code and re-unloading goods to the site, we see that each product has positions, each with its own color and size.  That is, the indicated task is dostingut, and now we have the UMI.CMS system able to import optional product properties from 1C. <br><br>  Thus, events in UMI are a very powerful tool, and with the help of well-added event handlers, you can significantly extend the functionality of the site, without changing a single line of the CMS system code and retaining the possibility of system updates. <br></div><p>Source: <a href="https://habr.com/ru/post/166647/">https://habr.com/ru/post/166647/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../166637/index.html">Instructions for forwarding ports on Juniper SRX</a></li>
<li><a href="../166639/index.html">Automatic configuration of virtual machines in the clouds using metadata</a></li>
<li><a href="../166641/index.html">Store ID in Cookie</a></li>
<li><a href="../166643/index.html">[Translation] What happened when Facebook blocked my account</a></li>
<li><a href="../166645/index.html">Small useful things. How to make access from nagios / icinga to the host management interface through Google Chrome and MS IE browsers</a></li>
<li><a href="../166649/index.html">As I digitalized the film, and not only</a></li>
<li><a href="../166651/index.html">Matlab-bot, warm tube</a></li>
<li><a href="../166653/index.html">AJAX in CakePHP on jQuery and Prototype</a></li>
<li><a href="../166655/index.html">On Putin‚Äôs instructions, the FSB will create a system for preventing and eliminating computer attacks.</a></li>
<li><a href="../166657/index.html">MVC system in Zend Framework 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>