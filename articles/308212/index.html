<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>At the request of readers, check the LDAP server code ReOpenLDAP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to talk about the verification of the project ReOpenLDAP. This project was implemented to solve the problems encountered during...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>At the request of readers, check the LDAP server code ReOpenLDAP</h1><div class="post__text post__text-html js-mediator-article">  In this article I want to talk about the verification of the project ReOpenLDAP.  This project was implemented to solve the problems encountered during the operation of OpenLDAP in the infrastructure of MegaFon PJSC - the largest mobile operator in Russia.  Now ReOpenLDAP successfully works in MegaFon branches throughout Russia, so it would be interesting to check such a highly loaded project with the help of the PVS-Studio static analyzer. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/files/62d/37a/d9f/62d37ad9f139459280e58a0c879b6907.png"></div><p></p><br><a name="habracut"></a><br><h2>  Introduction </h2><br>  <a href="https://github.com/reopen/reopenldap">ReOpenLDAP</a> , also known as ‚ÄúTelcoLDAP‚Äù, is a fork of the <a href="http://www.openldap.org/">OpenLDAP</a> project, created by Russian developers for use in the telecommunications industry, with a lot of bug fixes and working replication in the multi-master topology.  ReOpenLDAP is an open source implementation of the <a href="https://en.wikipedia.org/wiki/lightweight_directory_access_protocol">LDAP</a> protocol server in C. <br><br>  ReOpenLDAP provides a high level of performance: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  More than 50 thousand LDAP changes per second </li><li>  More than 100 thousand LDAP requests per second </li></ul><br>  It is worth noting that, as a legacy of the OpenLDAP project, the ReOpenLDAP project received 3,185 <i>goto</i> operators, which greatly complicate the analysis, but even so, some errors were found. <br><br><h2>  Please sign up for testing the Beta-version of PVS-Studio under Linux </h2><br>  The writing of this article was made possible by the start of work on the creation of PVS-Studio for Linux.  It was in Linux that we checked the ReOpenLDAP project.  However, there is a threat that the Linux version will end its existence even before its publication.  The reason is little practical interest.  When there is some discussion on the forum, it seems that the biggest problem of the PVS-Studio product is the lack of a version for Linux.  But when it came to collecting contacts of people willing to participate in testing the Beta-version, it turned out that very few of them.  Note: we wrote about searching for enthusiasts in the article " <a href="http://www.viva64.com/ru/b/0415/">PVS-Studio confesses its love for Linux</a> ". <br><br>  I want to note: we are not worried about testing PVS-Studio.  Some for some reason decided that we had conceived all this so that programmers could work for us as testers for free.  Of course, this is not the case: we are able to organize testing on our own.  However, if only a few people respond, then it may be worth it to slow down or even suspend work in this direction.  And, unfortunately, there are really very few respondents.  Therefore, our unicorn has a request for all Linux-programmers. <br><br><p><img src="https://habrastorage.org/files/b0b/6af/c06/b0b6afc066da4fc6a8cbf3d29dcb02c1.png"></p><br><br>  Please join the ranks of the PVS-Studio for Linux Beta Testers.  This will show that there is a practical interest in the instrument.  Once again I will write how you can join the ranks of enthusiasts. <br><br>  If you want to help us test the work of PVS-Studio for Linux, please write to us.  To make the letters easier to process, please indicate the line ‚ÄúPVS-Studio for Linux, Beta‚Äù in the subject line of the letter.  Send letters to <i>support@viva64.com</i> .  Please write letters from corporate mailboxes and briefly introduce yourself.  We will be grateful to everyone who responds, but first of all we will take into account the wishes and recommendations of those people who could potentially become our clients over time. <br><br>  Also I ask in the letter to give answers to the following questions: <br><br><ul><li>  What operating system do you plan to run the analyzer under? </li><li>  What development environment are you using? </li><li>  What compiler is used to build the project? </li><li>  What build system are you using? </li></ul><br>  When there is a version that you can try, we will write letters to all responding.  Thank you in advance. <br><br><h2>  Test results </h2><br><h3>  Error in the priority of operations </h3><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0197/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0197/">V593</a> Consider reviewing the expression A = B == C 'kind.  The expression is calculated as the following: 'A = (B == C)'.  mdb_dump.c 150 <br><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dumpit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((rc = mdb_cursor_get(...) == MDB_SUCCESS)) { .... } .... }</code> </pre> <br>  The author made a mistake with the location of the closing parenthesis in the condition of the <i>while loop</i> , which led to an error in the priority of operations.  As a result, a comparison is first performed, and then the result of this comparison is written to the variable <i>rc</i> . <br><br>  This code should be corrected as follows: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((rc = mdb_cursor_get(...)) == MDB_SUCCESS) { .... }</code> </pre><br><br><h3>  Work with a null pointer </h3><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0205/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0205/">V595</a> The 'key' pointer was used before it was verified against nullptr.  Check lines: 1324, 1327. mdb.c 1324 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mdb_dkey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MDB_val *key, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *buf)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *c = key-&gt;mv_data; <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... if (!key) // &lt;= return ""; .... }</span></span></code> </pre> <br>  In the <i>if</i> block, the <i>key</i> pointer is checked for <i>NULL</i> , therefore, the author admits the possibility that this pointer is equal to zero, however, the above pointer is already used without verification.  To avoid an error, you should check the value of the <i>key</i> pointer before using it. <br><br>  Similar warning: <br><br><ul><li>  V595  Check lines: 7282, 7291. mdb.c 7282 </li></ul><br><br><h3>  Suspicious Ternary Operator </h3><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0186/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0186/">V583</a> The '?:' Operator, regardless of its conditional expression, always returns one and the same value: "vlvResult".  common.c 2119 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">print_vlv</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... tool_write_ldif( ldif ? LDIF_PUT_COMMENT : LDIF_PUT_VALUE, ldif ? <span class="hljs-string"><span class="hljs-string">"vlvResult"</span></span> : <span class="hljs-string"><span class="hljs-string">"vlvResult"</span></span>, buf, rc ); <span class="hljs-comment"><span class="hljs-comment">// &lt;= } .... }</span></span></code> </pre> <br>  When using the specified ternary operator, the same value will be returned, regardless of the condition.  Judging by the similar places in the source, there is a typo, and this code should be rewritten like this: <br><br><pre> <code class="cpp hljs">.... tool_write_ldif( ldif ? LDIF_PUT_COMMENT : LDIF_PUT_VALUE, ldif ? <span class="hljs-string"><span class="hljs-string">"vlvResult: "</span></span> : <span class="hljs-string"><span class="hljs-string">"vlvResult"</span></span>, buf, rc ); ....</code> </pre> <br><br><h3>  Probable typo in the field name </h3><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0169/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0169/">V571</a> Recurring check.  The 'if (s-&gt; state.r == 0)' condition was already verified in line 147. rurwl.c 148 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rurw_r_unlock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s-&gt;state.r == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// &lt;= if (s-&gt;state.r == 0) // &lt;= s-&gt;thr = 0; p-&gt;rurw_readers -= 1; } .... }</span></span></code> </pre> <br>  Here, the same condition is checked twice.  If you pay attention to similar places in the source, for example: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rurw_w_unlock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s-&gt;state.w == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s-&gt;state.r == <span class="hljs-number"><span class="hljs-number">0</span></span>) s-&gt;thr = <span class="hljs-number"><span class="hljs-number">0</span></span>; p-&gt;rurw_writer = <span class="hljs-number"><span class="hljs-number">0</span></span>; } .... }</code> </pre> <br>  then we can assume that one of the conditions meant checking s-&gt; state.w == 0. However, this is only an assumption, but in any case, developers should check this piece of code, and either correct one of the conditions or delete duplicate check. <br><br>  Similar place: <br><br><ul><li>  V571 Recurring check.  The 'def-&gt; mrd_usage &amp; 0x0100U' condition was already verified in line 319. mr.c 322 </li></ul><br><br><h3>  Parameter rewriting </h3><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0520/print/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0520/print/">V763</a> Parameter 'rc' is always rewritten in function body before being used.  tls_o.c 426 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tlso_session_errmsg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...., </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> rc, ....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> err[<span class="hljs-number"><span class="hljs-number">256</span></span>] = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *certerr=<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; tlso_session *s = (tlso_session *)sess; rc = ERR_peek_error(); <span class="hljs-comment"><span class="hljs-comment">// &lt;= .... }</span></span></code> </pre> <br>  In this function, the value of the <i>rc</i> parameter is always overwritten before the parameter is used.  It is probably worth removing <i>rc</i> from the parameter list. <br><br><h3>  Invalid format specifier </h3><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0176/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0176/">V576</a> Incorrect format.  Consider checking the fourth argument of the 'snprintf' function.  The SIGNED argument of memsize type is expected.  conn.c 309 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Connection</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> c_connid; .... } .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">conn_create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... bv.bv_len = <span class="hljs-built_in"><span class="hljs-built_in">snprintf</span></span>( buf, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>( buf ), <span class="hljs-string"><span class="hljs-string">"cn=Connection %ld"</span></span>, <span class="hljs-comment"><span class="hljs-comment">// &lt;= c-&gt;c_connid ); .... }</span></span></code> </pre> <br>  The format specifier "% ld" does not match the <i>c-&gt; c_connid</i> argument passed to <i>snprintf</i> .  The correct qualifier for <i>unsigned long</i> is "% lu".  Using "% ld" instead of "% lu" will result in invalid values, with sufficiently large arguments. <br><br>  Similar warnings: <br><br><ul><li>  V576 Incorrect format.  Consider checking the fprintf function.  The SIGNED integer type argument is expected.  ure.c 1865 </li><li>  V576 Incorrect format.  Consider checking the fprintf function.  The SIGNED argument of memsize type is expected.  tools.c 211 </li><li>  V576 Incorrect format.  Consider checking the fourth argument of the fprintf function.  The UNSIGNED integer type argument is expected.  mdb.c 1253 </li></ul><br><br><h3>  Undivided pointer </h3><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0117/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0117/">V528</a> It is odd that the pointer to the 'char' type is compared with the '\ 0' value.  Probably meant: * ludp-&gt; lud_filter! = '\ 0'.  backend.c 1525 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fe_acl_group</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ludp-&gt;lud_filter != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> &amp;&amp; ludp-&gt;lud_filter != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { .... } }</span></span></code> </pre> <br>  The author of the code wanted to reveal a situation when the pointer is zero or the string is empty.  But I forgot to dereference the <i>ludp-&gt; lud_filter pointer</i> , so the pointer just double-checks for <i>NULL</i> equality. <br><br>  You should dereference the pointer: <br><br><pre> <code class="cpp hljs"> .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ludp-&gt;lud_filter != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> &amp;&amp; *ludp-&gt;lud_filter != <span class="hljs-string"><span class="hljs-string">'\0'</span></span>) ....</code> </pre> <br>  Similar unclaimed pointers: <br><br><ul><li>  V528 It is odd that the pointer to the 'char' type is compared with the '\ 0' value.  Probably meant: * (* lsei) -&gt; lsei_values ‚Äã‚Äã[0] == '\ 0'.  syntax.c 240 </li><li>  V528 It is odd that the pointer to the 'char' type is compared with the '\ 0' value.  Probably meant: * (* lsei) -&gt; lsei_values ‚Äã‚Äã[1]! = '\ 0'.  syntax.c 241 </li></ul><br><br><h3>  Extra check </h3><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0153/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0153/">V560</a> A part of conditional expression is always true:! Saveit.  syncprov.c 1510 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">syncprov_matchops</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Operation *op, opcookie *opc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> saveit )</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( saveit || op-&gt;o_tag == LDAP_REQ_ADD ) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( op-&gt;o_tag == LDAP_REQ_MODRDN &amp;&amp; !saveit ) { .... } .... }</code> </pre> <br>  There is no sense in the <i>else</i> branch to check <i>saveit</i> for equality to zero, since  This has already been done in the first condition.  This worsens readability.  And, perhaps, this is even a mistake, as it was supposed to check something else. <br><br>  But most likely the code is quite simple: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( saveit || op-&gt;o_tag == LDAP_REQ_ADD ) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( op-&gt;o_tag == LDAP_REQ_MODRDN ) { .... }</code> </pre><br><br><h3>  Dangerous use of realloc </h3><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0340/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0340/">V701</a> realloc () possible leak: when realloc () fails in allocating memory, original pointer 'lud.lud_exts' is lost.  Consider assigning realloc () to a temporary pointer.  ldapurl.c 306 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *argv[])</span></span></span><span class="hljs-function"> </span></span>{ .... lud.lud_exts = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **)<span class="hljs-built_in"><span class="hljs-built_in">realloc</span></span>( lud.lud_exts, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * ) * ( nexts + <span class="hljs-number"><span class="hljs-number">2</span></span> ) ); .... }</code> </pre> <br>  An expression like <i>foo = realloc (foo, ....)</i> is potentially dangerous.  If memory allocation is impossible, <i>realloc</i> will return a null pointer, overwriting the previous pointer value.  To prevent this, it is recommended to store the pointer value in an additional variable before using <i>realloc</i> . <br><br><h3>  Rewriting value </h3><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0108/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0108/">V519</a> The 'ca.argv' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 7774, 7776. bconfig.c 7776 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">config_back_initialize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( BackendInfo *bi )</span></span></span><span class="hljs-function"> </span></span>{ .... ca.argv = argv; <span class="hljs-comment"><span class="hljs-comment">// &lt;= argv[ 0 ] = "slapd"; ca.argv = argv; // &lt;= ca.argc = 3; ca.fname = argv[0]; .... }</span></span></code> </pre> <br>  If this code is correct, then the first superfluous assignment should be deleted. <br><h2>  Conclusion </h2><br>  ReOpenLDAP is a project designed to ensure stable operation under high load.  Therefore, developers are responsible for testing and use specialized tools such as <a href="http://clang.llvm.org/docs/threadsanitizer.html">ThreadSanitizer</a> and <a href="http://valgrind.org/">Valgrind</a> .  However, as we see, this is not always enough, as with the help of PVS-Studio a number of errors were identified, although there are few of them. <br><br>  Static analysis helps to find errors before the testing phase - at the very early stages, thereby saving a lot of time.  Therefore, analyzers should be used regularly, and not like us, occasionally, demonstrating the capabilities of our PVS-Studio tool. <br><br>  I suggest to <a href="http://www.viva64.com/ru/pvs-studio-download/">download</a> and try the PVS-Studio static analyzer on your own project. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0422/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Egor Bredikhin.  <a href="http://www.viva64.com/en/b/0422/">Checking the Code for LDAP Server ReOpenLDAP on Our Readers' Request</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. </div></div></div><p>Source: <a href="https://habr.com/ru/post/308212/">https://habr.com/ru/post/308212/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308198/index.html">Code organization in Go</a></li>
<li><a href="../308200/index.html">What is executable business processes. Introduction to the subject area</a></li>
<li><a href="../308204/index.html">Working with DB in CleverStyle Framework</a></li>
<li><a href="../308206/index.html">Open Day at Kaspersky Lab</a></li>
<li><a href="../308208/index.html">Container Management with LXD</a></li>
<li><a href="../308214/index.html">Faster fast or deep optimization Median filtering for Nvidia GPUs</a></li>
<li><a href="../308216/index.html">1C, Linux, Excel, Word, OpenXML, ADO and Net Core</a></li>
<li><a href="../308218/index.html">You dissect the corpse using SOLID</a></li>
<li><a href="../308220/index.html">2D magic in detail. Part Four. Water</a></li>
<li><a href="../308224/index.html">HPE Synergy Pro Part I - Intro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>