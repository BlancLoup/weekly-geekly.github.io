<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Amazingly useful tool: lsof</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I used to look for problems in the code or in the system, using logs or monitoring indicators that are displayed on nice control panels with a simple ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Amazingly useful tool: lsof</h1><div class="post__text post__text-html js-mediator-article">  I used to look for problems in the code or in the system, using logs or monitoring indicators that are displayed on nice control panels with a simple and intuitive interface.  However, if for some reason the data on the control panel is not received, or the logs of some services are not available, debugging becomes more complicated.  Now there are few such problems, they are rare, but they still happen.  Therefore, even in our time, knowledge of tools that help to understand what is wrong with a certain process on any computer is very valuable. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fb1/8fc/86a/fb18fc86aa5282002f42d1c5979b5a92.jpg" alt="image"></div><a name="habracut"></a><br>  When I debug something for which there are no logs or monitoring indicators, I connect to the remote computer via ssh.  Of course, this approach is limited, it is not so simple, it does not correspond to the fashionable trends of DevOps, or to all those modern things that can be read on the Internet, but it is surprisingly well suited for me to quickly analyze the situation. <br><br>  This is actually similar to using the <code>print</code> command when debugging programs.  Here I would immediately like to clarify that I am not a SRE and not an operating engineer in the field of IT.  My main area of ‚Äã‚Äãactivity is development. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Sometimes I have to deploy the code I wrote and debug it when something goes wrong.  Almost always, when I find myself in a new system for myself, the most difficult for me is the <i><font color="#999999">search for something</font></i> .  For example, find out which port is listening on the process.  Or, more often, it is required to find out in which file a certain demon writes logs.  And even if I manage to find answers to these questions, using a bunch of calls to the <code>ps</code> , <code>pstree</code> and <code>ls</code> , and a great many calls to the <code>grep</code> , often the ‚Äúanswers‚Äù ‚Äã‚Äãthat I find either do not contain anything useful or turn out to be incorrect. <br><br>  If what you are reading now would be a speech by Raymond Goettinger, the lead developer of CPython, there would come a moment when the audience is waiting for the phrase: ‚Äúthere must be a better way.‚Äù <br><br>  And, in fact, there is such a way.  The tool that I constantly use to search the system for what I need has become a great tool called <code>lsof</code> . <br><br>  The <code>lsof</code> utility (its name sounds like el-soff, although some people prefer something like liss-off or even el-es-o-eff) is an incredibly useful command that lists a list of all open files (LiSts all Open Files). <br><br>  The <code>lsof</code> especially good for finding something, since on Unix-like systems everything is a file.  This is a surprisingly universal debugging tool that can quite easily replace the <code>ps</code> , <code>netstat</code> utilities, and some others as well. <br><br><h2>  <font color="#3AC1EF">Lsof options</font> </h2><br>  A veteran of SRE, who dealt with this matter decades before the term ‚ÄúSRE‚Äù appeared, once told me: ‚ÄúI stopped learning the lsof options as soon as I learned all the ones I need.  Learn the most important things, and that will be all you will ever need. ‚Äù <br><br>  The <code>lsof</code> utility has an extensive range of options. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">NAME</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lsof</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">list</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">open</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">files</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SYNOPSIS</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">lsof</span></span>  <span class="hljs-selector-attr"><span class="hljs-selector-attr">[  -?abChKlnNOPRtUvVX  ]</span></span>  <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -AA ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -cc ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ +cc ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ +|-dd ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[+|-DD ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ +|-es ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ +|-f [cfgGn]</span></span> ] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -F [f]</span></span> ] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -g [s]</span></span> ] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -i [i]</span></span> ] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[-k  k  ]</span></span>  <span class="hljs-selector-attr"><span class="hljs-selector-attr">[  +|-L  [l]</span></span> ] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ +|-mm ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ +|-M ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -o [o]</span></span> ] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -ps ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ +|-r[t[m&lt;fmt&gt;]</span></span>] ] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -s [p:s]</span></span> ] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -S [t]</span></span> ] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -T [t]</span></span> ] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -us ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ +|-w ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -x[fl]</span></span> ] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -z [z]</span></span> ] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -Z [Z]</span></span> ] <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ -- ]</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[names]</span></span></code> </pre> <br>  If you want to study them all - <a href="https://linux.die.net/man/8/lsof">man</a> will help you.  Here I would like to talk about those that I usually use. <br><br><h3>  <font color="#3AC1EF">‚ñç -u option</font> </h3><br>  The <code>-u</code> option displays a list of files opened by a specific user.  The following example shows how you can find out how many files the user <code>cindy</code> keeps open. <br><br><pre> <code class="hljs ruby">cindy@ubuntu<span class="hljs-symbol"><span class="hljs-symbol">:~</span></span>$ lsof -u cindy <span class="hljs-params"><span class="hljs-params">| wc -l 248</span></span></code> </pre> <br>  Usually, if before the parameter of some option put a ‚Äú^‚Äù (cover), which means denial, this leads to the exclusion of files corresponding to this parameter from the program output.  Here, for example, how you can find out the number of files on a computer that are open to all users with the exception of <code>cindy</code> . <br><br><pre> <code class="hljs ruby">cindy@ubuntu<span class="hljs-symbol"><span class="hljs-symbol">:~</span></span>$ lsof -u^cindy <span class="hljs-params"><span class="hljs-params">| wc -l 38193</span></span></code> </pre> <br><h3>  <font color="#3AC1EF">--U option</font> </h3><br>  The <code>-U</code> option <code>-U</code> all Unix domain socket files. <br><br><pre> <code class="hljs kotlin"><span class="hljs-symbol"><span class="hljs-symbol">cindy@</span></span>ubuntu:~$ lsof -U | head -<span class="hljs-number"><span class="hljs-number">5</span></span> COMMAND     PID       USER   FD   TYPE             DEVICE SIZE/OFF    NODE NAME <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>          <span class="hljs-number"><span class="hljs-number">1</span></span>       root    <span class="hljs-number"><span class="hljs-number">7</span></span>u  unix <span class="hljs-number"><span class="hljs-number">0xffff88086a171f80</span></span>      <span class="hljs-number"><span class="hljs-number">0</span></span>t0   <span class="hljs-number"><span class="hljs-number">24598</span></span> @/com/ubuntu/upstart <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>          <span class="hljs-number"><span class="hljs-number">1</span></span>       root    <span class="hljs-number"><span class="hljs-number">9</span></span>u  unix <span class="hljs-number"><span class="hljs-number">0xffff88046a22b480</span></span>      <span class="hljs-number"><span class="hljs-number">0</span></span>t0   <span class="hljs-number"><span class="hljs-number">22701</span></span> socket <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>          <span class="hljs-number"><span class="hljs-number">1</span></span>       root   <span class="hljs-number"><span class="hljs-number">10</span></span>u  unix <span class="hljs-number"><span class="hljs-number">0xffff88086a351180</span></span>      <span class="hljs-number"><span class="hljs-number">0</span></span>t0   <span class="hljs-number"><span class="hljs-number">39003</span></span> @/com/ubuntu/upstart <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>          <span class="hljs-number"><span class="hljs-number">1</span></span>       root   <span class="hljs-number"><span class="hljs-number">11</span></span>u  unix <span class="hljs-number"><span class="hljs-number">0xffff880469006580</span></span>      <span class="hljs-number"><span class="hljs-number">0</span></span>t0   <span class="hljs-number"><span class="hljs-number">16510</span></span> @/com/ubuntu/upstart</code> </pre> <br><h3>  <font color="#3AC1EF">‚ñç -c option</font> </h3><br>  The <code>-c</code> option allows you to display information about files that keep processes open, executing commands whose names begin with the specified characters.  For example, the following command will allow you to see the first 15 files opened by all Python processes running on the computer. <br><br><pre> <code class="hljs pgsql">cindy@ubuntu:~$ lsof -cpython | head <span class="hljs-number"><span class="hljs-number">-15</span></span> COMMAND     PID <span class="hljs-keyword"><span class="hljs-keyword">USER</span></span>   FD   <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span>             DEVICE SIZE/<span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>       NODE <span class="hljs-type"><span class="hljs-type">NAME</span></span> python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">16905</span></span> root  cwd    DIR                <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>     <span class="hljs-number"><span class="hljs-number">4096</span></span>  <span class="hljs-number"><span class="hljs-number">271589387</span></span> /home/cindy/sourcebox python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">16905</span></span> root  rtd    DIR                <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>     <span class="hljs-number"><span class="hljs-number">4096</span></span>       <span class="hljs-number"><span class="hljs-number">2048</span></span> / python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">16905</span></span> root  txt    REG                <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>  <span class="hljs-number"><span class="hljs-number">3345416</span></span>  <span class="hljs-number"><span class="hljs-number">268757001</span></span> /usr/bin/python2<span class="hljs-number"><span class="hljs-number">.7</span></span> python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">16905</span></span> root  mem    REG                <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">11152</span></span> <span class="hljs-number"><span class="hljs-number">1610852447</span></span> /usr/lib/python2<span class="hljs-number"><span class="hljs-number">.7</span></span>/lib-dynload/resource.x86_64-linux-gnu.so python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">16905</span></span> root  mem    REG                <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>   <span class="hljs-number"><span class="hljs-number">101240</span></span> <span class="hljs-number"><span class="hljs-number">1610899495</span></span> /lib/x86_64-linux-gnu/libresolv<span class="hljs-number"><span class="hljs-number">-2.19</span></span>.so python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">16905</span></span> root  mem    REG                <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">22952</span></span> <span class="hljs-number"><span class="hljs-number">1610899509</span></span> /lib/x86_64-linux-gnu/libnss_dns<span class="hljs-number"><span class="hljs-number">-2.19</span></span>.so python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">16905</span></span> root  mem    REG                <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">47712</span></span> <span class="hljs-number"><span class="hljs-number">1610899515</span></span> /lib/x86_64-linux-gnu/libnss_files<span class="hljs-number"><span class="hljs-number">-2.19</span></span>.so python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">16905</span></span> root  mem    REG                <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">33448</span></span> <span class="hljs-number"><span class="hljs-number">1610852462</span></span> /usr/lib/python2<span class="hljs-number"><span class="hljs-number">.7</span></span>/lib-dynload/_multiprocessing.x86_64-linux-gnu.so python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">16905</span></span> root  mem    REG                <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">54064</span></span> <span class="hljs-number"><span class="hljs-number">1610852477</span></span> /usr/lib/python2<span class="hljs-number"><span class="hljs-number">.7</span></span>/lib-dynload/_json.x86_64-linux-gnu.so python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">16905</span></span> root  mem    REG                <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">18936</span></span> <span class="hljs-number"><span class="hljs-number">1610619044</span></span> /lib/x86_64-linux-gnu/libuuid.so<span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">16905</span></span> root  mem    REG                <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">30944</span></span> <span class="hljs-number"><span class="hljs-number">1207967802</span></span> /usr/lib/x86_64-linux-gnu/libffi.so<span class="hljs-number"><span class="hljs-number">.6</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">16905</span></span> root  mem    REG                <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>   <span class="hljs-number"><span class="hljs-number">136232</span></span> <span class="hljs-number"><span class="hljs-number">1610852472</span></span> /usr/lib/python2<span class="hljs-number"><span class="hljs-number">.7</span></span>/lib-dynload/_ctypes.x86_64-linux-gnu.so python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">16905</span></span> root  mem    REG                <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">77752</span></span> <span class="hljs-number"><span class="hljs-number">1610852454</span></span> /usr/lib/python2<span class="hljs-number"><span class="hljs-number">.7</span></span>/lib-dynload/<span class="hljs-keyword"><span class="hljs-keyword">parser</span></span>.x86_64-linux-gnu.so python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-number"><span class="hljs-number">16905</span></span> root  mem    REG                <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>   <span class="hljs-number"><span class="hljs-number">387256</span></span> <span class="hljs-number"><span class="hljs-number">1610620979</span></span> /lib/x86_64-linux-gnu/libssl.so<span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span></code> </pre> <br>  Here is another interesting example.  For example, there are a number of Python 2.7 and Python 3.6 processes, and you need to find out which files are open by processes that are not Python 2.7 processes.  You can do it like this: <br><br><pre> <code class="hljs mel">cindy@ubuntu:~$ lsof -cpython -c^python2<span class="hljs-number"><span class="hljs-number">.7</span></span> | head <span class="hljs-number"><span class="hljs-number">-10</span></span> COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF       NODE NAME <span class="hljs-keyword"><span class="hljs-keyword">python</span></span>  <span class="hljs-number"><span class="hljs-number">20017</span></span> root  cwd    DIR    <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>     <span class="hljs-number"><span class="hljs-number">4096</span></span>       <span class="hljs-number"><span class="hljs-number">2048</span></span> / <span class="hljs-keyword"><span class="hljs-keyword">python</span></span>  <span class="hljs-number"><span class="hljs-number">20017</span></span> root  rtd    DIR    <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>     <span class="hljs-number"><span class="hljs-number">4096</span></span>       <span class="hljs-number"><span class="hljs-number">2048</span></span> / <span class="hljs-keyword"><span class="hljs-keyword">python</span></span>  <span class="hljs-number"><span class="hljs-number">20017</span></span> root  txt    REG    <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>  <span class="hljs-number"><span class="hljs-number">3345416</span></span>  <span class="hljs-number"><span class="hljs-number">268757001</span></span> /usr/bin/python2<span class="hljs-number"><span class="hljs-number">.7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">python</span></span>  <span class="hljs-number"><span class="hljs-number">20017</span></span> root  mem    REG    <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">11152</span></span> <span class="hljs-number"><span class="hljs-number">1610852447</span></span> /usr/lib/python2<span class="hljs-number"><span class="hljs-number">.7</span></span>/lib-dynload/resource.x86_64-linux-gnu.so <span class="hljs-keyword"><span class="hljs-keyword">python</span></span>  <span class="hljs-number"><span class="hljs-number">20017</span></span> root  mem    REG    <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>     <span class="hljs-number"><span class="hljs-number">6256</span></span>  <span class="hljs-number"><span class="hljs-number">805552236</span></span> /usr/lib/python2<span class="hljs-number"><span class="hljs-number">.7</span></span>/dist-packages/_psutil_posix.x86_64-linux-gnu.so <span class="hljs-keyword"><span class="hljs-keyword">python</span></span>  <span class="hljs-number"><span class="hljs-number">20017</span></span> root  mem    REG    <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">14768</span></span>  <span class="hljs-number"><span class="hljs-number">805552237</span></span> /usr/lib/python2<span class="hljs-number"><span class="hljs-number">.7</span></span>/dist-packages/_psutil_linux.x86_64-linux-gnu.so <span class="hljs-keyword"><span class="hljs-keyword">python</span></span>  <span class="hljs-number"><span class="hljs-number">20017</span></span> root  mem    REG    <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">10592</span></span>  <span class="hljs-number"><span class="hljs-number">805451779</span></span> /usr/lib/python2<span class="hljs-number"><span class="hljs-number">.7</span></span>/dist-packages/Crypto/Util/strxor.x86_64-linux-gnu.so <span class="hljs-keyword"><span class="hljs-keyword">python</span></span>  <span class="hljs-number"><span class="hljs-number">20017</span></span> root  mem    REG    <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">11176</span></span> <span class="hljs-number"><span class="hljs-number">1744859170</span></span> /usr/lib/python2<span class="hljs-number"><span class="hljs-number">.7</span></span>/dist-packages/Crypto/Cipher/_ARC4.x86_64-linux-gnu.so <span class="hljs-keyword"><span class="hljs-keyword">python</span></span>  <span class="hljs-number"><span class="hljs-number">20017</span></span> root  mem    REG    <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">23560</span></span> <span class="hljs-number"><span class="hljs-number">1744859162</span></span> /usr/lib/python2<span class="hljs-number"><span class="hljs-number">.7</span></span>/dist-packages/Crypto/Cipher/_Blowfish.x86_64-linux-gnu.so</code> </pre> <br><h3>  <font color="#3AC1EF">‚ñçOption + d</font> </h3><br>  The <code>+d</code> option allows you to find out which folders and files are open in a certain directory (but not in its subdirectories). <br><br><pre> <code class="hljs pgsql">cindy@ubuntu:~$ lsof +d /usr/bin | head <span class="hljs-number"><span class="hljs-number">-4</span></span> COMMAND     PID     <span class="hljs-keyword"><span class="hljs-keyword">USER</span></span>  FD   <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> DEVICE SIZE/<span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span>   NODE <span class="hljs-type"><span class="hljs-type">NAME</span></span> circusd    <span class="hljs-number"><span class="hljs-number">1351</span></span>     root txt    REG    <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>  <span class="hljs-number"><span class="hljs-number">3345416</span></span> <span class="hljs-number"><span class="hljs-number">268757001</span></span> /usr/bin/python2<span class="hljs-number"><span class="hljs-number">.7</span></span> docker     <span class="hljs-number"><span class="hljs-number">1363</span></span>     root txt    REG    <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">19605520</span></span> <span class="hljs-number"><span class="hljs-number">270753792</span></span> /usr/bin/docker runsvdir   <span class="hljs-number"><span class="hljs-number">1597</span></span>     root txt    REG    <span class="hljs-number"><span class="hljs-number">9</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>    <span class="hljs-number"><span class="hljs-number">17144</span></span> <span class="hljs-number"><span class="hljs-number">272310314</span></span> /usr/bin/runsvdir</code> </pre> <br><h3>  <font color="#3AC1EF">‚ñç -d option</font> </h3><br>  Perhaps the <code>-d</code> option is one of those that I use most often.  It gives only options <code>-p</code> .  This option allows you to specify a list of file descriptors, separated by a comma, to be included in the output or excluded from it.  This is what the documentation says about it: <br><br> <code>   ,         ¬´^¬ª.     ,        ¬´^¬ª.      . <br> <br>          ,        ,    ,      -  : ¬´0-7¬ª  ¬´3-10¬ª. <br> <br>         ,      ¬´^¬ª,   - ¬´^0-7¬ª     0  7. <br> <br>             ,   ,         . <br> <br>         , lsof          .</code> <br> <br><h3>  <font color="#3AC1EF">‚ñç -p option</font> </h3><br>  I can not remember when I would not use the option <code>-p</code> , working with <code>lsof</code> .  It allows you to display all files opened by the process with the specified when calling the PID command. <br><br>  For example, here‚Äôs how Ubuntu looks like displaying information about all files opened by a process, say, with PID 1. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e98/575/166/e98575166593363948969af414854944.png"><br>  <i><font color="#999999">Output from the lsof command invoked with the -p option in Ubuntu</font></i> <br><br>  This is what is displayed on my MacBook Air. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3b2/1d4/634/3b21d463486257337769122555c94580.png"><br>  <i><font color="#999999">Output from the lsof command invoked with the -p option on a MacBook Air</font></i> <br><br><h3>  <font color="#3AC1EF">‚ñç -P option</font> </h3><br>  The <code>-P</code> option suppresses, for network files, the conversion of port numbers to port names.  It is useful to use in cases where the resolution of port names does not work correctly. <br><br>  This option can be used with another option - <code>-n</code> , which suppresses the conversion of network numbers to host names for network files.  It is also useful for resolving hostnames in the wrong way. <br><br>  Suppressing both of the above transformations can <i><font color="#999999">sometimes</font></i> speed up <code>lsof</code> . <br><br><h3>  <font color="#3AC1EF">‚ñç -i option</font> </h3><br>  The <code>-i</code> option allows you to display information about files whose Internet addresses match the specified address.  If you do not specify addresses when invoking the command, this option allows you to display information about all Internet sockets and network files. <br><br>  With <code>lsof</code> you can, for example, look at TCP connections opened by a Slack or Dropbox client.  For fun, try to see how many connections Chrome tabs open, each of which is a separate process.  Let's look at the connections opened by Slack: <br><br><pre> <code class="hljs perl">lsof -i -a -u $USER | <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> Slack</code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/b88/eb5/51a/b88eb551a63c9423142e626a66781d6f.png"><br>  <i><font color="#999999">Displaying information about connections that Slack has opened</font></i> <br><br>  And with <code>lsof</code> you can learn about TCP sockets opened by the Dropbox client: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ef5/594/f44/ef5594f44ce6c546573dbd35246f2ec0.png"><br>  <i><font color="#999999">Displaying the connections that Dropbox has opened</font></i> <br><br>  <code>Lsof</code> allows <code>Lsof</code> to view UDP connection information using the <code>lsof -iUDP</code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ef9/cf4/d57/ef9cf4d57514cd28ad3b219d91970b14.png"><br>  <i><font color="#999999">Displaying UDP connections</font></i> <br><br>  Using the <code>lsof -i 6</code> command, you can display a list of open IPv6 connections. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e71/f0b/8cb/e71f0b8cb26e78e77bc0b4a409598512.png"><br>  <i><font color="#999999">Displaying IPv6 Connections</font></i> <br><br><h3>  <font color="#3AC1EF">‚ñç -t option</font> </h3><br>  The <code>-t</code> option suppresses all information except process IDs.  I often use it if I want to redirect the PID list to some other command, mostly <code>kill-9</code> . <br><br><pre> <code class="hljs mel">cindy@ubuntu:~$ lsof -t /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/dummy_svc.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> <span class="hljs-number"><span class="hljs-number">1235</span></span> <span class="hljs-number"><span class="hljs-number">2171</span></span> <span class="hljs-number"><span class="hljs-number">2188</span></span> <span class="hljs-number"><span class="hljs-number">2189</span></span> <span class="hljs-number"><span class="hljs-number">16758</span></span> <span class="hljs-number"><span class="hljs-number">16761</span></span> <span class="hljs-number"><span class="hljs-number">16762</span></span></code> </pre> <br><h2>  <font color="#3AC1EF">Combination of options</font> </h2><br>  Usually <code>lsof</code> combines the results of using several options, following the principle of logical OR.  If you specify the <code>-a</code> option, the results will be combined according to the rules of logical I. <br><br>  Of course, there are several exceptions to this rule, here, as usual, it is recommended to look at the documentation, but if in a nutshell, it works like this: <br><br> <code>        ,  ,    -i   ,   -u foo,        ,  ,     ¬´foo¬ª.      : <br> <br>    ID  (UID)   ¬´^¬ª (),    -u; <br>   (PID)   ¬´^¬ª (),    -p; <br>   (PGID)   ¬´^¬ª (),    -g; <br>     ¬´^¬ª (),    -c; <br>    TCP  UDP,    -s [p:s]. <br> <br>     -      ,         ,           . <br> <br>  -a         . ,    -a, -U  -u foo,       UNIX,   ,     ¬´foo¬ª.</code> <ol><li> <code>        ,  ,    -i   ,   -u foo,        ,  ,     ¬´foo¬ª.      : <br> <br>    ID  (UID)   ¬´^¬ª (),    -u; <br>   (PID)   ¬´^¬ª (),    -p; <br>   (PGID)   ¬´^¬ª (),    -g; <br>     ¬´^¬ª (),    -c; <br>    TCP  UDP,    -s [p:s]. <br> <br>     -      ,         ,           . <br> <br>  -a         . ,    -a, -U  -u foo,       UNIX,   ,     ¬´foo¬ª.</code> </li><li> <code>        ,  ,    -i   ,   -u foo,        ,  ,     ¬´foo¬ª.      : <br> <br>    ID  (UID)   ¬´^¬ª (),    -u; <br>   (PID)   ¬´^¬ª (),    -p; <br>   (PGID)   ¬´^¬ª (),    -g; <br>     ¬´^¬ª (),    -c; <br>    TCP  UDP,    -s [p:s]. <br> <br>     -      ,         ,           . <br> <br>  -a         . ,    -a, -U  -u foo,       UNIX,   ,     ¬´foo¬ª.</code> </li><li> <code>        ,  ,    -i   ,   -u foo,        ,  ,     ¬´foo¬ª.      : <br> <br>    ID  (UID)   ¬´^¬ª (),    -u; <br>   (PID)   ¬´^¬ª (),    -p; <br>   (PGID)   ¬´^¬ª (),    -g; <br>     ¬´^¬ª (),    -c; <br>    TCP  UDP,    -s [p:s]. <br> <br>     -      ,         ,           . <br> <br>  -a         . ,    -a, -U  -u foo,       UNIX,   ,     ¬´foo¬ª.</code> </li><li> <code>        ,  ,    -i   ,   -u foo,        ,  ,     ¬´foo¬ª.      : <br> <br>    ID  (UID)   ¬´^¬ª (),    -u; <br>   (PID)   ¬´^¬ª (),    -p; <br>   (PGID)   ¬´^¬ª (),    -g; <br>     ¬´^¬ª (),    -c; <br>    TCP  UDP,    -s [p:s]. <br> <br>     -      ,         ,           . <br> <br>  -a         . ,    -a, -U  -u foo,       UNIX,   ,     ¬´foo¬ª.</code> </li><li> <code>        ,  ,    -i   ,   -u foo,        ,  ,     ¬´foo¬ª.      : <br> <br>    ID  (UID)   ¬´^¬ª (),    -u; <br>   (PID)   ¬´^¬ª (),    -p; <br>   (PGID)   ¬´^¬ª (),    -g; <br>     ¬´^¬ª (),    -c; <br>    TCP  UDP,    -s [p:s]. <br> <br>     -      ,         ,           . <br> <br>  -a         . ,    -a, -U  -u foo,       UNIX,   ,     ¬´foo¬ª.</code> </li></ol> <code>        ,  ,    -i   ,   -u foo,        ,  ,     ¬´foo¬ª.      : <br> <br>    ID  (UID)   ¬´^¬ª (),    -u; <br>   (PID)   ¬´^¬ª (),    -p; <br>   (PGID)   ¬´^¬ª (),    -g; <br>     ¬´^¬ª (),    -c; <br>    TCP  UDP,    -s [p:s]. <br> <br>     -      ,         ,           . <br> <br>  -a         . ,    -a, -U  -u foo,       UNIX,   ,     ¬´foo¬ª.</code> <br> <br><h2>  <font color="#3AC1EF">The story of a big victory</font> </h2><br>  Perhaps I'm exaggerating a little here, the ‚Äúvictory‚Äù was not so big, but when something happened that was going on, <code>lsof</code> was very helpful. <br><br>  A couple of weeks ago, I had to pick up one copy of a new service in a test environment.  The test service in question was not connected to the working monitoring infrastructure.  I tried to find out why the process that had just been launched did not register itself with Consul, and as a result, other services could not detect it.  ‚ÄúSo, I don't know what's the matter, but I'll take a look at the logs,‚Äù I thought.  If something does not work as expected, I look at the logs of the service I am trying to work on, and in most cases the logs immediately indicate the root of the problem. <br><br>  The service in question was launched using the process manager and <a href="https://circus.readthedocs.io/en/latest/">circus</a> sockets.  Logs for processes running under <code>circus</code> are stored in a special place on the host - let's call it <code>/var/log/circusd</code> .  Newer services on the host were launched by another manager, <a href="http://skarnet.org/software/s6/">s6</a> , who writes logs to another location.  Then, there are also logs that <code>socklog/svlogd,</code> which, again, are somewhere else.  In short, there was no shortage of logs, and the main problem was to find out in which file descriptor my logging process was writing. <br><br>  Since I knew that the process that I was trying to deal with was working under <code>circus</code> , connecting with the <code>tail</code> command to <code>/var/log/circusd/whatever_tab_completion_suggested</code> would allow me to look at the <code>stdout</code> and <code>stderr</code> streams of this process.  True, viewing the log did not give me absolutely nothing.  It quickly became clear that I was reading the wrong log file, and indeed, upon closer inspection, it turned out that <code>/var/log/circusd</code> were two files in <code>/var/log/circusd</code> : <code>stage-svcname-stderr.log</code> and <code>staging-svcname.stderr.log</code> .  I then used to complete the command with the Tab key, and the file that was automatically selected was not the one I needed. <br><br>  One of the ways to understand which file was really used by the process of interest to me for logging was to use the <code>lsof -l filename</code> , which would output information about all processes that have open file descriptors.  It turned out that none of the working processes had associated a log file that I was viewing using the <code>tail</code> command, which meant that this file could be safely deleted. <br><br>  Viewing another file immediately made it possible to find out why the process failed (while <code>circus</code> restarted it after the failure, which led to an endless cycle of restart failures). <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  The more often I use the <code>lsof</code> command, the more other tools it replaces and the more useful it allows me to learn.  Hopefully <code>lsof</code> now has a chance to benefit you <code>lsof</code> . <br><br>  Dear readers!  What are some of the most common Linux command-line tools that you use? </div><p>Source: <a href="https://habr.com/ru/post/337934/">https://habr.com/ru/post/337934/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337918/index.html">Transition from a typical data center network to SDN</a></li>
<li><a href="../337922/index.html">Problems of React UI Kit and unified design systems that you did not know about</a></li>
<li><a href="../337924/index.html">Reports from Frontend Mix: optimization of loading sites and design system on BEM and React</a></li>
<li><a href="../337928/index.html">Overview of tools for load and performance testing</a></li>
<li><a href="../337932/index.html">VMworld 2017 Europe Conference. Day 1</a></li>
<li><a href="../337936/index.html">Chief, I want to work from home</a></li>
<li><a href="../337938/index.html">4 reasons to become a Data Engineer</a></li>
<li><a href="../337940/index.html">We write telegrams of a bot parser of vacancies on JS</a></li>
<li><a href="../337942/index.html">Welcome to mini ai cups</a></li>
<li><a href="../337946/index.html">How to write your first Linux device driver</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>