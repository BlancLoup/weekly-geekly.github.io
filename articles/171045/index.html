<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>3PAR StoreServ for work in a corporate mail environment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Microsoft Exchange 2010 is the most common and popular corporate messaging product in the Windows environment. Quite often, our customers have a quest...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>3PAR StoreServ for work in a corporate mail environment</h1><div class="post__text post__text-html js-mediator-article">  Microsoft Exchange 2010 is the most common and popular corporate messaging product in the Windows environment.  Quite often, our customers have a question in the selection of the necessary configurations for mail servers and data storage systems.  In this article I will try to tell about the features that have appeared in the product Microsoft Exchange 2010, what requirements must be considered when calculating the specifications, and what solutions HP has. <br><a name="habracut"></a><br><h4>  Exchange 2010 Architecture Features </h4><br>  The Exchange 2010 product has several features related to replication mechanics and fault tolerance. <br>  Exchange Server is tightly integrated with Active Directory: most user data is stored in Active Directory (link between user accounts and mailboxes, contact lists).  Only mailboxes themselves are stored separately from Active Directory.  Thanks to the Active Directory replication mechanism, when multiple Microsoft Exchange Servers are used, the data on all servers remains current. <br><br>  To implement fault tolerance in Exchange 2010, a single DAG technology is offered, the former SCR, LCR, CCR technologies and the single storage cluster have been removed.  DAG (Database Availability Group) - technology of asynchronous database replication between nodes with protection against data loss.  DAG is not a pure cluster technology, since  no virtual shared node.  In this regard, the client connection point was moved from the Mailbox role to the Client Access role.  In a DAG, only the base is clustered, which can move between servers included in the DAG.  But the Windows Clustering service is still used to determine the quorum.  DAG can work only on block devices (local disks and SAN) and cannot work on NAS network drives. <br><br>  Based on the features of the Exchange 2010 architecture, as well as the advent of more efficient hardware (this applies primarily to processors), the approach to architecture sizing has changed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Exchange 2010 Sizers </h4><br>  Microsoft publishes on its website a series of documents that describe the role of each component of the solution.  Understanding the many articles is quite a non-trivial task.  The following are theoretical sizingings. <br><br><h4>  1. Choosing the right <a href="http://technet.microsoft.com/en-us/library/dd346699.aspx">processor</a> </h4><br>  For a productive environment, you need a processor that works with the 64-bit version of Exchange 2010 on Windows Server 2008 or 2008 R2.  Microsoft recommends using Intel processors that support Intel Extended Memory 64 Technology or AMD processors that support AMD64. <br><br><h5>  Hyperthreading </h5><br>  The use of the Hyperthreading option requires careful planning, and the effect of deployment in the Exchange environment is usually not significant. <br><br>  By default, the Hyperthreading option should be disabled.  Use is only possible in the form of a temporary measure to improve processor performance until the additional hardware is commissioned. <br><br>  Below is a table with the minimum and recommended maximum settings for Exchange 2010. <br><table><tbody><tr><td>  Exchange 2010 server role </td><td>  Minimum <br>  configuration <br></td><td>  (recommended) <br>  maximum <br>  configuration </td><td>  example <br>  (recommended) <br>  maximum <br>  configurations </td></tr><tr><td>  Edge transport </td><td>  1x processor core </td><td>  2x processors </td><td>  12x processor cores </td></tr><tr><td>  Hub transport </td><td>  1x processor core&gt; </td><td>  2x processors </td><td>  12x processor cores </td></tr><tr><td>  Client access </td><td>  2x processor cores </td><td>  2x processors </td><td>  12x processor cores </td></tr><tr><td>  Unified messaging </td><td>  2x processor cores </td><td>  2x processors </td><td>  12x processor cores </td></tr><tr><td>  Mailbox </td><td>  2x processor cores </td><td>  2x processors </td><td>  12x processor cores </td></tr><tr><td>  Client Access / Hub Transport combined </td><td>  2x processor cores </td><td>  2x processors </td><td>  12x processor cores </td></tr><tr><td>  Multiple (Client Access, Hub Transport, Mailbox roles) </td><td>  2x processor cores </td><td>  4x processors </td><td>  24x processor cores </td></tr></tbody></table><br><h5>  Hub Transport Role </h5><br>  The recommended Microsoft configuration is 8 processor cores, for an environment where several servers and several thousand mailboxes are supposed to be used.  A server with a large number of cores can be effectively used when the Hub Transport role is configured to work with anti-virus and anti-spam software.  The load factor on the processors depends on such indicators as the average message size, the number of forwarded messages, the number of involved transport agents, the configuration of the antivirus and other applications. <br><br><h5>  Client Access Server Role </h5><br>  In Microsoft Exchange 2010, most client functions were moved from the Mailbox Server role to the Client Access Server role.  In the Exchange 2010 environment, messages are processed on the Client Access server if they are sent by a non-MAPI client (for example, POP3 or IMAP4).  In addition, Microsoft Office Web App is rendered by the Client Access server role, and not by the Microsoft Exchange Information Store service, as in previous versions of Exchange. <br><br>  These architectural features allow the Client Access server to seriously unload the Mailbox server and effectively use 8 processor cores.  For organizations with a small number of mailboxes or with a low volume of traffic from non-MAPI clients, it is recommended to use 2 cores. <br><br><h5>  Unified Messaging Server role </h5><br>  Microsoft recommends the configuration of a Unified Messaging Server with 8 processor cores.  Such a number of cores is necessary for the operation of voice mail, for example, the conversion of the .wav format to Windows Media Audio (WMA).  A server with 2 cores can be used for organizations with a small number of mailboxes or in an environment with a small activity of the Unified Server Messaging role. <br><br><h5>  Mailbox server role </h5><br>  Microsoft recommends configuring this role based on the number of mailboxes and user profiles.  4 processor cores give a good balance between performance and cost, so many cores can handle up to several thousand mailboxes.  Resource assessment requires an understanding of the average user profile.  This image can be obtained using transport performance counters.  The use of third-party utilities is also allowed. <br><br><h4>  2. The choice of <a href="http://technet.microsoft.com/en-us/library/dd346700(v%3Dexchg.141).aspx">RAM</a> </h4><br>  The choice of RAM is determined by the following values <br><ul><li>  RAM speed </li><li>  Volume of memory module / cost of memory module </li><li>  The number of slots in the server. </li></ul><br>  Exchange 2010 on the Windows Server 2010 operating system efficiently works with RAM up to 64 GB per server. <br><br>  The table below shows the minimum and maximum values ‚Äã‚Äãfor each role. <br><br><table><tbody><tr><td>  Exchange 2010 server role </td><td>  Minimum supported </td><td>  Recommended maximum </td></tr><tr><td>  Edge transport </td><td>  4GB </td><td>  1GB per core </td></tr><tr><td>  Hub transport </td><td>  4GB </td><td>  1GB per core </td></tr><tr><td>  Client access </td><td>  4GB </td><td>  2GB per core </td></tr><tr><td>  Unified messaging </td><td>  4GB </td><td>  2GB per core </td></tr><tr><td>  Mailbox </td><td>  4GB </td><td>  4GB + database cache </td></tr><tr><td>  Client Access / Hub Transport combined </td><td>  4GB </td><td>  2GB per core </td></tr><tr><td>  Multiple roles (Hub transport + Client Access + Mailbox) </td><td>  4GB </td><td>  4GB + 3-30 MB additional per mailbox. </td></tr></tbody></table><br><h5>  The role of Edge Transport and Hub Transport </h5><br>  These roles do not require a large amount of RAM, at least 4GB is enough to process all requests, the optimal value is 1GB per core, but not less than 4 GB in total. <br><br><h5>  Client Access Server Role </h5><br>  The consumption of RAM in this role is almost linearly dependent on the number of client connections and the number of transactions.  Based on Microsoft recommendations, the role configuration from 2GB per core is balanced. <br><br><h5>  Mailbox Server Role </h5><br>  This role is quite complicated in the calculations, because  The optimal parameters of RAM depend on the number of deployed roles, the number of mailboxes, the average user profile and the number of active databases. <br><br>  Memory calculation of this role is critical for reducing the I / O load on the server disk subsystem. <br><br><h4>  3. Calculate Mailbox Database Cache </h4><br>  Exchange 2010 uses a mechanism to reduce the load on the disk subsystem of the server or data storage, based on the use of the Extensible Storage Engine (ESE) cache.  The more cache available to the Exchange 2010 server, the lower the I / O load on the disk subsystem. <br><br>  Cache performance in Microsoft Exchange 2010 has been enhanced during several technical changes.  One of the most significant changes is the increase in the depth target check log.  This log is used to ensure that the logs and database cache are written to the database within reasonable time limits.  The size of the log depends on the number of copies and the type of database: <br><table><tbody><tr><td>  Database configuration </td><td>  Log checkpoint depth target </td></tr><tr><td>  Single database </td><td>  20MB </td></tr><tr><td>  Database with copies </td><td>  100MB </td></tr><tr><td>  Inactive database </td><td>  5MB </td></tr></tbody></table><br>  Using the Extensible Storage Engine, the I / O load for a database with two or more copies can be up to 40% lower than for a single database configuration.  In situations with high load on the disk subsystem, the database stores change files in memory for a long time, this behavior reduces the number of sequential write operations (repeated write) and creates a merging effect (coalescing), the so-called  hybrid storage model.  This allows you to quickly restore the database in case of malfunction.  At the same time, inactive copies of databases also use memory to store a log (5MB), this allows you to quickly translate an inactive database into active mode. <br><br>  The cache size, and, accordingly, the amount of physical memory directly depends on the number of databases and can be calculated from the table: <br><table><tbody><tr><td>  Number of databases </td><td>  The minimum amount of RAM </td></tr><tr><td>  1-10 </td><td>  2 GB </td></tr><tr><td>  11-20 </td><td>  4 GB </td></tr><tr><td>  21-30 </td><td>  6 GB </td></tr><tr><td>  31-40 </td><td>  8 GB </td></tr><tr><td>  41-50 </td><td>  10 GB </td></tr><tr><td>  51-60 </td><td>  12 GB </td></tr><tr><td>  61-70 </td><td>  14 GB </td></tr><tr><td>  71-80 </td><td>  16 GB </td></tr><tr><td>  81-90 </td><td>  18 GB </td></tr><tr><td>  91-100 </td><td>  20 GB </td></tr></tbody></table><br>  In previous versions of Echange, the key metric was the volume of I / O operations, now the current metrics are the volume of the database cache and the number of messages sent by the user per day. <br><br>  The following table allows you to determine IOPS, based on the volume of the box 2GB and an average letter size of 75KB. <br><table><tbody><tr><td>  Messages per mailbox per day (~ 75KB average message size) </td><td>  Database Cache Per User (MB) </td><td>  Single database (stand-alone): IOPS per box </td><td>  Database copy: IOPS per box </td></tr><tr><td>  50 </td><td>  3 </td><td>  .060 </td><td>  .050 </td></tr><tr><td>  100 </td><td>  6 </td><td>  .120 </td><td>  .100 </td></tr><tr><td>  150 </td><td>  9 </td><td>  .180 </td><td>  .150 </td></tr><tr><td>  200 </td><td>  12 </td><td>  .240 </td><td>  .200 </td></tr><tr><td>  250 </td><td>  15 </td><td>  .300 </td><td>  .250 </td></tr><tr><td>  300 </td><td>  18 </td><td>  .360 </td><td>  .300 </td></tr><tr><td>  350 </td><td>  21 </td><td>  .420 </td><td>  .350 </td></tr><tr><td>  400 </td><td>  24 </td><td>  .480 </td><td>  .400 </td></tr><tr><td>  450 </td><td>  27 </td><td>  .540 </td><td>  .450 </td></tr><tr><td>  500 </td><td>  thirty </td><td>  .600 </td><td>  .500 </td></tr></tbody></table><br><br><h4>  4. Active / inactive databases and database copies </h4><br><h5>  Inactive databases. </h5><br>  In Exchange 2010, the same server can handle both active copies of databases and inactive ones in a configuration with a fault-tolerant solution.  Processor requirements for processing inactive copies should also be considered at the design stage.  Inactive database copies use processor resources to check replicated logs and process the database index.  Each mailbox of an inactive database requires 15% of the CPU resources of the mailbox resources of the active database. <br><br><h5>  Copies of databases. </h5><br>  Each Exchange 2010 database can create up to 16 copies.  Each copy of the database consumes 10% of the CPU from the main database. <br><br>  Understanding the number of copies and the number of inactive databases is necessary in order to be able to create several models of the behavior of the Exchange 2010 environment depending on external conditions (for example, on the number of failed servers or platforms).  Typical models for the Exchange 2010 environment are the model with 100% use of all mailboxes and the behavior model for the worst case scenario. <br><br>  The planning steps are as follows: <br><br><ol><li>  We determine the required level of fault tolerance, the number of copies required and the number of Data Availability Groups (DAGs) to protect against the failure of various components. </li><li>  If you use fault tolerance, we define a behavior model: activate all mailboxes or set the worst case scenario. </li><li>  Depending on the selected model, select values ‚Äã‚Äãfrom the table below, based on the type of profile (10 hours with a two-hour peak of loading in the morning): </li></ol><br><br><table><tbody><tr><td>  Number of letters per day per mailbox </td><td>  Mailbox Database Cache (MB) </td><td>  Single database with IOPS per drawer estimates </td><td>  Database copies (IOPS on mailbox) </td><td>  Megacycles for the active box </td><td>  Megacycles for the inactive box </td></tr><tr><td>  50 </td><td>  3 </td><td>  .06 </td><td>  .05 </td><td>  one </td><td>  0.15 </td></tr><tr><td>  100 </td><td>  6 </td><td>  0.12 </td><td>  0.1 </td><td>  2 </td><td>  0.3 </td></tr><tr><td>  150 </td><td>  9 </td><td>  0.18 </td><td>  0.15 </td><td>  3 </td><td>  0.45 </td></tr><tr><td>  200 </td><td>  12 </td><td>  0.24 </td><td>  0.2 </td><td>  four </td><td>  0.6 </td></tr><tr><td>  250 </td><td>  15 </td><td>  0.3 </td><td>  0.25 </td><td>  five </td><td>  0.75 </td></tr><tr><td>  300 </td><td>  18 </td><td>  0.36 </td><td>  0.3 </td><td>  6 </td><td>  0.9 </td></tr><tr><td>  350 </td><td>  21 </td><td>  0.42 </td><td>  0.35 </td><td>  7 </td><td>  1.05 </td></tr><tr><td>  400 </td><td>  24 </td><td>  0.48 </td><td>  0.4 </td><td>  eight </td><td>  1.2 </td></tr><tr><td>  450 </td><td>  27 </td><td>  0.54 </td><td>  0.45 </td><td>  9 </td><td>  1.35 </td></tr><tr><td>  500 </td><td>  thirty </td><td>  0.6 </td><td>  0.5 </td><td>  ten </td><td>  1.5 </td></tr></tbody></table><br>  The megacycles parameter is determined by the processor's core performance in MHz, for example, 2 x 4 core Intel Xeon x5470 3.33-gigahertz (GHz) is 3333 megacycles per core. <br><br><h4>  5. Storage System </h4><br>  The choice of storage system depends on many factors, but is primarily determined by the number of mailboxes and the requirement for expansion. <br><br>  For smaller organizations with 1,000 mailboxes, HP and Microsoft recommend the use of an <a href="http://h20195.www2.hp.com/V2/GetPDF.aspx/4AA3-3953ENW.pdf">entry-level P2000G3 iSCSI storage</a> or <a href="http://h20195.www2.hp.com/V2/GetPDF.aspx/4AA4-4169ENW.pdf">ProLiant disk subsystem</a> . <br><br>  For large installations, high-level storage is recommended, supporting a large number of disks.  One of these arrays is 3PAR StoreServ, announced on December 4th, 2012.  This array has already been tested in the Exchange 2010 Solution Reviewed Program (ESRP) - Storage v3.0. <br><br>  As you know, 3PAR arrays are intended for use under virtualization tasks in an environment with unpredictable loads.  Another possible destination is corporate mail. <br><br>  In conjunction with Microsoft, a 3PAR StoreServ array of mail for 60,000 users was tested.  The solution used HP Proliant Bl460c Gen8 blade servers, C7000 blade baskets, Brocade optical switches. <br><br>  Test software: Microsoft Windows Server 2008 R2 and Microsoft Exchange 2010. <br><br>  <a href="http://h20195.www2.hp.com/V2/GetPDF.aspx/4AA4-5186ENW.pdf">The document</a> provides information about testing an array in an environment of 60,000 users. <br><br>  High performance is organized through the use of wide-striping technology (using all drives to build fault-tolerant RAID) on a 3PAR array using the Database Availability Group (DAG), where each copy of DAG is served by 18 servers (9 active servers are served by 60,000 users in 2 DAGs).  High data availability can be ensured by organizing data replication between two 3PAR arrays.  The test solution used one array and 9 servers. <br><br>  In the 3PAR disk array, all used disks are automatically divided into blocks of 1 GB (chunklet) in size, blocks with the same types of disks and one RAID level form a logical disk.  Common Provisioning Group (CPG) - a set of policies responsible for the formation of RAID groups.  CPG is also responsible for generating virtual volumes (LUNs) that are presented to the host. <br><br>  In the described solution, 3PAR is configured with one CPG for all hosts in both DAGs containing active databases.  In the event of a disk failure, the array will continue servicing all hosts; RAID rebuild processes will use spare chunklets on all remaining disks. <br><br>  Figure 1 shows the process of forming logical drives in the 3PAR array. <br><img src="https://habrastorage.org/storage2/b8e/e8e/2e9/b8ee8e2e95568052919671d029317d0d.png"><h6>  Pic1 </h6><br>  In the test environment, the configuration contains 18 servers connected to a 3PAR array with 216 2TB NL SAS.  Virtual volumes are presented to hosts.  From these virtual volumes, each server was provided with 12 volumes for databases / logs and one for recovery / maintenance. <br><br>  In this solution, virtual volumes were created on the 3PAR array, which made it easy to increase the size of the volume as the databases grow.  Active and inactive copies of the databases are placed on different arrays to ensure fault tolerance of the solution. <br><br>  All database volumes, maintenance and recovery volumes were created using RAID protection.  The actual size of databases and volumes for each specific customer depends on a large number of factors, including the Service Level Agreement (SLA), backup methodology, virtual volume management factors and the desired size of databases on disk. <br><br>  Figure 2 shows the active data center with the layout of volumes and servers. <br><br><img src="https://habrastorage.org/storage2/fc7/630/759/fc7630759b8f2518e5510501817ca682.png"><h6>  Pic2 </h6><br>  Figure 3 shows a complete solution diagram with 18 servers, each DAG has 9 servers.  In the event of a loss of communication or in the event of a power outage at a remote site, the 9 remaining servers are able to serve all the databases. <br>  The scheme of the presented databases for each host: <br><br><img src="https://habrastorage.org/storage2/de7/753/c9b/de7753c9bfa9ddb50c65da49aa910440.png"><br><br>  In the event of failure of the primary site - the remaining servers will be able to continue processing requests: <br><br><img src="https://habrastorage.org/storage2/863/86c/98e/86386c98ec3d381ad28211a2bcf47547.png"><br><br><h4>  6. Calculation for the scenario for 60,000 users </h4><br>  Consider a sample calculation scenario for the solution described. <br>  Number of mailboxes: 60000 <br>  User profile: 100 emails per day (0.14 IOPS per mailbox user with a margin of 20%). <br>  Load profile: 0.12 x 60000 = 8400 IOPS per active mailbox. <br>  Mailbox size: 2GB. <br>  Storage Architecture: RAID 10. <br>  DAGs: 2. <br>  Servers: 18 (9 servers for each DAG). <br>  Calculate the number of mailboxes per server: 60000/18 = ~ 3300. <br>  Number of mailboxes per database: 833. <br>  The size of the virtual volume on the storage system for each database (LUN) Database + Log = 1740.88GB. <br>  The storage system provides a raw capacity of at least 418,608 GB. <br>  Storage Connection Type: Fiber Channel SAN. <br>  Connection speed: 12x 8Gb = 96Gb / s <br>  Switches: 2x Brocade 8/24 <br>  Northern platform: 18 servers 2 x 8 core Intel Xeon E5-2650 2.0 GHz, 64 GB RAM. <br><br><h5>  We start the calculation. </h5><br>  Since  DAG should work in case of failure of 9 servers, then we start the calculation with 18 nodes.  Assuming that all databases are equally distributed across 18 nodes, we get 3,300 mailboxes per server.  We calculate the mailbox rate in case of failure of 9 nodes (60,000 / 9) = ~ 6700 mailboxes per server. <br><br>  We calculate the number of megacycles per mailboxes: 6700 x 2 (according to the megacycle table per mailbox) = 13,400 megacycles.  Multiply this value by 10% for each copy.  In this example, for each active copy there are 2 inactive ones, therefore, the number of megacycles increases by 20%: 13400 x 1.2 = 17700 megacycles. <br><br>  Multiply the number of inactive mailboxes (when the server processes the maximum number of mailboxes) by the megacycles index by the inactive mailbox from the table (3300 x 0.3 megacycles = 990 megacycles). <br><br>  Add up megacycles values ‚Äã‚Äãfor active mailboxes with values ‚Äã‚Äãfor inactive mailboxes: 17700 + 990 = 18690 megacycles.  We translate these values ‚Äã‚Äãto the platform. <br><br>  Two eight-core Intel Xeon E5-2650 2.0 GHz processors correspond to a value of 16x 2000 = 32,000 megacycles.  We consider the peak server utilization: 18690/32000 = 60%.  This value shows that at the time of the peak of requests from all users, in case of failure of half of the physical servers, we get a load of 60% on the processor, this figure is considered acceptable.  It is recommended to calculate the parameters so that the CPU utilization factor in a peak situation does not exceed 70%. <br><br>  Calculate the required number of cores for active mailboxes. <br><br>  For a fault tolerant solution: <br><br>  Required number of cores = (required CPU performance for active mailboxes) / (megacycles per core) x (number of remaining servers) x (number of DAGs). <br><br>  For a solution without fault tolerance: <br><br>  Required number of cores = (required CPU performance for active mailboxes) / (megacycles per core) x (number of servers in the data center) <br><br>  Based on our values: <br>  6700/2000 x 9 = 30 cores <br><br>  30 cores out of 144 (9 servers with 16 cores) process active mailboxes, in case 14 servers fail. <br><br>  Based on this, we calculate the number of cores required for Exchange roles (as recommended by Microsoft). <br><br>  Kernels Hub Transport = required number of cores / 5 = 30/5 = 6. <br><br>  Kernels for Client Access server = required number of cores x 3/4 = 30 x 3/4 = 22. <br><br>  Global catalog kernels = required number of cores / 8 = 30/8 = 4. <br><br>  Similarly, the calculated value of RAM. <br><br>  Based on the 6,700 mailboxes per server, in the event of a second site failure, and the 100 mailbox parameter, we get the ~ 40GB cache value for the Mailbox role.  For the remaining roles, we leave ~ 40% RAM to the server.  Thus, a server with 56GB of RAM should handle the load of 6,700 mailboxes.  In our case, test servers with a large amount of RAM (64GB RAM) were used. <br><br>  Based on the recommended Microsoft values, IOPS is calculated (the number of mailboxes is multiplied by the IOPS value for active and inactive copies): 60000 x (0.12 + 2 x 0.1) = ~ 19200 IOPS.  In the current configuration, the array provides 21 363 IOPS 25read / 75write performance according <a href="http://technet.microsoft.com/en-us/library/ee832792(v%3Dexchg.141).aspx">to</a> Microsoft <a href="http://technet.microsoft.com/en-us/library/ee832792(v%3Dexchg.141).aspx">recommendations</a> for calculating the cache for storage systems. <br><br><h5>  Recommendations: </h5><br><ol><li>  Windows Server 2008R2 does not require the use of special utilities for formatting and ‚Äúaligning‚Äù blocks on physical media, as required by Windows Server 2003. Windows Vista, Windows 7, Windows Server 2008 and later products by default align the partition with 1MB. </li><li>  Microsoft recommends using SAS disks for the mail environment, while SSDs for mail tasks are ineffective: <a href="http://technet.microsoft.com/en-us/library/ee832792.aspx">In general, Exchange 2010 Mailbox servers</a> . </li><li>  Use host-side MPIO with dual port HBA adapters. </li><li>  Always consider the load according to the worst scenario (as we considered the load on the host processors earlier). </li><li>  Use shared resources (Shared Logical Disks) during the deployment of Microsoft Exchange to get the most out of the 3PAR wide-striping technology. </li><li>  For SAS 7.2k drives, Microsoft <a href="http://technet.microsoft.com/en-us/library/ee832792.aspx">recommends</a> using RAID 1 + 0. </li></ol><br><br><h4>  Findings: </h4><br>  The Microsoft Exchange 2010 product remains the most popular corporate email product today.  Together with Microsoft, HP regularly tests its products and uploads performance data. <br><br>  An example of such testing is the solution on the 3PAR StoreServ 7400 array for 60,000 users. <br><br>  The test was launched for 24 hours and showed the ability of the 3PAR StoreServ array to cope with long-term high loads when working with Microsoft Exchange.  Databases and log files were analyzed after testing for possible errors. <br><br>  Solution Testing Report: <br><br>  1. Were any errors in the event log? <br>  - Not <br>  2. Were any errors in the log files and databases as a result of checking checksums? <br>  - Not <br><br>  The average performance of the disk subsystem on the host side during peak loads: <br>  Database I / O <br>  Database Disk Transfers / sec 1921 <br>  Database Disk Reads / sec 1210 <br>  Database Disk Writes / sec 711 <br>  Average Database Disk Read Latency (ms) 19.79 <br>  Average Database Disk Write Latency (ms) 1.96 <br>  Transaction Log I / O <br>  Log Disk Writes / sec 632 <br>  Average Log Disk Write Latency (ms) 0.58 <br><br>  When calculating the required configurations, you can use both the results of the already tested HP ESRP solutions and the recommended parameters for each roles on the Microsoft website. <br><br>  Literature: <br>  1. <a href="http://h20195.www2.hp.com/v2/GetPDF.aspx/4AA3-8703ENW.pdf">Calculation of the array for 140,000 Exchange users</a> <br>  2. <a href="http://h20195.www2.hp.com/V2/GetPDF.aspx/4AA4-5186ENW.pdf">Calculate an array of 60,000 Exchange users</a> <br>  3. <a href="http://h20195.www2.hp.com/V2/GetPDF.aspx/4AA3-3953ENW.pdf">Calculation of the array per 1000 Exchange users</a> <br>  4. <a href="http://h20195.www2.hp.com/V2/GetPDF.aspx/4AA4-4169ENW.pdf">Calculation per 1000 Exchange users on the ProLiant server disk subsystem</a> <br>  5. <a href="http://blogs.technet.com/b/exchange/archive/2009/11/09/3408737.aspx">Microsoft role calculator</a> <br>  6. <a href="http://technet.microsoft.com/en-us/library/dd351197.aspx">Performance and Scalability for Exchange Server 2010 SP1</a> </div><p>Source: <a href="https://habr.com/ru/post/171045/">https://habr.com/ru/post/171045/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../171033/index.html">The history of the GNU operating system, or what happened to Hurd?</a></li>
<li><a href="../171035/index.html">Posting videos on YouTube‚Äôs user‚Äôs channel</a></li>
<li><a href="../171037/index.html">Google two-way authentication bypass</a></li>
<li><a href="../171041/index.html">The coolest result on TechCrunch Moscow '12</a></li>
<li><a href="../171043/index.html">Video from the W3C conf 2013 conference is available on YouTube</a></li>
<li><a href="../171047/index.html">What to read? Proposals for the publication of computer books. Part 1</a></li>
<li><a href="../171057/index.html">Inclusion of the Ubuntu-based Samba server in the AD domain</a></li>
<li><a href="../171059/index.html">President Barack Obama has awarded IBM scientists with national medals</a></li>
<li><a href="../171061/index.html">Forget about B2B and B2C. Mobile technology turns everything into B2P - a business for people</a></li>
<li><a href="../171063/index.html">Microsoft suspected the creators of the terrorist recognition complex of plagiarism</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>