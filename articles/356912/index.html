<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Time attack on HSTS Sniffly shows which sites the user went to</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Modern browsers support HTTP Strict Transport Security (HSTS). The HSTS flag indicates that it is necessary to request an encrypted HTTPS version from...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Time attack on HSTS Sniffly shows which sites the user went to</h1><div class="post__text post__text-html js-mediator-article"> <a href=""><img src="https://habrastorage.org/files/c0a/d86/16e/c0ad8616eee64bc7ba152ca6a33ca762.jpg" align="left" width="400"></a>  Modern browsers support HTTP Strict Transport Security (HSTS).  The HSTS flag indicates that it is necessary to request an encrypted HTTPS version from a specific domain ‚Äî even if the transition is carried out via HTTP, and not HTTPS.  The mechanism is needed to provide an additional level of security: the browser could request an HTTP version of a page that is easy to listen to or replace.  This way you can avoid some attacks by lowering the level of protection and intercepting cookies. <br><br>  The data that a particular domain had the HSTS flag set are stored in the user's browser.  This is a boolean variable (true / false).  These are not cookies, but security information, which is why browsers treat it differently.  About cookie tracking is well known.  The user can enter the browser settings and delete those cookies that he does not like.  There are separate add-ons that prohibit the acceptance of cookies from the domains of marketing companies.  Clearing the HSTS settings is not so transparent - in browsers you can only remove all flags for all sites at once.  In January, Sam Greenhal <a href="http://geektimes.ru/post/244065/">demonstrated</a> that using HSTS you can create superkuki that are not so easy to remove. <br><br>  Last month, Yan Zhu showed up at Sniffly's ToorCon conference in San Diego.  The project uses HSTS and Content Security Policy to determine which sites from the list the user has already visited. <br><a name="habracut"></a><br>  Sniffly looks like a <a href="https://zyan.scripts.mit.edu/sniffly/">regular web page</a> .  After switching to it, Sniffly will check a number of sites and show which resources the user probably was on, and which resources they probably did not.  In some cases, Sniffly produces data with large errors.  Before visiting it is recommended to disable HTTPS Everywhere, if this add-on is installed.  Sniffly works only in the main browsers, and does not show the correct results in Chrome for iOS, Internet Explorer and Safari. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  How it works? </h1><br>  The principle of operation of Sniffly is simple and briefly described in the <a href="https://zyan.scripts.mit.edu/presentations/toorcon2015.pdf">presentation</a> for ToorCon.  If the owner of sneaky.com knows that example.com uses HSTS, then he can embed any element of example.com into his sneaky.com page.  Then, each time you visit sneaky.com, the user will request this item, which means a request to example.com. <br><br>  If the user has already visited example.com, then his browser already stores HSTS data, so an internal redirect to the HTTPS version of the example.com page will occur.  This redirect happens almost instantly.  If the user has never been to example.com, then a full-fledged network request will be made with an HTTP 301 or 302 code ‚Äî that is, a redirect to the HTTPS version.  This query will take much longer.  Measurement of time will allow to make a timing attack and establish the fact of visiting a particular resource with HSTS. <br><br>  But you need to measure time.  For this, the abuse of Content Security Policy is used.  It's funny that, like HSTS, it is also a security tool.  The standard is designed to prevent content downloads, which is designed to get rid of XSS attacks.  All sneaky.com needs in order to conduct its attack is the prohibition of downloading pictures via HTTPS.  When you try to upload a picture via HTTPS, an error occurs that is registered by the JavaScript code.  If the user was on example.com and has the HSTS flag, the error arrives within a millisecond order.  If a complete request is made, then the error comes in a hundred milliseconds or more. <br><br>  Sniffly applies the principles outlined above to several hundred HSTS resources that were selected from the first million Alexa.com rankings.  Sniffly may work worse with newer browsers, with HTTPS Everywhere add-ons or in the Tor browser.  The author claims that, in principle, you can try to track with the help of timing not only the fact of visiting the resource, but also the presence of the file in the cache. <br><br>  Easy to find application for this tool.  These are not only different systems for exploring the tastes of a user with the goal of selling him relevant advertising.  It also leaks important personal information.  You can set the range of interests of the user, his views and preferences. <br><br>  You can resist the attack.  Modern browsers have a built-in list of domains that can only be accessed via HTTPS.  It is enough to get the domain name of the resource to the HSTS Preload list of popular browsers, and it will be impossible to establish the fact of its visit. <br><br>  <strong><a href="https://zyan.scripts.mit.edu/sniffly/">Sniffly</a></strong> <br>  <a href="https://github.com/diracdeltas/sniffly">GitHub page</a> </div><p>Source: <a href="https://habr.com/ru/post/356912/">https://habr.com/ru/post/356912/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../356902/index.html">Snowden said that he uses the Signal messenger</a></li>
<li><a href="../356904/index.html">UK introduced a bill on the supervision of digital life of citizens</a></li>
<li><a href="../356906/index.html">Roskomnadzor may be given the right to divide domains .RU and .–†–§ domains without trial</a></li>
<li><a href="../356908/index.html">Go into Flash: Top 10 vulnerabilities exploited by attackers</a></li>
<li><a href="../356910/index.html">On TV accidentally revealed secret documents of the Ministry of Defense of the Russian Federation</a></li>
<li><a href="../356914/index.html">Belgian MIA: Islamic State uses Playstation 4 for communication</a></li>
<li><a href="../356916/index.html">The State Duma proposes to consider the possibility of restricting access to the Telegram to Russians. In response, Pavel Durov proposes to ban words</a></li>
<li><a href="../356918/index.html">The head of the Ministry of Communications and Mass Media of the Russian Federation considers the restriction of access to Telegram for Russian users unwise</a></li>
<li><a href="../356920/index.html">Russian officials may ban WhatsApp and Google</a></li>
<li><a href="../356922/index.html">Paris terrorists communicated via SMS without encryption</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>