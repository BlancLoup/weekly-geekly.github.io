<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>System of settings and change of versions of programs: evolution of viable forms</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Constant-variable dualism. 

 Settings for programs have existed for a long time, from the most ancient assembler programs that have constants in thei...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>System of settings and change of versions of programs: evolution of viable forms</h1><div class="post__text post__text-html js-mediator-article">  <i>Constant-variable dualism.</i> <br><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/7b2/560/46f/7b256046f02915290a49d0fdac319184.jpg">  Settings for programs have existed for a long time, from the most ancient assembler programs that have constants in their code as settings.  Updating such programs occurred with the complete replacement of the code, so changing the settings system did not entail negative consequences.  In the worst case, I had to relearn the use of the interface.  The situation began to change with the continuity of data types and program settings.  At one time, Microsoft paid great attention to the compatibility of programs and data in operating systems, what was their strength.  And now support for XP Mode is a continuation of the compatibility policy.  In relation to the web, users often have situations where the data and settings they have remain from previous versions (in cookies, in third-party databases), and the version of the program - on the server or the script on the client - changes.  There is a problem of compatibility of versions of programs and data and the need to develop some policy to maintain compatibility.  The new version may not be compatible with browsers (due to bugs or incomplete support), then a rollback to the former at the time of fixing bugs should not be accompanied by a loss or distortion of the settings, despite the fact that their number may change with the version change. <br><br>  It requires an approach not just to the settings and their organization, but to the problems of version changes and continuity of settings.  Programs on the web are developing in small steps, changing versions often.  The same approach to working with settings applies to other programs not related to the web, but with frequent version changes.  Similar reasoning can be attributed to the formats of all data in programs, not only to the formats for storing settings. <br><a name="habracut"></a><br>  The main theses that are displayed and worked out in the article: <br>  *) settings - an object for programs and client web applications with similar patterns of behavior; <br>  *) The default settings are nothing more than the manufacturer's recommendations for the settings; <br>  *) changing the settings when changing versions of the program is a change in the manufacturer's recommendations;  there may be a version change only for the sake of changing settings; <br>  *) user settings - user recommendations to yourself; <br>  *) export-import settings - the ability to exchange between users, save recommendations, transfer between computers; <br>  (Further - by changing versions.) <br>  *) changing the semantics of the manufacturer settings (when changing versions) - an error that introduces a violation of logic when upgrading - downgrade; <br>  *) when storing 2 states of settings with switching on the ‚Äúreturn‚Äù button, a number of functions are possible without complicating the interface: try new settings when changing versions, roll back to old settings, try and store third-party recommendations; <br>  *) to preserve simplicity, a more complicated manipulation system is undesirable.  There is export-import for all extended actions; <br>  *) Return to the manufacturer settings - a separate function ("Reset"); <br>  *) manufacturer's recommendations are ‚Äúsewn up‚Äù into the program, therefore they do not occupy a separate place, there may be several of them (settings profiles), there is a ‚ÄúSave‚Äù button for saving other recommendations; 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Having seen the depth and commonality of the problem of settings and recommendations, let us outline the range of requirements that we will try to support.  It is necessary to have a fairly simple and universal system of settings that would work satisfactorily and develop when changing versions.  The result is a practical algorithm for supporting the indicated range of requirements.  After building the algorithm, we will show the implementation of the settings subsystem to * .user.js and a separate procedure to * .js.  It was made out of considerations that it is better to immediately describe the rules for working with settings for yourself and users and not to depart from it than to work out later, correcting your own mistakes. <br><br><h3>  Circle of requirements: how much the settings will be compatible with the program versions </h3><br>  When changing versions, everything changes - the program, settings, logic and semantics (meaningful settings).  Version change is another dimension of the development of logic, which takes into account the arrival of data from old versions, settings from them, and sometimes from the new versions, if there is a downgrade or transfer of settings to another computer, another version of the program.  Having modeled the situation of changing versions, we begin to understand which rules need to be followed, and what freedom can be left.  Or, in other fashionable words, create a ‚ÄúSettings‚Äù <i>design pattern</i> . <br><br>  Regarding compatibility issues, each developer vividly recalls the classic nightmare that Adobe arranged with the Photoshop versions in <s>order to turn out the pockets of customers</s> .  Here, most likely, she acted with intent, especially since history repeats itself with their other expensive programs.  Worked for 1-2 years with the flagship program of the industry - pay the next installment.  Such an approach cannot afford small programs and services, but, on the contrary, version change is required to be done for free and very often, almost with every release of a new version of a browser.  A clear and mutually comfortable version change with support for compatibility of settings is required.  (And also, one-to-one - data formats and their semantics, but <b>we will explore only the settings</b> .) However, different users can upgrade far from the previous version, and most users will not bother to work with the settings, or some settings will be missing in general, but be automatic - for example, saving window location parameters in the system. <br><br>  The system of saving and transition between versions takes into account these facts and provides: <br>  1) storing and restoring settings in the current version of the program; <br>  2) when updating the program - do not forget the old settings in case you return to the old version (at least 1 step back); <br>  3) the constancy of the meaning of the old settings in the environment of an arbitrarily new version (the semantics should not change; why - the analysis below); <br>  4) not to strain the user by tracking the versions and not to force him to take any actions (the best is the enemy of the good; there is no need not to distract); <br>  5) do not strive for gigantism and store differences (diffs) in the settings - an optimization step. <br><br>  When working with versions of the JS script, which on the client also turns out to be a full-fledged program, the problem of saving the user's settings when changing versions was discovered.  Immediately I remembered the compatibility issues of Photoshop versions and some other monsters.  And it was thought that to solve the problem of correct work with user settings is better in the embryonic state, until the script went to the masses and many dissatisfied users appeared who would have to manually adjust the new version of the program from memory, or, even worse, the old settings would go into a contradiction with the new version, an untested bug will arise.  To offer the user "reset everything and install on a new one" is, of course, a well-known and ugly way of solving such problems with which experienced users have come to terms.  (In fact, what can they do with the manufacturer of Photoshop, when there is more benefit than trouble?) It is better to immediately put into the project a technique for resolving configuration conflicts when changing versions.  So the rules for working with versions and settings were built, which the program designer could follow. <br><br>  In the second part in the next article - the implementation of a test page on JS - a ready-made script in which you can test the performance of the approach.  In the user settings script, there is an arbitrary multi-level structure, so it can be ported to various projects, which also reflect on the need for a correct version change.  Or, using the first and second parts, write logic in another language.  Efforts will not be in vain and you can save on the designer's work on the preparation of a beautiful plate of this content: <br><table><tbody><tr><th>  <s><font color="#cc6633">Before installation, it is recommended to remove the settings of the previous version ...</font></s> <s><font color="#cc6633"><br></font></s> </th></tr></tbody></table><br><h3>  On the policy of saving program settings when moving to new versions. </h3><br> <a href="http://andybialk.blogspot.com/2010/04/how-to-train-your-dragon.html"><img align="right" src="https://habrastorage.org/getpro/habr/post_images/d95/8a6/578/d958a657891a6481309cfa14a3f56e67.jpg"></a>  As already mentioned, changing program versions is entering a new dimension, from solving problems with code bugs in one program sheet to solving problems of its development.  Developers may not immediately realize the specifics of this area if they have been working on a number of other very important functions of their program for a long time, and the issue of changing versions is not in the forefront.  But once he gets up, and evolution begins. <br><br>  What happened in the era of dinosaurs: the program when installing a new version starts to work poorly or does not work at all.  Recommendation: before installing a new program, delete the previous version (and clear the registry and folder files from the data from the old version of the program).  In severe cases - do not open the data created in the old version of the program of the new version. <br><br>  Another ancient option: when moving to a new version, the program does not ask what the settings were - it sets defaults, and the user installs them manually.  Workaround for problems with the program: sometimes they substitute data in ini-files, the registry (win detected), configuration files, and this saves themselves from some of the tuning work.  Another solution is to store the program with the image of the virtual OS in which it is installed;  put a redisributable package in which they created a working customized image of the program, and then packed it for re-installation;  use a silent installation with settings provided for in quite a few serious programs. <br><br>  The case of more adapted forms of life: the program begins to understand the old settings left over from the previous version.  What you need to do when creating a program? <br><br>  <i>We will talk about programs, now about the web and websites, because there and there is one subject of discussion - the user interface, the versions of the products.</i>  <i>Only the input stream is different.</i>  <i>For programs, these are settings and their inheritance by different versions, for web, they are data pages and their display by different browsers.</i>  <i>Sometimes this data is so similar to the settings that they begin to call it that way, and web pages or widgets are called applications by them.</i> <br><br><h3>  New settings </h3><br>  The times were good when the new version of the program had completely new settings.  Then the question of inheritance simply did not stand.  As in the era of dinosaurs, the new version asks to reinstall everything, or use the default settings.  But heredity as a basic property of developing systems quickly outlived this shortcoming.  Not only data compatibility, but also compatibility with settings has been required from programs.  First, the dinosaurs, and then the chickens began to demand eggs, initiating the question of what had appeared earlier.  Installed a new version - did not lose the previously specified settings, say, window size and font.  But the system of settings from version to version tends to evolve, so one has to take into account the program development, the evolution of life forms.  And yet, the program can be updated to any version, even to an older one, which means that it should correctly use not only any previous settings, but also settings in any future format! <br><br>  For example, in the system of tags and attributes of HTML, XML there is a rule: if a new attribute or tag is encountered, it is ignored (its meaning is unknown).  Obviously, it is logical in the system of settings <b>when new ones appear - to ignore them</b> .  So, in the HTML pages, and even earlier - in the program settings for different versions of the same program, they introduced the very first and simple compatibility rule. <br><br><h3>  Interpretation of available settings </h3><br>  However, even with the same settings, the program may (by mistake) begin to interpret some setting differently.  If the programs are from different manufacturers who receive the same data from the user, they can interpret the data in several different senses.  For example, for some, the screen size takes into account the first monitor, while others have the maximum measurement from the group of all connected monitors.  If we again turn to the analogy with HTML, then this is known in HTML as the problem of compatibility of data representations in browsers.  Even identical data (tables, input fields) cause a slightly different display of results. <br><br>  There is a problem - they took up her decision.  Now there is a ‚Äúcompatible‚Äù view, but there is a strict one.  With a large number of browser versions, the number of strict views grows, and compatible ones grow even faster (squared), because  Each browser and version will have its own idea of ‚Äã‚Äãcompatibility. <br><br>  If we took this approach for compatibility of settings in programs, then we would need to write rules for transferring settings between versions.  Because the installation of versions does not always occur sequentially.  There are jumps over versions, there are returns to the previous ones (for example, due to the bugs of new versions).  It is clear that this process, even if it is started at the level of 2-3 versions of the program, will quickly get bored by the developers, and they will start to support only the most current compatibility - the transition from the old version to the new one. <br><br>  <b>Adhering to a single line of conduct is the best means of building the Tower of Babel.</b> <br><br><h3>  The disappearance of the old settings or some of their values </h3><br>  If in the new version of the program (or even with a new launch), the values ‚Äã‚Äãset in the settings were no longer supported, the program should respond adequately to this. <br><br>  For example, in the same era of dinosaurs, all (or many) programs believed that they should appear in the middle of the screen and occupy about 50% of the screen width.  If the user decides to change the position and size of the window, it was not at all necessary that the next time the program opens the window in a new location.  Why is that? <br><br><img align="left" src="https://habrastorage.org/getpro/habr/post_images/fc8/989/8b1/fc89898b19a33b162189b3c194081980.jpg">  If the program remembers the position and size of the window, then another time it may easily be out of the screen if you change the monitor.  Support for the program is complicated, and evolution has not always supported complex life forms.  Seeing the monitor and the environment is a long procedure that, in an undeveloped API, created hell for the developer, and they (or these ideas from them) died out, even without giving offspring - the programs working in this key.  Programs could be extremely difficult, but have a primitive interface, because each additional action on a working program could give a series of bugs and the need for a new testing cycle. <br><br>  But years went by, and with the advent of more advanced APIs and development environments, the developers gained strength and confidence in the future.  <s>The dinosaurs were overgrown with feathers and began to fly.</s>  Now it‚Äôs quite realistic to see that if the program took an unacceptable value from the settings, it will not be bent in agony and will not be swept away by the ruthless hand <s>of the</s> user's <s>nature</s> , but will act rationally. <br><br>  Reasonable alternatives: <br>  1) select the nearest similar value; <br>  2) select the default value; <br>  3) to offer a choice of a complex of related values, since changing a parameter sometimes requires changing others. <br><br>  <b>A reasonable program reacts to an invalid value for this version</b> . <br><br><h3>  Change the semantics of customization </h3><br>  This is the most difficult case of the program tangling its previous settings.  If the control of settings is based on the transfer of the name + value of each setting, then the distortion of the meaning (that is, the actions of the program) of the value will lead to an uncontrollable change in the behavior of the program. <br><br>  For example, earlier 1 is to open in full screen, now in a large window. <br>  The understanding of the default setting has changed, and default values ‚Äã‚Äãare not stored in the settings file.  Obviously, the presence of such changes in meaning will lead to errors and will require correction. <br><br>  Thus, as browsers tend to call white white (though not always, for example, the page's background is customized), so the program tends to see in the settings what they have in mind.  (If some windowWidth variable indicated the width of the window, there is no point in the new version of it indicating the number of employees in the enterprise.) <br><br>  Not everyone is doing so frankly.  Here is an (hypothetical) example of a very secretive change in meaning.  To version N, the width of the window in the OS was considered by the developers along the inner border of the window, and from the Nth it was decided that it would be more correct to count along with the border.  And then, if the user previously set the width to 100 in previous versions, in the Nth he will receive an internal width (still meaning) of 98, 96, or another, depending on the OS settings.  In the place of the developers, if you need to enter a different width, you need to choose a different name (name, key in the settings).  And the former, as unnecessary, can be permanently deleted (or leave the conversion procedure, only for version compatibility). <br><br>  <b>Changing the semantics of setting values ‚Äã‚Äãshould be considered as a developer error.</b> <br><br><h3>  Change of default value </h3><br>  The most innocent case of the resulting disruption. <br><br>  For example, there are 2 checkboxes, both selected.  The first checkbox was cleared by the user, the second was arranged by him (and if he had not been selected, the user would have chosen it, because he wants values, 0, 1).  In the next version, the manufacturer dropped both checkboxes.  The user in the saved settings has only the choice of the first: 0, X, where X means giving the choice to the manufacturer.  And it has a problem, because the interface did not have and there is no possibility to fix the default value of the second checkbox. <br><br>  The result is a different system of settings for different users.  Everything is in order with the passive and problems for active, not able to fix the choice of default settings.  (This is followed by the recommendations of professionals in related fields - CSS, for example - take into account the actions of attributes by default, writing them explicitly (CSS reset), so that if the default policy is changed, no other understanding of attributes arises in the future.) <br><br>  The way out is to give the ability to fix the setting, even if it is in the default value.  In other words, the user will express a clear desire to set this value, and not passive consent to the manufacturer‚Äôs settings (recommendation).  Consequently, we can not, as is usually done, not give the opportunity to specify the fixation of user settings in the same value in which it is now.  <i>(This was the thinnest moment, the system crash without fixing the default settings, which made the problems to be disassembled.)</i> <br><br>  In voting systems, if someone has already voted the same way as the user, it does not mean at all that the user cannot vote as well.  Similarly - in the settings.  <b>‚ÄúFacilitating‚Äù the choice of the default setting without the possibility of confirmation, fixing it in the interface is a ‚Äúdisservice‚Äù and a source of problems.</b>  With fixation - the balance of the manufacturer's recommendation and the user's choice is observed. <br><br>  In our case with checkboxes, you need not only to give changes to the settings, but also to indicate the fixation of each.  For the optimality of the process, if the user has changed something, this already means fixation.  But now it must be able to remove it - to return to the default value, again, for each setting.  Similarly, to return to the choice of another authoritative user, if the system supports more than one settings profile, but imports other authoring settings as well. <br><br>  Further, the manufacturer makes the change of settings for a reason, so it is useful to know about it, in an unobtrusive mode.  If the user is interested in the settings, he should see what is new with what happened to them since his last entry into the settings.  If he came in for the first time, nothing stands out, everything is new.  If something has changed or fixed before, and the manufacturer has changed his recommendation, the user will see the change.  <b>The developer provides an indication of the change of default settings</b> . <br><br>  The question smoothly approaches the system of help, tips, information and selection of recommendations.  A place to notify you of changes to settings is also the best place to describe the settings in general or to give hints on them. <br><br>  Consequently, the interface for selecting a setting is cluttered with 2 elements: fixation / unlocking of the fixation and a hint both on the change history and the description of the setting in general. <br><br>  Like this (the controls are just listed): <br><pre><code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[0]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> _1 (?) _<span class="hljs-selector-tag"><span class="hljs-selector-tag">fix_</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[1]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> _2 (?) _<span class="hljs-selector-tag"><span class="hljs-selector-tag">unfix_</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[__]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> _3 (?) _<span class="hljs-selector-tag"><span class="hljs-selector-tag">fix_</span></span></code> </pre> <br>  In square brackets - the value of the checkbox;  question marks - tips;  The color of the questions may indicate that the system has something to say about the changes.  ‚ÄúFix / unfix‚Äù badges - links to fixing defaults or return to them.  If there are several recommenders, fixation icons become more complicated.  You can have in a series of settings - an indication of the users who chose this setting (how many and with what status), and among them - the value of the developer settings.  With this approach, settings begin to resemble social network ratings.  Well, maybe this is one of the options for collective use of programs. <br><br>  If there is no fixing mechanism, we have interface and logic problems.  However, in the checkbox interfaces in the OS, this problem was solved by going through 3 states: 0, 1, default.  In HTML, it can also be solved by using disabled and looping through JS.  Then, at least, the check / radio buttons will not require the fix / unfix element. <br><br><h3>  What if the work of the new version did not suit? </h3><br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/92e/957/06c/92e95706cd0c213fa433348bdc4b521a.jpg">  In this case, obviously, a rollback to the latest version is required.  However, some data may remain new (usually from the subject area), and program settings should be taken from the old settings, but some of the new settings may also be useful and saved as a recommendation for old or for a new stable version. <br><br>  ... The second time the word "recommendation" appeared.  This is unusual for settings.  There is a ‚Äúdefault value‚Äù as a developer‚Äôs recommendation, there is (sometimes) a reset to the default values, but there are no recommendations.  There is an import of settings, but then all settings will take on new values, and can only be compared with what was before the shift.  A recommendation is an opportunity to try to change the setting or their group and immediately see and compare the result. <br><br>  The idea of ‚Äã‚Äãrecommending and comparing is very powerful.  (By the way, evolution worked in the era of dinosaurs as well.) A number of store sites try to provide the most convenient products for comparison.  This is the same selection recommendation as a recommendation to set some customization.  Therefore, if we are able to show in the program the implications of the recommendation of the setting, the prospects will open to do a lot more and unexpectedly useful with the same tool. <br><br>  Let's go back to the rollback version.  To make a full rollback, the program should not unconditionally forget the old settings.  It is better <b>if she remembers the last step of the program version change</b> .  If the user did not have time to try out all the capabilities of the previous versions - let him remember the previous steps.  Then he will be able to identify the latest correctly working version.  Obviously, this will be useful for development and testing.  In the era of the dinosaurs, this has not happened ... <br><br><h3>  Reasonable Interface Restriction </h3><br>  True, I would not want to complicate the choice of settings so that to operate with several sets at once.  This is good for professional testers and other developers, but there is a task to make a mass control, therefore it is better if it is as simple and flexible as possible.  Usually, <b>flexibility is achieved by exporting and importing settings</b> .  With it, a user in a separate place outside the program can implement any system for cataloging and storing versions, which again, is difficult.  In addition to an omnipotent export system, it would be good to have a simple subsystem that does not require exporting as much as possible. <br><br>  Let's try <b>to keep not 1 list of settings, but 1 or 2</b> , relating, for example, to the current version and to the previous one.  Or the current version and experimental.  Then in the management interface we need to have only one button (like in calculators, the ‚ÄúM‚Äù (memory) button) to switch between our settings and not be confused in them, not to enter names and not to build a ‚Äúmanager‚Äù.  For all that is more, export is available.  This fundamental simplification of the interface will hopefully allow us to build a practical model and remain as intuitive as the ‚ÄúM‚Äù button. <br><br>  The starting point of such an idea is that most of the actions, including checking the new version and rolling back to the old one, do not require operating with more than 2 lists of settings.  Checking someone's recommendations with the storage of one "set" of their settings - too.  Next, we describe the technical implementation. <br><br>  Storing settings means placing them in localStorage to use within the browser, regardless of reloads.  In addition to the stored sets, you can temporarily test other settings without affecting the stored ones.  Saving is done by clicking the "Save" button or downloading a new version of the program.  You can roll back without using new settings (default) or using (specified when rolling back).  Switch to an arbitrary other version - with a choice of the same two.  New settings are selected if the version number is more than the version version of the new set.  If 2 sets are the same, it is still considered that there are two.  They are stored as differences, therefore, the smaller the differences, the less space is occupied.  The current settings are stored as the difference between the manufacturer's recommendations and the user choice.  The difference is understood as an indication of the setting if it is selected by the user (even if it is the same as the default) and if not specified otherwise. <br><br>  There is one more technical point that in the browser it is most simple to implement the reading of the settings at the beginning of the page loading, and then consider them constants.  The process of changing the settings requires a reboot, so some testing requires saving a set of settings, and in order to forget the user's settings, you need to store 2 sets and then use the same ‚ÄúReturn‚Äù button to restore. <br><br>  What can we do with 2 lists of settings?  We will collect a complete list. <br>  1. Go <b>to the new version of the program</b> and download the new settings from it.  Old ones will remain for rollback, and new ones - for continuation of work. <br>  2. If rollback is performed, the <b>data of the new settings are saved</b> in the second set, if the user has changed them.  When re-moving to the same or a newer version, the accumulated one is used. <br>  3. <b>Saving another recommendation</b> (import - save) erases the data for rollback, so that the settings of another recommendation can be explored after restarting the browser. <br>  4. <b>Testing other settings</b> (settings - test - save), which can be continued after restarting the browser and after reloading the page. <br><br>  Nothing prevents testing the settings without saving them, but then we are limited by the time limits until the page reloads.  So you can test the most simple and immediately effective settings.  Most of the settings set their values ‚Äã‚Äãin the program just at the beginning of the page loading, so they cannot be tested without saving to localStorage.  The mechanism of saving 2 sets of settings allows testing without such restrictions, which creates a good addition to the capabilities of scripts. <br><br><h3>  Why so much attention to the amount of data and their limitations? </h3><br>  Because, on the one hand, there is a desire for simplicity and clarity of settings.  The smaller the entity, the better.  The simplest thing is to have one set of settings - ‚Äúmy‚Äù.  For a minimum of manipulation, the settings ‚Äúother‚Äù are entered and the only button to switch ‚ÄúReturn‚Äù.  Confusing is difficult, but adds features.  There is another side to the question. <br><br>  It would seem that the difficult thing is to transfer the settings to the server in the database, and there it is no matter how difficult to work with them: store for each version, review the history?  Here we come to a couple of other entities of our task.  The first is to store the settings regardless of authorization on the server.  Without authorization or for another task - as user preferences on the client, where authorization is also not intended.  The second essence of the statement is that storing the settings in text form for export implies the most compact form of storage, so you need to have the shortest and manually editable string.  Therefore, there are 2 sets, and only the differences of settings are stored so that there is less data. <br><br><h3>  Interface switching settings </h3><br><img align="left" src="https://habrastorage.org/getpro/habr/post_images/cf3/274/4ee/cf32744ee11929a2201fcdbea850b6d8.jpg">  This section requires a separate article and another blog.  What we did before is called ‚ÄúProgram Architecture‚Äù, but there is no such blog, there is only the ‚ÄúArchitecture‚Äù tag.  To make the description complete, let us describe the results briefly, in words, without illustrations, and we will take the details to another article  It turned out, as usual in text descriptions of interfaces - boring, hard to read <b>and intended only for those who are engaged in similar</b> and want to compare the results. <br><br>  At the beginning, without any special actions, the user does not receive any additional elements in the interface anywhere, until he starts to try to change the settings.  There is even no (or not activated) ‚ÄúExport‚Äù button, because exporting an empty line is, by default, accepting the manufacturer‚Äôs settings. <br><br>  There is a button (or input field) " <b>Import</b> ", which through the input field we load a string JSON or something similar to change the settings.  Immediately we see the reflection of these settings in the settings interface, the name of the recommender, the version of the settings + the version of the program for which they were made.  There is nothing unusual if we load the settings of an arbitrary version into another version of the program (old or new).  Those whose keys can be found in the current version of the program will work.  The test buttons " <b>Test</b> " and " <b>Cancel</b> " appear.  The second restores the viewing of its settings and does nothing, and the first saves the uploaded imported version as up-to-date, and the backup as current, erasing any other backup version if it was (single-level stack). <br><br>  The presence of the saved backup version is marked in the settings panel.  Therefore, as soon as we press "Test", the information on the saved version of the user will appear on the " <b>Return</b> " button, which will come in (it may not be if the user settings were not, but the "test" mode still turns on).  A constantly hanging link to the ‚Äú <b>test</b> ‚Äù settings box appears in the page interface (as a reminder of incoming mail). <br><br>  When you click on ‚ÄúReturn‚Äù, you get the settings returned for the program (usually activated after the page is reloaded), and in the settings panel - the settings for the test and the ‚ÄúTest‚Äù - ‚ÄúCancel‚Äù button are the previous operation step. <br><br>  If a <b>new version of a script</b> (program) is being <b>loaded</b> , as noted by localStorage analysis, it acts on the state of the settings in the same way if they were changed.  A copy of the old settings is created and ... similarly to the ‚Äútest‚Äù, the ‚Äú <b>new version</b> ‚Äù notifier appears.  If you do not do this, changing the program‚Äôs behavior will be puzzling to the user.  This raises the question whether to show this button to everyone or only to those who are interested.  Most likely, the second, and for all - the notifier hides in the settings panel. <br><br>  If the version is changed repeatedly, nothing really changes, only the value of the new version of the script (and the new settings).  If the user has changed the settings for the new version, the " <b>Save</b> " button appears, on clicking on which <b>2 groups of settings appear</b> : to the new version and to the old one.  ‚ÄúReturn‚Äù will cause a version rotation: the word ‚ÄúReturn‚Äù will change to ‚Äú <b>Apply new</b> ‚Äù to switch to the new settings again, as in the ‚ÄúTest‚Äù case.  To return to the old program, you need to press the appeared button " <b>Rollback</b> ", which will occur on the version whose number is remembered at the last edit of the old settings.  (This mechanism requires access to any released version.) To switch to other versions, a drop-down list of numbers. <br><br>  If the user has changed the set of settings again, when 2 sets have been saved, but the 3rd version of the program is available, there will be no new saving in the stack, only the current group will change (after clicking ‚ÄúSave‚Äù). <br><br>  The " <b>Confirm settings</b> " button - to refuse to store the memorized state - rollback, remaining on the new version (the "new version" icon is deleted).  If the state is one, the button is called ‚ÄúErase settings‚Äù or ‚Äú <b>Reset</b> ‚Äù, and the memory is cleared of the settings, the default settings are used.  "Reset" is protected from accidental pressing. <br><br>  Given the <b>restriction of the number of sets of settings to two</b> , any test action will erase the rollback settings and will not restore them at the end of the test.  In order not to lose them, use the <b>export</b> button, which is activated when there is any custom setting. <br><br>  Let us list again the list of buttons and notifiers and their grouping: <br>  * Import, Export - for making-retrieving settings as a string; <br>  * Test, Cancel - apply settings, cancel import display in settings; <br>  * "Test" - the notifier, prompting that the settings are in test mode; <br>  * Return - restore your settings, exit the test; <br>  * ‚ÄúNew version‚Äù - a notifier that speaks about downloading a new version (in the settings panel); <br>  * Rollback - the analogue of ‚ÄúReturn‚Äù to roll back to the previous version; <br>  * combo or list of versions - which version will be rolled back; <br>  * Save, Cancel - confirm the change of settings from the user;  similar to ‚ÄúTest‚Äù, but without notification; <br>  * Confirm settings (instead of ‚ÄúReturn‚Äù) or Reset - deleting stored settings, applying current (or default) settings, removing the ‚Äúnew version‚Äù notifier; <br>  * Apply new - after a rollback - go back to the new version of the settings. <br><br>  <i>In the next series we will try to see all this live, but it is quite possible that this will not work in the script yet, and nobody will need to write an article with a drawing of the interface - programming goes without layouts.</i>  <i>Then wait for the public script with the described mechanisms as a demonstration.</i> <br><br><h3>  Results </h3><br>  An interface for working with settings without technological flaws was obtained, which could be without taking into account the development of the program when changing versions.  The concept of ‚Äúrecommendation‚Äù has been introduced, and it is possible to work with several recommendations and with a settings format compatible with the version of the program in any direction - working with both new versions (for upgrades) and old ones (for kickbacks). </div><p>Source: <a href="https://habr.com/ru/post/133989/">https://habr.com/ru/post/133989/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133982/index.html">Habrahabr - winner ROTOR 2011</a></li>
<li><a href="../133983/index.html">Impressive Solids: making a game in C # under OpenGL, part I</a></li>
<li><a href="../133984/index.html">Setting up a proxy on the firmware Tomato</a></li>
<li><a href="../133987/index.html">Choosing a distributed file system for Linux. A few words about Ceph and the rest</a></li>
<li><a href="../133988/index.html">Gingerbread holds 50.51% of the market for Android smartphones</a></li>
<li><a href="../133990/index.html">OpenOffice COM Automation: Reading Clipboard Content</a></li>
<li><a href="../133991/index.html">US court rejected Apple‚Äôs claim against Samsung</a></li>
<li><a href="../133992/index.html">Droider Show # 18. "Apple" is not passed!</a></li>
<li><a href="../133993/index.html">Filling Bitrix through internal integration mechanisms with 1C without 1C</a></li>
<li><a href="../133994/index.html">Creating a PostgreSQL Load Tester</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>