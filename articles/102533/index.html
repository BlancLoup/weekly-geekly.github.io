<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple test llvm / libjit part III, now also parrot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is a continuation of the articles: 
 Simple test libjit vs llvm 
 A simple llvm / libjit part II test, the same + gnu lightning . 

 Intr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple test llvm / libjit part III, now also parrot</h1><div class="post__text post__text-html js-mediator-article">  This article is a continuation of the articles: <br>  <a href="http://odobenusrosmarus.habrahabr.ru/blog/99786/">Simple test libjit vs llvm</a> <br>  <a href="http://odobenusrosmarus.habrahabr.ru/blog/101769/">A simple llvm / libjit part II test, the same + gnu lightning</a> . <br><br><h4>  Introductory curtsy </h4><br><br>  In previous articles, the performance of llvm, libjit and gnu lightning was examined using the example of the sieve of eratosthenes.  All of the options considered are low-level libraries that have a good rate of fire, but are essentially specialized assemblers, and, for example, you will have to implement work with strings yourself. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There are other virtual machines that you can include in your program as a backend for your <a href="http://en.wikipedia.org/wiki/Domain-specific_language">DSL</a> .  For example - born as a result of <a href="http://www.perl.com/pub/2001/04/01/parrot.htm">April Fool's joke</a> - <a href="http://parrot.org/">parrot</a> is the basis of the future pearl. <br><br>  There, the possibilities are much greater, including strings, hash tables, dimensionless arrays, garbage collection, console and file I / O, and other nice things.  The question is - what is the price (in performance loss) for all these nice additions? <br><br>  Let's try. <br><a name="habracut"></a><br><h5>  Eratosthene sieve on parrot </h5><br><br>  As before - these are two procedures, one of them (erato) is implemented by the algorithm itself, the second (main) runs 100_000 times erato to search for prime numbers from 1 to 50_000. <br><br> <code>.loadlib 'trans_ops' <br> .loadlib 'math_ops' <br> <br> .sub 'erato' <br> .param int n <br> $P0 = new 'ResizableIntegerArray' # a = P0 <br> $P0 = n <br> $N0 = sqrt n # q = I0 <br> $I0 = floor $N0 # i = I1 <br> $I1 = 2 <br> for_cond: <br> if $I1 &gt; $I0 goto for_end <br> $I2 = $P0[$I1] <br> if $I2 == 1 goto end_if <br> $I3 = $I1 * $I1 # j = I3 <br> while_cond: <br> if $I3 &gt; n goto while_end <br> $P0[$I3] = 1 <br> $I3 += $I1 <br> goto while_cond <br> while_end: <br> end_if: <br> $I1 += 1 <br> goto for_cond <br> for_end: <br> .end <br> <br> .sub main :main <br> $I10 = 0 <br> for_test1: <br> if $I0&gt;100000 goto for_end1 <br> erato(50000) <br> $I0 += 1 <br> goto for_test1 <br> for_end1: <br> .end <br> <br></code> <br><br>  And - a control program that runs all this: <br><br><blockquote> <code><font color="gray">001</font> : <font color="#BC7A00">#include &lt;parrot/embed.h&gt; <br> <font color="gray">002:</font> #include &lt;parrot/extend.h&gt; <br> <font color="gray">003:</font></font> <br> <font color="gray">004:</font> <font color="#B00040">int</font> <font color="#0000FF">main</font> ( <font color="#B00040">int</font> argc, <font color="#B00040">char</font> <font color="#666666">*</font> argv[]) <br> <font color="gray">005:</font> { <br> <font color="gray">006:</font> Parrot_Interp interp; <br> <font color="gray">007:</font> Parrot_PackFile pf; <br> <font color="gray">008:</font> <br> <font color="gray">009:</font> interp <font color="#666666">=</font> Parrot_new( <font color="#008000">NULL</font> ); <br> <font color="gray">010:</font> <font color="#008000"><strong>if</strong></font> ( <font color="#666666">!</font> interp) { <br> <font color="gray">011:</font> <font color="#008000"><strong>return</strong></font> <font color="#666666">1</font> ; <br> <font color="gray">012:</font> } <br> <font color="gray">013:</font> <br> <font color="gray">014:</font> pf <font color="#666666">=</font> Parrot_pbc_read(interp, <font color="#BA2121">"erato.pbc"</font> , <font color="#666666">0</font> ); <br> <font color="gray">015:</font> Parrot_pbc_load(interp, pf); <br> <font color="gray">016:</font> Parrot_runcode(interp, argc, argv); <br> <font color="gray">017:</font> <br> <font color="gray">018:</font> Parrot_destroy(interp); <br> <font color="gray">019:</font> <br> <font color="gray">020:</font> <font color="#008000"><strong>return</strong></font> <font color="#666666">0</font> ; <br> <font color="gray">021:</font> } <br> <font color="gray">022:</font></code> </blockquote> <br><br>  So, compile a new version: <br> <code>parrot -o erato.pbc erato.ptr <br> gcc -O2 erato.c -I /usr/include/parrot/2.0.0/ -lparrot -o erato <br></code> <br>  And launch: <br> <code>/usr/bin/time -f "%U" ./erato <br> 2361.2 <br></code> <br><h4>  Products and fruits of the author's movement of thought </h4><br>  Total, our table takes the form: <br><br><table border="1"><tbody><tr><th>  VM </th><th>  Runtime in seconds, (less = better) </th></tr><tr><th>  Llvm </th><td>  13.77 </td></tr><tr><th>  LIBJIT </th><td>  14.17 </td></tr><tr><th>  GNU LIGHTNING </th><td>  32.59 </td></tr><tr><th>  PARROT </th><td>  2361 </td></tr><tr><td colspan="2">  And just for information: </td></tr><tr><th>  gcc -O0 </th><td>  50.09 </td></tr><tr><th>  gcc -O1 </th><td>  13.79 </td></tr><tr><th>  similar perl program </th><td>  4288 </td></tr></tbody></table><br><br>  That is, the parrot virtual machine runs on our example 150 times slower than the jit of the machine.  But 2 times faster than the program on the pearl.  This is actually good news, it looks like the following versions of the pearl, based on parrot, are going to work faster than today ... However, parrot is clearly not a replacement for the other machines considered if speed is needed. <br><br><h4>  Final chord </h4><br><br>  In general, parrot left a very pleasant impression, everything works as described, there were no pitfalls, opportunities ‚Äî the sea, and the documentation is good.  Write on it after llvm - a pleasure.  So <i>for myself,</i> I made up the following recommendations: <br><br><ul><li>  need speed - llvm or libjit, llvm is preferable (better infrastructure, more tools) </li><li>  constrained conditions, such as low memory and disk space ‚Äî gnu lightning; </li><li>  if speed is not too important, but you need convenience, working with strings or complex structures - parrot </li></ul></div><p>Source: <a href="https://habr.com/ru/post/102533/">https://habr.com/ru/post/102533/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../102527/index.html">Broken links - some statistics</a></li>
<li><a href="../102528/index.html">How to make a cloud (cluster) hosting for a couple of kopecks *</a></li>
<li><a href="../102529/index.html">Will Facebook be the first to switch to ARM servers?</a></li>
<li><a href="../102531/index.html">Impressions of Gamescom 2010</a></li>
<li><a href="../102532/index.html">NoSQL collection point</a></li>
<li><a href="../102535/index.html">Twitter + Google Images</a></li>
<li><a href="../102536/index.html">Sixteen of thirty relatively new and free fonts</a></li>
<li><a href="../102537/index.html">Opera Widget - OpenBoobs Reader</a></li>
<li><a href="../102539/index.html">Draganflyer X8 - the dream of any spy</a></li>
<li><a href="../102540/index.html">Live Migration in geographically separated data centers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>