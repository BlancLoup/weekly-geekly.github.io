<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Frame object in Python. What can and cannot be done with it (in production and in another decent place)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About Python on Habr√© there were many good articles. Both about features of implementation, and about the applied features which are absent in other m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Frame object in Python. What can and cannot be done with it (in production and in another decent place)</h1><div class="post__text post__text-html js-mediator-article">  About Python on Habr√© there were many good articles.  Both about features of implementation, and about the applied features which are absent in other mainstream languages.  However, I was surprised to find (correct, if not right) that there is one important topic that has not been disclosed either on Habr√© or on the Russian-language Internet in general.  This article will focus on the stack frame.  Most likely, it will not say anything, well, or, perhaps, taking into account the last point, almost nothing new to experienced python developers, but it will be useful for beginners (and maybe harmful, but all the examples are below). <br><br>  I tried to write an article so that it would be convenient to read it by opening parallel repl and <s>thoughtlessly copying the code there by</s> experimenting.  Therefore, whenever possible, most of the examples have the form of "one-liners in the interpreter". <br><br>  We will start a little from a distance, with the fact that we note that Traceback is also an object, and then we will find where the stack frame is and get down to business. <br><a name="habracut"></a><br><pre><code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests &gt;&gt;&gt; requests.get(<span class="hljs-number"><span class="hljs-number">42</span></span>) Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; File <span class="hljs-string"><span class="hljs-string">"/usr/lib/python3/dist-packages/requests/api.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> get <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request(<span class="hljs-string"><span class="hljs-string">'get'</span></span>, url, **kwargs) File <span class="hljs-string"><span class="hljs-string">"/usr/lib/python3/dist-packages/requests/api.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">44</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> request <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> session.request(method=method, url=url, **kwargs) File <span class="hljs-string"><span class="hljs-string">"/usr/lib/python3/dist-packages/requests/sessions.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">421</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> request prep = self.prepare_request(req) File <span class="hljs-string"><span class="hljs-string">"/usr/lib/python3/dist-packages/requests/sessions.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">359</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> prepare_request hooks=merge_hooks(request.hooks, self.hooks), File <span class="hljs-string"><span class="hljs-string">"/usr/lib/python3/dist-packages/requests/models.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">287</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> prepare self.prepare_url(url, params) File <span class="hljs-string"><span class="hljs-string">"/usr/lib/python3/dist-packages/requests/models.py"</span></span>, line <span class="hljs-number"><span class="hljs-number">338</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> prepare_url <span class="hljs-string"><span class="hljs-string">"Perhaps you meant http://{0}?"</span></span>.format(url)) requests.exceptions.MissingSchema: Invalid URL <span class="hljs-string"><span class="hljs-string">'42'</span></span>: No schema supplied. Perhaps you meant http://<span class="hljs-number"><span class="hljs-number">42</span></span>?</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Above, we see Traceback, which contains a chain of calls to various functions. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys &gt;&gt;&gt; sys.last_traceback &lt;traceback object at <span class="hljs-number"><span class="hljs-number">0x7f8c37378608</span></span>&gt;</code> </pre><br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>dir(sys.last_traceback) [<span class="hljs-string"><span class="hljs-string">'tb_frame'</span></span>, <span class="hljs-string"><span class="hljs-string">'tb_lasti'</span></span>, <span class="hljs-string"><span class="hljs-string">'tb_lineno'</span></span>, <span class="hljs-string"><span class="hljs-string">'tb_next'</span></span>]</code> </pre><br><br>  So, above we see an object containing the last unhandled exception.  It can be investigated using the debager to see what happened.  You can also use the Traceback module.  I will not dwell on this, it is somewhat off topic. <br><br>  We will be interested in the tb_frame attribute.  This is actually the stack frame.  Its essence is not fundamentally different from that in C. When a function is called, its arguments go on the stack, after which it is already being executed. <br><br>  However, there are two fundamental differences from C. <br><br>  Firstly, due to the fact that Python is an interpretable language, the stack frame is stored in it explicitly, and secondly, due to the fact that it is object-oriented, it is also an object. <br><br>  In fact, this is the main source of introspection in Python ‚Äî the inspect module is in part just a wrapper around it.  (and partly over other functions from sys). <br><br>  A detailed description of all the attributes of the object can be read in another place, so we turn to examples of application. <br><br><h4>  0) How to get a link to the stack frame </h4><br>  Of course, you can get it from the traceback.  But fortunately there are more ways to work with it than to throw exceptions and watch the traceback / <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>sys._getframe() &lt;frame object at <span class="hljs-number"><span class="hljs-number">0x7fda9bffa388</span></span>&gt;</code> </pre><br>  Returns the current object from the call stack.  You can also pass a depth to it as a parameter to get an object that is higher on the stack.  However, this can be done using the f_back attribute. <br><br>  Unfortunately, if we run repl, we are on top of the stack, so when we call sys._getframe (). F_back, it returns None, and sys._getframe (1) does throw an exception. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>sys._getframe().f_back &gt;&gt;&gt; sys._getframe(<span class="hljs-number"><span class="hljs-number">1</span></span>) Traceback (most recent call last): File <span class="hljs-string"><span class="hljs-string">"&lt;stdin&gt;"</span></span>, line <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &lt;module&gt; ValueError: call stack <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> deep enough</code> </pre><br>  However, the lambda functions will solve this problem: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: sys._getframe().f_back == sys._getframe(<span class="hljs-number"><span class="hljs-number">1</span></span>))() <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>   (   ) &gt;&gt;&gt; (<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: sys._getframe().f_back <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> sys._getframe(<span class="hljs-number"><span class="hljs-number">1</span></span>))() <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre><br>  There is also sys._current_frames (), but it makes sense in the case of multithreading.  It will not be mentioned further, but for completeness: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> threading &gt;&gt;&gt; sys._current_frames() {<span class="hljs-number"><span class="hljs-number">140576946280256</span></span>: &lt;frame object at <span class="hljs-number"><span class="hljs-number">0x7fda9bffa6c8</span></span>&gt;} &gt;&gt;&gt; threading.Thread(target=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: print(sys._current_frames())).start() {<span class="hljs-number"><span class="hljs-number">140576883275520</span></span>: &lt;frame object at <span class="hljs-number"><span class="hljs-number">0x7fda9b337048</span></span>&gt;, <span class="hljs-number"><span class="hljs-number">140576946280256</span></span>: &lt;frame object at <span class="hljs-number"><span class="hljs-number">0x228fbc8</span></span>&gt;}</code> </pre><br>  Well, it's time to quote the documentation for these functions: <br><blockquote>  This function should be used for internal and specialized purposes only.  It is not guaranteed to exist in all implementations of Python. </blockquote><br><br>  So it is hardly necessary to use for the mercenary purposes what will be lower. <br><br><h4>  1) How to determine who called the function </h4><br>  Such a task can easily emerge during debug, especially when using many third-party and intricate frameworks.  But adherents of black magic can use such a trick and its variations for much less innocuous things. <br><br>  After the last subclause, it should be generally understood how to do this.  In fact, getting the frame in which the function was called is very simple: sys._getframe (1).  The question remains how to extract the necessary information from the frame. <br><br>  For example, like this: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>threading.Thread(target=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: print(sys._getframe(<span class="hljs-number"><span class="hljs-number">1</span></span>).f_code.co_name)).run() run</code> </pre><br>  Discussion Code object is beyond the scope of the article, maybe some other time.  But the frame object has an attribute f_code, which is a code object, among the attributes of which is including the name of the method of the corresponding code object. <br><br>  By the way, in the case of inspect, the same thing happens in fact, but it looks nicer. <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>threading.Thread(target=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: print(inspect.stack()[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">3</span></span>])).run() run</code> </pre><br>  Opportunities to abuse the method obtained by the reader will find himself. <br>  Another example pushing for such ideas: <br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>threading.Thread(target=<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span>: print(<span class="hljs-string"><span class="hljs-string">'called from'</span></span>, sys._getframe(<span class="hljs-number"><span class="hljs-number">1</span></span>).f_globals[<span class="hljs-string"><span class="hljs-string">'__name__'</span></span>])).run() called <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> threading</code> </pre><br>  Now, having received the name of the module, you can find the module in the list of loaded modules by that name, and then take something from there.  And no Hierarchy of Classes will save from such blasphemy (although a good one will probably save from the desire to do this) <br><br><h4>  2) Change the locals of the frame </h4><br>  The information in this sub-note is not too new and should be known to advanced pythonists, but nonetheless. <br><br>  At this point, you will have to move away from one-liners and write a full-fledged example. <br><br>  Suppose we have the following code: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Example</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_noosphere_connection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">'OK'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proof</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(example)</span></span></span><span class="hljs-function">:</span></span> a = <span class="hljs-number"><span class="hljs-number">2</span></span> b = <span class="hljs-number"><span class="hljs-number">2</span></span> example.check_noosphere_connection() print(<span class="hljs-string"><span class="hljs-string">'2 + 2 = {}'</span></span>.format(str(a + b))) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">broken_evil_force</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corrupted_noosphere</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pseudo_self)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">'OK'</span></span>) frame = sys._getframe() frame.f_back.f_locals[<span class="hljs-string"><span class="hljs-string">'a'</span></span>] = <span class="hljs-number"><span class="hljs-number">3</span></span> FakeExample = type(<span class="hljs-string"><span class="hljs-string">'FakeExample'</span></span>, (), {<span class="hljs-string"><span class="hljs-string">'check_noosphere_connection'</span></span>: corrupted_noosphere}) proof(FakeExample())</code> </pre><br><br><pre> <code class="python hljs">% python habr_example.py OK <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span> = <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre><br>  Alas, the locals cannot be changed.  More precisely, it is possible, but this result will not remain globally. <br><br>  Here are two links to this topic, in one of them the author achieves the desired result by modifying the bytecode, and in the other, the source code itself changes and compiles. <br><br>  <a href="http://code.activestate.com/recipes/577283-decorator-to-expose-local-variables-of-a-function-">code.activestate.com/recipes/577283-decorator-to-expose-local-variables-of-a-function-</a> <br>  <a href="http://stackoverflow.com/a/4257352">stackoverflow.com/a/4257352</a> <br><br>  However, there is a way!  <a href="http://pydev.blogspot.ru/2014/02/changing-locals-of-frame-frameflocals.html">pydev.blogspot.ru/2014/02/changing-locals-of-frame-frameflocals.html</a> <br><br>  Calling <i>cctypes.pythonapi.PyFrame_LocalsToFast (ctypes.py_object (frame), ctypes.c_int (0))</i> helps to save changes to locals. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ctypes <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Example</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check_noosphere_connection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">'OK'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proof</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(example)</span></span></span><span class="hljs-function">:</span></span> a = <span class="hljs-number"><span class="hljs-number">2</span></span> b = <span class="hljs-number"><span class="hljs-number">2</span></span> example.check_noosphere_connection() print(<span class="hljs-string"><span class="hljs-string">'2 + 2 = {}'</span></span>.format(str(a + b))) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">broken_evil_force</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corrupted_noosphere</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pseudo_self)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">'OK'</span></span>) frame = sys._getframe() frame.f_back.f_locals[<span class="hljs-string"><span class="hljs-string">'a'</span></span>] = <span class="hljs-number"><span class="hljs-number">3</span></span> FakeExample = type(<span class="hljs-string"><span class="hljs-string">'FakeExample'</span></span>, (), {<span class="hljs-string"><span class="hljs-string">'check_noosphere_connection'</span></span>: corrupted_noosphere}) proof(FakeExample()) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evil_force</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">corrupted_noosphere</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pseudo_self)</span></span></span><span class="hljs-function">:</span></span> print(<span class="hljs-string"><span class="hljs-string">'OK'</span></span>) frame = sys._getframe() frame.f_back.f_locals[<span class="hljs-string"><span class="hljs-string">'a'</span></span>] = <span class="hljs-number"><span class="hljs-number">3</span></span> ctypes.pythonapi.PyFrame_LocalsToFast(ctypes.py_object(frame.f_back), ctypes.c_int(<span class="hljs-number"><span class="hljs-number">0</span></span>)) FakeExample = type(<span class="hljs-string"><span class="hljs-string">'FakeExample'</span></span>, (), {<span class="hljs-string"><span class="hljs-string">'check_noosphere_connection'</span></span>: corrupted_noosphere}) proof(FakeExample()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: broken_evil_force() evil_force()</code> </pre><br>  Run and get: <br><br><pre> <code class="python hljs">% python habr_example.py OK <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span> = <span class="hljs-number"><span class="hljs-number">4</span></span> OK <span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span> = <span class="hljs-number"><span class="hljs-number">5</span></span></code> </pre><br>  On this, perhaps, everything.  Is that I add: in the case of traceback there is an opportunity to walk on the frame not only up, but also down, although it should already be clear. <br><br>  I will be glad to hear comments and observations, as well as interesting examples of the use of frames. <br><br><h4>  Useful links (part was in the article) </h4><br>  1) <a href="https://docs.python.org/3.4/library/sys.html">docs.python.org/3.4/library/sys.html</a> <br>  2) <a href="https://docs.python.org/3/library/inspect.html">docs.python.org/3/library/inspect.html</a> <br>  3) <a href="http://code.activestate.com/recipes/577283-decorator-to-expose-local-variables-of-a-function-">code.activestate.com/recipes/577283-decorator-to-expose-local-variables-of-a-function-</a> <br>  4) <a href="http://stackoverflow.com/questions/4214936/how-can-i-get-the-values-of-the-locals-of-a-function-after-it-has-been-executed/4257352">stackoverflow.com/questions/4214936/how-can-i-get-the-values-of-the-locals-of-a-function-after-it-has-been-executed/4257352#4257352</a> <br>  5) <a href="http://pydev.blogspot.ru/2014/02/changing-locals-of-frame-frameflocals.html">pydev.blogspot.ru/2014/02/changing-locals-of-frame-frameflocals.html</a> </div><p>Source: <a href="https://habr.com/ru/post/255239/">https://habr.com/ru/post/255239/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../255229/index.html">MWC-2015: applicants for the role of 5G and a number of interesting innovations</a></li>
<li><a href="../255231/index.html">Layer caching over Linq to SQL</a></li>
<li><a href="../255233/index.html">14 tips on how to make tabs on the site more convenient</a></li>
<li><a href="../255235/index.html">Available fresh update ReSharper Ultimate</a></li>
<li><a href="../255237/index.html">Details about objects and classes in PHP</a></li>
<li><a href="../255241/index.html">Informer Vkontakte extension for Opera, Chrome and other browsers</a></li>
<li><a href="../255243/index.html">Overview of updates of the Microsoft Azure platform for March 2015. Many Open Source</a></li>
<li><a href="../255245/index.html">Run PHP script on schedule cron. When it's not so clear</a></li>
<li><a href="../255247/index.html">Step-by-step instructions for creating a portlet platform: Portlet description</a></li>
<li><a href="../255251/index.html">Fake certificates for Google domains found</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>