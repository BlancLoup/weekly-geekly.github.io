<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asynchronous loading of javascript files. Acceleration and optimization of the process, increasing productivity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue the cycle of articles on building sites (web applications), focusing on the maximum use of AJAX technology. Often, when sites and applicat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asynchronous loading of javascript files. Acceleration and optimization of the process, increasing productivity</h1><div class="post__text post__text-html js-mediator-article">  We continue the cycle of articles on building sites (web applications), focusing on the maximum use of AJAX technology.  Often, when sites and applications that use <a href="http://en.wikipedia.org/wiki/AHAH">AHAH</a> are used, <a href="http://en.wikipedia.org/wiki/AHAH">it</a> is required to load script files that are not previously used on the site‚Äôs pages along with loaded HTML content.  One of the aspects of processing the content being reloaded by AJAX is the selection of the script files from the resulting content, followed by their application to the current document (DOM).  Fortunately, at the moment almost all the major libraries are able to do it.  However, if you dig deeper into the implementation of the processing process of the loaded scripts, the current situation is completely ‚Äúnot bright‚Äù.  Not all well-known libraries can do this well, much less optimally.  Let's look at this process from the inside, analyze existing problems and find out ways to solve them. <br><a name="habracut"></a><br>  For ease of understanding, we will consider a complex example in which, using AJAX, we will load an additional page into the start page, in which, in turn, there are links to script files. <br><br>  So, in the start page we will load an additional page test1.html, the text of which is shown below. <br><blockquote><code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">script</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/javascript"</font> <font color="#ff0000">src</font> <font color="#0000ff">="test1.js"</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font> <br> &lt;script type= <font color="#A31515">"text/javascript"</font> src= <font color="#A31515">"test2.js"</font> &gt; <font color="#0000ff">&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">link</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/css"</font> <font color="#ff0000">rel</font> <font color="#0000ff">="stylesheet"</font> <font color="#ff0000">href</font> <font color="#0000ff">="test.css"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> Hello Bingo! <br> <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font></font> <br></code> </blockquote><br>  Download this page using the well-known jQuery library.  The jquery1.html start page text is shown below. <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">script</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/javascript"</font> <font color="#ff0000">src</font> <font color="#0000ff">="test1.js"</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font> <br> &lt;script type= <font color="#A31515">"text/javascript"</font> src= <font color="#A31515">"jquery-1.2.6.js"</font> &gt;&lt;/script&gt; <br> &lt;/head&gt; <br> &lt;body&gt; <br> &lt;div id= <font color="#A31515">"content1"</font> &gt;&lt;/div&gt; <br> &lt;div id= <font color="#A31515">"content2"</font> &gt;&lt;/div&gt; <br> &lt;script type= <font color="#A31515">"text/javascript"</font> &gt; <br> $( <font color="#0000ff">function</font> (){ <br> $( <font color="#A31515">'#content1'</font> ).load( <font color="#A31515">'test1.html'</font> ) <br> $( <font color="#A31515">'#content2'</font> ).load( <font color="#A31515">'test1.html'</font> ) <br> }) <br> <font color="#0000ff">&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font></font> <br></code> </blockquote><br><br>  To identify problem areas, load the additional page twice into the content1 and content2 blocks, respectively. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The <a href="http://getfirebug.com/">firebug</a> console will show us something like <br><br>  GET test1.html <br>  GET test1.html <br>  GET test1.js? _ = 1239115065471 <br>  GET test2.js? _ = 1239115067323 <br>  GET test1.js? _ = 1239115068456 <br>  GET test2.js? _ = 1239115069347 <br><br>  As you can see, jQuery, with asynchronous loading of content, adds a prefix of _ = 1239115067323 to the addresses of scripts, so that the script is not cached.  Thus, when using jQuery, the browser each time will load the same script on different pages again, on a full cycle, without using the cache.  The question is ‚ÄúWhy?‚Äù The probability that for different pages the same script (with the same address) will be different almost = 0. Accordingly, the process of loading the scripts is clearly not well thought out.  However, the purpose of the article is not to criticize the work of jQuery.  Similarly, with other libraries.  The purpose of the article is to understand the principles and ways of the possible optimization of the process of asynchronous loading of scripts. <br><br>  In this article, for simpler presentation and understanding of the material, regarding ways and options for optimizing asynchronous script loading, the implementation of the optimization of the process in the Fullajax library will be described. <br><br><h3>  Optimization step 1 - Start at the pier </h3><br>  <b>Why download what is already in memory and loaded on the start page?</b> <br><br>  Note that test1.js script is already connected on the start page, i.e.  he is already in memory.  Accordingly, it is quite easy to get its contents without any additional data download from the server.  Thus, the first thing we do is check whether the script is already loaded (connected) to the page in a standard way?  If yes, just get its content and execute it.  By performing the specified simple operation, relative to our example, we immediately get rid of 2 extra requests to the server. <br><br><h3>  Optimization Step 2 - Repetition Mother of Torment </h3><br>  <b>Why re-download what has already been uploaded once?</b> <br><br>  Let's look again at the firebug console.  Pay attention to the order and the number of script downloads using jQuery.  The script test1.js and test2.js are loaded twice each!  We figured out the test1.js script in the previous step.  Now we optimize loading of the second script.  The test2.js script is enough to load once (for the first time), put its content "by the cheek" (into the software cache) and all subsequent times get it from there, and not from the server.  Thus, with respect to our example, we get rid of one extra script load and, accordingly, an extra server request. <br><br>  In sum, on a simple example, we have a ‚Äúconcrete‚Äù optimization, namely, as a result, only 1 request from 4 initial requests.  The above optimization steps work in the default Fullajax library.  Those.  By default, the start page scripts are not reloaded, and also all new scripts are loaded only once. <br><br>  <a href="http://fullajax.ru/temp/asyncjs/fullajax1.html">fullajax.ru/temp/asyncjs/fullajax1.html</a> <br><br>  The implementation of optimization step # 1 is still more or less transparent - we find all the scripts in the head block and get their contents.  The implementation of optimization step # 2 required additional synchronization between parallel asynchronous page requests from the server.  Often there is a situation when the second parallel request began before the first one ended, i.e.  The second request started before we got the script text.  Accordingly, it is necessary to ensure synchronization between threads so that at the end of the script download from the first thread, the second thread will immediately recognize this.  In general, this is a more in-depth topic ... <br><br>  Fortunately and surprisingly, the optimization options are incomplete.  We can still remove unnecessary "movement." <br><br><h3>  Optimization step 3 - Re-initialization enemy optimization </h3><br>  <b>Why execute (initialize) again what has already been executed (initialized)?</b> <br><br>  In the previous optimization steps, getting rid of re-loading scripts, we still continue to re-execute the same scripts.  Let's look inside the test1.js and test2.js scripts. <br><br>  Script test1.js <br><blockquote> <code><font color="black"><font color="#0000ff">var</font> a = Math.random();</font></code> </blockquote> <br>  Script test2.js <br><blockquote> <code><font color="black"><font color="#0000ff">function</font> test(){ <br> alert( <font color="#A31515">'Hello'</font> ); <br> } <br></font></code> </blockquote><br>  Regarding the test1.js script, it <u>is important for</u> us <u>to</u> execute it every time, with each new boot, since the value of the variable <b>a</b> will depend on it.  Here we can not do anything, accept this. <br><br>  Regarding the test2.js script, its repeated execution carries no payload.  The <b>test</b> function has already been defined once, and with each subsequent download of this script, this function simply overrides itself.  Accordingly, we can safely not re-execute this script.  Thus, we will save processor time and possibly memory.  However, we do not have standard tools at hand that allow the script to be executed only once (hello to the HTML standard).  To do this, you must either change the internal structure of the script, so that a check on the previous execution is carried out, or give the asynchronous script loading engine (library) with an appropriate algorithm. <br>  Consider the implementation of this optimization step in Fullajax.  In order to carry out a one-time execution of some scripts, it is necessary and sufficient to just add the "magic" attribute <b>ax: repeat = '0' to them</b> . <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">script</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/javascript"</font> <font color="#ff0000">ax:repeat</font> <font color="#0000ff">="0"</font> <font color="#ff0000">src</font> <font color="#0000ff">="test2.js"</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font></font></code> </blockquote>  And that's all :).  Further, the script loading algorithm will automatically optimize the execution of such marked scripts, i.e.  such scripts will be executed only once.  The determination of the need or absence of the need to re-execute (initialize) scripts is made by the developer himself.  Analyze your scripts!  If there is no need to re-execute them, feel free to tag them with the appropriate attribute.  In some cases, the re-execution of individual scripts even causes errors in the site (web application).  Such an example is the many famous calendar script ( <a href="http://www.zapatec.com/website/main/products/prod1/">Zapatec Calendar</a> ).  If repeatedly, when AJAX loads content, execute the calendar.js script from the set of scripts, the calendar stops working and gives errors. <br><br>  <font color="#777">Not tired?</font>  <font color="#777">I was already a bit ‚Äútired‚Äù of describing ... imagine how much the above described was programmed :).</font> <br><br>  And this is not all possible ways of optimization, there is also something that can be optimized during asynchronous loading of scripts. <br><br><h3>  Optimization Step 4 - Parallels Songs Sang </h3><br>  Let's consider the case when there are several scripts in the loaded page.  For example <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">script</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/javascript"</font> <font color="#ff0000">src</font> <font color="#0000ff">="test1.js?1"</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font> <br> &lt;script type= <font color="#A31515">"text/javascript"</font> src= <font color="#A31515">"test1.js?2"</font> &gt;&lt;/script&gt; <br> &lt;script type= <font color="#A31515">"text/javascript"</font> src= <font color="#A31515">"test1.js?3"</font> &gt;&lt;/script&gt; <br> &lt;script type= <font color="#A31515">"text/javascript"</font> src= <font color="#A31515">"test1.js?4"</font> &gt;&lt;/script&gt; <br> &lt;script type= <font color="#A31515">"text/javascript"</font> src= <font color="#A31515">"test1.js?5"</font> &gt;&lt;/script&gt; <br> &lt;script type= <font color="#A31515">"text/javascript"</font> src= <font color="#A31515">"test1.js?6"</font> &gt;&lt;/script&gt; <br> &lt;script type= <font color="#A31515">"text/javascript"</font> src= <font color="#A31515">"test1.js?7"</font> &gt;&lt;/script&gt; <br> &lt;script type= <font color="#A31515">"text/javascript"</font> src= <font color="#A31515">"test1.js?8"</font> &gt;&lt;/script&gt; <br> &lt;script type= <font color="#A31515">"text/javascript"</font> src= <font color="#A31515">"test1.js?9"</font> &gt;&lt;/script&gt; <br> &lt;script type= <font color="#A31515">"text/javascript"</font> src= <font color="#A31515">"test1.js?10"</font> &gt; <font color="#0000ff">&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">head</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> Hello Bingo! <br> <font color="#0000ff">&lt;/</font> <font color="#800000">body</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">html</font> <font color="#0000ff">&gt;</font></font></code> </blockquote> <br>  jQuery in this case begins to load the first script, then, at the end of the first, it starts loading the second, then at the end of loading the second, the third, and so on.  Those.  in fact, synchronous sequential loading of scripts is performed. <br><br>  <a href="http://fullajax.ru/temp/asyncjs/jquery2.html">fullajax.ru/temp/asyncjs/jquery2.html</a> <br><br>  And it is quite normal!  All browsers behave in the same way with standard script loading.  Because the execution of the subsequent script may depend on the previous one.  Therefore, we must wait for the execution of the first, and then perform the second. <br>  But!  "Run" is not at all tantamount to "loading."  After all, we can carry out parallel loading of all scripts? .. But we will execute them already sequentially, as they are loaded. <br>  Thus, implementing the above algorithm, we get a real safe asychronic script loading.  This optimization algorithm is called - <u>parallel loading algorithm with sequential application</u> . <br><br>  <a href="http://fullajax.ru/temp/asyncjs/fullajax2.html">fullajax.ru/temp/asyncjs/fullajax2.html</a> <br><br>  With more close to real conditions, we load large script files. <br><br>  jQuery <br><br>  <a href="http://fullajax.ru/temp/asyncjs/jquery3.html">fullajax.ru/temp/asyncjs/jquery3.html</a> <br><br>  Fullajax <br><br>  <a href="http://fullajax.ru/temp/asyncjs/fullajax3.html">fullajax.ru/temp/asyncjs/fullajax3.html</a> <br><br>  The conclusions are obvious. <br><br>  The specified algorithm for optimizing the loading of scripts is implemented in the Fullajax library and is used by default. <br><br><h3>  And a little more optimization - skip ~ perform miracles </h3><br>  Sometimes, when uploading content using AJAX, it becomes necessary to disable the execution of certain scripts, and at the same time to carry out their normal execution with the usual standard load.  There is no simple standard way to do this.  To implement the specified functionality, it is necessary for the server to determine how content is requested (via AJAX or the standard way), accordingly, add or remove certain scripts from the page content.  When using Fullajax, there is a much simpler way - add the ‚Äúwonderful‚Äù attribute to the style <b>ax: skip = '1'</b> .  Now the library will skip (ignore) the scripts you have marked accordingly, will not even try to load them. <br><br>  There are still a lot of other questions regarding the processing of scripts in various libraries.  For example: why jQuery first inserts the content, and then executes the scripts, if in the loaded document it is clearly indicated to first run the scripts, and then insert the content.  There are also other points that go beyond the scope of this article. <br><br>  In this article, we have analyzed and analyzed in detail the various bottlenecks that arise during the asynchronous loading of HTML content with scripts, and also considered possible ways to optimize such bottlenecks. <br><br>  <font color="#777">The material of the article is unique, it has never been covered or voiced anywhere before, it is published for the first time.</font>  <font color="#777">All conclusions and algorithms are derived by the author in the process of developing the Fullajax library</font> . <br><br>  jQuery I love too :). <br><br>  <b>UPD:</b> - added tests when loading large script files. </div><p>Source: <a href="https://habr.com/ru/post/56974/">https://habr.com/ru/post/56974/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../56966/index.html">Creating a palette</a></li>
<li><a href="../56970/index.html">Synchronizing: recipes for working on multiple computers</a></li>
<li><a href="../56971/index.html">Four years progress</a></li>
<li><a href="../56972/index.html">Dead pixel in Google Earth</a></li>
<li><a href="../56973/index.html">When to make a PDF document</a></li>
<li><a href="../56975/index.html">Development through the ass</a></li>
<li><a href="../56976/index.html">Patterns in historical context</a></li>
<li><a href="../56977/index.html">Bashstyle-ng. Application localization example</a></li>
<li><a href="../56999/index.html">number 3649</a></li>
<li><a href="../57000/index.html">Student suspended from class</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>