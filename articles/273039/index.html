<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Evolution in the cloud: the experience of the service to work with social networks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Thanks to Artem Zukovets - CTO NovaPress Publisher for preparing the article. Winning project ‚ÄúHeroes of Russian startups‚Äù 
 

 Hello! Today we will t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Evolution in the cloud: the experience of the service to work with social networks</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <em>Thanks to Artem Zukovets - CTO NovaPress Publisher for preparing the article.</em>  <em>Winning project <a href="http%253A%252F%252Frusbase.com%252Fnews%252Fhero-winner%252F%26data%3D01%257C01%257Cdpopkova%2540064d.mgd.microsoft.com%257C204e1a39e1504d3a2dbd08d300624879%257C72f988bf86f141af91ab2d7cd011db47%257C1%26sdata%3DkKlbxJr10BzZ1vl9SuOWyFkHgf3cHTWCqfriLFplDIs%253D">‚ÄúHeroes of Russian startups‚Äù</a></em> <em><br></em> </blockquote><br><a name="habracut"></a><br>  Hello!  Today we will talk about the architecture of the NovaPress Publisher service and the experience of its transfer to the Microsoft Azure cloud. <br><br>  <a href="http://beta.novapress.pro/">NovaPress Publisher</a> is a web service that makes it easier for companies to work with social networks.  It allows you to plan content in social networks for days and months ahead.  And also automatically take content as they appear on the company's website and place it on all social networks. <br><br>  Currently, this service is already used in the work of more than 9,500 companies, including well-known brands - magazines, newspapers, television channels, commercial and government organizations. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/5d9/1a1/1dd/5d91a11dd57741d39ea9f4fec68a48b5.png"></div><br><br><h1>  <font color="#0078AB">How it all began</font> </h1><br>  Our service appeared in 2010, but we didn‚Äôt come to work with Azure immediately.  In the first years of the life of the service, we used virtual machines on various hosting sites to work. <br><br>  Our task was to process and post on social networks <u>several thousand records per minute 24/7</u> <u>without delay</u> <u>.</u> <br><br>  And while the real problem were periodic interruptions in the work of virtual machines.  They led to the fact that the queue accumulated a huge number of unpublished entries, or user-created content was temporarily unavailable. <br><br>  In addition, during peak hours, the service load was too high, and there were delays in sending records. <br><br>  At that time, the service was supposed to send up to 6000 entries per minute to social networks and synchronize up to 1500 RSS feeds per minute.  Now these values ‚Äã‚Äãare much higher. <br><br>  Above all, the load was in the morning and evening hours, especially at 00 minutes and 30 minutes (for example, 17:00, 17:30, 18:00, and so on). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d21/45c/0af/d2145c0afe3c44e3a522f650a240c3fc.png"></div><br><br>  Our decision at that time was this: <br><br><img src="https://habrastorage.org/files/42f/947/fdb/42f947fdb5f540c6b2388a9059b075f7.jpg"><br><br>  Robots performing scheduled tasks (publishing content to social networks) were duplicated on several servers, as well as user-generated content.  With the growing number of users, we connected additional servers. <br><br>  However, over time, scaling was made more difficult, new bottlenecks were opened.  In addition, periodic failures at hosting providers created us significant problems.  And instead of introducing new features into our service, we spent a lot of time trying to cope with the increased load and to ensure, despite everything, high availability of the service and the publication of records without delay. <br><br>  Therefore, we began to look for a new solution that could protect us from failures and provide flexible scaling depending on the load. <br><br>  And finally, in 2013, we opted for the Azure cloud, in which scaling, replication and load balancing options were immediately available, out of the box. <br><br><h1>  <font color="#0078AB">Switch to Azure</font> </h1><br>  This was the scheme of our service after the transition to the Azure cloud: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/486/100/82f/48610082f7c84b8da65b9008c20c4578.jpg"></div><br>  Users work with the service through the website (Azure Website, ASP.NET MVC), data is stored in the Azure SQL database and Azure Storage.  For quick access to data, the Redis cache in the cloud is used. <br><br>  All automation (posting to social networks, copying records from sites or other social networks) is performed by Windows services hosted on a large number of Azure VM virtual machines.  These services operate in multiple threads, performing tasks as they arrive in the ServiceBus queue.  If there are more tasks and the load increases, we increase the number of virtual machines. <br><br>  In addition, at peak minutes (18:00, 18:30, etc.), the service is reconfigured (automatically reduces the number of robots that perform minor tasks and increases the number of robots publishing to social networks) so that as soon as possible and without delay publish content on social networks. <br><br><h1>  <font color="#0078AB">Transition process</font> </h1><br>  We went to Azure in several stages, starting with the most important ones: <br><ol><li>  Database Transfer  Before moving to the cloud, we used the SQL Server database.  Migrating the SQL Server database to SQL Azure Cloud was quite simple, using a special application.  After the transition, we got a stable database without fail.  (availability 99.99%). <br></li><li>  Migrate user content.  Before moving to the cloud, we ourselves duplicated user-generated content (photos, text) on several servers to ensure availability in the event of a crash.  But it demanded a lot of resources and disk space.  When moving to the cloud, we transferred all content to Azure Storage with automatic geo-replication (all content is automatically duplicated in 3 Azure data centers).  Availability Level: 99.99% <br></li><li>  Transferring the task queue to the ServiceBus.  Previously, a queue of tasks (for example, records that need to be published) was tied to a database.  After moving to Azure, the service sends all the tasks that need to be completed to the ServiceBus queue.  This removed some of the load from the database and significantly increased the potential for further scaling up the service. <br></li><li>  Transfer the website to the cloud.  The site was transferred to the Azure Website and the automatic scaling was turned on so that the site was always available and kept load better. <br></li><li>  Cache Redis in the cloud.  We use Redis to ensure the fastest possible posting to social networks.  The content prepared for publication and its publication settings are stored in the cache so that at the right moment, as soon as possible go to social networks.  Redis in the cloud already out of the box has automatic replication and guarantees availability at least 99.99% of the time. <br></li></ol><br><h1>  <font color="#0078AB">Further steps</font> </h1><br>  In December 2015, we released a <a href="http://beta.novapress.pro/">new beta version</a> , which improved the filling of the service: <br><ul><li>  The site of the service is now a SPA-application AngularJS.  All html-forms, scripts and styles are minified and loaded at the start, so that further switching between forms is instant. <br></li><li>  Working with data goes through a separate ASP.NET Web API web application.  You have made Web API calls to get the result of the operation as quickly as possible.  Actively used caching using Redis. <br></li></ul><br>  In the future we have the following improvements: <br><ul><li>  Work with the service in real time thanks to WebSocket (SignalR).  Since several employees of the company often work simultaneously with the service, I would like the changes made by each user to be instantly displayed by other employees.  Also, the user will immediately see as soon as the service performs a particular task (for example, publishes entries in social networks, or downloads new entries from the site). <br></li><li>  Monitoring and analytics in social networks.  It will show how effectively the company has worked with social media and will show you how to improve these indicators.  In this regard, we are looking towards <a href="https://azure.microsoft.com/ru-ru/services/stream-analytics/">Stream Analytics</a> and <a href="https://azure.microsoft.com/ru-ru/services/machine-learning/">Machine Learning</a> . <br></li></ul><br><h1>  <font color="#0078AB">Results</font> </h1><br>  As a result of the transition to Azure, we: <br><ul><li>  ensured high availability of our service to customers.  Everything works like a clock and customers can not but like it. <br></li><li>  received a performance margin for further growth of the service.  Now the service places in social networks at 23,000 entries per minute, but this is far from the limit. <br></li><li>  freed up our time for other important tasks by shifting the provision of high availability and scaling to Azure.  So we were able to fully concentrate on improving the service and adding new features. <br></li></ul><br><hr><br><img src="https://habrastorage.org/files/b31/a38/52a/b31a3852afb345549034283b67a00fae.jpg" align="left"><br><h3>  about the author </h3><br>  <em><b>Artem Zhukovets - Technical Director, NovaPress Publisher</b></em> </div><p>Source: <a href="https://habr.com/ru/post/273039/">https://habr.com/ru/post/273039/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../273023/index.html">Full translation of Unix-koans into Russian</a></li>
<li><a href="../273025/index.html">What is BPMS</a></li>
<li><a href="../273027/index.html">Browser extension from Yandex</a></li>
<li><a href="../273035/index.html">Accelerate your application. PERFMATTERS !.</a></li>
<li><a href="../273037/index.html">Interactive C #</a></li>
<li><a href="../273043/index.html">On the effectiveness of Rutreker's ‚Äúteachings‚Äù</a></li>
<li><a href="../273045/index.html">Python internal list</a></li>
<li><a href="../273047/index.html">How to squeeze a flat cat</a></li>
<li><a href="../273049/index.html">NOC Project. Where to start and how to continue?</a></li>
<li><a href="../273051/index.html">How I debugged the python httplib and httplib2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>