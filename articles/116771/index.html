<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mono and Windows Forms on the Nokia N900? Sure, not a problem!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I was somewhat surprised not to see mono in the repositories for this wonderful device. But, since it was desperately needed, I decided to collect it....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mono and Windows Forms on the Nokia N900? Sure, not a problem!</h1><div class="post__text post__text-html js-mediator-article">  I was somewhat surprised not to see mono in the repositories for this wonderful device.  But, since it was desperately needed, I decided to collect it.  And then he ran into a very funny feature of the maemsky SDK, which did not allow me to do this.  But first things first.  In the meantime, a small screen of what happened: <br><img src="https://habrastorage.org/storage/habraeffect/a8/3e/a83ebb8d42e2ceafa73fa637ac92cefa.png" alt="image"><br><br>  Instead of a normal device emulator and toolchain for assembly, the guys from nokii adapted a scratchbox for this case, which, exploiting qemu-user, runs the arm binaries directly on the core of the current OS.  And everything would be great if it worked as it should.  In fact, during assembly, qemu issues an ‚Äúunsupported syscall 242‚Äù, after which the assembly stops.  It‚Äôs difficult to do anything with an ordinary cross-caper, for mono, in the best traditions of the bootstrap procedure (raising oneself by the shoe laces), compiler first compiler and already with its participation is collecting all the rest.  How to deal with this is not very clear, if only to compile on the device, but there it will take years.  For the N800 mono, some hero was able to collect, but it refused to work on the n900, falling out with SIGSEGV.  If anyone is interested in how this problem has been solved, or you can independently touch the mono on the device (you can write directly in Visual Studio, if that) I ask under the cat. <br><a name="habracut"></a><br><br>  To begin, I will describe how to <i>do it failed</i> .  However, experience was obtained and the information can be very useful. <br>  I will not write about the SDK, about its installation and configuration, and without me much has been written. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Damn the first.  Compile on the device. </h4><br><ol><li>  We bring /etc/apt/sources.list to the following form: <br><blockquote><code>deb http_s_://downloads.maemo.nokia.com/fremantle/ssu/apps/ ./ <br> deb http_s_://downloads.maemo.nokia.com/fremantle/ssu/002 ./ <br> deb http_s_://downloads.maemo.nokia.com/fremantle1.2/ovi/ ./ <br> <br> deb http_://repository.maemo.org/extras/ fremantle-1.3 free non-free <br> deb http_://repository.maemo.org/extras-testing/ fremantle-1.3 free non-free <br> deb http_://repository.maemo.org/extras-devel/ fremantle-1.3 free non-free <br> <br> deb http_://repository.maemo.org/ fremantle/sdk free non-free <br> deb http_://repository.maemo.org/ fremantle/tools free non-free</code> </blockquote>  _ We remove from the links, it is there for the simple reason that the parser is a sucker, and does not even understand the code tag. </li><li>  Set build-essential, bison, gettext, m4 </li><li>  ./configure &amp;&amp; make &amp;&amp; make install </li><li>  We realize that the process will take decades and look for other ways. </li></ol><br><br><h4>  Damn the second.  Compile on emulator. </h4><br>  First we need to pull out the uncut rootfs itself.  There are 2 ways.  First, you can unpack the flasher firmware (flasher-3.5 -u -F IMAGE) and mount rootfs.jffs.  In fact, there are not jffs, but ubifs, by the way.  I got here on <a href="http://talk.maemo.org/showthread.php%3Ft%3D35554">this manual</a> . <br><br>  You can also load the recovery system, as described <a href="http://maemoworld.ru/wiki/index.php/Nokia_N900/MeeGo_Rescue_Initrd">here</a> .  There, this image is used in order to move sections, but we do not need it.  After that, in the internal console, we mount -t ubifs ubi: rootfs / mnt and merge everything onto a USB flash drive.  A good backup method, by the way, is highly recommended. <br><br>  Further on a <a href="https://wiki.ubuntu.com/ARM/RootfsFromScratch">manual</a> we make to ourselves an image for qemu. <br><br>  In order to make life easier for you and to be able to chroot into the armor environment, you will need the qemu-kvm-extras-static package.  Copy after installing / usr / bin / qemu-arm-static to / bin your system and the chroot starts to work in a magical way.  If anyone is interested in how this happens, they can read about binfmt_misc and other goodies that linux allows us.  Theoretically, this can be done on the ubuntu x86 device itself in the chroot environment, and in it start the wine.  Although, most likely it will not work, for we will come across all the same unsupported system calls. <br><br>  We are assembling, creating the maemo directory, expanding the image that we have dumped, then everything is on the first pancake. <br><br>  As a result, during the compilation, mcs began to crash with an internal error and I could not do anything about it.  Nevertheless, the build environment was obtained independent of the scratchbox (which, among other things, is also only <i>under i386</i> ). <br><br><h4>  Success at last! </h4><br>  On the third day, the Sharp-eyed Eye noticed that the shed had no wall.  Namely: almost all mono is managed dll-ki, which absolutely all the same under which platform they are launched.  As a result, the following plan matured: <br><br><ol><li>  Through apt-src install, we pull out the raw mono.  In this case, they are already laid out in packages so that they are then convenient to put. </li><li>  We scoff at the contents of the directory with debian build scripts so that all files are in / opt (on nokia and a very small rootfs, if someone is not up to date) </li><li>  We collect under amd64 </li><li>  We collect platform-dependent binaries in the chroot-environment of Section 2 (errors again in the scratchbox, did not understand) </li><li>  We thoroughly mock the packages, changing these same binaries in them, ruling dependencies, inserting crutches </li></ol><br><br>  Actually, the fourth step was facilitated by the presence of the option --disable-mcs-build, which the uncle from Novell specifically invented for such cases.  I will not describe the build process, this time (after 5 unsuccessful attempts!) Turned out to be quite trivial. <br><br>  The bundles and versions of libraries in Maemo and Ubunt are somewhat different, so I had to pick them up.  But it's worth it: I managed to transfer to the device the normal system scattered across the library packages (not fully yet, but I'm working on it) instead of the 260-meter tarball, which is generated by ./configure &amp;&amp; make.  Actually, now mono I have devoured about 27 meters / opt with the weight of packages at 12. At the same time, almost the entire .NET 2.0 is already available: <br><blockquote>  <font>System.dll, System.ServiceProcess.dll, System.Drawing.Design.dll, System.Transactions.dll, mscorlib.dll, System.Drawing.dll, System.EnterpriseServices.dll, System.Web.dll, System.ComponentModel. DataAnnotations.dll, System.IdentityModel.dll, System.Web.DynamicData.dll, Mono.Data.SqliteClient.dll, System.Configuration.dll, System.IdentityModel.Selectors.dll, System.Web.Extensions.Design.dll, Mono.Data.Sqlite.dll, System.Configuration.Install.dll, System.Management.dll, System.Web.Extensions.dll, System.Core.dll, System.Messaging.dll, System.Web.Routing.dll, System.Data.DataSetExtensions.dll, System.Runtime.Serialization.dll, System.Web.Services.dll, Mono.Messaging.dll, System.Data.dll, System.Security.dll, System.Windows.Forms.dll, System.Data.Linq.dll, System.ServiceModel.dll, System.Xml.dll, Mono.Security.dll, System.Design.dll, System.ServiceModel.Web.dll, System.Xml.Linq.dll</font> </blockquote><br><br>  You can install this miracle on your device by adding the following line to sources.list: <br><blockquote> <code>deb http_://archive.kebrum.com/n900/ all main</code> </blockquote> <br>  and installing the libmono-winforms2.0-cil package, which will pull everything else along.  Unfortunately, I haven‚Äôt transferred any more packages for now, for it is already 4 am, but I will definitely take care of this later (I‚Äôll transfer gtk software). <br><br>  If someone wants to transfer their software to C # on the N900 using this assembly, please contact me to keep you informed. <br><br>  And do not judge strictly for spelling with punctuation, night in the yard, eyes are red, I really want to sleep, and I barely get to the keys. <br><br>  UPD: With the help of scrap and some kind of mother, GTK # was moved (not everything yet).  Well, not such a piece of mono, necessary for the package mono-devel. </div><p>Source: <a href="https://habr.com/ru/post/116771/">https://habr.com/ru/post/116771/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116760/index.html">Haskell Tutorial on the other hand</a></li>
<li><a href="../116761/index.html">Encrypt files in black and white images.</a></li>
<li><a href="../116767/index.html">Repent of your sins and be happy. Or how small usability flaws spoil the whole result.</a></li>
<li><a href="../116768/index.html">Making your Gmail Motion</a></li>
<li><a href="../116769/index.html">We protect the VPS-server based on Windows 2008 R2</a></li>
<li><a href="../116773/index.html">The Mozilla Foundation begins to educate users about how extensions slow down browser loading</a></li>
<li><a href="../116774/index.html">Parsing lincrackme3</a></li>
<li><a href="../116775/index.html">Mastering F #: building a colorful Mandelbrot set with navigation and integration with C #</a></li>
<li><a href="../116776/index.html">Google has become the most expensive brand of the planet.</a></li>
<li><a href="../116777/index.html">Happy webmasters!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>