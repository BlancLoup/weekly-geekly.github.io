<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Isosurface rendering using reykasting algorithm</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to tell you about Isosurface rendering or rendering isosurfaces. 

 On duty, I always use the documentation only in English or ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Isosurface rendering using reykasting algorithm</h1><div class="post__text post__text-html js-mediator-article">  In this article I want to tell you about Isosurface rendering or rendering isosurfaces. <br><br>  On duty, I always use the documentation only in English or German.  Therefore, in the text I will often use the English word for all sorts of terms. <br><br>  So, what is the <a href="http://en.wikipedia.org/wiki/Isosurface">Isosurface</a> is, as Wikipedia tells us, a 3-dimensional variant of the contour, which in turn "represents a line, at each point of which the measured quantity retains the same value."  In words, it may not be entirely clear - we‚Äôll look at the pictures better. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/e30/871/0ab/e308710ab7b2dc7ac5d2da80eaf9806f.jpg" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/34d/cb2/b09/34dcb2b09637e2ebdfa625fdacc1533a.jpg" alt="image"><br><br>  These images show surfaces with different values ‚Äã‚Äãof the ‚Äúmeasured value‚Äù - density.  The first value is less than the second. <br><br>  To begin with a brief theory. <a name="habracut"></a><br><br>  I do medical image processing.  The data obtained from medical devices mainly contain the so-called raw or grayscale image - from 8 bits (256 shades) to 16 bits (65536 shades of gray).  Since in fact 16 bits is a lot, an abbreviated version is often used - 12 bits, that is, a part from the high byte is used, this gives us 4,096 shades of gray. <br>  Further, to convert a gray image into a color one, you can use the so-called LUT - look up table.  This table is a set of rows, each of which contains an RGBA value.  For 12 bits, this table contains 4096 rows.  And when we encounter a voxel with a value of, for example, 542, we respectively take from the 542 rows of this table the RGBA values ‚Äã‚Äãspecified there. <br>  These tables are compiled by qualified doctors / engineers who know how to correlate the density value with the RGBA.  Using the alpha channel, that is, transparency, allows you to create tables, the use of which will allow us to display only bones, or only veins, or arteries - the rest will be transparent.  That is, changing the LUT on the fly, we get every time a new display of the same object. <br><br>  The main way of rendering image data is <a href="http://en.wikipedia.org/wiki/Volume_ray_casting">Volume ray casting</a> (something similar to Russian - <a href="http://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B1%25D1%258A%25D1%2591%25D0%25BC%25D0%25BD%25D1%258B%25D0%25B9_%25D1%2580%25D0%25B5%25D0%25BD%25D0%25B4%25D0%25B5%25D1%2580%25D0%25B8%25D0%25BD%25D0%25B3">Volumetric rendering</a> ).  I will not describe it in too much detail here.  But understanding his work is important for us to understand the process of rendering isosurfaces. <br><br>  The ray casting algorithm is that we penetrate our object with rays.  The beam emanates from our eye (camera), passes through each point of the screen (each pixel), and intersects with our object in a specific voxel (if there is an intersection).  The beam does not stop at this, but goes further, crossing further voxels and accumulating information from each point in a certain way.  The criteria for stopping the beam can be several, the most common is when the accumulated value alpha is close to 1 (in practice, a value of a&gt; 0.95 is used), or, for example, if we have moved beyond the boundaries of the image.  That is, in fact, during the tracing we discard the transparent voxels and in a certain way we accumulate the translucent values ‚Äã‚Äãuntil we reach the whole object, which does not pass our beam further because of its opacity.  The resulting value is used to draw on the screen. <br><br>  Returning to the main theme, I want to say that the rendering of isosurfaces differs mainly in the breakpoint.  In our case, as soon as we find a voxel with a value that is greater than or equal to the initially specified density value, we stop ray casting for the current beam and proceed to the next one.  Since at all points the values ‚Äã‚Äãshould be equal, all isosurfaces are usually drawn with the same color.  One value - respectively one color. <br><br>  This algorithm can be implemented on the CPU (and, in principle, the first implementations were just like that), but it will work very slowly.  Everything is processed much faster on the GPU using the fragment <a href="http://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B5%25D0%25B9%25D0%25B4%25D0%25B5%25D1%2580">shader</a> ( <a href="http://en.wikipedia.org/wiki/OpenGL_Shading_Language">GLSL</a> ).  The required parameters are transmitted from the outside - the limit value, color, speed of passage, etc.  Below is the code for the simplest fragmentary shader that renders an isosurface.  Since all previous or subsequent voxels are not important for an isosurface, here it is not the accumulation of values ‚Äã‚Äãthat takes place, but just one color boundary value is used - isoColor. <br><br><blockquote><ol><li></li><li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#000066"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> { floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#666666"><i><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> // get ray position and ray direction <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></i></font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#666666"><i><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> // for all samples along the ray <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></i></font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#000066"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> { steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#666666"><i><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> // get trilinear interpolated value from 3d texture <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></i></font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#666666"><i><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> // check if we get isosurface line <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></i></font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#000066"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> { <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></font></code> </li> <li> <code><font color="black"><font color="#666666"><i><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> // march to the next sample rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></i></font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#666666"><i><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> // get next density <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></i></font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#000066"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> } <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></font></code> </li> <li></li><li> <code><font color="black"><font color="#666666"><i><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> // else we do color transformation outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></i></font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li></li><li> <code><font color="black"><font color="#009900"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> #ifdef SHADER <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></font></code> </li> <li> <code><font color="black"><font color="#666666"><i><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> // do shading <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></i></font></font></code> </li> <li> <code><font color="black"><font color="#009900"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> #endif <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></font></code> </li> <li></li><li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#000066"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> } <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></font></code> </li> <li> <code><font color="black"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> <font color="#000066">}</font></font></code> </li> <li> <code><font color="black"><font color="#000066"><font color="#333399"><b>uniform</b></font> <font color="#000066"><b>sampler3D</b></font> volume <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> sampleRate <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>float</b></font> isoValue <font color="#000066">;</font> <font color="#333399"><b>uniform</b></font> <font color="#000066"><b>vec4</b></font> isoColor <font color="#000066">;</font> <font color="#333399"><b>varying</b></font> <font color="#000066"><b>vec4</b></font> texCoord0 <font color="#000066">;</font> <font color="#000066"><b>void</b></font> main <font color="#000066">(</font> <font color="#000066">)</font> <font color="#000066">{</font> floast steps <font color="#000066">=</font> <font color="#0000ff">1.0</font> <font color="#000066">/</font> sampleRate <font color="#000066">;</font> <font color="#000066"><b>vec4</b></font> outputColor <font color="#000066">=</font> <font color="#000066"><b>vec4</b></font> <font color="#000066">(</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.,</font> 0 <font color="#000066">.</font> <font color="#000066">)</font> <font color="#000066">;</font> <font color="#000066"><b>float</b></font> isoThr <font color="#000066">;</font> <font color="#666666"><i>// get ray position and ray direction</i></font> <font color="#000066"><b>vec4</b></font> vPosition <font color="#000066">=</font> <font color="#551111">gl_ModelViewMatrixInverse</font> <font color="#000066">[</font> <font color="#0000ff">3</font> <font color="#000066">]</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayPosition <font color="#000066">=</font> texCoord0 <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> vecDif <font color="#000066">=</font> rayPosition <font color="#000066">-</font> vPosition <font color="#000066">.</font> <font color="#006600">xyz</font> <font color="#000066">;</font> <font color="#000066"><b>vec3</b></font> rayDirection <font color="#000066">=</font> sampleRate <font color="#000066">*</font> <font color="#993333"><b>normalize</b></font> <font color="#000066">(</font> vecDif <font color="#000066">)</font> <font color="#000066">;</font> <font color="#666666"><i>// for all samples along the ray</i></font> <font color="#000000"><b>while</b></font> <font color="#000066">(</font> steps <font color="#000066">)</font> <font color="#000066">{</font> steps <font color="#000066">--;</font> <font color="#666666"><i>// get trilinear interpolated value from 3d texture</i></font> <font color="#000066"><b>float</b></font> value <font color="#000066">=</font> <font color="#993333"><b>texture3D</b></font> <font color="#000066">(</font> volume <font color="#000066">,</font> rayPosition <font color="#000066">)</font> <font color="#000066">;</font> isoThr <font color="#000066">=</font> value <font color="#000066">-</font> isoValue <font color="#000066">;</font> <font color="#666666"><i>// check if we get isosurface line</i></font> <font color="#000000"><b>if</b></font> <font color="#000066">(</font> isoThr <font color="#000066">&lt;</font> <font color="#0000ff">0</font> <font color="#000066">)</font> <font color="#000066">{</font> <font color="#666666"><i>// march to the next sample</i></font> rayPosition <font color="#000066">=</font> rayPosition <font color="#000066">+</font> rayDirection <font color="#000066">;</font> <font color="#666666"><i>// get next density</i></font> <font color="#000000"><b>continue</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#666666"><i>// else we do color transformation</i></font> outputColor <font color="#000066">=</font> isoColor <font color="#000066">;</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">=</font> outputColor <font color="#000066">.</font> <font color="#006600">rgb</font> <font color="#000066">*</font> outputColor <font color="#000066">.</font> <font color="#006600">a</font> <font color="#000066">;</font> <font color="#009900">#ifdef SHADER</font> <font color="#666666"><i>// do shading</i></font> <font color="#009900">#endif</font> <font color="#000000"><b>break</b></font> <font color="#000066">;</font> <font color="#000066">}</font> <font color="#551111">gl_FragColor</font> <font color="#000066">.</font> <font color="#006600">rgba</font> <font color="#000066">=</font> outputColor <font color="#000066">;</font> }</font></font></code> </li> <li></li></ol></blockquote><br>  ______________________ <br><h6>  The text was prepared in the Blog <a href="http://www.softcoder.ru/blogeditor/">Editor</a> from ¬© SoftCoder.ru </h6><br>  One of the main parameters of ray casting is the trace step - how fast the beam passes through our object.  If we render a cube of dimension X * Y * Z, then the ideal speed will be 1 / MAX (X, Y, Z).  That is, the gain must be no more than 1 voxel in order to not miss anything.  But on the other hand, often this level of detail is not needed, which also affects performance. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/374/c80/69c/374c8069c87e36c5c657513c766fa1c9.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/cae/ef8/f13/caeef8f13a7d235ff628f2259acc68e7.png" alt="image"><br><br>  In the presented pictures we see images rendered with different sampleRate.  In the first case, the ideal 1 / MAX (X, Y, Z) was used - the image turned out smooth, without visible transitions, since we did not miss a single voxel, BUT!  The FPS is only 13 frames per second. <br>  For the second option, sampleRate was used twice as much - that is, we processed every second voxel, and at the same time, circles that are formed due to an error in the calculation of finding the first voxel of the isosurface are already visible.  But FPS at the same time increased to 37 frames. <br>  How to increase the speed of the algorithm and at the same time not to lose in quality, I will try to consider in the next article. </div><p>Source: <a href="https://habr.com/ru/post/123632/">https://habr.com/ru/post/123632/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123626/index.html">Citrix Synergy 2011: Through the Clouds</a></li>
<li><a href="../123627/index.html">Help on the basic features of the interface XMind, made in the program itself</a></li>
<li><a href="../123628/index.html">Why do we listen but not hear?</a></li>
<li><a href="../123630/index.html">Elephants love mangoes, part 1/2: backstage look at Evernote for Windows Phone 7</a></li>
<li><a href="../123631/index.html">Accepting applications for two-character .SU open</a></li>
<li><a href="../123633/index.html">TeamLab: 2 sevens + 1 year = 30 thousand portals</a></li>
<li><a href="../123635/index.html">Scalable JavaScript applications</a></li>
<li><a href="../123636/index.html">Basics of SQL on the example of the task</a></li>
<li><a href="../123637/index.html">Google Reader Google Plus Design</a></li>
<li><a href="../123641/index.html">Low-cost controlled tv do it yourself</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>