<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Telegram Site Helper 2.0 - chat assistant for a site based on Telegram</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. My name is Andrey. 
 Last summer I published a draft and an article " Chat assistant to the site using Telegram in 15 minutes ." The idea of ‚Äã‚Äã...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Telegram Site Helper 2.0 - chat assistant for a site based on Telegram</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/6be/002/fe5/6be002fe52cc40d2a967683311fabfff.png"><br><br>  Hello.  My name is Andrey. <br>  Last summer I published a draft and an article " <a href="https://habrahabr.ru/post/264035/">Chat assistant to the site using Telegram in 15 minutes</a> ."  The idea of ‚Äã‚Äãthe project was to implement a <b>pop-up Chat Assistant</b> on the site, the backend for which (for a chat) would be the <b>Telegram messenger</b> that is gaining popularity. <br><br>  Surprisingly, the project quickly began to recruit stars on <b>GitHub</b> , and I received letters of thanks and requests for help in setting it up from people from all over the world.  People could not run the script on their hosting: either set_time_limit (0) is not supported, then error 503, then the paths are not specified correctly. <br>  <b>The second version of the script</b> is much easier to install and works on the basis of <b>WebHooks</b> . <br><a name="habracut"></a><br>  <b><a href="">&gt;&gt;&gt;&gt; Link to the GitHub repository</a></b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  In a nutshell, what is it </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/9f0/26d/945/9f026d94538963521dc97fecbcbefb4f.png" alt="image"><br>  For those who have not seen the previous article, I repeat.  <b>Telegram Site Helper</b> is a set of scripts (PHP, JS) that implement a chat assistant for your site (so that your visitors / clients can promptly ask a question in the chat to your manager).  The manager will receive a message in the Telegram Messenger.  And there can answer.  The system is suitable for sites where there is not a very large flow of customers.  There is still a small inconvenience: all messages from all visitors come to the manager in a single chat.  To send a response to the visitor, the manager must first select "podchat", sending the command <i>/ chat_1234</i> , like this: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/62a/307/f14/62a307f14a18430ab165c4b065067e8a.png"></div><br><br><h2>  What's new </h2><br><h4>  Chat is now powered by WebHooks. </h4><br>  Telegram server itself will send new messages to your server. <br>  The ever-running script server for Long Poll requests to the Telegram server is no longer needed.  But now HTTPS is needed (this is Telegram policy).  You can <a href="https://www.google.ru/webhp%3Fsourceid%3Dchrome-instant%26ion%3D1%26espv%3D2%26ie%3DUTF-8">buy a</a> certificate, make it free at <b><a href="https://www.startssl.com/">StartSSL</a></b> or make a self-signed one. <br><br>  For those who do not want to search, commands for the terminal: <br><div class="spoiler">  <b class="spoiler_title">How to create a csr file for StartSSL</b> <div class="spoiler_text"><code>sudo openssl req -nodes -newkey rsa:2048 -keyout apache.key -out apache.csr <br></code> </div></div><br><div class="spoiler">  <b class="spoiler_title">How to make a self-signed certificate</b> <div class="spoiler_text"> <code>sudo openssl req -x509 -nodes -days 3650 -newkey rsa:2048 -keyout apache.key -out apache.crt</code> </div> </div><br><br><h4>  Only one file is used for installation. </h4><br><img src="https://habrastorage.org/files/103/60c/20d/10360c20d6ed4308803bda6e5105bfc2.png"><br>  There is only one file in the repository: <b>telegram-site-helper-install.php</b> is an installer.  It will create the necessary directories, unzip JS, CSS and two PHP files. <br>  Here you can also generate a JS chat code, which you will need to paste into the site page. <br><div class="spoiler">  <b class="spoiler_title">Attention: the scripts in the installer are encoded in base64</b> <div class="spoiler_text">  Since for many website owners on Wordpress / Joomla, base64 is associated with viral injections - I invite all <s>paranoid people</s> in advance who are afraid to explore the contents of the scripts encoded in base64 (for example, using <a href="https://www.base64decode.org/">this utility</a> ). <br></div></div><br><br><h4>  Popup and embedded chats, styling </h4><br>  Chat can be styled without getting into CSS.  The color of the frame, background, font can be configured directly from the installer. <br><img src="https://habrastorage.org/files/99d/951/ede/99d951ede88540f78d5d76dcf21404c6.png"><br>  Another chat supports two display modes.  It can be <b>embedded into any other HTML</b> element or " <b>glued</b> " to one of the corners of the screen.  Chat can be opened by clicking on the standard label, or by clicking on an arbitrary HTML element. <br><img src="https://habrastorage.org/files/67c/575/2c5/67c5752c5cf94f5ab7fec1983802378f.png"><br>  You can also change all the captions (‚ÄúStart chat‚Äù, ‚ÄúEnter your name‚Äù, ‚ÄúAttach file‚Äù and others). <br><br><h4>  File transfer </h4><br>  Now the client and the manager can share files (photos and documents).  Files are stored on the Telegram server and do not occupy space on your hosting. <br><img src="https://habrastorage.org/files/362/ea7/3b6/362ea73b68a2450f829ca21dde8215d1.png"><br><br><h4>  JQuery is no longer required </h4><br>  The last time I was scolded, they say you need to pull jQuery for the work of a small script.  I realized everything and this time I wrote everything in pure JavaScript. <br><br><h4>  Works via Server Side Events or LongPoll </h4><br>  Chat on the site can now receive updates from your server not only using Long Poll requests, but also using Server Side Event broadcast (it will only work on hosting with <b>set_time_limit (0)</b> supported and there are no problems with the <b>flush ()</b> function) <br><br><h2>  How to install </h2><br><ol><li>  Log into your server / VPS / hosting via SSH or FTP </li><li>  Create a folder (more convenient in the root of the site) and name it for example telegram-site-helper </li><li>  Make it chmod (access rights) at least 0775 (the installer script will create folders and files there) </li><li>  Upload telegram-helper-install.php to this folder </li><li>  Run the script via https (for example: <code><b>https:</b> //mysite.ru/telegram-site-helper/telegram-site-helper-install.php <br></code> <code><b>https:</b> //mysite.ru/telegram-site-helper/telegram-site-helper-install.php <br></code>  ). <br>  You should see the following: <img src="https://habrastorage.org/files/95f/6aa/851/95f6aa85155c485caa282df2b998f24a.png"></li><li>  Select Language and click Start Installation. </li><li>  Create a password for authorization of managers and enter it in the appropriate field (the manager will enter this password once for authorization from Telegram bot) </li><li>  Get the token for Bot at <a href="https://telegram.me/botfather"><b>@BotFather</b></a> and insert it (token) in the appropriate field: <br><img src="https://habrastorage.org/files/268/1d9/0b4/2681d90b4fbe46b3a475279cd32680d8.png"></li><li>  Choose where to store data: in SQLite or in MySQL.  If in MySQL - configure access. </li><li>  If you use a self-signed certificate - enter the full path to it (you need to send it to the Telegram server) <br><img src="https://habrastorage.org/files/4ad/e83/0b6/4ade830b67a041b99d5e3d4faaedcd74.png"></li><li>  Click " <b>Check settings and install Telegram Site Helper</b> " </li><li>  If the installation was successful you should see the following: <br><img src="https://habrastorage.org/files/45b/147/8cb/45b1478cbef4488690d9fea969d14adf.png"></li><li>  Open Telegram and write to your bot " <b>/ login 1234</b> " (where 1234 is the manager's password).  If the installation was successful, the bot will authorize you. <br><img src="https://habrastorage.org/files/648/521/313/648521313d744a39b0505009834fca23.png"></li><li>  Go to the tab " <b>Generator widget</b> " <br><img src="https://habrastorage.org/files/dc4/04f/101/dc404f101e5d48e8aca6a8337bfa6060.png"><br></li><li>  Customize the widget and copy the code to the site.  Everything. </li><li>  If you like the project - you can do <b><a href="https://money.yandex.ru/embed/donate.xml?account=4100168691358&amp;quickpay=donate&amp;payment-type-choice=on&amp;mobile-payment-type-choice=on&amp;default-sum=100&amp;targets=%D0%9F%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%BA%D0%B0+%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0&amp;target-visibility=on&amp;project-name=Telegram+Site+Helper+2%2F0&amp;project-site=https%3A%2F%2Fgithub.com%2FSurzhikov%2FTelegram-Site-Helper-2.0&amp;button-text=01&amp;successURL=">Donate</a></b> . </li></ol><br><br><h2>  Future plans </h2><br><ul><li>  Still implement LongPoll support to the Telegram server to dispense with HTTPs </li><li>  Invent and do: how to divide customers into "sub-chats" </li><li>  Complete english translation </li><li>  Voice chat </li><li>  Ability to change / disable message sound </li><li>  Clever thoughts that habra users will write in the comments </li></ul><br><br>  At the end of the article I express my gratitude to the Telegram team for the platform for Bots.  Extremely useful thing. <br>  Thank. <br><br>  UPD!  I forgot to add that after installation, it is worth removing the installer from the server and setting up permissions for the folder. <br>  <b>Many thanks for the prompt Pull Request and code criticism.</b>  I am looking for strength and time for improvement. </div><p>Source: <a href="https://habr.com/ru/post/302056/">https://habr.com/ru/post/302056/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302030/index.html">They are not taken into programmers: "reverse engineering" of the person</a></li>
<li><a href="../302032/index.html">Creating a blog on symfony 2.8 lts [Part 2]</a></li>
<li><a href="../302044/index.html">ReactOS 0.4.2 will be excellent</a></li>
<li><a href="../302046/index.html">Dash Financing and Management System</a></li>
<li><a href="../302050/index.html">Embedding PyPy Code in C Applications</a></li>
<li><a href="../302060/index.html">IT & Security Forum 2016 is over</a></li>
<li><a href="../302062/index.html">[PF] Print PDF under .NET, vector approach, practice</a></li>
<li><a href="../302066/index.html">Vacation programmatically, or as I did not participate in the competition for programming on JS. Part two</a></li>
<li><a href="../302068/index.html">Overview of options for organizing access to corporate network services from the Internet</a></li>
<li><a href="../302070/index.html">Cross-platform mobile development: questions for adults</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>