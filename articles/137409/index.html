<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SAPER on the fields of CAD</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We already wrote that the application written for nanoCAD can be run in AutoCAD. But the opposite is much more interesting: using nanoCAD code that wa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SAPER on the fields of CAD</h1><div class="post__text post__text-html js-mediator-article">  We already <a href="http://habrahabr.ru/company/nanosoft/blog/135173/">wrote</a> that the application written for nanoCAD can be run in AutoCAD.  But the opposite is much more interesting: using nanoCAD code that was developed for AutoCAD.  As always, I decided to do it playfully. <br><br>  It turns out that the idea that you can make a game for CAD software does not come to us alone.  For example, Kean Walmsley, the leading evangelist for the AutoCAD .NET API, has <a href="http://through-the-interface.typepad.com/through_the_interface/2011/07/minesweeper-in-autocad-using-net.html">an article</a> about Minesweeper on the <a href="http://through-the-interface.typepad.com/through_the_interface/">blog</a> .  That's exactly this sapper we will let under nanoCAD.  See the details under the cut. <br><img src="https://habrastorage.org/getpro/habr/post_images/74b/6a2/9ee/74b6a29ee3bcabb70eec10e1d1781586.png" alt="TitleImage"><br><a name="habracut"></a><br>  I think everyone who develops .NET applications under AutoCAD is familiar with Kean Walmsley's <a href="http://through-the-interface.typepad.com/through_the_interface/">‚ÄúThrough the Interface‚Äù</a> blog.  In <a href="http://through-the-interface.typepad.com/through_the_interface/2011/07/minesweeper-in-autocad-using-net.html">one</a> of the posts the author writes about the game ‚ÄúMinesweeper‚Äù, aka ‚ÄúMinesweeper‚Äù, made for AutoCAD. <br>  There are no files to download in the article, so you have to copy the code of two VB files and create a project yourself.  The article is accompanied by a number of comments, allowing in detail to understand how the game works, but this is not our goal.  Our goal is to launch Minesweeper under nanoCAD. <br>  To do this, we need to do three things: <br><ol><li>  add .NET nanoCAD library to References: hostdbmgd.dll, hostmgd.dll; </li><li>  replace Autodesk.AutoCAD with Teigha or HostMgd in the Imports block (see below); </li><li>  replace the full AutoCAD class names (where they occur) with the full nanoCAD class names. </li></ol>  Consider each of the points in more detail. <br><br>  The first.  Adding the hostdbmgd.dll, hostmgd.dll libraries is necessary because they contain all the classes for working with the .NET API nanoCAD.  Without them, we can not do anything.  It's clear. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The second.  In AutoCAD, all classes are contained in the Autodesk.AutoCAD namespace.  In nanoCAD, there are two namespaces: the database classes (that is, the drawing and its contents) are in the Teigha space, and the classes associated with the application, with the document description, with the command line, are in the HostMgd namespace.  I did this: <br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Imports</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Teigha</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Runtime</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Imports</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Teigha</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Geometry</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Imports</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Teigha</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.DatabaseServices</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Imports</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">HostMgd</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ApplicationServices</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Imports</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">HostMgd</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.EditorInput</span></span></code> </pre> <br>  And finally, the third.  In the code, there are sometimes explicit indications of class names.  For example, on Autodesk.AutoCAD.DatabaseServices.TransactionManager.  In this case, you need to make the same replacement as in paragraph two. <br><br>  As a result, we get the compiled .NET assembly.  It can be loaded into nanoCAD and run the game with the command ‚ÄúMINESWEEPER‚Äù. <br><img src="https://habrastorage.org/getpro/habr/post_images/f13/c95/ce2/f13c95ce2d311285f94b1e57994434ad.jpg" alt="Gamegesk"><br><br>  When I adapted the Minesweeper code for nanoCAD, it turned out to be extremely convenient and almost necessary to compile my project for both platforms at once. <br>  I made two configurations: the AutoCAD configuration and the nanoCAD configuration. <br><img src="https://habrastorage.org/getpro/habr/post_images/a69/0f9/a19/a690f9a19b2d853e1763029cb56e9474.jpg" alt="Configurations"><br><br>  We configure both configurations: specify the paths to acad.exe and ncad.exe, set the directories to which the libraries should be going.  In the nanoCAD configuration, we set the NCAD constant. <br><img src="https://habrastorage.org/getpro/habr/post_images/e03/17b/ebb/e0317bebb711ae848f61d83a33279b9d.jpg" alt="ConfigurationManager"><br><br>  Namespace connections are framed with #IF THEN ... #END IF preprocessing directives.  To bind full class names we use aliases: <br><pre> <code class="hljs nginx"> <span class="hljs-attribute"><span class="hljs-attribute">Imports</span></span> Platform = HostMgd Imports PlatformDb = Teigha</code> </pre><br>  The result is the following: <br><pre> <code class="hljs delphi">#<span class="hljs-keyword"><span class="hljs-keyword">If</span></span> NCAD <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> Imports Teigha.Runtime Imports HostMgd.ApplicationServices Imports Teigha.DatabaseServices Imports Teigha.Geometry Imports HostMgd.EditorInput Imports System Imports <span class="hljs-keyword"><span class="hljs-keyword">Platform</span></span> = HostMgd Imports PlatformDb = Teigha #<span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> Imports Autodesk.AutoCAD.Runtime Imports Autodesk.AutoCAD.ApplicationServices Imports Autodesk.AutoCAD.DatabaseServices Imports Autodesk.AutoCAD.Geometry Imports Autodesk.AutoCAD.EditorInput Imports System Imports <span class="hljs-keyword"><span class="hljs-keyword">Platform</span></span> = Autodesk.AutoCAD Imports PlatformDb = Autodesk.AutoCAD #<span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span></code> </pre><br>  Now you can collect the same code for both configurations.  Profit! </div><p>Source: <a href="https://habr.com/ru/post/137409/">https://habr.com/ru/post/137409/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137403/index.html">Windows 7 and Music Player Daemon</a></li>
<li><a href="../137404/index.html">Bootstrap 2.0 - HTML + CSS + JS UI Framework</a></li>
<li><a href="../137405/index.html">Serialization of static objects in C #</a></li>
<li><a href="../137407/index.html">ECM-educational program, part 1: electronic document flow and electronic archive</a></li>
<li><a href="../137408/index.html">A couple of git tricks</a></li>
<li><a href="../137410/index.html">How do you usually unpack the archive through the context menu</a></li>
<li><a href="../137411/index.html">Without knowing the ford, do not go into the water. Part two</a></li>
<li><a href="../137412/index.html">Creating animated tooltips with CSS3</a></li>
<li><a href="../137413/index.html">It is finished! Website iCloud "spoke" in Russian</a></li>
<li><a href="../137414/index.html">Integration of the physics engine Box2D into the UIKit application for iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>