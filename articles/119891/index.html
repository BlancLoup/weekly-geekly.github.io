<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>[Graphic editor on Canvas] Soft brush</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you are creating a graphic editor on canvas, you probably want to have a soft brush in your arsenal. So, this task is rather nontrivial and I will ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>[Graphic editor on Canvas] Soft brush</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage/ee31eb7e/072f2054/800185b9/9d188cae.png"><br>  If you are creating a graphic editor on canvas, you probably want to have a soft brush in your arsenal.  So, this task is rather nontrivial and I will try to highlight the main difficulties and suggest solutions. <br>  (in the picture an example of the work of a soft brush in GIMP) <br>  Before reading, I recommend to read the <a href="http://habrahabr.ru/blogs/canvas/119429/">previous article</a> . <br><br><a name="habracut"></a><br><br>  First of all, you need to understand the audience and the purpose of your editor.  This should help you to prioritize, of which two can be distinguished for this problem: <br><ul><li>  Work speed </li><li>  Quality of work </li></ul><br>  The solution I propose is based on the built-in capability of the canvas api that is suitable for this task.  Namely - the shadows.  The idea is this: when a user draws along an outline, in fact, a line is drawn somewhere outside the outline with a certain offset, and the shadow is adjusted so that it hits exactly where the user draws. <br><img src="https://habrastorage.org/storage/24b4585e/95ef73c0/396c65d5/62551b75.png"><br>  Here is an example implementation: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">&lt;!DOCTYPE html&gt; <br> &lt;html&gt; <br> &lt;head&gt; <br> &lt;title&gt;&lt;/title&gt; <br> &lt;meta http-equiv= <font color="#A31515">"Content-Type"</font> content= <font color="#A31515">"text/html; charset=UTF-8"</font> &gt; <br> &lt;style type= <font color="#A31515">"text/css"</font> &gt; <br> body { <br> margin: 0; <br> } <br> #cnvs { <br> outline: #000000 1px solid; <br> } <br> &lt;/style&gt; <br> &lt;script type= <font color="#A31515">"text/javascript"</font> &gt; <br> <font color="#0000ff">var</font> action = <font color="#A31515">"up"</font> ; <br> <font color="#008000">//: , ,   ,  ,   </font> <br> <font color="#0000ff">var</font> canvas,ctx,offset,points,bufer; <br> <br> <font color="#008000">// </font> <br> <font color="#0000ff">function</font> initcnvs(){ <br> canvas = <font color="#0000ff">document</font> .getElementById( <font color="#A31515">'cnvs'</font> ); <br> ctx = canvas.getContext( <font color="#A31515">'2d'</font> ); <br> ctx.lineWidth = 10; <br> <font color="#008000">// (   )</font> <br> offset = 1000; <br> <font color="#008000">// </font> <br> ctx.shadowBlur = 10; <br> ctx.shadowColor = <font color="#A31515">"#000000"</font> ; <br> ctx.shadowOffsetX = -offset; <br> points = <font color="#0000ff">new</font> Array(); <br> <font color="#008000">//     </font> <br> bufer = ctx.getImageData(0,0,canvas.width,canvas.height); <br> }; <br> <br> <font color="#008000">//    </font> <br> <font color="#0000ff">function</font> mDown(e){ <br> action = <font color="#A31515">"down"</font> ; <br> points.push([e.pageX,e.pageY]); <br> }; <br> <br> <font color="#008000">//   -      </font> <br> <font color="#0000ff">function</font> mUp(e){ <br> action = <font color="#A31515">"up"</font> ; <br> points = <font color="#0000ff">new</font> Array(); <br> bufer = ctx.getImageData(0,0,canvas.width,canvas.height); <br> }; <br> <br> <font color="#008000">//  -       </font> <br> <font color="#0000ff">function</font> mMove(e){ <br> <font color="#0000ff">if</font> (action == <font color="#A31515">"down"</font> ) { <br> ctx.putImageData(bufer,0,0); <br> points.push([e.pageX,e.pageY]); <br> ctx.beginPath(); <br> ctx.moveTo(points[0][0]+offset, points[0][1]); <br> <font color="#0000ff">for</font> (i = 1; i &lt; points.length; i++){ <br> ctx.lineTo(points[i][0]+offset,points[i][1]); <br> } <br> ctx.stroke(); <br> } <br> }; <br> &lt;/script&gt; <br> &lt;/head&gt; <br> &lt;body onload= <font color="#A31515">"initcnvs()"</font> onmousedown= <font color="#A31515">"mDown(event)"</font> onmousemove= <font color="#A31515">"mMove(event)"</font> onmouseup= <font color="#A31515">"mUp(event)"</font> &gt; <br> &lt;canvas id= <font color="#A31515">"cnvs"</font> width= <font color="#A31515">"800"</font> height= <font color="#A31515">"500"</font> &gt;&lt;/canvas&gt; <br> &lt;/body&gt; <br> &lt;/html&gt;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  ctx.shadowBlur is responsible for blurring the shadow, ctx.shadowColor is the color, ctx.shadowOffsetX is the offset along the X axis. <br>  The offset variable stores a safe offset so that the original line cannot reach the outline.  Canvas raster is stored in the bufer variable.  What for?  Here it turns out the main disadvantage of the algorithm.  After adding each new point to the line (and to the shadow, respectively), we have to redraw the entire line again.  If this is not done, and a line is drawn from the segments connecting two adjacent points, then its discontinuity will be noticeable.  (in the case of an opaque brush, this method would be suitable). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A natural question arises: if the number of points is large, will this affect the performance?  Answer: it will.  A noticeable slowdown begins after 5 seconds of drawing, but you can still draw without much difficulty for a long time. <br>  In some cases, this option may be acceptable. <br>  For example, in the <a href="http://muro.deviantart.com/">deviantart</a> editor, <a href="http://muro.deviantart.com/">this is</a> exactly the same or similar option. <br>  Alternatively, you can set a fixed size of the array and save the canvas to the buffer after filling, and then continue to draw from this point.  In the place of the gap will be a small artifact.  Someone can make such an option. <br><br>  Of course, there are more options.  Here, let's say, is not the easiest. <br><img src="https://habrastorage.org/storage/f8443737/28966b45/e5300997/260849c0.png"><br>  In this figure I noted which pieces of the line would have to be drawn separately.  Semicircles will need to be filled with a radial gradient from opaque to transparent.  Other pieces - linear gradient. <br><br>  I‚Äôll say right away - in this algorithm, there are a lot of things that are not very complex, but I won‚Äôt give you any boring mathematics.  If you really need it, it is better to bring it out yourself in order to fully understand all the points.  Here are the highlights of the algorithm: <br><ul><li>  when pressing the button you need to remember the starting point </li><li>  it is necessary to draw a semicircle with a radial gradient when the second point is known (to turn it towards this point) </li><li>  further trapeziums are drawn taking into account the angles between the line segments </li><li>  trapeziums are filled with a gradient: transparent - opaque - transparent from one base to another </li><li>  when released - you need to draw the final semicircle </li></ul><br><br>  There is still a fairly simple way to implement - <a href="http://habrahabr.ru/blogs/canvas/119891/">sprites</a> . <br><br>  That's all I wanted to talk about today.  In the comments I will answer all your questions. <br><br>  PS: thanks to <a href="https://habrahabr.ru/users/serator/" class="user_link">Serator</a> for prompting to use outline instead of border.  This eliminated the error in the coordinates. <br>  Thanks to the user <a href="https://habrahabr.ru/users/theshock/" class="user_link">TheShock</a> for a couple of sensible comments. <br><br>  Previous articles in the series: <br>  <a href="http://habrahabr.ru/blogs/canvas/119429/">Sketch Brush</a> </div><p>Source: <a href="https://habr.com/ru/post/119891/">https://habr.com/ru/post/119891/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../119886/index.html">Opera Mini 6 for iOS</a></li>
<li><a href="../119887/index.html">Wikipedia - UNESCO World Heritage List</a></li>
<li><a href="../119888/index.html">Fedora 15 is available for download.</a></li>
<li><a href="../119889/index.html">10 best songs related to computers anyway</a></li>
<li><a href="../119890/index.html">A small comment about the "activity" of RAO</a></li>
<li><a href="../119892/index.html">GPU support in MATLAB math package</a></li>
<li><a href="../119894/index.html">Get out!</a></li>
<li><a href="../119895/index.html">Somewhat unexpected caching behavior when boxing</a></li>
<li><a href="../119896/index.html">Yandex bidding on NASDAQ started at $ 35 per share</a></li>
<li><a href="../119898/index.html">Code Compression Techniques</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>