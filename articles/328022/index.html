<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interactive 3D-installation based on "Star Wars"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Somewhere in a distant galaxy (albeit in ours too), the unofficially Star Wars day is celebrated on May 4th. It is not by chance that he was chosen; f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interactive 3D-installation based on "Star Wars"</h1><div class="post__text post__text-html js-mediator-article">  Somewhere in a distant galaxy (albeit in ours too), the unofficially Star Wars day is celebrated on May 4th.  It is not by chance that he was chosen; from the movie is a quotation confirming ‚ÄúMay the Force be with you‚Äù (‚ÄúMay the Force be with you‚Äù), how does it sound to the fans of ‚ÄúMay the fourth be with you‚Äù.  In this post, we want to congratulate habrovchan, those who have passed to the dark side.  We want to tell about the 3D-installation creation.  It will be interactive and thematic. <br><br><img src="https://habrastorage.org/web/ae8/166/324/ae8166324ff44a52be4f7f4faefbef2a.jpg"><br><a name="habracut"></a><br><h2>  Introduction </h2><br><h4>  Prehistory </h4><br>  My wife inspired me on this project when we went shopping before Christmas together.  The next episode of "Star Wars" just came out, and the shelves in the shops were full of toys from this movie.  My wife called me and asked if the Hackster competition on the Star Wars theme had ended.  She said she saw some interesting things from which to collect something cool. <br><br>  As a result, we bought a few toys and came up with a fun interactive installation on the wall. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We took a small panel as a basis, placing a sound card on it and, of course, light bulbs so that there was a lot of light.  We also installed a motion sensor and an ultrasonic distance sensor to detect people nearby.  The light sensor is also present. <br><br>  Our panel is interactive, it responds to a person standing in front of it or passing by.  Darth Vader's eyes light up red, activation and deactivation of the lightsaber are accompanied by sounds that everyone has known since childhood.  The Death Star is also used as a night lamp.  It turns on in the dark when the motion sensor is triggered.  Finally, sometimes Darth Vader talks. <br><br>  It happens spontaneously, but not constantly.  The basic idea is that this should happen ‚Äúwhen you least expect it.‚Äù  So Darth Vader has already scared several members of our family. <br><br>  To manage the installation, you can also use the universal Windows 10 application and the cloud-based web interface API Particle.io. <br><br>  This is how it looks now (the entire panel ( <b>122 x 91 cm</b> )). <br><br><img src="https://habrastorage.org/web/939/592/b75/939592b751324438b06eb67c2c356e75.gif"><br><br><h4>  Design </h4><br>  The installation consists of four modules that interact with the <b>I2C</b> bus.  The main controller is implemented on the basis of the Particle Photon platform, it is responsible for interrogating sensors, managing other cards and communicating through the cloud.  There are three more auxiliary controllers based on the <b>Adafruit Trinket Pro 5V</b> , they control the lightsaber, the Death Star, the eyes of Darth Vader, and sound effects. <br><br>  Thanks to the white LED light, the Death Star is a great night light.  Adafruit NeoPixel Jewels LED modules (seven NeoPixels LEDs in each) are installed in the eyes of Darth Vader.  The lightsaber is <b>100</b> RGBW NeoPixels LEDs (a piece of tape with <b>144</b> LEDs per meter).  In the helmet of Darth Vader (in the slot for the mouth) and in the Death Star is determined by the dynamics. <br><br><h2>  Assembly process </h2><br><h4>  Panel </h4><br>  Plywood is usually sold in sheets measuring <b>122 x 244 cm</b> , I cut it to <b>122 x 91 cm</b> .  To finish looked clean and tidy, sheets of higher quality were selected.  However, any plywood needs to be lightly pre-processed along the edges and on the front side.  To do this, I used 220 grit sandpaper. Then I wiped the treated surfaces with a damp cloth and let them dry completely. <br><br>  We covered our panel with paint <b>Glidden Blue Gray Sky (30BB 32/067)</b> . <br><br><img src="https://habrastorage.org/files/638/033/c94/638033c948ae45aaa03857cb741b6d16.jpg"><br><br><h4>  Frame </h4><br>  The frame is made of pine slats <b>2.5 x 5 cm in size (1.9 to 4.45 cm)</b> .  The grooves turned out <b>122</b> and <b>91 cm</b> for the long and short sides, respectively.  Along the edges of the rails, slices at an angle of <b>45 ¬∞ are</b> added to get a frame for a full-fledged subframe. <br><br>  Having prepared the slats and squeezing them tightly into place on each side of the board, it is necessary to finally fix them with wood glue and corner clamps.  Glue the edges so that the adjacent sides are at right angles. <br><br>  To reinforce the frame, I used <b>8</b> <b># 18 x 3/4 "</b> wire nails ( <b>2</b> pieces for each corner). We need to drill a guide hole for each nail, otherwise we risk splitting the wood. The tip of the nail must be drowned with a small punch. <br>  After the glue dries, fill the corners with wooden putty to get rid of the gaps.  It is also necessary to putty the places where the nails were driven. <br><br>  Before painting, go over the entire surface of the frame with sandpaper, and then wipe the treated surfaces with a damp cloth and dry completely. <br><br>  We painted the <b>frame</b> with <b>Glidden Gray Metal (00NN 10/000)</b> . <br><br><img src="https://habrastorage.org/files/b64/438/d1d/b64438d1dd26463bb9f262d4e6c114fc.jpg"><br><br><h4>  Frame mount </h4><br>  The frame is attached to the panel using small brass hinges, which are sold at any hardware store.  A slight overlap in the front can be eliminated with a large stick for mixing paint with a thickness of about <b>4‚Äì5 mm</b> .  Next, turn the panel face down and put a stick in order to achieve the desired height.  Fasten the hinges on the panel with the attached screws.  The guide hole must be drilled for each screw, otherwise we risk splitting the wood.  It is important to be careful and leave a gap from the front of the panel each time. <br><br>  I have only <b>12</b> hinges connecting the frame with the board ( <b>3</b> along each side).  Two lateral hinges are located at a distance of about <b>13 cm</b> from the inner corner, and the third is centered on the corresponding side.  Below is the front side of the panel, it shows a gap between the panel and the frame. <br><br><img src="https://habrastorage.org/files/189/02c/eb5/18902ceb515748c197262643fcacb574.jpg"><br><br><h4>  Placing stickers and models </h4><br>  Darth Vader, the lightsaber and the Death Star (these are all fixtures) were sold immediately with stickers that create a special visual effect: they seemed to break through the base.  We made the background gray specifically to highlight this effect. <br><br>  Next, select the optimal placement of these three elements on the panel.  Here you can rely on your artistic taste.  Having defined the location, we attach the stickers in accordance with the attached instructions.  Please note that the instructions say that the painted wall must be given up to two weeks to dry thoroughly.  We really waited two weeks before sticking stickers.  This is what all three stickers look like. <br><br><img src="https://habrastorage.org/files/43f/3f7/37d/43f3f737da8d4546a814c3936b31569d.jpg"><br><br>  We bought additional stickers on the Amazon website, and not all of them came in handy from the kit.  I think that everyone will decide for himself what quantity and what type of stickers he wants to make. <br><br>  I enhanced the 3D effect with attack plane models (Hot Wheels TIE Fighters spaceships), attaching them to the panel with a glue gun.  You can skip this step. <br><br><img src="https://habrastorage.org/files/083/4c8/555/0834c855598943898da73f87563d9fc0.jpg"><br><br>  Included wall fixtures have all the necessary screws to fix the fixtures on the panel.  As usual, I recommend to drill the guide holes. <br><br><h4>  Darth Vader Helmet </h4><br>  Of all the lamps, you must first remove the built-in electronics.  Fortunately, for this you need to unscrew a few screws. <br><br>  First, remove the back cover from the head of Darth Vader.  Next, unscrew the screws holding the LEDs and the switch, cut off the wires leading to the battery compartment.  These components may be useful for another project.  :) <br><br><img src="https://habrastorage.org/files/60d/b57/5e8/60db575e8d304978bb09f2f295a16f3a.jpg"><br><br>  Then, to prepare the NeoPixel Jewels LED modules, we connect the wires <b>22 AWG</b> to each of the three terminals.  I recommend using the red wire for <b>5 V</b> , black for grounding and green for the interface.  Cut off pieces about <b>90 cm</b> long and first solder the red wire to contact <b>5 V of the</b> first Jewel module, then the black wire.  Finally, we attach the green wire to the <b>Data In</b> contact. <br><br>  The next Jewel module will connect to the first one.  Cut the wires of three colors again, this time <b>25 cm</b> .  Solder the red wire to the <b>5 V</b> contacts on the first and second Jewel module.  The red wire is soldered to the <b>GND</b> contacts on the first and second Jewel module.  Finally, the green wire is to the <b>Data Out</b> contact on the first module and the <b>Data In</b> contact on the second module. <br><br><img src="https://habrastorage.org/files/656/51d/f79/65651df79e6b4e2290fe0d49e6c9615f.jpg"><br><br>  To attach the modules to the plate of the helmet, use the tubes for drinks.  They are needed so that the light can be seen through the dark eye sockets.  First, cut into pieces of 5 cm (in this example, thicker tubes are used, but the usual ones are also suitable).  Next, place the modules closer to the top of the helmet.  To attach them to the back of the NeoPixel modules and to the helmet plate, use an adhesive gun.  One tube is enough for reliable fixation, but, just in case, I decided to use the second one. <br><br><img src="https://habrastorage.org/files/410/2af/bff/4102afbff92a472f8d724e6e068fa531.jpg"><br><br>  Finally, we need to install the speaker in the helmet.  We make it to the plate at the level of the mouth.  In the helmet there is a small piece of metal that would muffle the sound, so it needs to be removed.  To do this, simply unscrew several screws.  Further, with the help of a glue gun, we fix the speaker on the helmet plate. <br><br><img src="https://habrastorage.org/files/0c9/b6b/b25/0c9b6bb25ac2404598f3d2f20baf52c1.jpg"><br><br>  To remove the wires, we drill a <b>6 mm (1/4 ")</b> hole in the center of the plate. Don't forget, you will need to attach the plate to the panel without the front of the helmet. Therefore, it is worth drilling new holes in the panel through the holes in the plate. Thus, the wires from the helmet will go through the hole in the plate and the hole in the panel so that they can be assembled into one bundle at the back. <br><br><img src="https://habrastorage.org/files/51e/32d/288/51e32d2883b746ea9220c8e969df4bd4.jpg"><br><br>  Connecting the LEDs and the speaker, let the wires through the hole and put the helmet plate in place.  Do not forget to tighten the screws.  :) <br><br><h4>  Lightsaber </h4><br>  Disassembling the lightsaber is a little more difficult.  In the end, you should have four separate elements. <br><br>  First, remove the red plastic tube that mimics the beam.  She just unscrews and pulls out.  Inside it you will find the second part - a long transparent plastic tube.  This is a rolled piece of plastic, on which we will then fix a strip of LEDs NeoPixel.  Set this item aside. <br><br>  The next element to be removed is the base plate.  Unscrew the three screws.  It should turn out like this. <br><br><img src="https://habrastorage.org/files/bce/172/59a/bce17259a2554b59b2104b64d8482ec1.jpg"><br><br>  Next, remove the side of the handle of the lightsaber and remove the entire electronic filling. <br><br><img src="https://habrastorage.org/files/601/8b4/b04/6018b4b04af3416d89860b3aec161471.jpg"><br><br>  After that we cut the NeoPixel ribbon, leaving <b>100 LEDs</b> on it.  If you have never done this, the <a href="https://learn.adafruit.com/adafruit-neopixel-uberguide">Adafruit Uberguide</a> guide will be helpful. <br><br>  Cut off three pieces of wire <b>22 AWG</b> approximately <b>60 cm</b> each.  We take the red, black and green wires (by the way, personally, I often use green, white or yellow wires as the interface wire for NeoPixel modules), solder the red wire to contact <b>5 V</b> , black - to contact <b>GND</b> , and green - to contact <b>Data In</b> . <br><br>  Then very carefully we stretch the NeoPixel tape into a transparent plastic tube, trying not to bend it strongly. <br><br><img src="https://habrastorage.org/files/2d0/945/de6/2d0945de6fcf489f88b27c0cef92759f.jpg"><br><br>  Then we pass the wires through the bottom plate, as shown in the photo below. <br><br><img src="https://habrastorage.org/files/b71/0cc/26e/b710cc26ee1d4507a7f0debb19e8594c.jpg"><br><br>  Stretching the wires, fasten the side plate with five screws.  Then we attach the back panel and pull the wires through the hole in which the switch was located.  Where wires will pass through the main panel, it is necessary to drill a hole with a diameter of <b>6 mm (1/4 ")</b> . <br><br><h4>  Layout </h4><br>  We make a prototype of each scheme, using the images in the spoilers. <br><blockquote><div class="spoiler">  <b class="spoiler_title">Main controller and lightsaber controller</b> <div class="spoiler_text">  Scheme (main controller) <br><img src="https://habrastorage.org/files/963/d29/2eb/963d292ebfd849bd9b3ab6dae5a3dd87.png"><br><br>  Scheme (lightsaber controller) <br><img src="https://habrastorage.org/files/f3a/68a/88f/f3a68a88fc0747f89c507990a5b70ab4.png"><br><br>  How did I do <br><img src="https://habrastorage.org/files/2d0/6c8/434/2d06c843429447c5b3576ac78562fb0a.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Sound controller</b> <div class="spoiler_text">  Scheme <br><img src="https://habrastorage.org/files/89c/4ec/2b9/89c4ec2b984a459cb34e44b3347c5305.png"><br><br>  How did I do <br><img src="https://habrastorage.org/files/b37/a4b/cda/b37a4bcda1314fde8270cf3cc429ae4c.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Death Star / Darth Vader Eye Controller</b> <div class="spoiler_text">  Scheme <br><img src="https://habrastorage.org/files/5bd/6b8/5eb/5bd6b85ebbb74e67b8e81c831eb06987.png"><br><br>  How did I do <br><img src="https://habrastorage.org/files/c70/f04/676/c70f0467669a4b1c82dbf83cc2ff6996.jpg"><br><br>  Death Star Controller close-up <br><img src="https://habrastorage.org/files/60a/44f/657/60a44f65720f4f8a85fe7326f4031a01.jpg"><br><br>  Darth Vader eye controller close-up <br><img src="https://habrastorage.org/files/ecb/81a/b90/ecb81ab90fa84dac998632d9fd60931b.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Additionally</b> <div class="spoiler_text">  So look the other parts. <br><br>  Motion sensor, ultrasonic sensor and NeoPixel ring (top to bottom) <br><img src="https://habrastorage.org/files/24a/6f7/e7f/24a6f7e7fe17462cb07894574e6290d3.jpg"><br><br>  One NeoPixel module for testing the eyes of Darth Vader <br><img src="https://habrastorage.org/files/7f7/993/560/7f7993560e3f4b4986751fbc4f6b8aea.jpg"><br><br>  <b>12V</b> miniature wiring board for all boards <br><img src="https://habrastorage.org/files/cab/d8d/d66/cabd8dd662574fefbef15caa8f67553f.jpg"><br></div></div></blockquote><br>  Please note that you should be able to assemble circuit board layouts according to schemes. <br>  <b>Note</b>  I used: <br><ul><li>  additional high single-row circuit boards with leads in its layout, and then standard circuit boards with leads during soldering on printed circuit boards; </li><li>  NeoPixel ring instead of NeoPixel ribbon (for a lightsaber); </li><li>  one NeoPixel module instead of two (for eyes); </li><li>  miniature circuit board for <b>12 V</b> wiring to all other boards. </li></ul><br>  In the end, we get this scheme. <br><br><img src="https://habrastorage.org/files/e6d/706/4ac/e6d7064ac2b34f3e8e4c72399ce0c706.jpg"><br><br>  To implement this part of the project will take considerable time (although, of course not 2 weeks :)), in addition, you should pay close attention to the layout and placement of components on the layouts.  By the way, I used Adafruit Perma-Proto mockups. <br><br>  If everything went well, you will get this result. <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/oYCJgog5fec%3Fecver%3D1&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgsKyvGmhAFh6WartFd7XMqPN0wjg"></iframe><br><br><h4>  Printed circuit boards </h4><br>  After assembling and testing the layouts, the schemes can be transferred to printed circuit boards (in my case, this is Perma-Proto). <br><br>  Alternately transfer the circuit, soldering the details.  It is better that you have spare parts to copy the scheme, rather than transfer it.  This will help to avoid mistakes. <br><br>  <b>Note</b> : <br><ul><li>  I used standard single-row circuit boards with leads for power connections and I2C connections.  For wiring power separated by two contacts.  For I2C separated by three contacts. </li><li>  Took <b>3-pin terminal</b> blocks for two NeoPixel connections.  These are <b>3.5 mm</b> parts.  They should be soldered to the board diagonally. </li><li>  Also, I used the <b>1.5</b> <b>-pin</b> ( <b>1.5 ")</b> IC Sockets <b>28-pin</b> connectors for Trinket Pro. </li><li>  To accommodate the Photon module, I took <b>0.25-centimeter (0.1 ") 36-pin</b> mounting connectors with leads. I cut off two sets of 12 pins each for the Photon module. </li><li>  To connect a coin-type battery to the <b>GND</b> and <b>VBAT pins of</b> the Photon module, I took two pins from the mounting socket with the leads. </li><li>  At least two wiring diagrams require a double set of circuit boards for <b>12 V</b> jumpers, or you can use 3 sets for one of the diagrams.  Power will be supplied from the back of the panel, and it must be diluted across all the boards. </li><li>  <b>I2C</b> bus must be connected to each circuit board.  For this, I soldered two sets of circuit boards for at least two circuits. </li></ul><br>  In the spoilers below you will find photos of the resulting schemes. <br><blockquote><div class="spoiler">  <b class="spoiler_title">General form</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/89f/c29/18b/89fc2918be154952ad60b11654c3b400.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Closeup side view</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d59/d01/1d7/d59d011d727e47449015b452f7073197.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Death Star / Darth Vader Eye Controller</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/b7d/73c/f15/b7d73cf1524c4216aef2563015859389.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Main controller</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/877/60d/383/87760d383ab4463d9ecdb2ddccd544be.jpg"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Light sword controller</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/cfe/9e7/8eb/cfe9e78ebfd7461baa0abfcd77ad8f32.jpg"><br></div></div></blockquote><br>  If everything went well, you will get this result. <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/DzL3T-sStug%3Fecver%3D1&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgIA5Y3LOwgwlR--swDTNozzYrjPQ"></iframe><br><br><h4>  The Death Star </h4><br>  I chose the Death Star to place all the electronic components in it.  It fits perfectly into the concept and provides enough free space. <br><br>  First you need to disassemble it and remove all the basic electronics.  First, unscrew the screws from the back side, then the screws holding the electronic components, and then cut off the wires from the battery compartment. <br><br><img src="https://habrastorage.org/files/26b/a04/020/26ba040201264df5bb2a965d3e77a3a2.jpg"><br><br>  The previously collected schemes are fixed on the panel of the Death Star.  To do this, use spacers (or pins) <b>M3</b> , screws <b>M3</b> , nuts <b>M3</b> and two washers <b>M3</b> for each spacer.  In total there will be eight spacers (two for each PCB). <br><br>  We start by attaching brass pins to each board with the M3 nut (for this you may need to remove the Trinket and Photon modules). <br><br>  Three smaller boards can be placed using existing slots on the plate.  For a large board you need to drill holes.  Next, from the outside of the plate we screw in the screw and washer, place a large board and mark the points where the pins will be fixed with a pencil.  Remove the board and drill holes for the screws.  The order of the boards does not matter, so anyone can choose the optimal layout for themselves and then fix the boards. <br><br>  By analogy with the helmet of Darth Vader, we need a centering hole, which needs to be compared with the hole in the panel.  Through it, the wires will go to the back of the panel, where the lightsaber and Darth Vader's helmet will be connected. <br><br>  I got this layout boards.  Pay attention to the hole drilled in the upper left. <br><br><img src="https://habrastorage.org/files/284/fb4/33c/284fb433c1c24c91b3009d4a1e6367da.jpg"><br><br>  Next, connect the two-wire LED backlight connector and fix it with a heat shrink tubing.  In the photo below you can see the preparation of the LED. <br><br><img src="https://habrastorage.org/files/9ea/530/107/9ea530107e27402aa2a1af42a8d52399.jpg"><br><br>  The second speaker will be installed inside the Death Star.  It turned out that the mounting holes on the speaker matched the screws inside the Death Star, as shown below.  Therefore, we connect the speaker to the sound card terminals.  After that, we fix the LED illumination with the help of a glue gun over the green plastic dome inside the Death Star. <br><br><img src="https://habrastorage.org/files/828/3d1/c35/8283d1c356bc4a12a0c8963588b45598.jpg"><br><br>  By analogy with the process of mounting the LED, we draw the conclusions of the photoresistor and draw wires through the holes on the right side of the dome (away from the lightsaber).  On the inside, we connect the two-wire connector to the photoresistor and place it in the heat shrink tube, as shown below. <br><br><img src="https://habrastorage.org/files/0c3/58d/ff6/0c358dff62f54edfba62639fb5b460bb.jpg"><br><br>  At the bottom of the dome, drill holes with a diameter of <b>1.3 cm (1/2 ")</b> for a motion sensor and an ultrasonic distance sensor. Connect the four-wire connector to each sensor and pull the sensors into the holes, then fix them to the outside of the dome with an adhesive gun. <br><br><img src="https://habrastorage.org/files/2c6/ab1/d2a/2c6ab1d2a7b444708cfbaa5bb7071fe2.jpg"><br><br>  Next, we cut two sets of three wires <b>22 AWG</b> approximately <b>60 cm</b> long for NeoPixel connections and connect them to the terminals on the board.  Red wire - for 5V, black - for <b>GND</b> and green (or yellow) - for the interface.  Color coding will further simplify the connection of components on the rear panel of the board.  With the help of electrical tape and a marker, I marked these wires to easily identify them later (I wrote "lightsaber" and "Darth Vader"). <br><br>  Next, cut off two more wires for the speaker: red and black (it‚Äôs better to take <b>26 AWG</b> , but <b>22 AWG</b> will work too), and connect them to the terminals.  Connect the two-wire socket to the <b>12 V</b> connector on the Photon board. <br><br>  At this stage, the wires can be stripped and secured with cable ties and electrical tape.  First, we wind up six wires from the NeoPixel, wires from the two speakers and a power wire through the hole in the plate.  With the help of electrical tape, so that they cannot be pulled out from the back side of the board, after which we bundle together and tie them together with ties. <br><br><img src="https://habrastorage.org/web/cde/5bb/895/cde5bb895d7e4a1ea060f6f64f370e53.jpg"><br><br>  Now we collect the Death Star and pass all the wires through the hole in the panel. <br><br><img src="https://habrastorage.org/web/9df/7b5/91a/9df7b591a20a4cacb109bd4b61013126.jpg"><br><br>  At this stage, we connect all the devices.  The wires on the back side of the board must be connected using the lugs, after they are secured with tape, using electrical tape or some kind of adhesive fasteners.  Do not leave too much margin for the length of the wires, but it should be enough so that, if necessary, you can again remove any of the components. <br><br><img src="https://habrastorage.org/files/a81/d22/60a/a81d2260aa20451eb42604d429cf96ef.jpg"><br><br><h2>  Software and applications </h2><br>  The software for this project can be divided into three categories. <br><br>  <b>First</b> is the Photon firmware.  This software manages other cards and communicates with them via the <b>I2C</b> bus.  <b>Secondly</b> , this is the Arduino code that is loaded into each of the three Trinket Pro modules.  <b>Thirdly</b> , this is the Windows 10 UWP software that is used on Windows 10 devices to remotely manage our interactive installation. <br><br>  The code in the spoiler below is the firmware for Photon.  The class files referenced in the code can be found in <a href="https://github.com/porrey/StarWars">the GitHub repository for this project</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Some code :)</b> <div class="spoiler_text"><pre><code class="javascript hljs">#include <span class="hljs-string"><span class="hljs-string">"Controller.h"</span></span> #include <span class="hljs-string"><span class="hljs-string">"HC-SR04.h"</span></span> #include <span class="hljs-string"><span class="hljs-string">"SensorSmoothing.h"</span></span> <span class="hljs-comment"><span class="hljs-comment">// *** // ***  ,    HC-SR04. // *** #define TRIGGER_PIN D2 #define ECHO_PIN D3 // *** // ***       // *** #define MOTION_OUT D4 #define MOTION_ENABLED D5 // *** // ***   // *** #define PHOTORESISTOR_PIN A0 // *** // ***     // *** #define NUMBER_OF_SAMPLES 5 // *** // ***    // *** #define DEFALT_VOLUME 15 // *** // ***  ,   // ***   . // *** retained int _volume = DEFALT_VOLUME; // *** // ***  . // *** Controller _controller = Controller(); // *** // ***   HcSr04  // *** HC-SR04 (  ). // *** HcSr04 _ranging = HcSr04(); // *** // ***     // ***  . // *** bool _motion = false; // *** // ***     // ***  . // *** double _distance = 0.0; // *** // ***     . // *** int _light = 0; // *** // ***        // ***    NUMBER_OF_SAMPLES. // ***       // ***     . // *** SensorSmoothing&lt;double&gt; _distanceSample = SensorSmoothing&lt;double&gt;(NUMBER_OF_SAMPLES); // *** // ***     // *** Timer _sensorTimer(1000, onSensorTimer); // *** // ***     // *** int _lastEventTime = 0; // *** // ***   // *** #define DEFAULT_LIGHT_THRESHOLD 1000 retained int _lightThreshold = DEFAULT_LIGHT_THRESHOLD; bool _lightBelowThreshold = false; bool _deathStarIsOn = false; // *** // ***     // *** retained int _minimumEventTime = 20; //  retained int _minimumDistance = 127; //  void setup() { // *** // ***      // *** Particle.publish("Setup", "Started"); // *** // ***      // *** STARTUP(System.enableFeature(FEATURE_RETAINED_MEMORY)); // *** // ***   HC-SR04 (  ) // *** _ranging.begin(TRIGGER_PIN, ECHO_PIN); // *** // ***   I2C // *** Wire.begin(); // *** // ***   // *** _controller.begin(_volume); // *** // ***   D7   // ***   // *** pinMode(D7, OUTPUT); digitalWrite(D7, LOW); // *** // ***    // *** Particle.variable("motion", _motion); Particle.variable("distance", _distance); Particle.variable("light", _light); // *** // ***  . // *** Particle.function("controller", controllerWebApi); Particle.function("parameter", parameterWebApi); Particle.function("test", testWebApi); // *** // ***        // ***  . // *** _lastEventTime = Time.now(); // *** // ***  . // *** _sensorTimer.start(); // *** // ***      , // ***        . // *** delay(3000); // *** // ***  // *** _controller.darthVaderOff(); _controller.lightSaberOff(); _controller.deathStarOff(); // *** // ***      // *** Particle.publish("Setup", "Completed"); } void loop() { // *** // ***    _lightBelowThreshold // *** bool previousLightBelowThreshold = _lightBelowThreshold; // *** // ***    // *** if (_motion) { // *** // ***       // ***    // *** . // *** if (_light &lt; _lightThreshold) { if (!previousLightBelowThreshold) { Particle.publish("Light", "Below Threshold"); } _lightBelowThreshold = true; // *** // ***    . // *** _deathStarIsOn = true; _controller.deathStarOn(); } else { if (previousLightBelowThreshold) { Particle.publish("Light", "Above Threshold"); } _lightBelowThreshold = false; } // *** // *** ,       . // *** if (_distance &lt; _minimumDistance) { // *** // *** ,      // ***    // ***  . // *** if ((Time.now() - _lastEventTime) &gt; _minimumEventTime) { Particle.publish("Object", "Detected"); _lastEventTime = Time.now(); _controller.randomEvent(); } } } else { // *** // ***   . // *** if (_deathStarIsOn) { // *** // ***      ,  // ***   . // *** _deathStarIsOn = false; _controller.deathStarOff(); } } // *** // ***  // *** delay(150); } void onSensorTimer() { // *** // ***    // *** bool previousMotion = _motion; // *** // ***     . // *** _motion = (digitalRead(MOTION_OUT) == HIGH); // *** // ***        // ***  . // *** if (!previousMotion &amp;&amp; _motion) { Particle.publish("Motion", "Detected"); if (_lightBelowThreshold) { Particle.publish("Light Level", "Below Threshold: " + String(_light) + "/" + String(_lightThreshold)); } else { Particle.publish("Light Level", "Above Threshold: " + String(_light) + "/" + String(_lightThreshold)); } // *** // ***        // *** ,   . // *** Particle.publish("Distance", String(String(_distance / 2.54).toInt()) + " in / " + String(String(_minimumDistance / 2.54).toInt()) + " in"); // *** // ***        // ***    . // *** Particle.publish("Time", "Last Event: " + String(Time.now() - _lastEventTime) + " second(s) ago"); } else if (previousMotion &amp;&amp; !_motion) { Particle.publish("Motion", "Reset"); } // *** // ***       // ***  // *** _distance = getRangeEx(); // *** // ***   // *** _light = analogRead(PHOTORESISTOR_PIN); } // *** // *** -API // *** int testWebApi(String command) { // *** // ***  // *** Particle.publish("Test", "Running"); _controller.setVolume(10); delay(500); _controller.darthVaderOn(); delay(1000); _controller.darthVaderVoice(0); delay(18000); _controller.darthVaderOff(); delay(3000); _controller.darthVaderOn(); delay(1000); _controller.darthVaderVoice(1); delay(5000); _controller.darthVaderOff(); delay(3000); _controller.darthVaderOn(); delay(1000); _controller.darthVaderVoice(2); delay(5000); _controller.darthVaderOff(); delay(3000); _controller.darthVaderOn(); delay(1000); _controller.darthVaderVoice(3); delay(5000); _controller.darthVaderOff(); delay(3000); _controller.darthVaderOn(); delay(1000); _controller.darthVaderVoice(4); delay(5000); _controller.darthVaderOff(); delay(3000); _controller.darthVaderOn(); delay(1000); _controller.darthVaderVoice(5); delay(5000); _controller.darthVaderOff(); delay(3000); _controller.darthVaderOn(); delay(1000); _controller.darthVaderVoice(6); delay(5000); _controller.darthVaderOff(); delay(3000); _controller.darthVaderOn(); delay(1000); _controller.darthVaderVoice(7); delay(5000); _controller.darthVaderOff(); delay(3000); _controller.darthVaderOn(); delay(1000); _controller.darthVaderVoice(8); delay(5000); _controller.darthVaderOff(); delay(3000); _controller.lightSaberOn(7000); delay(2000); _controller.deathStarOn(); delay(5000); _controller.deathStarOff(); Particle.publish("Test", "Completed"); return 1; } // *** // *** -API // *** int parameterWebApi(String command) { int returnValue = 0; // *** // ***     // *** ,  ,    // ***   . // *** int equalIndex = command.indexOf("="); // *** // ***      // ***  . // *** if (equalIndex &gt; 0) { // *** // ***     . // *** String parameterName = command.substring(0, equalIndex); String value = command.substring(equalIndex + 1, command.length()); if (parameterName == "volume") { _volume = value.toInt(); _controller.setVolume(_volume); } else if (parameterName == "minimumDistance") { _minimumDistance = value.toInt(); } else if (parameterName == "lightThreshold") { _lightThreshold = value.toInt(); } else if (parameterName == "minimumEventTime") { _minimumEventTime = value.toInt(); } // *** // ***  . // *** Particle.publish("Set Parameter", parameterName + " = " + value); // *** // ***  . // *** returnValue = value.toInt(); } else if (equalIndex == -1) { // *** // ***     , // ***  . // *** if (command == "volume") { returnValue = _volume; } else if (command == "minimumDistance") { returnValue = _minimumDistance; } else if (command == "lightThreshold") { returnValue = _lightThreshold; } else if (command == "minimumEventTime") { returnValue = _minimumEventTime; } // *** // ***  . // *** Particle.publish("Get Parameter", command); } else if (command == "reset") { // *** // ***     . // *** _volume = DEFALT_VOLUME; _controller.setVolume(_volume); _minimumDistance = 50 * 2.54; _lightThreshold = 1000; _minimumEventTime = 20; _lightThreshold = DEFAULT_LIGHT_THRESHOLD; // *** // ***  . // *** Particle.publish("Reset Parameters", ""); returnValue = 1; } return returnValue; } // *** // *** -API // *** int controllerWebApi(String command) { int returnValue = 0; // *** // ***  . // *** Particle.publish("Controller", command); // *** // ***    . // *** returnValue = _controller.executeCommand(command); return returnValue; } double getRangeEx() { double returnValue = 0; // *** // ***    . // *** Range range; if (_ranging.getRange(&amp;range)) { // *** // ***  . // *** _distanceSample.addSample(range.distance); // *** // ***   . // *** returnValue = _distanceSample.average(); } else { // *** // ***  . // *** if (range.result == timeFailed) { switch (range.pingTime.result) { case alreadyActive: Particle.publish("Result", "The sensor is busy."); break; case timeout: Particle.publish("Result", "The sensor did not respond."); break; } } else if (range.result == underRange) { switch (range.result) { case underRange: Particle.publish("Result", "The object is too close."); break; case overRange: Particle.publish("Result", "No object is in range."); break; } } else { Particle.publish("Result", "Unknown Error."); } } return returnValue; }</span></span></code> </pre> <br></div></div><br>  Below is a screenshot of what we did. <br><br>  Main screen for managing effects and menus. <br><img src="https://habrastorage.org/files/940/84d/002/94084d00261f435991586e0654adcc74.jpg"><br><br>  Setting up a cloud API for Photon and setting parameters. <br><img src="https://habrastorage.org/files/f93/94f/57a/f9394f57af024ca182eca2f5ead6afe3.jpg"><br><br>  The Windows 10 code accesses the Particle.io cloud API using an <code>HttpClient</code> to perform certain functions using <code>Particle.function()</code> , as shown below. <br><br><pre> <code class="javascript hljs">protected <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> virtual Task&lt;int&gt; Execute(string functionName, string command) { int returnValue = <span class="hljs-number"><span class="hljs-number">0</span></span>; HttpClient httpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); HttpRequestMessage request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpRequestMessage(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> values = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;KeyValuePair&lt;string, string&gt;&gt; { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> KeyValuePair&lt;string, string&gt;(<span class="hljs-string"><span class="hljs-string">"args"</span></span>, command) }; FormUrlEncodedContent content = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FormUrlEncodedContent(values); request.Headers.Authorization = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Identity.Authentication; request.Method = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Method; request.RequestUri = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Identity.BaseUri, string.Format(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Resource, functionName)); request.Content = content; HttpResponseMessage response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> httpClient.SendAsync(request); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response.IsSuccessStatusCode) { string json = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.Content.ReadAsStringAsync(); dynamic obj = JsonConvert.DeserializeObject(json); string value = obj.return_value; returnValue = Convert.ToInt32(value); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpRequestException(response.ReasonPhrase); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> returnValue; }</code> </pre><br>  The code below shows how to get the value of a variable defined using <code>Particle.variable()</code> . <br><br><pre> <code class="javascript hljs">protected <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> override Task&lt;T&gt; Execute(params string[] args) { T returnValue = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(T); HttpClient httpClient = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpClient(); HttpRequestMessage request = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpRequestMessage(); request.Headers.Authorization = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Identity.Authentication; request.Method = HttpMethod.Get; request.RequestUri = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Identity.BaseUri, string.Format(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Resource, args)); HttpResponseMessage response = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> httpClient.SendAsync(request); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (response.IsSuccessStatusCode) { string json = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> response.Content.ReadAsStringAsync(); dynamic obj = JsonConvert.DeserializeObject(json); string value = obj.result; returnValue = (T)Convert.ChangeType(value, <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(T)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.OnFailed(response); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> returnValue; }</code> </pre> <br>  All software is available <a href="https://github.com/porrey/StarWars">in the GitHub repository for this project</a> .  A list of all components for the project and links to their purchase can be found on the <a href="https://microsoft.hackster.io/en-US/porrey/interactive-star-wars-3d-art-a71471">website</a> . <br><br><h2>  How it works </h2><br>  This video shows the various effects supported by this interactive installation.  In life, the panel is turned on automatically by a signal from the motion sensor. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/bZfk_KJQYmc%3Fecver%3D1&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjHcGugAIJH2ujAH1wyzQo3gAiGVg"></iframe></div><p>Source: <a href="https://habr.com/ru/post/328022/">https://habr.com/ru/post/328022/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328008/index.html">UAC Bypass or the story of three escalations</a></li>
<li><a href="../328010/index.html">Bildim under stm32duino using CMake (and scavenging from the linker)</a></li>
<li><a href="../328012/index.html">Redux as the heart of the front-end architecture of the Unified Frontal System</a></li>
<li><a href="../328014/index.html">Build 2017: text translation. Day 1</a></li>
<li><a href="../328018/index.html">Work with real-time logging with Heka. Experience Yandex. Money</a></li>
<li><a href="../328024/index.html">Video: Uptime Day, conference about monitoring and 24/7 support</a></li>
<li><a href="../328026/index.html">Mobilization without "headache"</a></li>
<li><a href="../328032/index.html">Vector and Citrix will launch virtual machines into space [literally]</a></li>
<li><a href="../328034/index.html">Volitronic can "extend" the law of Moore</a></li>
<li><a href="../328036/index.html">How to use push notifications?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>