<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to analyze the tone of tweets using machine learning in PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="All good! 

 Well, as promised, we are sharing with you another material that we studied as part of the preparation of our PHP course . We hope that i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to analyze the tone of tweets using machine learning in PHP</h1><div class="post__text post__text-html js-mediator-article">  All good! <br><br>  Well, as promised, we are sharing with you another material that we studied as part of the preparation of our <a href="https://otus.pw/x0N0/">PHP course</a> .  We hope that it will be interesting and useful for you. <br><br>  <b>Introduction</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Recently, it seems that everyone and everyone is talking about machine learning.  Your feeds in social networks are filled with messages about ML, Python, TensorFlow, Spark, Scala, Go, and so on;  and if we have something in common with you, then you can ask, but what about PHP? <br><br>  Yes, how about machine learning and PHP?  Fortunately, someone was crazy enough not only to ask this question, but also to develop a universal library of machine learning, which we can use in our next project.  In this post we will look at <a href="https://github.com/php-ai/php-ml">PHP-ML</a> - a library for machine learning in PHP - and we will write a tonality analysis class that we can later use for our own chat or tweet bot.  The main objectives of this post are: <br><br><ul><li>  Exploring general concepts related to machine learning and text analysis </li><li>  PHP-ML features and disadvantages overview </li><li>  Definition of the problem that we will solve. </li><li>  Proof that a PHP machine learning attempt is not a completely insane target (optional) </li></ul><br><img src="https://habrastorage.org/webt/c6/wp/ci/c6wpci873azcuubt9fcjgrrpdq4.png"><br><a name="habracut"></a><br>  <b>What is machine learning?</b> <br><br>  Machine learning is a subset of the field of artificial intelligence research that focuses on providing "computers the opportunity to learn without being precisely programmed."  This is achieved by using common algorithms that can ‚Äúlearn‚Äù from a specific data set. <br><br>  For example, one of the common ways to use machine learning is classification.  Classification algorithms are used to place data in different groups or categories.  Some examples of classification applications: <br><br><ul><li>  Post spam filters </li><li>  Market segmentation packages </li><li>  Fraud protection systems </li></ul><br>  Machine learning is a general term that encompasses many universal algorithms for different tasks.  There are two main types of algorithms, classified according to how they learn - learning with a teacher and learning without a teacher. <br><br>  <b>Teaching with a teacher</b> <br><br>  In training with the teacher, we train our algorithm using the training data in the form of an input object (vector) and the desired output value;  The algorithm analyzes learning data and creates a so-called target function, which we can apply to a new, unmarked data set. <br><br>  In the rest of this post, we will focus on learning with the teacher, simply because it is clearer and easier to check relationships;  Keep in mind that both algorithms are equally important and interesting;  others argue that learning without a teacher is more useful because it eliminates the need for training data. <br><br>  <b>Teaching without a teacher</b> <br><br>  This type of training, on the contrary, works without training data from the very beginning.  We do not know the desired resulting data set values, and we allow the algorithm to draw conclusions only from the sample;  Learning without a teacher is especially convenient for identifying hidden patterns in data. <br><br>  <b>PHP-ML</b> <br><br>  I present to you PHP-ML, a library that claims to be a new approach to machine learning in PHP.  The library implements algorithms, neural networks and tools for data preprocessing, cross-checking and feature extraction. <br><br>  I will be the first to notice that PHP is an unusual choice for machine learning, since language strengths are not well suited for machine learning implementations.  However, not all machine learning applications need to process petabytes of data and do massive computations ‚Äî for simple applications, PHP and PHP-ML should be enough for us <br><br>  The best use that I can provide for this library right now is to implement the classifier, be it something like a spam filter or even text tonality analysis.  We are going to define the classification problem and work out a solution step by step to find out how we can use PHP-ML in our projects. <br><br>  <b>Task</b> <br><br>  To illustrate the process of implementing PHP-ML and add some machine learning to our applications, I wanted to find an interesting problem to solve and the best way to demonstrate the classifier is to create a class for analyzing the tonalities of the tweets. <br><br>  One of the key requirements for creating successful machine learning projects is a reliable source data set.  Data sets are crucial because they allow us to train our classifier on already classified examples.  Since there has been a lot of noise in the media around the airlines lately, what could be better than tweets from airline customers? <br><br>  Fortunately, the data in the form of a set of tweets are already available to us thanks to <a href="https://kaggle.io/">Kaggle.io</a> .  Using <a href="https://www.kaggle.com/crowdflower/twitter-airline-sentiment">this link</a> you can download the US Airline Sentiment twitter database from their website. <br><br>  <b>Decision</b> <br><br>  Let's start by exploring the dataset we're working on.  The raw dataset has the following columns: <br><br><ul><li>  tweet_id </li><li>  airline_sentiment </li><li>  airline_sentiment_confidence </li><li>  negativereason </li><li>  negativereason_confidence </li><li>  airline </li><li>  airline_sentiment_gold </li><li>  name </li><li>  negativereason_gold </li><li>  retweet_count </li><li>  text </li><li>  tweet_coord </li><li>  tweet_created </li><li>  tweet_location </li><li>  user_timezone </li></ul><br><br>  And it looks like in the <a href="https://docs.google.com/spreadsheets/d/1v85RFHoGvFRZTXL1zis3WxBMoLcTVtGjbK4I47F6W44/edit%3Fusp%3Dsharing">example</a> : <br><img src="https://habrastorage.org/webt/ak/gv/w7/akgvw7y2tijc4vzmk_pqvjkcnny.png"><br><br>  The file contains 14,640 tweets - for us this is a sufficient set of data.  Now, with so many columns available to us, we have more data than we need for our example;  for practical purposes, we are only interested in the following columns: <br><br><ul><li>  text </li><li>  airline_sentim </li></ul><br><br>  Where <code>text</code> is a property, and <code>airline_sentiment</code> is a target.  The remaining columns can be discarded because they will not be used for our exercise.  Start by creating a project and initializing the builder using the following file: <br><br><pre> <code class="php hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"amacgregor/phpml-exercise"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Example implementation of a Tweet sentiment analysis with PHP-ML"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"project"</span></span>, <span class="hljs-string"><span class="hljs-string">"require"</span></span>: { <span class="hljs-string"><span class="hljs-string">"php-ai/php-ml"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.4.1"</span></span> }, <span class="hljs-string"><span class="hljs-string">"license"</span></span>: <span class="hljs-string"><span class="hljs-string">"Apache License 2.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"authors"</span></span>: [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Allan MacGregor"</span></span>, <span class="hljs-string"><span class="hljs-string">"email"</span></span>: <span class="hljs-string"><span class="hljs-string">"amacgregor@allanmacgregor.com"</span></span> } ], <span class="hljs-string"><span class="hljs-string">"autoload"</span></span>: { <span class="hljs-string"><span class="hljs-string">"psr-4"</span></span>: {<span class="hljs-string"><span class="hljs-string">"PhpmlExercise\\"</span></span>: <span class="hljs-string"><span class="hljs-string">"src/"</span></span>} }, <span class="hljs-string"><span class="hljs-string">"minimum-stability"</span></span>: <span class="hljs-string"><span class="hljs-string">"dev"</span></span> }</code> </pre> <br> <code>composer install</code> <br> <br>  If you need an introduction to Composer, see <a href="https://habrahabr.ru/post/145946/">here</a> . <br><br>  To make sure that we installed everything correctly, let's create a quick script that will load our data file <code>Tweets.csv</code> and make sure that it contains the data we need.  Copy the following code as <code>reviewDataset.php</code> to the root of our project: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">PhpmlExercise</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/vendor/autoload.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phpml</span></span>\<span class="hljs-title"><span class="hljs-title">Dataset</span></span>\<span class="hljs-title"><span class="hljs-title">CsvDataset</span></span>; $dataset = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CsvDataset(<span class="hljs-string"><span class="hljs-string">'datasets/raw/Tweets.csv'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($dataset-&gt;getSamples() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $sample) { print_r($sample); }</code> </pre> <br>  Now run the <code>reviewDataset.php</code> script, and look at the result: <br><br><pre> <code class="bash hljs">Array( [0] =&gt; 569587371693355008 ) Array( [0] =&gt; 569587242672398336 ) Array( [0] =&gt; 569587188687634433 ) Array( [0] =&gt; 569587140490866689 )</code> </pre> <br>  So far this does not look useful, does it?  Let's look at the <code>CsvDataset</code> class to better understand what's going on inside: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $filepath, int $features, bool $headingRow = true)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists($filepath)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> FileException::missingFile(basename($filepath)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">false</span></span> === $handle = fopen($filepath, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> FileException::cantOpenFile(basename($filepath)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($headingRow) { $data = fgetcsv($handle, <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-string"><span class="hljs-string">','</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;columnNames = array_slice($data, <span class="hljs-number"><span class="hljs-number">0</span></span>, $features); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;columnNames = range(<span class="hljs-number"><span class="hljs-number">0</span></span>, $features - <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (($data = fgetcsv($handle, <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-string"><span class="hljs-string">','</span></span>)) !== <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;samples[] = array_slice($data, <span class="hljs-number"><span class="hljs-number">0</span></span>, $features); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;targets[] = $data[$features]; } fclose($handle); }</code> </pre> <br>  The <code>CsvDataset</code> constructor takes three arguments: <br><br><ul><li>  Source CSV File Path </li><li>  An integer specifying the number of properties in our file. </li><li>  Boolean value indicating whether the first row is a header </li></ul><br><br>  If you look a little closer, we will see that the class divides the CSV file into two internal arrays: samples and targets.  The samples contain all the functions provided by the file, and the targets contain known values ‚Äã‚Äã(negative, positive or neutral). <br><br>  Based on the foregoing, we can see that the format our CSV file should follow looks like this: <br><br><pre> <code class="bash hljs">| feature_1 | feature_2 | feature_n | target |</code> </pre> <br>  We will need to create a clean dataset only with those columns with which we need to continue working.  Let's call this script <code>generateCleanDataset.php</code> : <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">PhpmlExercise</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/vendor/autoload.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phpml</span></span>\<span class="hljs-title"><span class="hljs-title">Exception</span></span>\<span class="hljs-title"><span class="hljs-title">FileException</span></span>; $sourceFilepath = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/datasets/raw/Tweets.csv'</span></span>; $destinationFilepath = <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/datasets/clean_tweets.csv'</span></span>; $rows =[]; $rows = getRows($sourceFilepath, $rows); writeRows($destinationFilepath, $rows); <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $filepath * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $rows * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($filepath, $rows)</span></span></span><span class="hljs-function"> </span></span>{ $handle = checkFilePermissions($filepath); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (($data = fgetcsv($handle, <span class="hljs-number"><span class="hljs-number">1000</span></span>, <span class="hljs-string"><span class="hljs-string">','</span></span>)) !== <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) { $rows[] = [$data[<span class="hljs-number"><span class="hljs-number">10</span></span>], $data[<span class="hljs-number"><span class="hljs-number">1</span></span>]]; } fclose($handle); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $rows; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $filepath * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $mode * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> bool|resource * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> FileException */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkFilePermissions</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($filepath, $mode = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'rb'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file_exists($filepath)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> FileException::missingFile(basename($filepath)); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">false</span></span> === $handle = fopen($filepath, $mode)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> FileException::cantOpenFile(basename($filepath)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $handle; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $filepath * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> $rows * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@internal</span></span></span><span class="hljs-comment"> param $list */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeRows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($filepath, $rows)</span></span></span><span class="hljs-function"> </span></span>{ $handle = checkFilePermissions($filepath, <span class="hljs-string"><span class="hljs-string">'wb'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($rows <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $row) { fputcsv($handle, $row); } fclose($handle); }</code> </pre> <br>  Nothing complicated, enough to do this work.  Let's do it with <code>phpgenerateCleanDataset.php</code> . <br><br>  Now let's move on and point our reviewDataset.php script to a clean data set: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; @AmericanAir That will be the third time I have been called by <span class="hljs-number"><span class="hljs-number">800</span></span><span class="hljs-number"><span class="hljs-number">-433</span></span><span class="hljs-number"><span class="hljs-number">-7300</span></span> an hung on before anyone speaks. What <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> I <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> now??? ) <span class="hljs-keyword"><span class="hljs-keyword">Array</span></span> ( [<span class="hljs-number"><span class="hljs-number">0</span></span>] =&gt; @AmericanAir How clueless is AA. Been waiting to hear <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">2.5</span></span> weeks about a refund from a Cancelled Flightled flight &amp; been on hold now <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>hr <span class="hljs-number"><span class="hljs-number">49</span></span>min )</code> </pre> <br>  Bam!  This is the data we can work with!  So far, we have created simple scripts for data management.  Next we create a new class in <code>src/class/SentimentAnalysis.php</code> . <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">PhpmlExercise</span></span>\<span class="hljs-title"><span class="hljs-title">Classification</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Class SentimentAnalysis * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@package</span></span></span><span class="hljs-comment"> PhpmlExercise\Classification */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SentimentAnalysis</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">train</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">predict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} }</code> </pre> <br>  Our Sentiment class will need two functions in our tonality analysis class: <br><br><ul><li>  A training function that will accept samples and data set labels, as well as some additional parameters. </li><li>  A prediction function that will take an unmarked data set and assign a label set based on the training data. </li></ul><br>  At the root of the project, create a script <code>classifyTweets.php</code> .  We will use it to create and test our class of analysis of tonalities.  Here is the template we will use: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">PhpmlExercise</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PhpmlExercise</span></span>\<span class="hljs-title"><span class="hljs-title">Classification</span></span>\<span class="hljs-title"><span class="hljs-title">SentimentAnalysis</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/vendor/autoload.php'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Step 1: Load the Dataset // Step 2: Prepare the Dataset // Step 3: Generate the training/testing Dataset // Step 4: Train the classifier // Step 5: Test the classifier accuracy</span></span></code> </pre> <br>  <b>Step 1. Loading a dataset</b> <br><br>  We already have the base code we can use to load the CSV into the data object from our previous examples.  We will use the same code with a few minor changes: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phpml</span></span>\<span class="hljs-title"><span class="hljs-title">Dataset</span></span>\<span class="hljs-title"><span class="hljs-title">CsvDataset</span></span>; ... $dataset = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CsvDataset(<span class="hljs-string"><span class="hljs-string">'datasets/clean_tweets.csv'</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); $samples = []; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($dataset-&gt;getSamples() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $sample) { $samples[] = $sample[<span class="hljs-number"><span class="hljs-number">0</span></span>]; }</code> </pre> <br>  Here an array is created that contains only properties ‚Äî in this case, the tweet text that we are going to use to train our classifier. <br><br>  <b>Step 2: Preparing the dataset</b> <br><br>  Now the transfer of raw text to the classifier will lead to a loss of benefit and accuracy, since tweets are significantly different from each other.  Fortunately, there are ways to work with text when trying to apply classification or machine learning algorithms.  In this example, we will use the following two classes: <br><br><ul><li>  Token Count Vectorizer: This class converts a collection of sample text into a vector of tokens.  In fact, every word on our twitter becomes a unique number and tracks the number of occurrences of a word in a particular text sample. </li><li>  Tf-idf Transformer: abbreviation for term frequency - inverse document frequency (word frequency - the inverse frequency of the word in the document), is a numeric statistic used to assess the importance of a word in the context of a document that is part of a document collection or corpus. </li></ul><br>  Let's start with our text vectorizer: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phpml</span></span>\<span class="hljs-title"><span class="hljs-title">FeatureExtraction</span></span>\<span class="hljs-title"><span class="hljs-title">TokenCountVectorizer</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phpml</span></span>\<span class="hljs-title"><span class="hljs-title">Tokenization</span></span>\<span class="hljs-title"><span class="hljs-title">WordTokenizer</span></span>; ... $vectorizer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TokenCountVectorizer(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WordTokenizer()); $vectorizer-&gt;fit($samples); $vectorizer-&gt;transform($samples);</code> </pre><br>  Then apply the Tf-idf Transformer: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phpml</span></span>\<span class="hljs-title"><span class="hljs-title">FeatureExtraction</span></span>\<span class="hljs-title"><span class="hljs-title">TfIdfTransformer</span></span>; ... $tfIdfTransformer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TfIdfTransformer(); $tfIdfTransformer-&gt;fit($samples); $tfIdfTransformer-&gt;transform($samples);</code> </pre><br>  Our sample array is now in a format that our classifier understands.  We have not finished yet, we need to mark each sample with an appropriate mood. <br><br>  <b>Step 3. Creating a set of training materials</b> <br><br>  Fortunately, PHP-ML already knows how to do this, and the code is pretty simple: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phpml</span></span>\<span class="hljs-title"><span class="hljs-title">Dataset</span></span>\<span class="hljs-title"><span class="hljs-title">ArrayDataset</span></span>; ... $dataset = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayDataset($samples, $dataset-&gt;getTargets());</code> </pre> <br>  We could use this data set and train our classifier.  However, we lack the test data set to use as a test, so we are going to ‚Äúread‚Äù a little and divide our original data set into two: a set of training materials and a much smaller data set that will be used to check the accuracy of our model. <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phpml</span></span>\<span class="hljs-title"><span class="hljs-title">CrossValidation</span></span>\<span class="hljs-title"><span class="hljs-title">StratifiedRandomSplit</span></span>; ... $randomSplit = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StratifiedRandomSplit($dataset, <span class="hljs-number"><span class="hljs-number">0.1</span></span>); $trainingSamples = $randomSplit-&gt;getTrainSamples(); $trainingLabels = $randomSplit-&gt;getTrainLabels(); $testSamples = $randomSplit-&gt;getTestSamples(); $testLabels = $randomSplit-&gt;getTestLabels();</code> </pre><br>  This approach is called cross validation.  This term comes from statistics and can be defined as follows: <br><br><blockquote>  Cross-validation (cross-validation, sliding control, English cross-validation) is a method for evaluating an analytical model and its behavior on independent data.  In evaluating the model, the available data is divided into k parts.  Then, the model is trained at the k ‚àí 1 parts of the data, and the rest of the data is used for testing.  The procedure is repeated k times;  as a result, each of the k pieces of data is used for testing.  The result is an assessment of the effectiveness of the selected model with the most uniform use of available data. </blockquote>  - Wikipedia.com <br><br>  <b>Step 4: Classifier Training</b> <br><br>  Finally, we are ready to go back and implement our class SentimentAnalysis.  If you have not noticed, a huge part of machine learning is related to the collection and processing of data;  the actual implementation of machine learning models tends to be much less involved. <br><br>  We have three classification algorithms to implement a sentiment analysis class: <br><br><ul><li>  Support Vector Machine </li><li>  K-closest neighbors method (KNearestNeighbors) </li><li>  Naive Bayes Classifier (NaiveBayes) </li></ul><br><br>  For this exercise, we will use the simplest of all, the NaiveBayes classifier, so let's continue and change our class to implement the learning function: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">PhpmlExercise</span></span>\<span class="hljs-title"><span class="hljs-title">Classification</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phpml</span></span>\<span class="hljs-title"><span class="hljs-title">Classification</span></span>\<span class="hljs-title"><span class="hljs-title">NaiveBayes</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SentimentAnalysis</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $classifier; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;classifier = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NaiveBayes(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">train</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($samples, $labels)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;classifier-&gt;train($samples, $labels); } }</code> </pre> <br>  As you can see, we let PHP-ML do all the hard work for us.  We simply create a small abstraction for our project.  But how do we know if our classifier really trains and works?  Time to use our <code>testSamples</code> and <code>testLabels</code> . <br><br>  Step 5: Classifier Accuracy Check <br><br>  Before we can continue testing our classifier, we need to implement a prediction method: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> ... <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SentimentAnalysis</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">predict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($samples)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;classifier-&gt;predict($samples); } }</code> </pre> <br>  And once again, PHP-ML helps us out.  Let's change the classifyTweets class as follows: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> ... $predictedLabels = $classifier-&gt;predict($testSamples);</code> </pre><br>  Finally, we need a way to verify the accuracy of our learning model;  fortunately, PHP-ML does this, too, and they have several metric classes.  In our case, we are interested in the accuracy of the model.  Let's look at the code: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Phpml</span></span>\<span class="hljs-title"><span class="hljs-title">Metric</span></span>\<span class="hljs-title"><span class="hljs-title">Accuracy</span></span>; ... <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Accuracy: '</span></span>.Accuracy::score($testLabels, $predictedLabels);</code> </pre> <br>  We should see something like: <br><br><pre> <code class="bash hljs">Accuracy: 0.73651877133106%</code> </pre> <br>  <b>Conclusion</b> <br><br>  This article is too big, so let's repeat what we learned: <br><br><ul><li>  Having a good data set from the start is crucial to the implementation of machine learning algorithms. </li><li>  The difference between learning with a teacher and without. </li><li>  The value and use of cross-validation in machine learning. </li><li>  What vectorization and transformation is necessary to prepare textual data sets for machine learning. </li><li>  How to implement the analysis of the mood of tweets using the classifier NaiveBayes PHP-ML. </li></ul><br>  This post also served as an introduction to the PHP-ML library and, I hope, gave you an idea of ‚Äã‚Äãwhat the library can do and how it can be built into your own projects. <br><br>  Finally, this post is by no means comprehensive, and there are many opportunities to learn, improve, and experiment;  Here are some ideas for you to talk about how to develop the direction: <br><br><ul><li>  Replace the NaiveBayes algorithm with the support vector method. </li><li>  If you try to run the full dataset (14,000 lines), you will probably notice how much memory load will increase.  Try to implement the constancy of the model so that it does not need to be trained in each run. </li><li>  Move the dataset generation to your own helper class. </li></ul><br>  THE END <br><br>  As always, we are waiting for your comments and opinions. </div><p>Source: <a href="https://habr.com/ru/post/345082/">https://habr.com/ru/post/345082/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345072/index.html">Good news for the webmaster: Hamster Marketplace placed an offer on the RunCPA site</a></li>
<li><a href="../345074/index.html">How not to drown in the landing: the history of the creation of the Japanese CarPrice</a></li>
<li><a href="../345076/index.html">Key-value for storing metadata in storage. Testing embedded databases</a></li>
<li><a href="../345078/index.html">IT forecasts for 2018: 8 infrastructure trends</a></li>
<li><a href="../345080/index.html">Hippocratic Oath or how to protect information in medical institutions</a></li>
<li><a href="../345084/index.html">Voxxed Days Minsk</a></li>
<li><a href="../345086/index.html">Fast and secure OS for web surfing with impregnable media, easily changeable by the user.</a></li>
<li><a href="../345090/index.html">Hippocrates and IT. What is in common between them?</a></li>
<li><a href="../345092/index.html">9 training projects for backend</a></li>
<li><a href="../345094/index.html">SecurityWeek 50: hacktivist tired and fly-fly, fake crypto-neck for panda lovers, two-faced Janus for Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>