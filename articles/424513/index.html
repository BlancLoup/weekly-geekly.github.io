<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>About cheap data centers, RKN and DDoS protection</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes the project lives in an inexpensive foreign data center, falls under Roskomnadzor‚Äôs carpets, periodically finds itself under DDoS attacks, b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>About cheap data centers, RKN and DDoS protection</h1><div class="post__text post__text-html js-mediator-article"><p>  Sometimes the project lives in an inexpensive foreign data center, falls under Roskomnadzor‚Äôs carpets, periodically finds itself under DDoS attacks, but at the same time has terabytes of data and traffic. </p><br><p>  How to live with it? </p><br><p><img src="https://habrastorage.org/webt/42/kg/m1/42kgm1wgykvy6v9uaw_6rzdavwq.png"></p><br><h2 id="preambula">  Preamble </h2><br><p>  We have a small photo bank on support.  We will not give the name and country, only some technical data: <br>  50 TB of data for storage, about 100 GB are updated monthly, ‚Äúhot data‚Äù (95% of requests go to them) - 200 GB. <br>  Average traffic - 50 TB / month. </p><br><p>  Several years ago, we chose several Hetzner SX series servers with large disks for posting photos (for storing PD, we had to come up with a more complex solution, but more about that another time). </p><br><p>  In Southbridge, hesitated that Hetzner was suitable for such a project, but the required level of accessibility and quality of connectivity was achieved. </p><br><p>  Plus, for such a project, using a CDN will be an order of magnitude more expensive than distributing statics from servers in an inexpensive data center. </p><a name="habracut"></a><br><h2 id="fabula">  Plot </h2><br><p>  Here Roskomnadzor appears in our history, so that his name will not be mentioned in vain.  In the spring of 18, carpet blockages began, and by May they covered many of our clients. </p><br><p>  Some customers have solved the problem with access to Hetzner, Amazon, MS Azure, GCE, Digitalocean drastically: the servers were transferred to Russia entirely (hello, Selectel!), But for our hero, a small photo bank, constantly carrying 50 TB of data back and forth is too expensive , and we were not going to leave the project servers in Russia after the end of locks. </p><br><p>  For large and inadequate problems, small and adequate solutions are needed. </p><br><h2 id="reshenie-problemy">  Solution to the problem </h2><br><p>  For example, use other (unblocked) servers or services for frontend.  Changing the range of ip-addresses did not help 100%, because  The PKN every day blocked new and new IP subnets, so we decided to connect proxying through Cloudflare.com.  Suddenly, who does not know, they not only protect against DDoS attacks (not as good as the best players in this market), but also provide a CDN service (and they do it well). </p><br><p>  This is a great solution if the Cloudflare addresses you use are not blocked) </p><br><p>  Ok, turned on - and began to monitor the stability and performance of traffic.  After connecting the CF, we saw the following picture on the traffic counting chart from one of the servers (picture from Hetzner statistics): </p><br><p><img src="https://habrastorage.org/webt/84/c0/qm/84c0qmol58xtmgavixvz0z5mjra.png"></p><br><p>  Incoming traffic changed within the margin of error (which is confirmed by the schedule for uploading new photos, for which a separate monitoring metric was made), outgoing on this server at the time of connecting the CF dropped 3+ times.  The total real traffic fell not 3 times, just CF began to distribute traffic between servers differently. </p><br><p>  For example, the schedule for the same server from our monitoring system (for 3 months so that it is not too small): </p><br><p><img src="https://habrastorage.org/webt/iv/rx/md/ivrxmdiavqwdhzd-fjz12rto1us.png"></p><br><p>  And one of the others: </p><br><p><img src="https://habrastorage.org/webt/1d/6u/en/1d6uenbn3f3htgpmtr1dbqvt6ss.png"></p><br><p>  But the total traffic still fell by 20%, i.e.  CF saved some traffic to the project. </p><br><p>  The average latency has increased, but we will not show these graphs. </p><br><p>  The reason: Cloudflare has few distribution points for traffic in Russia.  In Europe and North America, it is already acting much more efficiently. </p><br><p>  And in parallel with the traffic, we monitor the activity of using the service.  New photos are loaded into the service, and we monitor their number (and incoming traffic). </p><br><p>  Schedule for 3 months (April-June) from one of the servers that process requests for downloading photos: </p><br><p><img src="https://habrastorage.org/webt/1d/6u/en/1d6uenbn3f3htgpmtr1dbqvt6ss.png"></p><br><p>  And here is another server: </p><br><p><img src="https://habrastorage.org/webt/ut/cu/1_/utcu1_2wvgrovfdvcwuzgr2ewfi.png"></p><br><p>  Cloudflare began to distribute traffic across backends in a slightly different way.  But the content continued to load, the service worked, a catastrophic decline in quality did not occur (according to feedback from service users, the difference was not noticeable in principle). </p><br><p>  The risk of getting a blocked address to Cloudflare is also there, but it can be reduced by taking a paid rate. <br>  After completing the ‚Äúcarpet blocking of the name of the RKN,‚Äù we turned off Cloudflare. </p><br><h2 id="kakov-itog">  What is the result? </h2><br><ul><li>  For 5‚Äì20 $ / month (in our case it was just $ 5 / month) you can solve a similar problem and not spend thousands of dollars on renting more expensive servers and transferring data. </li><li>  Even for projects with terabytes of traffic, free or almost free solutions are suitable.  Tested in practice. </li></ul><br><p>  As an alternative: </p><br><ul><li>  DDoS-GUARD offers a free rate with traffic proxying and protection from DDoS attacks. </li><li>  Several DDoS protection service providers had a free help service with such locks.  (By the way, we also didn‚Äôt take extra money to solve the blocking problem). </li><li>  You can take one of the well-known CDN services: keycdn.com, cdn77.com, Akamai CDN, CDNVideo, Ngenix.net, etc. They solve the problem of protection against blocking for their clients themselves.  But this is a) more expensive b) does not solve the problem of returning non-static content. </li><li>  You can connect another proxy service and protection against DDoS attacks (we worked a lot with Qrator and SkyparkCDN / G-Core Labs, for example), but they will have to pay for every megabit of useful traffic, and it will be really expensive. </li><li>  ‚ÄúYou can deploy your own unblocked frontend‚Äù with any of the providers in the world, while choosing an unlocked address range, and ensuring good connectivity between your servers and the frontend servers.  If you seriously need to do this - you can pre-check the address automatically by the <a href="https://github.com/zapret-info/z-i">list</a> or manually <a href="https://isitblockedinrussia.com/">here</a> . </li></ul><br><p>  Personally, I recommend packet.net and servers.com for such ‚Äúfrontends‚Äù - excellent connectivity and the ability to take an hourly paid server. </p><br><p>  ps If that - I am one of the speakers of "RedSlerom".  Come, it will be interesting: <br>  <a href="https://slurm.io/redslurm/%3Futm_source%3Dhabrvi">https://slurm.io/redslurm/</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/424513/">https://habr.com/ru/post/424513/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../424503/index.html">Boot yourself, Spring is coming (Part 1)</a></li>
<li><a href="../424505/index.html">‚ÄúWe have ideas for Maven 4 and even Maven 5‚Äù - an interview with Robert Scholte, a key member of the Maven project</a></li>
<li><a href="../424507/index.html">VI annual hackathon JetBrains: Shiftius Altius Ctrlius</a></li>
<li><a href="../424509/index.html">Using the KOMPAS-3D API ‚Üí Lesson 12 ‚Üí Composite Lines</a></li>
<li><a href="../424511/index.html">Tools for searching annotated classes in Java</a></li>
<li><a href="../424517/index.html">Implementation of the minimization of logical functions by the Kvayna-Mak'Klaski method with an incomplete input set</a></li>
<li><a href="../424519/index.html">Can Beethoven send removal requests?</a></li>
<li><a href="../424525/index.html">Minidrill speed controller</a></li>
<li><a href="../424531/index.html">Microservices: size matters, even if you have Kubernetes</a></li>
<li><a href="../424533/index.html">‚ÄúAny self-respecting IT person is engaged in technology and in his spare time‚Äù - 10 questions for a programmer, issue 6</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>