<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pyte terminal emulator</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As promised, we are releasing our linux terminal emulator emulation library under the LGPL, which we use to show virtual machine consoles in the cloud...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pyte terminal emulator</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/8c7/5b7/809/8c75b7809f389a97229a53227e2b609e.png" title="broadcast from esc code to image on screen"><br>  As promised, we are releasing our linux terminal emulator emulation library under the LGPL, which we use to show virtual machine consoles in the cloud.  It is called, respectively, pyte (PYthon Terminal Emulator). <br><br>  According to our own estimates, the ‚Äútextual‚Äù functionality of the console_codes is close to 100% (from 80 to 90%, as suggested by opportunistic pessimists among developers). <br><br>  Not implemented: font download codes for the VGA adapter character generator, VESA power saving control, sound alarm (codes for controlling the frequency and duration of the sound), palette control, own charsets;  In general, all that is irrelevant to the text. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But all the other complex functions are implemented, such as blocking screen regions for recording, scrolling, managing line feed modes, correct processing of attributes for various types of text deletion, etc.  - everything that existing applications need, such as nano, adom (in the picture is a fragment of ESC-codes and the resulting image just from ADOM), vim, emacs, mc, aptitude, dialog, yast2, etc.  for full rendering. <br><br>  The library is written in python and sharpened for the convenience of manipulating the screen, abstracting from the graphic representation of the image, which allows it to be used in code that performs further transformations (for example, screen transfers to JS or serialization to the database). <br><br>  The second important feature of the library is the support of diffs (differences) between the previous and the current screen state.  This is necessary for economical image transfer via limited speed channels (read, Internet) and rendering on devices with limited performance (read, javascript). <br><br><h1>  History of creation </h1><a name="habracut"></a>  In the beginning there was a remarkable <a href="https://github.com/samfoo/vt102">vt102</a> library in its naivety.  She somehow draws a part of vt102 esc-codes, without even thinking about unicode, subtle nuances of scrolling the screen regions, performance and stability of work.  As the author wrote about it, it was intended for reading in the game <a href="http://ru.wikipedia.org/wiki/NetHack">nethack</a> , and no more. <br><br>  We started with her.  For some time we corrected errors and improved, but then we found that, firstly, vt102 does not support some buttons (PgUp, for example), and secondly ... As I wrote earlier, the main advantage of linux terminal is that it expects linux by default. <br><br>  I had to `from scratch 'to implement all the functionality of the linux console (with the above-mentioned restrictions on the features of the serial port compared to VGA adapters).  Thus, the library was smoothly renamed from vt102 to pyte (Python Terminal Emulator). <br><br>  Despite the fact that the library is now written from scratch, we decided to also publish it under the LGPL, mainly out of respect for the author vt102, whose code we even tactfully deleted, but some of the ideas still used, for example, the concept of the dispatcher. <br><br><h1>  Internal organization </h1><br>  The library consists of the screen and stream classes.  Screen contains a copy of the screen (characters and attributes), Stream is a finite state machine responsible for processing ESC and (in particular) CSI sequences.  Stream is fed a sequence of characters, moreover, we have a situation where the program using the library does not know anything about ‚Äúcharacters‚Äù and operates on a stream of bytes with a custom encoding (incremental decoder, so that there are no strange squares due to a gap in the middle of UTF- 8 characters).  In principle, we work not only with UTF-8, but also with other encodings.  We do not use this functionality in the cloud now, but for the sake of purity of conscience we have implemented it. <br><br>  After eating the entire sequence of characters that form the CSI sequence (this is a special class of ESC sequences starting with ESC codes, followed by parameters and command, for example, ESC [1; 31m generates a red bold color tone).  Each output generates an event (character output, scrolling, etc.) for all subscribers, among which is the library itself that processes these events.  Of course, external code may also be among those who wish, for example, in this way we will learn about the appearance of new characters and report them to the Java script in the control panel. <br><br>  Objects inside Screen are stored as normal python objects.  We had a version that uses faster binary arrays, but we stumbled upon some difficulties with converting between ‚Äúconvenient‚Äù for the library format and array, so the performance of the arrays was heavily blurred with constant conversions.  By the way, the use of snake objects simplifies access to their giblets and, most importantly, serialization to the database (which is the killer feature of our console, which is experiencing the transfer of a virtual machine between servers without breaks and zeroing the screen content). <br><br>  By the way, this library works fine under pythons from 2.6 to 3.2+ and even under <a href="http://ru.wikipedia.org/wiki/PyPy">PyPy</a> . <br><br><h1>  Future plans </h1><br>  In the near future, the library will be supplemented with scrolling support (the same Shift-PgUp), which, by the way, we will add to our cloud. <br><br>  In addition, there is an idea to do a little useless perfectionism and conform to standards better than the Linux console itself, that is, to pass vttest without a single error. <br><br>  The thing that we are not planning yet (although we will take commits with great pleasure) is an expanded support for Unicode - support for the normalization of characters, symbols of different widths, etc.  In principle, python has everything for that - but we have no need for such (until we set our sights on the Asian market). <br><br>  If this library is useful to someone, we will be grateful for reports of use, bug reports and complaints. <br><br><h1>  Links </h1><br> <code>easy_install pyte</code> <br>  <a href="http://github.com/selectel/pyte">github.com/selectel/pyte</a> <br><br>  Who say thank you? <br>  <a href="https://habrahabr.ru/users/bobry/" class="user_link">bobry</a> for the code <br>  <a href="https://habrahabr.ru/users/o_l/" class="user_link">o_l</a> and <a href="https://habrahabr.ru/users/akme/" class="user_link">akme</a> for agreeing to publish under the LGPL. </div><p>Source: <a href="https://habr.com/ru/post/122340/">https://habr.com/ru/post/122340/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122331/index.html">Classmates have launched a music service</a></li>
<li><a href="../122333/index.html">DOU Hakaton in Odessa</a></li>
<li><a href="../122334/index.html">Joshua Bloch and GTUG June 24 in St. Petersburg: hurry up to register!</a></li>
<li><a href="../122338/index.html">KVM & OpenVZ virtualization and cloud computing using Proxmox VE</a></li>
<li><a href="../122339/index.html">Video: HH.ru founder Yury Virovets personally about recruiting, prospects, investments ...</a></li>
<li><a href="../122341/index.html">The guy who bought 259684 Bitcoin for $ 2613</a></li>
<li><a href="../122342/index.html">What is a ‚Äúwork registration‚Äù?</a></li>
<li><a href="../122344/index.html">New rules for domains .RU and .–†–§</a></li>
<li><a href="../122346/index.html">Remote debugging of .NET assemblies on the Nokia N900 in Visual Studio is just</a></li>
<li><a href="../122348/index.html">Password Recovery on Cisco Routers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>