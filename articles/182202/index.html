<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We improve testing by using real traffic</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="TL; DR The closer to reality your test data, the better. Try Gor - automatic redirection of production traffic to the test site in real time. 
 
 Here...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We improve testing by using real traffic</h1><div class="post__text post__text-html js-mediator-article">  <i>TL; DR The closer to reality your test data, the better.</i>  <i>Try <a href="https://github.com/buger/gor/">Gor</a> - automatic redirection of production traffic to the test site in real time.</i> <i><br></i> <br>  Here at <a href="http://granify.com/">Granify</a> we process a huge amount of user-generated data, our business is built on this.  We need to make sure that data is collected and processed correctly. <br><br>  You can not even imagine how strange the data may come from users.  The source can be proxy servers, browsers about which you have never heard of, errors on the client side, and so on. <br><a name="habracut"></a><br><blockquote>  No matter how many tests and fixtures you have, they simply cannot cover all cases.  Traffic from production will always be different from expected. </blockquote><br>  Moreover, we can just break everything when updating the version, even if all the tests have passed.  In my practice, this happens all the time. <br><br>  There is a whole class of errors that are very difficult to find automated and manual testing: concurrency, errors in setting up servers, errors that occur when calling commands only in a certain order, and much more. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But we can do several things to simplify the search for such bugs and improve system stability: <br><br><h4>  Always test for staging </h4><br>  The presence of a <a href="http://en.wikipedia.org/wiki/Staging_site">staging</a> environment is mandatory, and it must be <b>identical to</b> production.  Using tools such as Puppet or Chef makes it much easier. <br><br>  You should require that developers always manually test their code on staging.  This helps to find the most obvious mistakes, but it is still very far from what can happen in production traffic. <br><br><h4>  We test on real data </h4><br>  There are several techniques for testing your code on real data (I recommend using both): <br><br>  1. Update only 1 of the production servers, so some of your users will be processed with new code.  This technique has several drawbacks: some of your users may see errors, and you may have to use <a href="http://dev.fyicenter.com/Interview-Questions/JavaScript/What_does_the_term_sticky_session_mean_in_a_web_.html">sticky</a> sessions.  This is pretty similar to A / B testing. <br><br>  2. Reproduction of production traffic (log replay) <br><br>  Ilya Grigorik wrote a wonderful article about <a href="http://www.igvita.com/2008/09/30/load-testing-with-log-replay/">load testing using the log replay</a> technique. <br><br>  All articles that I read on this topic mention log replay as a means for load testing using real data.  I want to show how to use this technique for daily testing and finding errors. <br><br>  Programs such as jMeter, httperf or Tsung have support for log replay, but it is either in its infancy or focused on load testing and not emulation of real users.  Feel the difference?  The real user is not only a set of requests, the correct order and time between requests, various HTTP headers and so on are very important.  For load testing, this is sometimes not important, but it is critical for finding errors.  In addition, these tools are difficult to configure and automate. <br><br><blockquote>  Developers are very lazy.  If you want your developers to use any program / service, it should be as automated as possible, and even better so that it works so no one notices. </blockquote><br><br><h4>  Reproduce production traffic in automatic mode. </h4><br><br>  I wrote a simple program <a href="https://github.com/buger/gor">Gor</a> <br><br>  Gor - allows automatic reproduction of production traffic at staging in real time, 24 hours a day, with minimal costs.  Thus, your staging environment always gets a portion of real traffic. <br><br>  Gor consists of 2 parts: Listener and Replay server.  Listener is installed on the production web servers, and duplicates all traffic to the Replay server on a separate machine, which already sends it to the correct address.  The principle of operation is shown in the diagram below: <br><img src="https://a248.e.akamai.net/camo.github.com/c802ae10dfd1b0b2519c5726eedad31bac18c0f6/687474703a2f2f692e696d6775722e636f6d2f7a5a43465043592e706e67" alt="image"><br><br>  Gor supports limiting the number of requests.  This is a very important setting, as staging correctly uses fewer machines than production, and you can set the maximum number of requests per second that your staging environment can withstand. <br><br>  You can find detailed documentation on <a href="https://github.com/buger/gor">the</a> project <a href="https://github.com/buger/gor">page</a> . <br><br>  Since Gor is written in Go, we can simply use the already compiled distribution for <a href="https://drive.google.com/folderview%3Fid%3D0B46uay48NwcfWFowc1E4a1BISVU%26usp%3Dsharing">download.</a> <br><br>  In <a href="http://granify.com/">Granify</a> , we have been using Gor in production for some time, and are very pleased with the results. <br><br>  Have a good test! </div><p>Source: <a href="https://habr.com/ru/post/182202/">https://habr.com/ru/post/182202/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../182188/index.html">DVR AdvoCam FD5 - decent work on the bugs</a></li>
<li><a href="../182190/index.html">Cache to speed</a></li>
<li><a href="../182192/index.html">PrivatBank will release an application for Google Glass</a></li>
<li><a href="../182196/index.html">Beer cooler caused cellular interference</a></li>
<li><a href="../182200/index.html">Mobile browser game developer Playtox attracts $ 3 million from Runa Capital</a></li>
<li><a href="../182204/index.html">Vine - now for Android</a></li>
<li><a href="../182206/index.html">Let them fear, just to notice ... Create an outstanding Appeal in the Appstore</a></li>
<li><a href="../182208/index.html">Memo UX / UI designer. 19 principles of building interfaces</a></li>
<li><a href="../182210/index.html">Bitbucket has reached one million users - fly celebrate in San Francisco</a></li>
<li><a href="../182212/index.html">WiSee project: we recognize the gestures of a person in the next room using only Wi-Fi</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>