<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A universal way to create packages for various distributions of GNU Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Various distributions provide their utilities for building and installing programs. 
 For example, in Debian / GNU, Linux is debuild and dpkg. On Red ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A universal way to create packages for various distributions of GNU Linux</h1><div class="post__text post__text-html js-mediator-article">  Various distributions provide their utilities for building and installing programs. <br>  For example, in Debian / GNU, Linux is debuild and dpkg.  On Red Hat Linux, rpmbuild and rpm. <br>  Not infrequently we have to collect packages on our own. <br>  Installing programs through make, bypassing the package management system in distributions is a bad form. <br>  In cases where we have the source code, and the author of the program has taken care of creating a Makefile, you can use <a href="http://checkinstall.izto.org/">checkinstall</a> . <br>  But it also happens that the author of the java application does not post anything except the jar file.  Or we want to create some kind of package on our knees, and put them in the repository, so that we can install / update it on a variety of servers with different distributions in the future.  This will help us a utility called <a href="https://github.com/jordansissel/fpm">fpm</a> . <br>  What is its dignity?  It out of the box allows us to build packages for various distributions and even operating systems. <br><br>  Now supported: <br><ul><li>  deb </li><li>  rpm </li><li>  solaris </li><li>  tar </li><li>  directories </li><li>  Mac OS X .pkg files (osxpkg) </li></ul><br><a name="habracut"></a><br>  Installing the required packages for working with fpm on Debian GNU / Linux: <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># apt-get install ruby rubygems rpm dpkg-dev # gem install fpm</span></span></code> </pre> <br>  For example, let's <a href="http://www.logstash.net/">build the logstash</a> package, for Debian / GNU Linux and Red Hat Linux. <br>  Create an assembly file in which we describe dependencies, configuration files, and meta-information about the package: <br><pre> <code class="bash hljs">$ mkdir logstash &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> logstash &amp;&amp; touch build.sh &amp;&amp; chmod +x build.sh &amp;&amp; vim build.sh</code> </pre><br>  Paste: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash JAR_URL="https://download.elasticsearch.org/logstash/logstash/logstash-1.2.2-flatjar.jar" JAR_FILE="usr/share/logstash/logstash.jar" DESCRIPTION="Logstash Open Source Log Management" EMAIL="admin@logstash.net" URL='http://www.logstash.net/' VERSION="1.2.2" NAME="logstash" #    if [ ! -d "usr" ]; then mkdir -p {etc,usr/share/logstash,var/logstash} fi #       logstash if [ ! -f "$JAR_FILE" ]; then wget "$JAR_URL" -O "$JAR_FILE" fi cd .. function build() { fpm -n $NAME -v $VERSION -a all -C logstash -m "&lt;$EMAIL&gt;" \ --pre-install logstash/preinstall \ --description "$DESCRIPTION" \ --url "$URL" -t "$1" -d "$2" \ --config-files etc/logstash/syslog.conf \ -s dir etc usr var } #      build "deb" "default-jre" build "rpm" "java-1.6.0-openjdk-devel"</span></span></code> </pre><br><br>  Create a logstash configuration file: <br><pre> <code class="bash hljs">$ mkdir -p etc/logstash &amp;&amp; vim etc/logstash/syslog.conf</code> </pre><br>  insert: <br><div class="spoiler">  <b class="spoiler_title">etc / logstash / syslog.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs">input { file { <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"syslog_file"</span></span> exclude =&gt; [ <span class="hljs-string"><span class="hljs-string">"logstash.log*"</span></span> ] path =&gt; [ <span class="hljs-string"><span class="hljs-string">"/var/log/messages"</span></span>, <span class="hljs-string"><span class="hljs-string">"/var/log/syslog"</span></span>, <span class="hljs-string"><span class="hljs-string">"/var/log/*.log"</span></span> ] } } filter { grok { <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"syslog_relay"</span></span> pattern =&gt; [ <span class="hljs-string"><span class="hljs-string">"^&lt;[1-9]\d{0,2}&gt;%{SPACE}%{GREEDYDATA:message_remainder}"</span></span> ] add_tag =&gt; <span class="hljs-string"><span class="hljs-string">"got_syslog_pri"</span></span> add_field =&gt; [ <span class="hljs-string"><span class="hljs-string">"syslog_raw_message"</span></span>, <span class="hljs-string"><span class="hljs-string">"%{@message}"</span></span> ] } syslog_pri { <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"syslog_relay"</span></span> tags =&gt; [ <span class="hljs-string"><span class="hljs-string">"got_syslog_pri"</span></span> ] } mutate { <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"syslog_relay"</span></span> tags =&gt; [ <span class="hljs-string"><span class="hljs-string">"got_syslog_pri"</span></span> ] replace =&gt; [ <span class="hljs-string"><span class="hljs-string">"@message"</span></span>, <span class="hljs-string"><span class="hljs-string">"%{message_remainder}"</span></span> ] remove =&gt; [ <span class="hljs-string"><span class="hljs-string">"message_remainder"</span></span> ] remove_tag =&gt; <span class="hljs-string"><span class="hljs-string">"got_syslog_pri"</span></span> } grok { <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"syslog_relay"</span></span> pattern =&gt; [ <span class="hljs-string"><span class="hljs-string">"^%{SYSLOGTIMESTAMP:syslog_timestamp}%{SPACE}%{GREEDYDATA:message_remainder}"</span></span> ] add_tag =&gt; <span class="hljs-string"><span class="hljs-string">"got_syslog_timestamp"</span></span> add_field =&gt; [ <span class="hljs-string"><span class="hljs-string">"received_at"</span></span>, <span class="hljs-string"><span class="hljs-string">"%{@timestamp}"</span></span> ] } date { <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"syslog_relay"</span></span> tags =&gt; [ <span class="hljs-string"><span class="hljs-string">"got_syslog_timestamp"</span></span> ] <span class="hljs-comment"><span class="hljs-comment"># season to taste for your own syslog format(s) match =&gt; [ "syslog_timestamp", "MMM d HH:mm:ss", "MMM dd HH:mm:ss", "ISO8601" ] } mutate { type =&gt; "syslog_relay" tags =&gt; [ "got_syslog_timestamp" ] replace =&gt; [ "@message", "%{message_remainder}" ] remove =&gt; [ "message_remainder" ] remove_tag =&gt; "got_syslog_timestamp" } grok { type =&gt; "syslog_relay" pattern =&gt; [ "^%{SYSLOGHOST:syslog_hostname}%{SPACE}%{GREEDYDATA:message_remainder}" ] add_tag =&gt; "got_syslog_host" add_field =&gt; [ "logstash_source", "%{@source_host}" ] } mutate { type =&gt; "syslog_relay" tags =&gt; [ "got_syslog_host" ] replace =&gt; [ "@source_host", "%{syslog_hostname}" ] replace =&gt; [ "@message", "%{message_remainder}" ] remove =&gt; [ "message_remainder" ] remove_tag =&gt; "got_syslog_host" } grok { type =&gt; "syslog_relay" pattern =&gt; [ "^%{SYSLOGPROG:syslog_prog}:%{SPACE}%{GREEDYDATA:message_remainder}" ] add_tag =&gt; "got_syslog_prog" } mutate { type =&gt; "syslog_relay" tags =&gt; [ "got_syslog_prog" ] replace =&gt; [ "@message", "%{message_remainder}" ] remove =&gt; [ "message_remainder" ] remove_tag =&gt; "got_syslog_prog" } dns { type =&gt; 'syslog_relay' reverse =&gt; [ "@source_host", "@source_host" ] action =&gt; "replace" } mutate { type =&gt; "syslog_relay" tags =&gt; [ "syslog" ] remove =&gt; [ "syslog_hostname", "syslog_timestamp" ] } }</span></span></code> </pre><br></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next, create a script that should be executed before installing the package: <br><pre> <code class="bash hljs">$ cat &gt; preinstall &lt;&lt; END <span class="hljs-comment"><span class="hljs-comment">#!/bin/bash useradd -g adm -r -m -d /usr/share/logstash -s /bin/false logstash || exit 0 END</span></span></code> </pre><br>  Now it‚Äôs enough to start building the packages: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># ./build.sh</span></span></code> </pre><br>  At the output, we get rpm and deb packages that are installed without problems in Debian or Red Hat. <br><br>  Install the package on the current machine and check: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># dpkg -i ../logstash*.deb &amp;&amp; apt-get install -f # java -jar /usr/share/logstash/logstash.jar agent -f /etc/logstash --log /var/log/logstash.log</span></span></code> </pre><br><br><h4>  Conclusion </h4><br>  Just a few teams can build a package for various distributions and OS in a couple of minutes. <br>  Thanks to the author for such a wonderful utility.  I hope that someone will find it as useful as I am. </div><p>Source: <a href="https://habr.com/ru/post/200774/">https://habr.com/ru/post/200774/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200758/index.html">Tower of Hanoi on the fingers</a></li>
<li><a href="../200760/index.html">Microsoft Sculpt Ergo Subjective Review</a></li>
<li><a href="../200762/index.html">GameDev, igroprom, game development, education and faith in the future</a></li>
<li><a href="../200764/index.html">Video lecture about Bitcoin</a></li>
<li><a href="../200770/index.html">Open Open XML Excel Format Files in JavaScript</a></li>
<li><a href="../200776/index.html">About my development experience for Android or training on Tic-Tac-Toe</a></li>
<li><a href="../200778/index.html">BlackBerry sale canceled</a></li>
<li><a href="../200780/index.html">Windows Azure and Hadoop: ‚Äúfriendship‚Äù, ready for Enterprise</a></li>
<li><a href="../200782/index.html">Amazon celebrates FAA with the sale of Kindle tablets</a></li>
<li><a href="../200784/index.html">Recovery after flooding in the Far East</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>