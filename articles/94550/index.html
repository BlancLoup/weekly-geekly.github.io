<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Delayed restart of Firefox: interactive and automatic ways</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are cases when Firefox has to be left unattended for a long time (for example, it runs an extension that collects critical news, or a built-in t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Delayed restart of Firefox: interactive and automatic ways</h1><div class="post__text post__text-html js-mediator-article">  There are cases when Firefox has to be left unattended for a long time (for example, it runs an extension that collects critical news, or a built-in torrent client, or even a mini-server).  It's no secret that with the time of the browser memory consumption increases.  Sooner or later, the system may feel discomfort.  Therefore, it would be good to be able to set the browser to postpone tasks to restart.  There are at least three types of such tasks. <a name="habracut"></a><br><br><hr><br><h3>  1. Single restart upon user request </h3><br>  First install the <a href="https://addons.mozilla.org/ru/firefox/addon/2707/">Custom Buttons</a> extension.  It allows you to create buttons on the toolbar to execute arbitrary code (and the code will be privileged, with extension rights).  In fact, it is a framework for quickly creating mini-extensions. <br><br>  After installation, create a button and in the first tab of the settings for this button, enter the following code: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre>  var timeout = prompt ("Enter the number of minutes to restart:", "1440");
 if (timeout) {
	 window.setTimeout ("Application.restart ();", timeout * 60 * 1000);
 } </pre><br>  In the dialog called up by pressing the button, you can enter the number of minutes before restarting.  The default is set to day. <br><br><hr><br><h3>  2. Unconditional periodic restart without user intervention </h3><br>  If the browser is provided to itself for a particularly long period, you may have to resort to repeated periodic restarts.  To do this, in the second tab of the settings of the newly created button (tab "Initialization"), you must enter the following code: <br><br><pre>  var timeout = 1440;  // minutes
 window.setTimeout ("Application.restart ();", timeout * 60 * 1000); </pre><br>  After each launch of the browser, the time set by the <code>timeout</code> parameter will begin.  Again, the default is to restart once a day, but the user can replace the number 1440 with any other (do not accidentally enter too small an interval (fraction), otherwise you will have to deal with the consequences in safe mode). <br><br>  If a restart is required at a specified time, and not after a specified period, <a href="http://rutracker.org/forum/viewtopic.php%3Fp%3D35404401">there</a> is a suitable solution. <br><br><hr><br><h3>  3. Conditional periodic restart without user intervention </h3><br>  To the previous method, we can add a check of one of the suitable conditions.  Consider two: the period of idle browser and the amount of memory occupied. <br><br><h5>  A. Check the time of inactivity user </h5><br>  The function will check the inactivity time every minute, and if it exceeds the <code>idleLimit</code> parameter (set in minutes), the browser will restart. <br><br><pre>  var idleLimit = 60;  // minutes
 var idleService =
	  Components.classes ["@ mozilla.org/widget/idleservice;1"]
	 .getService (Components.interfaces.nsIIdleService);
 window.setInterval (
	 function () {
		 if (idleService.idleTime / 60000&gt; idleLimit) {
			 Application.restart ();
		 }
	 },
	 60,000
 ); </pre><br><h5>  B. Check the amount of memory </h5><br>  It's all a bit more complicated.  A search in the MDC did not provide documented interfaces for obtaining such information.  But in Firefox 3.6, an <code>about:memory</code> page appeared.  Analysis of its code leads to the <code>chrome://global/content/aboutMemory.js</code> file, which uses several undocumented interfaces again.  With their help, you can take a chance on such a code (the function goes through the available types of memory, and if at least one of them exceeds the set limit (specified in megabytes), the browser will restart): <br><br><pre>  var memoryLimit = 200;  // megabytes
 var enumeratedReporters =
	  Components.classes ["@ mozilla.org/memory-reporter-manager;1"]
	 .getService (Components.interfaces.nsIMemoryReporterManager)
	 .enumerateReporters ();
 while (enumeratedReporters.hasMoreElements ()) {
	 if (
		  enumeratedReporters.getNext ()
		 .QueryInterface (Components.interfaces.nsIMemoryReporter)
		 .memoryUsed / 1000000
			 &gt; memoryLimit
	 ) {
		 Application.restart ();
	 }
 } </pre><br><blockquote>  However, it is not known how the interfaces used depend on the operating systems (there are mentions in the network that <code>about:memory</code> does not work in Linux).  It is also unclear in which version of Firefox these interfaces appeared.  Therefore, I would be grateful to the readers if they could test the following code and unsubscribe in the comments about what it issues on different OCs and different versions of Firefox (try not to repeat the configurations that have already been unsubscribed): <br><br><pre>  try {
	
	 var enumeratedReporters =
		  Components.classes ["@ mozilla.org/memory-reporter-manager;1"]
		 .getService (Components.interfaces.nsIMemoryReporterManager)
		 .enumerateReporters ();
	
	 var report = "";
	
	 while (enumeratedReporters.hasMoreElements ()) {
		 var memoryReporter =
			 enumeratedReporters.getNext ()
			 .QueryInterface (Components.interfaces.nsIMemoryReporter);
			
		 report + =
			 memoryReporter.path + ": \ t" +
			 memoryReporter.memoryUsed / 1000000 + "\ n";
	 }
	
	 alert (report || "Memory information not available.");
	
 } catch (error) {alert (error)} </pre></blockquote><br><h5>  B. We combine both checks </h5><br>  The function checks the idle time every minute.  When it exceeds the limit, the function will start checking the memory size every minute.  When this limit is exceeded, the browser will restart. <br><br><pre>  var idleLimit = 60;  // minutes
 var memoryLimit = 200;  // megabytes

 var idleService =
	  Components.classes ["@ mozilla.org/widget/idleservice;1"]
	 .getService (Components.interfaces.nsIIdleService);
 var reporterManager = 
	  Components.classes ["@ mozilla.org/memory-reporter-manager;1"]
	 .getService (Components.interfaces.nsIMemoryReporterManager);

 window.setInterval (
	 function () {
		 if (idleService.idleTime / 60000&gt; idleLimit) {
			 var enumeratedReporters = reporterManager.enumerateReporters ();
			 while (enumeratedReporters.hasMoreElements ()) {
				 if (
				    enumeratedReporters.getNext ()
				   .QueryInterface (Components.interfaces.nsIMemoryReporter)
				   .memoryUsed / 1000000
					 &gt; memoryLimit
				 ) {
					 Application.restart ();
				 }
			 }		
		 }
	 },
	 60,000
 ); </pre><br><hr><br>  It remains to add that before setting restarts, it is necessary to disable the check for browser updates and extensions (or at least make the updates automatic), otherwise the update dialogs may block Firefox after the next restart. </div><p>Source: <a href="https://habr.com/ru/post/94550/">https://habr.com/ru/post/94550/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../94539/index.html">Ubuntu 10.04 Drive Overview</a></li>
<li><a href="../94543/index.html">Techcrunch Disrupt Conference or Thoughtful Information for Beginner Startups</a></li>
<li><a href="../94544/index.html">Glory</a></li>
<li><a href="../94548/index.html">Stop asking me for confirmation</a></li>
<li><a href="../94549/index.html">Change Useragent in standard browser</a></li>
<li><a href="../94551/index.html">Made a site. A month has passed, the flight is normal</a></li>
<li><a href="../94553/index.html">Recorders for the book of records</a></li>
<li><a href="../94554/index.html">Microsoft loses employees and goes into manual mode</a></li>
<li><a href="../94557/index.html">Novosibirsk public transport can now be monitored.</a></li>
<li><a href="../94561/index.html">New type of phishing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>