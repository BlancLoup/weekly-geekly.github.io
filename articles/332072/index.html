<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>‚ÄúYou, thunderstorm, threaten, and we hold on to each other!‚Äù - tale about how I saved the ADSL modem</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=""The modem is on, 
 The provider is crying. 
 But he could not do otherwise. 
 Thunder rattles ... " 

 Thunderstorm! Element! Guard! Sometimes it is ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>‚ÄúYou, thunderstorm, threaten, and we hold on to each other!‚Äù - tale about how I saved the ADSL modem</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <i>"The modem is on,</i> <i><br></i>  <i>The provider is crying.</i> <i><br></i>  <i>But he could not do otherwise.</i> <i><br></i>  <i>Thunder rattles ... "</i> </blockquote><br><br>  Thunderstorm!  Element!  Guard!  Sometimes it is hard to predict how much damage it can do to home electronics ... Fortunately, it can be prevented, thereby eliminating the possibility of failure of, say, home routers and modems - they are usually primarily affected by violent phenomena of nature. <br><br><img src="https://habrastorage.org/web/836/465/39f/83646539fbbd476fad32e91e09bd6c87.jpg"><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Over the past summer, I have buried two modems at all - the sharp drops in the power supply network caused them to die.  In the same year, I finally had the courage to break this vicious circle and try to save poor D-Link from premature death! <br><br>  The most rational solution would be to just occasionally glance in the window and in case of a thunderstorm approach, disconnect the modem from the power supply network in advance;  but what if sometimes you have to leave your house for a long time, and your relatives don‚Äôt know what to do, where to press and what to switch in case of a thunderstorm? <br><br>  That's it!  That's why I thought that it would be nice to build some kind of EAS (Emergency Alert System) for the house, with a squeak, a warning on TV and other trinkets. <br><br>  For a start, I sketched out two simple little sheets that could be used to realize my plans.  The first is how to get the current weather code for the EAS client;  the second is what should be displayed on the TV screen. <br><br><div class="spoiler">  <b class="spoiler_title">First</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/d13/3c8/737/d133c8737f21442da40735e5a3e337e5.png"><br></div></div><br>  and <br><br><div class="spoiler">  <b class="spoiler_title">The second</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/720/db9/de6/720db9de6f1949dc83b5c260ab922d52.png"><br></div></div><br>  But, as they say in one well-known proverb, ‚Äúsoon the fairy tale is affected, but it is not done soon‚Äù.  I thought for a long time, how will I get an alert on TV;  continually postponing the implementation of the project for later, but then ‚Äúlater‚Äù it came unexpectedly ‚Äî in the head, an extremely simple idea arose of how to deal with this problem. <br><br>  The solution was to turn the Raspberry Pi B + into an EAS client by launching the epiphany browser in kiosk mode.  The browser clings to the local web server, which, in turn, returns the following code: <br><br><pre><code class="html hljs xml">... <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> setInterval(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'window.location.reload()'</span></span></span><span class="actionscript">, </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">60000</span></span></span><span class="actionscript">); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> ... <span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">if</span></span></span><span class="php">( !is_available( $home_server ) ) { </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">echo</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">'&lt;center&gt;&lt;div class="center"&gt;&lt;h1&gt;The EAS server is offline...&lt;/h1&gt;&lt;center&gt;&lt;p&gt;An attempt to reconnect to the server will be performed in 60 seconds&lt;/p&gt;&lt;/center&gt;&lt;/div&gt;&lt;/center&gt;'</span></span></span><span class="php">; } </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">else</span></span></span><span class="php"> { </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">echo</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">'&lt;iframe src="http://podivilov.local/api/method/EAS.getCode/" style="position:fixed; top:0px; left:0px; bottom:0px; right:0px; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden; z-index:999999;"&gt;Iframe does not supported by this browser...&lt;/iframe&gt;'</span></span></span><span class="php">; } </span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span> ...</code> </pre> <br>  Thus, thanks to the simple js-script and the iframe tag, we <s>created a crutch and burdened ourselves with unnecessary problems</s> made our lives easier;  because if the home server is unavailable due to the fact that it was turned off before a thunderstorm, the browser will not issue a standard error, they say, ‚Äúalas, there‚Äôs no more access to the network‚Äù (and will wait for a long time until someone deigns to poke a mouse button "refresh page"), but just continue to update the page every minute and try to load the contents of the iframe. <br><br><img src="https://habrastorage.org/web/279/98a/233/27998a233bf54056aee54ca66a1d8b22.jpg"><br><br>  But let's not get so far ahead, let's see how the EAS-client works from the inside;  to be more precise, how does the download: <br><br><ol><li>  Start OS (raspbian) </li><li>  Accessing the /etc/rc.local script </li><li>  Initializing X's with xinit </li><li>  Browser launch </li><li>  Connect to server </li><li>  Receive and output data </li></ol><br>  The /etc/rc.local script differs from the original one single line: <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta">#!/bin/sh -e ##    xinit ./home/eas/eas.boot &amp; exit 0</span></span></code> </pre> <br>  And the /home/eas/eas.boot script is responsible for launching the browser: <br><br><pre> <code class="hljs pgsql">#!/bin/sh ##     DPMS xset -dpms ##    xset s <span class="hljs-keyword"><span class="hljs-keyword">off</span></span> ##     xset s noblank ##    matchbox-<span class="hljs-keyword"><span class="hljs-keyword">window</span></span>-manager -use_titlebar <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> &amp; ##    unclutter -idle <span class="hljs-number"><span class="hljs-number">0.01</span></span> -root &amp; ##    kiosk-    WEBKIT_DISABLE_TBS=<span class="hljs-number"><span class="hljs-number">1</span></span> epiphany-browser -a http://podivilov.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>/ <span class="hljs-comment"><span class="hljs-comment">--profile /home/eas/.config</span></span></code> </pre> <br>  Our browser accesses the home server, denoted as podivilov.local;  the same, in turn, requests weather data from the external server, default and extra codes (default is an integer, zero or one; null - EAS is not activated, one is activated; extra is a weather code obtained from the weather forecast site, required for debugging). <br><br>  It happens as follows: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> ... $code_default = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://***.podivilov.ru/api/method/weather.getCode/?token=*****'</span></span>); $code_extra = file_get_contents(<span class="hljs-string"><span class="hljs-string">'https://***.podivilov.ru/api/method/weather.getCode.extra/?token=*****'</span></span>); ... <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  Weather data external server receives from the site <a href="http://openweathermap.org/">openweathermap.org</a> : <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> ... $json = file_get_contents(<span class="hljs-string"><span class="hljs-string">'http://api.openweathermap.org/data/2.5/weather?lat=**.******&amp;lon=**.******&amp;APPID=*****'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// lat &amp; lon ‚Äì   ,  APPID ‚Äì api-,        $data = json_decode($json,true); $result = substr($data['weather'][0]['icon'], 0, -1); ... </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br>  The extra-code received by the server is processed by passing through several conditions, and at the output we get a code that can already be used to prevent potential burning out of the modem and other household appliances. <br><br>  Depending on the weather conditions and the received code, our system displays various sets of numbers: for example, if a strong thunderstorm is expected and you should turn off the No. 1 plugs (router / modem) together with No. 2 (other household appliances), and also manually release the ADSL- port on the modem (in order to prevent possible burnout of the port), the EAS-system displays the code 12 (plug number 1 and number 2). <br><br><div class="spoiler">  <b class="spoiler_title">Traffic jams are numbered;</b>  <b class="spoiler_title">the decryption of codes hangs on the switchboard</b> <div class="spoiler_text"><img src="https://habrastorage.org/web/e0e/382/f17/e0e382f1765b4c0e88d633aa7ec45bd0.png"></div></div><br>  In addition, every half hour on home computers, the task manager runs the following script (it polls the server if a thunderstorm is expected; if the answer is positive, a program is launched warning of a possible cataclysm): <br><br><pre> <code class="vbscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">dim</span></span> xHttp: <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> xHttp = <span class="hljs-built_in"><span class="hljs-built_in">createobject</span></span>(<span class="hljs-string"><span class="hljs-string">"MSXML2.ServerXMLHTTP"</span></span>) xHttp.Open <span class="hljs-string"><span class="hljs-string">"GET"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://***.podivilov.ru/api/method/weather.getCode/?token=*****"</span></span>, <span class="hljs-literal"><span class="hljs-literal">False</span></span> xHttp.setOption <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">13056</span></span> xHttp.Send <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> xHttp.responseText = <span class="hljs-string"><span class="hljs-string">"1"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objShell = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"WScript.Shell"</span></span>) objShell.Run <span class="hljs-string"><span class="hljs-string">"""C:\\\\EAS.exe"""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objShell = <span class="hljs-literal"><span class="hljs-literal">Nothing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Else</span></span> WScript.Quit <span class="hljs-keyword"><span class="hljs-keyword">End</span></span> <span class="hljs-keyword"><span class="hljs-keyword">If</span></span></code> </pre> <br>  But, you see, it is better to see once than to hear a thousand times.  Actually, before you is the result of what the story was told above: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/3mqGlZpjbp0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Here and the fairy tale is over, and who listened - well done ... Take care of yourself and your modems! <br><br>  Thanks for attention! <br><br>  - <div class="spoiler">  <b class="spoiler_title">UPD1.</b>  <b class="spoiler_title">EAS system in action</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://www.youtube.com/embed/U28zW_8IKn8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/332072/">https://habr.com/ru/post/332072/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332062/index.html">Who is Mr. Hacker?</a></li>
<li><a href="../332064/index.html">How to confuse the analyst. Part Two: What is domain modeling?</a></li>
<li><a href="../332066/index.html">Probabilistic and informational analysis of measurement results in Python</a></li>
<li><a href="../332068/index.html">Automation blocking Petya / NonPetya</a></li>
<li><a href="../332070/index.html">We answer readers' questions: what is the IBM Watson cognitive system, and how does it work?</a></li>
<li><a href="../332074/index.html">Autoencoders in Keras, Part 6: VAE + GAN</a></li>
<li><a href="../332076/index.html">Dynamic instrumentation is not easy, but trivial *: we write yet another instrumentation for American Fuzzy Lop</a></li>
<li><a href="../332078/index.html">Classifying Text with Java Neural Network</a></li>
<li><a href="../332080/index.html">Hackers and exchanges: how to attack the sphere of finance</a></li>
<li><a href="../332082/index.html">Integration of 1C with DLL using Python</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>