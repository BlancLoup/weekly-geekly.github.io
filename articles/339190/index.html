<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Obvious non-obviousness in assembly using a webpack</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Working in a large company, it was possible to intercept an internal project that had to be completed yesterday. The people roamed and tramped along i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Obvious non-obviousness in assembly using a webpack</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/59/d2/8d/59d28db598c21927003649.png" alt="image"></p><br><p>  Working in a large company, it was possible to intercept an internal project that had to be completed yesterday.  The people roamed and tramped along it, developing the culture of Saint Copipasta.  And package.json grew by leaps and bounds.  After only a year, we managed to start refactoring.  In this article we will focus on one specific optimization, which I have not heard anything about on the Runet. </p><a name="habracut"></a><br><h2 id="a-nachalos-vse">  It all began ... </h2><br><p>  ... from my surprise.  The non-minimized application bundle weighed 44 MB, included about 4 thousand modules, the assembly took about 8 minutes.  With even more surprise, I looked at the simultaneously connected lodash and lodash-es.  Dances with a tambourine, cutting out a "dead" code, removing modules that almost duplicate each other (for example, all the same lodash and lodash-es) and as a result - 3 thousand modules, 30 MB, 5 minutes.  Then there were more searches on Habr√© and non-dumb, application of the information found, cutting off the extra locales of the moment, switching to TypeScript (currently used only as a transpiler, but this is a completely different story) - 2.5 thousand modules, 1 min.  30 sec., 20 MB. <br>  It is worthy. </p><br><p>  But once exploring the beta version of the <a href="https://github.com/callemall/material-ui/">material-ui</a> came across an interesting <a href="https://material-ui-1dab0.firebaseapp.com/guides/minimizing-bundle-size/">page</a> .  If you clicked on the link, read and understood everything, then you will not be interested further. </p><br><h2 id="dlya-teh-kto-esche-s-nami">  For those who are still with us </h2><br><p>  Suppose we have a small project, in the root directory of which are: </p><br><ul><li>  package.json </li></ul><br><pre><code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"webpack-bundle-example"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"scripts"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"webpack"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"dependencies"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"lodash-es"</span></span>: <span class="hljs-string"><span class="hljs-string">"^4.17.4"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"webpack"</span></span>: <span class="hljs-string"><span class="hljs-string">"^3.6.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"webpack-bundle-analyzer"</span></span>: <span class="hljs-string"><span class="hljs-string">"^2.9.0"</span></span> } }</code> </pre> <br><ul><li>  Webpack.config.js collector config </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> {BundleAnalyzerPlugin} = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack-bundle-analyzer'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: <span class="hljs-string"><span class="hljs-string">'./index'</span></span>, <span class="hljs-attr"><span class="hljs-attr">output</span></span>: { <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">'index.bundle.js'</span></span>, <span class="hljs-attr"><span class="hljs-attr">path</span></span>: path.resolve(__dirname, <span class="hljs-string"><span class="hljs-string">'build'</span></span>) }, <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BundleAnalyzerPlugin({ <span class="hljs-attr"><span class="hljs-attr">analyzerMode</span></span>: <span class="hljs-string"><span class="hljs-string">'static'</span></span> }) ] };</code> </pre> <br><ul><li>  Entry point of our application - index.js (it doesn‚Äôt matter what happens in the script, we are only interested in importing) </li></ul><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {mapValues} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash-es'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(mapValues({<span class="hljs-attr"><span class="hljs-attr">a</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">b</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}, (...args) =&gt; args));</code> </pre> <br><p>  At the root, execute <code>npm i</code> and after installing the dependencies, run the <code>npm start</code> build. </p><br><p>  The <code>BundleAnalyzerPlugin</code> plugin <code>BundleAnalyzerPlugin</code> generate for us a map, which will be clear from what the bundle consists of. <br>  And on this map, we see that the bundle contains files from the <code>node_modules</code> directory <code>node_modules</code> total weight of 608 Kb (!). <br><img src="https://habrastorage.org/webt/59/d2/a5/59d2a5f7a8090994474133.jpeg"></p><br><p>  And we just imported one function from lodash-es.  Bold, is not it? </p><br><h2 id="ne-ochevidno-ochevidnoe-reshenie">  No obvious solution </h2><br><p>  The solution is as simple as twice two.  For me it turned out to be so obvious that I still consider it absolutely not obvious. </p><br><p>  You can import directly from <code>lodash-es/</code> to avoid pulling in unused modules.  For instance, instead of: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {mapValues} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash-es'</span></span>;</code> </pre> <br><p>  use: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mapValues <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lodash-es/mapValues'</span></span>;</code> </pre> <br><p>  And after the assembly we get the following map of our modules and we are surprised - 82 Kb: <br><img src="https://habrastorage.org/webt/59/d2/a8/59d2a8f6d267a664287259.jpeg"></p><br><p>  Having changed only one line in the project, we got almost an 8-fold reduction in the size of the bundle. </p><br><p>  Do you still remember the project from the beginning of the article?  So ... 11 MB, 40 seconds, 1.7 thousand modules </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/339190/">https://habr.com/ru/post/339190/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339176/index.html">Node.js and transition from PHP to JavaScript</a></li>
<li><a href="../339178/index.html">How to permanently delete 100,000 users and stay alive?</a></li>
<li><a href="../339180/index.html">[CppCon 2017] Lars Knoll: C ++ Qt framework: History, Present and Future</a></li>
<li><a href="../339184/index.html">Ivan Ponomarev and Nikolai Potashnikov on the display of tabular data, Celesta and Flute on jug.msk.ru</a></li>
<li><a href="../339186/index.html">[CppCon 2017] Herb Sutter: Metaprogramming and Code Generation in C ++</a></li>
<li><a href="../339192/index.html">Why in Go ampersand and asterisk (& and *)?</a></li>
<li><a href="../339194/index.html">Next billion users: who these people are and how they will affect the global economy</a></li>
<li><a href="../339196/index.html">Dirty place provider: the project blondemine</a></li>
<li><a href="../339198/index.html">Hacktoberfest Open Hack Day at Avito - October 7</a></li>
<li><a href="../339200/index.html">Development of the first game. Impressions and work on the bugs. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>