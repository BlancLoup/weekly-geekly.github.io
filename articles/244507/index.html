<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Equalization of histograms for image enhancement</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. Now we are preparing a monograph with a supervisor for publication, where we are trying to tell in simple words about the basics of digital ima...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Equalization of histograms for image enhancement</h1><div class="post__text post__text-html js-mediator-article">  Hello.  Now we are preparing a monograph with a supervisor for publication, where we are trying to tell in simple words about the basics of digital image processing.  This article reveals a very simple, but at the same time very effective method of improving the quality of images - equalization of histograms. <br><a name="habracut"></a><br>  For simplicity, we will begin consideration with monochrome images (ie, images containing information only about the brightness, but not about the color of the pixels).  The image histogram will be called the discrete function H, defined on the set of values ‚Äã‚Äã[0; 2 <sup>bpp</sup> ], where bpp is the number of bits allocated for coding the brightness of one pixel.  Although it is not necessary, histograms are often normalized to the range [0; 1], dividing each value of the function H [i] by the total number of pixels of the image.  Tab.  1 shows examples of test images and histograms based on them: <br>  <i>Tab.</i>  <i>1. Images and their histograms</i> <br><img src="https://habrastorage.org/files/e4d/fe1/70b/e4dfe170b6544bb499e45a072ca1d3db.png"><br>  Having carefully studied the corresponding histogram, we can draw some conclusions about the original image itself.  For example, histograms of very dark images are characterized by the fact that non-zero values ‚Äã‚Äãof the histogram are concentrated near zero brightness levels, and for very bright images, on the contrary, all non-zero values ‚Äã‚Äãare concentrated on the right side of the histogram. <br>  Intuitively, it can be concluded that the most convenient person for perception will be an image whose histogram is close to a uniform distribution.  Those.  to improve the visual quality of the image, it is necessary to apply such a transformation so that the result histogram contains all possible brightness values ‚Äã‚Äãand at the same time in approximately the same amount.  This conversion is called histogram equalization and can be performed using the code in Listing 1. <br>  <i>Listing 1. Implementing a histogram equalization procedure</i> <br><blockquote><ol><li>  <font color="#000000">procedure</font> TCGrayscaleImage <font color="#000066">.</font>  <font color="#006600">HistogramEqualization</font> <font color="#000066">;</font> </li><li>  <font color="#000000">const</font> </li><li>  k <font color="#000066">=</font> <font color="#0000ff">255</font> <font color="#000066">;</font> </li><li>  <font color="#000000">var</font> </li><li>  h <font color="#000066">:</font> <font color="#000000">array</font> <font color="#000066">[</font> <font color="#0000ff">0</font> <font color="#000066">..</font> <font color="#006600">k</font> <font color="#000066">]</font> <font color="#000000">of</font> <font color="#000066">double</font> <font color="#000066">;</font> </li><li>  i <font color="#000066">,</font> j <font color="#000066">:</font> <font color="#000066">word</font> <font color="#000066">;</font> </li><li>  <font color="#000000">begin</font> </li><li>  <font color="#000000">for</font> i <font color="#000066">:</font> <font color="#000066">=</font> <font color="#0000ff">0</font> <font color="#000000">to</font> k <font color="#000000">do</font> </li><li>  h <font color="#000066">[</font> i <font color="#000066">]</font> <font color="#000066">:</font> <font color="#000066">=</font> <font color="#0000ff">0</font> <font color="#000066">;</font> </li><li>  <font color="#000000">for</font> i <font color="#000066">:</font> <font color="#000066">=</font> <font color="#0000ff">0</font> <font color="#000000">to</font> <font color="#000000">self</font> <font color="#000066">.</font>  <font color="#006600">Height</font> <font color="#000066">-</font> <font color="#0000ff">1</font> <font color="#000000">do</font> </li><li>  <font color="#000000">for</font> j <font color="#000066">:</font> <font color="#000066">=</font> <font color="#0000ff">0</font> <font color="#000000">to</font> <font color="#000000">self</font> <font color="#000066">.</font>  <font color="#006600">Width</font> <font color="#000066">-</font> <font color="#0000ff">1</font> <font color="#000000">do</font> </li><li>  h <font color="#000066">[</font> <font color="#000066">round</font> <font color="#000066">(</font> k <font color="#000066">*</font> <font color="#000000">self</font> <font color="#000066">.</font> <font color="#006600">Pixels</font> <font color="#000066">[</font> i <font color="#000066">,</font> j <font color="#000066">]</font> <font color="#000066">)</font> <font color="#000066">]</font> <font color="#000066">:</font> <font color="#000066">=</font> h <font color="#000066">[</font> <font color="#000066">round</font> <font color="#000066">(</font> k <font color="#000066">*</font> <font color="#000000">self</font> <font color="#000066">.</font> <font color="#006600">Pixels</font> <font color="#000066">[</font> i <font color="#000066">,</font> j <font color="#000066">]</font> <font color="#000066">)</font> <font color="#000066">]</font> <font color="#000066">+</font> <font color="#0000ff">1</font> <font color="#000066">;</font> </li><li>  <font color="#000000">for</font> i <font color="#000066">:</font> <font color="#000066">=</font> <font color="#0000ff">0</font> <font color="#000000">to</font> k <font color="#000000">do</font> </li><li>  h <font color="#000066">[</font> i <font color="#000066">]</font> <font color="#000066">:</font> <font color="#000066">=</font> h <font color="#000066">[</font> i <font color="#000066">]</font> <font color="#000066">/</font> <font color="#000066">(</font> <font color="#000000">self</font> <font color="#000066">.</font> <font color="#006600">Height</font> <font color="#000066">*</font> <font color="#000000">self</font> <font color="#000066">.</font> <font color="#006600">Width</font> <font color="#000066">)</font> <font color="#000066">;</font> </li><li></li><li>  <font color="#000000">for</font> i <font color="#000066">:</font> <font color="#000066">=</font> <font color="#0000ff">1</font> <font color="#000000">to</font> k <font color="#000000">do</font> </li><li>  h <font color="#000066">[</font> i <font color="#000066">]</font> <font color="#000066">:</font> <font color="#000066">=</font> h <font color="#000066">[</font> i <font color="#000066">-</font> <font color="#0000ff">1</font> <font color="#000066">]</font> <font color="#000066">+</font> h <font color="#000066">[</font> i <font color="#000066">]</font> <font color="#000066">;</font> </li><li>  <font color="#000000">for</font> i <font color="#000066">:</font> <font color="#000066">=</font> <font color="#0000ff">0</font> <font color="#000000">to</font> <font color="#000000">self</font> <font color="#000066">.</font>  <font color="#006600">Height</font> <font color="#000066">-</font> <font color="#0000ff">1</font> <font color="#000000">do</font> </li><li>  <font color="#000000">for</font> j <font color="#000066">:</font> <font color="#000066">=</font> <font color="#0000ff">0</font> <font color="#000000">to</font> <font color="#000000">self</font> <font color="#000066">.</font>  <font color="#006600">Width</font> <font color="#000066">-</font> <font color="#0000ff">1</font> <font color="#000000">do</font> </li><li>  <font color="#000000">self</font> <font color="#000066">.</font>  <font color="#006600">Pixels</font> <font color="#000066">[</font> i <font color="#000066">,</font> j <font color="#000066">]</font> <font color="#000066">:</font> <font color="#000066">=</font> h <font color="#000066">[</font> <font color="#000066">round</font> <font color="#000066">(</font> k <font color="#000066">*</font> <font color="#000000">self</font> <font color="#000066">.</font> <font color="#006600">Pixels</font> <font color="#000066">[</font> i <font color="#000066">,</font> j <font color="#000066">]</font> <font color="#000066">)</font> <font color="#000066">]</font> <font color="#000066">;</font> </li><li>  <font color="#000000">end</font> <font color="#000066">;</font> </li><li></li></ol></blockquote><br>  As a result of histogram equalization in most cases, the dynamic range of the image is significantly expanded, which allows you to display previously unnoticed details.  This effect is particularly pronounced in dark images, as shown in Table.  2. In addition, it is worth noting another important feature of the equalization procedure: unlike most filters and gradation transformations that require setting parameters (apertures and gradation conversion constants), histogram equalization can be performed in fully automatic mode without operator intervention. <br>  <i>Tab.</i>  <i>2. Images and histograms after equalization</i> <br><img src="https://habrastorage.org/files/083/1c8/b21/0831c8b217fc41cc9019e9e183293b74.png"><br>  It is easy to see that histograms after equalization have peculiar noticeable gaps.  This is due to the fact that the dynamic range of the output image is wider than the range of the original.  Obviously, in this case, the mapping considered in Listing 1 cannot provide nonzero values ‚Äã‚Äãin all histogram pockets.  If you still need to achieve a more natural look of the output histogram, you can use a random distribution of the values ‚Äã‚Äãof the i-th histogram pocket in some of its surroundings. <br>  It is obvious that equalization of histograms makes it possible to easily improve the quality of monochrome images.  Naturally you want to apply a similar mechanism to color images. <br>  Most not very experienced developers present an image in the form of three RGB color channels and try to apply the histogram equalization procedure to each color one separately.  In some rare cases, this allows you to succeed, but in most cases the result is so-so (the colors are unnatural and cold).  This is due to the fact that the RGB model does not accurately display the color perception of a person. <br>  Think of a different color space - HSI.  This color model (and others related to it) is very widely used by illustrators and designers as they allow one to operate with the concepts of color tone, saturation and intensity that are more familiar to humans. <br>  If we consider the projection of the RGB cube in the direction of the diagonal white-black, we get a hexagon, the corners of which correspond to primary and secondary colors, and all gray shades (lying on the diagonal of the cube) are projected into the center point of the hexagon (see Fig. 1): <br><img src="https://habrastorage.org/files/5a2/185/4eb/5a21854ebfcf493ab7e0a32bbd3150ee.png"><br>  <i>Fig.</i>  <i>1. Projection of the color cube</i> <br>  To use this model to encode all the colors available in the RGB model, you need to add a vertical axis of lightness (or intensity) (I).  The result is a hex cone (Fig. 2, Fig. 3): <br><img src="https://habrastorage.org/files/cff/aac/518/cffaac5180d248799865c07b7e2084ef.png"><br>  <i>Fig.</i>  <i>2. HSI Pyramid (vertices)</i> <br>  In this model, the color tone (H) is set by the angle relative to the red axis, the saturation (S) represents the purity of the color (1 means a completely pure color, and 0 corresponds to a shade of gray).  At zero saturation, the tone is meaningless and undefined. <br><img src="https://habrastorage.org/files/a3a/2a6/6b8/a3a2a66b8a974632ac355f345f0d7851.png"><br>  <i>Fig.</i>  <i>3. HSI Pyramid</i> <br>  Tab.  Figure 3 shows the image decomposition in HSI components (white pixels in the tone channel correspond to zero saturation): <br>  <i>Tab.</i>  <i>3. HSI color space</i> <br><img src="https://habrastorage.org/files/884/762/61d/88476261dfd64159b332bf65787bf992.png"><br>  It is believed that to improve the quality of color images it is most effective to apply the procedure of equalization to the intensity channel.  This is what is shown in Table.  four <br>  <i>Tab.</i>  <i>4. Equalization of various color channels</i> <br><img src="https://habrastorage.org/files/d91/43e/b70/d9143eb70fc34b0c9c6cac32a0b77cfb.png"><br>  I hope this material seemed at least as interesting to you as maximum useful.  Thank. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/244507/">https://habr.com/ru/post/244507/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../244487/index.html">Swift Multiple Functions</a></li>
<li><a href="../244491/index.html">Looking for the perfect file storage</a></li>
<li><a href="../244493/index.html">Creating the game on your eyes - part 8: Visual scripting of cut scenes in Unity (uScript)</a></li>
<li><a href="../244497/index.html">Factory method without placement in dynamic memory</a></li>
<li><a href="../244505/index.html">Vectorization of cycles: diagnosis and control</a></li>
<li><a href="../244509/index.html">The project 1C-Tools became the winner of the selection in U.M.NI.K.</a></li>
<li><a href="../244511/index.html">Samsung's DeepSort ranked first in the Sort Benchmark 2014 competition</a></li>
<li><a href="../244515/index.html">The company Global Web Index presented a statistical report on the Internet preferences of Europeans in 2014</a></li>
<li><a href="../244517/index.html">Inversion of Control: Implementation Methods with PHP Examples</a></li>
<li><a href="../244519/index.html">How to warm up for a "foreign" account</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>