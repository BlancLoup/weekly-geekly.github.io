<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Indoor navigation with iBeacon in iOS7</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="IOS7 adds support for iBeacon. Internet is full of headlines: 
 - Why iBeacon may be the most important feature of iOS7 . 
 - iBeacon will open a new ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Indoor navigation with iBeacon in iOS7</h1><div class="post__text post__text-html js-mediator-article">  IOS7 adds support for iBeacon.  Internet is full of headlines: <br>  - Why iBeacon may be the most important feature of iOS7 <a href="http://www.forbes.com/sites/anthonykosner/2013/08/29/why-micro-location-ibeacons-may-be-apples-biggest-new-feature-for-ios-7/">.</a> <br>  - iBeacon will open a new era of location applications <a href="http://www.iphonehacks.com/2013/08/ios-7-ibeacons-location-apps.html">.</a> <br>  - How iBeacon can kill NFC <a href="http://www.businessinsider.com/how-apples-new-ibeacon-may-be-the-end-of-nfc-2013-9">.</a> <br>  - iBeacon and the future of mobile payments <a href="http://www.macworld.co.uk/apple-business/news/%3Fnewsid%3D3469042">.</a> <br><br>  According to journalists, this is a super technology that will change the market for mobile payments, indoor navigation, consumer habits and at the same time kill NFC. <br><br>  Under the cut, I'll tell you what iBeacon really is, how you can use it and show an example of an application for navigating <a href="http://touchin.ru/">our</a> office. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage3/52a/46a/656/52a46a6569c6724a2d2f7248de8aab09.png"><br><a name="habracut"></a><br>  iBeacon is a beacon that transmits three parameters of proximity UUID, major and minor via <a href="http://en.wikipedia.org/wiki/Bluetooth_low_energy">Bluetooth Low Energy</a> .  iOS7 makes it easy to work with such devices. <br><br>  <b>proximity UUID</b> is a unique 128-bit identifier, all the beacons of your company or within a building have the same pUUID.  <b>major</b> and <b>minor</b> are 16-bit unsigned integers for the numbering of beacons within one pUUID.  These are Apple recommendations, you can set absolutely any values ‚Äã‚Äãfor these parameters, but the recommended scheme is more convenient. <br><br>  Available pre-order on the beacons from <a href="http://estimote.com/">Estimote</a> and <a href="http://kontakt.io/">Kontakt</a> . <br> <a href="http://kontakt.io/"><img src="https://habrastorage.org/storage3/5cb/57b/774/5cb57b7747a0d9e0a80a6f442141edc1.png" align="left"></a> <a href="http://estimote.com/"><img src="https://habrastorage.org/storage3/140/faa/f5e/140faaf5e5dd7ede9a72682ccf4bbce6.png"></a> <br><br>  One beacon costs $ 30, works two years from the battery.  Many companies are <a href="http://redbearlab.com/ibeacon/">refining</a> their products to support the iBeacon profile.  I think within three months there will be Chinese counterparts at $ 10. <br><br>  iOS devices can act as a beacon, it allows you to play with the new API now. <br><br>  Three classes have been added to the <a href="https://developer.apple.com/library/ios/documentation/CoreLocation/Reference/CoreLocation_Framework/_index.html">Core Location Framework</a> : CLBeacon, CLBeaconRegion and CLCircularRegion.  In CLLocationManager, the methods areRangingAvailable, rangedRegions, requestStateForRegion, startMonitoringForRegion, startRangingBeaconsInRegion, and the corresponding events in CLLocationManagerDelegate appeared.  startMonitoringForRegion now supports not only GPS regions but also Bluetooth.  About how to use it is described <a href="https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/LocationAwarenessPG/RegionMonitoring/RegionMonitoring.html">in</a> detail <a href="https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/LocationAwarenessPG/RegionMonitoring/RegionMonitoring.html">in the documentation</a> . <br><br>  <b>In fact, the new API provides two possibilities:</b> <br><ol><li>  Obtaining a list of beacons in sight with a specific Proximity UUID (you can narrow down the search by specifying the value major or major / minor) using the startRangingBeaconsInRegion method.  The API determines the distance to the beacon (Immediate, Near, Far) and the distance error in meters. </li><li>  Monitoring the region.  When a user enters or leaves the beacon, the didEnterRegion / didEnterRegion events occur (startMonitoringForRegion method).  Moreover, monitoring works even when your application is in the background, when an event occurs, the application will be awakened. </li></ol><br>  Use the data to obtain the coordinates of the device in the room <b>can not</b> .  In the explanation of the error of the distance (accuracy) it is directly written ‚Äúto make a beacon‚Äù.  Experiments confirm the data is not suitable for triangulation. <br><br>  Possible applications of iBeacons: <br><ol><li>  Indoor navigation: we hang the beacons in each room (the same proximity UUID, different major for floors / departments, different minor for rooms).  On the map we display the nearest beacon to the smartphone. </li><li>  Interactive tour of the museum: for each exhibit sticking beacons, when approaching the exhibit we show additional information about it. </li><li>  Accurate positioning in the city.  We hang beacons on monuments and objects of architecture.  The whole city turns into a museum. </li><li>  Navigation for the blind.  When a beacon is detected, play a voice message where the user is and where to go next. </li><li>  Location games and quests.  For example, a simple demo game " <a href="http://blog.xamarin.com/play-find-the-monkey-with-ios-7-ibeacons/">find a monkey</a> " </li><li>  Discounts and promotions in stores.  We pass by the jeans (a beacon is installed on the rack) and we receive a message about a buy-two-pair-third-in-gift. </li><li>  Tincture equipment.  Not sure if this is generally related to iBeacon, but with iOS7 Apple TV can be <a href="http://support.apple.com/kb/HT5900%3Fviewlocale%3Den_US%26locale%3Den_US">customized with the touch of an iPhone</a> . </li></ol><br><br>  iPhone 4s +, iPad 3+ can work as a beacon.  I decided to write a simple navigation through our office using test iOS devices.  If you do not have Xamarin.iOS or a desire to build an application, try the <a href="https://itunes.apple.com/us/app/estimote-virtual-beacon/id686915066%3Fmt%3D8">Estimote App</a> .  The app demonstrates new features (two iOS devices with Bluetooth LE are required). <br><br>  So.  Our office map: <br><img src="https://habrastorage.org/storage3/579/4ab/4fc/5794ab4fcf4a2411278a1dcb3fe989a8.jpg"><br><br>  For navigation, you need beacons with iOS7, I dialed test devices and laid them out in the center of cabinets 310, 311 and 312. It took a total of 3 beacons and one receiver. <br><img src="https://habrastorage.org/storage3/612/ea4/a19/612ea4a1947955ce638ed4b7ab761739.jpg" align="left"><img src="https://habrastorage.org/storage3/326/44b/a31/32644ba3116da47c26c8723dc627e16a.jpg"><br><br>  We take the Xamarin <a href="http://docs.xamarin.com/samples/AirLocate">AirLocate</a> demo application as a <a href="http://docs.xamarin.com/samples/AirLocate">basis</a> .  It is able to turn on the proximity UUID, major and minor translation (parameters are configured) and display a list of available beacons around with given pUUID. <br><br>  Application code with navigation through our office is available <a href="https://github.com/alarin/monotouch-samples/tree/master/AirLocate">on github</a> .  Just want to apologize for the terrible code, I am a marketer and this is my first iOS application. <br><br>  Set beacons the same proximity UUID, major set equal to the number of the cabinet.  Beacon activation code (does not work in the background, you need to turn off auto-lock): <br><br><pre><code class="cs hljs">CLBeaconRegion region = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CLBeaconRegion (uuid, major.UInt16Value, minor.UInt16Value, Defaults.Identifier); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (region != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) peripheralManager.StartAdvertising (region.GetPeripheralData (power));</code> </pre> <br>  AirLocate gives a list of available beacons with distance and accuracy, an example of 312 cabinets (the beacon of 310 does not finish off). <br><img src="https://habrastorage.org/storage3/13e/fe5/a7b/13efe5a7b4ad3fe2c91b1761879007be.png"><br><br>  Create a <a href="">MapViewController</a> that will draw a rectangle above the cabinet, the number of which is contained in the major nearest beacon. <br><pre> <code class="cs hljs">locationManager = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CLLocationManager (); locationManager.DidRangeBeacons += HandleDidRangeBeacons; locationManager.StartRangingBeacons (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CLBeaconRegion(Defaults.SupportedProximityUuids[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">"office_beacon"</span></span>));</code> </pre><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleDidRangeBeacons</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, CLRegionBeaconsRangedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { drawRegion (e.Beacons [<span class="hljs-number"><span class="hljs-number">0</span></span>]); }</code> </pre><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(beacon.Major)) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">310</span></span>: path.AddRect(roomCoords[<span class="hljs-number"><span class="hljs-number">0</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">311</span></span>: path.AddRect(roomCoords[<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">312</span></span>: path.AddRect(roomCoords[<span class="hljs-number"><span class="hljs-number">2</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre>  (sorry again for the terrible code). <br><br>  Now you can walk around the office and test. <br><img src="https://habrastorage.org/storage3/09c/cec/e8b/09ccece8b5cc789668302c3b2e275f9f.png" align="left"><img src="https://habrastorage.org/storage3/b21/748/f40/b21748f406ec1c28dd0ede70239a1d40.png"><br><br>  Works! <br><br>  The accuracy of the definition of the cabinet is excellent, but the update rate is not very, if you go to another room with the usual step, the map will be updated in 10-30 seconds. <br><br>  The app is worth improving.  Add threshold accuracy, so that in neighboring offices and a corridor without beacons, the map does not draw cabinets with beacons.  And to draw not rectangles, but circles with accuracy radius.  But for demonstration purposes it is enough. <br><br>  In general, nothing revolutionary iBeacon from itself is not, but Apple definitely gave a strong impetus to the development of radar applications.  For iOS7, they are written in a dozen lines of code. <br><br><hr>  The picture in the cap from the site estimote.com, images of lighthouses from the sites of manufacturers. <br><br>  Subscribe to our <a href="http://habrahabr.ru/company/touchinstinct/blog/">blog</a> .  Every Thursday useful articles about mobile development, marketing and business of mobile studio. </div><p>Source: <a href="https://habr.com/ru/post/195104/">https://habr.com/ru/post/195104/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../195092/index.html">On university rankings: separating the wheat from the chaff</a></li>
<li><a href="../195096/index.html">Challenge on intelligence and prize from Anatoly Wasserman</a></li>
<li><a href="../1951/index.html">W3C creates standards for safe surfing.</a></li>
<li><a href="../19510/index.html">Digg War</a></li>
<li><a href="../195102/index.html">We continue to dismantle the quest Harvester 1996</a></li>
<li><a href="../195106/index.html">Windows Camp 3: how it was + new courses on MVA</a></li>
<li><a href="../195108/index.html">IBM Watson will be twice smarter</a></li>
<li><a href="../19511/index.html">Startups</a></li>
<li><a href="../195110/index.html">Meeting rooms reservation - integration of SharePoint 2010 with Exchange 2010</a></li>
<li><a href="../195116/index.html">The unique IaaS solution from the company "Microtest"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>