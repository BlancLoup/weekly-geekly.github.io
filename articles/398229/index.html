<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing of radio modems LoRa / LoRaWAN RN2483. Part 1, LoRa</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the interesting technologies of the ‚ÄúInternet of Things‚Äù is the LoRa / LoRaWAN network, but they are practically not described in RuNet. It's t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing of radio modems LoRa / LoRaWAN RN2483. Part 1, LoRa</h1><div class="post__text post__text-html js-mediator-article">  One of the interesting technologies of the ‚ÄúInternet of Things‚Äù is the LoRa / LoRaWAN network, but they are practically not described in RuNet.  It's time to fill this gap, and it is even more interesting to try ‚Äúlive‚Äù how it works. <br><br><img src="https://habrastorage.org/files/85a/87d/e17/85a87de17cb54d2b8c5442dd41add3d7.png"><br><br><h4>  What is LoRa? </h4><br>  This is a long range communication technology patented by Semtech and implemented in their SX1272 and SX1276 chips.  LoRa is a low-level protocol over which higher-level protocols can be implemented, for example, LoRaWAN. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A feature of the LoRa standard is the transfer of small data packets with low power consumption.  According to the manufacturer, the range in the open air can reach 10km, and the battery life can be several years.  The operating frequencies depend on the country, and are 433 or 868 MHz (EU version) or 915 MHz (USA version). <br><br>  How it works?  Details under the cut. <a name="habracut"></a><br><br>  The modules RN2483 were chosen for testing.  They are good because they are easy to program and support different modes of operation.  The RN2483 contains the SX1276 chip and a controller in a single package, controlled by UART commands, which allows you to connect it to any device (PC, Arduino, microcontroller, etc).  You can buy a module without strapping, it is cheaper, but soldering was too lazy, so a set of a pair of ready-made boards was ordered on eBay. <br><img src="https://habrastorage.org/files/7d0/d9a/7de/7d0d9a7de3c64c768ca86445ceae764f.jpg"><br>  This allows you to connect modules to your PC via USB, and to any device. <br><br><h4>  Data transfer </h4><br>  A simple Python program was written for transmission: <br><div class="spoiler">  <b class="spoiler_title">Source</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> serial <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sleep <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deviceSend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(device, cmd)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> cmd device.write(cmd + <span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) line = device.readline() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> len(line) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: r = line.decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>).strip() <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"&gt; "</span></span> +r <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: port = serial.Serial(port=<span class="hljs-string"><span class="hljs-string">"COM20"</span></span>, baudrate=<span class="hljs-number"><span class="hljs-number">57600</span></span>, timeout=<span class="hljs-number"><span class="hljs-number">5</span></span>) deviceSend(port, <span class="hljs-string"><span class="hljs-string">"sys reset"</span></span>) sleep(<span class="hljs-number"><span class="hljs-number">2</span></span>) deviceSend(port, <span class="hljs-string"><span class="hljs-string">"mac pause"</span></span>) deviceSend(port, <span class="hljs-string"><span class="hljs-string">"radio set freq 868000000"</span></span>) <span class="hljs-comment"><span class="hljs-comment"># Output power, -3..15 deviceSend(port, "radio set pwr -3") deviceSend(port, "radio set mod lora") # sf12, sf7 deviceSend(port, "radio set sf sf7") # Bandwidth: with 125KHz the sensitivity is better but time on air is longer. Chip is capable from 125KHz to 500KHz. deviceSend(port, "radio set bw 125") deviceSend(port, "radio tx 0123456789") sleep(0.5) line = port.readline() print line.strip() deviceSend(port, "mac resume")</span></span></code> </pre> <br></div></div><br>  Let us analyze the main parameters in more detail. <br>  <b>pwr</b> - power, can vary in the range -3..15dB <br>  <b>frequency</b> - transmission frequency <br>  <b>mac pause</b> - disable lorawan mode, transfer between two devices (p2p) is activated <br>  <b>tx</b> - data packet <br>  <b>mod</b> is a type of modulation.  Available in 2 types, lora or fsk. <br>  <b>bw</b> is the bandwidth of the spectrum, it can be 125, 250, 500 kHz. <br>  <b>sf</b> - spread factor, affects the duration of the transfer. <br>  This is the spectrum for sf7 and sf12 with the same amount of data. <br><img src="https://habrastorage.org/files/c0a/546/e1f/c0a546e1fefc48ec900292ea3bf68ed4.jpg"><br><br>  As you can see, the data is transmitted in short blocks.  The maximum packet size is no more than 255 bytes, after the transmission is completed, the modem confirms that the data has been sent. <br><br><h4>  Receiving data </h4><br>  For reception, you must set the same parameters as for transmission, otherwise the modems will not "hear" each other.  The code is shown below, the program in the infinite loop "listens" to the data on the serial port. <br><br><div class="spoiler">  <b class="spoiler_title">Source</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> serial <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sleep <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deviceSend</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(device, cmd)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> cmd device.write(cmd + <span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>) line = device.readline() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> line <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> len(line) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>: r = line.decode(<span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>).strip() <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"&gt; "</span></span> +r <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> r <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: port = serial.Serial(port=<span class="hljs-string"><span class="hljs-string">"COM20"</span></span>, baudrate=<span class="hljs-number"><span class="hljs-number">57600</span></span>, timeout=<span class="hljs-number"><span class="hljs-number">5</span></span>) deviceSend(port, <span class="hljs-string"><span class="hljs-string">"sys reset"</span></span>) sleep(<span class="hljs-number"><span class="hljs-number">2</span></span>) deviceSend(port, <span class="hljs-string"><span class="hljs-string">"mac pause"</span></span>) deviceSend(port, <span class="hljs-string"><span class="hljs-string">"radio set freq 868000000"</span></span>) <span class="hljs-comment"><span class="hljs-comment"># Output power, -3..15dB deviceSend(port, "radio set pwr -3") deviceSend(port, "radio set mod lora") # sf12, sf7 deviceSend(port, "radio set sf sf7") # Bandwidth: with 125KHz the sensitivity is better but time on air is longer. Chip is capable from 125KHz to 500KHz. deviceSend(port, "radio set bw 125") # WDT: 5s wait for each data deviceSend(port, "radio set wdt 5000") print "Start listening" try: while True: ans = deviceSend(port, "radio rx 0") if ans == "ok": r = port.readline().strip() if r != "err" and len(r) &gt; 0: print "&gt; " + r # We need time to prepare RN2483 for the next receiving sleep(0.1) except KeyboardInterrupt: pass deviceSend(port, "mac resume")</span></span></code> </pre><br></div></div><br>  As you can see, everything is simple, and using a modem is no different from any other transmission over the serial port.  The program code (with minor improvements) was launched on the Raspberry Pi, data reception can be seen on the screen. <br><img src="https://habrastorage.org/files/c44/25a/330/c4425a33015a4780918e722fa605ae5c.png"><br><br>  There are a lot of different commands for setting up the RN2483, they can be found in the PDF "RR2903 LoRa Technology Module Command Reference User's Guide".  For an approximate assessment of the result, you can also download the program <b>Semtech Lora Calculator</b> , which allows you to enter different settings (width of the spectrum, frequency, etc.) and see the result - bit rate, current consumption, battery life. <br><img src="https://habrastorage.org/files/455/f43/1cf/455f431cfc44437d97cbd685be732db4.png"><br>  For example, the promised battery life of the SX1276 chip from a 1000 mAh battery will be about 30 days when transmitted in blocks of 8 bytes with an interval of 100 seconds and a power of 10dBm. <br><br>  For practical testing of the range, one of the modems was left in the apartment by the window, the second was connected to the Raspberry Pi and brought to the street.  Some sources promise a range in urban areas of about 3 km.  The result, alas, is not so good: in practice, at maximum power and an antenna at 868 MHz, the signal is completely muffled after about 3 apartment buildings.  Of course, in open places, the range is higher, but it is worth ‚Äúturning the corner‚Äù as the signal disappears very quickly.  In general, the result of 3 km in the city can probably be obtained unless you place the antenna on the TV tower, you can really count on 300m at best.  But this is not so bad, given the low power of the transmitted signal. <br><br><h4>  Issue price </h4><br>  Information for those who want to repeat the experiments or use LoRa in their developments.  The price of a set of 2x rn2483 modems ready for use on eBay is 80EUR.  Separately, the module with the unsoldered SX1276 can be purchased from sellers from China for $ 12 with free shipping.  The SX1276 chip without any strapping can be bought there for $ 9 (the code described in the article is only suitable for RN2483, when using the SX1276 chip, it will have to be programmed at a lower level). <br><br><h4>  findings </h4><br>  LoRa standard devices are a convenient and complete solution for low-speed transfer of small amounts of data over relatively large (hundreds of meters-kilometers) distances.  LoRa devices are optimized for low power consumption, which allows them to be used with power from batteries or rechargeable batteries (however, the charge for this is a low data transfer rate).  For example, if a farmer wants to display the temperature in greenhouses on a home display, this will be an almost ideal application for LoRa - small amounts of data, long distances, and direct visibility to objects.  Modems can also be used in large rooms - hangars, factories, where it is difficult or expensive to pull the wire to the sensors, and the data volumes are small.  It is possible to use at home, the high sensitivity of the modules will allow the use of even short antennas in the form of a "zigzag" on the printed circuit board.  In the city, the quality of communication will strongly depend on the presence of radio visibility between antennas, the height of antenna placement, etc. Many are now strongly inspired by the capabilities of ‚Äúglobal‚Äù LoraWAN networks, but the issue of antenna placement will be very critical for the range in such a network.  However, this is true for any radio transmission systems, so the miracle did not happen here. <br><br>  The <a href="https://geektimes.ru/post/281312/">next part</a> will cover the connection of RN2483 to the LoRaWAN network. <br><br>  More information can be found on the links: <br>  - RN2483 datasheet <br>  <a href="http://ww1.microchip.com/downloads/en/DeviceDoc/40001784B.pdf">ww1.microchip.com/downloads/en/DeviceDoc/40001784B.pdf</a> <br>  - LoRa FAQ <br>  <a href="http://www.link-labs.com/lora-faqs/">www.link-labs.com/lora-faqs</a> <br>  - Semtech SX1272 <br>  <a href="http://www.semtech.com/wireless-rf/rf-transceivers/sx1272/">www.semtech.com/wireless-rf/rf-transceivers/sx1272</a> <br>  - Semtech LoRa Calculator <br>  <a href="http://www.semtech.com/apps/filedown/down.php%3Ffile%3DSX1272LoRaCalculatorSetup1%25271.zip">www.semtech.com/apps/filedown/down.php?file=SX1272LoRaCalculatorSetup1%271.zip</a> <br><br>  Libraries for working with RN2483 on Raspberry Pi and Arduino can be found on github. </div><p>Source: <a href="https://habr.com/ru/post/398229/">https://habr.com/ru/post/398229/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../398219/index.html">"Avtofon" - a real way to find a stolen car</a></li>
<li><a href="../398221/index.html">"Hubble" saw a star "shooting" plasma balls</a></li>
<li><a href="../398223/index.html">Hawking's paradox</a></li>
<li><a href="../398225/index.html">Five situations in which you want to turn the head</a></li>
<li><a href="../398227/index.html">Nobel Prize in Literature received by American performer Bob Dylan</a></li>
<li><a href="../398233/index.html">Mobile Internet for stationary work</a></li>
<li><a href="../398235/index.html">Ask Ethan # 97: Can moons have moons?</a></li>
<li><a href="../398239/index.html">HyperX on Igromir: Answers to Questions</a></li>
<li><a href="../398241/index.html">Asgardia: the first nation to live in space</a></li>
<li><a href="../398243/index.html">How and why music services form playlists.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>