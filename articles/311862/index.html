<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>100% online airway or How to tame the booking system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Travel between St. Petersburg and Moscow in recent years has turned from an event into a routine task. Someone walks weekly from St. Petersburg to Mos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>100% online airway or How to tame the booking system</h1><div class="post__text post__text-html js-mediator-article">  Travel between St. Petersburg and Moscow in recent years has turned from an event into a routine task.  Someone walks weekly from St. Petersburg to Moscow or vice versa for work, for work.  Someone has a girlfriend, parents, friends ... The flight by plane takes a little over an hour.  Between the two capitals fly more than 40 flights a day. <br><br>  And not only Moscow and St. Petersburg generate constant traffic.  Other economic and cultural centers are emerging.  Over 10 flights a day fly to Kazan.  In Krasnodar - more than 20. <br><br>  Following a change in the behavior of people, such a conservative area as aviation is changing.  Flexible fares, open-air tickets, and now travel tickets. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/fb9/f9d/2f2/fb9f9d2f27cf4640ba295c215cbd7a11.png"><br><br>  Today we will tell how to implement online purchase, design and change of tickets in the framework of airway or multipass.  And they gave active travelers the opportunity to cruise between cities as easily as possible.  If you are interested in the technical aspects of taming booking systems, or you are one of the travelers - our article is for you. <br><a name="habracut"></a><br>  By itself, the airway unit is not new.  In Russia, they began to appear several years ago, and are now operating with a number of airlines.  The scheme of their registration and use was general - issue a travel ticket at the ticket office or leave a request on the website, and select and confirm each flight through a call center. <br><br>  Who today will buy a ticket at the box office?  Who today likes to call the call center?  Online agencies replace ticket offices.  The functionality of the sites replaces call centers. <br>  People want a service that is available at any time, without having to go somewhere or call, simply by pressing a button on a smartphone. <br><br><h1>  1. The pass is a subscription </h1><br>  An airway in our realities is, after all, a subscription.  You buy a fare for a certain number of round trips on the selected route.  It is arranged as a reservation for several flights with an open departure date.  It is valid for a limited time.  But the dates of flights within this period and flights, you can choose any.  And change as many times as you like.  Is free. <br><br>  So it works in Russia. <br><br>  <i>Air alliances and some individual airlines have other schemes.</i>  <i>In short, they are divided into 2 types:</i> <i><br><br></i> <ul><li>  unlimited number of flights around the country or continent for a specific time ( <a href="http://www.skyteam.com/en/flights-and-destinations/travel-passes/">example</a> ) </li><li>  or, in general, space - a lifelong unlimited number of flights ( <a href="https://en.wikipedia.org/wiki/AAirpass">example</a> ) </li></ul><br>  But that's another story.  Let us return to our realities. <br><br><br><h1>  2. Offline offline or As it was before </h1><br><h2>  2.1.  We make out a ticket at the box office </h2><br><ol><li>  Come to the cashier and say you need a travel card.  Report when the first flight. </li><li>  The cashier will select and book the flight. </li><li>  Check out the travel card. </li><li>  Will issue the first ticket. </li><li>  Will take the money for the entire travel card. </li></ol><br>  In principle, everything is simple.  It only takes about 30 minutes ... You will be told out loud the entire schedule for each date for each ticket.  Then make a reservation through GreenScreen - a tool for accessing the booking system, working on text requests.  Then write out a ticket ... <br><br>  But it's flowers!  This is a subscription.  Flights on it relies somewhat.  Here the fun begins. <br><br><h2>  2.2.  We make changes to the flight plan </h2><br>  Enter data on new flights or change the date of those that have already been issued can only super-advanced specialists of the airline.  You can find them in two places: <br><br><ul><li>  in the airline at the airport </li><li>  at the airline call center. </li></ul><br>  The procedure for making changes to the reservation is much more complicated than the design. <br><br><ul><li>  Changing the data of the first flight in some cases can only be done through the cancellation of the old reservation and clearance of a new one. <br><br></li><li>  A change in the date of one of the subsequent flights is processed through the revalidation procedure.  This change of data in the ticket without changing the ticket itself, and only sounds easy. <br><br></li><li>  And, finally, the ‚Äúsweetest‚Äù part.  According to the rules of the booking system, the reservation goes to the archive (becomes inactive, in fact is canceled) 3 days after the passenger made the last scheduled flight.  That is, if you issued a travel card and issued only one ticket, flew through it, and the second did not issue a second within three days, your entire reservation with all unused segments in the system goes to the archive.  Para-para-pa ... <br><br>  Naturally, this task is also solved by introducing a whole pool of correct text queries, but the most painful. </li></ul><br>  This is how the screen of the Green Screen system of an airline specialist looks: <br><br><img src="https://habrastorage.org/files/32f/39a/20b/32f39a20b7b9400f90c340ac50d43cfb.png"><br><br>  The bottom line.  Every time when updating the travel card it is necessary to surrender to the cashier, which is clearly long and inconvenient.  You can improve product performance by making a sale on the site, and only change through a call center.  It will turn out a little faster, but still not 21st century. <br><br><h1>  3. Is it possible to 100% online? </h1><br>  Our decision "Business Pass" is just that.  All operations on the design and payment of travel, the choice of tickets, change of flights are made online through our service. <br><br><h2>  3.1.  Design UI </h2><br>  Began, as expected, with the design of the UI.  The task consisted of the following components (requirements): <br><br>  A) We make a web service for the airline's customers, and it must fully comply with the style of the company's web services.  This is a matter of course. <br><br>  B) If we sell tickets online, we need to create exactly the same user experience as when buying a ticket. <br><br>  <i>The flight selection screen on the airline's website looks like this:</i> <br><img src="https://habrastorage.org/files/773/028/99b/77302899b50c406997bd5b048dfbfd06.png"><br><br>  <i>Flight selection screen within the travel card here:</i> <br><img src="https://habrastorage.org/files/086/f35/d5a/086f35d5ab8241de87972e92b3be6e28.png"><br><br>  C) At the same time, we need the user to understand for sure that this is not a ticket - this is a travel card.  For this, a number of tools are provided: <br><br><ul><li>  On the flight selection form, all flights envisaged by the fare are immediately indicated. </li><li>  On the payment confirmation page, we offer to arrange the following flights if the client is already ready. </li></ul><br>  The same information - a link to the client's office of ‚ÄúBusiness Travel‚Äù is displayed in the email-confirmation of a travel ticket and each new ticket for it. <br><img src="https://habrastorage.org/files/f59/15a/abb/f5915aabb8be427e8af588736b3ec2f0.png"><br><br><ul><li>  And finally, you can simply go to your personal account on the website of ‚ÄúBusiness Travel‚Äù and add a new flight. </li></ul><br><img src="https://habrastorage.org/files/5bc/707/9c1/5bc7079c162746b69fa3ae77ce4e4398.png"><br><br>  D) Mobile version generates 30% of traffic.  Immediately design high-quality display on mobile platforms. <br><img src="https://habrastorage.org/files/e12/af3/6eb/e12af36ebf60474b95372c3455676f48.jpg"><br>  <i>We initially proceeded from the assumption that our client is very mobile.</i>  <i>And we already have real examples of how the client successfully completes the next one 20 minutes before the departure of one of the flights.</i> <br><br><h2>  3.2.  The technical side of the solution </h2><br>  How have we changed the lengthy session of a booking specialist with lightning-fast online operations? <br><br>  Our solution is built on five technologies: <br><br><ul><li>  The server part is Java (API based on the Spring Boot framework).  We implemented most of the logic of working with the reservation system in the business logic of our backend.  All fairly complex operations in SWS for booking, costing and ticketing are performed inside the server part of the application, providing the client with a simplified interface.  All client requests are pretty simple.  For example, on the travel card editing page there is only a ‚ÄúSave‚Äù button, and on the server such operations occur as: booking a request from the booking system, changing route information (in some cases you have to make a new reservation and cancel the current one), revalidate the ticket (through building complex text requests), the formation of a new itinerary receipt in PDF format (more on that later) and sending an information letter to the passenger. <br><br></li><li>  Database - Mongo DB (with versioning support using the Javers library).  We decided to use this NoSQL database, since we did not plan to use any advantages of the relational database.  But due to the fact that both our application and the implementation of the reservation system services are evolving, it is easier and more convenient for us to use the variability of entries in MongoDB.  In addition, we store information about reservations and tickets, as well as the status of payment for each ticket.  And it very well lays down on documents in MongoDB. <br><br>  In order to track changes about tickets, we use the Javers library, which provides the possibility of versioning the entities stored in MongoDB. <br><br></li><li>  Frontend is our own SPA Framework.  We have already written <a href="https://habrahabr.ru/company/eastbanctech/blog/244745/">about him here</a> . <br><br></li><li>  Generate itinerary receipt in PDF format.  Here we have recently used the wkhtmltopdf tool.  Made templates on Freemarker, we enrich these templates with data from the booking system.  As a result, an HTML document is generated, which we then process using wkhtmltopdf. <br><br>  At first we used JasperReports.  But they came to the conclusion that making even small changes to its templates takes a lot of time.  We didn‚Äôt manage to make PDF with exact (pixel perfect) arrangement of elements.  Therefore, we analyzed the current solutions and selected wkhtmltopdf.  Now we can change the receipts quite quickly, since HTML is a rather simple format. <br><br></li><li>  Logging  For such a complex system, it was necessary to implement a logging system, with the help of which it is possible at any moment to understand what happened during the registration of a passport by any user.  For this, we used the slf4j interface with logback implementation (with a logstash upender).  To the log files that are generated by the application, we connected Filebeat, which sends logs to Logstash.  Logstash converts messages, and logs are sent for indexing in Elasticsearch.  After that, we look at them and analyze them in Kibana.  We also use this bundle on several projects, and it helps us very well. </li></ul><br><h3>  3.2.1.  How we won the reservation system </h3><br>  The Gabriel reservation system, which our customer uses, has an SWS (Sita Web Services) web gateway.  Of course, we worked with him. <br><br>  As a result, from the point of view of the mechanics of the reservation system, the key points of our solution look like this: <br><br><ul><li>  Revalidation when changing flight data.  To change the date / time of the flight (and flight number, respectively), you need to make changes to your reservation.  To do this, SitaWS has a special service, and the operation would seem fairly simple, but in some cases you need to create a new reservation, since the current one has already gone to the archive (remember, it falls there as soon as 3 days have passed after all scheduled flights have been completed).  After entering the information in the reservation, it is necessary to update the information in the ticket.  And this has to be done through text commands (emulation of Green Screen). <br><br></li><li>  Change the date of the first flight (change of reservation).  If the passenger wrote himself a pass, specifying only the first flight (the rest of the flight segments remain with an open date), and then wants to change the date, then when changing this flight in the SWS booking, the SWS service deletes the old segment and adds a new segment and for some reason puts the first segment (which we change) the most recent.  And after this operation in armor, first there are segments with an open date, and then our selected segment.  It does not fit the technology.  Therefore, we have to cancel the current reservation and form a new one. <br><br></li><li> Reversibility of the ‚ÄúShatdaun‚Äù reservation <br>  For example, a passenger flies on a specific schedule on the same flight once a week.  He planned everything, wrote out the tickets, but his plans changed and in the third week on Monday he would not be able to fly and wants to fly away on Tuesday.  When trying to change this flight, we need to remove the old segment and add a new one.  When performing this operation, SWS removes all segments with the same number from the reservation.  After this operation, the sequence of flights breaks down and the reservation becomes invalid.  But we learned to bypass this behavior of SWS and after the change - all flights are saved and the sequence of flights is maintained.  Both the reservation and the ticket remain valid. <br></li></ul><br><h3>  3.2.2.  How to fit all the functionality in the SPA </h3><br>  At the moment, the implementation of client-server web applications via API and SPA is, one can say, a trend and a de facto standard.  Therefore, we decided to make an application for ‚ÄúBusiness Travel‚Äù using these technologies.  To implement the SPA, we took our framework, which is based on KnockoutJS / Durandal.  On it, we implemented quite a few solutions, including some very complex ones. <br><br>  There are several entry points for the user, from which he, moving through the stages of the wizard, reaches his goal - the design of the travel card. <br><br><h1>  PS </h1><br><h2>  At the end of the story we want to say this: </h2><br>  We do not dissemble and do not conceal that our framework was not created yesterday.  And in the subtleties of working with the booking system, we have already dived far from the first time.  We rather do not get out of there.  But this project has become another challenge.  We did this with the booking system, which neither we nor the others seem to have done before.  We hope, and it was interesting to you. <br><br>  And, by the way, the release of the project is not the end of the story.  A week and a half ago, a similar solution was issued for season tickets for business class flights ‚Äî the Business Pass.  And in the near future, the API will be released to connect to this service by online travel agencies. <br><br>  Now, knowing how it all works from the inside, we hope you will be interested to see how it all looks and works outside.  Not so often we can give you a poke and try it yourself.  Today is one of the rare days.  <a href="http://multipass.s7.ru/">multipass.s7.ru</a> - come to visit.  Maybe someone needs a travel card? </div><p>Source: <a href="https://habr.com/ru/post/311862/">https://habr.com/ru/post/311862/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311834/index.html">CompTIA certifications for IT professionals. Part 3 of 7. CompTIA Cloud +</a></li>
<li><a href="../311836/index.html">Creating plugins for vSphere using HTML Client SDK Fling</a></li>
<li><a href="../311838/index.html">Buttons in interface design: style evolution and recommendations</a></li>
<li><a href="../311842/index.html">Google fixed Android vulnerabilities</a></li>
<li><a href="../311860/index.html">I am here ... I wrote a track record for time. 628 minutes</a></li>
<li><a href="../311866/index.html">The new program is able to recover information hidden by pixelation.</a></li>
<li><a href="../311870/index.html">Themeforest Alternative for Those Who Want to Sell WordPress Themes</a></li>
<li><a href="../311872/index.html">Warm lamp rake of a small business on the example of a single store in Vladimir</a></li>
<li><a href="../311874/index.html">Strings in the AVR code memory</a></li>
<li><a href="../311876/index.html">I find out dearly by the retina: modern methods of identification by biometric indicators</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>