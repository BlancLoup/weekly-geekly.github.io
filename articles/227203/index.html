<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Migration and Coexistence of Mail Systems</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Periodically, there is the problem of migration from one mail system to another. Due to the fact that often these systems do not have the regular func...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Migration and Coexistence of Mail Systems</h1><div class="post__text post__text-html js-mediator-article">  Periodically, there is the problem of migration from one mail system to another.  Due to the fact that often these systems do not have the regular functionality of coexistence, their sharing may not be the easiest task.  Switching from one system to another might look like this - starting on Friday evening, the system administrator configures servers, reconfigures users' mail clients and transfers user data.  Despite his efforts, Monday can be a very ‚Äúfun‚Äù day: either not all data was transferred, or some old system could not send messages. <br>  I would like to tell you about another way of sharing mail systems, thanks to which you can achieve a smooth migration of users and smooth out possible problems. <br>  For the further description I will use specific mail systems, but I will try to preserve the applicability of this description for other systems.  I‚Äôll use Microsoft Exchange 2013 as my old mail system, and Google Apps for Business will be my new mail system.  Beyond the scope of this article is the process of migration of user data, as it is very dependent on current and future mail systems. <br><br>  I would like to highlight 2 key stages of coexistence.  The main purpose of the first stage is to check whether the functionality of the new mail system suits you.  During the second stage, the main migration of users occurs. <br><a name="habracut"></a><br><h4>  The first stage of coexistence </h4><br>  The main purpose of this stage is to check the capabilities of the new mail system and eliminate all the problems found.  The main users at this stage are system administrators whose mail is automatically delivered to both mail systems. <br>  Such delivery is implemented using an additional domain and message routing rules.  The MX of the main domain, in our case let it be <b>example.com</b> , points to the old mail system.  MX additional domain <b>gtest.example.com</b> points to a Google server.  Instead of an additional domain, you can use the test domain provided by Google, <b>example.com.test-google-a.com</b> , to preserve the versatility of the method, I will use an additional domain. <br><br><h5>  Configure dual delivery </h5><br><h6>  Local Mail Server </h6><br>  On the old mail system, you need to configure forwarding a copy of messages to another domain.  For a small number of users, it‚Äôs easiest to make transport rules with the addition of a hidden recipient (BCC). <br><ol><li>  add transport rule <b>New-TransportRule -Name user -SentTo user@example.com -BlindCopyTo user@gtest.example.com</b> </li></ol><br><h6>  Google apps </h6><br>  To optimize antispam performance on Google servers, you need to specify the old mail server as an incoming mail gateway, since a large number of incoming messages are possible from this server. <br><ol><li>  log in to the google admin console </li><li>  Click <b>Google Apps&gt; Gmail&gt; Advanced Settings.</b> </li><li>  in the Incoming <b>Gateway</b> field, enter the IP address of the incoming gateway server </li></ol><br><h6>  Additional settings </h6><br><ol><li>  you probably use SPF so that mail sent from Google Apps is not considered spam, you need to add <b>include: _spf.google.com</b> , the final entry might look like this <b>v = spf1 include: _spf.google.com + mx ~ all</b> </li><li>  most likely you will need to add an exception to the antispam system so that emails sent from Google Apps are not filtered by the local mail system </li></ol><br><h5>  Description of message flows: </h5><br><h6>  External incoming letters </h6><br>  Messages are delivered via the main MX record to the old mail system.  If you need to deliver a copy of a message to Google Apps, the transport rule adds BCC in the additional domain. <br><img src="https://habrastorage.org/getpro/habr/post_images/01c/a1d/c63/01ca1dc630c48abcac480cfb180c9fd2.png" width="600"><br><h6>  External outgoing letters </h6><br>  Each system can independently send messages to external recipients.  If necessary, Google can use the old mail system as a mail gateway.  This may be necessary if, before sending messages to external recipients, additional mail processing takes place, for example, by the DLP system. <br><img src="https://habrastorage.org/getpro/habr/post_images/bea/7df/24f/bea7df24fdf795fd59c1336c86c7f48b.png" width="600"><br><h6>  Internal emails sent from the old system </h6><br>  Mail is delivered to the recipient in its local mailbox.  If necessary, a copy of the letter is sent to an additional domain. <br><img src="https://habrastorage.org/getpro/habr/post_images/5d5/281/84c/5d528184c7ab477756a7c5a6ce5dc454.png" width="600"><br><h6>  Internal emails sent from Google Apps </h6><br>  Google delivers messages according to MX records.  A message sent from Google Apps will be delivered to the local mail system, and, according to local transport rules, a copy of the letter can be sent to Google Apps. <br><img src="https://habrastorage.org/getpro/habr/post_images/310/ac3/aa0/310ac3aa0a2af2be0cee10760bbc23ba.png" width="600"><br><h5>  Pluses of double delivery </h5><br><ul><li>  Minor changes are made to the current mail system.  You can easily roll back the changes. </li></ul><br><h5>  Cons double delivery </h5><br><ul><li>  Not all things can be checked.  For example, if a new system comes with anti-spam, then it does not participate in this scheme. </li><li>  Emails sent from one system do not appear in sent ones from another system. </li></ul><br><h4>  The second stage of coexistence </h4><br>  It makes sense to move to this stage when most of the problems found have been eliminated and it is understood that the new system fully meets the requirements. <br>  At the second stage of integration, the optimal method of coexistence is separate delivery.  Mail messages are delivered to the system that is essential for a particular user.  The primary domain MX points to Google Apps, which receives all incoming mail.  If the recipient‚Äôs main mail system is an old system, the message is forwarded to the local mail server. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Settings </h5><br><h6>  Local Mail Server </h6><br>  On the local mail system, configuration can be done in several ways. <br><ul><li>  You can use transport rules to forward messages to an additional domain.  You can do this with the following command: <b>New-TransportRule -name user -SentTo user@example.com -RedirectMessageTo user@gtest.example.com.</b> </li><li>  Instead of transport rules, you can use the internal relay domain (Internal Relay).  There is a rather important limitation when using the internal relay domain: the email addresses of the displaced users should not be available in the old system.  To do this, they can be deleted or renamed.  You can change the domain type with the <b>command Set-AcceptedDomain example.com -DomainType InternalRelay.</b> </li></ul><br><br><h6>  Google apps </h6><br>  You need to add a host to forward messages to it. <br><ol><li>  log in to the google admin console </li><li>  click <b>Google Apps&gt; Gmail&gt; Hosts</b> </li><li>  Click <b>Add Route</b> .  The <b>Add route</b> for mail window opens <b>.</b> </li><li>  enter the host name (preferred) or IP address for the route (allowed, but not recommended) </li><li>  click <b>save</b> </li></ol><br>  Configure the routing rule. <br><ol><li>  Click <b>Google Apps&gt; Gmail&gt; Advanced Settings.</b> </li><li>  select <b>Default Routing</b> </li><li>  click <b>Add Parameter</b> </li><li>  Go to the section <b>Specify that the envelope recipients must match</b> </li><li>  in the drop-down list, select <b>All Recipients</b> </li><li>  skip to section <b>If the envelope recipient matches the above expressions</b> , follow these steps: </li><li>  in the drop-down list select <b>Edit Message</b> </li><li>  check the box <b>Change route</b> .  From the drop-down list, select a local mail server (for example, Exchange On-Provise) </li><li>  in the section with parameters, click <b>Perform this operation only with unrecognized addresses</b> </li><li>  click <b>save</b> </li></ol><br><h5>  Message flow description </h5><br><h6>  External incoming letters </h6><br>  All incoming messages are delivered to Google Apps.  If the recipient is in Google Apps, then the message is delivered to his inbox.  If the recipient does not exist, the message is forwarded to the local mail system, which delivers it to the local mailbox. <br><img src="https://habrastorage.org/getpro/habr/post_images/e98/1e9/2b9/e981e92b973420883cb54812162007b0.png" width="600"><br><br><h6>  External outgoing letters </h6><br>  Each system is able to send messages to external recipients independently. <br><img src="https://habrastorage.org/getpro/habr/post_images/d08/9b0/719/d089b07194bd48cf668c66315730b9d9.png" width="600"><br><br><h6>  Internal emails sent from the old system </h6><br>  Messages are delivered to the new mail system if the recipient is not in the local mail system.  If routing rules are used, the message is redirected to another domain. <br><img src="https://habrastorage.org/getpro/habr/post_images/6b3/40d/6b5/6b340d6b5cb82001f57993e7e2c0d5b5.png" width="600"><br><br><h6>  Internal emails sent from Google Apps </h6><br>  There are rules for external incoming messages. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fb0/f7a/316/fb0f7a3169d498d9e0284fb62b73943d.png" width="600"><br><h5>  Pluses of separate delivery: </h5><br><ul><li>  Reduces the load on the old mail system. </li></ul><br><h5>  Cons of separate delivery: </h5><br><ul><li>  Often, mail systems come with additional functionality, the use of which can be difficult.  For example, calendars. </li></ul><br><br>  In this article, I tried to fully and thoroughly address the issue of the coexistence of two mail systems, while not being tied to their closed technologies and features.  I hope it was interesting and useful. <br>  Thanks to those who read the article to the end. </div><p>Source: <a href="https://habr.com/ru/post/227203/">https://habr.com/ru/post/227203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227193/index.html">Creating offline maps for iOS applications</a></li>
<li><a href="../227195/index.html">Reflections on the blues - once again about exception handling</a></li>
<li><a href="../227197/index.html">Porting a Windows 8.1 application to Windows Phone 8.0 with troubleshooting</a></li>
<li><a href="../227199/index.html">Modern aspects of the presentation of texts in the analysis of natural language: classical and alternative approaches</a></li>
<li><a href="../227201/index.html">Own WebGL engine. Article number 1. Canvas</a></li>
<li><a href="../227205/index.html">Autotiling: automatic tile transitions</a></li>
<li><a href="../227209/index.html">The line between the cargo cult and the evolution in learning success</a></li>
<li><a href="../227211/index.html">Increase website conversion: How to use cognitive beliefs</a></li>
<li><a href="../227213/index.html">Dell is preparing for the arrival of ARM processors in servers</a></li>
<li><a href="../227215/index.html">Wi-Fi microSD Adapter: add a Wi-Fi module to the camera</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>