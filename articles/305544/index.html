<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Expansion of functionality Scene View in Unity3D. Interception of events</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Unity3D Scene View is one of the most essential interface elements. Everyone who at least once started Unity3D used Scene View for visual arrangement ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Expansion of functionality Scene View in Unity3D. Interception of events</h1><div class="post__text post__text-html js-mediator-article">  Unity3D Scene View is one of the most essential interface elements.  Everyone who at least once started Unity3D used Scene View for visual arrangement of objects on a scene, and also for their setup.  Extending the functionality of Scene View may be needed to create your own level editor, edit the mesh, create your own gizmos and much more.  It is worth noting that when using Terrain in your project, its editing (drawing textures, changing heights, and planting trees and vegetation) is done using Scene View. <br><br>  In order to be able to write scripts working in the Scene view, first of all the class you are working with must be inherited from Editor or EditorWindow, which implies connecting the namespace UnityEditor.  This gives access to several Unity3D "magic" methods, such as OnGUI () and OnSceneGUI ().  The OnSceneGUI method allows the Editor to manage Scene View events. <br><a name="habracut"></a><br><br>  A small lyrical digression.  Among the developers there is an opinion that the ‚Äúmagic‚Äù methods (Update, Start, OnSceneGUI and others) are implemented by means of System.Reflection in C #, however there is <a href="http://blogs.unity3d.com/ru/2015/12/23/1k-update-calls/">information</a> that this is not so, and it is worthwhile to thank the C ++ core Unity3D for their work.  In general, the <a href="http://blogs.unity3d.com/ru/2015/12/23/1k-update-calls/">article</a> will be useful to all who sin with multiple Update () in their code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's return to the interception of events.  The idea is to designate the object for which we are developing the functionality, as an element of the Unity interface, on par with the Label or Button from IMGUI. <br><br>  In api, there is an <a href="https://docs.unity3d.com/ScriptReference/Event.html">Event</a> class that is used for various GUI events, such as keystrokes, mouse buttons, rendering events, and Unity layout. <br><br>  In addition to the Event to intercept clicks need such a thing as control.  Any element of IMGUI can act as control in Unity.  For example Button or Label.  In order for your object to intercept a click, you need to tell Unity that it is also a control and is going to participate in event handling.  To do this, use the <a href="https://docs.unity3d.com/ScriptReference/GUIUtility.html">GUIUtility</a> class. <br>  Each control must have its own unique id, with which Unity will get all the necessary information about it.  The id is an int, but it's worth noting that it must be unique.  You can generate a random number (other than 0) and consider it the id of your control, but there is no guarantee that the system no longer has a control with the same id, and in this case the click will not go to the element you were counting on.  To create a unique id, use the method from the GUIUtility class. <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> GUIUtility.GetControlID(FocusType focus)</code> </pre> <br>  The parameter received at the input by this method is responsible for the ability of the control to receive any input from the keyboard.  Information about it can be obtained in the <a href="https://docs.unity3d.com/ScriptReference/FocusType.html">documentation</a> .  Since keyboard input is not needed when using Scene View, the FocusType.Passive value will do. <br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> controlId = GUIUtility.GetControlID(FocusType.Passive); <span class="hljs-comment"><span class="hljs-comment">//  id    .</span></span></code> </pre><br>  Now that we‚Äôve figured out how to get an id, it‚Äôs time to figure out how to intercept events.  We can get information about the current event using the Event.current property.  To get the type of event that occurred in Unity, do the following <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> controlId = GUIUtility.GetControlID(FocusType.Passive); Event.current.GetTypeForControl(controlId)</code> </pre><br>  This call will return an <a href="https://docs.unity3d.com/ScriptReference/EventType.html">EventType of</a> type for our control.  Next, you only need to decide exactly what events you need and intercept them.  Directly intercept the event as follows. <br><pre> <code class="cs hljs">GUIUtility.hotControl = controlId;</code> </pre><br>  In the case of a mouse click, you say that your control is ‚Äúhot‚Äù, that is, it will first of all respond to mouse events, and they will not go further to other conltrols. <br>  This aspect is described in detail in the <a href="https://docs.unity3d.com/ScriptReference/GUIUtility-hotControl.html">documentation</a> .  To return access to mouse events to other controls, you need to do <br><pre> <code class="cs hljs">GUIUtility.hotControl = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br>  By this you say that the following mouse events can intercept any other control.  Also, events will be available to other control, if you do not use them.  That is, do not mark as <a href="https://docs.unity3d.com/ScriptReference/Event.Use.html">Used</a> <br><pre> <code class="cs hljs">Event.current.Use();</code> </pre><br>  I will give a complete example of a script that handles clicks on Scene View. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEditor; [CustomEditor(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(MyCustomComponent))] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyCustomEditor</span></span> : <span class="hljs-title"><span class="hljs-title">Editor</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnSceneGUI</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> controlId = GUIUtility.GetControlID(FocusType.Passive); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (Event.current.GetTypeForControl(controlId)) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> EventType.MouseDown: GUIUtility.hotControl = controlId; <span class="hljs-comment"><span class="hljs-comment">//    MouseDown //   if(Event.current.button == 0) { // . . . } //   if(Event.current.button == 1) { // . . . } //  Event.current.Use(); break; case EventType.MouseUp: //  control     GUIUtility.hotControl = 0; Event.current.Use(); break; } }</span></span></code> </pre><br>  Someone may have a question about the need for the material described above.  An example is the creation of an editor for 2d tile levels.  You can write a similar custom editor for the map class, and when intercepting events, obtain mouse coordinates to determine the specific child element that was clicked.  You can determine a specific element by making Raycast, which in Scene View will work exactly the same as in the course of your game. <br><br>  On this, allow me to bow out, I hope that this article will be useful for someone. </div><p>Source: <a href="https://habr.com/ru/post/305544/">https://habr.com/ru/post/305544/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../305528/index.html">Android development using qt and android studio part two</a></li>
<li><a href="../305530/index.html">Linux kernel module on Swift</a></li>
<li><a href="../305532/index.html">Sort warnings of static analyzers by priority when searching for and fixing program errors</a></li>
<li><a href="../305534/index.html">Clojure course materials</a></li>
<li><a href="../305536/index.html">Rust code is included in Firefox 48</a></li>
<li><a href="../305546/index.html">Who is aggregated by Meduza?</a></li>
<li><a href="../305548/index.html">Fighting BEM: 10 major mistakes and how to avoid them</a></li>
<li><a href="../305550/index.html">TP-LINK lost the right to the domain used to configure routers and amplifiers</a></li>
<li><a href="../305556/index.html">9 ways to split your work so as to maintain concentration and productivity</a></li>
<li><a href="../305558/index.html">Vectorization of coordinate transformation code in space on Intel¬Æ Xeon Phi ‚Ñ¢ using low-level instructions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>