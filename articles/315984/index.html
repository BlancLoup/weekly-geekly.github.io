<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we reduced staff over Wi-Fi</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At one warehouse, the work was organized in such a way that employees with PC skills all the time remained in the ‚ÄúHazard‚Äù mode. When shipping orders,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we reduced staff over Wi-Fi</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/03e/77a/f41/03e77af41d0d42fea14a9619054f09c4.jpg" alt="image alt text"></p><br><p>  At one warehouse, the work was organized in such a way that employees with PC skills all the time remained in the ‚ÄúHazard‚Äù mode.  When shipping orders, a crowd of pickers stood in line for checking and scanning barcodes.  Naturally, the breakdown of one of the two operator computers turned the whole process into continuous torment for the operators themselves and joy for the rest (oh, you can drink some tea!). </p><br><p>  <strong>In the article I will tell you how we spoiled the rest of people with the help of seamless Wi-Fi.</strong> <a name="habracut"></a></p><br><p>  To unload the operators, they installed several stationary terminals, which even non-magical 1C employees can handle.  But the warehouse was still regularly visited by auditors with wireless data collection terminals.  Their trouble was that they had to catch a wireless network only in one warehouse corner ... yes, exactly where the people were already in abundance.  In general, we decided at the same time to entangle the entire warehouse with networks of seamless Wi-Fi.  This part of the project turned out to be curious. </p><br><h1 id="kotiki-mikrotiki">  Seals-Mikrotiki </h1><br><p>  As you know, minimalism is in fashion now.  Including wired, so the equipment was looked for with PoE (Power Over Ethernet) support. </p><br><p>  To cover the entire warehouse with a wireless network, we needed: </p><br><ul><li><p>  Access points that can work with a controlling controller and PoE-in; </p><br></li><li><p>  Controller for controlling access points; </p><br></li><li>  Switch with PoE-out support. </li></ul><br><p>  Decisions by Cisco, Zyxel and D-link did not fit into the budget, so Ubiquity UniFi and MikroTik remained. </p><br><p>  The Unifi family with software controllers was well remembered from past projects with its unstable connection when customers move between points.  In addition, local administrators found <a href="https://routerboard.com/RB951Ui-2HnD">MikroTik RB951Ui-2HnD</a> , who lost two ports after a lightning strike.  Well, this is clearly fate, so the ‚Äúinvalid‚Äù was decided to be given a new life as a Wi-Fi controller. </p><br><p>  As an access point, they originally planned for <a href="https://routerboard.com/RBmAPL-2nD">MikroTik mAP lite</a> , which were bought with the cost and support of working with a Wi-Fi controller - Controlled Access Point system Manager (CAPsMAN) in the terminology of MikroTik.  True, the inconvenient magnetic mounting on the wall was embarrassing, the counterpart of which was mounted on an unreliable adhesive tape.  As a result, we bought a <strong>MikroTik mAP 2nD</strong> without any magnets, because of which the mAP lite has <a href="http://forum.mikrotik.com/viewtopic.php%3Ft%3D104540">problems with the network when turned on</a> . </p><br><p>  Ordered a total of 9 points and switch <a href="http://www.dlink.ru/ru/products/1/1965.html">D-link DES-1018MP</a> with PoE support.  This set was enough for a confident reception throughout the warehouse. </p><br><p><img src="https://habrastorage.org/files/185/e00/598/185e005984fb4a09acbbf66e59a0c402.jpg" alt="image alt text"></p><br><p>  In addition to its intended use, a <a href="https://geektimes.ru/post/243173/">network tester</a> can be made from such a point.  Also included were micro-usb OTG cables, which instantly diverged across the IT department. </p><br><h1 id="vtoraya-chast-kvesta">  Second part of the quest </h1><br><p>  Let me remind you that the main problem of the warehouse was the incorrect organization of operator workplaces.  Therefore, it was necessary not only to increase their number, but also to optimize the warehouse staff who were not experienced in computers.  We decided to install touch-screen terminals and a barcode scanner.  With the most simplified interface 1C and the absence of a standard Windows shell, it came out pretty clearly. </p><br><p>  Thin clients, all-in-one PCs and even Raspberry Pi under Linux were considered as workstations.  But with Linux, local specialists were not doing so well, so they nevertheless returned to Windows.  In the end, there are fewer problems with hardware compatibility. </p><br><p>  By the way, instead of a monoblock with a wall mount, there was an INTEL Compute Stick the size of a palm - a suitable model is released as the Lenovo <a href="https://geektimes.ru/company/lenovo/blog/271832/">IdeaCentre Stick 300</a> : </p><br><ul><li><p>  32 GB of disk space; </p><br></li><li><p>  2 GB of RAM; </p><br></li><li><p>  Windows 8.1 with Bing; </p><br></li><li>  Issue price - less than 6 000 ‚ÇΩ. </li></ul><br><p>  It looks like a solution to all problems.  Of course, there was some distrust of the ‚Äúflash drive with Windows‚Äù format itself - especially overheating the prospects for overheating and the question of speed.  But the trial "flash drive" withstood all the checks without any problems, so they gave up and bought the rest. </p><br><p><img src="https://habrastorage.org/files/c7f/a67/534/c7fa675348344f6288c3a77da0024fda.jpg" alt="image alt text"></p><br><p>  The terminal still needed a wireless scanner, the base of which would work via USB with COM emulation - the request of the customer. </p><br><p>  It turned out this set: </p><br><table><tbody><tr><td>  Name </td><td>  Model </td><td>  amount </td><td>  Price, pcs </td></tr><tr><td>  Access point </td><td>  MikroTik mAP 2nD </td><td>  9 </td><td>  2 800 ‚ÇΩ </td></tr><tr><td>  Computer </td><td>  Lenovo IdeaCentre Stick 300 </td><td>  9 </td><td>  5 900 ‚ÇΩ </td></tr><tr><td>  Monitor </td><td>  Viewsonic TD2220-2 </td><td>  9 </td><td>  $ 17,000 </td></tr><tr><td>  Adapter </td><td>  HDMI BURO DVI-D (m) - HDMI19 (f) </td><td>  9 </td><td>  590 ‚ÇΩ </td></tr><tr><td>  SK scanner </td><td>  Honeywell 1202g </td><td>  9 </td><td>  21 150 ‚ÇΩ </td></tr><tr><td>  Switch </td><td>  D-link DES-1018MP </td><td>  one </td><td>  15 700 ‚ÇΩ </td></tr><tr><td>  Total </td><td></td><td></td><td>  442 660 ‚ÇΩ </td></tr></tbody></table><br><p>  <em>Prices are for summer 2016</em> </p><br><p>  It is noteworthy that the Wi-Fi network itself cost less than 50 000 ‚ÇΩ, even with the controller. </p><br><h1 id="chast-tretya-v-kotoroy-poyavlyaetsya-gik-porno">  Part three, in which there is a geek porn </h1><br><p>  There is already <a href="https://habrahabr.ru/post/217657/">enough material</a> about setting up CAPsMAN on MikroTik, so I‚Äôll tell you more about the nuances. </p><br><p>  The network did a thing in itself, without unnecessary intersections with the office.  The use of VLAN had to be abandoned, since the network equipment was already overloaded.  On the Wi-Fi controller, they lifted NAT with a firewall, behind which they placed access points with clients. </p><br><p>  In the process of testing the solution revealed several problems: </p><br><ul><li><p>  If the points and clients were in the same network segment, then when the client connected, the controller cursed the appearance of a loop and disconnected it.  The problem could be circumvented by segmentation of the network or by the explicit inclusion of an access point in the bridge on the controller.  I chose the first option as the most simple: </p><br><pre><code class="bash hljs">/interface bridge add name=bridge-wifi /caps-man configuration <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> [find comment=<span class="hljs-string"><span class="hljs-string">"warehouse"</span></span>] datapath.bridge=bridge-wifi <span class="hljs-comment"><span class="hljs-comment">#   DHCP  bridge-wifi</span></span></code> </pre> <br></li><li>  If the access point does not explicitly indicate the IP address of the controller, then when three or more points were connected to the network, only one was registered.  It was decided by specifying the controller's address in the CAP settings: <br><pre> <code class="bash hljs">/interface wireless <span class="hljs-built_in"><span class="hljs-built_in">cap</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> caps-man-addresses=_ discovery-interfaces=bridge-local \ enabled=yes interfaces=wlan2</code> </pre> </li><li>  The resolution of the names of office servers worked incorrectly and, as a result, the 1C database did not start.  We configured to issue the correct DNS suffix by DHCP on MikroTik: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  15.  -   HEX . /ip dhcp-server option add code=15 name=dns value=0x57687920616c6c207468697320736869743f #   DHCP-  . /ip dhcp-server network set [find comment="wi-fi client dhcp"] dhcp-option=dns</span></span></code> </pre> </li></ul><br><p><img src="https://habrastorage.org/files/1f7/9f1/6c3/1f79f16c3d424e89aabd57c91728fb64.jpg" alt="image alt text"></p><br><p>  <em>Scheme of the resulting network with two bridges</em> </p><br><h1 id="interfeys-kotoryy-ne-dast-vystrelit-v-nogu">  The interface that will not let you shoot in the foot </h1><br><p>  New users are not very friendly with computers, so the extra ‚Äútemptations‚Äù needed to be removed.  The system has a new user account with limited rights and automatic login.  In addition, when loading the shell, <strong>explorer.exe was</strong> changed to the 1C startup script. </p><br><div class="spoiler">  <b class="spoiler_title">Memo for replacing the shell</b> <div class="spoiler_text"><p>  You just need to create a string parameter in the registry with the name "Shell" in the <strong>HKEY_CURRENT_USER \ Software \ Microsoft \ Windows NT \ CurrentVersion \ Winlogon</strong> branch, and in its value set the launch path for the alternative shell.  To run the VBS script, it looked like this: </p><br><p>  cscript.exe "Path to script" </p></div></div><br><p>  In order not to change the script for each computer, I called users in 1C in the same way as computer names. </p><br><p>  I provide a script with comments to your judgment: </p><br><pre> <code class="vbscript hljs">strComputer = <span class="hljs-string"><span class="hljs-string">"."</span></span> strServer=<span class="hljs-string"><span class="hljs-string">"  1"</span></span> strBase=<span class="hljs-string"><span class="hljs-string">"  1"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> objShell = <span class="hljs-built_in"><span class="hljs-built_in">CreateObject</span></span>(<span class="hljs-string"><span class="hljs-string">"Wscript.Shell"</span></span>) <span class="hljs-comment"><span class="hljs-comment">'      strUsername= objShell.ExpandEnvironmentStrings("%computername%") '      ,     . For iCounter = 1 to 5 If Ping(StrServer) then Exit For end If WScript.Sleep 1000 Next If iCounter =5 Then MsgBox ("  ,   IT-") objShell.Run("shutdown -s -t 0") else '  1 objShell.Run("""C:\Program Files\1cv8\common\1cestart.exe"" enterprise /s"+strServer+"\"+strBase+" /N"""+strUsername+"""") Set objWMIService = GetObject("winmgmts:" &amp; "{impersonationLevel=impersonate}!\\" &amp; strComputer &amp; "\root\cimv2") Set colProcesses = objWMIService.ExecQuery ("Select * from Win32_Process Where Name = '1cv8.exe'") '     1 Do While colProcesses.Count = 0 Set colProcesses = objWMIService.ExecQuery ("Select * from Win32_Process Where Name = '1cv8.exe'") WScript.Sleep 1000 Loop '    1 Do While colProcesses.Count &gt; 0 Set colProcesses = objWMIService.ExecQuery ("Select * from Win32_Process Where Name = '1cv8.exe'") WScript.Sleep 1000 Loop objShell.Run("shutdown -s -t 0") end if Function Ping( myHostName ) Dim colPingResults, objPingResult, strQuery strQuery = "SELECT * FROM Win32_PingStatus WHERE Address = '" &amp; myHostName &amp; "'" Set colPingResults = GetObject("winmgmts://./root/cimv2").ExecQuery( strQuery ) For Each objPingResult In colPingResults If Not IsObject( objPingResult ) Then Ping = False ElseIf objPingResult.StatusCode = 0 Then Ping = True Else Ping = False End If Next Set colPingResults = Nothing End Function</span></span></code> </pre> <br><p>  After some time, the terminals were added Bluetooth-speakers through which a pleasant female voice reports errors in the work with the help of Windows Speech. </p><br><h1 id="a-teper-pro-obeschannye-uvolneniya">  And now about the promised dismissals </h1><br><p>  The customer conducted testing of roaming as follows: an IT employee from a softphone on a mobile called me and walked through the warehouse.  There were no communication breaks and "stuttering" - access points regularly passed the smartphone to each other. </p><br><p>  Later I was told that after the introduction of the new system, the warehouse workers staged a real sabotage, with exclamations ‚ÄúIt‚Äôs impossible to work that way!‚Äù  and demonstrative work in the old fashioned way.  Apparently, they realized that they would have to work instead of discussing fishing in lines and for tea.  But the big boss came and adjusted everything with the magic power of persuasion. </p><br><p><img src="https://habrastorage.org/files/867/f4d/389/867f4d389e4343d8af1cee7b0c3fedd2.jpg" alt="image alt text"></p><br><p>  <em>Uh, crib, help!</em>  <em>Vaivai Postavil, Baitik Begaet, Adinas Counting, Worker Beshelme Meshelme Nehochat</em> </p><br><p>  Our optimization for humans had a side effect.  It turned out that such a mob in the warehouse is not needed - in the wake of the crisis in the country, this prompted the authorities to the idea of ‚Äã‚Äãreducing staff.  Now depict the stormy activities in the warehouse is not easy. </p><br><p>  <strong>Has it ever happened to you that the use for the benefit of people turned out to be troubles for them?</strong> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/315984/">https://habr.com/ru/post/315984/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../315972/index.html">Protection of virtual machines located in the data center</a></li>
<li><a href="../315974/index.html">A person. Guido Van Rossum - Python Creator</a></li>
<li><a href="../315976/index.html">The train coming late: Announcement of the JPoint 2017 Java Conference</a></li>
<li><a href="../315978/index.html">As I wrote the visualization system for the stand</a></li>
<li><a href="../315982/index.html">Information on the threshold of immortality</a></li>
<li><a href="../315986/index.html">What should not wait for developers in Russia?</a></li>
<li><a href="../315990/index.html">Nothing extra. Best of Theory of Constraints</a></li>
<li><a href="../315992/index.html">Salaries of IT-specialists in Russia for the last six months, May-October 2016</a></li>
<li><a href="../315994/index.html">Comparison of technological approaches to solving data extraction problems</a></li>
<li><a href="../315998/index.html">Immigration to Bulgaria</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>