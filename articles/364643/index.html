<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to send flash-SMS?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Flash-SMS is such an SMS, the text of which is immediately displayed on the user's phone / smartphone screen instead of being written to the device‚Äôs ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to send flash-SMS?</h1><div class="post__text post__text-html js-mediator-article">  Flash-SMS is such an SMS, the text of which is immediately displayed on the user's phone / smartphone screen instead of being written to the device‚Äôs memory.  The user reads it and decides whether to keep it in memory or not. <br><a name="habracut"></a><br>  To send flash-SMS you will need to use the so-called PDU mode - Packet Data Unit.  This is a mode that allows you to control all the secret SMS parameters described in the ETSI GSM Technical Specification GSM 03.40. <br>  To access the PDU, it is recommended to use any GSM modem or module.  Some old phones in modem mode also knew how, but I can‚Äôt say anything about modern smartphones, because I don‚Äôt know. <br>  I used the <a href="http://wless.ru/technology/%3Faction%3Ddetails%26id%3D522%26pf%3Dtech%26pf_id%3D2%26prod%3D35%26tech%3D2%26type%3D34">Neoway M660 GSM module</a> , but for modems / modules from other manufacturers this should also be true. <br><br><img src="https://habrastorage.org/files/392/d23/2cd/392d232cd232446396449aa1ec9b19b3.jpg"><br><br>  In PDU mode, an SMS message is a set of data sent to the modem in the form of ASCII characters. <br>  Let's consider the format of the transmitted SMS message, the sequence of commands sent to the GSM modem, and also create a PDU package and send a flash-SMS ‚ÄúHello, Habr!‚Äù To the hypothetical number +70123456789. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  The format of the transmitted SMS-message in PDU mode </h2><br><br>  depicted in the picture: <br><img src="https://habrastorage.org/files/28a/666/e28/28a666e2897f4c00832a684feaec92ad.JPG"><br><table><tbody><tr><th>  PDU field name </th><th>  Length, byte </th><th>  Short description </th></tr><tr><td>  SCA, Service Center Address </td><td>  1-12 </td><td>  SMS Center phone number (may not be indicated) </td></tr><tr><td>  PDU Type </td><td></td><td>  PDU type </td></tr><tr><td>  MR, Message Reference </td><td>  one </td><td>  The sequence number of the message set by the modem / module </td></tr><tr><td>  DA, Destination Address </td><td>  2-12 </td><td>  Telephone number of the message recipient </td></tr><tr><td>  PID, Protocol Identifier </td><td>  one </td><td>  Protocol identifier </td></tr><tr><td>  DCS, Data Coding Scheme </td><td>  one </td><td>  Message Encoding </td></tr><tr><td>  VP, Validity Period </td><td>  0.1 or 7 </td><td>  SMS lifetime </td></tr><tr><td>  UDL, User Data Length </td><td>  one </td><td>  User Data field length in bytes </td></tr><tr><td>  UD, User Data </td><td>  0-140 </td><td>  Message </td></tr></tbody></table><br>  So, consider the purpose of the individual fields of the PDU packet of the transmitted message. <br><br>  1. SCA (Service Center Address) - the phone number of the SMS Center (SMSC). <br>  This field is optional, as the SMSC number is stored on the SIM card and is automatically read by the Neoway GSM modules.  We will use this opportunity and will not specify the SMS Center number in our example, especially since in this case the contents of the PDU do not depend on the SIM card used.  If the SMSC number is not specified in the PDU, the SCA field is 0x00. <br>  But if you still want to read the SMS Center number from the GSM module, can you always do this using the AT + CSCA command? .. <br><br>  2. PDU Type - PDU Type <br><br><img src="https://habrastorage.org/files/7cc/81a/c18/7cc81ac1820d429790e5fa90e7f28bb9.JPG"><br><br>  2.1 RP (Reply Path) <br>  0 - no response path defined, <br>  1 - the path for the answer is determined, the same SMS Center (SMSC) is used. <br><br>  2.2 UDHI (User Data Header Included): <br>  0 - the UD field contains only the message itself, <br>  1- UD field contains a message and an additional header. <br><br>  2.3 SRR (Status Report Request): <br>  0 - the status of the message is not requested, <br>  1 status of the message is requested. <br><br>  2.4 VPF (Validity Period Format): <br>  00 - VP field is absent, <br>  01 - reserved, <br>  10 - the VP field contains temporal data in a relative format, <br>  11 - the VP field contains time data in absolute format. <br><br>  2.5 RD (Reject Duplicates): <br>  0 - The SMSC should be forwarded to the recipient if it has the same MR and DA field values ‚Äã‚Äãas the previous message. <br>  1 - The SMSC should reject the message if it has the same MR and DA field values ‚Äã‚Äãas the previous message. <br><br>  2.6 MTI (Message Type Indicator): <br>  00 - received message (from SMSC to module) or acknowledgment (from module to SMSC) <br>  01 - message to be sent (from the module to the SMSC) or confirmation of sending (from the SMSC to the module), <br>  10 - delivery report (from SMSC to module) or SMS command (from module to SMSC) <br>  11 is reserved. <br><br>  In order to simplify the VP field (SMS lifetime, see clause 7), we will not use it and set the VPF bits to zero.  Also set the RP, UDHI, SRR, RD bits to zero.  The MTI bits of the sent message must be set to 01. Thus, the byte value of the PDU Type field is taken equal to 0x01. <br><br>  3. MR (Message Reference) - the sequence number of the message, determined by the module itself.  In a PDU, the field value is set to 0x00. <br><br>  4. DA (Destination Address) - the phone number of the recipient of the message. <br>  The field DA consists of three parts and has the following form: <br><table><tbody><tr><th>  The number of digits in the recipient's number </th><th>  Recipient Number Type </th><th>  Recipient's number </th></tr><tr><td>  1 byte </td><td>  1 byte </td><td>  0 ... 6 bytes </td></tr></tbody></table><br>  4.1 The number of digits in the recipient's number is calculated without taking into account the ‚Äú+‚Äù sign and is presented in hexadecimal format. <br>  For example, for the number +70123456789, the byte value ‚ÄúThe number of digits in the recipient's number‚Äù is 0x0B (11 in decimal). <br><br>  4.2 Type of recipient number. <br>  In the case of the international format of the byte number, ‚ÄúType of the recipient's number‚Äù is set to 0x91, in the case of the local format - 0x81. <br><br>  4.3 Recipient number. <br>  The field "Number of the recipient" is formed as follows: <br>  a) in the case of an international number format, the ‚Äú+‚Äù sign is discarded; <br>  b) if the number of digits in the number is odd, ‚ÄúF‚Äù is added at the end; <br>  c) numbers in pairs are rearranged in places. <br><br>  For example, for the number +70123456789, the field ‚ÄúNumber of the recipient‚Äù will look like: 0721436587F9, and the entire field DA - 0B910721436587F9. <br><br>  5. PID (Protocol Identifier) ‚Äã‚Äã- protocol identifier. <br>  In our case, the value of the PID field must be set to 0x00. <br>  More details about the features of this field can be found in ETSI GSM 03.40, clause 9.2.3.9. <br><br>  6. DCS (Data Coding Scheme) - message encoding. <br>  This is the field that interests us the most now!  To send messages with Cyrillic characters, you must use UCS2 encoding. <br>  The value of the DCS field in our case should be set to 0x18 - this is the secret combination that allows you to send flash-SMS in Cyrillic characters (0x08 is a normal SMS). <br><br>  7. VP (Validity Period) - the lifetime of the message. <br><br>  Message Lifetime - the time after which the message is destroyed (erased from the SMS Center memory) if it was not delivered to the addressee. <br>  This field is associated with the VPF bits of the PDU Type field; there are three options for sharing them. <br><br>  7.1 The VP field is not used (remember, we agreed that we will not use it in our example?). <br>  In this case, the length of the VP field is 0 bytes, the VPF bits must be set to 00 (as we have already done). <br><br>  7.2 The VP field contains data about the lifetime in relative format. <br>  In this case, the VP field length is 1 byte, the VPF bits must be set to 10 (in binary). <br>  Possible values ‚Äã‚Äãof the VP field in the case of using the relative time format and formulas for calculating the corresponding message lifetime are given in the following table: <br><table><tbody><tr><th>  VP value hexadecimal </th><th>  VP value decimal </th><th>  VP time value </th><th>  Maximum lifetime </th></tr><tr><td>  1..8F </td><td>  0 ... 143 </td><td>  (VP + 1) * 5 minutes </td><td>  12 hours </td></tr><tr><td>  90..A7 </td><td>  144 ... 167 </td><td>  12 hours + (VP - 143) * 30 minutes </td><td>  24 hours </td></tr><tr><td>  A8..C4 </td><td>  168 ... 196 </td><td>  (VP - 166) * 1 day </td><td>  30 days </td></tr><tr><td>  C5..FF </td><td>  197 ... 255 </td><td>  (VP - 192) * 1 week </td><td>  63 weeks </td></tr></tbody></table><br>  7.3 The VP field contains data on the lifetime in absolute format. <br>  In this case, the length of the VP field is 7 bytes, the VPF bits must be set to 11 (in binary). <br>  The assignment of the bytes in the VP field using the absolute time format is given in this table: <br><table><tbody><tr><th>  1st byte </th><th>  2nd byte </th><th>  3rd byte </th><th>  4th byte </th><th>  5th byte </th><th>  6th byte </th><th>  7th byte </th></tr><tr><td>  Year </td><td>  Month </td><td>  Day </td><td>  Hour </td><td>  Minutes </td><td>  Seconds </td><td>  Timezone </td></tr></tbody></table><br>  In addition, each byte contains two decimal numbers swapped by places.  For example, byte 2 in the case of the month of May will be 0x50. <br>  The year is represented by the last two digits. <br>  The time zone indicates the difference between local time and Greenwich Mean Time (GMT), expressed in quarters of an hour.  The first bit indicates the sign of this difference: 0 - the difference is positive, 1 - the difference is negative.  That is, byte 7 in the case of GMT + 3 time zone will be 0x21. <br><br>  Since we decided not to use the VP field and set two VPF bits of the PDU Type field to 00, the VP field of our example will not be present in the PDU packet of our example. <br><br>  8. UDL (User Data Length) - the length of the UD field in bytes. <br>  In the case of using the UCS2 encoding of interest to us, the value of the UDL field can be calculated by multiplying the number of characters in the transmitted message by 2 (each character is encoded with two bytes).  For the ‚ÄúHello, Habr!‚Äù Message, the UDL field is 0x1A (26 in decimal). <br><br>  9. UD (User Data) - message <br>  To send a message in Cyrillic, you must use UCS2 encoding; in this encoding, each letter or character is encoded in two bytes. <br>  <a href="http://msdn.microsoft.com/en-us/goglobal/cc305171">Encoding table UCS2 - here</a> <br>  The message ‚ÄúHello, Habr!‚Äù In UCS2 encoding will look like this: <br>  W: 041F <br>  p: 0440 <br>  and: 0438 <br>  in: 0432 <br>  e: 0435 <br>  t: 0442 <br>  : 002C <br>  : 0020 <br>  X: 0425 <br>  A: 0430 <br>  b: 0431 <br>  p: 0440 <br>  !: 0021 <br><br>  Hi, Habr !: 041F04400438043204350442002C002004250430043104400021 <br><br><h2>  SMS sending process </h2><br>  Once the PDU package is complete, the process of sending an SMS is easy and consists of two simple steps: <br><br>  1. Enter the command to send SMS with the number of bytes in the PDU packet with the exception of the SCA field.  It does not sound very friendly, but if the SMS Center number is not used, then the SCA field is 0x00 (as we have) and this number is equal to the number of bytes in the PDU packet minus one.  For "Hi, Habr!" This value is 39: <br><br>  <i>AT + CMGS = 39</i> <br><br>  It is important that this command is terminated by the character '\ r' (0x0D), without additives. <br>  After that, the GSM modem prompts the '&gt;' to enter the PDU packet data. <br><br>  2. Enter PDU package data. <br>  In the case of the message ‚ÄúHi, Habr!‚Äù, The PDU packet looks like this: <br>  0001000B9100181A041F04400438043204350442002C002004250430043104400021 (in text form), <br><br>  where  is the recipient's number field, in which the numbers are interchanged and the ‚ÄúF‚Äù symbol is added at the end in the case of an odd number of digits in the number (as described earlier). <br>  For the number +79123456789, the field of the recipient‚Äôs number will be: 9721436587F9, <br>  and the whole PDU packet with the message ‚ÄúHello, Habr!‚Äù, sent to this number: <br>  <i>0001000B919721436587F900181A041F04400438043204350442002C002004250430043104400021</i> <br><br>  PDU packet data entry must end with byte 0x1A <br><br>  In case of successful sending of SMS, the modem will respond: <br><br>  <i>+ CMGS: Message_Reference</i> <i><br></i>  <i>Ok</i> <br><br>  where <i>Message_Reference</i> is the message sequence number set by the modem (see the description of the MR packet field of the PDU). </div><p>Source: <a href="https://habr.com/ru/post/364643/">https://habr.com/ru/post/364643/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../364633/index.html">AvtoStart - Powerbank for car with the ability to charge gadgets</a></li>
<li><a href="../364635/index.html">New Year Gift Guide 2014: Microsoft Lumia Blog Version (continued)</a></li>
<li><a href="../364637/index.html">Tech dependency photo won National Geographic competition</a></li>
<li><a href="../364639/index.html">Paulo Coelho wants to redeem the rights to The Interview and distribute it to everyone for free</a></li>
<li><a href="../364641/index.html">It's time to renew your certificate on Habrastorage.org!</a></li>
<li><a href="../364645/index.html">How to import CRM and project management system for small businesses</a></li>
<li><a href="../364647/index.html">14 promising startups in 2015 according to Business Insider</a></li>
<li><a href="../364649/index.html">Unmanned vehicles will require qualitatively different cards</a></li>
<li><a href="../364651/index.html">Crowd mapping open-source solution: Nextgis Crowd</a></li>
<li><a href="../364655/index.html">A set to create a personal microsatellite can be purchased now.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>