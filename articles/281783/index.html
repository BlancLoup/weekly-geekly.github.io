<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unity and MVC: how to pump game development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From translator 
 Hi, Habr! 

 I‚Äôm not a real welder and the translation of the article was hard for me, so I‚Äôll call it free - I‚Äôll clear my conscien...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unity and MVC: how to pump game development</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <b>From translator</b> <br>  Hi, Habr! <br><br>  I‚Äôm not a real welder and the translation of the article was hard for me, so I‚Äôll call it free - I‚Äôll clear my conscience beforehand, if I rephrase the original somewhere too much.  I would be happy to point out mistakes in translation, grammar, etc.  in lichku. <br><br>  I publish the translation with the permission of the <a href="https://www.toptal.com/">Toptal</a> site, where the original author Eduardo Dias da Costa is posted. </blockquote><br><p>  Usually programmers are introduced to the profession, starting with Hello World.  Then they set more and more goals, and each new task leads to an important lesson: the larger the project, the more confusing the code. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/16a/c2d/48c/16ac2d48cb4b96a1ba90fa58f26dc627.jpg" alt="image"><br><p>  And in large and small teams, no one kodit as he pleases.  The code must be supported and extensible.  After all, the company in which you worked does not appeal to you whenever you need to fix a bug or improve the code.  Yes, and you hardly want it. </p><br><p>  Therefore, there are design patterns;  they are collections of rules for standardized project structuring, which help to divide and organize a large code base, and simplify work with unfamiliar code. <a name="habracut"></a></p><br><img src="https://habrastorage.org/getpro/habr/post_images/d68/6ea/b49/d686eab49ffdaecc83dfcb59cdccd235.jpg" alt="image"><br><p>  These rules, when followed by all project developers, facilitate support, navigating through the old code and writing a new one.  Less time is spent on planning a design approach.  But since the problems sometimes differ, the patterns are not a silver bullet.  It is necessary to carefully consider the strengths and weaknesses of each before choosing the right one for a particular situation </p><br><p>  In this tutorial I will talk about my experience with the popular Unity3D game engine and using the Model-View-Controller (MVC) template.  For seven years of work and struggle with spaghetti code in game projects, I have achieved an excellent code structure and speed of development when using it. </p><br><p>  I‚Äôll start by explaining the basic Unity architecture: the Entity Component (EC) template, and then tell you how MVC is built on top of it.  And I will give an example of a small project layout. </p><br><h1>  Motivation </h1><br><p>  To adapt existing design patterns for a specific task, programmers have to change them.  This freedom in programming is proof that we have not found the only true software architecture.  This article is also not meant as a solution to all problems.  It shows the capabilities of two well-known design patterns: EC and MVC. </p><br><h1>  Template Entity-Component </h1><br><p> Entity-Component (EC) is a design pattern, where the hierarchy of the elements of which the application consists (Entities) is first determined, and then the logic and data for each of them (Components) are specified.  In "programmer" terms, an Entity may be an object with an array of zero or more Components.  We describe it like this: <code>some-entity [component0, component1, ...]</code> </p><br><p>  An example of a simple EC tree: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Application]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">game</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[Game]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">player</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[KeyboardInput, Renderer]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">enemies</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">spider</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[SpiderAI, Renderer]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ogre</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[OgreAI, Renderer]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ui</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[UI]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">hud</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[HUD, MouseInput, Renderer]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pause-menu</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[PauseMenu, MouseInput, Renderer]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">victory-modal</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[VictoryModal, MouseInput, Renderer]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">defeat-modal</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[DefeatModal, MouseInput, Renderer]</span></span></code> </pre> <br><p>  EC is a good template for leveling multiple inheritance problems, when an intricate class structure can create problems like <a href="https://en.wikipedia.org/wiki/Multiple_inheritance">the diamond problem</a> : class D inherited from B and C with general class A may contain conflicts due to different redefinitions of capabilities A by classes B and C. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/5d0/7a9/237/5d07a92372bd4418a3de681b1a705613.jpg" alt="image"><br><p>  Similar problems often occur with the active use of inheritance. </p><br><p>  If you break tasks and data handlers into small Components, they can attach (attach) to Entities and reuse without multiple inheritance, which is not found in C # and JavaScript, the main Unity programming language. </p><br><h3>  Where Entity-Component does not meet expectations </h3><br><p>  Being a higher level of <acronym>OOP</acronym> , EC helps to defragment and better organize the architecture of the code.  However, in large projects we remain ‚Äútoo free‚Äù and in the ‚Äúocean of possibilities‚Äù it is difficult for us to isolate the Entities and Components correctly and organize their interaction.  There are an infinite number of options for building Entities and Components. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/bdd/69d/89a/bdd69d89a2d84e5e1b11332603803662.jpg" alt="image"><br><p>  One way to avoid the mess is to follow additional principles on top of EC.  I divide the program into three categories: </p><br><ul><li>  Some process raw data and allow you to create, receive, update, delete and search for them (ie, CRUD); </li><li>  Others implement interfaces (user, rather than software, lane) to interact with other elements, detect events related to their area of ‚Äã‚Äãresponsibility, and send notifications about these events; </li><li>  Still others are responsible for receiving these notifications, implement the business logic and decide how to change the data. </li></ul><br><p>  Fortunately, a design pattern already exists that describes this behavior. </p><br><h1>  Template Model-View Controller (MVC) </h1><br><p>  Model-View-Controller divides the program into three main components: Model (CRUD), View (Interface / Detection) and Controller (Solution / Action).  MVC is quite flexible and is implemented on top of EC and OOP. </p><br><p>  In game and user interface design, there are everyday means of waiting for user input or triggering triggers, sending event notifications, responding to them, and updating data.  These actions illustrate the compatibility of the application with MVC. </p><br><p>  This methodology introduces another layer of abstraction, which helps in planning software and navigating new developers even for large projects.  Separating data, interfaces, and business logic reduces the number of files that a developer will need to touch to add or modify application capabilities. </p><br><h1>  Unity and EC </h1><br><p>  Now take a closer look at the possibilities of Unity. </p><br><p>  Unity is an EC based platform where <code>GameObject</code> instances appear as Entities, and the ability to make them visible, moving, etc.  is provided by the inheritors of the <code>Component</code> class </p><br><p>  The Hierarchy Panel and the Inspector Panel are a powerful tool for assembling an application, assigning Components to Entities, configuring their initialization state, and starting the game.  Without them, much more code would be required. </p><br><img src="https://habrastorage.org/getpro/habr/post_images/bf1/856/516/bf185651691db591083aee6c13e046d1.jpg" alt="image"><br><p>  <em>Hierarchy Panel with four GameObjects on the right.</em> </p><br><img src="https://habrastorage.org/getpro/habr/post_images/27e/224/52e/27e22452e911e90037d36cb01e290db6.jpg" alt="image"><br><p>  <em>Inspector (Inspector Panel) with GameObject components.</em> </p><br><p>  As discussed above, we may face the problem of too many opportunities and end up in a giant hierarchy with business logic scattered here and there. </p><br><p>  However, MVC will help us out: we will divide the Entities according to their purpose and structure the application, as shown in the screenshot: <br></p><br><h3>  Adaptation MVC for game dev </h3><br><p>  The time has come for two modifications of the overall MVC pattern to adapt it to Unity-specific MVC-specific situations: </p><br><ul><li>  References to MVC classes should be easy on the code. <br><ul><li>  To give another object access to the instance, in Unity, the developer has to drag and drop object references in the editor or use cumbersome (and slow, approx.) Calls to <code>GetComponent(...)</code> . </li><li>  If Unity has crashed or because of some bug the links built in the editor have broken, the real Hell begins. </li><li>  Because of this, you need a root object through which you can access all instances used in the <strong>Application</strong> . </li></ul></li><li>  Some elements encapsulate logic that does not belong to any of the MVC categories and is often reused.  I will call them <strong>Components</strong> .  They are also Components in the Essence-Component structure, but in the MVC framework they act as auxiliary classes. <br><ul><li>  Example: A <code>Rotator</code> component that simply rotates an object.  But it does not send notifications, does not store anything and does not contain business logic. </li></ul></li></ul><br><p>  To solve these problems, I modified the original template and called it <strong>AMVCC</strong> or Application-Model-View-Controller-Component (Application-Model-View-Controller-Component). <br><img src="https://assets.toptal.io/uploads/blog/image/91487/toptal-blog-image-1438268986192-dc455bb88c34cd8c689ae9edb33f5eba.jpg" alt="image"></p><br><ul><li>  <strong>Application</strong> - a single point of entry into the application and container for all critical instances and application-dependent data. </li><li>  <strong>MVC</strong> - now you know what it is :) </li><li>  <strong>Component</strong> is a small self-contained and easily reusable script. </li></ul><br><p>  In my projects, these two innovations are more than enough. </p><br><h1>  Example: 10 Bounces </h1><br><p>  Apply the AMVCC pattern on a small game, let's call it ‚Äú10 Bounces‚Äù.  The installation of the game is simple: <code>Ball</code> with <code>SphereCollider</code> and <code>Rigidbody</code> , which will start to fall at the start of the game;  <code>Cube</code> as land and 5 scripts to create the AMVCC. </p><br><h3>  Hierarchy </h3><br><p>  Before proceeding with the code, I will sketch out the hierarchy of classes and assets, following the AMVCC style. <br><img src="https://assets.toptal.io/uploads/blog/image/91488/toptal-blog-image-1438269027508.2_10.42.25_AM-adaef24b99d08995ac47299b6960bde1.jpg" alt="image"></p><br><p>  GameObject <code>view</code> contains all visual elements and <code>View</code> scripts.  The <code>model</code> and <code>controller</code> objects in small projects usually contain only one corresponding script, and in larger projects there will be many scripts responsible for specific actions, data, etc. </p><br><p>  When does anyone want to access: </p><br><ul><li>  <strong>Data</strong> : will follow in <code>application &gt; model &gt; ...</code> </li><li>  <strong>Logic / Workflow (workflow)</strong> : <code>application &gt; controller &gt; ...</code> </li><li>  <strong>Render / Interface / Detection</strong> : <code>application &gt; view &gt; ...</code> <br>  If all teams follow these three rules, legacy projects will not be a problem. </li></ul><br><p>  Notice that the hierarchy does not have a separate container for the <code>Component</code> , since they can be independently used by different elements. </p><br><h3>  Scripting </h3><br><blockquote>  <strong>Pay attention</strong> : the scripts shown below is a generalization of the real code.  If you want to study a question in more detail, <a href="https://bitbucket.org/eduardo_costa/thelab-unity-mvc/overview">here is the link</a> to my MVC framework Unity MVC.  It is structured under AMVCC, so there you will find the base classes needed in most applications. </blockquote><br><p>  Now let's take a look at the structure of the ‚Äú10 Bounces‚Äù scripts. </p><br><p>  For those unfamiliar with the Unity device, I will briefly explain how GameObjects interact.  ‚ÄúComponents‚Äù from the Entity-Component template are represented by the <code>MonoBehaviour</code> class.  To make it available while the application is running, the developer must drag and drop the source file on the GameObject (which is the ‚ÄúEntity‚Äù in the EC template) or use the <code>AddComponent&lt;YourMonobehaviour&gt;()</code> command in the <code>AddComponent&lt;YourMonobehaviour&gt;()</code> .  After that, the script will be instantiated and ready to use. </p><br><p>  Declare two classes. </p><br><p>  <code>Application</code> (‚ÄúA‚Äù in AMVCC) is a main class that has only one instance containing references to all elements instantiated in the game.  Inside, we will declare three public variables: <code>model</code> , <code>view</code> and <code>controller</code> , which will provide access to the MVC root objects. </p><br><p>  <code>Element</code> is an auxiliary base class that gives MVC child instances access to <code>Application</code> . </p><br><p>  Remember that both classes are heirs of <code>MonoBehaviour</code> .  They are the ‚ÄúComponents‚Äù attached to the Essence GameObject. </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// BounceApplication.cs // Base class for all elements in this application. public class BounceElement : MonoBehaviour { // Gives access to the application and all instances. public BounceApplication app { get { return GameObject.FindObjectOfType&lt;BounceApplication&gt;(); }} } // 10 Bounces Entry Point. public class BounceApplication : MonoBehaviour { // Reference to the root instances of the MVC. public BounceModel model; public BounceView view; public BounceController controller; // Init things here void Start() { } }</span></span></code> </pre> <br><p>  Inheriting from the <code>BounceElement</code> base classes MVC.  Usually <code>BounceModel</code> , <code>BounceView</code> and <code>BounceController</code> act as containers of specialized MVC objects, but in a simplified example, only the View will have a nested structure.  Models and Controller enough for one script. </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// BounceModel.cs // Contains all data related to the app. public class BounceModel : BounceElement { // Data public int bounces; public int winCondition; }</span></span></code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// BounceView .cs // Contains all views related to the app. public class BounceView : BounceElement { // Reference to the ball public BallView ball; }</span></span></code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// BallView.cs // Describes the Ball view and its features. public class BallView : BounceElement { // Only this is necessary. Physics is doing the rest of work. // Callback called upon collision. void OnCollisionEnter() { app.controller.OnBallGroundHit(); } }</span></span></code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// BounceController.cs // Controls the app workflow. public class BounceController : BounceElement { // Handles the ball hit event public void OnBallGroundHit() { app.model.bounces++; Debug.Log(‚ÄúBounce ‚Äù+app.model.bounce); if(app.model.bounces &gt;= app.model.winCondition) { app.view.ball.enabled = false; app.view.ball.GetComponent&lt;RigidBody&gt;().isKinematic=true; // stops the ball OnGameComplete(); } } // Handles the win condition public void OnGameComplete() { Debug.Log(‚ÄúVictory!!‚Äù); } }</span></span></code> </pre> <br><p>  All scripts are created, now you can assign them to GameObjects and configure. </p><br><p>  The hierarchy will be: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">application</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[BounceApplication]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">model</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[BounceModel]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">controller</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[BounceController]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">view</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[BounceView]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> ... <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ball</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[BallView]</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> ...</code> </pre> <br><p>  Let's look at how this looks in the Unity editor using the example of <code>BounceModel</code> : <br><img src="https://assets.toptal.io/uploads/blog/image/91491/toptal-blog-image-1438269533580.2-56f489174107c172be051385f7d274e8.jpg" alt="image"><br>  <em>BounceModel with <code>bounces</code> and <code>winCondition</code> .</em> </p><br><p>  After installing the scripts and launching the game, the output to the Console will be as follows: <br><img src="https://assets.toptal.io/uploads/blog/image/91489/toptal-blog-image-1438269069944-03037d0a37cd8efd0e105123411ff0ce.jpg" alt="image"></p><br><h3>  Notifications </h3><br><p>  When the ball hits the ground, its representation calls the <code>app.controller.OnBallGroundHit()</code> method.  This is not to say that this is the ‚Äúwrong‚Äù way to send notifications in the application, but in my experience it is much more convenient to use the simple notification system implemented in the <code>Application</code> class. </p><br><p>  Update the BounceApplication: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// BounceApplication.cs class BounceApplication { // Iterates all Controllers and delegates the notification data // This method can easily be found because every class is ‚ÄúBounceElement‚Äù and has an ‚Äúapp‚Äù // instance. public void Notify(string p_event_path, Object p_target, params object[] p_data) { BounceController[] controller_list = GetAllControllers(); foreach(BounceController c in controller_list) { c.OnNotification(p_event_path,p_target,p_data); } } // Fetches all scene Controllers. public BounceController[] GetAllControllers() { /* ... */ } }</span></span></code> </pre> <br><p>  Now we need a new script, where developers will specify the names of events, notifications of which may come: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// BounceNotifications.cs // This class will give static access to the events strings. class BounceNotification { static public string BallHitGround = ‚Äúball.hit.ground‚Äù; static public string GameComplete = ‚Äúgame.complete‚Äù; /* ... */ static public string GameStart = ‚Äúgame.start‚Äù; static public string SceneLoad = ‚Äúscene.load‚Äù; /* ... */ }</span></span></code> </pre> <br><p>  Because of this, the developer will be able to open one file and understand the overall behavior of the application, instead of searching for code methods like <code>controller.OnSomethingComplexName</code> . </p><br><p>  Now we are adapting <code>BallView</code> and <code>BounceController</code> to work with the new system. </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// BallView.cs // Describes the Ball view and its features. public class BallView : BounceElement { // Only this is necessary. Physics is doing the rest of work. // Callback called upon collision. void OnCollisionEnter() { app.Notify(BounceNotification.BallHitGround,this); } }</span></span></code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// BounceController.cs // Controls the app workflow. public class BounceController : BounceElement { // Handles the ball hit event public void OnNotification(string p_event_path,Object p_target,params object[] p_data) { switch(p_event_path) { case BounceNotification.BallHitGround: app.model.bounces++; Debug.Log(‚ÄúBounce ‚Äù+app.model.bounce); if(app.model.bounces &gt;= app.model.winCondition) { app.view.ball.enabled = false; app.view.ball.GetComponent&lt;RigidBody&gt;().isKinematic=true; // stops the ball // Notify itself and other controllers possibly interested in the event app.Notify(BounceNotification.GameComplete,this); } break; case BounceNotification.GameComplete: Debug.Log(‚ÄúVictory!!‚Äù); break; } } }</span></span></code> </pre> <br><p>  More projects may have a lot of notifications.  To get rid of huge switch-cases, it is advisable to create specialized controllers and process different groups of notifications in them. </p><br><h1>  AMVCC in the real world </h1><br><p>  ‚Äú10 Bounces‚Äù shows the simplest use of the AMVCC pattern.  To use it in practice, you will have to sharpen the thinking within the three MVC categories and learn to visualize entities in the form of an ordered hierarchy. </p><br><p>  In large projects, developers are faced with more complex scenarios and often doubt whether this or that entity is a View or Controller, and it may be worthwhile to divide the class into parts. </p><br><h3>  Practical rules (from Eduardo) </h3><br><p>  This is not a ‚ÄúUniversal Guide to Organizing MVC‚Äù, but a set of simple rules that help me to separate the Model, View and Controller. </p><br><p>  Usually it happens by itself when I think over the architecture or write the script. </p><br><h3>  Class division </h3><br><p>  <strong>Models</strong> </p><br><ul><li>  Contains the basic data of the application such as the health or stock of the player‚Äôs patrons. </li><li>  Serialized, deserialized and / or converted between types. </li><li>  Load / save data (locally or over the web). </li><li>  Inform Controllers about the progress of the operation. </li><li>  Store the state of the game state machine. </li><li>  Never cause Submissions. </li></ul><br><p>  <strong>Representation</strong> </p><br><ul><li>  Can receive data from Models to display the current state of the game.  For example, the Representation method <code>player.Run()</code> can use <code>model.speed</code> to visually display the player‚Äôs abilities. </li><li>  Never changes Models. </li><li>  Strictly follows class assignment.  For example: <br><ul><li>  <code>PlayerView</code> never detects entering or changing game state. </li><li>  The view acts like a black interface box and alerts you to important events. </li><li>  It does not store important data like speed, health, lives and so on. </li></ul></li></ul><br><p>  <strong>Controllers</strong> </p><br><ul><li>  Do not store basic game data. </li><li>  Can filter notifications from Views. </li><li>  Update and use data models. </li><li>  Manage actions on the Unity scene. </li></ul><br><h3>  Class hierarchy </h3><br><p>  I understand which classes need to be split, when there are too many prefixes in the variables, or the possibility of branching is clearly seen (such as the <code>Player</code> classes in the MMO or the <code>Gun</code> types in the FPS).  But for the sake of completeness, I could not get around this point. </p><br><p>  For example, the Model with player data has a lot of <code>playerDataA, playerDataB ,‚Ä¶</code> variables or the Controller that handles player notifications, the <code>OnPlayerDidA, OnPlayerDidB,‚Ä¶</code> methods <code>OnPlayerDidA, OnPlayerDidB,‚Ä¶</code> We want to reduce the amount of code and get rid of the <code>player</code> and <code>OnPlayer</code> .  Since the Model is easier to understand, I will demonstrate this with her example. </p><br><p>  I usually start with a single Model that contains all the game data: </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Model.cs class Model { public float playerHealth; public int playerLives; public GameObject playerGunPrefabA; public int playerGunAmmoA; public GameObject playerGunPrefabB; public int playerGunAmmoB; // Ops Gun[CDE ...] will appear... /* ... */ public float gameSpeed; public int gameLevel; }</span></span></code> </pre> <br><p>  But the harder the game, the more variables there will be.  With enough complexity, we end up with a giant class containing model.playerABCDFoo variables.  Nested elements will simplify the code and allow you to switch between data variations. </p><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Model.cs class Model { public PlayerModel player; // Container of the Player data. public GameModel game; // Container of the Game data. }</span></span></code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// GameModel.cs class GameModel { public float speed; // Game running speed (influencing the difficulty) public int level; // Current game level/stage loaded }</span></span></code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// PlayerModel.cs class PlayerModel { public float health; // Player health from 0.0 to 1.0. public int lives; // Player ‚Äúretry‚Äù count after he dies. public GunModel[] guns; // Now a Player can have an array of guns to switch ingame. }</span></span></code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// GunModel.cs class GunModel { public GunType type; // Enumeration of Gun types. public GameObject prefab; // Template of the 3D Asset of the weapon. public int ammo; // Current number of bullets public int clips; // Number of reloads possible }</span></span></code> </pre> <br><p>  With such an organization of classes, at once the developer considers one logical unit, which simplifies the understanding of the code.  Let's imagine a first-person shooter with a variety of weapons.  The data in the <code>GunModel</code> class allows you to create a set of prefabs for each type of weapon and then use them in the game.  Prefab - pre-prepared GameObject, ready for quick copying and reuse. </p><br><p>             <code>gun0Ammo</code> , <code>gun1Ammo</code> , <code>gun0Clips</code>  .., ,      <code>Gun</code> ,   <code>Model</code> ,     <code>Player</code> .    ,       <code>GunModel</code> . <br><img src="https://assets.toptal.io/uploads/blog/image/91490/toptal-blog-image-1438269131871-fb7c3ac197fa95c295996b4b819b4fef.jpg" alt="image"><br> <em>  </em> </p><br><p>  ,    .       .       MVC   . </p><br><blockquote>    : Unity  MVC. </blockquote><br><h1>  Conclusion </h1><br><p>    .       ,     .       . ,      -            . </p><br><p>         .    <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F">  </a> ,        . </p><br><p>     AMVCC,     ,      <a href="https://bitbucket.org/eduardo_costa/thelab-unity-mvc/overview">Unity MVC</a> ,           AMVCC. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/281783/">https://habr.com/ru/post/281783/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281769/index.html">Explanation of the branching experiment, or philosophical research on benchmarks in vacuum and in ... reality</a></li>
<li><a href="../281771/index.html">The digest of interesting materials for the mobile developer # 149 (April 11-17)</a></li>
<li><a href="../281775/index.html">GECOn 2016: First Gomel IT Conference (April 24)</a></li>
<li><a href="../281777/index.html">Prediction of the outflow of players from World of Tanks from Yandex Data Factory. Lecture for the Small ShAD</a></li>
<li><a href="../281779/index.html">Apple discontinues QuickTime support for Windows</a></li>
<li><a href="../281785/index.html">Freedom to the tests</a></li>
<li><a href="../281787/index.html">The source code of the bot Gozi leaked to the network</a></li>
<li><a href="../281789/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ207 (11 - 17 April 2016)</a></li>
<li><a href="../281791/index.html">Spring meeting of Pattern Recognition and Computer Vision Colloquium 2016 in Prague: how it was</a></li>
<li><a href="../281793/index.html">How a secure printing system is implemented on a follow-me printing device</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>