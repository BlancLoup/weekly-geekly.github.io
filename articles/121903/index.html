<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Multiuser chat on BAT</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There was a period when the university was asked to make several chats. Depending on the options, various ways of program interaction from sockets to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Multiuser chat on BAT</h1><div class="post__text post__text-html js-mediator-article">  There was a period when the university was asked to make several chats.  Depending on the options, various ways of program interaction from sockets to mailslot were set.  When the tasks were completed, the strength remained to take on the BAT scripts.  That's what happened ... <br><br><img src="https://habrastorage.org/storage/7bb7fde9/ddf2ee75/7309ce86/e3b55797.png"><br><br>  <i>All you need to run:</i> <br>  1. Take the code by reference at the end of the article. <br>  2. Save code to * .bat file <br>  3. Put the file in a network folder <br>  4. Run the file from different computers (you can also from one) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>In the comments suggested to be used in conjunction with DropBox, but they say that it does not work very quickly.</i> <a name="habracut"></a><br><br>  First of all, I want to apologize for the code, decorated with screenshots.  Nobody will just highlight BAT-nick better than <a href="http://notepad-plus-plus.org/">Notepad ++</a> .  Snapshots of the code are saved in palette (256 colors) PNG - the weight of the code screen is 5-10 Kb. <br><br><h4>  First about the implementation </h4><br>  Basic elements: <br>  1.% chat% - group name <br>  2.% nick% - username <br>  3. file "% chat% _history" - file with full history of the group <br>  4. file "% chat%" - the file with the last replica in the group <br>  5. file "% chat% _cs" - file used for synchronization <br><br>  To begin, ask the user to enter the name of the group and your nickname.  After receiving the group name and nickname in line No. 5, the script launches itself with three parameters: the word talk_widget, as well as the group name and user name. <br><br><img src="https://habrastorage.org/storage/4cc312a5/8b09c7b5/04edff2e/e9c4a288.png"><br><br>  Now we display in the window title the name of the group and the name of the user (line No. 3).  If there is a file named% chat% _history, print its contents on the screen (line number 4).  Next in the loop, we read the contents of the% chat% file and compare it with what was in the previous reading.  If the contents of the file has changed - we print it on the screen. <br><br><img src="https://habrastorage.org/storage/fa41f061/62668c84/9d0595cf/641a128f.png"><br><br>  Initially, the code has the following structure: at startup, the parameters are checked, if the first parameter is the word ‚Äútalk_widget‚Äù, the script executes the code related to sending text.  In the absence of such a parameter, the code performs the function of receiving and displaying data.  Initially, the script is run without parameters, it asks the name of the group and the name of the user, starts the second process with the ‚Äútalk_widget‚Äù parameter, and starts typing the contents of the chat group. <br><br><img src="https://habrastorage.org/storage/f9c434d3/327d3452/634538e5/7e59e639.png"><br><br>  Now how the code accepts input from the user.  He first modifies the window title (line number 5).  Then it prints a connection notification message to the last replica file and appends the message to the history.  When accessing a replica file, a primitive critical section mechanism is used (below we will look at how it works).  Further, in the cycle (lines 11-19), data lines are received from the user and written to the file and replicated to the history file. <br><br><img src="https://habrastorage.org/storage/da6afc8b/deb36b86/d17cb08b/850ed7a9.png"><br><br>  The function of entering the critical section of the file used for synchronization, cyclically records a random number.  Until it is there when re-reading.  If the file exists at the time the function is launched, there is also a slight delay.  Delays are realized through <code>ping&gt;nul</code> . <br><br><img src="https://habrastorage.org/storage/8c0d5106/845dfa39/b5b13548/02c912e4.png"><br><br>  The exit function from the critical section simply deletes the synchronization file. <br><br><img src="https://habrastorage.org/storage/17015d59/09a09839/6b4a6f8d/24592c95.png"><br><br><h4>  Now, about the result </h4><br>  There is a chat with the following qualities: <br>  1. The division <b>into chat groups</b> (many groups and many users) <br>  2. <b>Getting the</b> communication <b>history</b> of new participants <br>  3. Communication <b>on the network</b> (put the script in a shared folder and run from different computers) <br><br>  At startup, the script asks the name of the chat group and the user name. <br><br><img src="https://habrastorage.org/storage/5b395b7f/3bf4cb9c/f1e25cf8/c98d4b78.png"><br><br>  After entering the required data, a second window appears, which serves as a console for input: <br><br><img src="https://habrastorage.org/storage/a4eb1cdd/cfdb249e/d5ac1df8/8b2178d5.png"><br><br>  Now I will launch the same BAT file (it is in a shared folder) from another computer on the network. <br><br><img src="https://habrastorage.org/storage/7c1ad9af/03de3d16/1dad3bff/e6633414.png"><br><br>  After entering the same chat name and the name of the new user, the second window will again appear to enter the data to be sent. <br><br><img src="https://habrastorage.org/storage/930eb729/2cec86d1/cadd23fa/1c9ee34e.png"><br><br>  Now we will try to send messages between subscribers: <br><br><img src="https://habrastorage.org/storage/a7e42c04/bec0ee86/c73aa625/596da3eb.png"><br><br>  Now connect from the third computer: <br><br><img src="https://habrastorage.org/storage/aeaa5008/2cd025c1/c0b5749c/1265a088.png"><br><br>  And we will see the following picture: <br><br><img src="https://habrastorage.org/storage/abfaf2b5/f82fb604/c2628ff3/3da3c4fc.png"><br><br>  <b>Attention!</b>  An incomprehensible bug in <b>win7</b> x64 is noticed when launching the script <b>from the network folder</b> // ***.  The third line of the <b>pushd</b> script <b>"% ~ dp0" is</b> interpreted for a <b>very</b> long time.  <b>% ~ Dp0</b> understands a very long time, just try to call <b>echo% ~ dp0</b> - this is at least strange.  If you wait 2-3 minutes, then everything will work fine ... in WinXP there are no such problems. <br><br>  <b>Warning:</b> each <i>time the script is launched from the network folder</i> in My Computer, network drives with the letters Z: Y: X: etc. will spawn.  After rebooting, they will disappear without a trace. <br><br>  And of course the link to the code: <a href="http://codepad.org/rvFN13LI">http://codepad.org/rvFN13LI</a> <br><br>  As well as useful links: <br>  1. Work with paths in BAT: <a href="http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/batch.mspx%3Fmfr%3Dtrue">http: //www.microsoft.com/ .....</a> <br>  2. And generally speaking about writing BAT-nicks: <a href="http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/batch.mspx%3Fmfr%3Dtrue">http: //www.microsoft.com/ .....</a> <br><br>  <b>UPDATE:</b> <br>  <i>If you happened to use this chat for its intended purpose, he-khe)) Please leave a comment about the sensations you received.</i> </div><p>Source: <a href="https://habr.com/ru/post/121903/">https://habr.com/ru/post/121903/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121894/index.html">Most popular passcodes on smartphones</a></li>
<li><a href="../121895/index.html">Site concept: how and why to create it</a></li>
<li><a href="../121896/index.html">A couple of sentences</a></li>
<li><a href="../121898/index.html">Weekend not at the cottage</a></li>
<li><a href="../121899/index.html">Denial of the Day: Android 2.3 (Gingerbread) will still be released on HTC Desire</a></li>
<li><a href="../121904/index.html">Odorless filtering and non-linear estimation *</a></li>
<li><a href="../121905/index.html">Add a button for UIKeyboardTypeNumberPad</a></li>
<li><a href="../121906/index.html">Thrustmaster T500 RS: no compromise</a></li>
<li><a href="../121909/index.html">Versioned database structure migration: another approach</a></li>
<li><a href="../121910/index.html">Can e-books replace textbooks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>