<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to count other people's money</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the rail, a million and one tutorials have already been written about what to do if you suddenly have to write an application that works with mone...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to count other people's money</h1><div class="post__text post__text-html js-mediator-article">  For the rail, a million and one tutorials have already been written about what to do if you suddenly have to write an application that works with money. <br><br>  Usually it all comes down to tips not to use Float, use Decimal, there are all sorts of transactions and so on.  And in most cases, these tips are enough for the developer to feel dry and comfortable. <br><br>  Did you come across a situation where, say, an application should serve the inhabitants of more than one country? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><img src="https://habrastorage.org/storage/232979be/b7b86f6a/e02e8283/a45c389e.jpg"><br><br>  Here is a hypothetical situation: the application is a subscription service for <s>onaniz</s> fans, for example, uh, paid cartoons.  We have each cartoon worth a certain decimal amount of rubles, which is stored in the database.  And the user has a certain decimal amount of rubles that he can spend on viewing.  And everything is cool until we decide that it would be beneficial to show cartoons to the citizens of Ukraine.  Ukrainians, too, love to watch cartoons and spend money.  Here it is only inconvenient for citizens to have an account in rubles.  Because they are paid salary in hryvnias, and on the card they probably have hryvnias.  And in general, every time it is in your mind to translate how much each ruble cartoon will cost, somehow sadly. <br><br><h4>  Money </h4><br><br>  And here in the shining armor of the savior of the day gem <code>money</code> taxiing out.  He knows just what he needs: <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># 5  dollars = Money.new(500, 'USD') # 10 ! euros = Money.new(1000, 'EUR') # #   euros &gt; dollars # =&gt; true #  euros.exchange_to('USD') # =&gt; #&lt;Money cents:1408 currency:USD&gt; #   !!11 Money.new(1000, 'USD') + Money.new(1000, 'EUR') # =&gt; #&lt;Money cents:2408 currency:USD&gt;</span></span></code> </pre><br><br>  In general, beauty and only. <br><br>  The only thing that saddens the holiday is a very nontrivial mechanism for connecting to rail models.  Something like this: <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># Gemfile gem 'money' gem 'google_currency', :require =&gt; 'money/bank/google_currency' # cartoon.rb class Cartoon &lt; ActiveRecord::Base composed_of :price, :class_name =&gt; 'Money', :mapping =&gt; [[ 'price_in_cents', 'cents' ], [ 'currency', 'currency_as_string' ]], :constructor =&gt; Proc.new { |cents, currency| Money.new(cents || 0, currency || Money.default_currency) }, :converter =&gt; Proc.new { |value| value.respond_to?(:to_money) ? value.to_money : raise(ArgumentError, "Can't convert #{value.class} to Money") } end # migration create_table :cartoons do |t| # ... t.integer :price_in_cents, :default =&gt; 0, :null =&gt; false t.string :price_currency, :limit =&gt; 3, :null =&gt; false # ... end</span></span></code> </pre><br><br>  And it is only in one model.  And still it is necessary not to forget the initializer to write, so that the currencies into each other are converted: <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># intializers/money.rb Money.default_bank = Money::Bank::GoogleCurrency.new</span></span></code> </pre><br><br><h4>  Counterfeit </h4><br><br>  In short, when I copy-paste this code into a third model, the thought came to my bright mind to write a simple hem that slightly simplified the whole thing.  Well, I wrote. <br><br>  It is called <a href="https://github.com/rwz/counterfeit">counterfeit</a> . <br><br>  It works just like felt boots: <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># Gemfile gem 'counterfeit' # cartoon.rb class Cartoon &lt; ActiveRecord::Base has_counterfeit :price #        # :currency =&gt; 'RUB' #    ,     . # :currency_attribute =&gt; :price_currency, # :amount_attribute =&gt; :price_in_cents end # migration create_table :cartoons do |t| # ... t.money :price # ... end</span></span></code> </pre><br><br>  Google as an exchanger is put down by itself, but only at the first unsuccessful attempt to convert currencies with a standard convector.  A standard one needs to prescribe courses with his hands - you are unlikely to do this, right? <br><br>  In general, if you ever have to write an application with paid cartoons, try counterfeit.  And you will find bugs - write, otherwise I already launched into production. <br><br><h4>  But wait, there is more </h4><br>  Something told me that very few people would type the word counterfeit the first time without errors, so a magic alias was made specifically for these guys: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cartoon</span></span></span><span class="hljs-class"> &lt; ActiveRecord::Base </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">has_money</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">price</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment">#   , ? end</span></span></span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/122022/">https://habr.com/ru/post/122022/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122017/index.html">Google Analytics: Improvements in the Map Overlay report</a></li>
<li><a href="../122018/index.html">10 reasons why we switched to PyCharm</a></li>
<li><a href="../122019/index.html">Google Docs developers share future plans</a></li>
<li><a href="../122020/index.html">Spaces - the main enemy of Linux</a></li>
<li><a href="../122021/index.html">School of data analysis Yandex: graduation again</a></li>
<li><a href="../122025/index.html">iPad ‚Üí iPADrom - S03E07. IPad software review</a></li>
<li><a href="../122026/index.html">Android slider from LG with two screens</a></li>
<li><a href="../122027/index.html">How to study source codes</a></li>
<li><a href="../122028/index.html">IPO for dummies. Part V: Life after IPO</a></li>
<li><a href="../122029/index.html">We learn bash-scripts, we write Xonix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>