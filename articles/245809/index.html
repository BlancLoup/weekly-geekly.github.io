<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Experience creating a home Wi-Fi router. Part 2. Installing and configuring software</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello again! 

 In the first part of the article, I talked about the ‚Äúiron‚Äù component of the future router. Since without the software, even the most ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Experience creating a home Wi-Fi router. Part 2. Installing and configuring software</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/1f5/83c/a2e/1f583ca2e55244bd9007a1bbca9c6f8f.jpg"><br><br>  Hello again! <br><br>  In the <a href="http://habrahabr.ru/post/245421/">first part of the</a> article, I talked about the ‚Äúiron‚Äù component of the future router.  Since without the software, even the most wonderful hardware, naturally, will not work, therefore, it was necessary to provide the device with the appropriate software "stuffing". 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When I started all this movement, I assumed that it would be difficult.  But did not imagine that so.  In one of the <a href="http://habrahabr.ru/post/245421/">comments</a> to the previous part of the article, I vowed to tell about the following ‚Äúby the weekend‚Äù.  Wisely kept silent about which ones.  :-) There still managed to get sick at the wrong time, but still keep my promise. <br><br>  So‚Ä¶ <br><a name="habracut"></a><br><br>  I will remind a complete set: <br><br><ul><li>  <a href="http://www.intel.ru/content/www/ru/ru/motherboards/desktop-motherboards/desktop-board-d2500cc.html">Intel D2500CC motherboard</a> with dual-core 64-bit Intel Atom D2500 processor, two gigabit network interfaces </li><li>  SO-DIMM DDR-3 1066 4Gb Corsair RAM </li><li>  SSD Crucial M500 120 GB </li><li>  1000 Mbit D-Link DGE-528T network card </li><li>  mini-PCI-E Wi-Fi Intel 7260.HMWWB 802.11 a / b / g / n / ac card + Bluetooth 4.0 </li><li>  All this farm is packaged in a body <a href="http://www.morex-case.ru/t-3460.shtml">Morex T-3460</a> 60W </li></ul><br>  First of all, I determined for myself the range of tasks that the router will perform, so that in the future it would be easier for me to administer it. <br><br>  Once again, I‚Äôll clarify that these your Internet sites come to me through the 100 Mbit channel (the tariff, of course, gives a slightly lower speed, but not the essence).  Actually, this is what happened: <br><br><ul><li>  Internet access from all devices available at home to <i>+ n</i> devices appearing sporadically or even once </li><li>  Home LAN </li><li>  Respectively, traffic routing from / to internet / local network </li><li>  File storage (FTP or Samba access) </li><li>  Torrentokachalka </li><li>  ed2k network (for the provider is very well developed) </li><li>  web server </li></ul><br>  In perspective: <br><br><ul><li>  domain </li><li>  CCTV </li><li>  elements of "smart home" </li><li>  <s>damn it in a mortar a</s> lot of interesting things </li></ul><br>  It was natural in this situation to choose from <em>* nix-based</em> systems.  Some time had to be spent on studying the materiel, rska on the network.  In the end, I did the following way ... <br><hr><br><h5>  1. FreeBSD 10.1-RELEASE </h5><br><img src="https://habrastorage.org/files/ff1/4cc/892/ff14cc89208848799ffccd0568ab8e60.png"><br>  I really wanted to implement everything in the fryahe.  Its advantages in managing network devices, servers / gateways / routers are obvious, indisputable and repeatedly sung by the guru. <br>  Since I hadn‚Äôt closely dealt with cases before, I had to cool up the <a href="https://www.freebsd.org/doc/ru_RU.KOI8-R/books/handbook/index.html">FreeBSD Handbook</a> , accompanying the reading process with a parallel installation process on the device of the last stable release 10.1. <br><div class="spoiler">  <b class="spoiler_title">Small retreat</b> <div class="spoiler_text">  By the way, I made the installation of the fryaha (and of all the systems described below) using the wonderful <a href="http://www.zalman.ru/global/product/product_read.php%3Fid%3D195">Zalman ZM-VE300 device</a> with a terabyte HDD inside;  This device has an optical drive emulator onboard, which allows you to <b>add</b> images to the <b>_iso</b> folder on your hard drive, then, after installing BIOS boot from Zalman Virtual CD, download and install from these images, it‚Äôs like if they were written on the disc and inserted into the physical drive. </div></div><br>  Everything was great, the system got up, but an unpleasant surprise was waiting for me, which I, frankly, knew, but I decided to test it in practice: FreeBSD refused to see the Wi-Fi card.  Or rather, she saw it, but only the address and the name of the vendor, and she didn‚Äôt want to understand what it was and what it was eaten with (device driver was listed as <b>none1</b> ).  In addition, further reading of the manual revealed that, in the access point mode, FreeBSD only has Wi-Fi cards based on Prism chipsets.  <em>Pechalbeda ...</em> Yes, I also found the information that my card currently has no driver at all.  Even ported. <br><br><h5>  10. Debian 7.7.0 </h5><br><img src="https://habrastorage.org/files/3a9/170/9b0/3a91709b09ff479b861097840051519f.png"><br><br>  I did not get upset for long: the fryakh did not take place - take the good old Debian.  Installed from a netinstall-image base system without a graphical environment.  For a long time trying to understand what is wrong.  The stable release of Debian is currently 7.7.0, has a kernel version 3.2.  In this core, again, there is no support for my long-suffering Wi-Fi network card.  I climbed on the ENT to look for an answer, in the end I received disappointing conclusions: it is necessary to put a fresher kernel (in the case of Debian, he still has hemorrhoids), dances with <s>tambourine</s> cores, in the opinion of the gurus, don‚Äôt trump the Debian-way (you just said: you want to re-core choose another distribution). <br><br><h5>  11. Ubuntu Server 14.04 LTS </h5><br><img src="https://habrastorage.org/files/626/fec/e57/626fece57a3b4223ad090ff8e4af6cbf.png"><br><br>  Having spat on attempts to <s>have a</s> <em>good</em> <s>time to</s> <em>redden eyes</em> , I took a familiar and respected distribution kit.  For more than a year, he (although version 12.04 <abbr title="Long Term Support">LTS</abbr> ) has been spinning on my server distributing buns on the provider's network. <br><br>  From the pros: stability, ease of installation, configuration and administration, a lot of documentation. <br>  Of the minuses: the need to refine the file, since the "snarves" turns out to be thick and somewhat clumsy. <br><br><h6>  Installation </h6><br>  In fact, it is nothing complicated and is similar to that in Debian.  Produced in a <em>text-mode</em> dialog.  I see no point in describing in detail, because  All this has already been chewed dozens of times and lies on a variety of resources (starting with the official websites in different languages ‚Äã‚Äãand ending with small-town forums). <br><br>  The important point is the correct layout and preparation of the <abbr title="Solid state drive">SSD</abbr> .  Everyone knows that solid-state drives are built on flash-memory technology and have a limited write resource.  For the sake of justice, I would note that in the vastness of the World Wide Web, verbs are said about the sufficient reliability of modern solid-state emitters (comparable to classic hard disks).  Nevertheless, it would be foolish to spit on the elementary recommendations for the operation of SSD. <br><br>  Before starting any manipulations with the drive, it is recommended to update the firmware, but it turned out to be the most recent on mine, so I missed this step. <br><br>  The first necessary manipulation when marking the drive is the <a href="http://www.linux.org.ru/wiki/en/%25D0%2592%25D1%258B%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BD%25D0%25B8%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D1%2580%25D0%25B0%25D0%25B7%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25BE%25D0%25B2_%25D0%25B4%25D0%25B8%25D1%2581%25D0%25BA%25D0%25B0">alignment of the disk partitions</a> .  In short, each section should begin with a sector of a multiple of 8. The first section is recommended to begin with sector 2048 (this is due to the location at the beginning of the <abbr title="Master boot record">MBR</abbr> or <abbr title="GUID Partition Table">GPT</abbr> drive, and the ‚Äúindent‚Äù of 1 MB is taken with a margin. <br><br>  When marking I created 3 sections: <br><br><ul><li>  boot - ext2 </li><li>  root - ext4 </li><li>  home - ext4 </li></ul><br><pre><code class="bash hljs">$ sudo fdisk -l  /dev/sda: 120.0 , 120034123776  255 , 63 /, 14593 ,  234441648  Units =  of 1 * 512 = 512 bytes   (/): 512  / 4096  I/O size (minimum/optimal): 4096 bytes / 4096 bytes  : 0x000ea779 -     Id  /dev/sda1 * 2048 1050623 524288 83 Linux /dev/sda2 1050624 42993663 20971520 83 Linux /dev/sda3 42993664 234440703 95723520 83 Linux</code> </pre> <br>  As you can see, all partitions start with sectors that are multiples of 8. Thus, access will be carried out with reference to the <em>correct</em> sector, which will help preserve the delicate resource of the drive. <br><br>  Further, in the partition mounting options in <em>/ etc / fstab</em> , add <b>discard</b> - to enable TRIM and <b>noatime</b> - to disable writing to the metadata of the last file access time. <br><br><div class="spoiler">  <b class="spoiler_title">Another retreat</b> <div class="spoiler_text">  With <b>noatime is</b> not so simple.  For example, in desktop systems, browsers track the ‚Äúfreshness‚Äù of their cache precisely by the time of the last access, thus turning on this option doesn‚Äôt mean a decrease in writing to the disk, but rather an increase, because the browser sees that its cache is ‚Äúrotten‚Äù and starts pull up new.  In this case, it is recommended to use the <b>relatime</b> option - the access time attribute (atime) is updated, but only if the file data has changed (the mtime attribute) or its status (the ctime attribute).  For the server system, this is perhaps not so critical, but I still included <b>noatime</b> for boot, and for root and home, <b>relatime</b> . </div></div><br>  All the other tips, coagulated in the open spaces of the network, such as the increase in time between flushing buffers to disk (option <b>= time, sec.</b> ), Disabling the ‚Äúbarrier‚Äù ( <b>barrier</b> option <b>= 0</b> ) and others did not inspire me with confidence in terms of utility acquired at the expense of data integrity and security. <br>  In addition, I did not allocate a separate section for the swap, having decided that I should have enough RAM for the tasks.  If, however, there is a need to swap, nothing prevents to make a swap as a file and mount it as a partition. <br><br>  It was also a volitional decision to render temporary files (/ tmp) in tmpfs. <br><br>  During the installation, common parameters are set, such as: locale, time / geolocation parameters, system name, as well as creating a new user and password to it.  What follows is the choice of software to be installed, in which I marked the following for installation: <br><br><ul><li>  OpenSSH server </li><li>  DNS server </li><li>  LAMP server </li><li>  Print server </li><li>  Samba file server </li></ul><br>  After booting into a freshly installed system, one extremely unpleasant feature showed up (by the way, Debian had the same thing): after initializing the drivers, the video was cut down, the monitor went into standby mode, and it became unclear how the system hung or just something was wrong with the output.  It was found that there is ssh access, and it would be possible to stop there, but there can always be a situation when you need to get physical access to the router (for example, playful admin hands digging into the network settings, and access through the console is completely gone%)).  Surfing the forums I came across a solution (it turns out the bug is known and manifests itself on this motherboard): <br><blockquote>  add to /etc/modprobe.d/blacklist.conf: <br>  blacklist gma500_gfx <br><br>  run <br>  sudo update-initramfs -u <br>  sudo reboot </blockquote><br>  <a href="http://ubuntuforums.org/showthread.php%3Ft%3D2073727">Proof</a> <br>  In the case of Debian, <em>/etc/modprobe.d/fbdev-blacklist.conf</em> . <br>  After the reboot, everything worked. <br><br><h6>  Network configuration </h6><br>  During the installation process, I chose the D-Link card as the network interface to be used for the installation.  She was able to connect the patchcord to one of the LANs of my old router (this was done in order to have SSH access before configuring the network interfaces, and since Asus‚Äôs DHCP server was also running, there were no connection problems) Internet access will not be any problem. <br>  Also in the fresh system, another glitch appeared: <br><blockquote>  no talloc stackframe at ../source3/param/loadparm.c:4864, leaking memory </blockquote><br>  The problem is related to the <em>libpam-smbpass</em> authorization library, you can simply demolish it, or you can do more elegantly: <br><br><pre> <code class="bash hljs">$ sudo pam-auth-update</code> </pre><br>  Uncheck <em>SMB password synchronization</em> , which disables the synchronization of passwords of system users and Samba users. <br>  Install all available updates: <br><br><pre> <code class="bash hljs">$ sudo apt-get update $ sudo apt-get upgrade $ sudo apt-get dist-upgrade</code> </pre><br>  And proceed to configure the network interfaces.  The router has 4 physical interfaces and loopback: <br><div class="spoiler">  <b class="spoiler_title">Terminal output</b> <div class="spoiler_text"><pre> <code class="bash hljs">$ ifconfig -a em0 Link encap:Ethernet HWaddr 00:22:4d:ad:69:f0 UP BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) Interrupt:17 :d0220000-d0240000 eth0 Link encap:Ethernet HWaddr d8:fe:e3:a7:d5:26 inet addr:192.168.1.10 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::dafe:e3ff:fea7:d526/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:741 errors:0 dropped:0 overruns:0 frame:0 TX packets:477 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:482523 (482.5 KB) TX bytes:45268 (45.2 KB) eth1 Link encap:Ethernet HWaddr 00:22:4d:ad:69:ec UP BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) Interrupt:16 :d0320000-d0340000 lo Link encap:  (Loopback) inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:28 errors:0 dropped:0 overruns:0 frame:0 TX packets:28 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:1784 (1.7 KB) TX bytes:1784 (1.7 KB) wlan0 Link encap:Ethernet HWaddr 80:19:34:1e:fe:83 UP BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B)</code> </pre><br></div></div><br><ul><li>  <b>eth0</b> - ‚Äúlooks‚Äù on the Internet, receives settings via DHCP </li><li>  <b>eth1</b> and <b>em0</b> - network adapters integrated into the motherboard </li><li>  <b>wlan0</b> - as you might guess, the wireless interface Wi-Fi </li></ul><br>  Install <em>hostapd</em> and put the wireless interface into <em>Master</em> mode: <br><pre> <code class="bash hljs">$ sudo iwconfig wlan0 mode Master</code> </pre><br>  To my great regret, this method did not work, and the team fell out with an error, so I resorted to an alternative method: <br><pre> <code class="bash hljs">$ sudo apt-get install iw $ sudo iw dev wlan0 del $ sudo iw phy phy0 interface add wlan0 <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> __ap</code> </pre><br>  Then: <br><pre> <code class="bash hljs">$ iwconfig wlan0 IEEE 802.11abgn Mode:Master Tx-Power=0 dBm Retry long <span class="hljs-built_in"><span class="hljs-built_in">limit</span></span>:7 RTS thr:off Fragment thr:off Power Management:on</code> </pre><br>  Now you need to configure all network interfaces to make it easier to work with them.  I decided to integrate the built-in network cards and Wi-Fi into a bridge in order to manage this economy as a single entity when distributing IP addresses via DHCP, routing, etc. We lead to the following type of <em>/ etc / network / interfaces</em> : <br><div class="spoiler">  <b class="spoiler_title">/ etc / network / interfaces</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># This file describes the network interfaces available on your system # and how to activate them. For more information, see interfaces(5). # The loopback network interface auto lo iface lo inet loopback # The primary network interface auto eth0 iface eth0 inet dhcp auto wlan0 br0 # The wireless interface iface wlan0 inet manual pre-up iw dev wlan0 del pre-up iw phy phy0 interface add wlan0 type __ap # The bridge iface br0 inet static address 192.168.0.1 network 192.168.0.0 netmask 255.255.255.0 broadcast 192.168.0.255 bridge_ports em0 eth1 wlan0</span></span></code> </pre><br></div></div><br>  Reboot.  Now we see: <br><div class="spoiler">  <b class="spoiler_title">Terminal output</b> <div class="spoiler_text"><pre> <code class="bash hljs">$ ifconfig -a br0 Link encap:Ethernet HWaddr 00:22:4d:ad:69:ec inet addr:192.168.0.1 Bcast:192.168.0.255 Mask:255.255.255.0 UP BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) em0 Link encap:Ethernet HWaddr 00:22:4d:ad:69:f0 UP BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) Interrupt:17 :d0220000-d0240000 eth0 Link encap:Ethernet HWaddr d8:fe:e3:a7:d5:26 inet addr:192.168.1.10 Bcast:192.168.1.255 Mask:255.255.255.0 inet6 addr: fe80::dafe:e3ff:fea7:d526/64 Scope:Link UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1 RX packets:1329 errors:0 dropped:0 overruns:0 frame:0 TX packets:819 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:531178 (531.1 KB) TX bytes:125004 (125.0 KB) eth1 Link encap:Ethernet HWaddr 00:22:4d:ad:69:ec UP BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B) Interrupt:16 :d0320000-d0340000 lo Link encap:  (Loopback) inet addr:127.0.0.1 Mask:255.0.0.0 inet6 addr: ::1/128 Scope:Host UP LOOPBACK RUNNING MTU:65536 Metric:1 RX packets:28 errors:0 dropped:0 overruns:0 frame:0 TX packets:28 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:0 RX bytes:1784 (1.7 KB) TX bytes:1784 (1.7 KB) wlan0 Link encap:Ethernet HWaddr 80:19:34:1e:fe:83 UP BROADCAST MULTICAST MTU:1500 Metric:1 RX packets:0 errors:0 dropped:0 overruns:0 frame:0 TX packets:0 errors:0 dropped:0 overruns:0 carrier:0 collisions:0 txqueuelen:1000 RX bytes:0 (0.0 B) TX bytes:0 (0.0 B)</code> </pre><br></div></div><br>  All interfaces were initialized. <br>  You can begin to configure <em>hostapd</em> .  While we were discussing here, the version has become 2.1. <br>  I got this config <em>/etc/hostapd/hostapd.conf</em> : <br><div class="spoiler">  <b class="spoiler_title">hostapd.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs">interface=wlan0 bridge=br0 driver=nl80211 logger_syslog=-1 logger_syslog_level=4 logger_stdout=-1 logger_stdout_level=4 ssid=TEST hw_mode=g ieee80211n=1 ht_capab=[HT40-][SHORT-GI-40] channel=11 macaddr_acl=0 deny_mac_file=/etc/hostapd/hostapd.deny auth_algs=3 ignore_broadcast_ssid=1 ap_max_inactivity=300 wpa=2 wpa_passphrase=my_wpa_passphrase wpa_key_mgmt=WPA-PSK rsn_pairwise=CCMP</code> </pre><br></div></div><br>  We <em>enable the</em> automatic launch of <em>hostapd</em> when the system boots, for this <em>we</em> uncomment and edit the lines in <em>/ etc / default / hostapd</em> : <br><pre> <code class="bash hljs">DAEMON_CONF=<span class="hljs-string"><span class="hljs-string">"/etc/hostapd/hostapd.conf"</span></span> DAEMON_OPTS=<span class="hljs-string"><span class="hljs-string">"-B"</span></span> RUN_DAEMON=<span class="hljs-string"><span class="hljs-string">"yes"</span></span></code> </pre><br>  Further, without further ado, I set up sharing.  I took the script to configure <em>iptables</em> and ip-forwarding <a href="http://help.ubuntu.ru/wiki/wifi_ap">from here</a> , adjusted it to fit my realities and set up autostart.  As a result, <em>iptables are</em> filled with the necessary content when the system boots. <br>  It is logical that you need to configure a DHCP server.  Having decided to simplify the task to a minimum, I installed <em>dnsmasq</em> and removed the existing and conflicting <em>bind9</em> with it.  The config is simple: <br><div class="spoiler">  <b class="spoiler_title">/etc/dnsmasq.conf</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># Configuration file for dnsmasq. # # Format is one option per line, legal options are the same # as the long options legal on the command line. See # "/usr/sbin/dnsmasq --help" or "man 8 dnsmasq" for details. # Never forward plain names (without a dot or domain part) domain-needed # Never forward addresses in the non-routed address spaces. bogus-priv # If you want dnsmasq to listen for DHCP and DNS requests only on # specified interfaces (and the loopback) give the name of the # interface (eg eth0) here. # Repeat the line for more than one interface. interface=br0 # This is an example of a DHCP range where the netmask is given. This # is needed for networks we reach the dnsmasq DHCP server via a relay # agent. If you don't know what a DHCP relay agent is, you probably # don't need to worry about this. dhcp-range=192.168.0.2,192.168.0.254,255.255.255.0,12h # Give a host with Ethernet address 11:22:33:44:55:66 or # 12:34:56:78:90:12 the IP address 192.168.0.60. Dnsmasq will assume # that these two Ethernet interfaces will never be in use at the same # time, and give the IP address to the second, even if it is already # in use by the first. Useful for laptops with wired and wireless # addresses. #dhcp-host=11:22:33:44:55:66,12:34:56:78:90:12,192.168.0.60 dhcp-host=00:11:22:33:44:55,66:77:88:99:aa:bb,MyDevice1,192.168.0.2 dhcp-host=cc:dd:ee:ff:ee:dd,cc:bb:aa:99:88:77,MyDevice2,192.168.0.3</span></span></code> </pre><br></div></div><br>  In fact, there is a bunch of commented out options in the config that allow you to perform very <em>fine tuning</em> , but this set is quite enough for proper operation.  In principle, from this point on, the device is already working as a home router. <br>  After the end of the basic setup, I installed and configured the <a href="http://help.ubuntu.ru/wiki/transmission-daemon">transmission-daemon</a> , <a href="http://wiki.amule.org/wiki/FAQ_amuled">aMuled</a> and <a href="http://help.ubuntu.ru/wiki/%25D1%2580%25D1%2583%25D0%25BA%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B4%25D1%2581%25D1%2582%25D0%25B2%25D0%25BE_%25D0%25BF%25D0%25BE_ubuntu_server/%25D1%2584%25D0%25B0%25D0%25B9%25D0%25BB%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B5_%25D1%2581%25D0%25B5%25D1%2580%25D0%25B2%25D0%25B5%25D1%2580%25D0%25B0/ftp_server">vsftpd</a> .  As a matter of fact, setting up these services is rather trivial, I will not dwell on it in detail.  Naturally, access to these resources is only available from the local network, if you want to gain access from the outside, you will need to open the corresponding ports in <em>iptables</em> . <br>  Web server is a bunch of <b>Apache 2.4.7</b> + <b>MySQL Ver 14.14 Distrib 5.5.40</b> .  I have not yet figured out what to fill it in: roll the finished engine and indulge in design or just practice <em>html</em> and <em>php</em> .  In any case, this has practical significance for me.  Perhaps in the future it will be possible to set up a web interface to monitor and control the router. <br>  After all the manipulations, it remains to configure logging: if possible, bring up the settings of all processes leading to the logs, display only critical notifications and warnings in them.  The idea is to reduce the number of write operations, and, accordingly, the negative impact on the SSD. <br>  In addition, <s>it should be</s> strongly recommended to enable <em>cron</em> startup once a day <b>fstrim</b> (for each section separately).  They say it won't be worse for sure. <br><br>  Ffuh ... It turned out a somewhat messy description of my ordeals with a hand-assembled device, but the satisfaction that <em>everything works is</em> simply indescribable. <br><br>  In the <a href="http://habrahabr.ru/post/245421/">comments</a> to the previous part of the article, the respected <a href="http://habrahabr.ru/users/dmitrmax/" class="user_link">dmitrmax was</a> interested in the level of energy consumption of the assembly.  Well, here are some sample data that I managed to get from public sources: <br><ul><li>  <b>Intel Atom D2500 processor</b> - up to 10 W </li><li>  SSD <b>Crucial M500</b> - 3.6 W </li></ul><br>  For the rest of the data there was no data at once, but almost everywhere in the characteristics of the network card and the Wi-Fi module they write ‚Äúlow power consumption‚Äù.  If you roughly throw 10 W into everything about everything (other hardware, integrated network cards, etc), then you get <b>about 25 W</b> - not so much, I suppose ... <br><br>  It seems to have forgotten nothing, mentioned all the key points.  For details, please comment.  Thanks for attention!  (-; <br><br>  <b>UPD:</b> Mr. <a href="http://habrahabr.ru/users/revertis/" class="user_link">Revertis</a> rightly remarked, and I agree with him that initially when installing the system, it was not necessary to mark the DNS server in order to demolish it later (this is <em>bind9</em> ), but in the article I described exactly the <i>path I</i> had done - with all his mistakes and back streets.  And yes, I agree that <em>nginx is</em> better than <em>Apache</em> , moreover - I will even replace it.  Thanks for the advice. </div><p>Source: <a href="https://habr.com/ru/post/245809/">https://habr.com/ru/post/245809/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245795/index.html">Review of the most interesting materials on data analysis and machine learning ‚Ññ26 (December 8 - 14, 2014)</a></li>
<li><a href="../245797/index.html">Category Theory for Programmers: Preface</a></li>
<li><a href="../245801/index.html">Maximum XOR</a></li>
<li><a href="../245805/index.html">Free SMS sending from Arduino without GSM module</a></li>
<li><a href="../245807/index.html">C ++ Russia Conference in Moscow</a></li>
<li><a href="../245811/index.html">New release and features: 3CX Phone System 12.5 Release Candidate</a></li>
<li><a href="../245817/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ138 (December 8 - 14, 2014)</a></li>
<li><a href="../245823/index.html">Hell Visualization 1.1 - Book 2: Problems</a></li>
<li><a href="../245825/index.html">Black Friday 2014. Results</a></li>
<li><a href="../245829/index.html">Mobile Product Support: Tasks, Processes, Tools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>