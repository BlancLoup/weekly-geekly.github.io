<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Antivirus fight</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An almost unbiased comparison of LMD, Manul, ClamAV and Virusday antiviruses. 


 Over the past year, the ranks of antiviruses that are struggling wit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Antivirus fight</h1><div class="post__text post__text-html js-mediator-article"><h2>  An almost unbiased comparison of LMD, Manul, ClamAV and Virusday antiviruses. </h2><br><img src="https://habrastorage.org/files/233/305/c78/233305c7820d452fa7a16cc028c343ab.jpg"><br><br>  Over the past year, the ranks of antiviruses that are struggling with the infection of websites, have been replenished with several new representatives.  Now the choice of a webmaster or site owner becomes more difficult.  Another year or two ago there was nothing to choose from. <br><br>  Analysis of individual cases of the use of anti-viruses have already been published on Habr√©.  However, no one did any general and complete comparison.  To help us understand the difference between antivirus products for fighting viruses on servers and websites, we now compare the antivirus databases of four antiviruses in terms of completeness and accuracy.  We will try to do it correctly and impartially. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Comparison of detection accuracy </h2><br>  Let's understand the accuracy of the detection of threats to each antivirus.  For each of the patients, false positives are possible, and our task is to determine their share in the set of detected files by each of the antiviruses individually.  After all, no one needs an antivirus that points the finger at good files instead of infected ones. <br><br>  For the analysis of the accuracy of identifying threats, we will use a set of sites (W).  We will not make a difference between infections and suspicions due to the fact that some antiviruses do not have such functions.  We will have to manually check the file detected by each anti-virus for the presence of malicious code in it (we are fighting for objectivity).  Such work, as you understand, (in case there are many such files) takes a lot of time and effort.  Therefore, we will take a set of W sites that are necessary and sufficient for satisfactory accuracy and a relatively short manual analysis time.  W = 1500. <br><br>  Let be <img src="https://habrastorage.org/files/47c/0df/46c/47c0df46c03d4f69b29376d737bf8fa0.png">  , <img src="https://habrastorage.org/files/8bc/651/7e2/8bc6517e23dd4fffa83b5c690ce33100.png">  , <img src="https://habrastorage.org/files/115/3d7/e9f/1153d7e9f9a649a7ac552ebd3c1e4140.png">  , <img src="https://habrastorage.org/files/d88/635/160/d88635160160429287b2446a504ffa69.png">  - multiple files defined by each of the antiviruses separately when analyzing the same set of sites (W). <br><br><img src="https://habrastorage.org/files/159/e3a/6e5/159e3a6e53d44a4d9cfb22414f7f02ee.png"><br><br>  The accuracy of the definition (A) of the antivirus will be called a subset of various files that are guaranteed to contain malicious code. <img src="https://habrastorage.org/files/bab/874/5da/bab8745da3f54f4fa045aef056e9e320.png">  identified by him on the corresponding set <img src="https://habrastorage.org/files/2a1/bbe/dff/2a1bbedfffe74fabbf6d96b8dc1d788c.png">  .  Those. <img src="https://habrastorage.org/files/508/56a/4dc/50856a4dce77416aa4505f61f98e7fd3.png">  , <img src="https://habrastorage.org/files/c1a/409/bcc/c1a409bcce6d449f96778d6c9855378e.png">  , <img src="https://habrastorage.org/files/5a6/776/d88/5a6776d889434febaea5fa1e90ea2e06.png">  , <img src="https://habrastorage.org/files/4be/492/06d/4be49206d90c437d9747b468cd4ce2a6.png">  . <br><br>  For clarity, we will measure the detection accuracy A in units of the corresponding <img src="https://habrastorage.org/files/bab/874/5da/bab8745da3f54f4fa045aef056e9e320.png">  .  The results of accuracy measurements are given below. <br><br><img src="https://habrastorage.org/files/e34/4e3/113/e344e311354b4c9588a26bc2cb45cca6.png"><br><br>  In the tests, we did not use md5 signatures from the ClamAV and LMD antivirus databases.  When a website is infected, malicious code is almost always either embedded in existing files, or modified from one infection to another.  This polymorphism is easy to implement when it comes to infecting websites.  In this case, the effectiveness of determining threats by checksums of files is extremely low, but at the same time it implies the calculation of these amounts for thousands of files on the site, which significantly reduces speed, almost without affecting the quality of detection. <br><br><h2>  Comparison of completeness definition </h2><br>  The second important parameter for antivirus is the completeness of the definition, i.e.  the number of detected threats from their total number on the infected server or site. <br><br>  Completeness in our analysis is closely related to the accuracy of the definition.  We will consider for comparison of completeness only exact (not false) anti-virus responses. <br><br>  Take the set of accurate anti-virus responses from the previous test: <img src="https://habrastorage.org/files/872/69b/0d3/87269b0d30474b5187177845b66ba3fc.png">  , <img src="https://habrastorage.org/files/e85/2e0/e53/e852e0e5353940e39adc62d1f83ddad0.png">  , <img src="https://habrastorage.org/files/01a/786/e09/01a786e09c0946d2838aa74d8d7964ae.png">  , <img src="https://habrastorage.org/files/e57/ccb/2d7/e57ccb2d7bb349f9bf04ae7036c06389.png">  - sets of precisely infected files, determined by each of the antiviruses separately when analyzing the same set of sites (W).  Believe that <img src="https://habrastorage.org/files/78c/43e/be0/78c43ebe00b340799fb64de6a3eb9bdf.png">  - this is a consolidated set of guaranteed infected files detected by antiviruses on a given test set of W sites. In other words, <img src="https://habrastorage.org/files/711/9f7/d66/7119f7d665644dce84d32bdaed43a943.png">  . <br><br><img src="https://habrastorage.org/files/211/838/48b/21183848b756450ca56fc3f01440004f.png"><br><br>  By the completeness of the definition (F) of the antivirus, we will call a subset of various guaranteed infected files identified by it on the combined set of files. <img src="https://habrastorage.org/files/78c/43e/be0/78c43ebe00b340799fb64de6a3eb9bdf.png">  .  Those. <img src="https://habrastorage.org/files/b65/ba6/02f/b65ba602fe284c659452129735174828.png">  , <img src="https://habrastorage.org/files/84b/816/6e1/84b8166e124f48649558651d58c3e599.png">  , <img src="https://habrastorage.org/files/ce2/752/7a8/ce27527a87094d4ba730bc9014630c58.png">  , <img src="https://habrastorage.org/files/009/d0d/f2f/009d0df2f63f4c07899f0dea49fbba26.png">  . <br><br><img src="https://habrastorage.org/files/5af/1d8/cbc/5af1d8cbca0d4baa90230c8b21ee8738.png"><br><br>  We measure the completeness of the definition of F in units <img src="https://habrastorage.org/files/78c/43e/be0/78c43ebe00b340799fb64de6a3eb9bdf.png">  .  So, this is what data we obtained when analyzing the completeness parameter for each of the antiviruses. <br><br><img src="https://habrastorage.org/files/3b7/a0f/eda/3b7a0feda4d648038d6048bcae7f692e.png"><br><br>  So, we compared the quality and completeness of detection of infections.  Now we will summarize in one table. <br><table><tbody><tr><td></td><td>  The completeness of the determination of F,% </td><td>  Accuracy of determination of A,% </td></tr><tr><td>  LMD </td><td>  11.86% </td><td>  60.52% </td></tr><tr><td>  Virusday </td><td>  78.87% </td><td>  92.72% </td></tr><tr><td>  Manul </td><td>  47.42% </td><td>  2.53% </td></tr><tr><td>  Clamav </td><td>  9.28% </td><td>  69.23% </td></tr></tbody></table><br>  When manually checking the files identified by antiviruses as infected, we found several interesting facts that I would like to mention separately.  Let's start with the number of files detected by each antivirus.  Manul found infected or suspicious files on almost every checked site.  We were very surprised when we considered that the proportion of files detected by them was 98% of the total number of files detected by all antiviruses. <br><br>  The trouble is that, as can be seen from the second diagram, only 2.5% of these files were actually infected.  The rest are false positives.  Although the completeness of his definition is quite high, such a number of false positives greatly complicates further manual analysis and treatment.  Analyzing the very anti-virus database Manul, we found out that it writes a sufficiently large number of frequently occurring secure code fragments into ‚Äúsuspicions‚Äù.  For example, the following occurrences are defined as suspicions: <code>file_put_contents</code> , <code>@file_get_contents</code> , <code>move_uploaded_file</code> , <code>ini_set</code> , <code>error_reporting</code> , <code>phpinfo</code> , <code>extract</code> , <code>@include</code> , <code>mail</code> , <code>touch</code> , <code>chdir</code> , <code>copy</code> , <code>create_function</code> and so on.  From this it follows that it is very difficult to write some serious PHP script in which Manul will not find suspicions. <br><br>  In part, this also applies to ClamAV.  He, for example, is looking for the occurrence of some simple English words and also defines them as infections.  LMD very often for some unknown reason finds viruses in the zip.lib.php library found on many sites.  It is specifically defined as the infection of such a piece of code: <br><br><pre> <code class="php hljs">$fr .= <span class="hljs-string"><span class="hljs-string">"\x00\x00"</span></span>;</code> </pre><br>  The reasons for this are unknown.  And such examples can still be found quite a lot.  Virusday is also not sinless.  It happens that he finds suspicious (for example, obfuscated) code in a file that is not malicious.  Obfuscation can also be used to protect programs, and not just to hide malicious codes.  But despite this, its completeness of definition surpasses other web antiviruses. <br><br>  Our comparison, as written at the beginning of the article, is still ‚Äúalmost impartial‚Äù for several reasons.  We conducted tests on websites, that is, we looked for viruses only in web scripts.  In this regard, we did not process md5 signatures (for the reasons described above).  ClamAV is also a more versatile threat finder, designed not only for websites. <br><br><h2>  Comparison of the quality of treatment </h2><br>  We dealt with detection.  Let us find out how completely antiviruses detect a fragment of malicious code in a file.  It is important for the organization of treatment.  It will not be very good if the file found by the antivirus deletes the code fragment suddenly becomes inoperative, and as a result, the site itself often stops functioning.  Of course, there are entire malicious files, but now we are considering cases where the malicious code is embedded in a good file and you cannot completely delete all its contents. <br><br>  Let us analyze this parameter by the example of the malicious code that the compared antiviruses detected.  In our example, the code had the following content: <br><br><img src="https://habrastorage.org/files/d12/a12/781/d12a127811374cc6922ba4b41f359355.png"><br><br>  LMD identifies it as malicious by the occurrence of such a piece of code: <br><br><pre> <code class="php hljs">= <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($i=<span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; strlen($</code> </pre><br>  By itself, this piece of code can hardly be called malicious, and it may well occur in normal scripts. <br><br>  Manul defines it as malicious by the occurrence of such a site: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">eval</span></span>(</code> </pre><br>  As we already wrote, Manul considers a lot of things dangerous.  The use of many built-in PHP functions is present in almost every script and there is no point in raising an alarm only about this, it only complicates the analysis of scan reports. <br><br>  ClamAV did not find anything in this code. <br><br>  Virusday could find this code entirely.  Accordingly, this code can be safely removed from the file, which is not the case with other antiviruses. <br><br>  Take another example with a code like this: <br><br><img src="https://habrastorage.org/files/c5c/2d4/828/c5c2d482841a4bb0bff2ae16526002c7.png"><br><br>  He found all 4 antivirus. <br><br>  LMD found such a site: <br><br><pre> <code class="php hljs">_<span class="hljs-string"><span class="hljs-string">']=Array(base64_decode('</span></span></code> </pre><br>  Doubtful, but has the right to life. <br><br>  Clamav: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> $GLOBALS[<span class="hljs-string"><span class="hljs-string">'_433305846_'</span></span>]=<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(base64_decode(<span class="hljs-string"><span class="hljs-string">''</span></span> .<span class="hljs-string"><span class="hljs-string">'ZG'</span></span> .<span class="hljs-string"><span class="hljs-string">'Vma'</span></span> .<span class="hljs-string"><span class="hljs-string">'W5l'</span></span>),base64_decode(<span class="hljs-string"><span class="hljs-string">'ZmlsZV9n'</span></span> .<span class="hljs-string"><span class="hljs-string">'ZXRfY2'</span></span></code> </pre><br>  Good, but ClamAV is looking for this code by exact entry.  He will not be able to find this code at the slightest change upon re-infection.  But this type of virus is rarely found in this form, and most likely when infecting another site, the code will look slightly different. <br><br>  Manul found this: <br><br><pre> <code class="php hljs">$GLOBALS[<span class="hljs-string"><span class="hljs-string">'_433305846_'</span></span>]=<span class="hljs-keyword"><span class="hljs-keyword">Array</span></span>(base64_decode(<span class="hljs-string"><span class="hljs-string">''</span></span> .<span class="hljs-string"><span class="hljs-string">'ZG'</span></span> .<span class="hljs-string"><span class="hljs-string">'Vma'</span></span> .<span class="hljs-string"><span class="hljs-string">'W5l'</span></span>),base64_decode(<span class="hljs-string"><span class="hljs-string">'ZmlsZV9n'</span></span> .<span class="hljs-string"><span class="hljs-string">'ZXRfY2'</span></span> .<span class="hljs-string"><span class="hljs-string">'9udGVudH'</span></span> .<span class="hljs-string"><span class="hljs-string">'M='</span></span>)</code> </pre><br>  It is also good, especially since any kind of this code will also be found by him, since the search is performed on a fairly complex regular expression, covering all varieties of this code. <br><br>  But in no case can the found code be cut from the file.  The virus also defines all this code from beginning to end as malicious and can cut it without serious consequences during treatment.  In general, file disinfection (meaning not deleting a file, but cutting a malicious area from a file) is not available in all these antiviruses.  Virusesday also can cure not everything, but a lot. <br><br>  You might think that we specifically could take such examples of viruses that are not treated by other antivirus.  This is not true.  We just tried to choose examples that most clearly show the difference in the quality of treatment.  In principle, almost any example that we could take would show the same thing, but not so clearly.  We analyzed the antivirus databases of all antiviruses, and almost all the signatures in these databases detect certain small sections of the code without covering the entire virus body. <br><br><h2>  Instead of output </h2><br>  ClamAV does not know how to treat.  LMD, ClamAV and Manul are free server utilities, and <a href="https://virusdie.ru/">Virusday</a> is a paid SaaS with support and firewall.  We will not discuss the functionality and usability of each antivirus in this article, since they have many differences, and we will limit ourselves only to a comparison of the anti-virus databases.  Dry statistics speak better than an abundance of empty words.  And besides, everyone is free to choose his own tool for the soul and needs. </div><p>Source: <a href="https://habr.com/ru/post/263785/">https://habr.com/ru/post/263785/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263775/index.html">Algorithm for parsing arithmetic expressions</a></li>
<li><a href="../263777/index.html">VMware vSphere 5.5 and 6.0 performance - settings, considerations. Performance best practices</a></li>
<li><a href="../263779/index.html">Fujitsu PRIMEQUEST: standard platform with mainframe reliability</a></li>
<li><a href="../263781/index.html">Choosing a plugin for caching WordPress: benchmarking 18 plugins</a></li>
<li><a href="../263783/index.html">Spy stuff in Wolfram Language, or how to hide anything in the picture</a></li>
<li><a href="../263789/index.html">New Intercepter-NG 0.9.10 Review</a></li>
<li><a href="../263791/index.html">Globals are Cossack swords for data storage. Trees Part 1</a></li>
<li><a href="../263793/index.html">Have you changed $ Increment to $ Sequence?</a></li>
<li><a href="../263795/index.html">How many days does the developer shake?</a></li>
<li><a href="../263797/index.html">Modern Adaptec RAID controllers from A to Z. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>