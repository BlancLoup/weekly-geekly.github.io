<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create a video library with PHPixie</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After my previous post about choosing a light framework, I googled and saw that for some of them there is not a single Russian-language tutorial. So I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create a video library with PHPixie</h1><div class="post__text post__text-html js-mediator-article"><img src="http://habr.habrastorage.org/post_images/0e4/1b7/99a/0e41b799acefe6f341147b143300ebcd.png" alt="image" align="right"><br>  After my previous post about choosing a light framework, I googled and saw that for some of them there is not a single Russian-language tutorial.  So I decided to write a series of posts in order to fill this niche.  I think it is worth starting with those that I stopped at the end of, and since quite a lot has already been written for Silex, this post will be devoted to PHPixie. <br><br>  For those who have not read my comparison of frameworks, <a href="http://phpixie.com/" title="PHPixie PHP Framework">PHPixie</a> is small and by my standards is a very fast framework with a modular structure, well implemented by DI, lack of statics and simple architecture. <br><a name="habracut"></a><br><br>  On the official website, all the tutorials are written using the example of fairies, but I will try to be original and we will create a library of videos from Youtube.  That is, we can add, delete and view the video.  And on the way, we will learn to use the API of the YouTube itself to get meta information and tambneils. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Project creation </h4><br>  PHPixie can be installed either using Composer or by downloading the finished system snapshot from the site.  Almost no difference, as snapshot is regularly updated and is a basic project with three libraries installed (core, db and orm).  For simplicity, we will use the second method, link to snapshot here <a href="">phpixie.com/phpixie.zip</a> .  The server must be configured on the <i>/ web /</i> folder within the project.  That's all, now we can go to our host and see a small greeting. <br><br><h4>  $ Pixie object </h4><br>  The $ pixie object is the implementation of the DI Container and Service Locator, something similar to the $ app in Silex.  It is available as a controller controller and is passed to almost every constructor, $ pixie also contains factor methods for each class of the framework.  Proper use of it allows you to completely avoid linking classes and therefore simplify testing.  Unlike Silex, adding methods and transferring them to $ pixie happens only by extending the class.  The base project already has an App \ Pixie class that inherits from PHPixie \ Pixie, and we can add our code to it in order to have access to it everywhere.  It should be noted that this is not a singleton and it is necessary to pass it between classes explicitly, this approach was chosen to avoid any global state in the code, like the framework never uses static methods.  Each module, for example, db or orm supplies its class with factor methods, these classes are written in our App \ Pixie in $ modules.  Then we can request them as a property, for example, using $ pixie-&gt; db-&gt; query () and $ pixie-&gt; orm-&gt; get (), which introduces additional structuredness and makes it possible to avoid soup from the methods.  In our case, we don‚Äôt need to change anything in App \ Pixie. <br><br><h4>  Database </h4><br>  We will use only one unpretentious plate for storing information about the video, here is its structure: <br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`videos`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INT</span></span>(<span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`video_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`title`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>) );</code> </pre> <br><br>  Now we register the connection settings to the database in <i>/assets/config/db.php</i> , for example: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'default'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'user'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'root'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'driver'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'PDO'</span></span>, <span class="hljs-string"><span class="hljs-string">'connection'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'mysql:host=localhost;dbname=videos'</span></span> ) );</code> </pre><br>  here, I think everything is quite trivial. <br><br><h4>  Model </h4><br>  Any MVC structure begins with a model, in our case it is only one, Video.  Anyone familiar with Kohana will immediately feel at home, to create a model, simply expand the class <i>\ PHPixie \ ORM \ Model</i> : <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Model</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Video</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPixie</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ORM</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span></span>{}</code> </pre><br>  Binding to the table by default occurs based on the class name.  In our case, the way it is and do not need to change anything.  Access to the model can be obtained using $ pixie.  Brightest code examples: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   $video = $pixie-&gt;get('video'); $video-&gt;title = 'Test'; $video-&gt;save(); // $video = $pixie-&gt;get('video')-&gt;where('title','Test')-&gt;find(); //  $videos = $pixie-&gt;get('video')-&gt;find_all();</span></span></code> </pre><br><br><h4>  Basic markup </h4><br>  In the basic project that we downloaded, there is a controller subtype, App \ Pixie class.  His job is to render the main.php template available as per view $ view.  Our controllers simply transfer different data to this template, including $ subview ‚Äî the name of the sub-template to insert.  I just really liked the fact that the logic of how the master pages and subpatterns work is not spelled out in the framework itself, but is put into the project itself, which allows you to remake it at your discretion.  Our main.php will look something like this: <br><pre> <code class="php hljs">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;link href=<span class="hljs-string"><span class="hljs-string">"//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.0/css/bootstrap-combined.min.css"</span></span> rel=<span class="hljs-string"><span class="hljs-string">"stylesheet"</span></span>/&gt; &lt;/head&gt; &lt;body&gt; &lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">container</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">row</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">offset3</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">span6</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h2</span></span></span><span class="hljs-class">&gt;&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">href</span></span></span><span class="hljs-class">="/"&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPixie</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Vids</span></span></span><span class="hljs-class">&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h2</span></span></span><span class="hljs-class">&gt; &lt;!--    --&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">inline</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">method</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">post</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">action</span></span></span><span class="hljs-class">="/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">videos</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">add</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">input</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">text</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">placeholder</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Paste</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Link</span></span></span><span class="hljs-class">‚Ä¶" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">url</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">submit</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">btn</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">btn</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">primary</span></span></span><span class="hljs-class">"&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Add</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">row</span></span></span><span class="hljs-class">"&gt; &lt;!--   --&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">subview</span></span></span><span class="hljs-class">.'.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class">'); ?&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">body</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">html</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre><br><br>  We have only two sub-templates: list.php (for the list of added videos) and view.php (for viewing the selected video).  Here they are: <br><pre> <code class="php hljs">&lt;!-- /assets/views/<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.php --&gt; &lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">offset3</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">span6</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ul</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">thumbnails</span></span></span><span class="hljs-class">"&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foreach</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">videos</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">as</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">video</span></span></span><span class="hljs-class">):?&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">li</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">span3</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">thumbnail</span></span></span><span class="hljs-class">" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">href</span></span></span><span class="hljs-class">="/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">videos</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">view</span></span></span><span class="hljs-class">/&lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">video</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">; ?&gt;"&gt; &lt;!--         --&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">img</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">src</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">://</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">img</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">youtube</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vi</span></span></span><span class="hljs-class">/&lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">video</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">video_id</span></span></span><span class="hljs-class">;?&gt;/0.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">jpg</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">caption</span></span></span><span class="hljs-class">"&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h3</span></span></span><span class="hljs-class">&gt;&lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">video</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">;?&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">h3</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">a</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">li</span></span></span><span class="hljs-class">&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">endforeach</span></span></span><span class="hljs-class">;?&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ul</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre><br><br><pre> <code class="php hljs">&lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">offset3</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">span6</span></span></span><span class="hljs-class">"&gt; &lt;!--        --&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">iframe</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">width</span></span></span><span class="hljs-class">="420" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">height</span></span></span><span class="hljs-class">="345" </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">src</span></span></span><span class="hljs-class">="</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">http</span></span></span><span class="hljs-class">://</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">www</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">youtube</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">embed</span></span></span><span class="hljs-class">/&lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">video</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">video_id</span></span></span><span class="hljs-class">; ?&gt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rel</span></span></span><span class="hljs-class">=0&amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">autoplay</span></span></span><span class="hljs-class">=1"&gt;&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">iframe</span></span></span><span class="hljs-class">&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre><br><br><h4>  Routing </h4><br>  I know that you were already waiting for the code itself, but before we go to the controller, we need to register it in /assets/config/routes.php.  In fact, only one route is registered in the basic project and it looks like <i>/ controller / method / id</i> , which basically suits us, but it would be very useful to change the default controller from Hello to our Videos. <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'default'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'(/&lt;controller&gt;(/&lt;action&gt;(/&lt;id&gt;)))'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-comment"><span class="hljs-comment">//   'controller' =&gt; 'Videos', 'action' =&gt; 'index' ) ), );</span></span></code> </pre><br><br><h4>  Controller </h4><br>  Since we need 3 pages in the controller there should be 3 methods.  This is where we begin: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Videos</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> \</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class">\</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Page</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action_index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;subview = <span class="hljs-string"><span class="hljs-string">'list'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;view-&gt;videos = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pixie-&gt;orm-&gt;get(<span class="hljs-string"><span class="hljs-string">'video'</span></span>)-&gt;find_all(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action_add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;redirect(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    } public function action_view(){ $this-&gt;view-&gt;subview = 'view'; // id  URL: /video/view/3 $id = $this-&gt;request-&gt;param('id'); $this-&gt;view-&gt;video = $this-&gt;pixie-&gt;orm-&gt;get('video') -&gt;where('id', $id) -&gt;find(); } }</span></span></code> </pre><br>  The tasks of selecting all and one video are trivial. <br>  Consider now adding a new video.  The video identifier in the YouTube link is passed to the 'v' parameter, for example <a href="http://www.youtube.com/watch%3Fv%3D75nBenOWul0">www.youtube.com/watch?v=75nBenOWul0</a> , we can get it in many ways, but it seemed to me to be the most accurate using parse_url (), like this: <br><pre> <code class="php hljs">parse_str(parse_url( $url, PHP_URL_QUERY ), $vars ); $video_id = $vars[<span class="hljs-string"><span class="hljs-string">'v'</span></span>];</code> </pre><br>  You can get information about the video, in our case its name, using the API via the link <a href="http://youtube.com/get_video_info%3Fvideo_id%3D">youtube.com/get_video_info?video_id=</a> &lt;video id&gt;.  Using this knowledge, we can now add the missing action_add (): <br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">action_add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($url = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;post(<span class="hljs-string"><span class="hljs-string">'url'</span></span>)){ parse_str(parse_url( $url, PHP_URL_QUERY ), $vars ); $video_id = $vars[<span class="hljs-string"><span class="hljs-string">'v'</span></span>]; $response = file_get_contents(<span class="hljs-string"><span class="hljs-string">"http://youtube.com/get_video_info?video_id="</span></span>.$video_id); parse_str($response, $data); $video = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pixie-&gt;orm-&gt;get(<span class="hljs-string"><span class="hljs-string">'video'</span></span>); $video-&gt;title = $data[<span class="hljs-string"><span class="hljs-string">'title'</span></span>]; $video-&gt;video_id = $video_id; $video-&gt;save(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;redirect(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); }</code> </pre><br><br>  And voila!  Here is the way a screenshot of the result: <br><img src="https://habrastorage.org/getpro/habr/post_images/330/00c/cd0/33000ccd0fef33eb00c87e8517a190f1.png" alt="image"><br><br>  If you were expecting a more complex controller or configuration, they are not there, and the framework itself is almost negligible, this allows you to concentrate on writing your code instead of studying someone else. <br>  I hope you liked the post, and another time we will learn to write on Lithium. </div><p>Source: <a href="https://habr.com/ru/post/178899/">https://habr.com/ru/post/178899/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../178887/index.html">Win a free participation in DEVCONF 2013, the creative opens the door for you!</a></li>
<li><a href="../178889/index.html">JavaOne Russia or Kuksenko‚Äôs benefit performance with Shipilev. Conference report</a></li>
<li><a href="../178891/index.html">Physics teacher using Google Glass held a lesson from CERN</a></li>
<li><a href="../178893/index.html">Renee James and Brian Krzanich - new "first persons" of Intel</a></li>
<li><a href="../178895/index.html">Helvetica World, Competition and Event for Designers</a></li>
<li><a href="../178901/index.html">Let there be Unity in your city</a></li>
<li><a href="../178903/index.html">A simple FM radio transmitter based on FPGA</a></li>
<li><a href="../178905/index.html">Optimistic programmers</a></li>
<li><a href="../178915/index.html">Software synthesizer</a></li>
<li><a href="../178917/index.html">Yii2. Acquaintance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>