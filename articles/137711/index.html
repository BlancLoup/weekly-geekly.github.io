<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New iOS 5 File Policy and Wacker History</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, habrasoobschestvo! 

 I decided to split this article into two parts - the first will be about the NEP New File Policy and the cleaning of t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New iOS 5 File Policy and Wacker History</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/b16/1a5/3df/b161a53df5e4ff87de198e2e093d228c.png"><br><br>  Good day, habrasoobschestvo! <br><br>  I decided to split this article into two parts - the first will be about the <s>NEP</s> New File Policy and the cleaning of the favorite Documents folder, i.e.  useful iOS-developer information (it seems they haven‚Äôt written about it yet on Habr√©).  The information is very useful if you want to save nerves, time and money when filling in an update / new application on the AppStore, so I recommend reading it to everyone. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the second, I will talk about the war with the first line of Epple technical support and watchman syndrome, but it is rather narrative and does not need to be read. <br><a name="habracut"></a><br><h1>  Where to write files now? </h1><br>  In any tutorial / manual for iOS 3.x-4.x it was written in English in white - create a method like <br><br><pre><code class="hljs objectivec">+ (<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *) pathForDocuments { <span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *paths = <span class="hljs-built_in"><span class="hljs-built_in">NSSearchPathForDirectoriesInDomains</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">NSDocumentDirectory</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">NSUserDomainMask</span></span>, <span class="hljs-literal"><span class="hljs-literal">YES</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [paths objectAtIndex:<span class="hljs-number"><span class="hljs-number">0</span></span>]; }</code> </pre> <br>  And write everything there - the base, cache, pictures downloaded from the Internet - in general, all that pleases.  With the introduction of the iCloud service in iOS 5.0, Apple changed the policy due to the fact that both iTunes and iCloud make full backups of the Documents folder <br><br>  Let me explain with an example - for example, you bought an iPhone and your favorite child, and after long tears, threats and persuasion, an iPad.  A happy child immediately installed Angry Birds, but what a bad luck - I went through the school under the desk as much as two level packs, and on my home ipad, with which it is so wonderful to roll under a blanket after the end, while the dad does not see, you need to go through everything again. <br><br>  But do not worry, baby!  Wonderful iCloud synchronized your Documents folder, and now the newly opened Golden Eggs are available to you and under the covers!  Now in HD. <br><br>  If your application works according to this principle, then nothing needs to be changed.  As stated in the rules of Apple, the content created by the user (user-generated content) is the most holy and Orthodox type of data and is subject to synchronization.  But consider another example. <br><br>  Such a phenomenon, in particular, is observed with Lingvo dictionaries.  According to Apple‚Äôs commandments, the content that can be programmatically recreated or downloaded again from the Internet is strictly forbidden to be placed in Documents (for this, Reject is supposed).  Instead, they should be placed in Library / Caches, from which the system, if there is not enough disk space, will immediately demolish them.  The script is more common than you might think - it is worth downloading a couple of German HD movies on the iPad for evening viewing from your favorite, and the German-French dictionary is like it never happened - you will have to download it over 3G on the way to work.  In the underground. <br><br>  Naturally, the developers began to be outraged - the user does not want to use the program, from which the content, inflated with expensive megabytes of cellular tariff disappears.  To do this, already in 5.0.1, Apple added the attribute Do Not Backup - you should put it on any file or folder in Documents, and iCloud, along with iTunes, will ignore them.  At the same time, the system will not have the right to delete them if there is a shortage of free space, i.e.  everything will remain as in the old fashioned way.  In the code it looks like this (taken from an <a href="https://developer.apple.com/library/ios/">official source</a> ): <br><br><pre> <code class="hljs rust">#include &lt;sys/xattr.h&gt; - (BOOL)addSkipBackupAttributeToItemAtURL:(NSURL *)URL { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>* filePath = [[URL path] fileSystemRepresentation]; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>* attrName = <span class="hljs-string"><span class="hljs-string">"com.apple.MobileBackup"</span></span>; u_int8_t attrValue = <span class="hljs-number"><span class="hljs-number">1</span></span>; int result = setxattr(filePath, attrName, &amp;attrValue, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(attrValue), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result == <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><br>  BUT - <u>essential</u> but - the need to store them in Documents will still need to be proved during a review (the point about the fact that without these files the user experience of the application collapses, needs to be justified).  Of course, the reviewers do not add up to all - I witnessed how 2 weeks ago they missed an application that violated their rules, but the size of the files was scanty - no more than ten kilobytes.  If your application needs dozens or even hundreds of megabytes - wait for quibbles and attacks, even if you update, and do not flood the application from scratch.  Although it happens that after five or more days of waiting Apple doesn‚Äôt launch your application at all before appruv - thanks to Apple for that. <br><br>  That's all for useful information, be sure to read the <a href="https://developer.apple.com/icloud/documentation/data-storage/">official rules</a> - there are few letters, but they will save you a lot of nerves. <br><br><h1>  How to do </h1><br>  But all the problems could have been avoided if they just added a new folder to the file system, without affecting the old ones.  For example, they would create a synchronized folder, where they would order to place saved games, favorite pages of readers and credits to the mail - and everyone who needs it would add the necessary pair of methods.  Here is with Steve ... <br><br><h1>  How to deal with Reject </h1><br>  This will be useful only to those who have already encountered this problem.  So, I come to work early in the morning and I see that the application has been registered.  I read the <a href="https://developer.apple.com/icloud/documentation/data-storage/">holy tables</a> to which the reviewer referred - and indeed, violated the commandments No. 1 and No. 2.  But, after reading # 4, I understand that there is a loophole after all.  A couple of minutes to add a code, 2 hours to QA testing, and we resubmit the application, accompanying it with a comment that we need our files ‚Äú.  Which, by the way, was pure truth. <br><br>  Two days later, the second redjection comes in from Apple in the style: <br><blockquote>  Thank you for your reply. <br>  // quote from the second paragraph about the inadmissibility of non-user-generated content </blockquote><br>  The customer was anally anxious, but I decided to take them in vain - I wrote out in detail, half a page, the purpose of each file, each small daddy, asked not to refer to clause 2, but clause 4. The customer also added a new answer after 3 days : <br><blockquote>  Thank you for your reply. <br>  // quote from the second paragraph about the inadmissibility of non-user-generated content </blockquote><br>  The customer panicked, every day, 3 times I began to receive letters of content: <br><br><blockquote>  I don‚Äôt take it lightly. <br>  But your refusal is disappointing and frustrating. </blockquote><br>  Or better yet <br><blockquote>  I'm not going to pay for lost time.  And every client will be deducted from such invoices.  You leave me no choice. </blockquote><br>  In general, thousands of them, but is not the point. <br><br>  Given the speed of responses from Apple (every 2-3-4 days), the situation was heating up.  The impression was that the reviewer was referring to the fourth paragraph of the tablets, focusing on the copy-paste of the first three. <br><br>  It should be added that we wrote to the Resolution Center, describing our situation in different words, but each time we received the same devil-may-care answer.  I don‚Äôt remember exactly who had the idea, but we wrote the same thing, with attached correspondence, to <a href="http://developer.apple.com/support/technical/submit/">technical support</a> , and after 3 days we suddenly got apruv. <br><br>  Having read <blockquote>  Yay!  WE ARE SO HAPPY AND EXCITED.  THANKS FOR ALL YOUR HARD WORK!  (EVEN WITH THOSE <b>IDIOTS</b> IN THE REVIEW PROCESS) </blockquote>  with peace of mind I went to drink beer with valerian. <br><br><h1>  Summary </h1><ul><li>  Always read the Apple policy updates and follow them whenever possible. </li><li>  If your application contains some features (be it a large sandbox, need to work offline, tricky optimization) - do not take the time to describe all this in the ‚ÄúReview Notes‚Äù field in iTunes connect. </li><li>  When rejecting an application with a question is more complicated than an incorrect application name, always write immediately to the support service - correspondence with the reviewer through the resolution center is a waste of time.  So I see a housewife of Indian origin on the other end of the Internet. </li></ul>  Good luck to you and your applications, and may an appruv arrive with you! </div><p>Source: <a href="https://habr.com/ru/post/137711/">https://habr.com/ru/post/137711/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137704/index.html">Pitfalls in Project Voldemort</a></li>
<li><a href="../137705/index.html">CSS3. Work with multiple backgrounds</a></li>
<li><a href="../137707/index.html">Improving pictures in Skype chat (updated)</a></li>
<li><a href="../137708/index.html">Streaming audio</a></li>
<li><a href="../137710/index.html">Profiling module "ProfilerToolbar"</a></li>
<li><a href="../137712/index.html">Hi, Habr!</a></li>
<li><a href="../137713/index.html">5 online courses in Russian on private and public clouds</a></li>
<li><a href="../137716/index.html">The use of vacuum fluorescent indicator</a></li>
<li><a href="../137719/index.html">MSP430, learn to program and debug hardware (part 3)</a></li>
<li><a href="../137720/index.html">Yota antenna do it yourself</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>