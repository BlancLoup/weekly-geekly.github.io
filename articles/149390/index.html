<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SQLite is a great embedded database (part 2)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 1 
 Part 3 

 This part will address the difficult issues of using SQLite through working with its programming interface (API). 



 What is the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SQLite is a great embedded database (part 2)</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/post/149356/">Part 1</a> <br>  <a href="http://habrahabr.ru/post/149635/">Part 3</a> <br><br>  This part will address the difficult issues of using SQLite through working with its programming interface (API). <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What is the SQLite API?  This is the C function set of <i>sqlite3_XXX</i> . <br><br>  The headers of these functions are in sqlite3.h, and the description of the API in the form of one large HTML is <a href="http://www.sqlite.org/capi3ref.html">here</a> . <br><br>  We will begin to use the API, and later we will gradually move on to wrapping it in a cozy framework. <br><br>  Let's try to create a small project in C ++ (I did in MS Visual Studio) that does something with the SQLite database. <br><br>  There are two ways to use SQLite in your project. <br><br>  "Compile" code (if it is C or C ++).  Or download and use sqlite3.dll (makes it easy to update SQLite and is not tied to the language). <br><br>  In any case, you need to create a new project (console) application (I used MS Visual Studio) and add the following main.cpp to it: <br><br><blockquote><br>  <font color="#339933">#include &lt;stdio.h&gt;</font> <br>  <font color="#339933">#include "sqlite3.h"</font> <br><br>  <font color="#993333">const</font> <font color="#993333">char</font> <font color="#339933">*</font> SQL <font color="#339933">=</font> <font color="#ff0000">"CREATE TABLE IF NOT EXISTS foo (a, b, c); INSERT INTO FOO VALUES (1,2,3); INSERT INTO FOO SELECT * FROM FOO;"</font>  <font color="#339933">;</font> <br><br>  <font color="#993333">int</font> main <font color="#009900">(</font> <font color="#993333">int</font> argc <font color="#339933">,</font> <font color="#993333">char</font> <font color="#339933">**</font> argv <font color="#009900">)</font> <font color="#009900">{</font> <br><br>  sqlite3 <font color="#339933">*</font> db <font color="#339933">=</font> <font color="#0000dd">0</font> <font color="#339933">;</font>  <font color="#666666">// handle of the object connection to the database</font> <br>  <font color="#993333">char</font> <font color="#339933">*</font> err <font color="#339933">=</font> <font color="#0000dd">0</font> <font color="#339933">;</font> <br><br>  <font color="#666666">// open connection</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> sqlite3_open <font color="#009900">(</font> <font color="#ff0000">"my_cosy_database.dblite"</font> <font color="#339933">,</font> <font color="#339933">&amp;</font> db <font color="#009900">)</font> <font color="#009900">)</font> <br>  fprintf <font color="#009900">(</font> stderr <font color="#339933">,</font> <font color="#ff0000">"Error opening / creating database:% s \ n"</font> <font color="#339933">,</font> sqlite3_errmsg <font color="#009900">(</font> db <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#666666">// execute SQL</font> <br>  <font color="#b1b100">else</font> <font color="#b1b100">if</font> <font color="#009900">(</font> sqlite3_exec <font color="#009900">(</font> db <font color="#339933">,</font> SQL <font color="#339933">,</font> <font color="#0000dd">0</font> <font color="#339933">,</font> <font color="#0000dd">0</font> <font color="#339933">,</font> <font color="#339933">&amp;</font> err <font color="#009900">)</font> <font color="#009900">)</font> <br>  <font color="#009900">{</font> <br>  fprintf <font color="#009900">(</font> stderr <font color="#339933">,</font> <font color="#ff0000">"SQL Error:% sn"</font> <font color="#339933">,</font> err <font color="#009900">)</font> <font color="#339933">;</font> <br>  sqlite3_free <font color="#009900">(</font> err <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#666666">// close the connection</font> <br>  sqlite3_close <font color="#009900">(</font> db <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">return</font> <font color="#0000dd">0</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br></blockquote><br><br>  Further, if we want to build a project with SQLite code, then we need: <br><br>  - download the source code in the form of <a href="">amalgamation</a> ; <br>  - extract sqlite3.h and sqlite3.c from it and add them to the project. <br><br>  If we want to use sqlite3.dll, we need: <br><br>  - download <a href="">SQLite DLL</a> and unzip; <br>  - execute ‚ÄúLIB.EXE / DEF:sqlite3.def‚Äù in the folder where it was unpacked to get sqlite3.lib (make sure that the paths to lib.exe are registered via the vcvars32.bat call); <br>  - include in the project sqlite3.lib; <br>  - download <a href="">amalgamation</a> and extract sqlite3.h from it; <br>  - include in the project sqlite3.h; <br><br>  Compile, execute (in the second case, the DLL must be accessible to the executable file). <br><br>  When you first start, the file "my_cosy_database.dblite" from the database will be created, in it - one table and two entries in it. <br>  On subsequent launches, the program will join the already existing database and double the number of records in the table. <br><br>  Let's deal with the project code. <br><br>  Using SQLite assumes that we want to execute commands in the SQL language in some database (your KO!). <br><br>  You can imagine working with SQLite database as working with files in Windows.  We open the file and get the _handle_ file to which a certain system object (file) is ‚Äúattached‚Äù.  By passing this handle to various functions, we ask the system to do something with the file.  Then - close the file.  Also in SQLite.  We open the file from the database and get the handle of the ‚Äúconnection to the database‚Äù object.  Then we execute certain SQL commands through calls to functions that receive this handle, and, at the end, close the connection. <br><br>  As we can see, there is nothing original, special or cunning. <br><br>  SQLite DB file extension is not standardized.  Some make it ".sqlite3", but you can put any. <br><br>  Function <br><br><blockquote>  <font color="#993333">int</font> sqlite3_open <font color="#009900">(</font> <br>  <font color="#993333">const</font> <font color="#993333">char</font> <font color="#339933">*</font> filename <font color="#339933">,</font> <font color="#808080">/ * Database filename (UTF-8) * /</font> <br>  sqlite3 <font color="#339933">**</font> ppDb <font color="#808080">/ * OUT: SQLite db handle * /</font> <br>  <font color="#009900">)</font> <font color="#339933">;</font> <br></blockquote><br>  creates or opens a database in the specified file (UTF-8!) and puts the connection handle in db.  It returns 0 (success) or an error code.  The closing sqlite3_close call is needed anyway (even with the sqlite3_open error). <br><br>  Function <br><br><blockquote>  <font color="#993333">int</font> sqlite3_exec <font color="#009900">(</font> <br>  sqlite3 <font color="#339933">*,</font> <font color="#808080">/ * An open database * /</font> <br>  <font color="#993333">const</font> <font color="#993333">char</font> <font color="#339933">*</font> sql <font color="#339933">,</font> <font color="#808080">/ * SQL to be evaluated (UTF-8) * /</font> <br>  <font color="#993333">int</font> <font color="#009900">(</font> <font color="#339933">*</font> callback <font color="#009900">)</font> <font color="#009900">(</font> <font color="#993333">void</font> <font color="#339933">*,</font> <font color="#993333">int</font> <font color="#339933">,</font> <font color="#993333">char</font> <font color="#339933">**,</font> <font color="#993333">char</font> <font color="#339933">**</font> <font color="#009900">)</font> <font color="#339933">,</font> <font color="#808080">/ * Callback function * /</font> <br>  <font color="#993333">void</font> <font color="#339933">*,</font> <font color="#808080">/ * 1st argument to callback * /</font> <br>  <font color="#993333">char</font> <font color="#339933">**</font> errmsg <font color="#808080">/ * Error msg written here * /</font> <br>  <font color="#009900">)</font> <font color="#339933">;</font> <br></blockquote><br><br>  executes a SQL command (consisting of one or more SQL statements in UTF-8, separated by ";") in the context of the specified (open) database connection. <br><br>  The callback function and the custom argument to it are needed if SELECT is made (to retrieve data).  More on this later, while not using. <br><br>  In the errmsg parameter, you can get the error text and later clear it with sqlite3_free.  If we pass NULL here, we won‚Äôt get the error text. <br><br>  Like sqlite3_open, 0 or an error code is returned. <br><br>  The ‚ÄúCREATE TABLE‚Äù command contains the ‚ÄúIF NOT EXISTS‚Äù clarification.  This means that the table is created if it is not.  If there is, then nothing happens (and there is no error). <br><br>  Actually, that's all.  Despite the fact that in real projects neither sqlite3_open (there is a more powerful call sqlite3_open_v2), nor sqlite3_exec (usually used a bunch of SQL-compiling calls, binding parameters, etc.) are used, this is a working project. <br><br>  He has another important mission.  As already mentioned, each time it starts, it doubles the number of rows in the foo table.  After 20 starts in the table there will be ~ 2 million records. <br><br>  Those.  The 21st launch inserts ~ 2 million records. <br><br>  On my machine (Windows 7 x64, i5 2.8 Ghz, HDD, not SSD) it took ~ 15 seconds.  Let this poor and synthetic test, but it still gives a certain idea about the performance of SQLite. <br><br>  <i>To be continued.</i> </div><p>Source: <a href="https://habr.com/ru/post/149390/">https://habr.com/ru/post/149390/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149384/index.html">An unpleasant std :: list feature that not everyone knows</a></li>
<li><a href="../149385/index.html">Home Office Ideas</a></li>
<li><a href="../149386/index.html">Tectonic plates found on Mars</a></li>
<li><a href="../149388/index.html">ImageCMS 3.3.6.72 release and major company news</a></li>
<li><a href="../149389/index.html">Phishing site advertising in Yandex.Direct and fake Skype</a></li>
<li><a href="../149391/index.html">Business analysis in the social network Odnoklassniki</a></li>
<li><a href="../149392/index.html">A bit of fire on pure CSS (Firefox)</a></li>
<li><a href="../149396/index.html">Zxcvbn program: realistic password strength assessment</a></li>
<li><a href="../149397/index.html">Browser API for registering on the site and making instant payments</a></li>
<li><a href="../149399/index.html">How income is distributed between applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>