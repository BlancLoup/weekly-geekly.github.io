<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Watchdog watching you (monitoring hosting)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Attention! This article for web-programmers - contains the sources and tech. details 

 Did you have such a thing - that a simple question plunged you...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Watchdog watching you (monitoring hosting)</h1><div class="post__text post__text-html js-mediator-article">  <i>Attention!</i>  <i>This article for web-programmers - contains the sources and tech.</i>  <i>details</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/65c/63a/e2f/65c63ae2f854da6a2dda220296dc4f12.jpg" alt="Guarding quality" align="left">  Did you have such a thing - that a simple question plunged you into a stupor and deep thoughts?  It happens to me every time when customers or friends ask me: <br><br><h4>  - Andrei, what kind of hosting would you recommend for our site? </h4><br>  And there is nothing to answer, because all (all!) Our measurements are not in favor of hosting companies, I will not even bring anyone specifically - you can check it yourself by following the recommendations in this article. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It would seem, where the dog is buried?  After all, for us hosting is one of the most favorite corns, which are often attacked, because we are SEO-optimizers.  We work - to bring our sites and clients to the tops, and poor and unstable hosting scares away the scanning robots of Yandex, Google and their ilk.  However, hosting often falls during the day, especially during peak loads around 18:00 due to the influx of onlookers on the Internet in the evening. <br><br>  Here is the simplest thing that happens - the site works fine during the day, while the support of the hoster is alert.  And at night, sometimes regularly "lies" in a knockdown.  For example, hoster scripts make backups and everything is overloaded.  Customers sleep, buyers sleep, the site is asleep.  Everyone is happy, except for search spiders. <br><br>  The first thing we did was buy our expensive server and took it to the Caravan (thanks to the guys for the excellent quality of the collocation).  But our server is not rubber, and we don‚Äôt provide hosting as a service.  Therefore, let all our and we can not. <br><br>  In order to somehow control the situation - I wrote a hosting stability monitor a couple of years ago.  Now, when we already have a lot of other competitive advantages - we are ready to lay out the source code and work algorithm for Habra sociality, which is what this post is about. <br><br><a name="habracut"></a><h4>  So, more to the point </h4><br>  The script is simple to ugliness, and the source is raw and uncombed, despite the help of our hax- <a href="http://habrahabr.ru/users/grox/" class="user_link">friend Grox</a> 'a.  Please do not kick much for this. <br><br>  So, <a href="">archive with sorts (PHP + MySQL), 11 kb zip</a> .  Everything is open, without obfuscators. <br><br><h5>  Fast start </h5><br>  1. We unpack the archive, download everything to our server, for example, my website / watchdog / <br>  2. Create a database for the dog (preferably a separate one), and execute the sql.txt sql file (or upload it to PHPMyAdmin) <br>  3. Register in the dbconnect.php file access to the database <br>  4. Register in grox_config_users.php yourself as a user (login, password) <br>  5. Go to my site / watchdog / and add the first - reference * site <br>  6. We set kroons to pull the nip.php script once every 5 or 20 minutes, for example, * / 10 * * * * / usr / bin / wget -q "your <a href="http://xn--80aae4a1bi2b.ru/watchdog/nip.php">site.ru / watchdog / nip.php</a> " <br>  7. Now we can add other sites to monitor <br>  8. A week later, we collect the first cream. <br>  9. ????? <br>  10. PROFIT <br><br>  Naturally, this way you can effectively monitor only other servers, but not your own. <br><br>  <i>* Reference (calibration) site is someone else's site with knowingly high-quality hosting (for example, they have many servers in different data centers).</i>  <i>The one we use will not be specifically mentioned, otherwise we will inadvertently ask :) It is needed in order to eliminate the error due to the brakes of our checking server itself.</i>  <i>How it works?</i>  <i>We read further.</i> <br><br><h5>  Database structure </h5><br><br>  bones - "bones", the result of biting sites.  The most important log file <br>  bones_back - where without backups.  Here we transfer everything that is older than three months. <br>  samples - synchronization of bites, which allows to compare delays with the calibration site. <br>  watch_dogs is a list of sites that watchdogs ‚Äúbite‚Äù to check. <br><br><h5>  How it works? </h5><br><br>  Each entry to check hosting has a unique number.  Sites are polled randomly.  This guarantees the work of the script in the conditions of hanging up a single site.  If the ‚Äúcalibration‚Äù site fails at the same time as the one being checked, we conclude that the non-verifiable website was buggy, but our server itself, and we reject this sample.  Comparison of samples is done in the sample_id field in the bones database. <br><br>  Here is the list of "dogs" <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9f3/31e/991/9f331e991b1cccbbd711e793b3fd3011.jpg" alt="Bite down"><br><br>  Here is an example of failures in the last 7 days. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/21a/317/7aa/21a3177aae00a1962a441479e485e970.jpg" alt="crispo.ru"><br><br>  The statistics are good enough, the morning delays are just the start of the backup. <br><br><h5>  What can be improved / added? </h5><br>  1. Do not swear at register_globals, this script is for local access (not outside) <br>  2. The user interface would be better <br>  3. There is not enough information to put together a sample of the site and the termination site. <br>  4. You can add tracking of the key phrase on the page that guarantees the normal operation of the database of the site being checked. <br>  5. Failure notifications <br>  6. A more ‚Äúcorrect‚Äù script for clearing tags from the meaningful part of the site <br>  7. Buttons for total suspension of the watchdog script in cases when you need to urgently reduce the load on the main server <br><br>  There are similar services, even checking email and ftp availability, but often they are on Western servers, and are quite complex.  We have successfully integrated our own script into the client‚Äôs office, and monthly internal reports, and in general we are satisfied with its simplicity and simplicity. <br><br>  <i>We give the script to everyone, if write a worthy sequel, we ask them to also share with everyone.</i>  <i>It is possible through us (sending the source code to support@webprojects.ru).</i> <i><br></i>  <i>If it will be useful to you - remember about us, do not remove the mention of the authors from the captions in the comments and footer.</i> <br><br>  PS The monitoring module is called a watch dog in honor of the remarkable quality of some AMR controllers.  Initially, it was an interrupt with an internal counter, which monotonously decreases the value of the special register.  As soon as the value reaches zero, a controller reload is initiated, and the program starts from scratch.  In the main and reliable part of the program, the control register is reset to high values.  If suddenly the software of your washing machine or TV hangs due to some kind of error, the watchdog will reboot itself. </div><p>Source: <a href="https://habr.com/ru/post/97634/">https://habr.com/ru/post/97634/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../97624/index.html">"Unlimited" mobile Internet is not fantastic, Eldar</a></li>
<li><a href="../97630/index.html">The future of the zone of the Russian Federation is! The results of the survey Domenus.ru</a></li>
<li><a href="../97631/index.html">On the issue of piracy of audio and video products</a></li>
<li><a href="../97632/index.html">Wean Firefox 3.6.6 kill Flash Player during debug</a></li>
<li><a href="../97633/index.html">lmBook - life management on the desktop and mobile phone</a></li>
<li><a href="../97635/index.html">What awaits us in Mozilla Fennec 2.0?</a></li>
<li><a href="../97636/index.html">Reporters sans fronti√®res provide shelter for disgraced bloggers</a></li>
<li><a href="../97637/index.html">Mutual conversion and processing of electronic documents</a></li>
<li><a href="../97639/index.html">Londosky metro will receive WiFi by 2012</a></li>
<li><a href="../97642/index.html">HP StorageWorks P2000 with 6 Gigabit SAS Released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>