<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Gugarkartim on clever</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, it has become fashionable to use a gouglet. 
 Google map of the court, Google map there. 
 And the main thing is not to forget to display yo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Gugarkartim on clever</h1><div class="post__text post__text-html js-mediator-article">  Recently, it has become fashionable to use a gouglet. <br>  Google map of the court, Google map there. <br>  And the main thing is not to forget to display your objects on the map. <br>  But, for some reason, the overwhelming number of services use the wrong implementation of the process of transferring tokens from the server to the client. <br>  More precisely, they do not correctly form requests. <br>  And to put it even more precisely - they do it. <a name="habracut"></a><br><br>  So, what does a normal request from the client to the server look like with the wish to transfer to the client markers for a known area? <br>  <strong>Option 1</strong> - if we have little markers - we load them all (including initially in the code) and then draw.  The smartest use different marker-managers for this ... <br>  But what will happen if a lot of objects? <br><br>  <strong>Option 2</strong> - <em>‚Äúhear the server, give me the markers for BBOX = (one corner), (another corner)‚Äù</em> . <br>  And this option is the most common. <br>  It is used by <a href="http://gdeetotdom.ru/">"GdeEtot Dom"</a> and <a href="http://www.domnakarte.ru/">"DomNaKarte"</a> and <a href="http://mirtesen.ru/">"MirTesen"</a> and even the brand new <a href="http://aroundme.ru/">"Around Me"</a> . <br>  And this option is loved by Google itself, since this is how regional data from KML is loaded. <br>  And this option is very fond of ‚Äúloading off‚Äù the card and writing ‚ÄúI‚Äôm loading ...‚Äù <br>  And it loads for a long time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And why? <br>  Imagine that you have 100 objects in the database (there are eight million in the Wikimapia database) ... <br>  And you need to make a selection by the double key (x, y) FROM and TO. <br>  And it can take (and takes) a second, or even two.  And even more - the DB is not rubber. <br>  And the slightest change in coordinates will cause a ‚Äúre-fetch‚Äù. <br>  If the databases were able to say - they are you foul language :) <br>  You can of course facilitate the work of the database using the ‚Äúspatial‚Äù formats (points and polygons, in general, initially the data on the plane) - but in any case - each request will be unique, and these <strong>requests are not cached</strong> ! <br>  And the sample will be not entirely accurate - the client will still have to sort the markers so that there is no heap at one point ... <br><br>  Well - if you like it - continue to use this approach further, and I will tell you about a slightly more complex (and much longer "code" option), without these flaws. <br>  I did not come up with the approach myself, and it was not me who did its implementation. <br>  Moreover, I used to use <strong>Option 2</strong> myself. <br>  But once I saw ‚Äúhow it should be‚Äù and I was visited by <em>(alien)</em> wisdom. <br><br>  So, the approach that I propose, which is not strange, is proposed (and used) by Google itself for addressing the pictures of the Google Card. <br>  Even this approach could be used on the SERVER part by those smart programmers who, as a child, took a great interest in game deeds there and know what a quad-tree is. <br>  I even know one service that on the server side we have markers just in the quad, but requests data from the client anyway for Option 2. <br>  Well, how else to form a query to the database? <br>  And here everything is simple - you just need to request the node itself :) <br><br>  Let's turn to the original source - google. <br>  We tear off a help on its api, and we go to the bottom.  Until manual addressing tiles. <br>  And we see an interesting picture ... <br>  <em>For example, the map consists of 4 256x256 pixels tiles, resulting in a pixel space from 512x512</em> <em><br></em>  <em>Tiles are indexed using x, y coordinates from that origin.</em>  <em>For example, it can be referenced by a unique x, y pair:</em> <em><br></em> <br><img src="http://code.google.com/apis/maps/documentation/include/tileCoordinates.png"><br><br>  Well, in the brain chenit "clicked"? <br>  In general, our task is not to ask to give all the data on the markers by this coordinates. <br>  Our task is to request a TILE! <br>  And the tile (here the dog and dug) is not one. <br><br>  What do we need? <br>  1. Understand the current viewport <br>  2. Algorithmically convert this viewport into an array of tiles that are visible to us in this case. <br>  3.MARK OUT that a part of the tiles can greatly go beyond the limits of the visible area, that they will exactly repeat the tile image layout of the google map, and that their size will be 256 by 256 pixels ALWAYS (well, of course, I said that strongly, you can request 128x128 and 512x512 , but it‚Äôs better to work ‚Äúparallel‚Äù to the Googleboard ... <br>  4. And after that, once again understand that the issuance of markers for one tile will be constant. <br>  We will know the coordinates for which we need to select objects, we will know the pixel width of the sample.  We will know the zoom card.  Well and still that is required for the correct display :) <br><br>  And most importantly - since the sample goes along constant coordinates and pixel resolution - you can cache it :) <br>  And instead of a second or two or three, get a sample of objects for at least 30ms per card <br>  (clarification: in the case of well-accelerated sampling, you can get up to 4 pixels in one moment (or patch Fox Fox, but not the most popular browser), and then 4 more tiles, and then more ... <br>  Considering what is usually displayed from 6 to 8 tiles - in 100-200 ms the data will be on the client) <br>  Another bonus of tiles - if one small tile ‚Äúlacks‚Äù objects to provide data in the right amount - it can ‚Äúgo‚Äù up one level and transfer data from the region that has more markers. <br>  Ie for Moscow will be high resolution.  And for the tundra it is possible and less <br><br>  The task of the client part - just follow what and where it was already requested. <br>  And if you move the map - just a couple of tiles to load in a very short period. <br>  Only new part.  Refresh screen will not. <br><br>  So, I lived and lived, I made 2 for good, and then I visited the wonderful project <a href="http://wikimapia.org/">Wikimapia</a> <br>  Rummaged in their format of export and addressing.  I took for myself the same and rushed :) <br>  <em>(What happened after a six-month-long seat on Wikimapia, <b>read the topic about <a href="http://habrahabr.ru/blogs/startup/38405/">my neighbors</a></b> )</em> <br><br>  Then there was the decoding of the Wikimapia scripts, their awareness and implantation on themselves. <br><br>  Next, I will provide the code from the live service. <br>  The code is presented as is and 90% saved in the original, there are no comments <br>  The server side code was already written independently. <br>  Used addressing saved from wikimapia looks like <br>  {SERVERBASE} / z / 12/23/34‚Ä¶ .xy <br>  where z - says that we are requesting objects (u will be users, i pictures, and so on) <br>  If you take a closer look, you can understand that you can even ‚Äúhold‚Äù data on the file system, while adding new objects, simply by updating some of the files. <br>  Each digit (0-3) tells us which piece of the next quad quad we need to go to. <br>  Personally, I do not recommend using the range 0-3, but using 1-4, then the addressing can be stored in BIGINT (for example, Canada, we have the beginning 00 (left upper part of the map, left upper part of the map) and, in the case of storage in bigintera, this is the beginning " get bored ‚Äù) <br><br>  So the code on the client is a task according to a given viewport to get an array of tiles <br><h2>  Some code </h2><br><blockquote> <font color="black"><font color="#008000">// used to normalize Y coordinates</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> consar = <font color="#0000ff">new</font> Array , -11178401,0,11178401,21943045,31952162.40979898.48922499.55776579.61606396.66513260.70612614.74959543.76840816.79171334.81093213.82676284.83979259.85051128);</font> <font color="black"><br></font>  <font color="black"><font color="#008000">// the first part is the transformation of coordinates into division itself, the name of the functions and their contents are taken from Wikimapia</font></font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">function</font> getdatakvname (x, y, curzoomkv)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> xdel = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> ydel = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> xline = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> yline = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> x1 = -180000000;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> x2 = 180000000;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> y1 = -85051128;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> y2 = 85051128;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> y1cons = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> y2cons = 32;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> yconsdel = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> n = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> z = curzoomkv-1;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">while</font> (z&gt; = 0)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">xdel = Math.round ((x1 + x2) / 2);</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (n &lt;4) {yconsdel = (y1cons + y2cons) / 2; ydel = consar [yconsdel];}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">else</font> {ydel = Math.round ((y1 + y2) / 2);}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (x &lt;= xdel) {x2 = xdel; xline = xline * 2;}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">else</font> {x1 = xdel + 1; xline = xline * 2 + 1;}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (y &lt;= ydel) {y2 = ydel; y2cons = yconsdel; yline = yline * 2;}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">else</font> {y1 = ydel + 1; y1cons = yconsdel; yline = yline * 2 + 1;}</font> <font color="black"><br></font>  <font color="black">z--;</font> <font color="black"><br></font>  <font color="black">n ++</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> <font color="#0000ff">out</font> = <font color="#0000ff">new</font> Array ();</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">out</font> .xline = xline;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">out</font> .yline = yline;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> <font color="#0000ff">out</font> ;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">function</font> cheakpoint (x, y, xline, yline, curzoomkv)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> xdel = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> ydel = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> x1 = -180000000;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> x2 = 180000000;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> y1 = -85051128;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> y2 = 85051128;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> y1cons = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> y2cons = 32;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> yconsdel = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> n = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> xlinetest = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> ylinetest = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> test = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> z = curzoomkv-1;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">while</font> (z&gt; = 0)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">xdel = Math.round ((x1 + x2) / 2);</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (n &lt;4) {yconsdel = (y1cons + y2cons) / 2; ydel = consar [yconsdel]}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">else</font> {ydel = Math.round ((y1 + y2) / 2)}</font> <font color="black"><br></font>  <font color="black">test = Math.pow (2, z);</font> <font color="black"><br></font>  <font color="black">xlinetest = xline &amp; test;</font> <font color="black"><br></font>  <font color="black">ylinetest = yline &amp; test;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (xlinetest&gt; 0) {x1 = xdel + 1}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">else</font> {x2 = xdel}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (ylinetest&gt; 0) {y1 = ydel + 1; y1cons = yconsdel}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">else</font> {y2 = ydel; y2cons = yconsdel}</font> <font color="black"><br></font>  <font color="black">z--;</font> <font color="black"><br></font>  <font color="black">n ++</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> <font color="#0000ff">out</font> = <font color="#0000ff">new</font> Array ();</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> ((x&gt; = x1) &amp;&amp; (x &lt;= x2) &amp;&amp; (y&gt; = y1) &amp;&amp; (y &lt;= y2)) { <font color="#0000ff">out</font> .res = 1}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">else</font> { <font color="#0000ff">out</font> .res = 0}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> <font color="#0000ff">out</font> ;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">function</font> retcode (xline, yline, curzoomkv)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> xparam = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> yparam = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> test = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> xlinetest = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> ylinetest = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> line = <font color="#A31515">''</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> z = curzoomkv-1;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">while</font> (z&gt; = 0)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">test = Math.pow (2, z);</font> <font color="black"><br></font>  <font color="black">xlinetest = xline &amp; test;</font> <font color="black"><br></font>  <font color="black">ylinetest = yline &amp; test;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (xlinetest&gt; 0) {xparam = 1}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">else</font> {xparam = 0}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (ylinetest&gt; 0) {yparam = 2}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">else</font> {yparam = 0}</font> <font color="black"><br></font>  <font color="black">linepart = xparam + yparam;</font> <font color="black"><br></font>  <font color="black">line = line + linepart;</font> <font color="black"><br></font>  <font color="black">z--;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> line;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">/// and the function of the request</font></font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">function</font> request_geo_objectsin ()</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (! allow_geo_requests) <font color="#0000ff">return</font> ;</font> <font color="black"><br></font>  <font color="black">require_block = {};</font> <font color="black"><br></font>  <font color="black">map = GetMap ();</font> <font color="black"><br></font>  <font color="black">curzoomkv = map.getZoom () - 1;</font> <font color="black"><br></font>  <font color="black">bounds = map.getBounds ();</font> <font color="black"><br></font>  <font color="black">bounds_sw = bounds.getSouthWest ();</font> <font color="black"><br></font>  <font color="black">bounds_ne = bounds.getNorthEast ();</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> x1point = Math.round (bounds_sw.lng () * 1000000);</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> y1point = Math.round (bounds_sw.lat () * 1000000);</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> x2point = Math.round (bounds_ne.lng () * 1,000,000);</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> y2point = Math.round (bounds_ne.lat () * 1,000,000);</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (x1point &lt;-180000000) {x1point = -180000000} <font color="#0000ff">if</font> (x2point &lt;-180000000) {x2point = -180000000} <font color="#0000ff">if</font> (x1point&gt; 180000000) {x1point = 180000000} <font color="#0000ff">if</font> (x2point&gt; 180000000) {x2point = 180000000} <font color="#0000ff">if</font> ( y1point &lt;-85051128) {y1point = -85051128} <font color="#0000ff">if</font> (y2point &lt;-85051128) {y2point = -85051128} <font color="#0000ff">if</font> (y1point&gt; 85051128) {y1point = 85051128} <font color="#0000ff">if</font> (y2point&gt; 85051128) {y2point = 85051128}</font> <font color="black"><br><br></font>  <font color="black">outar = [];</font> <font color="black"><br></font>  <font color="black">outar = getdatakvname (x1point, y1point, curzoomkv);</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> xline = outar.xline;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> yline = outar.yline;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> maks = Math.pow (2, curzoomkv) -1;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> vlez = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> xsdvig = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> xlinet = xline;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> ylinet = yline;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">while</font> (vlez! = 1)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">outar = cheakpoint (x2point, y1point, xlinet, ylinet, curzoomkv);</font> <font color="black"><br></font>  <font color="black">vlez = outar.res;</font> <font color="black"><br></font>  <font color="black">xsdvig ++;</font> <font color="black"><br></font>  <font color="black">xlinet = xlinet + 1;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (xlinet&gt; maks) {xlinet = 0}</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">vlez = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> ysdvig = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> xlinet = xline;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> ylinet = yline;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">while</font> (vlez! = 1)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">outar = cheakpoint (x1point, y2point, xlinet, ylinet, curzoomkv);</font> <font color="black"><br></font>  <font color="black">vlez = outar.res;</font> <font color="black"><br></font>  <font color="black">ysdvig ++;</font> <font color="black"><br></font>  <font color="black">ylinet = ylinet + 1;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (ylinet&gt; maks) {ylinet = 0}</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> temp = <font color="#A31515">"</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> newtemp = <font color="#A31515">''</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> ylinesave = yline;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> ysdvigsave = ysdvig;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">while</font> (xsdvig&gt; 0)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">while</font> (ysdvig&gt; 0)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">temp = <font color="#A31515">'0'</font> + retcode (xline, yline, curzoomkv);</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> lineleng = 0;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> newtemp = <font color="#A31515">''</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">while</font> (lineleng &lt;temp.length)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">newtemp = newtemp + <font color="#A31515">"/"</font> + temp.substring (lineleng, lineleng + 3);</font> <font color="black"><br></font>  <font color="black">lineleng = lineleng + 3;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> letbe = <font color="#A31515">"z"</font> ;</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">newtemp = <font color="#A31515">'z'</font> + newtemp + gzipext;</font> <font color="black"><br></font>  <font color="black">xml_url = newtemp;</font> <font color="black"><br></font>  <font color="black">require_block [temp] = xml_url;</font>  <font color="black"><font color="#008000">// + "? x =" + x1point + "&amp; y =" + y1point + "&amp; x2 =" + x2point + "&amp; y2 =" + y2point;</font></font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">ysdvig -; yline ++;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (yline&gt; maks) {yline = 0}</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">yline = ylinesave;</font> <font color="black"><br></font>  <font color="black">ysdvig = ysdvigsave;</font> <font color="black"><br></font>  <font color="black">xsdvig--;</font> <font color="black"><br></font>  <font color="black">xline ++;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> (xline&gt; maks) {xline = 0}</font> <font color="black"><br><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> i = 0;</font> <font color="black"><br></font>  <font color="black">clearNavRequestTimeouts ();</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">for</font> (gotarrn <font color="#0000ff">in</font> require_block)</font> <font color="black"><br></font>  <font color="black"><font color="#008000">// GO TO REQUEST A TILE!</font></font> <font color="black"><br></font> <br><br>  that's all :) <br>  It remains to receive the request on the server side and convert it back to coordinates <br><blockquote>  <font color="black">$ x1 = -180000000;</font> <font color="black"><br></font>  <font color="black">$ x2 = 180000000;</font> <font color="black"><br></font>  <font color="black">$ y1 = -85051128;</font> <font color="black"><br></font>  <font color="black">$ y2 = 85051128;</font> <font color="black"><br><br></font>  <font color="black">$ y1cons = 0;</font> <font color="black"><br></font>  <font color="black">$ y2cons = 32;</font> <font color="black"><br></font>  <font color="black">$ yconsdel = 0;</font> <font color="black"><br><br></font>  <font color="black">$ consar = Array (-85051128, -83979259</font> , -82676284, -81093213, -79171334, -76840816, -74019543, -70612614, -66513260, -61606396, -55776579, -48922499, -40979898, -31952162, -21943045, <font color="black">-11178401.0,11178401,21943045,31952162.40979898.48922499.55776579.61606396.66513260.70612614.74959543.76840816.79171334.81093213.82676284.83979259.85051128);</font> <font color="black"><br><br><br></font>  <font color="black">$ z = 1;</font> <font color="black"><br></font>  <font color="black"><font color="#008000">// RQ is the request digits; if not strange, the request is equal to getZoom () + 1</font></font> <font color="black"><br></font>  <font color="black">$ L = strlen ($ RQ);</font> <font color="black"><br></font>  <font color="black">$ ZM = $ L;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">for</font> ($ i = 0; $ i &lt;$ L; ++ $ i)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br><br></font>  <font color="black">$ test = intval ($ RQ [$ i]);</font> <font color="black"><br></font>  <font color="black">$ xdel = round (($ x1 + $ x2) / 2);</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> ($ i &lt;4) {$ yconsdel = ($ y1cons + $ y2cons) / 2; $ ydel = $ consar [$ yconsdel];}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">else</font> {$ ydel = round (($ y1 + $ y2) / 2);}</font> <font color="black"><br><br></font>  <font color="black"><font color="#0000ff">switch</font> ($ test)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">case</font> 0: $ p1 = 0; $ p2 = 1;</font>  <font color="black"><font color="#0000ff">break</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">case</font> 1: $ p1 = 1; $ p2 = 1;</font>  <font color="black"><font color="#0000ff">break</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">case</font> 2: $ p1 = 0; $ p2 = 0;</font>  <font color="black"><font color="#0000ff">break</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">case</font> 3: $ p1 = 1; $ p2 = 0;</font>  <font color="black"><font color="#0000ff">break</font> ;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> ($ p1) {$ x1 = $ xdel + 1;}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">else</font> {$ x2 = $ xdel;}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">if</font> ($ p2) {$ y2 = $ ydel; $ y2cons = $ yconsdel;}</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">else</font> {$ y1 = $ ydel + 1; $ y1cons = $ yconsdel;}</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br><br></font>  <font color="black">$ x1 = $ x1 / 1000000;</font> <font color="black"><br></font>  <font color="black">$ x2 = $ x2 / 1,000,000;</font> <font color="black"><br></font>  <font color="black">$ y1 = $ y1 / 1000000;</font> <font color="black"><br></font>  <font color="black">$ y2 = $ y2 / 1,000,000;</font> <font color="black"><br><br></font>  <font color="black"><font color="#008000">// BOT AND COORDINATES OF OUR REQUESTED BOX!</font></font> <font color="black"><br></font>  <font color="gray">* This source code was highlighted with <a href="http://source.virtser.net/"><font color="gray">Source Code Highlighter</font></a> .</font> </blockquote><br><br>  I hope the described method will find its readers, and, most importantly, will help someone to make their project (and the whole world after it) a little bit better. <br><br>  In action, you can look at this case either on the ‚Äúsource‚Äù of this <a href="http://wikimapia.org/">Wikimapia</a> approach, or on the ‚Äúrecipient‚Äù - <a href="http://www.esosedi.ru/">my Neighbors</a> </blockquote></div><p>Source: <a href="https://habr.com/ru/post/38408/">https://habr.com/ru/post/38408/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../38403/index.html">SUP began to actively monetize LJ</a></li>
<li><a href="../38404/index.html">Learn to hold meetings</a></li>
<li><a href="../38405/index.html">We are your neighbors</a></li>
<li><a href="../38406/index.html">What's new in IE8 beta 2?</a></li>
<li><a href="../38407/index.html">The popularity of operating systems</a></li>
<li><a href="../38410/index.html">And large mail services have such stupid problems.</a></li>
<li><a href="../38412/index.html">Easy tuning tree comments</a></li>
<li><a href="../38415/index.html">Task - Puzzle, difficult for layout alignment</a></li>
<li><a href="../38416/index.html">My Smarty plugins. Part 2</a></li>
<li><a href="../38417/index.html">JavaFX -> thesis student zabugornogo student. Comparing JavaFX and Competitors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>